/*
 LeapJS v0.6.4                                                  
 http://github.com/leapmotion/leapjs/                                        

 Copyright 2013 LeapMotion, Inc. and other contributors                      
 Released under the Apache-2.0 license                                     
 http://github.com/leapmotion/leapjs/blob/master/LICENSE.txt                 
*/
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var h=0;return function(){return h<b.length?{done:!1,value:b[h++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,h,l){if(b==Array.prototype||b==Object.prototype)return b;b[h]=l.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<b.length;++h){var l=b[h];if(l&&l.Math==Math)return l}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,h){var l=$jscomp.propertyToPolyfillSymbol[h];if(null==l)return b[h];l=b[l];return void 0!==l?l:b[h]};
$jscomp.polyfill=function(b,h,l,e){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,h,l,e):$jscomp.polyfillUnisolated(b,h,l,e))};$jscomp.polyfillUnisolated=function(b,h,l,e){l=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var r=b[e];if(!(r in l))return;l=l[r]}b=b[b.length-1];e=l[b];h=h(e);h!=e&&null!=h&&$jscomp.defineProperty(l,b,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(b,h,l,e){var r=b.split(".");b=1===r.length;e=r[0];e=!b&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var q=0;q<r.length-1;q++){var k=r[q];if(!(k in e))return;e=e[k]}r=r[r.length-1];l=$jscomp.IS_SYMBOL_NATIVE&&"es6"===l?e[r]:null;h=h(l);null!=h&&(b?$jscomp.defineProperty($jscomp.polyfills,r,{configurable:!0,writable:!0,value:h}):h!==l&&($jscomp.propertyToPolyfillSymbol[r]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(r):$jscomp.POLYFILL_PREFIX+r,r=
$jscomp.propertyToPolyfillSymbol[r],$jscomp.defineProperty(e,r,{configurable:!0,writable:!0,value:h})))};$jscomp.initSymbol=function(){};$jscomp.initSymbolIterator=function(){};$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(b){b={next:b};b[Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,h){b instanceof String&&(b+="");var l=0,e={next:function(){if(l<b.length){var r=l++;return{value:h(r,b[r]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(h,l){return l})}},"es8","es3");$jscomp.owns=function(b,h){return Object.prototype.hasOwnProperty.call(b,h)};
$jscomp.polyfill("Object.values",function(b){return b?b:function(h){var l=[],e;for(e in h)$jscomp.owns(h,e)&&l.push(h[e]);return l}},"es8","es3");$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(h,l){var e=this;e instanceof String&&(e=String(e));var r=e.length;l=l||0;for(0>l&&(l=Math.max(l+r,0));l<r;l++){var q=e[l];if(q===h||Object.is(q,h))return!0}return!1}},"es7","es3");function GORLOT(){}GORLOT.NAME="Gorlot";GORLOT.VERSION="2020-0.1";
GORLOT.TIMESTAMP="Sat Aug 08, 16:20 PM"(function(b,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(b.THREE=b.THREE||{})}(this,function(b){function h(){}function l(a,c){this.x=a||0;this.y=c||0}function e(a,c,d,g,u,w,z,F,J,M){Object.defineProperty(this,"id",{value:Bg++});this.uuid=Bb.generateUUID();this.name="";this.image=void 0!==a?a:e.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==c?c:e.DEFAULT_MAPPING;this.wrapS=
void 0!==d?d:1001;this.wrapT=void 0!==g?g:1001;this.magFilter=void 0!==u?u:1006;this.minFilter=void 0!==w?w:1008;this.anisotropy=void 0!==J?J:1;this.format=void 0!==z?z:1023;this.type=void 0!==F?F:1009;this.offset=new l(0,0);this.repeat=new l(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==M?M:3E3;this.version=0;this.onUpdate=null}function r(a,c,d,g){this.x=a||0;this.y=c||0;this.z=d||0;this.w=void 0!==g?g:1}function q(a,c,d){this.uuid=
Bb.generateUUID();this.width=a;this.height=c;this.scissor=new r(0,0,a,c);this.scissorTest=!1;this.viewport=new r(0,0,a,c);d=d||{};void 0===d.minFilter&&(d.minFilter=1006);this.texture=new e(void 0,void 0,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.encoding);this.depthBuffer=void 0!==d.depthBuffer?d.depthBuffer:!0;this.stencilBuffer=void 0!==d.stencilBuffer?d.stencilBuffer:!0;this.depthTexture=void 0!==d.depthTexture?d.depthTexture:null}function k(a,c,d){q.call(this,a,c,
d);this.activeMipMapLevel=this.activeCubeFace=0}function t(a,c,d,g){this._x=a||0;this._y=c||0;this._z=d||0;this._w=void 0!==g?g:1}function p(a,c,d){this.x=a||0;this.y=c||0;this.z=d||0}function y(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function A(a,c,d,g,u,w,z,F,J,M){a=void 0!==a?a:[];e.call(this,a,void 0!==c?c:301,d,g,u,w,z,F,J,M);this.flipY=!1}function E(a,
c,d){var g=a[0];if(0>=g||0<g)return a;var u=c*d,w=ng[u];void 0===w&&(w=new Float32Array(u),ng[u]=w);if(0!==c)for(g.toArray(w,0),g=1,u=0;g!==c;++g)u+=d,a[g].toArray(w,u);return w}function B(a,c){var d=og[c];void 0===d&&(d=new Int32Array(c),og[c]=d);for(var g=0;g!==c;++g)d[g]=a.allocTextureUnit();return d}function G(a,c){a.uniform1f(this.addr,c)}function I(a,c){a.uniform1i(this.addr,c)}function L(a,c){void 0===c.x?a.uniform2fv(this.addr,c):a.uniform2f(this.addr,c.x,c.y)}function T(a,c){void 0!==c.x?
a.uniform3f(this.addr,c.x,c.y,c.z):void 0!==c.r?a.uniform3f(this.addr,c.r,c.g,c.b):a.uniform3fv(this.addr,c)}function n(a,c){void 0===c.x?a.uniform4fv(this.addr,c):a.uniform4f(this.addr,c.x,c.y,c.z,c.w)}function x(a,c){a.uniformMatrix2fv(this.addr,!1,c.elements||c)}function H(a,c){a.uniformMatrix3fv(this.addr,!1,c.elements||c)}function f(a,c){a.uniformMatrix4fv(this.addr,!1,c.elements||c)}function m(a,c,d){var g=d.allocTextureUnit();a.uniform1i(this.addr,g);d.setTexture2D(c||pg,g)}function v(a,c,
d){var g=d.allocTextureUnit();a.uniform1i(this.addr,g);d.setTextureCube(c||qg,g)}function D(a,c){a.uniform2iv(this.addr,c)}function C(a,c){a.uniform3iv(this.addr,c)}function K(a,c){a.uniform4iv(this.addr,c)}function N(a){switch(a){case 5126:return G;case 35664:return L;case 35665:return T;case 35666:return n;case 35674:return x;case 35675:return H;case 35676:return f;case 35678:return m;case 35680:return v;case 5124:case 35670:return I;case 35667:case 35671:return D;case 35668:case 35672:return C;
case 35669:case 35673:return K}}function S(a,c){a.uniform1fv(this.addr,c)}function U(a,c){a.uniform1iv(this.addr,c)}function X(a,c){a.uniform2fv(this.addr,E(c,this.size,2))}function Z(a,c){a.uniform3fv(this.addr,E(c,this.size,3))}function V(a,c){a.uniform4fv(this.addr,E(c,this.size,4))}function ma(a,c){a.uniformMatrix2fv(this.addr,!1,E(c,this.size,4))}function ia(a,c){a.uniformMatrix3fv(this.addr,!1,E(c,this.size,9))}function ja(a,c){a.uniformMatrix4fv(this.addr,!1,E(c,this.size,16))}function ba(a,
c,d){var g=c.length,u=B(d,g);a.uniform1iv(this.addr,u);for(a=0;a!==g;++a)d.setTexture2D(c[a]||pg,u[a])}function fa(a,c,d){var g=c.length,u=B(d,g);a.uniform1iv(this.addr,u);for(a=0;a!==g;++a)d.setTextureCube(c[a]||qg,u[a])}function ka(a){switch(a){case 5126:return S;case 35664:return X;case 35665:return Z;case 35666:return V;case 35674:return ma;case 35675:return ia;case 35676:return ja;case 35678:return ba;case 35680:return fa;case 5124:case 35670:return U;case 35667:case 35671:return D;case 35668:case 35672:return C;
case 35669:case 35673:return K}}function P(a,c,d){this.id=a;this.addr=d;this.setValue=N(c.type)}function Y(a,c,d){this.id=a;this.addr=d;this.size=c.size;this.setValue=ka(c.type)}function da(a){this.id=a;this.seq=[];this.map={}}function pa(a,c,d){this.seq=[];this.map={};this.renderer=d;d=a.getProgramParameter(c,a.ACTIVE_UNIFORMS);for(var g=0;g!==d;++g){var u=a.getActiveUniform(c,g),w=a.getUniformLocation(c,u.name),z=this,F=u.name,J=F.length;for(Kf.lastIndex=0;;){var M=Kf.exec(F),R=Kf.lastIndex,O=M[1],
Q=M[3];"]"===M[2]&&(O|=0);if(void 0===Q||"["===Q&&R+2===J){F=z;u=void 0===Q?new P(O,u,w):new Y(O,u,w);F.seq.push(u);F.map[u.id]=u;break}else Q=z.map[O],void 0===Q&&(Q=new da(O),O=z,z=Q,O.seq.push(z),O.map[z.id]=z),z=Q}}}function la(a,c,d){return void 0===c&&void 0===d?this.set(a):this.setRGB(a,c,d)}function xa(a,c,d,g,u,w,z,F,J,M,R,O){e.call(this,null,w,z,F,J,M,g,u,R,O);this.image={data:a,width:c,height:d};this.magFilter=void 0!==J?J:1003;this.minFilter=void 0!==M?M:1003;this.flipY=this.generateMipmaps=
!1;this.unpackAlignment=1}function Ba(a,c){this.min=void 0!==a?a:new l(Infinity,Infinity);this.max=void 0!==c?c:new l(-Infinity,-Infinity)}function ya(a,c){var d,g,u,w,z,F,J,M,R,O,Q=a.context,W=a.state,ca,ea,na,ra,aa,qa;this.render=function(oa,wa,ta){if(0!==c.length){oa=new p;var za=ta.w/ta.z,Ja=.5*ta.z,Ia=.5*ta.w,Oa=16/ta.w,Ua=new l(Oa*za,Oa),Na=new p(1,1,0),Sa=new l(1,1),ab=new Ba;ab.min.set(ta.x,ta.y);ab.max.set(ta.x+(ta.z-16),ta.y+(ta.w-16));if(void 0===ra){Oa=new Float32Array([-1,-1,0,0,1,-1,
1,0,1,1,1,1,-1,1,0,1]);var Pa=new Uint16Array([0,1,2,0,2,3]);ca=Q.createBuffer();ea=Q.createBuffer();Q.bindBuffer(Q.ARRAY_BUFFER,ca);Q.bufferData(Q.ARRAY_BUFFER,Oa,Q.STATIC_DRAW);Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,ea);Q.bufferData(Q.ELEMENT_ARRAY_BUFFER,Pa,Q.STATIC_DRAW);aa=Q.createTexture();qa=Q.createTexture();W.bindTexture(Q.TEXTURE_2D,aa);Q.texImage2D(Q.TEXTURE_2D,0,Q.RGB,16,16,0,Q.RGB,Q.UNSIGNED_BYTE,null);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE);Q.texParameteri(Q.TEXTURE_2D,
Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.NEAREST);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST);W.bindTexture(Q.TEXTURE_2D,qa);Q.texImage2D(Q.TEXTURE_2D,0,Q.RGBA,16,16,0,Q.RGBA,Q.UNSIGNED_BYTE,null);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.NEAREST);Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.NEAREST);
Oa=na={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"};Pa=Q.createProgram();var Ma=Q.createShader(Q.FRAGMENT_SHADER),
Xa=Q.createShader(Q.VERTEX_SHADER),Ka="precision "+a.getPrecision()+" float;\n";Q.shaderSource(Ma,Ka+Oa.fragmentShader);Q.shaderSource(Xa,Ka+Oa.vertexShader);Q.compileShader(Ma);Q.compileShader(Xa);Q.attachShader(Pa,Ma);Q.attachShader(Pa,Xa);Q.linkProgram(Pa);ra=Pa;R=Q.getAttribLocation(ra,"position");O=Q.getAttribLocation(ra,"uv");d=Q.getUniformLocation(ra,"renderType");g=Q.getUniformLocation(ra,"map");u=Q.getUniformLocation(ra,"occlusionMap");w=Q.getUniformLocation(ra,"opacity");z=Q.getUniformLocation(ra,
"color");F=Q.getUniformLocation(ra,"scale");J=Q.getUniformLocation(ra,"rotation");M=Q.getUniformLocation(ra,"screenPosition")}Q.useProgram(ra);W.initAttributes();W.enableAttribute(R);W.enableAttribute(O);W.disableUnusedAttributes();Q.uniform1i(u,0);Q.uniform1i(g,1);Q.bindBuffer(Q.ARRAY_BUFFER,ca);Q.vertexAttribPointer(R,2,Q.FLOAT,!1,16,0);Q.vertexAttribPointer(O,2,Q.FLOAT,!1,16,8);Q.bindBuffer(Q.ELEMENT_ARRAY_BUFFER,ea);W.disable(Q.CULL_FACE);W.setDepthWrite(!1);Pa=0;for(Ma=c.length;Pa<Ma;Pa++)if(Oa=
16/ta.w,Ua.set(Oa*za,Oa),Xa=c[Pa],oa.set(Xa.matrixWorld.elements[12],Xa.matrixWorld.elements[13],Xa.matrixWorld.elements[14]),oa.applyMatrix4(wa.matrixWorldInverse),oa.applyProjection(wa.projectionMatrix),Na.copy(oa),Sa.x=ta.x+Na.x*Ja+Ja-8,Sa.y=ta.y+Na.y*Ia+Ia-8,!0===ab.containsPoint(Sa)){W.activeTexture(Q.TEXTURE0);W.bindTexture(Q.TEXTURE_2D,null);W.activeTexture(Q.TEXTURE1);W.bindTexture(Q.TEXTURE_2D,aa);Q.copyTexImage2D(Q.TEXTURE_2D,0,Q.RGB,Sa.x,Sa.y,16,16,0);Q.uniform1i(d,0);Q.uniform2f(F,Ua.x,
Ua.y);Q.uniform3f(M,Na.x,Na.y,Na.z);W.disable(Q.BLEND);W.enable(Q.DEPTH_TEST);Q.drawElements(Q.TRIANGLES,6,Q.UNSIGNED_SHORT,0);W.activeTexture(Q.TEXTURE0);W.bindTexture(Q.TEXTURE_2D,qa);Q.copyTexImage2D(Q.TEXTURE_2D,0,Q.RGBA,Sa.x,Sa.y,16,16,0);Q.uniform1i(d,1);W.disable(Q.DEPTH_TEST);W.activeTexture(Q.TEXTURE1);W.bindTexture(Q.TEXTURE_2D,aa);Q.drawElements(Q.TRIANGLES,6,Q.UNSIGNED_SHORT,0);Xa.positionScreen.copy(Na);Xa.customUpdateCallback?Xa.customUpdateCallback(Xa):Xa.updateLensFlares();Q.uniform1i(d,
2);W.enable(Q.BLEND);Ka=0;for(var gb=Xa.lensFlares.length;Ka<gb;Ka++){var Wa=Xa.lensFlares[Ka];.001<Wa.opacity&&.001<Wa.scale&&(Na.x=Wa.x,Na.y=Wa.y,Na.z=Wa.z,Oa=Wa.size*Wa.scale/ta.w,Ua.x=Oa*za,Ua.y=Oa,Q.uniform3f(M,Na.x,Na.y,Na.z),Q.uniform2f(F,Ua.x,Ua.y),Q.uniform1f(J,Wa.rotation),Q.uniform1f(w,Wa.opacity),Q.uniform3f(z,Wa.color.r,Wa.color.g,Wa.color.b),W.setBlending(Wa.blending,Wa.blendEquation,Wa.blendSrc,Wa.blendDst),a.setTexture2D(Wa.texture,1),Q.drawElements(Q.TRIANGLES,6,Q.UNSIGNED_SHORT,
0))}}W.enable(Q.CULL_FACE);W.enable(Q.DEPTH_TEST);W.setDepthWrite(!0);a.resetGLState()}}}function Ga(a,c){var d,g,u,w,z,F,J,M,R,O,Q,W,ca,ea,na,ra,aa;function qa(Sa,ab){return Sa.renderOrder!==ab.renderOrder?Sa.renderOrder-ab.renderOrder:Sa.z!==ab.z?ab.z-Sa.z:ab.id-Sa.id}var oa=a.context,wa=a.state,ta,za,Ja,Ia,Oa=new p,Ua=new t,Na=new p;this.render=function(Sa,ab){if(0!==c.length){if(void 0===Ja){var Pa=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),Ma=new Uint16Array([0,1,2,0,2,3]);
ta=oa.createBuffer();za=oa.createBuffer();oa.bindBuffer(oa.ARRAY_BUFFER,ta);oa.bufferData(oa.ARRAY_BUFFER,Pa,oa.STATIC_DRAW);oa.bindBuffer(oa.ELEMENT_ARRAY_BUFFER,za);oa.bufferData(oa.ELEMENT_ARRAY_BUFFER,Ma,oa.STATIC_DRAW);Pa=oa.createProgram();Ma=oa.createShader(oa.VERTEX_SHADER);var Xa=oa.createShader(oa.FRAGMENT_SHADER);oa.shaderSource(Ma,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
oa.shaderSource(Xa,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
oa.compileShader(Ma);oa.compileShader(Xa);oa.attachShader(Pa,Ma);oa.attachShader(Pa,Xa);oa.linkProgram(Pa);Ja=Pa;ra=oa.getAttribLocation(Ja,"position");aa=oa.getAttribLocation(Ja,"uv");d=oa.getUniformLocation(Ja,"uvOffset");g=oa.getUniformLocation(Ja,"uvScale");u=oa.getUniformLocation(Ja,"rotation");w=oa.getUniformLocation(Ja,"scale");z=oa.getUniformLocation(Ja,"color");F=oa.getUniformLocation(Ja,"map");J=oa.getUniformLocation(Ja,"opacity");M=oa.getUniformLocation(Ja,"modelViewMatrix");R=oa.getUniformLocation(Ja,
"projectionMatrix");O=oa.getUniformLocation(Ja,"fogType");Q=oa.getUniformLocation(Ja,"fogDensity");W=oa.getUniformLocation(Ja,"fogNear");ca=oa.getUniformLocation(Ja,"fogFar");ea=oa.getUniformLocation(Ja,"fogColor");na=oa.getUniformLocation(Ja,"alphaTest");Pa=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");Pa.width=8;Pa.height=8;Ma=Pa.getContext("2d");Ma.fillStyle="white";Ma.fillRect(0,0,8,8);Ia=new e(Pa);Ia.needsUpdate=!0}oa.useProgram(Ja);wa.initAttributes();wa.enableAttribute(ra);
wa.enableAttribute(aa);wa.disableUnusedAttributes();wa.disable(oa.CULL_FACE);wa.enable(oa.BLEND);oa.bindBuffer(oa.ARRAY_BUFFER,ta);oa.vertexAttribPointer(ra,2,oa.FLOAT,!1,16,0);oa.vertexAttribPointer(aa,2,oa.FLOAT,!1,16,8);oa.bindBuffer(oa.ELEMENT_ARRAY_BUFFER,za);oa.uniformMatrix4fv(R,!1,ab.projectionMatrix.elements);wa.activeTexture(oa.TEXTURE0);oa.uniform1i(F,0);Ma=Pa=0;(Xa=Sa.fog)?(oa.uniform3f(ea,Xa.color.r,Xa.color.g,Xa.color.b),Xa.isFog?(oa.uniform1f(W,Xa.near),oa.uniform1f(ca,Xa.far),oa.uniform1i(O,
1),Ma=Pa=1):Xa.isFogExp2&&(oa.uniform1f(Q,Xa.density),oa.uniform1i(O,2),Ma=Pa=2)):(oa.uniform1i(O,0),Ma=Pa=0);Xa=0;for(var Ka=c.length;Xa<Ka;Xa++){var gb=c[Xa];gb.modelViewMatrix.multiplyMatrices(ab.matrixWorldInverse,gb.matrixWorld);gb.z=-gb.modelViewMatrix.elements[14]}c.sort(qa);ab=[];Xa=0;for(Ka=c.length;Xa<Ka;Xa++){gb=c[Xa];var Wa=gb.material;!1!==Wa.visible&&(oa.uniform1f(na,Wa.alphaTest),oa.uniformMatrix4fv(M,!1,gb.modelViewMatrix.elements),gb.matrixWorld.decompose(Oa,Ua,Na),ab[0]=Na.x,ab[1]=
Na.y,gb=0,Sa.fog&&Wa.fog&&(gb=Ma),Pa!==gb&&(oa.uniform1i(O,gb),Pa=gb),null!==Wa.map?(oa.uniform2f(d,Wa.map.offset.x,Wa.map.offset.y),oa.uniform2f(g,Wa.map.repeat.x,Wa.map.repeat.y)):(oa.uniform2f(d,0,0),oa.uniform2f(g,1,1)),oa.uniform1f(J,Wa.opacity),oa.uniform3f(z,Wa.color.r,Wa.color.g,Wa.color.b),oa.uniform1f(u,Wa.rotation),oa.uniform2fv(w,ab),wa.setBlending(Wa.blending,Wa.blendEquation,Wa.blendSrc,Wa.blendDst),wa.setDepthTest(Wa.depthTest),wa.setDepthWrite(Wa.depthWrite),Wa.map?a.setTexture2D(Wa.map,
0):a.setTexture2D(Ia,0),oa.drawElements(oa.TRIANGLES,6,oa.UNSIGNED_SHORT,0))}wa.enable(oa.CULL_FACE);a.resetGLState()}}}function $a(){Object.defineProperty(this,"id",{value:Cg++});this.uuid=Bb.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=
3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function kb(a){$a.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";
this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),
this.setValues(a))}function Ib(a){$a.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function wb(a,c){this.min=void 0!==a?a:new p(Infinity,Infinity,Infinity);this.max=void 0!==c?c:new p(-Infinity,-Infinity,-Infinity)}function Mb(a,c){this.center=void 0!==a?a:new p;this.radius=
void 0!==c?c:0}function Pb(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Qb(a,c){this.normal=void 0!==a?a:new p(1,0,0);this.constant=void 0!==c?c:0}function Wc(a,c,d,g,u,w){this.planes=[void 0!==a?a:new Qb,void 0!==c?c:new Qb,void 0!==d?d:new Qb,void 0!==g?g:new Qb,void 0!==u?u:new Qb,void 0!==w?w:new Qb]}function cd(a,c,d,g){function u(Na,Sa,ab,Pa){var Ma=Na.geometry;
var Xa=na;var Ka=Na.customDepthMaterial;ab&&(Xa=ra,Ka=Na.customDistanceMaterial);Ka?Xa=Ka:(Ka=!1,Sa.morphTargets&&(Ma&&Ma.isBufferGeometry?Ka=Ma.morphAttributes&&Ma.morphAttributes.position&&0<Ma.morphAttributes.position.length:Ma&&Ma.isGeometry&&(Ka=Ma.morphTargets&&0<Ma.morphTargets.length)),Na=Na.isSkinnedMesh&&Sa.skinning,Ma=0,Ka&&(Ma|=1),Na&&(Ma|=2),Xa=Xa[Ma]);a.localClippingEnabled&&!0===Sa.clipShadows&&0!==Sa.clippingPlanes.length&&(Ma=Xa.uuid,Ka=Sa.uuid,Na=aa[Ma],void 0===Na&&(Na={},aa[Ma]=
Na),Ma=Na[Ka],void 0===Ma&&(Ma=Xa.clone(),Na[Ka]=Ma),Xa=Ma);Xa.visible=Sa.visible;Xa.wireframe=Sa.wireframe;Ka=Sa.side;Ua.renderSingleSided&&2==Ka&&(Ka=0);Ua.renderReverseSided&&(0===Ka?Ka=1:1===Ka&&(Ka=0));Xa.side=Ka;Xa.clipShadows=Sa.clipShadows;Xa.clippingPlanes=Sa.clippingPlanes;Xa.wireframeLinewidth=Sa.wireframeLinewidth;Xa.linewidth=Sa.linewidth;ab&&void 0!==Xa.uniforms.lightPos&&Xa.uniforms.lightPos.value.copy(Pa);return Xa}function w(Na,Sa,ab){if(!1!==Na.visible){0!==(Na.layers.mask&Sa.layers.mask)&&
(Na.isMesh||Na.isLine||Na.isPoints)&&Na.castShadow&&(!1===Na.frustumCulled||!0===J.intersectsObject(Na))&&!0===Na.material.visible&&(Na.modelViewMatrix.multiplyMatrices(ab.matrixWorldInverse,Na.matrixWorld),ea.push(Na));Na=Na.children;for(var Pa=0,Ma=Na.length;Pa<Ma;Pa++)w(Na[Pa],Sa,ab)}}var z=a.context,F=a.state,J=new Wc,M=new y,R=c.shadows,O=new l,Q=new l(g.maxTextureSize,g.maxTextureSize),W=new p,ca=new p,ea=[],na=Array(4),ra=Array(4),aa={},qa=[new p(1,0,0),new p(-1,0,0),new p(0,0,1),new p(0,0,
-1),new p(0,1,0),new p(0,-1,0)],oa=[new p(0,1,0),new p(0,1,0),new p(0,1,0),new p(0,1,0),new p(0,0,1),new p(0,0,-1)],wa=[new r,new r,new r,new r,new r,new r];c=new Ib;c.depthPacking=3201;c.clipping=!0;g=Gd.distanceRGBA;for(var ta=rc.clone(g.uniforms),za=0;4!==za;++za){var Ja=0!==(za&1),Ia=0!==(za&2),Oa=c.clone();Oa.morphTargets=Ja;Oa.skinning=Ia;na[za]=Oa;Ja=new kb({defines:{USE_SHADOWMAP:""},uniforms:ta,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,morphTargets:Ja,skinning:Ia,clipping:!0});
ra[za]=Ja}var Ua=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(Na,Sa){if(!1!==Ua.enabled&&(!1!==Ua.autoUpdate||!1!==Ua.needsUpdate)&&0!==R.length){F.buffers.color.setClear(1,1,1,1);F.disable(z.BLEND);F.setDepthTest(!0);F.setScissorTest(!1);for(var ab,Pa,Ma=0,Xa=R.length;Ma<Xa;Ma++){var Ka=R[Ma],gb=Ka.shadow;if(void 0===gb)console.warn("THREE.WebGLShadowMap:",Ka,"has no shadow.");else{var Wa=gb.camera;
O.copy(gb.mapSize);O.min(Q);if(Ka&&Ka.isPointLight){ab=6;Pa=!0;var sb=O.x,yb=O.y;wa[0].set(2*sb,yb,sb,yb);wa[1].set(0,yb,sb,yb);wa[2].set(3*sb,yb,sb,yb);wa[3].set(sb,yb,sb,yb);wa[4].set(3*sb,0,sb,yb);wa[5].set(sb,0,sb,yb);O.x*=4;O.y*=2}else ab=1,Pa=!1;null===gb.map&&(gb.map=new q(O.x,O.y,{minFilter:1003,magFilter:1003,format:1023}),Wa.updateProjectionMatrix());gb.isSpotLightShadow&&gb.update(Ka);gb&&gb.isRectAreaLightShadow&&gb.update(Ka);sb=gb.map;gb=gb.matrix;ca.setFromMatrixPosition(Ka.matrixWorld);
Wa.position.copy(ca);a.setRenderTarget(sb);a.clear();for(sb=0;sb<ab;sb++){Pa?(W.copy(Wa.position),W.add(qa[sb]),Wa.up.copy(oa[sb]),Wa.lookAt(W),F.viewport(wa[sb])):(W.setFromMatrixPosition(Ka.target.matrixWorld),Wa.lookAt(W));Wa.updateMatrixWorld();Wa.matrixWorldInverse.getInverse(Wa.matrixWorld);gb.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);gb.multiply(Wa.projectionMatrix);gb.multiply(Wa.matrixWorldInverse);M.multiplyMatrices(Wa.projectionMatrix,Wa.matrixWorldInverse);J.setFromMatrix(M);ea.length=
0;w(Na,Sa,Wa);yb=0;for(var Jb=ea.length;yb<Jb;yb++){var nb=ea[yb],Ca=d.update(nb),mb=nb.material;if(mb&&mb.isMultiMaterial){var pb=Ca.groups;mb=mb.materials;for(var ub=0,fb=pb.length;ub<fb;ub++){var Cb=pb[ub],Fb=mb[Cb.materialIndex];!0===Fb.visible&&(Fb=u(nb,Fb,Pa,ca),a.renderBufferDirect(Wa,null,Ca,Fb,nb,Cb))}}else Fb=u(nb,mb,Pa,ca),a.renderBufferDirect(Wa,null,Ca,Fb,nb,null)}}}}Na=a.getClearColor();Sa=a.getClearAlpha();a.setClearColor(Na,Sa);Ua.needsUpdate=!1}}}function sc(a,c){this.origin=void 0!==
a?a:new p;this.direction=void 0!==c?c:new p}function wc(a,c,d,g){this._x=a||0;this._y=c||0;this._z=d||0;this._order=g||wc.DefaultOrder}function Hd(){this.mask=1}function jb(){Object.defineProperty(this,"id",{value:Dg++});this.uuid=Bb.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=jb.DefaultUp.clone();var a=new p,c=new wc,d=new t,g=new p(1,1,1);c.onChange(function(){d.setFromEuler(c,!1)});d.onChange(function(){c.setFromQuaternion(d,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:c},quaternion:{enumerable:!0,value:d},scale:{enumerable:!0,value:g},modelViewMatrix:{value:new y},normalMatrix:{value:new Pb}});this.matrix=new y;this.matrixWorld=new y;this.matrixAutoUpdate=jb.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Hd;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=function(){};this.onAfterRender=function(){}}
function Xc(a,c){this.start=void 0!==a?a:new p;this.end=void 0!==c?c:new p}function bc(a,c,d){this.a=void 0!==a?a:new p;this.b=void 0!==c?c:new p;this.c=void 0!==d?d:new p}function cc(a,c,d,g,u,w){this.a=a;this.b=c;this.c=d;this.normal=g&&g.isVector3?g:new p;this.vertexNormals=Array.isArray(g)?g:[];this.color=u&&u.isColor?u:new la;this.vertexColors=Array.isArray(u)?u:[];this.materialIndex=void 0!==w?w:0}function jc(a){$a.call(this);this.type="MeshBasicMaterial";this.color=new la(16777215);this.lightMap=
this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function bb(a,c,d){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Bb.generateUUID();this.array=
a;this.itemSize=c;this.count=void 0!==a?a.length/c:0;this.normalized=!0===d;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function Yc(a,c){bb.call(this,new Int8Array(a),c)}function Oc(a,c){bb.call(this,new Uint8Array(a),c)}function xc(a,c){bb.call(this,new Uint8ClampedArray(a),c)}function dd(a,c){bb.call(this,new Int16Array(a),c)}function tc(a,c){bb.call(this,new Uint16Array(a),c)}function Ec(a,c){bb.call(this,new Int32Array(a),c)}function Fc(a,
c){bb.call(this,new Uint32Array(a),c)}function zb(a,c){bb.call(this,new Float32Array(a),c)}function Zc(a,c){bb.call(this,new Float64Array(a),c)}function se(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function tb(){Object.defineProperty(this,
"id",{value:Lf++});this.uuid=Bb.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function ob(){Object.defineProperty(this,
"id",{value:Lf++});this.uuid=Bb.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Sb(a,c){jb.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new ob;this.material=void 0!==c?c:new jc({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function Pc(a,c,d,g,u,w){function z(qa,oa,wa,ta,za,Ja,Ia,Oa,Ua,Na,Sa){var ab=
Ja/Ua,Pa=Ia/Na,Ma=Ja/2,Xa=Ia/2,Ka=Oa/2;Ia=Ua+1;for(var gb=Na+1,Wa=Ja=0,sb=new p,yb=0;yb<gb;yb++)for(var Jb=yb*Pa-Xa,nb=0;nb<Ia;nb++)sb[qa]=(nb*ab-Ma)*ta,sb[oa]=Jb*za,sb[wa]=Ka,O[ca]=sb.x,O[ca+1]=sb.y,O[ca+2]=sb.z,sb[qa]=0,sb[oa]=0,sb[wa]=0<Oa?1:-1,Q[ca]=sb.x,Q[ca+1]=sb.y,Q[ca+2]=sb.z,W[ea]=nb/Ua,W[ea+1]=1-yb/Na,ca+=3,ea+=2,Ja+=1;for(yb=0;yb<Na;yb++)for(nb=0;nb<Ua;nb++)qa=ra+nb+Ia*(yb+1),oa=ra+(nb+1)+Ia*(yb+1),wa=ra+(nb+1)+Ia*yb,R[na]=ra+nb+Ia*yb,R[na+1]=qa,R[na+2]=wa,R[na+3]=qa,R[na+4]=oa,R[na+5]=
wa,na+=6,Wa+=6;F.addGroup(aa,Wa,Sa);aa+=Wa;ra+=Ja}ob.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:c,depth:d,widthSegments:g,heightSegments:u,depthSegments:w};var F=this;g=Math.floor(g)||1;u=Math.floor(u)||1;w=Math.floor(w)||1;var J=function(qa,oa,wa){return qa=(qa+1)*(oa+1)*2+(qa+1)*(wa+1)*2+(wa+1)*(oa+1)*2}(g,u,w),M=function(qa,oa,wa){qa=qa*oa*2+qa*wa*2+wa*oa*2;return 6*qa}(g,u,w),R=new (65535<M?Uint32Array:Uint16Array)(M),O=new Float32Array(3*J),Q=new Float32Array(3*
J),W=new Float32Array(2*J),ca=0,ea=0,na=0,ra=0,aa=0;z("z","y","x",-1,-1,d,c,a,w,u,0);z("z","y","x",1,-1,d,c,-a,w,u,1);z("x","z","y",1,1,a,d,c,g,w,2);z("x","z","y",1,-1,a,d,-c,g,w,3);z("x","y","z",1,-1,a,c,d,g,u,4);z("x","y","z",-1,-1,a,c,-d,g,u,5);this.setIndex(new bb(R,1));this.addAttribute("position",new bb(O,3));this.addAttribute("normal",new bb(Q,3));this.addAttribute("uv",new bb(W,2))}function pc(a,c,d,g){ob.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:c,widthSegments:d,
heightSegments:g};var u=a/2,w=c/2;d=Math.floor(d)||1;g=Math.floor(g)||1;var z=d+1,F=g+1,J=a/d,M=c/g;c=new Float32Array(z*F*3);a=new Float32Array(z*F*3);for(var R=new Float32Array(z*F*2),O=0,Q=0,W=0;W<F;W++)for(var ca=W*M-w,ea=0;ea<z;ea++)c[O]=ea*J-u,c[O+1]=-ca,a[O+2]=1,R[Q]=ea/d,R[Q+1]=1-W/g,O+=3,Q+=2;O=0;u=new (65535<c.length/3?Uint32Array:Uint16Array)(d*g*6);for(W=0;W<g;W++)for(ea=0;ea<d;ea++)w=ea+z*(W+1),F=ea+1+z*(W+1),J=ea+1+z*W,u[O]=ea+z*W,u[O+1]=w,u[O+2]=J,u[O+3]=w,u[O+4]=F,u[O+5]=J,O+=6;this.setIndex(new bb(u,
1));this.addAttribute("position",new bb(c,3));this.addAttribute("normal",new bb(a,3));this.addAttribute("uv",new bb(R,2))}function Xb(){jb.call(this);this.type="Camera";this.matrixWorldInverse=new y;this.projectionMatrix=new y}function ua(a,c,d,g){Xb.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==d?d:.1;this.far=void 0!==g?g:2E3;this.focus=10;this.aspect=void 0!==c?c:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}
function Da(a,c,d,g,u,w){Xb.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=c;this.top=d;this.bottom=g;this.near=void 0!==u?u:.1;this.far=void 0!==w?w:2E3;this.updateProjectionMatrix()}function Qa(a,c,d){var g,u,w;return{setMode:function(z){g=z},setIndex:function(z){z.array instanceof Uint32Array&&c.get("OES_element_index_uint")?(u=a.UNSIGNED_INT,w=4):z.array instanceof Uint16Array?(u=a.UNSIGNED_SHORT,w=2):(u=a.UNSIGNED_BYTE,w=1)},render:function(z,F){a.drawElements(g,
F,u,z*w);d.calls++;d.vertices+=F;g===a.TRIANGLES&&(d.faces+=F/3)},renderInstances:function(z,F,J){var M=c.get("ANGLE_instanced_arrays");null===M?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(M.drawElementsInstancedANGLE(g,J,u,F*w,z.maxInstancedCount),d.calls++,d.vertices+=J*z.maxInstancedCount,g===a.TRIANGLES&&(d.faces+=z.maxInstancedCount*J/3))}}}function Ta(a,c,d){var g;return{setMode:function(u){g=
u},render:function(u,w){a.drawArrays(g,u,w);d.calls++;d.vertices+=w;g===a.TRIANGLES&&(d.faces+=w/3)},renderInstances:function(u){var w=c.get("ANGLE_instanced_arrays");if(null===w)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var z=u.attributes.position;z=z.isInterleavedBufferAttribute?z.data.count:z.count;w.drawArraysInstancedANGLE(g,0,z,u.maxInstancedCount);d.calls++;d.vertices+=z*u.maxInstancedCount;
g===a.TRIANGLES&&(d.faces+=u.maxInstancedCount*z/3)}}}}function Ha(){var a={};return{get:function(c){if(void 0!==a[c.id])return a[c.id];switch(c.type){case "DirectionalLight":var d={direction:new p,color:new la,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new l};break;case "SpotLight":d={position:new p,direction:new p,color:new la,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new l};break;case "PointLight":d={position:new p,color:new la,distance:0,
decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new l};break;case "HemisphereLight":d={direction:new p,skyColor:new la,groundColor:new la};break;case "RectAreaLight":d={color:new la,position:new p,halfWidth:new p,halfHeight:new p}}return a[c.id]=d}}}function La(a){a=a.split("\n");for(var c=0;c<a.length;c++)a[c]=c+1+": "+a[c];return a.join("\n")}function Va(a,c,d){var g=a.createShader(c);a.shaderSource(g,d);a.compileShader(g);!1===a.getShaderParameter(g,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");
""!==a.getShaderInfoLog(g)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(g),La(d));return g}function cb(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+
a);}}function Za(a,c){c=cb(c);return"vec4 "+a+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function Ra(a,c){c=cb(c);return"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function Ea(a,c){switch(c){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="Uncharted2";break;case 4:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+c);}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function hb(a,c,d){a=a||{};return[a.derivatives||
c.envMapCubeUV||c.bumpMap||c.normalMap||c.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||c.logarithmicDepthBuffer)&&d.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&d.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||c.envMap)&&d.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ab).join("\n")}function db(a){var c=[],d;for(d in a){var g=a[d];!1!==g&&c.push("#define "+
d+" "+g)}return c.join("\n")}function Ab(a){return""!==a}function Gb(a,c){return a.replace(/NUM_DIR_LIGHTS/g,c.numDirLights).replace(/NUM_SPOT_LIGHTS/g,c.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,c.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,c.numPointLights).replace(/NUM_HEMI_LIGHTS/g,c.numHemiLights)}function Ob(a){return a.replace(/#include +<([\w\d.]+)>/g,function(c,d){c=Nb[d];if(void 0===c)throw Error("Can not resolve #include <"+d+">");return Ob(c)})}function Rb(a){return a.replace(/for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,
function(c,d,g,u){c="";for(d=parseInt(d);d<parseInt(g);d++)c+=u.replace(/\[ i \]/g,"[ "+d+" ]");return c})}function Tb(a,c,d,g){var u=a.context,w=d.extensions,z=d.defines,F=d.__webglShader.vertexShader,J=d.__webglShader.fragmentShader,M="SHADOWMAP_TYPE_BASIC";1===g.shadowMapType?M="SHADOWMAP_TYPE_PCF":2===g.shadowMapType&&(M="SHADOWMAP_TYPE_PCF_SOFT");var R="ENVMAP_TYPE_CUBE",O="ENVMAP_MODE_REFLECTION",Q="ENVMAP_BLENDING_MULTIPLY";if(g.envMap){switch(d.envMap.mapping){case 301:case 302:R="ENVMAP_TYPE_CUBE";
break;case 306:case 307:R="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:R="ENVMAP_TYPE_EQUIREC";break;case 305:R="ENVMAP_TYPE_SPHERE"}switch(d.envMap.mapping){case 302:case 304:O="ENVMAP_MODE_REFRACTION"}switch(d.combine){case 0:Q="ENVMAP_BLENDING_MULTIPLY";break;case 1:Q="ENVMAP_BLENDING_MIX";break;case 2:Q="ENVMAP_BLENDING_ADD"}}var W=0<a.gammaFactor?a.gammaFactor:1;w=hb(w,g,a.extensions);var ca=db(z),ea=u.createProgram();d.isRawShaderMaterial?(z=[ca,"\n"].filter(Ab).join("\n"),M=[w,ca,"\n"].filter(Ab).join("\n")):
(z=["precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+d.__webglShader.name,ca,g.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+W,"#define MAX_BONES "+g.maxBones,g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+O:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",
g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.useVertexTexture?"#define BONE_TEXTURE":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&!1===g.flatShading?"#define USE_MORPHNORMALS":
"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+M:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;",
"uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;",
"\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ab).join("\n"),M=[w,"precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+d.__webglShader.name,ca,g.alphaTest?"#define ALPHATEST "+g.alphaTest:"","#define GAMMA_FACTOR "+
W,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+R:"",g.envMap?"#define "+O:"",g.envMap?"#define "+Q:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?
"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.gradientMap?"#define USE_GRADIENTMAP":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(g.numClippingPlanes-g.numClipIntersection),g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+M:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":
"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",g.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==g.toneMapping?"#define TONE_MAPPING":"",0!==g.toneMapping?Nb.tonemapping_pars_fragment:"",0!==g.toneMapping?Ea("toneMapping",g.toneMapping):"",
g.outputEncoding||g.mapEncoding||g.envMapEncoding||g.emissiveMapEncoding?Nb.encodings_pars_fragment:"",g.mapEncoding?Za("mapTexelToLinear",g.mapEncoding):"",g.envMapEncoding?Za("envMapTexelToLinear",g.envMapEncoding):"",g.emissiveMapEncoding?Za("emissiveMapTexelToLinear",g.emissiveMapEncoding):"",g.outputEncoding?Ra("linearToOutputTexel",g.outputEncoding):"",g.depthPacking?"#define DEPTH_PACKING "+d.depthPacking:"","\n"].filter(Ab).join("\n"));F=Ob(F,g);F=Gb(F,g);J=Ob(J,g);J=Gb(J,g);d.isShaderMaterial||
(F=Rb(F),J=Rb(J));J=M+J;F=Va(u,u.VERTEX_SHADER,z+F);J=Va(u,u.FRAGMENT_SHADER,J);u.attachShader(ea,F);u.attachShader(ea,J);void 0!==d.index0AttributeName?u.bindAttribLocation(ea,0,d.index0AttributeName):!0===g.morphTargets&&u.bindAttribLocation(ea,0,"position");u.linkProgram(ea);g=u.getProgramInfoLog(ea);R=u.getShaderInfoLog(F);O=u.getShaderInfoLog(J);W=Q=!0;if(!1===u.getProgramParameter(ea,u.LINK_STATUS))Q=!1,console.error("THREE.WebGLProgram: shader error: ",u.getError(),"gl.VALIDATE_STATUS",u.getProgramParameter(ea,
u.VALIDATE_STATUS),"gl.getProgramInfoLog",g,R,O);else if(""!==g)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",g);else if(""===R||""===O)W=!1;W&&(this.diagnostics={runnable:Q,material:d,programLog:g,vertexShader:{log:R,prefix:z},fragmentShader:{log:O,prefix:M}});u.deleteShader(F);u.deleteShader(J);var na;this.getUniforms=function(){void 0===na&&(na=new pa(u,ea,a));return na};var ra;this.getAttributes=function(){if(void 0===ra){for(var aa={},qa=u.getProgramParameter(ea,u.ACTIVE_ATTRIBUTES),
oa=0;oa<qa;oa++){var wa=u.getActiveAttrib(ea,oa).name;aa[wa]=u.getAttribLocation(ea,wa)}ra=aa}return ra};this.destroy=function(){u.deleteProgram(ea);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=Eg++;this.code=c;this.usedTimes=1;this.program=
ea;this.vertexShader=F;this.fragmentShader=J;return this}function lb(a,c){function d(z,F){if(z)z.isTexture?J=z.encoding:z.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),J=z.texture.encoding);else var J=3E3;3E3===J&&F&&(J=3007);return J}var g=[],u={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",
MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},w="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking".split(" ");
this.getParameters=function(z,F,J,M,R,O){var Q=u[z.type];if(c.floatVertexTextures&&O&&O.skeleton&&O.skeleton.useVertexTexture)var W=1024;else W=Math.floor((c.maxVertexUniforms-20)/4),void 0!==O&&O&&O.isSkinnedMesh&&(W=Math.min(O.skeleton.bones.length,W),W<O.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+O.skeleton.bones.length+", this GPU supports just "+W+" (try OpenGL instead of ANGLE)"));var ca=a.getPrecision();null!==z.precision&&(ca=c.getMaxPrecision(z.precision),ca!==
z.precision&&console.warn("THREE.WebGLProgram.getParameters:",z.precision,"not supported, using",ca,"instead."));var ea=a.getCurrentRenderTarget();return{shaderID:Q,precision:ca,supportsVertexTextures:c.vertexTextures,outputEncoding:d(ea?ea.texture:null,a.gammaOutput),map:!!z.map,mapEncoding:d(z.map,a.gammaInput),envMap:!!z.envMap,envMapMode:z.envMap&&z.envMap.mapping,envMapEncoding:d(z.envMap,a.gammaInput),envMapCubeUV:!!z.envMap&&(306===z.envMap.mapping||307===z.envMap.mapping),lightMap:!!z.lightMap,
aoMap:!!z.aoMap,emissiveMap:!!z.emissiveMap,emissiveMapEncoding:d(z.emissiveMap,a.gammaInput),bumpMap:!!z.bumpMap,normalMap:!!z.normalMap,displacementMap:!!z.displacementMap,roughnessMap:!!z.roughnessMap,metalnessMap:!!z.metalnessMap,specularMap:!!z.specularMap,alphaMap:!!z.alphaMap,gradientMap:!!z.gradientMap,combine:z.combine,vertexColors:z.vertexColors,fog:!!J,useFog:z.fog,fogExp:J&&J.isFogExp2,flatShading:1===z.shading,sizeAttenuation:z.sizeAttenuation,logarithmicDepthBuffer:c.logarithmicDepthBuffer,
skinning:z.skinning,maxBones:W,useVertexTexture:c.floatVertexTextures&&O&&O.skeleton&&O.skeleton.useVertexTexture,morphTargets:z.morphTargets,morphNormals:z.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numClippingPlanes:M,numClipIntersection:R,shadowMapEnabled:a.shadowMap.enabled&&O.receiveShadow&&0<F.shadows.length,
shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:z.premultipliedAlpha,alphaTest:z.alphaTest,doubleSided:2===z.side,flipSided:1===z.side,depthPacking:void 0!==z.depthPacking?z.depthPacking:!1}};this.getProgramCode=function(z,F){var J=[];F.shaderID?J.push(F.shaderID):(J.push(z.fragmentShader),J.push(z.vertexShader));if(void 0!==z.defines)for(var M in z.defines)J.push(M),J.push(z.defines[M]);for(z=0;z<w.length;z++)J.push(F[w[z]]);
return J.join()};this.acquireProgram=function(z,F,J){for(var M,R=0,O=g.length;R<O;R++){var Q=g[R];if(Q.code===J){M=Q;++M.usedTimes;break}}void 0===M&&(M=new Tb(a,J,z,F),g.push(M));return M};this.releaseProgram=function(z){if(0===--z.usedTimes){var F=g.indexOf(z);g[F]=g[g.length-1];g.pop();z.destroy()}};this.programs=g}function $b(a,c,d){function g(z){var F=z.target;z=w[F.id];null!==z.index&&u(z.index);var J=z.attributes;for(M in J)u(J[M]);F.removeEventListener("dispose",g);delete w[F.id];var M=c.get(F);
M.wireframe&&u(M.wireframe);c.delete(F);F=c.get(z);F.wireframe&&u(F.wireframe);c.delete(z);d.memory.geometries--}function u(z){var F=z.isInterleavedBufferAttribute?c.get(z.data).__webglBuffer:c.get(z).__webglBuffer;void 0!==F&&(a.deleteBuffer(F),z.isInterleavedBufferAttribute?c.delete(z.data):c.delete(z))}var w={};return{get:function(z){var F=z.geometry;if(void 0!==w[F.id])return w[F.id];F.addEventListener("dispose",g);if(F.isBufferGeometry)var J=F;else F.isGeometry&&(void 0===F._bufferGeometry&&
(F._bufferGeometry=(new ob).setFromObject(z)),J=F._bufferGeometry);w[F.id]=J;d.memory.geometries++;return J}}}function fc(a,c,d){function g(w,z){w=w.isInterleavedBufferAttribute?w.data:w;var F=c.get(w);if(void 0===F.__webglBuffer){F.__webglBuffer=a.createBuffer();a.bindBuffer(z,F.__webglBuffer);a.bufferData(z,w.array,w.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW);z=a.FLOAT;var J=w.array;J instanceof Float32Array?z=a.FLOAT:J instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):
J instanceof Uint16Array?z=a.UNSIGNED_SHORT:J instanceof Int16Array?z=a.SHORT:J instanceof Uint32Array?z=a.UNSIGNED_INT:J instanceof Int32Array?z=a.INT:J instanceof Int8Array?z=a.BYTE:J instanceof Uint8Array&&(z=a.UNSIGNED_BYTE);F.bytesPerElement=J.BYTES_PER_ELEMENT;F.type=z;F.version=w.version;w.onUploadCallback()}else F.version!==w.version&&(a.bindBuffer(z,F.__webglBuffer),!1===w.dynamic?a.bufferData(z,w.array,a.STATIC_DRAW):-1===w.updateRange.count?a.bufferSubData(z,0,w.array):0===w.updateRange.count?
console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(z,w.updateRange.offset*w.array.BYTES_PER_ELEMENT,w.array.subarray(w.updateRange.offset,w.updateRange.offset+w.updateRange.count)),w.updateRange.count=0),F.version=w.version)}var u=new $b(a,c,d);return{getAttributeBuffer:function(w){return w.isInterleavedBufferAttribute?c.get(w.data).__webglBuffer:c.get(w).__webglBuffer},
getAttributeProperties:function(w){return w.isInterleavedBufferAttribute?c.get(w.data):c.get(w)},getWireframeAttribute:function(w){var z=c.get(w);if(void 0!==z.wireframe)return z.wireframe;var F=[],J=w.index,M=w.attributes;w=M.position;if(null!==J){J=J.array;M=0;for(var R=J.length;M<R;M+=3){var O=J[M+0],Q=J[M+1],W=J[M+2];F.push(O,Q,Q,W,W,O)}}else for(J=M.position.array,M=0,R=J.length/3-1;M<R;M+=3)O=M+0,Q=M+1,W=M+2,F.push(O,Q,Q,W,W,O);F=new bb(new (65535<w.count?Uint32Array:Uint16Array)(F),1);g(F,
a.ELEMENT_ARRAY_BUFFER);return z.wireframe=F},update:function(w){var z=u.get(w);w.geometry.isGeometry&&z.updateFromObject(w);w=z.index;var F=z.attributes;null!==w&&g(w,a.ELEMENT_ARRAY_BUFFER);for(var J in F)g(F[J],a.ARRAY_BUFFER);w=z.morphAttributes;for(J in w){F=w[J];for(var M=0,R=F.length;M<R;M++)g(F[M],a.ARRAY_BUFFER)}return z}}}function gc(a,c,d,g,u,w,z){function F(aa,qa){if(aa.width>qa||aa.height>qa){qa/=Math.max(aa.width,aa.height);var oa=document.createElementNS("http://www.w3.org/1999/xhtml",
"canvas");oa.width=Math.floor(aa.width*qa);oa.height=Math.floor(aa.height*qa);oa.getContext("2d").drawImage(aa,0,0,aa.width,aa.height,0,0,oa.width,oa.height);console.warn("THREE.WebGLRenderer: image is too big ("+aa.width+"x"+aa.height+"). Resized to "+oa.width+"x"+oa.height,aa);return oa}return aa}function J(aa){return Bb.isPowerOfTwo(aa.width)&&Bb.isPowerOfTwo(aa.height)}function M(aa){return 1003===aa||1004===aa||1005===aa?a.NEAREST:a.LINEAR}function R(aa){aa=aa.target;aa.removeEventListener("dispose",
R);a:{var qa=g.get(aa);if(aa.image&&qa.__image__webglTextureCube)a.deleteTexture(qa.__image__webglTextureCube);else{if(void 0===qa.__webglInit)break a;a.deleteTexture(qa.__webglTexture)}g.delete(aa)}na.textures--}function O(aa){aa=aa.target;aa.removeEventListener("dispose",O);var qa=g.get(aa),oa=g.get(aa.texture);if(aa){void 0!==oa.__webglTexture&&a.deleteTexture(oa.__webglTexture);aa.depthTexture&&aa.depthTexture.dispose();if(aa.isWebGLRenderTargetCube)for(oa=0;6>oa;oa++)a.deleteFramebuffer(qa.__webglFramebuffer[oa]),
qa.__webglDepthbuffer&&a.deleteRenderbuffer(qa.__webglDepthbuffer[oa]);else a.deleteFramebuffer(qa.__webglFramebuffer),qa.__webglDepthbuffer&&a.deleteRenderbuffer(qa.__webglDepthbuffer);g.delete(aa.texture);g.delete(aa)}na.textures--}function Q(aa,qa){var oa=g.get(aa);if(0<aa.version&&oa.__version!==aa.version){var wa=aa.image;if(void 0===wa)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",aa);else if(!1===wa.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",
aa);else{void 0===oa.__webglInit&&(oa.__webglInit=!0,aa.addEventListener("dispose",R),oa.__webglTexture=a.createTexture(),na.textures++);d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_2D,oa.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,aa.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,aa.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,aa.unpackAlignment);var ta=F(aa.image,u.maxTextureSize);(1001!==aa.wrapS||1001!==aa.wrapT||1003!==aa.minFilter&&1006!==aa.minFilter)&&!1===J(ta)&&
(qa=ta,qa instanceof HTMLImageElement||qa instanceof HTMLCanvasElement?(wa=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),wa.width=Bb.nearestPowerOfTwo(qa.width),wa.height=Bb.nearestPowerOfTwo(qa.height),wa.getContext("2d").drawImage(qa,0,0,wa.width,wa.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+qa.width+"x"+qa.height+"). Resized to "+wa.width+"x"+wa.height,qa),ta=wa):ta=qa);qa=J(ta);wa=w(aa.format);var za=w(aa.type);W(a.TEXTURE_2D,aa,qa);var Ja=aa.mipmaps;
if(aa.isDepthTexture){Ja=a.DEPTH_COMPONENT;if(1015===aa.type){if(!ra)throw Error("Float Depth Texture only supported in WebGL2.0");Ja=a.DEPTH_COMPONENT32F}else ra&&(Ja=a.DEPTH_COMPONENT16);1026===aa.format&&Ja===a.DEPTH_COMPONENT&&1012!==aa.type&&1014!==aa.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),aa.type=1012,za=w(aa.type));1027===aa.format&&(Ja=a.DEPTH_STENCIL,1020!==aa.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),
aa.type=1020,za=w(aa.type)));d.texImage2D(a.TEXTURE_2D,0,Ja,ta.width,ta.height,0,wa,za,null)}else if(aa.isDataTexture)if(0<Ja.length&&qa){for(var Ia=0,Oa=Ja.length;Ia<Oa;Ia++)ta=Ja[Ia],d.texImage2D(a.TEXTURE_2D,Ia,wa,ta.width,ta.height,0,wa,za,ta.data);aa.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,wa,ta.width,ta.height,0,wa,za,ta.data);else if(aa.isCompressedTexture)for(Ia=0,Oa=Ja.length;Ia<Oa;Ia++)ta=Ja[Ia],1023!==aa.format&&1022!==aa.format?-1<d.getCompressedTextureFormats().indexOf(wa)?
d.compressedTexImage2D(a.TEXTURE_2D,Ia,wa,ta.width,ta.height,0,ta.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):d.texImage2D(a.TEXTURE_2D,Ia,wa,ta.width,ta.height,0,wa,za,ta.data);else if(0<Ja.length&&qa){Ia=0;for(Oa=Ja.length;Ia<Oa;Ia++)ta=Ja[Ia],d.texImage2D(a.TEXTURE_2D,Ia,wa,wa,za,ta);aa.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,wa,wa,za,ta);aa.generateMipmaps&&qa&&a.generateMipmap(a.TEXTURE_2D);oa.__version=aa.version;
if(aa.onUpdate)aa.onUpdate(aa);return}}d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_2D,oa.__webglTexture)}function W(aa,qa,oa){oa?(a.texParameteri(aa,a.TEXTURE_WRAP_S,w(qa.wrapS)),a.texParameteri(aa,a.TEXTURE_WRAP_T,w(qa.wrapT)),a.texParameteri(aa,a.TEXTURE_MAG_FILTER,w(qa.magFilter)),a.texParameteri(aa,a.TEXTURE_MIN_FILTER,w(qa.minFilter))):(a.texParameteri(aa,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(aa,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===qa.wrapS&&1001===qa.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",
qa),a.texParameteri(aa,a.TEXTURE_MAG_FILTER,M(qa.magFilter)),a.texParameteri(aa,a.TEXTURE_MIN_FILTER,M(qa.minFilter)),1003!==qa.minFilter&&1006!==qa.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",qa));!(oa=c.get("EXT_texture_filter_anisotropic"))||1015===qa.type&&null===c.get("OES_texture_float_linear")||1016===qa.type&&null===c.get("OES_texture_half_float_linear")||!(1<qa.anisotropy||g.get(qa).__currentAnisotropy)||
(a.texParameterf(aa,oa.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(qa.anisotropy,u.getMaxAnisotropy())),g.get(qa).__currentAnisotropy=qa.anisotropy)}function ca(aa,qa,oa,wa){var ta=w(qa.texture.format),za=w(qa.texture.type);d.texImage2D(wa,0,ta,qa.width,qa.height,0,ta,za,null);a.bindFramebuffer(a.FRAMEBUFFER,aa);a.framebufferTexture2D(a.FRAMEBUFFER,oa,wa,g.get(qa.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function ea(aa,qa){a.bindRenderbuffer(a.RENDERBUFFER,aa);qa.depthBuffer&&!qa.stencilBuffer?
(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,qa.width,qa.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,aa)):qa.depthBuffer&&qa.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,qa.width,qa.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,aa)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,qa.width,qa.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var na=z.memory,ra="undefined"!==typeof WebGL2RenderingContext&&
a instanceof WebGL2RenderingContext;this.setTexture2D=Q;this.setTextureCube=function(aa,qa){var oa=g.get(aa);if(6===aa.image.length)if(0<aa.version&&oa.__version!==aa.version){oa.__image__webglTextureCube||(aa.addEventListener("dispose",R),oa.__image__webglTextureCube=a.createTexture(),na.textures++);d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_CUBE_MAP,oa.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,aa.flipY);qa=aa&&aa.isCompressedTexture;for(var wa=aa.image[0]&&aa.image[0].isDataTexture,
ta=[],za=0;6>za;za++)ta[za]=qa||wa?wa?aa.image[za].image:aa.image[za]:F(aa.image[za],u.maxCubemapSize);var Ja=J(ta[0]),Ia=w(aa.format),Oa=w(aa.type);W(a.TEXTURE_CUBE_MAP,aa,Ja);for(za=0;6>za;za++)if(qa)for(var Ua,Na=ta[za].mipmaps,Sa=0,ab=Na.length;Sa<ab;Sa++)Ua=Na[Sa],1023!==aa.format&&1022!==aa.format?-1<d.getCompressedTextureFormats().indexOf(Ia)?d.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+za,Sa,Ia,Ua.width,Ua.height,0,Ua.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):
d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+za,Sa,Ia,Ua.width,Ua.height,0,Ia,Oa,Ua.data);else wa?d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+za,0,Ia,ta[za].width,ta[za].height,0,Ia,Oa,ta[za].data):d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+za,0,Ia,Ia,Oa,ta[za]);aa.generateMipmaps&&Ja&&a.generateMipmap(a.TEXTURE_CUBE_MAP);oa.__version=aa.version;if(aa.onUpdate)aa.onUpdate(aa)}else d.activeTexture(a.TEXTURE0+qa),d.bindTexture(a.TEXTURE_CUBE_MAP,oa.__image__webglTextureCube)};this.setTextureCubeDynamic=
function(aa,qa){d.activeTexture(a.TEXTURE0+qa);d.bindTexture(a.TEXTURE_CUBE_MAP,g.get(aa).__webglTexture)};this.setupRenderTarget=function(aa){var qa=g.get(aa),oa=g.get(aa.texture);aa.addEventListener("dispose",O);oa.__webglTexture=a.createTexture();na.textures++;var wa=!0===aa.isWebGLRenderTargetCube,ta=J(aa);if(wa){qa.__webglFramebuffer=[];for(var za=0;6>za;za++)qa.__webglFramebuffer[za]=a.createFramebuffer()}else qa.__webglFramebuffer=a.createFramebuffer();if(wa){d.bindTexture(a.TEXTURE_CUBE_MAP,
oa.__webglTexture);W(a.TEXTURE_CUBE_MAP,aa.texture,ta);for(za=0;6>za;za++)ca(qa.__webglFramebuffer[za],aa,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+za);aa.texture.generateMipmaps&&ta&&a.generateMipmap(a.TEXTURE_CUBE_MAP);d.bindTexture(a.TEXTURE_CUBE_MAP,null)}else d.bindTexture(a.TEXTURE_2D,oa.__webglTexture),W(a.TEXTURE_2D,aa.texture,ta),ca(qa.__webglFramebuffer,aa,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),aa.texture.generateMipmaps&&ta&&a.generateMipmap(a.TEXTURE_2D),d.bindTexture(a.TEXTURE_2D,
null);if(aa.depthBuffer){qa=g.get(aa);oa=!0===aa.isWebGLRenderTargetCube;if(aa.depthTexture){if(oa)throw Error("target.depthTexture not supported in Cube render targets");if(aa&&aa.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,qa.__webglFramebuffer);if(!aa.depthTexture||!aa.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");g.get(aa.depthTexture).__webglTexture&&
aa.depthTexture.image.width===aa.width&&aa.depthTexture.image.height===aa.height||(aa.depthTexture.image.width=aa.width,aa.depthTexture.image.height=aa.height,aa.depthTexture.needsUpdate=!0);Q(aa.depthTexture,0);qa=g.get(aa.depthTexture).__webglTexture;if(1026===aa.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,qa,0);else if(1027===aa.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,qa,0);else throw Error("Unknown depthTexture format");
}else if(oa)for(qa.__webglDepthbuffer=[],oa=0;6>oa;oa++)a.bindFramebuffer(a.FRAMEBUFFER,qa.__webglFramebuffer[oa]),qa.__webglDepthbuffer[oa]=a.createRenderbuffer(),ea(qa.__webglDepthbuffer[oa],aa);else a.bindFramebuffer(a.FRAMEBUFFER,qa.__webglFramebuffer),qa.__webglDepthbuffer=a.createRenderbuffer(),ea(qa.__webglDepthbuffer,aa);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(aa){var qa=aa.texture;qa.generateMipmaps&&J(aa)&&1003!==qa.minFilter&&1006!==qa.minFilter&&
(aa=aa&&aa.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,qa=g.get(qa).__webglTexture,d.bindTexture(aa,qa),a.generateMipmap(aa),d.bindTexture(aa,null))}}function Kc(){var a={};return{get:function(c){c=c.uuid;var d=a[c];void 0===d&&(d={},a[c]=d);return d},delete:function(c){delete a[c.uuid]},clear:function(){a={}}}}function qc(a,c,d){function g(Ca,mb,pb){var ub=new Uint8Array(4),fb=a.createTexture();a.bindTexture(Ca,fb);a.texParameteri(Ca,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(Ca,
a.TEXTURE_MAG_FILTER,a.NEAREST);for(Ca=0;Ca<pb;Ca++)a.texImage2D(mb+Ca,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,ub);return fb}function u(Ca){!0!==aa[Ca]&&(a.enable(Ca),aa[Ca]=!0)}function w(Ca){!1!==aa[Ca]&&(a.disable(Ca),aa[Ca]=!1)}function z(Ca,mb,pb,ub,fb,Cb,Fb,Kb){0!==Ca?u(a.BLEND):w(a.BLEND);if(Ca!==oa||Kb!==Ua)2===Ca?Kb?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===Ca?Kb?(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===Ca?Kb?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):Kb?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),oa=Ca,Ua=Kb;if(5===Ca){fb=fb||mb;Cb=Cb||pb;Fb=Fb||ub;if(mb!==wa||fb!==Ja)a.blendEquationSeparate(d(mb),d(fb)),wa=mb,Ja=fb;if(pb!==ta||ub!==za||Cb!==Ia||Fb!==Oa)a.blendFuncSeparate(d(pb),d(ub),d(Cb),d(Fb)),ta=pb,za=ub,Ia=Cb,Oa=Fb}else Oa=Ia=Ja=za=ta=wa=null}function F(Ca){Q.setFunc(Ca)}function J(Ca){Na!==Ca&&(Ca?a.frontFace(a.CW):a.frontFace(a.CCW),Na=Ca)}function M(Ca){0!==Ca?(u(a.CULL_FACE),Ca!==Sa&&
(1===Ca?a.cullFace(a.BACK):2===Ca?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):w(a.CULL_FACE);Sa=Ca}function R(Ca){void 0===Ca&&(Ca=a.TEXTURE0+Ka-1);Wa!==Ca&&(a.activeTexture(Ca),Wa=Ca)}var O=new function(){var Ca=!1,mb=new r,pb=null,ub=new r;return{setMask:function(fb){pb===fb||Ca||(a.colorMask(fb,fb,fb,fb),pb=fb)},setLocked:function(fb){Ca=fb},setClear:function(fb,Cb,Fb,Kb,Vb){!0===Vb&&(fb*=Kb,Cb*=Kb,Fb*=Kb);mb.set(fb,Cb,Fb,Kb);!1===ub.equals(mb)&&(a.clearColor(fb,Cb,Fb,Kb),ub.copy(mb))},
reset:function(){Ca=!1;pb=null;ub.set(0,0,0,1)}}},Q=new function(){var Ca=!1,mb=null,pb=null,ub=null;return{setTest:function(fb){fb?u(a.DEPTH_TEST):w(a.DEPTH_TEST)},setMask:function(fb){mb===fb||Ca||(a.depthMask(fb),mb=fb)},setFunc:function(fb){if(pb!==fb){if(fb)switch(fb){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);
break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);pb=fb}},setLocked:function(fb){Ca=fb},setClear:function(fb){ub!==fb&&(a.clearDepth(fb),ub=fb)},reset:function(){Ca=!1;ub=pb=mb=null}}},W=new function(){var Ca=!1,mb=null,pb=null,ub=null,fb=null,Cb=null,Fb=null,Kb=null,Vb=null;return{setTest:function(Yb){Yb?u(a.STENCIL_TEST):w(a.STENCIL_TEST)},setMask:function(Yb){mb===Yb||Ca||(a.stencilMask(Yb),mb=Yb)},setFunc:function(Yb,Qc,yc){if(pb!==Yb||ub!==Qc||
fb!==yc)a.stencilFunc(Yb,Qc,yc),pb=Yb,ub=Qc,fb=yc},setOp:function(Yb,Qc,yc){if(Cb!==Yb||Fb!==Qc||Kb!==yc)a.stencilOp(Yb,Qc,yc),Cb=Yb,Fb=Qc,Kb=yc},setLocked:function(Yb){Ca=Yb},setClear:function(Yb){Vb!==Yb&&(a.clearStencil(Yb),Vb=Yb)},reset:function(){Ca=!1;Vb=Kb=Fb=Cb=fb=ub=pb=mb=null}}},ca=a.getParameter(a.MAX_VERTEX_ATTRIBS),ea=new Uint8Array(ca),na=new Uint8Array(ca),ra=new Uint8Array(ca),aa={},qa=null,oa=null,wa=null,ta=null,za=null,Ja=null,Ia=null,Oa=null,Ua=!1,Na=null,Sa=null,ab=null,Pa=null,
Ma=null,Xa=null,Ka=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);ca=parseFloat(/^WebGL ([0-9])/.exec(a.getParameter(a.VERSION))[1]);var gb=1<=parseFloat(ca),Wa=null,sb={},yb=new r,Jb=new r,nb={};nb[a.TEXTURE_2D]=g(a.TEXTURE_2D,a.TEXTURE_2D,1);nb[a.TEXTURE_CUBE_MAP]=g(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:O,depth:Q,stencil:W},init:function(){O.setClear(0,0,0,1);Q.setClear(1);W.setClear(0);u(a.DEPTH_TEST);F(3);J(!1);M(1);u(a.CULL_FACE);u(a.BLEND);z(1)},initAttributes:function(){for(var Ca=
0,mb=ea.length;Ca<mb;Ca++)ea[Ca]=0},enableAttribute:function(Ca){ea[Ca]=1;0===na[Ca]&&(a.enableVertexAttribArray(Ca),na[Ca]=1);0!==ra[Ca]&&(c.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ca,0),ra[Ca]=0)},enableAttributeAndDivisor:function(Ca,mb,pb){ea[Ca]=1;0===na[Ca]&&(a.enableVertexAttribArray(Ca),na[Ca]=1);ra[Ca]!==mb&&(pb.vertexAttribDivisorANGLE(Ca,mb),ra[Ca]=mb)},disableUnusedAttributes:function(){for(var Ca=0,mb=na.length;Ca!==mb;++Ca)na[Ca]!==ea[Ca]&&(a.disableVertexAttribArray(Ca),
na[Ca]=0)},enable:u,disable:w,getCompressedTextureFormats:function(){if(null===qa&&(qa=[],c.get("WEBGL_compressed_texture_pvrtc")||c.get("WEBGL_compressed_texture_s3tc")||c.get("WEBGL_compressed_texture_etc1")))for(var Ca=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),mb=0;mb<Ca.length;mb++)qa.push(Ca[mb]);return qa},setBlending:z,setColorWrite:function(Ca){O.setMask(Ca)},setDepthTest:function(Ca){Q.setTest(Ca)},setDepthWrite:function(Ca){Q.setMask(Ca)},setDepthFunc:F,setStencilTest:function(Ca){W.setTest(Ca)},
setStencilWrite:function(Ca){W.setMask(Ca)},setStencilFunc:function(Ca,mb,pb){W.setFunc(Ca,mb,pb)},setStencilOp:function(Ca,mb,pb){W.setOp(Ca,mb,pb)},setFlipSided:J,setCullFace:M,setLineWidth:function(Ca){Ca!==ab&&(gb&&a.lineWidth(Ca),ab=Ca)},setPolygonOffset:function(Ca,mb,pb){if(Ca){if(u(a.POLYGON_OFFSET_FILL),Pa!==mb||Ma!==pb)a.polygonOffset(mb,pb),Pa=mb,Ma=pb}else w(a.POLYGON_OFFSET_FILL)},getScissorTest:function(){return Xa},setScissorTest:function(Ca){(Xa=Ca)?u(a.SCISSOR_TEST):w(a.SCISSOR_TEST)},
activeTexture:R,bindTexture:function(Ca,mb){null===Wa&&R();var pb=sb[Wa];void 0===pb&&(pb={type:void 0,texture:void 0},sb[Wa]=pb);if(pb.type!==Ca||pb.texture!==mb)a.bindTexture(Ca,mb||nb[Ca]),pb.type=Ca,pb.texture=mb},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Ca){console.error(Ca)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(Ca){console.error(Ca)}},scissor:function(Ca){!1===yb.equals(Ca)&&(a.scissor(Ca.x,Ca.y,Ca.z,Ca.w),yb.copy(Ca))},
viewport:function(Ca){!1===Jb.equals(Ca)&&(a.viewport(Ca.x,Ca.y,Ca.z,Ca.w),Jb.copy(Ca))},reset:function(){for(var Ca=0;Ca<na.length;Ca++)1===na[Ca]&&(a.disableVertexAttribArray(Ca),na[Ca]=0);aa={};Wa=qa=null;sb={};Sa=Na=oa=null;O.reset();Q.reset();W.reset()}}}function Gc(a,c,d){function g(na){if("highp"===na){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";na="mediump"}return"mediump"===na&&
0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var u,w=void 0!==d.precision?d.precision:"highp",z=g(w);z!==w&&(console.warn("THREE.WebGLRenderer:",w,"not supported, using",z,"instead."),w=z);d=!0===d.logarithmicDepthBuffer&&!!c.get("EXT_frag_depth");z=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var F=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),J=a.getParameter(a.MAX_TEXTURE_SIZE),
M=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),R=a.getParameter(a.MAX_VERTEX_ATTRIBS),O=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),Q=a.getParameter(a.MAX_VARYING_VECTORS),W=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),ca=0<F,ea=!!c.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==u)return u;var na=c.get("EXT_texture_filter_anisotropic");return u=null!==na?a.getParameter(na.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:g,precision:w,logarithmicDepthBuffer:d,maxTextures:z,
maxVertexTextures:F,maxTextureSize:J,maxCubemapSize:M,maxAttributes:R,maxVertexUniforms:O,maxVaryings:Q,maxFragmentUniforms:W,vertexTextures:ca,floatFragmentTextures:ea,floatVertexTextures:ca&&ea}}function gd(a){var c={};return{get:function(d){if(void 0!==c[d])return c[d];switch(d){case "WEBGL_depth_texture":var g=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":g=a.getExtension("EXT_texture_filter_anisotropic")||
a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":g=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":g=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":g=
a.getExtension("WEBGL_compressed_texture_etc1");break;default:g=a.getExtension(d)}null===g&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported.");return c[d]=g}}}function df(){function a(){M.value!==g&&(M.value=g,M.needsUpdate=0<u);d.numPlanes=u;d.numIntersection=0}function c(R,O,Q,W){var ca=null!==R?R.length:0,ea=null;if(0!==ca){ea=M.value;if(!0!==W||null===ea){W=Q+4*ca;O=O.matrixWorldInverse;J.getNormalMatrix(O);if(null===ea||ea.length<W)ea=new Float32Array(W);for(W=0;W!==ca;++W,Q+=
4)F.copy(R[W]).applyMatrix4(O,J),F.normal.toArray(ea,Q),ea[Q+3]=F.constant}M.value=ea;M.needsUpdate=!0}d.numPlanes=ca;return ea}var d=this,g=null,u=0,w=!1,z=!1,F=new Qb,J=new Pb,M={value:null,needsUpdate:!1};this.uniform=M;this.numIntersection=this.numPlanes=0;this.init=function(R,O,Q){var W=0!==R.length||O||0!==u||w;w=O;g=c(R,Q,0);u=R.length;return W};this.beginShadows=function(){z=!0;c(null)};this.endShadows=function(){z=!1;a()};this.setState=function(R,O,Q,W,ca,ea){if(!w||null===R||0===R.length||
z&&!Q)z?c(null):a();else{Q=z?0:u;var na=4*Q,ra=ca.clippingState||null;M.value=ra;ra=c(R,W,na,ea);for(R=0;R!==na;++R)ra[R]=g[R];ca.clippingState=ra;this.numIntersection=O?this.numPlanes:0;this.numPlanes+=Q}}}function Mf(a){function c(){xb.init();xb.scissor(Ca.copy(Yb).multiplyScalar(Vb));xb.viewport(pb.copy(yc).multiplyScalar(Vb));xb.buffers.color.setClear(fb.r,fb.g,fb.b,Cb,Ja)}function d(){nb=gb=null;Jb="";yb=-1;xb.reset()}function g(ha){ha.preventDefault();d();c();zc.clear()}function u(ha){ha=ha.target;
ha.removeEventListener("dispose",u);w(ha);zc.delete(ha)}function w(ha){var va=zc.get(ha).program;ha.program=void 0;void 0!==va&&te.releaseProgram(va)}function z(ha,va){return Math.abs(va[0])-Math.abs(ha[0])}function F(ha,va){return ha.object.renderOrder!==va.object.renderOrder?ha.object.renderOrder-va.object.renderOrder:ha.material.program&&va.material.program&&ha.material.program!==va.material.program?ha.material.program.id-va.material.program.id:ha.material.id!==va.material.id?ha.material.id-va.material.id:
ha.z!==va.z?ha.z-va.z:ha.id-va.id}function J(ha,va){return ha.object.renderOrder!==va.object.renderOrder?ha.object.renderOrder-va.object.renderOrder:ha.z!==va.z?va.z-ha.z:ha.id-va.id}function M(ha,va,sa,eb,ib){if(sa.transparent){eb=Sa;var qb=++ab}else eb=Ua,qb=++Na;qb=eb[qb];void 0!==qb?(qb.id=ha.id,qb.object=ha,qb.geometry=va,qb.material=sa,qb.z=mc.z,qb.group=ib):(qb={id:ha.id,object:ha,geometry:va,material:sa,z:mc.z,group:ib},eb.push(qb))}function R(ha){if(!rg.intersectsSphere(ha))return!1;var va=
Hc.numPlanes;if(0===va)return!0;var sa=Ka.clippingPlanes,eb=ha.center;ha=-ha.radius;var ib=0;do if(sa[ib].distanceToPoint(eb)<ha)return!1;while(++ib!==va);return!0}function O(ha,va){if(!1!==ha.visible){if(0!==(ha.layers.mask&va.layers.mask))if(ha.isLight)Oa.push(ha);else if(ha.isSprite){var sa;(sa=!1===ha.frustumCulled)||(Id.center.set(0,0,0),Id.radius=.7071067811865476,Id.applyMatrix4(ha.matrixWorld),sa=!0===R(Id));sa&&Ma.push(ha)}else if(ha.isLensFlare)Xa.push(ha);else if(ha.isImmediateRenderObject)!0===
Ka.sortObjects&&(mc.setFromMatrixPosition(ha.matrixWorld),mc.applyProjection(ef)),M(ha,null,ha.material,mc.z,null);else if(ha.isMesh||ha.isLine||ha.isPoints)if(ha.isSkinnedMesh&&ha.skeleton.update(),(sa=!1===ha.frustumCulled)||(sa=ha.geometry,null===sa.boundingSphere&&sa.computeBoundingSphere(),Id.copy(sa.boundingSphere).applyMatrix4(ha.matrixWorld),sa=!0===R(Id)),sa){var eb=ha.material;if(!0===eb.visible)if(!0===Ka.sortObjects&&(mc.setFromMatrixPosition(ha.matrixWorld),mc.applyProjection(ef)),sa=
hd.update(ha),eb.isMultiMaterial){var ib=sa.groups,qb=eb.materials;eb=0;for(var Ya=ib.length;eb<Ya;eb++){var Aa=ib[eb],vb=qb[Aa.materialIndex];!0===vb.visible&&M(ha,sa,vb,mc.z,Aa)}}else M(ha,sa,eb,mc.z,null)}ha=ha.children;eb=0;for(Ya=ha.length;eb<Ya;eb++)O(ha[eb],va)}}function Q(ha,va,sa,eb){for(var ib=0,qb=ha.length;ib<qb;ib++){var Ya=ha[ib],Aa=Ya.object,vb=Ya.geometry,Lb=void 0===eb?Ya.material:eb;Ya=Ya.group;Aa.modelViewMatrix.multiplyMatrices(sa.matrixWorldInverse,Aa.matrixWorld);Aa.normalMatrix.getNormalMatrix(Aa.modelViewMatrix);
Aa.onBeforeRender(Ka,va,sa,vb,Lb,Ya);if(Aa.isImmediateRenderObject){W(Lb);var Zb=ca(sa,va.fog,Lb,Aa);Jb="";Aa.render(function(Hb){Ka.renderBufferImmediate(Hb,Zb,Lb)})}else Ka.renderBufferDirect(sa,va.fog,vb,Lb,Aa,Ya);Aa.onAfterRender(Ka,va,sa,vb,Lb,Ya)}}function W(ha){2===ha.side?xb.disable(Fa.CULL_FACE):xb.enable(Fa.CULL_FACE);xb.setFlipSided(1===ha.side);!0===ha.transparent?xb.setBlending(ha.blending,ha.blendEquation,ha.blendSrc,ha.blendDst,ha.blendEquationAlpha,ha.blendSrcAlpha,ha.blendDstAlpha,
ha.premultipliedAlpha):xb.setBlending(0);xb.setDepthFunc(ha.depthFunc);xb.setDepthTest(ha.depthTest);xb.setDepthWrite(ha.depthWrite);xb.setColorWrite(ha.colorWrite);xb.setPolygonOffset(ha.polygonOffset,ha.polygonOffsetFactor,ha.polygonOffsetUnits)}function ca(ha,va,sa,eb){ub=0;var ib=zc.get(sa);ff&&(Nf||ha!==nb)&&Hc.setState(sa.clippingPlanes,sa.clipIntersection,sa.clipShadows,ha,ib,ha===nb&&sa.id===yb);!1===sa.needsUpdate&&(void 0===ib.program?sa.needsUpdate=!0:sa.fog&&ib.fog!==va?sa.needsUpdate=
!0:sa.lights&&ib.lightsHash!==Eb.hash?sa.needsUpdate=!0:void 0===ib.numClippingPlanes||ib.numClippingPlanes===Hc.numPlanes&&ib.numIntersection===Hc.numIntersection||(sa.needsUpdate=!0));if(sa.needsUpdate){a:{var qb=zc.get(sa),Ya=te.getParameters(sa,Eb,va,Hc.numPlanes,Hc.numIntersection,eb),Aa=te.getProgramCode(sa,Ya),vb=qb.program,Lb=!0;if(void 0===vb)sa.addEventListener("dispose",u);else if(vb.code!==Aa)w(sa);else if(void 0!==Ya.shaderID)break a;else Lb=!1;Lb&&(Ya.shaderID?(vb=Gd[Ya.shaderID],qb.__webglShader=
{name:sa.type,uniforms:rc.clone(vb.uniforms),vertexShader:vb.vertexShader,fragmentShader:vb.fragmentShader}):qb.__webglShader={name:sa.type,uniforms:sa.uniforms,vertexShader:sa.vertexShader,fragmentShader:sa.fragmentShader},sa.__webglShader=qb.__webglShader,vb=te.acquireProgram(sa,Ya,Aa),qb.program=vb,sa.program=vb);Ya=vb.getAttributes();if(sa.morphTargets)for(Aa=sa.numSupportedMorphTargets=0;Aa<Ka.maxMorphTargets;Aa++)0<=Ya["morphTarget"+Aa]&&sa.numSupportedMorphTargets++;if(sa.morphNormals)for(Aa=
sa.numSupportedMorphNormals=0;Aa<Ka.maxMorphNormals;Aa++)0<=Ya["morphNormal"+Aa]&&sa.numSupportedMorphNormals++;Ya=qb.__webglShader.uniforms;if(!sa.isShaderMaterial&&!sa.isRawShaderMaterial||!0===sa.clipping)qb.numClippingPlanes=Hc.numPlanes,qb.numIntersection=Hc.numIntersection,Ya.clippingPlanes=Hc.uniform;qb.fog=va;qb.lightsHash=Eb.hash;sa.lights&&(Ya.ambientLightColor.value=Eb.ambient,Ya.directionalLights.value=Eb.directional,Ya.spotLights.value=Eb.spot,Ya.rectAreaLights.value=Eb.rectArea,Ya.pointLights.value=
Eb.point,Ya.hemisphereLights.value=Eb.hemi,Ya.directionalShadowMap.value=Eb.directionalShadowMap,Ya.directionalShadowMatrix.value=Eb.directionalShadowMatrix,Ya.spotShadowMap.value=Eb.spotShadowMap,Ya.spotShadowMatrix.value=Eb.spotShadowMatrix,Ya.pointShadowMap.value=Eb.pointShadowMap,Ya.pointShadowMatrix.value=Eb.pointShadowMatrix);Aa=qb.program.getUniforms();Ya=pa.seqWithValue(Aa.seq,Ya);qb.uniformsList=Ya}sa.needsUpdate=!1}var Zb=!1;Lb=vb=!1;qb=ib.program;Ya=qb.getUniforms();Aa=ib.__webglShader.uniforms;
qb.id!==gb&&(Fa.useProgram(qb.program),gb=qb.id,Lb=vb=Zb=!0);sa.id!==yb&&(yb=sa.id,vb=!0);if(Zb||ha!==nb){Ya.set(Fa,ha,"projectionMatrix");Rc.logarithmicDepthBuffer&&Ya.setValue(Fa,"logDepthBufFC",2/(Math.log(ha.far+1)/Math.LN2));ha!==nb&&(nb=ha,Lb=vb=!0);if(sa.isShaderMaterial||sa.isMeshPhongMaterial||sa.isMeshStandardMaterial||sa.envMap)Zb=Ya.map.cameraPosition,void 0!==Zb&&Zb.setValue(Fa,mc.setFromMatrixPosition(ha.matrixWorld));(sa.isMeshPhongMaterial||sa.isMeshLambertMaterial||sa.isMeshBasicMaterial||
sa.isMeshStandardMaterial||sa.isShaderMaterial||sa.skinning)&&Ya.setValue(Fa,"viewMatrix",ha.matrixWorldInverse);Ya.set(Fa,Ka,"toneMappingExposure");Ya.set(Fa,Ka,"toneMappingWhitePoint")}sa.skinning&&(Ya.setOptional(Fa,eb,"bindMatrix"),Ya.setOptional(Fa,eb,"bindMatrixInverse"),ha=eb.skeleton)&&(Rc.floatVertexTextures&&ha.useVertexTexture?(Ya.set(Fa,ha,"boneTexture"),Ya.set(Fa,ha,"boneTextureWidth"),Ya.set(Fa,ha,"boneTextureHeight")):Ya.setOptional(Fa,ha,"boneMatrices"));if(vb){sa.lights&&(ha=Lb,Aa.ambientLightColor.needsUpdate=
ha,Aa.directionalLights.needsUpdate=ha,Aa.pointLights.needsUpdate=ha,Aa.spotLights.needsUpdate=ha,Aa.rectAreaLights.needsUpdate=ha,Aa.hemisphereLights.needsUpdate=ha);va&&sa.fog&&(Aa.fogColor.value=va.color,va.isFog?(Aa.fogNear.value=va.near,Aa.fogFar.value=va.far):va.isFogExp2&&(Aa.fogDensity.value=va.density));if(sa.isMeshBasicMaterial||sa.isMeshLambertMaterial||sa.isMeshPhongMaterial||sa.isMeshStandardMaterial||sa.isMeshNormalMaterial||sa.isMeshDepthMaterial){Aa.opacity.value=sa.opacity;Aa.diffuse.value=
sa.color;sa.emissive&&Aa.emissive.value.copy(sa.emissive).multiplyScalar(sa.emissiveIntensity);Aa.map.value=sa.map;Aa.specularMap.value=sa.specularMap;Aa.alphaMap.value=sa.alphaMap;sa.lightMap&&(Aa.lightMap.value=sa.lightMap,Aa.lightMapIntensity.value=sa.lightMapIntensity);sa.aoMap&&(Aa.aoMap.value=sa.aoMap,Aa.aoMapIntensity.value=sa.aoMapIntensity);if(sa.map)var Hb=sa.map;else sa.specularMap?Hb=sa.specularMap:sa.displacementMap?Hb=sa.displacementMap:sa.normalMap?Hb=sa.normalMap:sa.bumpMap?Hb=sa.bumpMap:
sa.roughnessMap?Hb=sa.roughnessMap:sa.metalnessMap?Hb=sa.metalnessMap:sa.alphaMap?Hb=sa.alphaMap:sa.emissiveMap&&(Hb=sa.emissiveMap);void 0!==Hb&&(Hb.isWebGLRenderTarget&&(Hb=Hb.texture),va=Hb.offset,Hb=Hb.repeat,Aa.offsetRepeat.value.set(va.x,va.y,Hb.x,Hb.y));Aa.envMap.value=sa.envMap;Aa.flipEnvMap.value=sa.envMap&&sa.envMap.isCubeTexture?-1:1;Aa.reflectivity.value=sa.reflectivity;Aa.refractionRatio.value=sa.refractionRatio}sa.isLineBasicMaterial?(Aa.diffuse.value=sa.color,Aa.opacity.value=sa.opacity):
sa.isLineDashedMaterial?(Aa.diffuse.value=sa.color,Aa.opacity.value=sa.opacity,Aa.dashSize.value=sa.dashSize,Aa.totalSize.value=sa.dashSize+sa.gapSize,Aa.scale.value=sa.scale):sa.isPointsMaterial?(Aa.diffuse.value=sa.color,Aa.opacity.value=sa.opacity,Aa.size.value=sa.size*Vb,Aa.scale.value=.5*Kb,Aa.map.value=sa.map,null!==sa.map&&(Hb=sa.map.offset,sa=sa.map.repeat,Aa.offsetRepeat.value.set(Hb.x,Hb.y,sa.x,sa.y))):sa.isMeshLambertMaterial?sa.emissiveMap&&(Aa.emissiveMap.value=sa.emissiveMap):sa.isMeshToonMaterial?
(ea(Aa,sa),sa.gradientMap&&(Aa.gradientMap.value=sa.gradientMap)):sa.isMeshPhongMaterial?ea(Aa,sa):sa.isMeshPhysicalMaterial?(Aa.clearCoat.value=sa.clearCoat,Aa.clearCoatRoughness.value=sa.clearCoatRoughness,na(Aa,sa)):sa.isMeshStandardMaterial?na(Aa,sa):sa.isMeshDepthMaterial?sa.displacementMap&&(Aa.displacementMap.value=sa.displacementMap,Aa.displacementScale.value=sa.displacementScale,Aa.displacementBias.value=sa.displacementBias):sa.isMeshNormalMaterial&&(sa.bumpMap&&(Aa.bumpMap.value=sa.bumpMap,
Aa.bumpScale.value=sa.bumpScale),sa.normalMap&&(Aa.normalMap.value=sa.normalMap,Aa.normalScale.value.copy(sa.normalScale)),sa.displacementMap&&(Aa.displacementMap.value=sa.displacementMap,Aa.displacementScale.value=sa.displacementScale,Aa.displacementBias.value=sa.displacementBias));void 0!==Aa.ltcMat&&(Aa.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE);void 0!==Aa.ltcMag&&(Aa.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE);pa.upload(Fa,ib.uniformsList,Aa,Ka)}Ya.set(Fa,eb,"modelViewMatrix");Ya.set(Fa,
eb,"normalMatrix");Ya.setValue(Fa,"modelMatrix",eb.matrixWorld);return qb}function ea(ha,va){ha.specular.value=va.specular;ha.shininess.value=Math.max(va.shininess,1E-4);va.emissiveMap&&(ha.emissiveMap.value=va.emissiveMap);va.bumpMap&&(ha.bumpMap.value=va.bumpMap,ha.bumpScale.value=va.bumpScale);va.normalMap&&(ha.normalMap.value=va.normalMap,ha.normalScale.value.copy(va.normalScale));va.displacementMap&&(ha.displacementMap.value=va.displacementMap,ha.displacementScale.value=va.displacementScale,
ha.displacementBias.value=va.displacementBias)}function na(ha,va){ha.roughness.value=va.roughness;ha.metalness.value=va.metalness;va.roughnessMap&&(ha.roughnessMap.value=va.roughnessMap);va.metalnessMap&&(ha.metalnessMap.value=va.metalnessMap);va.emissiveMap&&(ha.emissiveMap.value=va.emissiveMap);va.bumpMap&&(ha.bumpMap.value=va.bumpMap,ha.bumpScale.value=va.bumpScale);va.normalMap&&(ha.normalMap.value=va.normalMap,ha.normalScale.value.copy(va.normalScale));va.displacementMap&&(ha.displacementMap.value=
va.displacementMap,ha.displacementScale.value=va.displacementScale,ha.displacementBias.value=va.displacementBias);va.envMap&&(ha.envMapIntensity.value=va.envMapIntensity)}function ra(ha){if(1E3===ha)return Fa.REPEAT;if(1001===ha)return Fa.CLAMP_TO_EDGE;if(1002===ha)return Fa.MIRRORED_REPEAT;if(1003===ha)return Fa.NEAREST;if(1004===ha)return Fa.NEAREST_MIPMAP_NEAREST;if(1005===ha)return Fa.NEAREST_MIPMAP_LINEAR;if(1006===ha)return Fa.LINEAR;if(1007===ha)return Fa.LINEAR_MIPMAP_NEAREST;if(1008===ha)return Fa.LINEAR_MIPMAP_LINEAR;
if(1009===ha)return Fa.UNSIGNED_BYTE;if(1017===ha)return Fa.UNSIGNED_SHORT_4_4_4_4;if(1018===ha)return Fa.UNSIGNED_SHORT_5_5_5_1;if(1019===ha)return Fa.UNSIGNED_SHORT_5_6_5;if(1010===ha)return Fa.BYTE;if(1011===ha)return Fa.SHORT;if(1012===ha)return Fa.UNSIGNED_SHORT;if(1013===ha)return Fa.INT;if(1014===ha)return Fa.UNSIGNED_INT;if(1015===ha)return Fa.FLOAT;if(1016===ha){var va=Ub.get("OES_texture_half_float");if(null!==va)return va.HALF_FLOAT_OES}if(1021===ha)return Fa.ALPHA;if(1022===ha)return Fa.RGB;
if(1023===ha)return Fa.RGBA;if(1024===ha)return Fa.LUMINANCE;if(1025===ha)return Fa.LUMINANCE_ALPHA;if(1026===ha)return Fa.DEPTH_COMPONENT;if(1027===ha)return Fa.DEPTH_STENCIL;if(100===ha)return Fa.FUNC_ADD;if(101===ha)return Fa.FUNC_SUBTRACT;if(102===ha)return Fa.FUNC_REVERSE_SUBTRACT;if(200===ha)return Fa.ZERO;if(201===ha)return Fa.ONE;if(202===ha)return Fa.SRC_COLOR;if(203===ha)return Fa.ONE_MINUS_SRC_COLOR;if(204===ha)return Fa.SRC_ALPHA;if(205===ha)return Fa.ONE_MINUS_SRC_ALPHA;if(206===ha)return Fa.DST_ALPHA;
if(207===ha)return Fa.ONE_MINUS_DST_ALPHA;if(208===ha)return Fa.DST_COLOR;if(209===ha)return Fa.ONE_MINUS_DST_COLOR;if(210===ha)return Fa.SRC_ALPHA_SATURATE;if(2001===ha||2002===ha||2003===ha||2004===ha)if(va=Ub.get("WEBGL_compressed_texture_s3tc"),null!==va){if(2001===ha)return va.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===ha)return va.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===ha)return va.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===ha)return va.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(2100===ha||2101===ha||2102===
ha||2103===ha)if(va=Ub.get("WEBGL_compressed_texture_pvrtc"),null!==va){if(2100===ha)return va.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===ha)return va.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===ha)return va.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===ha)return va.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===ha&&(va=Ub.get("WEBGL_compressed_texture_etc1"),null!==va))return va.COMPRESSED_RGB_ETC1_WEBGL;if(103===ha||104===ha)if(va=Ub.get("EXT_blend_minmax"),null!==va){if(103===ha)return va.MIN_EXT;if(104===
ha)return va.MAX_EXT}return 1020===ha&&(va=Ub.get("WEBGL_depth_texture"),null!==va)?va.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","84dev");a=a||{};var aa=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),qa=void 0!==a.context?a.context:null,oa=void 0!==a.alpha?a.alpha:!1,wa=void 0!==a.depth?a.depth:!0,ta=void 0!==a.stencil?a.stencil:!0,za=void 0!==a.antialias?a.antialias:!1,Ja=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,Ia=void 0!==
a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,Oa=[],Ua=[],Na=-1,Sa=[],ab=-1,Pa=new Float32Array(8),Ma=[],Xa=[];this.domElement=aa;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=
4;var Ka=this,gb=null,Wa=null,sb=null,yb=-1,Jb="",nb=null,Ca=new r,mb=null,pb=new r,ub=0,fb=new la(0),Cb=0,Fb=aa.width,Kb=aa.height,Vb=1,Yb=new r(0,0,Fb,Kb),Qc=!1,yc=new r(0,0,Fb,Kb),rg=new Wc,Hc=new df,ff=!1,Nf=!1,Id=new Mb,ef=new y,mc=new p,Of=new y,gf=new y,Eb={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},id={calls:0,vertices:0,
faces:0,points:0};this.info={render:id,memory:{geometries:0,textures:0},programs:null};try{oa={alpha:oa,depth:wa,stencil:ta,antialias:za,premultipliedAlpha:Ja,preserveDrawingBuffer:Ia};var Fa=qa||aa.getContext("webgl",oa)||aa.getContext("experimental-webgl",oa);if(null===Fa){if(null!==aa.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===Fa.getShaderPrecisionFormat&&(Fa.getShaderPrecisionFormat=function(){return{rangeMin:1,
rangeMax:1,precision:1}});aa.addEventListener("webglcontextlost",g,!1)}catch(ha){console.error("THREE.WebGLRenderer: "+ha)}var Ub=new gd(Fa);Ub.get("WEBGL_depth_texture");Ub.get("OES_texture_float");Ub.get("OES_texture_float_linear");Ub.get("OES_texture_half_float");Ub.get("OES_texture_half_float_linear");Ub.get("OES_standard_derivatives");Ub.get("ANGLE_instanced_arrays");Ub.get("OES_element_index_uint")&&(ob.MaxIndex=4294967296);var Rc=new Gc(Fa,Ub,a),xb=new qc(Fa,Ub,ra),zc=new Kc,Jd=new gc(Fa,Ub,
xb,zc,Rc,ra,this.info),hd=new fc(Fa,zc,this.info),te=new lb(this,Rc),ue=new Ha;this.info.programs=te.programs;var Fg=new Ta(Fa,Ub,id),Gg=new Qa(Fa,Ub,id),Hg=new Da(-1,1,1,-1,0,1),Kd=new ua,ve=new Sb(new pc(2,2),new jc({depthTest:!1,depthWrite:!1,fog:!1}));a=Gd.cube;var jd=new Sb(new Pc(5,5,5),new kb({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}));c();this.context=Fa;this.capabilities=Rc;this.extensions=Ub;this.properties=
zc;this.state=xb;var sg=new cd(this,Eb,hd,Rc);this.shadowMap=sg;var Ig=new Ga(this,Ma),Jg=new ya(this,Xa);this.getContext=function(){return Fa};this.getContextAttributes=function(){return Fa.getContextAttributes()};this.forceContextLoss=function(){Ub.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return Rc.getMaxAnisotropy()};this.getPrecision=function(){return Rc.precision};this.getPixelRatio=function(){return Vb};this.setPixelRatio=function(ha){void 0!==ha&&(Vb=ha,this.setSize(yc.z,
yc.w,!1))};this.getSize=function(){return{width:Fb,height:Kb}};this.setSize=function(ha,va,sa){Fb=ha;Kb=va;aa.width=ha*Vb;aa.height=va*Vb;!1!==sa&&(aa.style.width=ha+"px",aa.style.height=va+"px");this.setViewport(0,0,ha,va)};this.setViewport=function(ha,va,sa,eb){xb.viewport(yc.set(ha,va,sa,eb))};this.setScissor=function(ha,va,sa,eb){xb.scissor(Yb.set(ha,va,sa,eb))};this.setScissorTest=function(ha){xb.setScissorTest(Qc=ha)};this.getClearColor=function(){return fb};this.setClearColor=function(ha,va){fb.set(ha);
Cb=void 0!==va?va:1;xb.buffers.color.setClear(fb.r,fb.g,fb.b,Cb,Ja)};this.getClearAlpha=function(){return Cb};this.setClearAlpha=function(ha){Cb=ha;xb.buffers.color.setClear(fb.r,fb.g,fb.b,Cb,Ja)};this.clear=function(ha,va,sa){var eb=0;if(void 0===ha||ha)eb|=Fa.COLOR_BUFFER_BIT;if(void 0===va||va)eb|=Fa.DEPTH_BUFFER_BIT;if(void 0===sa||sa)eb|=Fa.STENCIL_BUFFER_BIT;Fa.clear(eb)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,
!1,!0)};this.clearTarget=function(ha,va,sa,eb){this.setRenderTarget(ha);this.clear(va,sa,eb)};this.resetGLState=d;this.dispose=function(){Sa=[];ab=-1;Ua=[];Na=-1;aa.removeEventListener("webglcontextlost",g,!1)};this.renderBufferImmediate=function(ha,va,sa){xb.initAttributes();var eb=zc.get(ha);ha.hasPositions&&!eb.position&&(eb.position=Fa.createBuffer());ha.hasNormals&&!eb.normal&&(eb.normal=Fa.createBuffer());ha.hasUvs&&!eb.uv&&(eb.uv=Fa.createBuffer());ha.hasColors&&!eb.color&&(eb.color=Fa.createBuffer());
va=va.getAttributes();ha.hasPositions&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,eb.position),Fa.bufferData(Fa.ARRAY_BUFFER,ha.positionArray,Fa.DYNAMIC_DRAW),xb.enableAttribute(va.position),Fa.vertexAttribPointer(va.position,3,Fa.FLOAT,!1,0,0));if(ha.hasNormals){Fa.bindBuffer(Fa.ARRAY_BUFFER,eb.normal);if(!sa.isMeshPhongMaterial&&!sa.isMeshStandardMaterial&&!sa.isMeshNormalMaterial&&1===sa.shading)for(var ib=0,qb=3*ha.count;ib<qb;ib+=9){var Ya=ha.normalArray,Aa=(Ya[ib+0]+Ya[ib+3]+Ya[ib+6])/3,vb=(Ya[ib+1]+Ya[ib+
4]+Ya[ib+7])/3,Lb=(Ya[ib+2]+Ya[ib+5]+Ya[ib+8])/3;Ya[ib+0]=Aa;Ya[ib+1]=vb;Ya[ib+2]=Lb;Ya[ib+3]=Aa;Ya[ib+4]=vb;Ya[ib+5]=Lb;Ya[ib+6]=Aa;Ya[ib+7]=vb;Ya[ib+8]=Lb}Fa.bufferData(Fa.ARRAY_BUFFER,ha.normalArray,Fa.DYNAMIC_DRAW);xb.enableAttribute(va.normal);Fa.vertexAttribPointer(va.normal,3,Fa.FLOAT,!1,0,0)}ha.hasUvs&&sa.map&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,eb.uv),Fa.bufferData(Fa.ARRAY_BUFFER,ha.uvArray,Fa.DYNAMIC_DRAW),xb.enableAttribute(va.uv),Fa.vertexAttribPointer(va.uv,2,Fa.FLOAT,!1,0,0));ha.hasColors&&
0!==sa.vertexColors&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,eb.color),Fa.bufferData(Fa.ARRAY_BUFFER,ha.colorArray,Fa.DYNAMIC_DRAW),xb.enableAttribute(va.color),Fa.vertexAttribPointer(va.color,3,Fa.FLOAT,!1,0,0));xb.disableUnusedAttributes();Fa.drawArrays(Fa.TRIANGLES,0,ha.count);ha.count=0};this.renderBufferDirect=function(ha,va,sa,eb,ib,qb){W(eb);var Ya=ca(ha,va,eb,ib),Aa=!1;ha=sa.id+"_"+Ya.id+"_"+eb.wireframe;ha!==Jb&&(Jb=ha,Aa=!0);va=ib.morphTargetInfluences;if(void 0!==va){var vb=[];ha=0;for(var Lb=va.length;ha<
Lb;ha++)Aa=va[ha],vb.push([Aa,ha]);vb.sort(z);8<vb.length&&(vb.length=8);var Zb=sa.morphAttributes;ha=0;for(Lb=vb.length;ha<Lb;ha++)Aa=vb[ha],Pa[ha]=Aa[0],0!==Aa[0]?(va=Aa[1],!0===eb.morphTargets&&Zb.position&&sa.addAttribute("morphTarget"+ha,Zb.position[va]),!0===eb.morphNormals&&Zb.normal&&sa.addAttribute("morphNormal"+ha,Zb.normal[va])):(!0===eb.morphTargets&&sa.removeAttribute("morphTarget"+ha),!0===eb.morphNormals&&sa.removeAttribute("morphNormal"+ha));ha=vb.length;for(va=Pa.length;ha<va;ha++)Pa[ha]=
0;Ya.getUniforms().setValue(Fa,"morphTargetInfluences",Pa);Aa=!0}va=sa.index;Lb=sa.attributes.position;vb=1;!0===eb.wireframe&&(va=hd.getWireframeAttribute(sa),vb=2);null!==va?(ha=Gg,ha.setIndex(va)):ha=Fg;if(Aa){a:{Aa=void 0;if(sa&&sa.isInstancedBufferGeometry){var Hb=Ub.get("ANGLE_instanced_arrays");if(null===Hb){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");break a}}void 0===Aa&&(Aa=
0);xb.initAttributes();Zb=sa.attributes;Ya=Ya.getAttributes();var ed=eb.defaultAttributeValues;for(kd in Ya){var hc=Ya[kd];if(0<=hc){var ic=Zb[kd];if(void 0!==ic){var Ac=ic.normalized,ld=ic.itemSize,Bc=hd.getAttributeProperties(ic),Sc=Bc.__webglBuffer,hf=Bc.type;Bc=Bc.bytesPerElement;if(ic.isInterleavedBufferAttribute){var Tc=ic.data,rb=Tc.stride;ic=ic.offset;Tc&&Tc.isInstancedInterleavedBuffer?(xb.enableAttributeAndDivisor(hc,Tc.meshPerAttribute,Hb),void 0===sa.maxInstancedCount&&(sa.maxInstancedCount=
Tc.meshPerAttribute*Tc.count)):xb.enableAttribute(hc);Fa.bindBuffer(Fa.ARRAY_BUFFER,Sc);Fa.vertexAttribPointer(hc,ld,hf,Ac,rb*Bc,(Aa*rb+ic)*Bc)}else ic.isInstancedBufferAttribute?(xb.enableAttributeAndDivisor(hc,ic.meshPerAttribute,Hb),void 0===sa.maxInstancedCount&&(sa.maxInstancedCount=ic.meshPerAttribute*ic.count)):xb.enableAttribute(hc),Fa.bindBuffer(Fa.ARRAY_BUFFER,Sc),Fa.vertexAttribPointer(hc,ld,hf,Ac,0,Aa*ld*Bc)}else if(void 0!==ed&&(Ac=ed[kd],void 0!==Ac))switch(Ac.length){case 2:Fa.vertexAttrib2fv(hc,
Ac);break;case 3:Fa.vertexAttrib3fv(hc,Ac);break;case 4:Fa.vertexAttrib4fv(hc,Ac);break;default:Fa.vertexAttrib1fv(hc,Ac)}}}xb.disableUnusedAttributes()}null!==va&&Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,hd.getAttributeBuffer(va))}Hb=0;null!==va?Hb=va.count:void 0!==Lb&&(Hb=Lb.count);va=sa.drawRange.start*vb;Lb=null!==qb?qb.start*vb:0;var kd=Math.max(va,Lb);qb=Math.max(0,Math.min(Hb,va+sa.drawRange.count*vb,Lb+(null!==qb?qb.count*vb:Infinity))-1-kd+1);if(0!==qb){if(ib.isMesh)if(!0===eb.wireframe)xb.setLineWidth(eb.wireframeLinewidth*
(null===Wa?Vb:1)),ha.setMode(Fa.LINES);else switch(ib.drawMode){case 0:ha.setMode(Fa.TRIANGLES);break;case 1:ha.setMode(Fa.TRIANGLE_STRIP);break;case 2:ha.setMode(Fa.TRIANGLE_FAN)}else ib.isLine?(eb=eb.linewidth,void 0===eb&&(eb=1),xb.setLineWidth(eb*(null===Wa?Vb:1)),ib.isLineSegments?ha.setMode(Fa.LINES):ha.setMode(Fa.LINE_STRIP)):ib.isPoints&&ha.setMode(Fa.POINTS);sa&&sa.isInstancedBufferGeometry?0<sa.maxInstancedCount&&ha.renderInstances(sa,kd,qb):ha.render(kd,qb)}};this.render=function(ha,va,
sa,eb){if(void 0!==va&&!0!==va.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{Jb="";yb=-1;nb=null;!0===ha.autoUpdate&&ha.updateMatrixWorld();null===va.parent&&va.updateMatrixWorld();va.matrixWorldInverse.getInverse(va.matrixWorld);ef.multiplyMatrices(va.projectionMatrix,va.matrixWorldInverse);rg.setFromMatrix(ef);Oa.length=0;ab=Na=-1;Ma.length=0;Xa.length=0;Nf=this.localClippingEnabled;ff=Hc.init(this.clippingPlanes,Nf,va);O(ha,va);Ua.length=
Na+1;Sa.length=ab+1;!0===Ka.sortObjects&&(Ua.sort(F),Sa.sort(J));ff&&Hc.beginShadows();for(var ib=Oa,qb=0,Ya=0,Aa=ib.length;Ya<Aa;Ya++){var vb=ib[Ya];vb.castShadow&&(Eb.shadows[qb++]=vb)}Eb.shadows.length=qb;sg.render(ha,va);ib=Oa;var Lb=vb=0,Zb=0,Hb=va.matrixWorldInverse,ed=0,hc=0,ic=0,Ac=0,ld=0;qb=0;for(Ya=ib.length;qb<Ya;qb++){Aa=ib[qb];var Bc=Aa.color;var Sc=Aa.intensity;var hf=Aa.distance;var Tc=Aa.shadow&&Aa.shadow.map?Aa.shadow.map.texture:null;if(Aa.isAmbientLight)vb+=Bc.r*Sc,Lb+=Bc.g*Sc,
Zb+=Bc.b*Sc;else if(Aa.isDirectionalLight){var rb=ue.get(Aa);rb.color.copy(Aa.color).multiplyScalar(Aa.intensity);rb.direction.setFromMatrixPosition(Aa.matrixWorld);mc.setFromMatrixPosition(Aa.target.matrixWorld);rb.direction.sub(mc);rb.direction.transformDirection(Hb);if(rb.shadow=Aa.castShadow)rb.shadowBias=Aa.shadow.bias,rb.shadowRadius=Aa.shadow.radius,rb.shadowMapSize=Aa.shadow.mapSize;Eb.directionalShadowMap[ed]=Tc;Eb.directionalShadowMatrix[ed]=Aa.shadow.matrix;Eb.directional[ed++]=rb}else if(Aa.isSpotLight){rb=
ue.get(Aa);rb.position.setFromMatrixPosition(Aa.matrixWorld);rb.position.applyMatrix4(Hb);rb.color.copy(Bc).multiplyScalar(Sc);rb.distance=hf;rb.direction.setFromMatrixPosition(Aa.matrixWorld);mc.setFromMatrixPosition(Aa.target.matrixWorld);rb.direction.sub(mc);rb.direction.transformDirection(Hb);rb.coneCos=Math.cos(Aa.angle);rb.penumbraCos=Math.cos(Aa.angle*(1-Aa.penumbra));rb.decay=0===Aa.distance?0:Aa.decay;if(rb.shadow=Aa.castShadow)rb.shadowBias=Aa.shadow.bias,rb.shadowRadius=Aa.shadow.radius,
rb.shadowMapSize=Aa.shadow.mapSize;Eb.spotShadowMap[ic]=Tc;Eb.spotShadowMatrix[ic]=Aa.shadow.matrix;Eb.spot[ic++]=rb}else if(Aa.isRectAreaLight)rb=ue.get(Aa),rb.color.copy(Bc).multiplyScalar(Sc/(Aa.width*Aa.height)),rb.position.setFromMatrixPosition(Aa.matrixWorld),rb.position.applyMatrix4(Hb),gf.identity(),Of.copy(Aa.matrixWorld),Of.premultiply(Hb),gf.extractRotation(Of),rb.halfWidth.set(.5*Aa.width,0,0),rb.halfHeight.set(0,.5*Aa.height,0),rb.halfWidth.applyMatrix4(gf),rb.halfHeight.applyMatrix4(gf),
Eb.rectArea[Ac++]=rb;else if(Aa.isPointLight){rb=ue.get(Aa);rb.position.setFromMatrixPosition(Aa.matrixWorld);rb.position.applyMatrix4(Hb);rb.color.copy(Aa.color).multiplyScalar(Aa.intensity);rb.distance=Aa.distance;rb.decay=0===Aa.distance?0:Aa.decay;if(rb.shadow=Aa.castShadow)rb.shadowBias=Aa.shadow.bias,rb.shadowRadius=Aa.shadow.radius,rb.shadowMapSize=Aa.shadow.mapSize;Eb.pointShadowMap[hc]=Tc;void 0===Eb.pointShadowMatrix[hc]&&(Eb.pointShadowMatrix[hc]=new y);mc.setFromMatrixPosition(Aa.matrixWorld).negate();
Eb.pointShadowMatrix[hc].identity().setPosition(mc);Eb.point[hc++]=rb}else Aa.isHemisphereLight&&(rb=ue.get(Aa),rb.direction.setFromMatrixPosition(Aa.matrixWorld),rb.direction.transformDirection(Hb),rb.direction.normalize(),rb.skyColor.copy(Aa.color).multiplyScalar(Sc),rb.groundColor.copy(Aa.groundColor).multiplyScalar(Sc),Eb.hemi[ld++]=rb)}Eb.ambient[0]=vb;Eb.ambient[1]=Lb;Eb.ambient[2]=Zb;Eb.directional.length=ed;Eb.spot.length=ic;Eb.rectArea.length=Ac;Eb.point.length=hc;Eb.hemi.length=ld;Eb.hash=
ed+","+hc+","+ic+","+Ac+","+ld+","+Eb.shadows.length;ff&&Hc.endShadows();id.calls=0;id.vertices=0;id.faces=0;id.points=0;void 0===sa&&(sa=null);this.setRenderTarget(sa);ib=ha.background;null===ib?xb.buffers.color.setClear(fb.r,fb.g,fb.b,Cb,Ja):ib&&ib.isColor&&(xb.buffers.color.setClear(ib.r,ib.g,ib.b,1,Ja),eb=!0);(this.autoClear||eb)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);ib&&ib.isCubeTexture?(Kd.projectionMatrix.copy(va.projectionMatrix),Kd.matrixWorld.extractRotation(va.matrixWorld),
Kd.matrixWorldInverse.getInverse(Kd.matrixWorld),jd.material.uniforms.tCube.value=ib,jd.modelViewMatrix.multiplyMatrices(Kd.matrixWorldInverse,jd.matrixWorld),hd.update(jd),Ka.renderBufferDirect(Kd,null,jd.geometry,jd.material,jd,null)):ib&&ib.isTexture&&(ve.material.map=ib,hd.update(ve),Ka.renderBufferDirect(Hg,null,ve.geometry,ve.material,ve,null));ha.overrideMaterial?(eb=ha.overrideMaterial,Q(Ua,ha,va,eb),Q(Sa,ha,va,eb)):(xb.setBlending(0),Q(Ua,ha,va),Q(Sa,ha,va));Ig.render(ha,va);Jg.render(ha,
va,pb);sa&&Jd.updateRenderTargetMipmap(sa);xb.setDepthTest(!0);xb.setDepthWrite(!0);xb.setColorWrite(!0)}};this.setFaceCulling=function(ha,va){xb.setCullFace(ha);xb.setFlipSided(0===va)};this.allocTextureUnit=function(){var ha=ub;ha>=Rc.maxTextures&&console.warn("WebGLRenderer: trying to use "+ha+" texture units while this GPU supports only "+Rc.maxTextures);ub+=1;return ha};this.setTexture2D=function(){var ha=!1;return function(va,sa){va&&va.isWebGLRenderTarget&&(ha||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),
ha=!0),va=va.texture);Jd.setTexture2D(va,sa)}}();this.setTexture=function(){var ha=!1;return function(va,sa){ha||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),ha=!0);Jd.setTexture2D(va,sa)}}();this.setTextureCube=function(){var ha=!1;return function(va,sa){va&&va.isWebGLRenderTargetCube&&(ha||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ha=!0),va=va.texture);va&&va.isCubeTexture||
Array.isArray(va.image)&&6===va.image.length?Jd.setTextureCube(va,sa):Jd.setTextureCubeDynamic(va,sa)}}();this.getCurrentRenderTarget=function(){return Wa};this.setRenderTarget=function(ha){(Wa=ha)&&void 0===zc.get(ha).__webglFramebuffer&&Jd.setupRenderTarget(ha);var va=ha&&ha.isWebGLRenderTargetCube;if(ha){var sa=zc.get(ha);sa=va?sa.__webglFramebuffer[ha.activeCubeFace]:sa.__webglFramebuffer;Ca.copy(ha.scissor);mb=ha.scissorTest;pb.copy(ha.viewport)}else sa=null,Ca.copy(Yb).multiplyScalar(Vb),mb=
Qc,pb.copy(yc).multiplyScalar(Vb);sb!==sa&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,sa),sb=sa);xb.scissor(Ca);xb.setScissorTest(mb);xb.viewport(pb);va&&(va=zc.get(ha.texture),Fa.framebufferTexture2D(Fa.FRAMEBUFFER,Fa.COLOR_ATTACHMENT0,Fa.TEXTURE_CUBE_MAP_POSITIVE_X+ha.activeCubeFace,va.__webglTexture,ha.activeMipMapLevel))};this.readRenderTargetPixels=function(ha,va,sa,eb,ib,qb){if(!1===(ha&&ha.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");
else{var Ya=zc.get(ha).__webglFramebuffer;if(Ya){var Aa=!1;Ya!==sb&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,Ya),Aa=!0);try{var vb=ha.texture,Lb=vb.format,Zb=vb.type;1023!==Lb&&ra(Lb)!==Fa.getParameter(Fa.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===Zb||ra(Zb)===Fa.getParameter(Fa.IMPLEMENTATION_COLOR_READ_TYPE)||1015===Zb&&(Ub.get("OES_texture_float")||Ub.get("WEBGL_color_buffer_float"))||
1016===Zb&&Ub.get("EXT_color_buffer_half_float")?Fa.checkFramebufferStatus(Fa.FRAMEBUFFER)===Fa.FRAMEBUFFER_COMPLETE?0<=va&&va<=ha.width-eb&&0<=sa&&sa<=ha.height-ib&&Fa.readPixels(va,sa,eb,ib,ra(Lb),ra(Zb),qb):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{Aa&&Fa.bindFramebuffer(Fa.FRAMEBUFFER,
sb)}}}}}function Ld(a,c){this.name="";this.color=new la(a);this.density=void 0!==c?c:2.5E-4}function Md(a,c,d){this.name="";this.color=new la(a);this.near=void 0!==c?c:1;this.far=void 0!==d?d:1E3}function md(){jb.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function Pf(a,c,d,g,u){jb.call(this);this.lensFlares=[];this.positionScreen=new p;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,c,d,g,u)}function nd(a){$a.call(this);this.type="SpriteMaterial";
this.color=new la(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)}function we(a){jb.call(this);this.type="Sprite";this.material=void 0!==a?a:new nd}function xe(){jb.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function jf(a,c,d){this.useVertexTexture=void 0!==d?d:!0;this.identityMatrix=new y;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=Bb.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=
this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new xa(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===c)this.calculateInverses();else if(this.bones.length===c.length)this.boneInverses=c.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],c=0,a=this.bones.length;c<
a;c++)this.boneInverses.push(new y)}function kf(){jb.call(this);this.type="Bone"}function lf(a,c,d){Sb.call(this,a,c);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new y;this.bindMatrixInverse=new y;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var g,u=0,w=this.geometry.bones.length;u<w;++u)g=this.geometry.bones[u],c=new kf,a.push(c),c.name=g.name,c.position.fromArray(g.pos),c.quaternion.fromArray(g.rotq),void 0!==g.scl&&c.scale.fromArray(g.scl);u=0;for(w=this.geometry.bones.length;u<
w;++u)g=this.geometry.bones[u],-1!==g.parent&&null!==g.parent&&void 0!==a[g.parent]?a[g.parent].add(a[u]):this.add(a[u])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new jf(a,void 0,d),this.matrixWorld)}function dc(a){$a.call(this);this.type="LineBasicMaterial";this.color=new la(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)}function $c(a,c,d){if(1===d)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),
new Wb(a,c);jb.call(this);this.type="Line";this.geometry=void 0!==a?a:new ob;this.material=void 0!==c?c:new dc({color:16777215*Math.random()})}function Wb(a,c){$c.call(this,a,c);this.type="LineSegments"}function Lc(a){$a.call(this);this.type="PointsMaterial";this.color=new la(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)}function Nd(a,c){jb.call(this);this.type="Points";this.geometry=void 0!==a?a:new ob;this.material=void 0!==c?c:new Lc({color:16777215*
Math.random()})}function ye(){jb.call(this);this.type="Group"}function mf(a,c,d,g,u,w,z,F,J){function M(){requestAnimationFrame(M);a.readyState>=a.HAVE_CURRENT_DATA&&(R.needsUpdate=!0)}e.call(this,a,c,d,g,u,w,z,F,J);this.generateMipmaps=!1;var R=this;M()}function Od(a,c,d,g,u,w,z,F,J,M,R,O){e.call(this,null,w,z,F,J,M,g,u,R,O);this.image={width:c,height:d};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function nf(a,c,d,g,u,w,z,F,J){e.call(this,a,c,d,g,u,w,z,F,J);this.needsUpdate=!0}function ze(a,
c,d,g,u,w,z,F,J,M){M=void 0!==M?M:1026;if(1026!==M&&1027!==M)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===d&&1026===M&&(d=1012);void 0===d&&1027===M&&(d=1020);e.call(this,null,g,u,w,z,F,M,d,J);this.image={width:a,height:c};this.magFilter=void 0!==z?z:1003;this.minFilter=void 0!==F?F:1003;this.generateMipmaps=this.flipY=!1}function Pd(a){function c(ca,ea){return ca-ea}ob.call(this);var d=[0,0],g={},u=["a","b","c"];if(a&&a.isGeometry){var w=
a.vertices,z=a.faces,F=0,J=new Uint32Array(6*z.length);a=0;for(var M=z.length;a<M;a++)for(var R=z[a],O=0;3>O;O++){d[0]=R[u[O]];d[1]=R[u[(O+1)%3]];d.sort(c);var Q=d.toString();void 0===g[Q]&&(J[2*F]=d[0],J[2*F+1]=d[1],g[Q]=!0,F++)}d=new Float32Array(6*F);a=0;for(M=F;a<M;a++)for(O=0;2>O;O++)g=w[J[2*a+O]],F=6*a+3*O,d[F+0]=g.x,d[F+1]=g.y,d[F+2]=g.z;this.addAttribute("position",new bb(d,3))}else if(a&&a.isBufferGeometry){if(null!==a.index){M=a.index.array;w=a.attributes.position;u=a.groups;F=0;0===u.length&&
a.addGroup(0,M.length);J=new Uint32Array(2*M.length);z=0;for(R=u.length;z<R;++z){a=u[z];O=a.start;Q=a.count;a=O;for(var W=O+Q;a<W;a+=3)for(O=0;3>O;O++)d[0]=M[a+O],d[1]=M[a+(O+1)%3],d.sort(c),Q=d.toString(),void 0===g[Q]&&(J[2*F]=d[0],J[2*F+1]=d[1],g[Q]=!0,F++)}d=new Float32Array(6*F);a=0;for(M=F;a<M;a++)for(O=0;2>O;O++)F=6*a+3*O,g=J[2*a+O],d[F+0]=w.getX(g),d[F+1]=w.getY(g),d[F+2]=w.getZ(g)}else for(w=a.attributes.position.array,F=w.length/3,J=F/3,d=new Float32Array(6*F),a=0,M=J;a<M;a++)for(O=0;3>
O;O++)F=18*a+6*O,J=9*a+3*O,d[F+0]=w[J],d[F+1]=w[J+1],d[F+2]=w[J+2],g=9*a+(O+1)%3*3,d[F+3]=w[g],d[F+4]=w[g+1],d[F+5]=w[g+2];this.addAttribute("position",new bb(d,3))}}function Qd(a,c,d){ob.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:c,stacks:d};var g=[],u=[],w,z,F=c+1;for(w=0;w<=d;w++){var J=w/d;for(z=0;z<=c;z++){var M=z/c;var R=a(M,J);g.push(R.x,R.y,R.z);u.push(M,J)}}a=[];for(w=0;w<d;w++)for(z=0;z<c;z++){R=w*F+z;M=w*F+z+1;J=(w+1)*F+z+1;var O=(w+1)*F+z;a.push(R,M,
O);a.push(M,J,O)}this.setIndex(new (65535<a.length?Fc:tc)(a,1));this.addAttribute("position",new zb(g,3));this.addAttribute("uv",new zb(u,2));this.computeVertexNormals()}function Ae(a,c,d){tb.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:c,stacks:d};this.fromBufferGeometry(new Qd(a,c,d));this.mergeVertices()}function uc(a,c,d,g){function u(M){F.push(M.x,M.y,M.z)}function w(M,R){M*=3;R.x=a[M+0];R.y=a[M+1];R.z=a[M+2]}function z(M,R,O,Q){0>Q&&1===M.x&&(J[R]=M.x-1);0===O.x&&
0===O.z&&(J[R]=Q/2/Math.PI+.5)}ob.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:c,radius:d,detail:g};d=d||1;var F=[],J=[];(function(M){for(var R=new p,O=new p,Q=new p,W=0;W<c.length;W+=3){w(c[W+0],R);w(c[W+1],O);w(c[W+2],Q);var ca,ea,na=R,ra=O,aa=Q,qa=Math.pow(2,M),oa=[];for(ea=0;ea<=qa;ea++){oa[ea]=[];var wa=na.clone().lerp(aa,ea/qa),ta=ra.clone().lerp(aa,ea/qa),za=qa-ea;for(ca=0;ca<=za;ca++)oa[ea][ca]=0===ca&&ea===qa?wa:wa.clone().lerp(ta,ca/za)}for(ea=0;ea<
qa;ea++)for(ca=0;ca<2*(qa-ea)-1;ca++)na=Math.floor(ca/2),0===ca%2?(u(oa[ea][na+1]),u(oa[ea+1][na]),u(oa[ea][na])):(u(oa[ea][na+1]),u(oa[ea+1][na+1]),u(oa[ea+1][na]))}})(g||0);(function(M){for(var R=new p,O=0;O<F.length;O+=3)R.x=F[O+0],R.y=F[O+1],R.z=F[O+2],R.normalize().multiplyScalar(M),F[O+0]=R.x,F[O+1]=R.y,F[O+2]=R.z})(d);(function(){for(var M=new p,R=0;R<F.length;R+=3)M.x=F[R+0],M.y=F[R+1],M.z=F[R+2],J.push(Math.atan2(M.z,-M.x)/2/Math.PI+.5,1-(Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))/Math.PI+
.5));M=new p;R=new p;for(var O=new p,Q=new p,W=new l,ca=new l,ea=new l,na=0,ra=0;na<F.length;na+=9,ra+=6){M.set(F[na+0],F[na+1],F[na+2]);R.set(F[na+3],F[na+4],F[na+5]);O.set(F[na+6],F[na+7],F[na+8]);W.set(J[ra+0],J[ra+1]);ca.set(J[ra+2],J[ra+3]);ea.set(J[ra+4],J[ra+5]);Q.copy(M).add(R).add(O).divideScalar(3);var aa=Math.atan2(Q.z,-Q.x);z(W,ra+0,M,aa);z(ca,ra+2,R,aa);z(ea,ra+4,O,aa)}for(M=0;M<J.length;M+=6)R=J[M+0],O=J[M+2],Q=J[M+4],W=Math.min(R,O,Q),.9<Math.max(R,O,Q)&&.1>W&&(.2>R&&(J[M+0]+=1),.2>
O&&(J[M+2]+=1),.2>Q&&(J[M+4]+=1))})();this.addAttribute("position",new zb(F,3));this.addAttribute("normal",new zb(F.slice(),3));this.addAttribute("uv",new zb(J,2));this.normalizeNormals();this.boundingSphere=new Mb(new p,d)}function Rd(a,c){uc.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,c);this.type="TetrahedronBufferGeometry";this.parameters={radius:a,detail:c}}function Be(a,c){tb.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new Rd(a,
c));this.mergeVertices()}function od(a,c){uc.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,c);this.type="OctahedronBufferGeometry";this.parameters={radius:a,detail:c}}function Ce(a,c){tb.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new od(a,c));this.mergeVertices()}function Sd(a,c){var d=(1+Math.sqrt(5))/2;uc.call(this,[-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,
0,1,-d,0,-1,-d,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,c);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:c}}function De(a,c){tb.call(this);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new Sd(a,c));this.mergeVertices()}function Td(a,c){var d=(1+Math.sqrt(5))/2,g=1/d;uc.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,
-1,1,1,1,0,-g,-d,0,-g,d,0,g,-d,0,g,d,-g,-d,0,-g,d,0,g,-d,0,g,d,0,-d,0,-g,d,0,-g,-d,0,g,d,0,g],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,c);this.type="DodecahedronBufferGeometry";this.parameters={radius:a,detail:c}}function Ee(a,c){tb.call(this);this.type="DodecahedronGeometry";
this.parameters={radius:a,detail:c};this.fromBufferGeometry(new Td(a,c));this.mergeVertices()}function Fe(a,c,d,g){tb.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:c,radius:d,detail:g};this.fromBufferGeometry(new uc(a,c,d,g));this.mergeVertices()}function Ud(a,c,d,g,u){function w(na){var ra=a.getPointAt(na/c),aa=z.normals[na];na=z.binormals[na];for(O=0;O<=g;O++){var qa=O/g*Math.PI*2,oa=Math.sin(qa);qa=-Math.cos(qa);J.x=qa*aa.x+oa*na.x;J.y=qa*aa.y+oa*na.y;J.z=qa*aa.z+
oa*na.z;J.normalize();W.push(J.x,J.y,J.z);F.x=ra.x+d*J.x;F.y=ra.y+d*J.y;F.z=ra.z+d*J.z;Q.push(F.x,F.y,F.z)}}ob.call(this);this.type="TubeBufferGeometry";this.parameters={path:a,tubularSegments:c,radius:d,radialSegments:g,closed:u};c=c||64;d=d||1;g=g||8;u=u||!1;var z=a.computeFrenetFrames(c,u);this.tangents=z.tangents;this.normals=z.normals;this.binormals=z.binormals;var F=new p,J=new p,M=new l,R,O,Q=[],W=[],ca=[],ea=[];for(R=0;R<c;R++)w(R);w(!1===u?c:0);for(R=0;R<=c;R++)for(O=0;O<=g;O++)M.x=R/c,M.y=
O/g,ca.push(M.x,M.y);(function(){for(O=1;O<=c;O++)for(R=1;R<=g;R++){var na=(g+1)*O+(R-1),ra=(g+1)*O+R,aa=(g+1)*(O-1)+R;ea.push((g+1)*(O-1)+(R-1),na,aa);ea.push(na,ra,aa)}})();this.setIndex(new (65535<ea.length?Fc:tc)(ea,1));this.addAttribute("position",new zb(Q,3));this.addAttribute("normal",new zb(W,3));this.addAttribute("uv",new zb(ca,2))}function Ge(a,c,d,g,u,w){tb.call(this);this.type="TubeGeometry";this.parameters={path:a,tubularSegments:c,radius:d,radialSegments:g,closed:u};void 0!==w&&console.warn("THREE.TubeGeometry: taper has been removed.");
a=new Ud(a,c,d,g,u);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;this.fromBufferGeometry(a);this.mergeVertices()}function Vd(a,c,d,g,u,w){function z(Ia,Oa,Ua,Na,Sa){var ab=Math.sin(Ia);Oa=Ua/Oa*Ia;Ua=Math.cos(Oa);Sa.x=Na*(2+Ua)*.5*Math.cos(Ia);Sa.y=Na*(2+Ua)*ab*.5;Sa.z=Na*Math.sin(Oa)*.5}ob.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:c,tubularSegments:d,radialSegments:g,p:u,q:w};a=a||100;c=c||40;d=Math.floor(d)||64;g=Math.floor(g)||8;
u=u||2;w=w||3;var F=(g+1)*(d+1),J=g*d*6;J=new bb(new (65535<J?Uint32Array:Uint16Array)(J),1);var M=new bb(new Float32Array(3*F),3),R=new bb(new Float32Array(3*F),3);F=new bb(new Float32Array(2*F),2);var O,Q=0,W=0,ca=new p,ea=new p,na=new l,ra=new p,aa=new p,qa=new p,oa=new p,wa=new p;for(O=0;O<=d;++O){var ta=O/d*u*Math.PI*2;z(ta,u,w,a,ra);z(ta+.01,u,w,a,aa);oa.subVectors(aa,ra);wa.addVectors(aa,ra);qa.crossVectors(oa,wa);wa.crossVectors(qa,oa);qa.normalize();wa.normalize();for(ta=0;ta<=g;++ta){var za=
ta/g*Math.PI*2,Ja=-c*Math.cos(za);za=c*Math.sin(za);ca.x=ra.x+(Ja*wa.x+za*qa.x);ca.y=ra.y+(Ja*wa.y+za*qa.y);ca.z=ra.z+(Ja*wa.z+za*qa.z);M.setXYZ(Q,ca.x,ca.y,ca.z);ea.subVectors(ca,ra).normalize();R.setXYZ(Q,ea.x,ea.y,ea.z);na.x=O/d;na.y=ta/g;F.setXY(Q,na.x,na.y);Q++}}for(ta=1;ta<=d;ta++)for(O=1;O<=g;O++)a=(g+1)*ta+(O-1),c=(g+1)*ta+O,u=(g+1)*(ta-1)+O,J.setX(W,(g+1)*(ta-1)+(O-1)),W++,J.setX(W,a),W++,J.setX(W,u),W++,J.setX(W,a),W++,J.setX(W,c),W++,J.setX(W,u),W++;this.setIndex(J);this.addAttribute("position",
M);this.addAttribute("normal",R);this.addAttribute("uv",F)}function He(a,c,d,g,u,w,z){tb.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:c,tubularSegments:d,radialSegments:g,p:u,q:w};void 0!==z&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Vd(a,c,d,g,u,w));this.mergeVertices()}function Wd(a,c,d,g,u){ob.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:c,radialSegments:d,
tubularSegments:g,arc:u};a=a||100;c=c||40;d=Math.floor(d)||8;g=Math.floor(g)||6;u=u||2*Math.PI;var w=(d+1)*(g+1),z=d*g*6;z=new (65535<z?Uint32Array:Uint16Array)(z);var F=new Float32Array(3*w),J=new Float32Array(3*w);w=new Float32Array(2*w);var M=0,R=0,O=0,Q=new p,W=new p,ca=new p,ea,na;for(ea=0;ea<=d;ea++)for(na=0;na<=g;na++){var ra=na/g*u,aa=ea/d*Math.PI*2;W.x=(a+c*Math.cos(aa))*Math.cos(ra);W.y=(a+c*Math.cos(aa))*Math.sin(ra);W.z=c*Math.sin(aa);F[M]=W.x;F[M+1]=W.y;F[M+2]=W.z;Q.x=a*Math.cos(ra);
Q.y=a*Math.sin(ra);ca.subVectors(W,Q).normalize();J[M]=ca.x;J[M+1]=ca.y;J[M+2]=ca.z;w[R]=na/g;w[R+1]=ea/d;M+=3;R+=2}for(ea=1;ea<=d;ea++)for(na=1;na<=g;na++)a=(g+1)*(ea-1)+na-1,c=(g+1)*(ea-1)+na,u=(g+1)*ea+na,z[O]=(g+1)*ea+na-1,z[O+1]=a,z[O+2]=u,z[O+3]=a,z[O+4]=c,z[O+5]=u,O+=6;this.setIndex(new bb(z,1));this.addAttribute("position",new bb(F,3));this.addAttribute("normal",new bb(J,3));this.addAttribute("uv",new bb(w,2))}function Ie(a,c,d,g,u){tb.call(this);this.type="TorusGeometry";this.parameters=
{radius:a,tube:c,radialSegments:d,tubularSegments:g,arc:u};this.fromBufferGeometry(new Wd(a,c,d,g,u))}function Ic(a,c){"undefined"!==typeof a&&(tb.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,c),this.computeFaceNormals())}function Je(a,c){c=c||{};var d=c.font;if(!1===(d&&d.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new tb;a=d.generateShapes(a,c.size,c.curveSegments);c.amount=void 0!==c.height?c.height:
50;void 0===c.bevelThickness&&(c.bevelThickness=10);void 0===c.bevelSize&&(c.bevelSize=8);void 0===c.bevelEnabled&&(c.bevelEnabled=!1);Ic.call(this,a,c);this.type="TextGeometry"}function pd(a,c,d,g,u,w,z){ob.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:c,heightSegments:d,phiStart:g,phiLength:u,thetaStart:w,thetaLength:z};a=a||50;c=Math.max(3,Math.floor(c)||8);d=Math.max(2,Math.floor(d)||6);g=void 0!==g?g:0;u=void 0!==u?u:2*Math.PI;w=void 0!==w?w:0;z=void 0!==
z?z:Math.PI;var F=w+z,J=(c+1)*(d+1),M=new bb(new Float32Array(3*J),3),R=new bb(new Float32Array(3*J),3);J=new bb(new Float32Array(2*J),2);for(var O=0,Q=[],W=new p,ca=0;ca<=d;ca++){for(var ea=[],na=ca/d,ra=0;ra<=c;ra++){var aa=ra/c,qa=-a*Math.cos(g+aa*u)*Math.sin(w+na*z),oa=a*Math.cos(w+na*z),wa=a*Math.sin(g+aa*u)*Math.sin(w+na*z);W.set(qa,oa,wa).normalize();M.setXYZ(O,qa,oa,wa);R.setXYZ(O,W.x,W.y,W.z);J.setXY(O,aa,1-na);ea.push(O);O++}Q.push(ea)}g=[];for(ca=0;ca<d;ca++)for(ra=0;ra<c;ra++)u=Q[ca][ra+
1],z=Q[ca][ra],O=Q[ca+1][ra],W=Q[ca+1][ra+1],(0!==ca||0<w)&&g.push(u,z,W),(ca!==d-1||F<Math.PI)&&g.push(z,O,W);this.setIndex(new (65535<M.count?Fc:tc)(g,1));this.addAttribute("position",M);this.addAttribute("normal",R);this.addAttribute("uv",J);this.boundingSphere=new Mb(new p,a)}function Ke(a,c,d,g,u,w,z){tb.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:c,heightSegments:d,phiStart:g,phiLength:u,thetaStart:w,thetaLength:z};this.fromBufferGeometry(new pd(a,c,d,g,u,w,
z))}function Xd(a,c,d,g,u,w){ob.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:c,thetaSegments:d,phiSegments:g,thetaStart:u,thetaLength:w};a=a||20;c=c||50;u=void 0!==u?u:0;w=void 0!==w?w:2*Math.PI;d=void 0!==d?Math.max(3,d):8;g=void 0!==g?Math.max(1,g):1;var z=(d+1)*(g+1),F=d*g*6;F=new bb(new (65535<F?Uint32Array:Uint16Array)(F),1);var J=new bb(new Float32Array(3*z),3),M=new bb(new Float32Array(3*z),3);z=new bb(new Float32Array(2*z),2);var R=0,O=0,Q=a,W=(c-a)/
g,ca=new p,ea=new l,na;for(a=0;a<=g;a++){for(na=0;na<=d;na++){var ra=u+na/d*w;ca.x=Q*Math.cos(ra);ca.y=Q*Math.sin(ra);J.setXYZ(R,ca.x,ca.y,ca.z);M.setXYZ(R,0,0,1);ea.x=(ca.x/c+1)/2;ea.y=(ca.y/c+1)/2;z.setXY(R,ea.x,ea.y);R++}Q+=W}for(a=0;a<g;a++)for(c=a*(d+1),na=0;na<d;na++)u=ra=na+c,w=ra+d+1,R=ra+d+2,ra+=1,F.setX(O,u),O++,F.setX(O,w),O++,F.setX(O,R),O++,F.setX(O,u),O++,F.setX(O,R),O++,F.setX(O,ra),O++;this.setIndex(F);this.addAttribute("position",J);this.addAttribute("normal",M);this.addAttribute("uv",
z)}function Le(a,c,d,g,u,w){tb.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:c,thetaSegments:d,phiSegments:g,thetaStart:u,thetaLength:w};this.fromBufferGeometry(new Xd(a,c,d,g,u,w))}function Me(a,c,d,g){tb.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:c,widthSegments:d,heightSegments:g};this.fromBufferGeometry(new pc(a,c,d,g))}function Yd(a,c,d,g){ob.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:c,phiStart:d,phiLength:g};
c=Math.floor(c)||12;d=d||0;g=g||2*Math.PI;g=Bb.clamp(g,0,2*Math.PI);var u=(c+1)*a.length,w=c*a.length*6,z=new bb(new (65535<w?Uint32Array:Uint16Array)(w),1),F=new bb(new Float32Array(3*u),3),J=new bb(new Float32Array(2*u),2),M=0,R=0,O=1/c,Q=new p,W=new l;for(u=0;u<=c;u++){w=d+u*O*g;var ca=Math.sin(w),ea=Math.cos(w);for(w=0;w<=a.length-1;w++)Q.x=a[w].x*ca,Q.y=a[w].y,Q.z=a[w].x*ea,F.setXYZ(M,Q.x,Q.y,Q.z),W.x=u/c,W.y=w/(a.length-1),J.setXY(M,W.x,W.y),M++}for(u=0;u<c;u++)for(w=0;w<a.length-1;w++)d=w+
u*a.length,M=d+a.length,O=d+a.length+1,Q=d+1,z.setX(R,d),R++,z.setX(R,M),R++,z.setX(R,Q),R++,z.setX(R,M),R++,z.setX(R,O),R++,z.setX(R,Q),R++;this.setIndex(z);this.addAttribute("position",F);this.addAttribute("uv",J);this.computeVertexNormals();if(g===2*Math.PI)for(g=this.attributes.normal.array,z=new p,F=new p,J=new p,d=c*a.length*3,w=u=0;u<a.length;u++,w+=3)z.x=g[w+0],z.y=g[w+1],z.z=g[w+2],F.x=g[d+w+0],F.y=g[d+w+1],F.z=g[d+w+2],J.addVectors(z,F).normalize(),g[w+0]=g[d+w+0]=J.x,g[w+1]=g[d+w+1]=J.y,
g[w+2]=g[d+w+2]=J.z}function Ne(a,c,d,g){tb.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:c,phiStart:d,phiLength:g};this.fromBufferGeometry(new Yd(a,c,d,g));this.mergeVertices()}function Zd(a,c){function d(R){var O,Q=g.length/3;R=R.extractPoints(c);var W=R.shape,ca=R.holes;if(!1===kc.isClockWise(W))for(W=W.reverse(),R=0,O=ca.length;R<O;R++){var ea=ca[R];!0===kc.isClockWise(ea)&&(ca[R]=ea.reverse())}var na=kc.triangulateShape(W,ca);R=0;for(O=ca.length;R<O;R++)ea=ca[R],W=W.concat(ea);
R=0;for(O=W.length;R<O;R++)ea=W[R],g.push(ea.x,ea.y,0),u.push(0,0,1),w.push(ea.x,ea.y);R=0;for(O=na.length;R<O;R++)W=na[R],z.push(W[0]+Q,W[1]+Q,W[2]+Q),J+=3}ob.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:a,curveSegments:c};c=c||12;var g=[],u=[],w=[],z=[],F=0,J=0;if(!1===Array.isArray(a))d(a);else for(var M=0;M<a.length;M++)d(a[M]),this.addGroup(F,J,M),F+=J,J=0;this.setIndex(new (65535<z.length?Fc:tc)(z,1));this.addAttribute("position",new zb(g,3));this.addAttribute("normal",
new zb(u,3));this.addAttribute("uv",new zb(w,2))}function $d(a,c){tb.call(this);this.type="ShapeGeometry";"object"===typeof c&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),c=c.curveSegments);this.parameters={shapes:a,curveSegments:c};this.fromBufferGeometry(new Zd(a,c));this.mergeVertices()}function ae(a,c){function d(Q,W){return Q-W}ob.call(this);c=Math.cos(Bb.DEG2RAD*(void 0!==c?c:1));var g=[0,0],u={},w=["a","b","c"];if(a.isBufferGeometry){var z=new tb;z.fromBufferGeometry(a)}else z=
a.clone();z.mergeVertices();z.computeFaceNormals();a=z.vertices;z=z.faces;for(var F=0,J=z.length;F<J;F++)for(var M=z[F],R=0;3>R;R++){g[0]=M[w[R]];g[1]=M[w[(R+1)%3]];g.sort(d);var O=g.toString();void 0===u[O]?u[O]={vert1:g[0],vert2:g[1],face1:F,face2:void 0}:u[O].face2=F}g=[];for(O in u)if(w=u[O],void 0===w.face2||z[w.face1].normal.dot(z[w.face2].normal)<=c)F=a[w.vert1],g.push(F.x),g.push(F.y),g.push(F.z),F=a[w.vert2],g.push(F.x),g.push(F.y),g.push(F.z);this.addAttribute("position",new zb(g,3))}function ad(a,
c,d,g,u,w,z,F){function J(ta){var za,Ja=new l,Ia=new p,Oa=0,Ua=!0===ta?a:c,Na=!0===ta?1:-1;var Sa=ra;for(za=1;za<=g;za++)ca.setXYZ(ra,0,oa*Na,0),ea.setXYZ(ra,0,Na,0),Ja.x=.5,Ja.y=.5,na.setXY(ra,Ja.x,Ja.y),ra++;var ab=ra;for(za=0;za<=g;za++){var Pa=za/g*F+z,Ma=Math.cos(Pa);Pa=Math.sin(Pa);Ia.x=Ua*Pa;Ia.y=oa*Na;Ia.z=Ua*Ma;ca.setXYZ(ra,Ia.x,Ia.y,Ia.z);ea.setXYZ(ra,0,Na,0);Ja.x=.5*Ma+.5;Ja.y=.5*Pa*Na+.5;na.setXY(ra,Ja.x,Ja.y);ra++}for(za=0;za<g;za++)Ja=Sa+za,Ia=ab+za,!0===ta?(W.setX(aa,Ia),aa++,W.setX(aa,
Ia+1)):(W.setX(aa,Ia+1),aa++,W.setX(aa,Ia)),aa++,W.setX(aa,Ja),aa++,Oa+=3;M.addGroup(wa,Oa,!0===ta?1:2);wa+=Oa}ob.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:c,height:d,radialSegments:g,heightSegments:u,openEnded:w,thetaStart:z,thetaLength:F};var M=this;a=void 0!==a?a:20;c=void 0!==c?c:20;d=void 0!==d?d:100;g=Math.floor(g)||8;u=Math.floor(u)||1;w=void 0!==w?w:!1;z=void 0!==z?z:0;F=void 0!==F?F:2*Math.PI;var R=0;!1===w&&(0<a&&R++,0<c&&R++);var O=function(){var ta=
(g+1)*(u+1);!1===w&&(ta+=(g+1)*R+g*R);return ta}(),Q=function(){var ta=g*u*6;!1===w&&(ta+=g*R*3);return ta}(),W=new bb(new (65535<Q?Uint32Array:Uint16Array)(Q),1),ca=new bb(new Float32Array(3*O),3),ea=new bb(new Float32Array(3*O),3),na=new bb(new Float32Array(2*O),2),ra=0,aa=0,qa=[],oa=d/2,wa=0;(function(){var ta,za,Ja=new p,Ia=new p,Oa=0,Ua=(c-a)/d;for(za=0;za<=u;za++){var Na=[],Sa=za/u,ab=Sa*(c-a)+a;for(ta=0;ta<=g;ta++){var Pa=ta/g,Ma=Pa*F+z,Xa=Math.sin(Ma);Ma=Math.cos(Ma);Ia.x=ab*Xa;Ia.y=-Sa*d+
oa;Ia.z=ab*Ma;ca.setXYZ(ra,Ia.x,Ia.y,Ia.z);Ja.set(Xa,Ua,Ma).normalize();ea.setXYZ(ra,Ja.x,Ja.y,Ja.z);na.setXY(ra,Pa,1-Sa);Na.push(ra);ra++}qa.push(Na)}for(ta=0;ta<g;ta++)for(za=0;za<u;za++)Ja=qa[za+1][ta],Ia=qa[za+1][ta+1],Ua=qa[za][ta+1],W.setX(aa,qa[za][ta]),aa++,W.setX(aa,Ja),aa++,W.setX(aa,Ua),aa++,W.setX(aa,Ja),aa++,W.setX(aa,Ia),aa++,W.setX(aa,Ua),aa++,Oa+=6;M.addGroup(wa,Oa,0);wa+=Oa})();!1===w&&(0<a&&J(!0),0<c&&J(!1));this.setIndex(W);this.addAttribute("position",ca);this.addAttribute("normal",
ea);this.addAttribute("uv",na)}function qd(a,c,d,g,u,w,z,F){tb.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:c,height:d,radialSegments:g,heightSegments:u,openEnded:w,thetaStart:z,thetaLength:F};this.fromBufferGeometry(new ad(a,c,d,g,u,w,z,F));this.mergeVertices()}function Oe(a,c,d,g,u,w,z){qd.call(this,0,a,c,d,g,u,w,z);this.type="ConeGeometry";this.parameters={radius:a,height:c,radialSegments:d,heightSegments:g,openEnded:u,thetaStart:w,thetaLength:z}}function Pe(a,
c,d,g,u,w,z){ad.call(this,0,a,c,d,g,u,w,z);this.type="ConeBufferGeometry";this.parameters={radius:a,height:c,radialSegments:d,heightSegments:g,openEnded:u,thetaStart:w,thetaLength:z}}function be(a,c,d,g){ob.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:c,thetaStart:d,thetaLength:g};a=a||50;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?d:0;g=void 0!==g?g:2*Math.PI;var u=c+2,w=new Float32Array(3*u),z=new Float32Array(3*u);u=new Float32Array(2*u);z[2]=1;u[0]=.5;u[1]=.5;for(var F=
0,J=3,M=2;F<=c;F++,J+=3,M+=2){var R=d+F/c*g;w[J]=a*Math.cos(R);w[J+1]=a*Math.sin(R);z[J+2]=1;u[M]=(w[J]/a+1)/2;u[M+1]=(w[J+1]/a+1)/2}d=[];for(J=1;J<=c;J++)d.push(J,J+1,0);this.setIndex(new bb(new Uint16Array(d),1));this.addAttribute("position",new bb(w,3));this.addAttribute("normal",new bb(z,3));this.addAttribute("uv",new bb(u,2));this.boundingSphere=new Mb(new p,a)}function Qe(a,c,d,g){tb.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:c,thetaStart:d,thetaLength:g};this.fromBufferGeometry(new be(a,
c,d,g))}function ce(a,c,d,g,u,w){tb.call(this);this.type="BoxGeometry";this.parameters={width:a,height:c,depth:d,widthSegments:g,heightSegments:u,depthSegments:w};this.fromBufferGeometry(new Pc(a,c,d,g,u,w));this.mergeVertices()}function de(){kb.call(this,{uniforms:rc.merge([Db.lights,{opacity:{value:1}}]),vertexShader:Nb.shadow_vert,fragmentShader:Nb.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},
set:function(a){this.uniforms.opacity.value=a}}})}function ee(a){kb.call(this,a);this.type="RawShaderMaterial"}function Re(a){this.uuid=Bb.generateUUID();this.type="MultiMaterial";this.materials=Array.isArray(a)?a:[];this.visible=!0}function Uc(a){$a.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new la(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new la(0);this.emissiveIntensity=
1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new l(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function rd(a){Uc.call(this);this.defines=
{PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function Mc(a){$a.call(this);this.type="MeshPhongMaterial";this.color=new la(16777215);this.specular=new la(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new la(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new l(1,1);
this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function sd(a){Mc.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(a)}function td(a){$a.call(this,a);
this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new l(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=!1;this.setValues(a)}function ud(a){$a.call(this);this.type="MeshLambertMaterial";this.color=new la(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=
1;this.emissive=new la(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function vd(a){$a.call(this);this.type="LineDashedMaterial";this.color=new la(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=
!1;this.setValues(a)}function Qf(a,c,d){var g=this,u=!1,w=0,z=0;this.onStart=void 0;this.onLoad=a;this.onProgress=c;this.onError=d;this.itemStart=function(F){z++;if(!1===u&&void 0!==g.onStart)g.onStart(F,w,z);u=!0};this.itemEnd=function(F){w++;if(void 0!==g.onProgress)g.onProgress(F,w,z);if(w===z&&(u=!1,void 0!==g.onLoad))g.onLoad()};this.itemError=function(F){if(void 0!==g.onError)g.onError(F)}}function Jc(a){this.manager=void 0!==a?a:Cc}function tg(a){this.manager=void 0!==a?a:Cc;this._parser=null}
function Rf(a){this.manager=void 0!==a?a:Cc;this._parser=null}function Se(a){this.manager=void 0!==a?a:Cc}function Sf(a){this.manager=void 0!==a?a:Cc}function of(a){this.manager=void 0!==a?a:Cc}function ec(a,c){jb.call(this);this.type="Light";this.color=new la(a);this.intensity=void 0!==c?c:1;this.receiveShadow=void 0}function pf(a,c,d){ec.call(this,a,d);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(jb.DefaultUp);this.updateMatrix();this.groundColor=new la(c)}function wd(a){this.camera=
a;this.bias=0;this.radius=1;this.mapSize=new l(512,512);this.map=null;this.matrix=new y}function qf(){wd.call(this,new ua(50,1,.5,500))}function rf(a,c,d,g,u,w){ec.call(this,a,c);this.type="SpotLight";this.position.copy(jb.DefaultUp);this.updateMatrix();this.target=new jb;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(z){this.intensity=z/Math.PI}});this.distance=void 0!==d?d:0;this.angle=void 0!==g?g:Math.PI/3;this.penumbra=void 0!==u?u:0;this.decay=
void 0!==w?w:1;this.shadow=new qf}function sf(a,c,d,g){ec.call(this,a,c);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(u){this.intensity=u/(4*Math.PI)}});this.distance=void 0!==d?d:0;this.decay=void 0!==g?g:1;this.shadow=new wd(new ua(90,1,.5,500))}function tf(a){wd.call(this,new Da(-5,5,5,-5,.5,500))}function uf(a,c){ec.call(this,a,c);this.type="DirectionalLight";this.position.copy(jb.DefaultUp);this.updateMatrix();this.target=
new jb;this.shadow=new tf}function vf(a,c){ec.call(this,a,c);this.type="AmbientLight";this.castShadow=void 0}function vc(a,c,d,g){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==g?g:new c.constructor(d);this.sampleValues=c;this.valueSize=d}function wf(a,c,d,g){vc.call(this,a,c,d,g);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Te(a,c,d,g){vc.call(this,a,c,d,g)}function xf(a,c,d,g){vc.call(this,a,c,d,g)}function xd(a,c,d,g){if(void 0===a)throw Error("track name is undefined");
if(void 0===c||0===c.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=nc.convertArray(c,this.TimeBufferType);this.values=nc.convertArray(d,this.ValueBufferType);this.setInterpolation(g||this.DefaultInterpolation);this.validate();this.optimize()}function fe(a,c,d,g){xd.call(this,a,c,d,g)}function yf(a,c,d,g){vc.call(this,a,c,d,g)}function Ue(a,c,d,g){xd.call(this,a,c,d,g)}function ge(a,c,d,g){xd.call(this,a,c,d,g)}function zf(a,c,d,g){xd.call(this,a,c,d,g)}function Af(a,
c,d){xd.call(this,a,c,d)}function Bf(a,c,d,g){xd.call(this,a,c,d,g)}function yd(a,c,d,g){xd.apply(this,arguments)}function Dc(a,c,d){this.name=a;this.tracks=d;this.duration=void 0!==c?c:-1;this.uuid=Bb.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function Cf(a){this.manager=void 0!==a?a:Cc;this.textures={}}function Tf(a){this.manager=void 0!==a?a:Cc}function zd(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function Uf(a){"boolean"===
typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:Cc;this.withCredentials=!1}function ug(a){this.manager=void 0!==a?a:Cc;this.texturePath=""}function oc(){}function Vc(a,c){this.v1=a;this.v2=c}function Ve(){this.curves=[];this.autoClose=!1}function bd(a,c,d,g,u,w,z,F){this.aX=a;this.aY=c;this.xRadius=d;this.yRadius=g;this.aStartAngle=u;this.aEndAngle=w;this.aClockwise=z;this.aRotation=F||0}function Ad(a){this.points=
void 0===a?[]:a}function Bd(a,c,d,g){this.v0=a;this.v1=c;this.v2=d;this.v3=g}function Cd(a,c,d){this.v0=a;this.v1=c;this.v2=d}function Dd(){We.apply(this,arguments);this.holes=[]}function We(a){Ve.call(this);this.currentPoint=new l;a&&this.fromPoints(a)}function Vf(){this.subPaths=[];this.currentPath=null}function Wf(a){this.data=a}function vg(a){this.manager=void 0!==a?a:Cc}function Xf(a){this.manager=void 0!==a?a:Cc}function Yf(a,c,d,g){ec.call(this,a,c);this.type="RectAreaLight";this.position.set(0,
1,0);this.updateMatrix();this.width=void 0!==d?d:10;this.height=void 0!==g?g:10}function wg(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new ua;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new ua;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function Df(a,c,d){jb.call(this);this.type="CubeCamera";var g=new ua(90,1,a,c);g.up.set(0,-1,0);g.lookAt(new p(1,0,0));this.add(g);var u=new ua(90,1,a,c);u.up.set(0,-1,0);u.lookAt(new p(-1,
0,0));this.add(u);var w=new ua(90,1,a,c);w.up.set(0,0,1);w.lookAt(new p(0,1,0));this.add(w);var z=new ua(90,1,a,c);z.up.set(0,0,-1);z.lookAt(new p(0,-1,0));this.add(z);var F=new ua(90,1,a,c);F.up.set(0,-1,0);F.lookAt(new p(0,0,1));this.add(F);var J=new ua(90,1,a,c);J.up.set(0,-1,0);J.lookAt(new p(0,0,-1));this.add(J);this.renderTarget=new k(d,d,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(M,R){null===this.parent&&this.updateMatrixWorld();var O=this.renderTarget,Q=O.texture.generateMipmaps;
O.texture.generateMipmaps=!1;O.activeCubeFace=0;M.render(R,g,O);O.activeCubeFace=1;M.render(R,u,O);O.activeCubeFace=2;M.render(R,w,O);O.activeCubeFace=3;M.render(R,z,O);O.activeCubeFace=4;M.render(R,F,O);O.texture.generateMipmaps=Q;O.activeCubeFace=5;M.render(R,J,O);M.setRenderTarget(null)}}function Zf(){jb.call(this);this.type="AudioListener";this.context=$f.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function he(a){jb.call(this);
this.type="Audio";this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function ag(a){he.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function bg(a,c){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==c?c:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);
a.getOutput().connect(this.analyser)}function Ef(a,c,d){this.binding=a;this.valueSize=d;a=Float64Array;switch(c){case "quaternion":c=this._slerp;break;case "string":case "bool":a=Array;c=this._select;break;default:c=this._lerp}this.buffer=new a(4*d);this._mixBufferRegion=c;this.referenceCount=this.useCount=this.cumulativeWeight=0}function ac(a,c,d){this.path=c;this.parsedPath=d||ac.parseTrackName(c);this.node=ac.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function cg(a){this.uuid=Bb.generateUUID();
this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var c={};this._indicesByUUID=c;for(var d=0,g=arguments.length;d!==g;++d)c[arguments[d].uuid]=d;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var u=this;this.stats={objects:{get total(){return u._objects.length},get inUse(){return this.total-u.nCachedObjects_}},get bindingsPerObject(){return u._bindings.length}}}function dg(a,c,d){this._mixer=a;this._clip=c;this._localRoot=d||null;a=c.tracks;
c=a.length;d=Array(c);for(var g={endingStart:2400,endingEnd:2400},u=0;u!==c;++u){var w=a[u].createInterpolant(null);d[u]=w;w.settings=g}this._interpolantSettings=g;this._interpolants=d;this._propertyBindings=Array(c);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=
!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function Xe(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Ff(a,c){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=c);this.value=a}function Ed(){ob.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function eg(a,c,d,g){this.uuid=Bb.generateUUID();this.data=a;this.itemSize=c;this.offset=d;this.normalized=!0===
g}function ie(a,c){this.uuid=Bb.generateUUID();this.array=a;this.stride=c;this.count=void 0!==a?a.length/c:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function je(a,c,d){ie.call(this,a,c);this.meshPerAttribute=d||1}function ke(a,c,d){bb.call(this,a,c);this.meshPerAttribute=d||1}function fg(a,c,d,g){this.ray=new sc(a,c);this.near=d||0;this.far=g||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,
{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function xg(a,c){return a.distance-c.distance}function gg(a,c,d,g){if(!1!==a.visible&&(a.raycast(c,d),!0===g)){a=a.children;g=0;for(var u=a.length;g<u;g++)gg(a[g],c,d,!0)}}function hg(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function ig(a,c,d){this.radius=void 0!==a?a:1;this.phi=void 0!==c?c:0;this.theta=void 0!==
d?d:0;return this}function jg(a,c,d){this.radius=void 0!==a?a:1;this.theta=void 0!==c?c:0;this.y=void 0!==d?d:0;return this}function lc(a,c){Sb.call(this,a,c);this.animationsMap={};this.animationsList=[];a=this.geometry.morphTargets.length;this.createAnimation("__default",0,a-1,a/1);this.setAnimationWeight("__default",1)}function Ye(a){jb.call(this);this.material=a;this.render=function(c){}}function Ze(a,c,d,g){this.object=a;this.size=void 0!==c?c:1;a=void 0!==d?d:16711680;g=void 0!==g?g:1;c=0;(d=
this.object.geometry)&&d.isGeometry?c=3*d.faces.length:d&&d.isBufferGeometry&&(c=d.attributes.normal.count);d=new ob;c=new zb(6*c,3);d.addAttribute("position",c);Wb.call(this,d,new dc({color:a,linewidth:g}));this.matrixAutoUpdate=!1;this.update()}function le(a){jb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new ob;for(var c=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],d=0,g=1;32>d;d++,g++){var u=d/32*Math.PI*2,w=g/
32*Math.PI*2;c.push(Math.cos(u),Math.sin(u),1,Math.cos(w),Math.sin(w),1)}a.addAttribute("position",new zb(c,3));c=new dc({fog:!1});this.cone=new Wb(a,c);this.add(this.cone);this.update()}function me(a){this.bones=this.getBoneList(a);for(var c=new ob,d=[],g=[],u=new la(0,0,1),w=new la(0,1,0),z=0;z<this.bones.length;z++){var F=this.bones[z];F.parent&&F.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),g.push(u.r,u.g,u.b),g.push(w.r,w.g,w.b))}c.addAttribute("position",new zb(d,3));c.addAttribute("color",new zb(g,
3));d=new dc({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Wb.call(this,c,d);this.root=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function ne(a,c){this.light=a;this.light.updateMatrixWorld();a=new pd(c,4,2);c=new jc({wireframe:!0,fog:!1});c.color.copy(this.light.color).multiplyScalar(this.light.intensity);Sb.call(this,a,c);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1}function oe(a){jb.call(this);this.light=a;this.light.updateMatrixWorld();var c=
new jc({color:a.color,fog:!1});a=new jc({color:a.color,fog:!1,wireframe:!0});var d=new ob;d.addAttribute("position",new bb(new Float32Array(18),3));this.add(new Sb(d,c));this.add(new Sb(d,a));this.update()}function pe(a,c){jb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new od(c);a.rotateY(.5*Math.PI);c=new jc({vertexColors:2,wireframe:!0});var d=a.getAttribute("position");d=new Float32Array(3*d.count);a.addAttribute("color",new bb(d,
3));this.add(new Sb(a,c));this.update()}function $e(a,c,d,g){a=a||10;c=c||10;d=new la(void 0!==d?d:4473924);g=new la(void 0!==g?g:8947848);for(var u=c/2,w=2*a/c,z=[],F=[],J=0,M=0,R=-a;J<=c;J++,R+=w){z.push(-a,0,R,a,0,R);z.push(R,0,-a,R,0,a);var O=J===u?d:g;O.toArray(F,M);M+=3;O.toArray(F,M);M+=3;O.toArray(F,M);M+=3;O.toArray(F,M);M+=3}a=new ob;a.addAttribute("position",new zb(z,3));a.addAttribute("color",new zb(F,3));z=new dc({vertexColors:2});Wb.call(this,a,z)}function Gf(a,c,d,g,u,w){a=a||10;c=
c||16;d=d||8;g=g||64;u=new la(void 0!==u?u:4473924);w=new la(void 0!==w?w:8947848);var z=[],F=[],J;for(J=0;J<=c;J++){var M=J/c*2*Math.PI;var R=Math.sin(M)*a;M=Math.cos(M)*a;z.push(0,0,0);z.push(R,0,M);var O=J&1?u:w;F.push(O.r,O.g,O.b);F.push(O.r,O.g,O.b)}for(J=0;J<=d;J++){O=J&1?u:w;var Q=a-a/d*J;for(c=0;c<g;c++)M=c/g*2*Math.PI,R=Math.sin(M)*Q,M=Math.cos(M)*Q,z.push(R,0,M),F.push(O.r,O.g,O.b),M=(c+1)/g*2*Math.PI,R=Math.sin(M)*Q,M=Math.cos(M)*Q,z.push(R,0,M),F.push(O.r,O.g,O.b)}a=new ob;a.addAttribute("position",
new zb(z,3));a.addAttribute("color",new zb(F,3));z=new dc({vertexColors:2});Wb.call(this,a,z)}function af(a,c,d,g){this.object=a;this.size=void 0!==c?c:1;a=void 0!==d?d:16776960;g=void 0!==g?g:1;c=0;(d=this.object.geometry)&&d.isGeometry?c=d.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");d=new ob;c=new zb(6*c,3);d.addAttribute("position",c);Wb.call(this,d,new dc({color:a,linewidth:g}));this.matrixAutoUpdate=!1;this.update()}
function qe(a,c){jb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===c&&(c=1);a=new ob;a.addAttribute("position",new zb([-c,c,0,c,c,0,c,-c,0,-c,-c,0,-c,c,0],3));c=new dc({fog:!1});this.add(new $c(a,c));a=new ob;a.addAttribute("position",new zb([0,0,0,0,0,1],3));this.add(new $c(a,c));this.update()}function bf(a){function c(W,ca,ea){d(W,ea);d(ca,ea)}function d(W,ca){w.push(0,0,0);z.push(ca.r,ca.g,ca.b);void 0===F[W]&&(F[W]=[]);F[W].push(w.length/
3-1)}var g=new ob,u=new dc({color:16777215,vertexColors:1}),w=[],z=[],F={},J=new la(16755200),M=new la(16711680),R=new la(43775),O=new la(16777215),Q=new la(3355443);c("n1","n2",J);c("n2","n4",J);c("n4","n3",J);c("n3","n1",J);c("f1","f2",J);c("f2","f4",J);c("f4","f3",J);c("f3","f1",J);c("n1","f1",J);c("n2","f2",J);c("n3","f3",J);c("n4","f4",J);c("p","n1",M);c("p","n2",M);c("p","n3",M);c("p","n4",M);c("u1","u2",R);c("u2","u3",R);c("u3","u1",R);c("c","t",O);c("p","c",Q);c("cn1","cn2",Q);c("cn3","cn4",
Q);c("cf1","cf2",Q);c("cf3","cf4",Q);g.addAttribute("position",new zb(w,3));g.addAttribute("color",new zb(z,3));Wb.call(this,g,u);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=F;this.update()}function re(a,c){void 0===c&&(c=16776960);var d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),g=new Float32Array(24),u=new ob;u.setIndex(new bb(d,1));u.addAttribute("position",new bb(g,
3));Wb.call(this,u,new dc({color:c}));void 0!==a&&this.update(a)}function Fd(a,c,d,g,u,w){jb.call(this);void 0===g&&(g=16776960);void 0===d&&(d=1);void 0===u&&(u=.2*d);void 0===w&&(w=.2*u);this.position.copy(c);this.line=new $c(yg,new dc({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Sb(zg,new jc({color:g}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(d,u,w)}function Hf(a){a=a||1;var c=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new ob;
a.addAttribute("position",new zb(c,3));a.addAttribute("color",new zb([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));c=new dc({vertexColors:2});Wb.call(this,a,c)}function If(a,c,d,g,u,w){bd.call(this,a,c,d,d,g,u,w)}function Ag(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");kg.call(this,a);this.type="catmullrom";this.closed=!0}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});
void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var g=arguments[d];if(void 0!==g&&null!==g)for(var u in g)Object.prototype.hasOwnProperty.call(g,u)&&(c[u]=g[u])}return c}}();h.prototype={addEventListener:function(a,
c){void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===d[a]&&(d[a]=[]);-1===d[a].indexOf(c)&&d[a].push(c)},hasEventListener:function(a,c){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[a]&&-1!==d[a].indexOf(c)},removeEventListener:function(a,c){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(c=a.indexOf(c),-1!==c&&a.splice(c,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var c=this._listeners[a.type];if(void 0!==c){a.target=
this;var d=[],g,u=c.length;for(g=0;g<u;g++)d[g]=c[g];for(g=0;g<u;g++)d[g].call(this,a)}}}};var Bb={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=Array(36),d=0,g;return function(){for(var u=0;36>u;u++)8===u||13===u||18===u||23===u?c[u]="-":14===u?c[u]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),g=d&15,d>>=4,c[u]=a[19===u?g&3|8:g]);return c.join("")}}(),clamp:function(a,c,d){return Math.max(c,Math.min(d,
a))},euclideanModulo:function(a,c){return(a%c+c)%c},mapLinear:function(a,c,d,g,u){return g+(a-c)*(u-g)/(d-c)},lerp:function(a,c,d){return(1-d)*a+d*c},smoothstep:function(a,c,d){if(a<=c)return 0;if(a>=d)return 1;a=(a-c)/(d-c);return a*a*(3-2*a)},smootherstep:function(a,c,d){if(a<=c)return 0;if(a>=d)return 1;a=(a-c)/(d-c);return a*a*a*(a*(6*a-15)+10)},randInt:function(a,c){return a+Math.floor(Math.random()*(c-a+1))},randFloat:function(a,c){return a+Math.random()*(c-a)},randFloatSpread:function(a){return a*
(.5-Math.random())},degToRad:function(a){return a*Bb.DEG2RAD},radToDeg:function(a){return a*Bb.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};l.prototype={constructor:l,isVector2:!0,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,c){this.x=a;this.y=
c;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,c){switch(a){case 0:this.x=c;break;case 1:this.y=c;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=
a.x;this.y=a.y;return this},add:function(a,c){if(void 0!==c)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,c);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;return this},addScaledVector:function(a,c){this.x+=a.x*c;this.y+=a.y*c;return this},sub:function(a,c){if(void 0!==c)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,c);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,c){this.x=Math.max(a.x,Math.min(c.x,this.x));this.y=Math.max(a.y,Math.min(c.y,this.y));return this},clampScalar:function(){var a,c;return function(d,g){void 0===a&&(a=new l,c=new l);a.set(d,d);c.set(g,g);return this.clamp(a,c)}}(),clampLength:function(a,c){var d=this.length();return this.multiplyScalar(Math.max(a,Math.min(c,d))/d)},floor:function(){this.x=Math.floor(this.x);this.y=
Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var c=this.x-a.x;a=this.y-a.y;return c*c+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/
this.length())},lerp:function(a,c){this.x+=(a.x-this.x)*c;this.y+=(a.y-this.y)*c;return this},lerpVectors:function(a,c,d){return this.subVectors(c,a).multiplyScalar(d).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,c){void 0===c&&(c=0);this.x=a[c];this.y=a[c+1];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.x;a[c+1]=this.y;return a},fromAttribute:function(a,c,d){void 0!==d&&console.warn("THREE.Vector2: offset has been removed from .fromAttribute().");
this.x=a.getX(c);this.y=a.getY(c);return this},rotateAround:function(a,c){var d=Math.cos(c);c=Math.sin(c);var g=this.x-a.x,u=this.y-a.y;this.x=g*d-u*c+a.x;this.y=g*c+u*d+a.y;return this}};var Bg=0;e.DEFAULT_IMAGE=void 0;e.DEFAULT_MAPPING=300;e.prototype={constructor:e,isTexture:!0,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=
a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var c={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},
uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=Bb.generateUUID());if(void 0===a.images[d.uuid]){var g=a.images,u=d.uuid,w=d.uuid;if(void 0!==d.toDataURL)var z=d;else z=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),
z.width=d.width,z.height=d.height,z.getContext("2d").drawImage(d,0,0,d.width,d.height);z=2048<z.width||2048<z.height?z.toDataURL("image/jpeg",.6):z.toDataURL("image/png");g[u]={uuid:w,url:z}}c.image=d.uuid}return a.textures[this.uuid]=c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300===this.mapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===
Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(e.prototype,h.prototype);r.prototype={constructor:r,isVector4:!0,set:function(a,c,d,g){this.x=a;this.y=c;this.z=d;this.w=g;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=
a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,c){switch(a){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,
this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,c){if(void 0!==c)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,c);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;this.z=a.z+c.z;this.w=a.w+c.w;return this},
addScaledVector:function(a,c){this.x+=a.x*c;this.y+=a.y*c;this.z+=a.z*c;this.w+=a.w*c;return this},sub:function(a,c){if(void 0!==c)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,c);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;this.z=a.z-c.z;this.w=a.w-c.w;return this},multiplyScalar:function(a){isFinite(a)?
(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var c=this.x,d=this.y,g=this.z,u=this.w;a=a.elements;this.x=a[0]*c+a[4]*d+a[8]*g+a[12]*u;this.y=a[1]*c+a[5]*d+a[9]*g+a[13]*u;this.z=a[2]*c+a[6]*d+a[10]*g+a[14]*u;this.w=a[3]*c+a[7]*d+a[11]*g+a[15]*u;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var c=Math.sqrt(1-a.w*a.w);1E-4>c?(this.x=1,this.z=this.y=
0):(this.x=a.x/c,this.y=a.y/c,this.z=a.z/c);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var c=a[0];var d=a[4];var g=a[8],u=a[1],w=a[5],z=a[9];var F=a[2];var J=a[6];var M=a[10];if(.01>Math.abs(d-u)&&.01>Math.abs(g-F)&&.01>Math.abs(z-J)){if(.1>Math.abs(d+u)&&.1>Math.abs(g+F)&&.1>Math.abs(z+J)&&.1>Math.abs(c+w+M-3))return this.set(1,0,0,0),this;a=Math.PI;c=(c+1)/2;w=(w+1)/2;M=(M+1)/2;d=(d+u)/4;g=(g+F)/4;z=(z+J)/4;c>w&&c>M?.01>c?(J=0,d=F=.707106781):(J=Math.sqrt(c),F=d/J,d=g/
J):w>M?.01>w?(J=.707106781,F=0,d=.707106781):(F=Math.sqrt(w),J=d/F,d=z/F):.01>M?(F=J=.707106781,d=0):(d=Math.sqrt(M),J=g/d,F=z/d);this.set(J,F,d,a);return this}a=Math.sqrt((J-z)*(J-z)+(g-F)*(g-F)+(u-d)*(u-d));.001>Math.abs(a)&&(a=1);this.x=(J-z)/a;this.y=(g-F)/a;this.z=(u-d)/a;this.w=Math.acos((c+w+M-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,
a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,c){this.x=Math.max(a.x,Math.min(c.x,this.x));this.y=Math.max(a.y,Math.min(c.y,this.y));this.z=Math.max(a.z,Math.min(c.z,this.z));this.w=Math.max(a.w,Math.min(c.w,this.w));return this},clampScalar:function(){var a,c;return function(d,g){void 0===a&&(a=new r,c=new r);a.set(d,d,d,d);c.set(g,g,g,g);return this.clamp(a,c)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);
this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);
this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},
normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,c){this.x+=(a.x-this.x)*c;this.y+=(a.y-this.y)*c;this.z+=(a.z-this.z)*c;this.w+=(a.w-this.w)*c;return this},lerpVectors:function(a,c,d){return this.subVectors(c,a).multiplyScalar(d).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,c){void 0===c&&(c=0);this.x=a[c];this.y=a[c+1];this.z=a[c+2];this.w=
a[c+3];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.x;a[c+1]=this.y;a[c+2]=this.z;a[c+3]=this.w;return a},fromAttribute:function(a,c,d){void 0!==d&&console.warn("THREE.Vector4: offset has been removed from .fromAttribute().");this.x=a.getX(c);this.y=a.getY(c);this.z=a.getZ(c);this.w=a.getW(c);return this}};q.prototype={constructor:q,isWebGLRenderTarget:!0,setSize:function(a,c){if(this.width!==a||this.height!==c)this.width=a,this.height=c,this.dispose();this.viewport.set(0,
0,a,c);this.scissor.set(0,0,a,c)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(q.prototype,h.prototype);k.prototype=Object.create(q.prototype);k.prototype.constructor=k;k.prototype.isWebGLRenderTargetCube=
!0;t.prototype={constructor:t,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,c,d,g){this._x=a;this._y=c;this._z=d;this._w=g;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=
a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,c){if(!1===(a&&a.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var d=Math.cos(a._x/2),g=Math.cos(a._y/2),u=Math.cos(a._z/2),w=Math.sin(a._x/2),z=Math.sin(a._y/2),F=Math.sin(a._z/2);a=a.order;"XYZ"===a?(this._x=w*g*u+d*z*F,this._y=d*z*u-w*g*F,this._z=d*g*F+w*z*u,this._w=d*g*u-w*z*F):"YXZ"===a?(this._x=w*g*u+d*z*F,this._y=d*z*
u-w*g*F,this._z=d*g*F-w*z*u,this._w=d*g*u+w*z*F):"ZXY"===a?(this._x=w*g*u-d*z*F,this._y=d*z*u+w*g*F,this._z=d*g*F+w*z*u,this._w=d*g*u-w*z*F):"ZYX"===a?(this._x=w*g*u-d*z*F,this._y=d*z*u+w*g*F,this._z=d*g*F-w*z*u,this._w=d*g*u+w*z*F):"YZX"===a?(this._x=w*g*u+d*z*F,this._y=d*z*u+w*g*F,this._z=d*g*F-w*z*u,this._w=d*g*u-w*z*F):"XZY"===a&&(this._x=w*g*u-d*z*F,this._y=d*z*u-w*g*F,this._z=d*g*F+w*z*u,this._w=d*g*u+w*z*F);if(!1!==c)this.onChangeCallback();return this},setFromAxisAngle:function(a,c){c/=2;
var d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var c=a.elements,d=c[0];a=c[4];var g=c[8],u=c[1],w=c[5],z=c[9],F=c[2],J=c[6];c=c[10];var M=d+w+c;0<M?(d=.5/Math.sqrt(M+1),this._w=.25/d,this._x=(J-z)*d,this._y=(g-F)*d,this._z=(u-a)*d):d>w&&d>c?(d=2*Math.sqrt(1+d-w-c),this._w=(J-z)/d,this._x=.25*d,this._y=(a+u)/d,this._z=(g+F)/d):w>c?(d=2*Math.sqrt(1+w-d-c),this._w=(g-F)/d,this._x=(a+u)/d,this._y=.25*
d,this._z=(z+J)/d):(d=2*Math.sqrt(1+c-d-w),this._w=(u-a)/d,this._x=(g+F)/d,this._y=(z+J)/d,this._z=.25*d);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,c;return function(d,g){void 0===a&&(a=new p);c=d.dot(g)+1;1E-6>c?(c=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,g);this._x=a.x;this._y=a.y;this._z=a.z;this._w=c;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=
-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,
c){return void 0!==c?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,c)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,c){var d=a._x,g=a._y,u=a._z;a=a._w;var w=c._x,z=c._y,F=c._z;c=c._w;this._x=d*c+a*w+g*F-u*z;this._y=g*c+a*z+u*w-d*F;this._z=u*c+a*F+d*z-g*w;this._w=a*c-d*w-g*z-u*F;this.onChangeCallback();return this},
slerp:function(a,c){if(0===c)return this;if(1===c)return this.copy(a);var d=this._x,g=this._y,u=this._z,w=this._w,z=w*a._w+d*a._x+g*a._y+u*a._z;0>z?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,z=-z):this.copy(a);if(1<=z)return this._w=w,this._x=d,this._y=g,this._z=u,this;a=Math.sqrt(1-z*z);if(.001>Math.abs(a))return this._w=.5*(w+this._w),this._x=.5*(d+this._x),this._y=.5*(g+this._y),this._z=.5*(u+this._z),this;var F=Math.atan2(a,z);z=Math.sin((1-c)*F)/a;c=Math.sin(c*F)/a;this._w=w*z+
this._w*c;this._x=d*z+this._x*c;this._y=g*z+this._y*c;this._z=u*z+this._z*c;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,c){void 0===c&&(c=0);this._x=a[c];this._y=a[c+1];this._z=a[c+2];this._w=a[c+3];this.onChangeCallback();return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this._x;a[c+1]=this._y;a[c+2]=this._z;a[c+3]=this._w;return a},onChange:function(a){this.onChangeCallback=
a;return this},onChangeCallback:function(){}};Object.assign(t,{slerp:function(a,c,d,g){return d.copy(a).slerp(c,g)},slerpFlat:function(a,c,d,g,u,w,z){var F=d[g+0],J=d[g+1],M=d[g+2];d=d[g+3];g=u[w+0];var R=u[w+1],O=u[w+2];u=u[w+3];if(d!==u||F!==g||J!==R||M!==O){w=1-z;var Q=F*g+J*R+M*O+d*u,W=0<=Q?1:-1,ca=1-Q*Q;ca>Number.EPSILON&&(ca=Math.sqrt(ca),Q=Math.atan2(ca,Q*W),w=Math.sin(w*Q)/ca,z=Math.sin(z*Q)/ca);W*=z;F=F*w+g*W;J=J*w+R*W;M=M*w+O*W;d=d*w+u*W;w===1-z&&(z=1/Math.sqrt(F*F+J*J+M*M+d*d),F*=z,J*=
z,M*=z,d*=z)}a[c]=F;a[c+1]=J;a[c+2]=M;a[c+3]=d}});p.prototype={constructor:p,isVector3:!0,set:function(a,c,d){this.x=a;this.y=c;this.z=d;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,c){switch(a){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;
case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,c);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},
addVectors:function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;this.z=a.z+c.z;return this},addScaledVector:function(a,c){this.x+=a.x*c;this.y+=a.y*c;this.z+=a.z*c;return this},sub:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,c);this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;this.z=
a.z-c.z;return this},multiply:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,c);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,c){this.x=a.x*c.x;this.y=a.y*c.y;this.z=a.z*c.z;return this},applyEuler:function(){var a;return function(c){!1===(c&&
c.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new t);return this.applyQuaternion(a.setFromEuler(c))}}(),applyAxisAngle:function(){var a;return function(c,d){void 0===a&&(a=new t);return this.applyQuaternion(a.setFromAxisAngle(c,d))}}(),applyMatrix3:function(a){var c=this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*c+a[3]*d+a[6]*g;this.y=a[1]*c+a[4]*d+a[7]*g;this.z=a[2]*c+a[5]*d+a[8]*g;return this},applyMatrix4:function(a){var c=
this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*c+a[4]*d+a[8]*g+a[12];this.y=a[1]*c+a[5]*d+a[9]*g+a[13];this.z=a[2]*c+a[6]*d+a[10]*g+a[14];return this},applyProjection:function(a){var c=this.x,d=this.y,g=this.z;a=a.elements;var u=1/(a[3]*c+a[7]*d+a[11]*g+a[15]);this.x=(a[0]*c+a[4]*d+a[8]*g+a[12])*u;this.y=(a[1]*c+a[5]*d+a[9]*g+a[13])*u;this.z=(a[2]*c+a[6]*d+a[10]*g+a[14])*u;return this},applyQuaternion:function(a){var c=this.x,d=this.y,g=this.z,u=a.x,w=a.y,z=a.z;a=a.w;var F=a*c+w*g-z*d,J=a*d+z*
c-u*g,M=a*g+u*d-w*c;c=-u*c-w*d-z*g;this.x=F*a+c*-u+J*-z-M*-w;this.y=J*a+c*-w+M*-u-F*-z;this.z=M*a+c*-z+F*-w-J*-u;return this},project:function(){var a;return function(c){void 0===a&&(a=new y);a.multiplyMatrices(c.projectionMatrix,a.getInverse(c.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(c){void 0===a&&(a=new y);a.multiplyMatrices(c.matrixWorld,a.getInverse(c.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var c=
this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*c+a[4]*d+a[8]*g;this.y=a[1]*c+a[5]*d+a[9]*g;this.z=a[2]*c+a[6]*d+a[10]*g;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,
c){this.x=Math.max(a.x,Math.min(c.x,this.x));this.y=Math.max(a.y,Math.min(c.y,this.y));this.z=Math.max(a.z,Math.min(c.z,this.z));return this},clampScalar:function(){var a,c;return function(d,g){void 0===a&&(a=new p,c=new p);a.set(d,d,d);c.set(g,g,g);return this.clamp(a,c)}}(),clampLength:function(a,c){var d=this.length();return this.multiplyScalar(Math.max(a,Math.min(c,d))/d)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=
Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*
a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,c){this.x+=(a.x-this.x)*c;this.y+=(a.y-this.y)*c;this.z+=(a.z-this.z)*c;return this},lerpVectors:function(a,
c,d){return this.subVectors(c,a).multiplyScalar(d).add(a)},cross:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,c);c=this.x;var d=this.y,g=this.z;this.x=d*a.z-g*a.y;this.y=g*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,c){var d=a.x,g=a.y;a=a.z;var u=c.x,w=c.y;c=c.z;this.x=g*c-a*w;this.y=a*u-d*c;this.z=d*w-g*u;return this},projectOnVector:function(a){var c=a.dot(this)/
a.lengthSq();return this.copy(a).multiplyScalar(c)},projectOnPlane:function(){var a;return function(c){void 0===a&&(a=new p);a.copy(this).projectOnVector(c);return this.sub(a)}}(),reflect:function(){var a;return function(c){void 0===a&&(a=new p);return this.sub(a.copy(c).multiplyScalar(2*this.dot(c)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(Bb.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var c=
this.x-a.x,d=this.y-a.y;a=this.z-a.z;return c*c+d*d+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var c=Math.sin(a.phi)*a.radius;this.x=c*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=c*Math.cos(a.theta);return this},setFromCylindrical:function(a){this.x=a.radius*Math.sin(a.theta);this.y=a.y;this.z=a.radius*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,
3)},setFromMatrixScale:function(a){var c=this.setFromMatrixColumn(a,0).length(),d=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=c;this.y=d;this.z=a;return this},setFromMatrixColumn:function(a,c){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var d=a;a=c;c=d}return this.fromArray(a.elements,4*c)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,c){void 0===c&&
(c=0);this.x=a[c];this.y=a[c+1];this.z=a[c+2];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.x;a[c+1]=this.y;a[c+2]=this.z;return a},fromAttribute:function(a,c,d){void 0!==d&&console.warn("THREE.Vector3: offset has been removed from .fromAttribute().");this.x=a.getX(c);this.y=a.getY(c);this.z=a.getZ(c);return this}};y.prototype={constructor:y,isMatrix4:!0,set:function(a,c,d,g,u,w,z,F,J,M,R,O,Q,W,ca,ea){var na=this.elements;na[0]=a;na[4]=c;na[8]=d;na[12]=g;na[1]=
u;na[5]=w;na[9]=z;na[13]=F;na[2]=J;na[6]=M;na[10]=R;na[14]=O;na[3]=Q;na[7]=W;na[11]=ca;na[15]=ea;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new y).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var c=this.elements;a=a.elements;c[12]=a[12];c[13]=a[13];c[14]=a[14];return this},extractBasis:function(a,c,d){a.setFromMatrixColumn(this,0);c.setFromMatrixColumn(this,1);d.setFromMatrixColumn(this,
2);return this},makeBasis:function(a,c,d){this.set(a.x,c.x,d.x,0,a.y,c.y,d.y,0,a.z,c.z,d.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(c){void 0===a&&(a=new p);var d=this.elements,g=c.elements,u=1/a.setFromMatrixColumn(c,0).length(),w=1/a.setFromMatrixColumn(c,1).length();c=1/a.setFromMatrixColumn(c,2).length();d[0]=g[0]*u;d[1]=g[1]*u;d[2]=g[2]*u;d[4]=g[4]*w;d[5]=g[5]*w;d[6]=g[6]*w;d[8]=g[8]*c;d[9]=g[9]*c;d[10]=g[10]*c;return this}}(),makeRotationFromEuler:function(a){!1===
(a&&a.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=this.elements,d=a.x,g=a.y,u=a.z,w=Math.cos(d);d=Math.sin(d);var z=Math.cos(g);g=Math.sin(g);var F=Math.cos(u);u=Math.sin(u);if("XYZ"===a.order){a=w*F;var J=w*u,M=d*F,R=d*u;c[0]=z*F;c[4]=-z*u;c[8]=g;c[1]=J+M*g;c[5]=a-R*g;c[9]=-d*z;c[2]=R-a*g;c[6]=M+J*g;c[10]=w*z}else"YXZ"===a.order?(a=z*F,J=z*u,M=g*F,R=g*u,c[0]=a+R*d,c[4]=M*d-J,c[8]=w*g,c[1]=w*u,c[5]=w*F,c[9]=
-d,c[2]=J*d-M,c[6]=R+a*d,c[10]=w*z):"ZXY"===a.order?(a=z*F,J=z*u,M=g*F,R=g*u,c[0]=a-R*d,c[4]=-w*u,c[8]=M+J*d,c[1]=J+M*d,c[5]=w*F,c[9]=R-a*d,c[2]=-w*g,c[6]=d,c[10]=w*z):"ZYX"===a.order?(a=w*F,J=w*u,M=d*F,R=d*u,c[0]=z*F,c[4]=M*g-J,c[8]=a*g+R,c[1]=z*u,c[5]=R*g+a,c[9]=J*g-M,c[2]=-g,c[6]=d*z,c[10]=w*z):"YZX"===a.order?(a=w*z,J=w*g,M=d*z,R=d*g,c[0]=z*F,c[4]=R-a*u,c[8]=M*u+J,c[1]=u,c[5]=w*F,c[9]=-d*F,c[2]=-g*F,c[6]=J*u+M,c[10]=a-R*u):"XZY"===a.order&&(a=w*z,J=w*g,M=d*z,R=d*g,c[0]=z*F,c[4]=-u,c[8]=g*F,c[1]=
a*u+R,c[5]=w*F,c[9]=J*u-M,c[2]=M*u-J,c[6]=d*F,c[10]=R*u+a);c[3]=0;c[7]=0;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this},makeRotationFromQuaternion:function(a){var c=this.elements,d=a.x,g=a.y,u=a.z,w=a.w,z=d+d,F=g+g,J=u+u;a=d*z;var M=d*F;d*=J;var R=g*F;g*=J;u*=J;z*=w;F*=w;w*=J;c[0]=1-(R+u);c[4]=M-w;c[8]=d+F;c[1]=M+w;c[5]=1-(a+u);c[9]=g-z;c[2]=d-F;c[6]=g+z;c[10]=1-(a+R);c[3]=0;c[7]=0;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this},lookAt:function(){var a,c,d;return function(g,u,w){void 0===
a&&(a=new p,c=new p,d=new p);var z=this.elements;d.subVectors(g,u).normalize();0===d.lengthSq()&&(d.z=1);a.crossVectors(w,d).normalize();0===a.lengthSq()&&(d.z+=1E-4,a.crossVectors(w,d).normalize());c.crossVectors(d,a);z[0]=a.x;z[4]=c.x;z[8]=d.x;z[1]=a.y;z[5]=c.y;z[9]=d.y;z[2]=a.z;z[6]=c.z;z[10]=d.z;return this}}(),multiply:function(a,c){return void 0!==c?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,c)):this.multiplyMatrices(this,
a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,c){var d=a.elements,g=c.elements;c=this.elements;a=d[0];var u=d[4],w=d[8],z=d[12],F=d[1],J=d[5],M=d[9],R=d[13],O=d[2],Q=d[6],W=d[10],ca=d[14],ea=d[3],na=d[7],ra=d[11];d=d[15];var aa=g[0],qa=g[4],oa=g[8],wa=g[12],ta=g[1],za=g[5],Ja=g[9],Ia=g[13],Oa=g[2],Ua=g[6],Na=g[10],Sa=g[14],ab=g[3],Pa=g[7],Ma=g[11];g=g[15];c[0]=a*aa+u*ta+w*Oa+z*ab;c[4]=a*qa+u*za+w*Ua+z*Pa;c[8]=a*oa+u*Ja+w*Na+z*Ma;c[12]=a*wa+u*Ia+w*Sa+
z*g;c[1]=F*aa+J*ta+M*Oa+R*ab;c[5]=F*qa+J*za+M*Ua+R*Pa;c[9]=F*oa+J*Ja+M*Na+R*Ma;c[13]=F*wa+J*Ia+M*Sa+R*g;c[2]=O*aa+Q*ta+W*Oa+ca*ab;c[6]=O*qa+Q*za+W*Ua+ca*Pa;c[10]=O*oa+Q*Ja+W*Na+ca*Ma;c[14]=O*wa+Q*Ia+W*Sa+ca*g;c[3]=ea*aa+na*ta+ra*Oa+d*ab;c[7]=ea*qa+na*za+ra*Ua+d*Pa;c[11]=ea*oa+na*Ja+ra*Na+d*Ma;c[15]=ea*wa+na*Ia+ra*Sa+d*g;return this},multiplyToArray:function(a,c,d){var g=this.elements;this.multiplyMatrices(a,c);d[0]=g[0];d[1]=g[1];d[2]=g[2];d[3]=g[3];d[4]=g[4];d[5]=g[5];d[6]=g[6];d[7]=g[7];d[8]=g[8];
d[9]=g[9];d[10]=g[10];d[11]=g[11];d[12]=g[12];d[13]=g[13];d[14]=g[14];d[15]=g[15];return this},multiplyScalar:function(a){var c=this.elements;c[0]*=a;c[4]*=a;c[8]*=a;c[12]*=a;c[1]*=a;c[5]*=a;c[9]*=a;c[13]*=a;c[2]*=a;c[6]*=a;c[10]*=a;c[14]*=a;c[3]*=a;c[7]*=a;c[11]*=a;c[15]*=a;return this},applyToBufferAttribute:function(){var a;return function(c){void 0===a&&(a=new p);for(var d=0,g=c.count;d<g;d++)a.x=c.getX(d),a.y=c.getY(d),a.z=c.getZ(d),a.applyMatrix4(this),c.setXYZ(d,a.x,a.y,a.z);return c}}(),determinant:function(){var a=
this.elements,c=a[0],d=a[4],g=a[8],u=a[12],w=a[1],z=a[5],F=a[9],J=a[13],M=a[2],R=a[6],O=a[10],Q=a[14];return a[3]*(+u*F*R-g*J*R-u*z*O+d*J*O+g*z*Q-d*F*Q)+a[7]*(+c*F*Q-c*J*O+u*w*O-g*w*Q+g*J*M-u*F*M)+a[11]*(+c*J*R-c*z*Q-u*w*R+d*w*Q+u*z*M-d*J*M)+a[15]*(-g*z*M-c*F*R+c*z*O+g*w*R-d*w*O+d*F*M)},transpose:function(){var a=this.elements;var c=a[1];a[1]=a[4];a[4]=c;c=a[2];a[2]=a[8];a[8]=c;c=a[6];a[6]=a[9];a[9]=c;c=a[3];a[3]=a[12];a[12]=c;c=a[7];a[7]=a[13];a[13]=c;c=a[11];a[11]=a[14];a[14]=c;return this},setPosition:function(a){var c=
this.elements;c[12]=a.x;c[13]=a.y;c[14]=a.z;return this},getInverse:function(a,c){var d=this.elements,g=a.elements;a=g[0];var u=g[1],w=g[2],z=g[3],F=g[4],J=g[5],M=g[6],R=g[7],O=g[8],Q=g[9],W=g[10],ca=g[11],ea=g[12],na=g[13],ra=g[14];g=g[15];var aa=Q*ra*R-na*W*R+na*M*ca-J*ra*ca-Q*M*g+J*W*g,qa=ea*W*R-O*ra*R-ea*M*ca+F*ra*ca+O*M*g-F*W*g,oa=O*na*R-ea*Q*R+ea*J*ca-F*na*ca-O*J*g+F*Q*g,wa=ea*Q*M-O*na*M-ea*J*W+F*na*W+O*J*ra-F*Q*ra,ta=a*aa+u*qa+w*oa+z*wa;if(0===ta){if(!0===c)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}c=1/ta;d[0]=aa*c;d[1]=(na*W*z-Q*ra*z-na*w*ca+u*ra*ca+Q*w*g-u*W*g)*c;d[2]=(J*ra*z-na*M*z+na*w*R-u*ra*R-J*w*g+u*M*g)*c;d[3]=(Q*M*z-J*W*z-Q*w*R+u*W*R+J*w*ca-u*M*ca)*c;d[4]=qa*c;d[5]=(O*ra*z-ea*W*z+ea*w*ca-a*ra*ca-O*w*g+a*W*g)*c;d[6]=(ea*M*z-F*ra*z-ea*w*R+a*ra*R+F*w*g-a*M*g)*c;d[7]=(F*W*z-O*M*z+O*w*R-a*W*R-F*w*ca+a*M*ca)*c;d[8]=oa*c;d[9]=(ea*Q*z-O*na*z-ea*u*ca+a*na*ca+O*u*g-a*Q*g)*c;d[10]=(F*na*z-
ea*J*z+ea*u*R-a*na*R-F*u*g+a*J*g)*c;d[11]=(O*J*z-F*Q*z-O*u*R+a*Q*R+F*u*ca-a*J*ca)*c;d[12]=wa*c;d[13]=(O*na*w-ea*Q*w+ea*u*W-a*na*W-O*u*ra+a*Q*ra)*c;d[14]=(ea*J*w-F*na*w-ea*u*M+a*na*M+F*u*ra-a*J*ra)*c;d[15]=(F*Q*w-O*J*w+O*u*M-a*Q*M-F*u*W+a*J*W)*c;return this},scale:function(a){var c=this.elements,d=a.x,g=a.y;a=a.z;c[0]*=d;c[4]*=g;c[8]*=a;c[1]*=d;c[5]*=g;c[9]*=a;c[2]*=d;c[6]*=g;c[10]*=a;c[3]*=d;c[7]*=g;c[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,c,d){this.set(1,0,0,a,0,1,0,c,0,0,1,d,0,0,0,1);return this},makeRotationX:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,c,-a,0,0,a,c,0,0,0,0,1);return this},makeRotationY:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(c,0,a,0,0,1,0,0,-a,0,c,0,0,0,0,1);return this},makeRotationZ:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(c,-a,0,0,a,c,0,0,0,0,1,0,0,0,
0,1);return this},makeRotationAxis:function(a,c){var d=Math.cos(c);c=Math.sin(c);var g=1-d,u=a.x,w=a.y;a=a.z;var z=g*u,F=g*w;this.set(z*u+d,z*w-c*a,z*a+c*w,0,z*w+c*a,F*w+d,F*a-c*u,0,z*a-c*w,F*a+c*u,g*a*a+d,0,0,0,0,1);return this},makeScale:function(a,c,d){this.set(a,0,0,0,0,c,0,0,0,0,d,0,0,0,0,1);return this},makeShear:function(a,c,d){this.set(1,c,d,0,a,1,d,0,a,c,1,0,0,0,0,1);return this},compose:function(a,c,d){this.makeRotationFromQuaternion(c);this.scale(d);this.setPosition(a);return this},decompose:function(){var a,
c;return function(d,g,u){void 0===a&&(a=new p,c=new y);var w=this.elements,z=a.set(w[0],w[1],w[2]).length(),F=a.set(w[4],w[5],w[6]).length(),J=a.set(w[8],w[9],w[10]).length();0>this.determinant()&&(z=-z);d.x=w[12];d.y=w[13];d.z=w[14];c.elements.set(this.elements);d=1/z;w=1/F;var M=1/J;c.elements[0]*=d;c.elements[1]*=d;c.elements[2]*=d;c.elements[4]*=w;c.elements[5]*=w;c.elements[6]*=w;c.elements[8]*=M;c.elements[9]*=M;c.elements[10]*=M;g.setFromRotationMatrix(c);u.x=z;u.y=F;u.z=J;return this}}(),
makePerspective:function(a,c,d,g,u,w){void 0===w&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var z=this.elements;z[0]=2*u/(c-a);z[4]=0;z[8]=(c+a)/(c-a);z[12]=0;z[1]=0;z[5]=2*u/(d-g);z[9]=(d+g)/(d-g);z[13]=0;z[2]=0;z[6]=0;z[10]=-(w+u)/(w-u);z[14]=-2*w*u/(w-u);z[3]=0;z[7]=0;z[11]=-1;z[15]=0;return this},makeOrthographic:function(a,c,d,g,u,w){var z=this.elements,F=1/(c-a),J=1/(d-g),M=1/(w-u);z[0]=2*F;z[4]=0;z[8]=0;z[12]=-((c+a)*
F);z[1]=0;z[5]=2*J;z[9]=0;z[13]=-((d+g)*J);z[2]=0;z[6]=0;z[10]=-2*M;z[14]=-((w+u)*M);z[3]=0;z[7]=0;z[11]=0;z[15]=1;return this},equals:function(a){var c=this.elements;a=a.elements;for(var d=0;16>d;d++)if(c[d]!==a[d])return!1;return!0},fromArray:function(a,c){void 0===c&&(c=0);for(var d=0;16>d;d++)this.elements[d]=a[d+c];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);var d=this.elements;a[c]=d[0];a[c+1]=d[1];a[c+2]=d[2];a[c+3]=d[3];a[c+4]=d[4];a[c+5]=d[5];a[c+6]=d[6];a[c+7]=
d[7];a[c+8]=d[8];a[c+9]=d[9];a[c+10]=d[10];a[c+11]=d[11];a[c+12]=d[12];a[c+13]=d[13];a[c+14]=d[14];a[c+15]=d[15];return a}};A.prototype=Object.create(e.prototype);A.prototype.constructor=A;A.prototype.isCubeTexture=!0;Object.defineProperty(A.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});var pg=new e,qg=new A,ng=[],og=[];da.prototype.setValue=function(a,c){for(var d=this.seq,g=0,u=d.length;g!==u;++g){var w=d[g];w.setValue(a,c[w.id])}};var Kf=/([\w\d_]+)(\])?(\[|\.)?/g;
pa.prototype.setValue=function(a,c,d){c=this.map[c];void 0!==c&&c.setValue(a,d,this.renderer)};pa.prototype.set=function(a,c,d){var g=this.map[d];void 0!==g&&g.setValue(a,c[d],this.renderer)};pa.prototype.setOptional=function(a,c,d){c=c[d];void 0!==c&&this.setValue(a,d,c)};pa.upload=function(a,c,d,g){for(var u=0,w=c.length;u!==w;++u){var z=c[u],F=d[z.id];!1!==F.needsUpdate&&z.setValue(a,F.value,g)}};pa.seqWithValue=function(a,c){for(var d=[],g=0,u=a.length;g!==u;++g){var w=a[g];w.id in c&&d.push(w)}return d};
var rc={merge:function(a){for(var c={},d=0;d<a.length;d++){var g=this.clone(a[d]),u;for(u in g)c[u]=g[u]}return c},clone:function(a){var c={},d;for(d in a){c[d]={};for(var g in a[d]){var u=a[d][g];u&&(u.isColor||u.isMatrix3||u.isMatrix4||u.isVector2||u.isVector3||u.isVector4||u.isTexture)?c[d][g]=u.clone():Array.isArray(u)?c[d][g]=u.slice():c[d][g]=u}}return c}},Nb={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",
alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",
color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n    }\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = material.specularRoughness;\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n    }\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#include <premultiplied_alpha_fragment>\n\t#include <encodings_fragment>\n}\n",
normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};la.prototype={constructor:la,
isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,c,d){this.r=a;this.g=c;this.b=d;return this},setHSL:function(){function a(c,d,g){0>g&&(g+=1);1<g&&--g;return g<1/6?c+6*(d-c)*g:.5>g?d:g<2/3?c+6*(d-c)*(2/3-g):c}return function(c,
d,g){c=Bb.euclideanModulo(c,1);d=Bb.clamp(d,0,1);g=Bb.clamp(g,0,1);0===d?this.r=this.g=this.b=g:(d=.5>=g?g*(1+d):g+d-g*d,g=2*g-d,this.r=a(g,d,c+1/3),this.g=a(g,d,c),this.b=a(g,d,c-1/3));return this}}(),setStyle:function(a){function c(z){void 0!==z&&1>parseFloat(z)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var d;if(d=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var g=d[2];switch(d[1]){case "rgb":case "rgba":if(d=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=
Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,c(d[5]),this;if(d=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,c(d[5]),this;break;case "hsl":case "hsla":if(d=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g)){g=parseFloat(d[1])/
360;var u=parseInt(d[2],10)/100,w=parseInt(d[3],10)/100;c(d[5]);return this.setHSL(g,u,w)}}}else if(d=/^#([A-Fa-f0-9]+)$/.exec(a)){d=d[1];g=d.length;if(3===g)return this.r=parseInt(d.charAt(0)+d.charAt(0),16)/255,this.g=parseInt(d.charAt(1)+d.charAt(1),16)/255,this.b=parseInt(d.charAt(2)+d.charAt(2),16)/255,this;if(6===g)return this.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,this.g=parseInt(d.charAt(2)+d.charAt(3),16)/255,this.b=parseInt(d.charAt(4)+d.charAt(5),16)/255,this}a&&0<a.length&&(d=Kg[a],
void 0!==d?this.setHex(d):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,c){void 0===c&&(c=2);this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},copyLinearToGamma:function(a,c){void 0===c&&(c=2);c=0<c?1/c:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},convertGammaToLinear:function(){var a=
this.r,c=this.g,d=this.b;this.r=a*a;this.g=c*c;this.b=d*d;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var c=this.r,d=this.g,g=this.b,u=Math.max(c,d,g),w=Math.min(c,d,g),z,F=(w+u)/2;if(w===u)w=z=0;else{var J=u-w;w=.5>=F?J/(u+w):
J/(2-u-w);switch(u){case c:z=(d-g)/J+(d<g?6:0);break;case d:z=(g-c)/J+2;break;case g:z=(c-d)/J+4}z/=6}a.h=z;a.s=w;a.l=F;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,c,d){var g=this.getHSL();g.h+=a;g.s+=c;g.l+=d;this.setHSL(g.h,g.s,g.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,c){this.r=a.r+c.r;this.g=a.g+c.g;this.b=a.b+c.b;return this},addScalar:function(a){this.r+=
a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,c){this.r+=(a.r-this.r)*c;this.g+=(a.g-this.g)*c;this.b+=(a.b-this.b)*c;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,c){void 0===c&&(c=
0);this.r=a[c];this.g=a[c+1];this.b=a[c+2];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.r;a[c+1]=this.g;a[c+2]=this.b;return a},toJSON:function(){return this.getHex()}};var Kg={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,
cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,
floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,
lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,
moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,
silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};xa.prototype=Object.create(e.prototype);xa.prototype.constructor=xa;xa.prototype.isDataTexture=!0;var Db={common:{diffuse:{value:new la(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new r(0,
0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new l(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},
roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new la(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},
direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},
width:{},height:{}}}},points:{diffuse:{value:new la(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new r(0,0,1,1)}}},Gd={basic:{uniforms:rc.merge([Db.common,Db.aomap,Db.lightmap,Db.fog]),vertexShader:Nb.meshbasic_vert,fragmentShader:Nb.meshbasic_frag},lambert:{uniforms:rc.merge([Db.common,Db.aomap,Db.lightmap,Db.emissivemap,Db.fog,Db.lights,{emissive:{value:new la(0)}}]),vertexShader:Nb.meshlambert_vert,fragmentShader:Nb.meshlambert_frag},phong:{uniforms:rc.merge([Db.common,
Db.aomap,Db.lightmap,Db.emissivemap,Db.bumpmap,Db.normalmap,Db.displacementmap,Db.gradientmap,Db.fog,Db.lights,{emissive:{value:new la(0)},specular:{value:new la(1118481)},shininess:{value:30}}]),vertexShader:Nb.meshphong_vert,fragmentShader:Nb.meshphong_frag},standard:{uniforms:rc.merge([Db.common,Db.aomap,Db.lightmap,Db.emissivemap,Db.bumpmap,Db.normalmap,Db.displacementmap,Db.roughnessmap,Db.metalnessmap,Db.fog,Db.lights,{emissive:{value:new la(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),
vertexShader:Nb.meshphysical_vert,fragmentShader:Nb.meshphysical_frag},points:{uniforms:rc.merge([Db.points,Db.fog]),vertexShader:Nb.points_vert,fragmentShader:Nb.points_frag},dashed:{uniforms:rc.merge([Db.common,Db.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Nb.linedashed_vert,fragmentShader:Nb.linedashed_frag},depth:{uniforms:rc.merge([Db.common,Db.displacementmap]),vertexShader:Nb.depth_vert,fragmentShader:Nb.depth_frag},normal:{uniforms:rc.merge([Db.common,Db.bumpmap,
Db.normalmap,Db.displacementmap,{opacity:{value:1}}]),vertexShader:Nb.normal_vert,fragmentShader:Nb.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Nb.cube_vert,fragmentShader:Nb.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Nb.equirect_vert,fragmentShader:Nb.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new p}},vertexShader:Nb.distanceRGBA_vert,fragmentShader:Nb.distanceRGBA_frag}};Gd.physical={uniforms:rc.merge([Gd.standard.uniforms,
{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Nb.meshphysical_vert,fragmentShader:Nb.meshphysical_frag};Ba.prototype={constructor:Ba,set:function(a,c){this.min.copy(a);this.max.copy(c);return this},setFromPoints:function(a){this.makeEmpty();for(var c=0,d=a.length;c<d;c++)this.expandByPoint(a[c]);return this},setFromCenterAndSize:function(){var a=new l;return function(c,d){d=a.copy(d).multiplyScalar(.5);this.min.copy(c).sub(d);this.max.copy(c).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){a=a||new l;return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new l;return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);
return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,c){return(c||new l).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-
this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,c){return(c||new l).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new l;return function(c){return a.copy(c).clamp(this.min,this.max).sub(c).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);
this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};var Cg=0;$a.prototype={constructor:$a,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var c in a){var d=a[c];if(void 0===d)console.warn("THREE.Material: '"+c+"' parameter is undefined.");else{var g=this[c];void 0===g?console.warn("THREE."+this.type+": '"+c+"' is not a property of this material."):
g&&g.isColor?g.set(d):g&&g.isVector3&&d&&d.isVector3?g.copy(d):this[c]="overdraw"===c?Number(d):d}}},toJSON:function(a){function c(u){var w=[],z;for(z in u){var F=u[z];delete F.metadata;w.push(F)}return w}var d=void 0===a;d&&(a={textures:{},images:{}});var g={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};g.uuid=this.uuid;g.type=this.type;""!==this.name&&(g.name=this.name);this.color&&this.color.isColor&&(g.color=this.color.getHex());void 0!==this.roughness&&(g.roughness=this.roughness);
void 0!==this.metalness&&(g.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(g.emissive=this.emissive.getHex());this.specular&&this.specular.isColor&&(g.specular=this.specular.getHex());void 0!==this.shininess&&(g.shininess=this.shininess);void 0!==this.clearCoat&&(g.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(g.clearCoatRoughness=this.clearCoatRoughness);this.map&&this.map.isTexture&&(g.map=this.map.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(g.alphaMap=
this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(g.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap&&this.bumpMap.isTexture&&(g.bumpMap=this.bumpMap.toJSON(a).uuid,g.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(g.normalMap=this.normalMap.toJSON(a).uuid,g.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(g.displacementMap=this.displacementMap.toJSON(a).uuid,g.displacementScale=this.displacementScale,g.displacementBias=
this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(g.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(g.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(g.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(g.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(g.envMap=this.envMap.toJSON(a).uuid,g.reflectivity=this.reflectivity);
this.gradientMap&&this.gradientMap.isTexture&&(g.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.size&&(g.size=this.size);void 0!==this.sizeAttenuation&&(g.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(g.blending=this.blending);2!==this.shading&&(g.shading=this.shading);0!==this.side&&(g.side=this.side);0!==this.vertexColors&&(g.vertexColors=this.vertexColors);1>this.opacity&&(g.opacity=this.opacity);!0===this.transparent&&(g.transparent=this.transparent);g.depthFunc=this.depthFunc;
g.depthTest=this.depthTest;g.depthWrite=this.depthWrite;0<this.alphaTest&&(g.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(g.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(g.wireframe=this.wireframe);1<this.wireframeLinewidth&&(g.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(g.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(g.wireframeLinejoin=this.wireframeLinejoin);g.skinning=this.skinning;g.morphTargets=this.morphTargets;
d&&(d=c(a.textures),a=c(a.images),0<d.length&&(g.textures=d),0<a.length&&(g.images=a));return g},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=
a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;this.clipIntersection=a.clipIntersection;
a=a.clippingPlanes;var c=null;if(null!==a){var d=a.length;c=Array(d);for(var g=0;g!==d;++g)c[g]=a[g].clone()}this.clippingPlanes=c;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign($a.prototype,h.prototype);kb.prototype=Object.create($a.prototype);kb.prototype.constructor=kb;kb.prototype.isShaderMaterial=!0;kb.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=
a.vertexShader;this.uniforms=rc.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};kb.prototype.toJSON=function(a){a=$a.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};Ib.prototype=
Object.create($a.prototype);Ib.prototype.constructor=Ib;Ib.prototype.isMeshDepthMaterial=!0;Ib.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};wb.prototype=
{constructor:wb,isBox3:!0,set:function(a,c){this.min.copy(a);this.max.copy(c);return this},setFromArray:function(a){for(var c=Infinity,d=Infinity,g=Infinity,u=-Infinity,w=-Infinity,z=-Infinity,F=0,J=a.length;F<J;F+=3){var M=a[F],R=a[F+1],O=a[F+2];M<c&&(c=M);R<d&&(d=R);O<g&&(g=O);M>u&&(u=M);R>w&&(w=R);O>z&&(z=O)}this.min.set(c,d,g);this.max.set(u,w,z)},setFromBufferAttribute:function(a){for(var c=Infinity,d=Infinity,g=Infinity,u=-Infinity,w=-Infinity,z=-Infinity,F=0,J=a.count;F<J;F++){var M=a.getX(F),
R=a.getY(F),O=a.getZ(F);M<c&&(c=M);R<d&&(d=R);O<g&&(g=O);M>u&&(u=M);R>w&&(w=R);O>z&&(z=O)}this.min.set(c,d,g);this.max.set(u,w,z)},setFromPoints:function(a){this.makeEmpty();for(var c=0,d=a.length;c<d;c++)this.expandByPoint(a[c]);return this},setFromCenterAndSize:function(){var a=new p;return function(c,d){d=a.copy(d).multiplyScalar(.5);this.min.copy(c).sub(d);this.max.copy(c).add(d);return this}}(),setFromObject:function(){var a=new p;return function(c){var d=this;c.updateMatrixWorld(!0);this.makeEmpty();
c.traverse(function(g){var u;var w=g.geometry;if(void 0!==w)if(w.isGeometry){var z=w.vertices;w=0;for(u=z.length;w<u;w++)a.copy(z[w]),a.applyMatrix4(g.matrixWorld),d.expandByPoint(a)}else if(w.isBufferGeometry&&(z=w.attributes.position,void 0!==z))for(w=0,u=z.count;w<u;w++)a.fromAttribute(z,w).applyMatrix4(g.matrixWorld),d.expandByPoint(a)});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=
this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){a=a||new p;return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new p;return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);
this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,c){return(c||new p).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/
(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(c){void 0===a&&(a=new p);this.clampPoint(c.center,a);return a.distanceToSquared(c.center)<=c.radius*c.radius}}(),intersectsPlane:function(a){if(0<a.normal.x){var c=a.normal.x*this.min.x;var d=a.normal.x*this.max.x}else c=a.normal.x*
this.max.x,d=a.normal.x*this.min.x;0<a.normal.y?(c+=a.normal.y*this.min.y,d+=a.normal.y*this.max.y):(c+=a.normal.y*this.max.y,d+=a.normal.y*this.min.y);0<a.normal.z?(c+=a.normal.z*this.min.z,d+=a.normal.z*this.max.z):(c+=a.normal.z*this.max.z,d+=a.normal.z*this.min.z);return c<=a.constant&&d>=a.constant},clampPoint:function(a,c){return(c||new p).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new p;return function(c){return a.copy(c).clamp(this.min,this.max).sub(c).length()}}(),
getBoundingSphere:function(){var a=new p;return function(c){c=c||new Mb;this.getCenter(c.center);c.radius=.5*this.getSize(a).length();return c}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new p,new p,new p,new p,new p,new p,new p,new p];return function(c){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(c);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(c);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(c);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(c);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(c);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(c);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(c);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(c);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};Mb.prototype={constructor:Mb,set:function(a,c){this.center.copy(a);this.radius=c;return this},setFromPoints:function(){var a=new wb;return function(c,d){var g=this.center;void 0!==d?g.copy(d):a.setFromPoints(c).getCenter(g);for(var u=d=0,w=c.length;u<w;u++)d=Math.max(d,g.distanceToSquared(c[u]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);
this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var c=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=c*c},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},
clampPoint:function(a,c){var d=this.center.distanceToSquared(a);c=c||new p;c.copy(a);d>this.radius*this.radius&&(c.sub(this.center).normalize(),c.multiplyScalar(this.radius).add(this.center));return c},getBoundingBox:function(a){a=a||new wb;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&
a.radius===this.radius}};Pb.prototype={constructor:Pb,isMatrix3:!0,set:function(a,c,d,g,u,w,z,F,J){var M=this.elements;M[0]=a;M[1]=g;M[2]=z;M[3]=c;M[4]=u;M[5]=F;M[6]=d;M[7]=w;M[8]=J;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],
a[2],a[6],a[10]);return this},applyToBufferAttribute:function(){var a;return function(c){void 0===a&&(a=new p);for(var d=0,g=c.count;d<g;d++)a.x=c.getX(d),a.y=c.getY(d),a.z=c.getZ(d),a.applyMatrix3(this),c.setXYZ(d,a.x,a.y,a.z);return c}}(),multiplyScalar:function(a){var c=this.elements;c[0]*=a;c[3]*=a;c[6]*=a;c[1]*=a;c[4]*=a;c[7]*=a;c[2]*=a;c[5]*=a;c[8]*=a;return this},determinant:function(){var a=this.elements,c=a[0],d=a[1],g=a[2],u=a[3],w=a[4],z=a[5],F=a[6],J=a[7];a=a[8];return c*w*a-c*z*J-d*u*
a+d*z*F+g*u*J-g*w*F},getInverse:function(a,c){a&&a.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var d=a.elements;a=this.elements;var g=d[0],u=d[1],w=d[2],z=d[3],F=d[4],J=d[5],M=d[6],R=d[7];d=d[8];var O=d*F-J*R,Q=J*M-d*z,W=R*z-F*M,ca=g*O+u*Q+w*W;if(0===ca){if(!0===c)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}c=1/ca;
a[0]=O*c;a[1]=(w*R-d*u)*c;a[2]=(J*u-w*F)*c;a[3]=Q*c;a[4]=(d*g-w*M)*c;a[5]=(w*z-J*g)*c;a[6]=W*c;a[7]=(u*M-R*g)*c;a[8]=(F*g-u*z)*c;return this},transpose:function(){var a=this.elements;var c=a[1];a[1]=a[3];a[3]=c;c=a[2];a[2]=a[6];a[6]=c;c=a[5];a[5]=a[7];a[7]=c;return this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var c=this.elements;a[0]=c[0];a[1]=c[3];a[2]=c[6];a[3]=c[1];a[4]=c[4];a[5]=c[7];a[6]=c[2];a[7]=c[5];a[8]=c[8];
return this},fromArray:function(a,c){void 0===c&&(c=0);for(var d=0;9>d;d++)this.elements[d]=a[d+c];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);var d=this.elements;a[c]=d[0];a[c+1]=d[1];a[c+2]=d[2];a[c+3]=d[3];a[c+4]=d[4];a[c+5]=d[5];a[c+6]=d[6];a[c+7]=d[7];a[c+8]=d[8];return a}};Qb.prototype={constructor:Qb,set:function(a,c){this.normal.copy(a);this.constant=c;return this},setComponents:function(a,c,d,g){this.normal.set(a,c,d);this.constant=g;return this},setFromNormalAndCoplanarPoint:function(a,
c){this.normal.copy(a);this.constant=-c.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new p,c=new p;return function(d,g,u){g=a.subVectors(u,g).cross(c.subVectors(d,g)).normalize();this.setFromNormalAndCoplanarPoint(g,d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},
negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,c){return this.orthoPoint(a,c).sub(a).negate()},orthoPoint:function(a,c){a=this.distanceToPoint(a);return(c||new p).copy(this.normal).multiplyScalar(a)},intersectLine:function(){var a=new p;return function(c,d){d=d||new p;var g=c.delta(a),u=this.normal.dot(g);if(0===
u){if(0===this.distanceToPoint(c.start))return d.copy(c.start)}else if(u=-(c.start.dot(this.normal)+this.constant)/u,!(0>u||1<u))return d.copy(g).multiplyScalar(u).add(c.start)}}(),intersectsLine:function(a){var c=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>c&&0<a||0>a&&0<c},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new p).copy(this.normal).multiplyScalar(-this.constant)},
applyMatrix4:function(){var a=new p,c=new Pb;return function(d,g){var u=this.coplanarPoint(a).applyMatrix4(d);d=g||c.getNormalMatrix(d);d=this.normal.applyMatrix3(d).normalize();this.constant=-u.dot(d);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};Wc.prototype={constructor:Wc,set:function(a,c,d,g,u,w){var z=this.planes;z[0].copy(a);z[1].copy(c);z[2].copy(d);z[3].copy(g);z[4].copy(u);
z[5].copy(w);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var c=this.planes,d=0;6>d;d++)c[d].copy(a.planes[d]);return this},setFromMatrix:function(a){var c=this.planes,d=a.elements;a=d[0];var g=d[1],u=d[2],w=d[3],z=d[4],F=d[5],J=d[6],M=d[7],R=d[8],O=d[9],Q=d[10],W=d[11],ca=d[12],ea=d[13],na=d[14];d=d[15];c[0].setComponents(w-a,M-z,W-R,d-ca).normalize();c[1].setComponents(w+a,M+z,W+R,d+ca).normalize();c[2].setComponents(w+g,M+F,W+O,d+ea).normalize();c[3].setComponents(w-
g,M-F,W-O,d-ea).normalize();c[4].setComponents(w-u,M-J,W-Q,d-na).normalize();c[5].setComponents(w+u,M+J,W+Q,d+na).normalize();return this},intersectsObject:function(){var a=new Mb;return function(c){var d=c.geometry;null===d.boundingSphere&&d.computeBoundingSphere();a.copy(d.boundingSphere).applyMatrix4(c.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new Mb;return function(c){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(c.matrixWorld);return this.intersectsSphere(a)}}(),
intersectsSphere:function(a){var c=this.planes,d=a.center;a=-a.radius;for(var g=0;6>g;g++)if(c[g].distanceToPoint(d)<a)return!1;return!0},intersectsBox:function(){var a=new p,c=new p;return function(d){for(var g=this.planes,u=0;6>u;u++){var w=g[u];a.x=0<w.normal.x?d.min.x:d.max.x;c.x=0<w.normal.x?d.max.x:d.min.x;a.y=0<w.normal.y?d.min.y:d.max.y;c.y=0<w.normal.y?d.max.y:d.min.y;a.z=0<w.normal.z?d.min.z:d.max.z;c.z=0<w.normal.z?d.max.z:d.min.z;var z=w.distanceToPoint(a);w=w.distanceToPoint(c);if(0>
z&&0>w)return!1}return!0}}(),containsPoint:function(a){for(var c=this.planes,d=0;6>d;d++)if(0>c[d].distanceToPoint(a))return!1;return!0}};sc.prototype={constructor:sc,set:function(a,c){this.origin.copy(a);this.direction.copy(c);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,c){return(c||new p).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();
return this},recast:function(){var a=new p;return function(c){this.origin.copy(this.at(c,a));return this}}(),closestPointToPoint:function(a,c){c=c||new p;c.subVectors(a,this.origin);a=c.dot(this.direction);return 0>a?c.copy(this.origin):c.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new p;return function(c){var d=a.subVectors(c,this.origin).dot(this.direction);if(0>d)return this.origin.distanceToSquared(c);
a.copy(this.direction).multiplyScalar(d).add(this.origin);return a.distanceToSquared(c)}}(),distanceSqToSegment:function(){var a=new p,c=new p,d=new p;return function(g,u,w,z){a.copy(g).add(u).multiplyScalar(.5);c.copy(u).sub(g).normalize();d.copy(this.origin).sub(a);var F=.5*g.distanceTo(u),J=-this.direction.dot(c),M=d.dot(this.direction),R=-d.dot(c),O=d.lengthSq(),Q=Math.abs(1-J*J);if(0<Q){g=J*R-M;u=J*M-R;var W=F*Q;0<=g?u>=-W?u<=W?(F=1/Q,g*=F,u*=F,J=g*(g+J*u+2*M)+u*(J*g+u+2*R)+O):(u=F,g=Math.max(0,
-(J*u+M)),J=-g*g+u*(u+2*R)+O):(u=-F,g=Math.max(0,-(J*u+M)),J=-g*g+u*(u+2*R)+O):u<=-W?(g=Math.max(0,-(-J*F+M)),u=0<g?-F:Math.min(Math.max(-F,-R),F),J=-g*g+u*(u+2*R)+O):u<=W?(g=0,u=Math.min(Math.max(-F,-R),F),J=u*(u+2*R)+O):(g=Math.max(0,-(J*F+M)),u=0<g?F:Math.min(Math.max(-F,-R),F),J=-g*g+u*(u+2*R)+O)}else u=0<J?-F:F,g=Math.max(0,-(J*u+M)),J=-g*g+u*(u+2*R)+O;w&&w.copy(this.direction).multiplyScalar(g).add(this.origin);z&&z.copy(c).multiplyScalar(u).add(a);return J}}(),intersectSphere:function(){var a=
new p;return function(c,d){a.subVectors(c.center,this.origin);var g=a.dot(this.direction),u=a.dot(a)-g*g;c=c.radius*c.radius;if(u>c)return null;c=Math.sqrt(c-u);u=g-c;g+=c;return 0>u&&0>g?null:0>u?this.at(g,d):this.at(u,d)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var c=a.normal.dot(this.direction);if(0===c)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/c;return 0<=a?a:null},intersectPlane:function(a,
c){a=this.distanceToPlane(a);return null===a?null:this.at(a,c)},intersectsPlane:function(a){var c=a.distanceToPoint(this.origin);return 0===c||0>a.normal.dot(this.direction)*c?!0:!1},intersectBox:function(a,c){var d=1/this.direction.x;var g=1/this.direction.y;var u=1/this.direction.z,w=this.origin;if(0<=d){var z=(a.min.x-w.x)*d;d*=a.max.x-w.x}else z=(a.max.x-w.x)*d,d*=a.min.x-w.x;if(0<=g){var F=(a.min.y-w.y)*g;g*=a.max.y-w.y}else F=(a.max.y-w.y)*g,g*=a.min.y-w.y;if(z>g||F>d)return null;if(F>z||z!==
z)z=F;if(g<d||d!==d)d=g;0<=u?(F=(a.min.z-w.z)*u,a=(a.max.z-w.z)*u):(F=(a.max.z-w.z)*u,a=(a.min.z-w.z)*u);if(z>a||F>d)return null;if(F>z||z!==z)z=F;if(a<d||d!==d)d=a;return 0>d?null:this.at(0<=z?z:d,c)},intersectsBox:function(){var a=new p;return function(c){return null!==this.intersectBox(c,a)}}(),intersectTriangle:function(){var a=new p,c=new p,d=new p,g=new p;return function(u,w,z,F,J){c.subVectors(w,u);d.subVectors(z,u);g.crossVectors(c,d);w=this.direction.dot(g);if(0<w){if(F)return null;F=1}else if(0>
w)F=-1,w=-w;else return null;a.subVectors(this.origin,u);u=F*this.direction.dot(d.crossVectors(a,d));if(0>u)return null;z=F*this.direction.dot(c.cross(a));if(0>z||u+z>w)return null;u=-F*a.dot(g);return 0>u?null:this.at(u/w,J)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};wc.RotationOrders=
"XYZ YZX ZXY XZY YXZ ZYX".split(" ");wc.DefaultOrder="XYZ";wc.prototype={constructor:wc,isEuler:!0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,c,d,g){this._x=a;this._y=c;this._z=d;this._order=g||this._order;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,c,d){var g=Bb.clamp,u=a.elements;a=u[0];var w=u[4],z=u[8],F=u[1],J=u[5],M=u[9],R=u[2],O=u[6];u=u[10];c=c||this._order;"XYZ"===c?(this._y=Math.asin(g(z,-1,1)),.99999>Math.abs(z)?(this._x=Math.atan2(-M,u),this._z=Math.atan2(-w,a)):(this._x=Math.atan2(O,J),this._z=0)):"YXZ"===
c?(this._x=Math.asin(-g(M,-1,1)),.99999>Math.abs(M)?(this._y=Math.atan2(z,u),this._z=Math.atan2(F,J)):(this._y=Math.atan2(-R,a),this._z=0)):"ZXY"===c?(this._x=Math.asin(g(O,-1,1)),.99999>Math.abs(O)?(this._y=Math.atan2(-R,u),this._z=Math.atan2(-w,J)):(this._y=0,this._z=Math.atan2(F,a))):"ZYX"===c?(this._y=Math.asin(-g(R,-1,1)),.99999>Math.abs(R)?(this._x=Math.atan2(O,u),this._z=Math.atan2(F,a)):(this._x=0,this._z=Math.atan2(-w,J))):"YZX"===c?(this._z=Math.asin(g(F,-1,1)),.99999>Math.abs(F)?(this._x=
Math.atan2(-M,J),this._y=Math.atan2(-R,a)):(this._x=0,this._y=Math.atan2(z,u))):"XZY"===c?(this._z=Math.asin(-g(w,-1,1)),.99999>Math.abs(w)?(this._x=Math.atan2(O,J),this._y=Math.atan2(z,a)):(this._x=Math.atan2(-M,u),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+c);this._order=c;if(!1!==d)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(c,d,g){void 0===a&&(a=new y);a.makeRotationFromQuaternion(c);return this.setFromRotationMatrix(a,
d,g)}}(),setFromVector3:function(a,c){return this.set(a.x,a.y,a.z,c||this._order)},reorder:function(){var a=new t;return function(c){a.setFromEuler(this);return this.setFromQuaternion(a,c)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this._x;a[c+1]=
this._y;a[c+2]=this._z;a[c+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new p(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Hd.prototype={constructor:Hd,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};var Dg=0;jb.DefaultUp=new p(0,1,0);jb.DefaultMatrixAutoUpdate=
!0;jb.prototype={constructor:jb,isObject3D:!0,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,c){this.quaternion.setFromAxisAngle(a,c)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new t;
return function(c,d){a.setFromAxisAngle(c,d);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new p(1,0,0);return function(c){return this.rotateOnAxis(a,c)}}(),rotateY:function(){var a=new p(0,1,0);return function(c){return this.rotateOnAxis(a,c)}}(),rotateZ:function(){var a=new p(0,0,1);return function(c){return this.rotateOnAxis(a,c)}}(),translateOnAxis:function(){var a=new p;return function(c,d){a.copy(c).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(d));
return this}}(),translateX:function(){var a=new p(1,0,0);return function(c){return this.translateOnAxis(a,c)}}(),translateY:function(){var a=new p(0,1,0);return function(c){return this.translateOnAxis(a,c)}}(),translateZ:function(){var a=new p(0,0,1);return function(c){return this.translateOnAxis(a,c)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new y;return function(c){return c.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=
new y;return function(c){a.lookAt(c,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var c=0;c<arguments.length;c++)this.add(arguments[c]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
a);return this},remove:function(a){if(1<arguments.length)for(var c=0;c<arguments.length;c++)this.remove(arguments[c]);c=this.children.indexOf(a);-1!==c&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(c,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,c){if(this[a]===c)return this;for(var d=0,g=this.children.length;d<g;d++){var u=this.children[d].getObjectByProperty(a,
c);if(void 0!==u)return u}},getWorldPosition:function(a){a=a||new p;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new p,c=new p;return function(d){d=d||new t;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,d,c);return d}}(),getWorldRotation:function(){var a=new t;return function(c){c=c||new wc;this.getWorldQuaternion(a);return c.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new p,c=new t;return function(d){d=
d||new p;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,d);return d}}(),getWorldDirection:function(){var a=new t;return function(c){c=c||new p;this.getWorldQuaternion(a);return c.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var c=this.children,d=0,g=c.length;d<g;d++)c[d].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var c=this.children,d=0,g=c.length;d<g;d++)c[d].traverseVisible(a)}},traverseAncestors:function(a){var c=
this.parent;null!==c&&(a(c),c.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var c=this.children,d=0,g=c.length;d<g;d++)c[d].updateMatrixWorld(a)},
toJSON:function(a){function c(F){var J=[],M;for(M in F){var R=F[M];delete R.metadata;J.push(R)}return J}var d=void 0===a||""===a,g={};d&&(a={geometries:{},materials:{},textures:{},images:{}},g.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var u={};u.uuid=this.uuid;u.type=this.type;""!==this.name&&(u.name=this.name);"{}"!==JSON.stringify(this.userData)&&(u.userData=this.userData);!0===this.castShadow&&(u.castShadow=!0);!0===this.receiveShadow&&(u.receiveShadow=!0);!1===this.visible&&
(u.visible=!1);u.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),u.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),u.material=this.material.uuid);if(0<this.children.length){u.children=[];for(var w=0;w<this.children.length;w++)u.children.push(this.children[w].toJSON(a).object)}if(d){d=c(a.geometries);
w=c(a.materials);var z=c(a.textures);a=c(a.images);0<d.length&&(g.geometries=d);0<w.length&&(g.materials=w);0<z.length&&(g.textures=z);0<a.length&&(g.images=a)}g.object=u;return g},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,c){void 0===c&&(c=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;
this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===c)for(c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}};Object.assign(jb.prototype,h.prototype);Xc.prototype={constructor:Xc,set:function(a,c){this.start.copy(a);this.end.copy(c);
return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){return(a||new p).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new p).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,c){c=c||new p;return this.delta(c).multiplyScalar(a).add(this.start)},
closestPointToPointParameter:function(){var a=new p,c=new p;return function(d,g){a.subVectors(d,this.start);c.subVectors(this.end,this.start);d=c.dot(c);d=c.dot(a)/d;g&&(d=Bb.clamp(d,0,1));return d}}(),closestPointToPoint:function(a,c,d){a=this.closestPointToPointParameter(a,c);d=d||new p;return this.delta(d).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};
bc.normal=function(){var a=new p;return function(c,d,g,u){u=u||new p;u.subVectors(g,d);a.subVectors(c,d);u.cross(a);c=u.lengthSq();return 0<c?u.multiplyScalar(1/Math.sqrt(c)):u.set(0,0,0)}}();bc.barycoordFromPoint=function(){var a=new p,c=new p,d=new p;return function(g,u,w,z,F){a.subVectors(z,u);c.subVectors(w,u);d.subVectors(g,u);g=a.dot(a);u=a.dot(c);w=a.dot(d);var J=c.dot(c);z=c.dot(d);var M=g*J-u*u;F=F||new p;if(0===M)return F.set(-2,-1,-1);M=1/M;J=(J*w-u*z)*M;g=(g*z-u*w)*M;return F.set(1-J-
g,g,J)}}();bc.containsPoint=function(){var a=new p;return function(c,d,g,u){c=bc.barycoordFromPoint(c,d,g,u,a);return 0<=c.x&&0<=c.y&&1>=c.x+c.y}}();bc.prototype={constructor:bc,set:function(a,c,d){this.a.copy(a);this.b.copy(c);this.c.copy(d);return this},setFromPointsAndIndices:function(a,c,d,g){this.a.copy(a[c]);this.b.copy(a[d]);this.c.copy(a[g]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},
area:function(){var a=new p,c=new p;return function(){a.subVectors(this.c,this.b);c.subVectors(this.a,this.b);return.5*a.cross(c).length()}}(),midpoint:function(a){return(a||new p).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return bc.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new Qb).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,c){return bc.barycoordFromPoint(a,this.a,this.b,this.c,c)},containsPoint:function(a){return bc.containsPoint(a,
this.a,this.b,this.c)},closestPointToPoint:function(){var a,c,d,g;return function(u,w){void 0===a&&(a=new Qb,c=[new Xc,new Xc,new Xc],d=new p,g=new p);w=w||new p;var z=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(u,d);if(!0===this.containsPoint(d))w.copy(d);else for(c[0].set(this.a,this.b),c[1].set(this.b,this.c),c[2].set(this.c,this.a),u=0;u<c.length;u++){c[u].closestPointToPoint(d,!0,g);var F=d.distanceToSquared(g);F<z&&(z=F,w.copy(g))}return w}}(),equals:function(a){return a.a.equals(this.a)&&
a.b.equals(this.b)&&a.c.equals(this.c)}};cc.prototype={constructor:cc,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var c=0,d=a.vertexNormals.length;c<d;c++)this.vertexNormals[c]=a.vertexNormals[c].clone();c=0;for(d=a.vertexColors.length;c<d;c++)this.vertexColors[c]=a.vertexColors[c].clone();return this}};jc.prototype=Object.create($a.prototype);
jc.prototype.constructor=jc;jc.prototype.isMeshBasicMaterial=!0;jc.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=
a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};bb.prototype={constructor:bb,isBufferAttribute:!0,set needsUpdate(a){!0===a&&this.version++},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==a?a.length/this.itemSize:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=
new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,c,d){a*=this.itemSize;d*=c.itemSize;for(var g=0,u=this.itemSize;g<u;g++)this.array[a+g]=c.array[d+g];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var w=a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",
g),w=new la);c[d++]=w.r;c[d++]=w.g;c[d++]=w.b}return this},copyIndicesArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var w=a[g];c[d++]=w.a;c[d++]=w.b;c[d++]=w.c}return this},copyVector2sArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var w=a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",g),w=new l);c[d++]=w.x;c[d++]=w.y}return this},copyVector3sArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var w=
a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",g),w=new p);c[d++]=w.x;c[d++]=w.y;c[d++]=w.z}return this},copyVector4sArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var w=a[g];void 0===w&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",g),w=new r);c[d++]=w.x;c[d++]=w.y;c[d++]=w.z;c[d++]=w.w}return this},set:function(a,c){void 0===c&&(c=0);this.array.set(a,c);return this},getX:function(a){return this.array[a*
this.itemSize]},setX:function(a,c){this.array[a*this.itemSize]=c;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,c){this.array[a*this.itemSize+1]=c;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,c){this.array[a*this.itemSize+2]=c;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,c){this.array[a*this.itemSize+3]=c;return this},setXY:function(a,c,d){a*=this.itemSize;this.array[a+0]=c;this.array[a+
1]=d;return this},setXYZ:function(a,c,d,g){a*=this.itemSize;this.array[a+0]=c;this.array[a+1]=d;this.array[a+2]=g;return this},setXYZW:function(a,c,d,g,u){a*=this.itemSize;this.array[a+0]=c;this.array[a+1]=d;this.array[a+2]=g;this.array[a+3]=u;return this},onUpload:function(a){this.onUploadCallback=a;return this},clone:function(){return(new this.constructor).copy(this)}};Yc.prototype=Object.create(bb.prototype);Yc.prototype.constructor=Yc;Oc.prototype=Object.create(bb.prototype);Oc.prototype.constructor=
Oc;xc.prototype=Object.create(bb.prototype);xc.prototype.constructor=xc;dd.prototype=Object.create(bb.prototype);dd.prototype.constructor=dd;tc.prototype=Object.create(bb.prototype);tc.prototype.constructor=tc;Ec.prototype=Object.create(bb.prototype);Ec.prototype.constructor=Ec;Fc.prototype=Object.create(bb.prototype);Fc.prototype.constructor=Fc;zb.prototype=Object.create(bb.prototype);zb.prototype.constructor=zb;Zc.prototype=Object.create(bb.prototype);Zc.prototype.constructor=Zc;Object.assign(se.prototype,
{computeGroups:function(a){var c=[],d=void 0;a=a.faces;for(var g=0;g<a.length;g++){var u=a[g];if(u.materialIndex!==d){d=u.materialIndex;void 0!==w&&(w.count=3*g-w.start,c.push(w));var w={start:3*g,materialIndex:d}}}void 0!==w&&(w.count=3*g-w.start,c.push(w));this.groups=c},fromGeometry:function(a){var c=a.faces,d=a.vertices,g=a.faceVertexUvs,u=g[0]&&0<g[0].length,w=g[1]&&0<g[1].length,z=a.morphTargets,F=z.length;if(0<F){var J=[];for(var M=0;M<F;M++)J[M]=[];this.morphTargets.position=J}var R=a.morphNormals,
O=R.length;if(0<O){var Q=[];for(M=0;M<O;M++)Q[M]=[];this.morphTargets.normal=Q}var W=a.skinIndices,ca=a.skinWeights,ea=W.length===d.length,na=ca.length===d.length;for(M=0;M<c.length;M++){var ra=c[M];this.vertices.push(d[ra.a],d[ra.b],d[ra.c]);var aa=ra.vertexNormals;3===aa.length?this.normals.push(aa[0],aa[1],aa[2]):(aa=ra.normal,this.normals.push(aa,aa,aa));aa=ra.vertexColors;3===aa.length?this.colors.push(aa[0],aa[1],aa[2]):(aa=ra.color,this.colors.push(aa,aa,aa));!0===u&&(aa=g[0][M],void 0!==aa?
this.uvs.push(aa[0],aa[1],aa[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",M),this.uvs.push(new l,new l,new l)));!0===w&&(aa=g[1][M],void 0!==aa?this.uvs2.push(aa[0],aa[1],aa[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",M),this.uvs2.push(new l,new l,new l)));for(aa=0;aa<F;aa++){var qa=z[aa].vertices;J[aa].push(qa[ra.a],qa[ra.b],qa[ra.c])}for(aa=0;aa<O;aa++)qa=R[aa].vertexNormals[M],Q[aa].push(qa.a,qa.b,qa.c);ea&&this.skinIndices.push(W[ra.a],
W[ra.b],W[ra.c]);na&&this.skinWeights.push(ca[ra.a],ca[ra.b],ca[ra.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this}});var Lf=0;tb.prototype={constructor:tb,isGeometry:!0,applyMatrix:function(a){for(var c=(new Pb).getNormalMatrix(a),d=0,g=this.vertices.length;d<g;d++)this.vertices[d].applyMatrix4(a);d=0;for(g=
this.faces.length;d<g;d++){a=this.faces[d];a.normal.applyMatrix3(c).normalize();for(var u=0,w=a.vertexNormals.length;u<w;u++)a.vertexNormals[u].applyMatrix3(c).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(c){void 0===a&&(a=new y);a.makeRotationX(c);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(c){void 0===
a&&(a=new y);a.makeRotationY(c);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(c){void 0===a&&(a=new y);a.makeRotationZ(c);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(c,d,g){void 0===a&&(a=new y);a.makeTranslation(c,d,g);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(c,d,g){void 0===a&&(a=new y);a.makeScale(c,d,g);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(c){void 0===a&&(a=
new jb);a.lookAt(c);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function c(ra,aa,qa,oa){var wa=void 0!==z?[R[ra].clone(),R[aa].clone(),R[qa].clone()]:[],ta=void 0!==F?[d.colors[ra].clone(),d.colors[aa].clone(),d.colors[qa].clone()]:[];oa=new cc(ra,aa,qa,wa,ta,oa);d.faces.push(oa);void 0!==J&&d.faceVertexUvs[0].push([O[ra].clone(),O[aa].clone(),O[qa].clone()]);void 0!==M&&d.faceVertexUvs[1].push([Q[ra].clone(),Q[aa].clone(),Q[qa].clone()])}var d=this,g=null!==a.index?
a.index.array:void 0,u=a.attributes,w=u.position.array,z=void 0!==u.normal?u.normal.array:void 0,F=void 0!==u.color?u.color.array:void 0,J=void 0!==u.uv?u.uv.array:void 0,M=void 0!==u.uv2?u.uv2.array:void 0;void 0!==M&&(this.faceVertexUvs[1]=[]);for(var R=[],O=[],Q=[],W=u=0;u<w.length;u+=3,W+=2)d.vertices.push(new p(w[u],w[u+1],w[u+2])),void 0!==z&&R.push(new p(z[u],z[u+1],z[u+2])),void 0!==F&&d.colors.push(new la(F[u],F[u+1],F[u+2])),void 0!==J&&O.push(new l(J[W],J[W+1])),void 0!==M&&Q.push(new l(M[W],
M[W+1]));if(void 0!==g)if(w=a.groups,0<w.length)for(u=0;u<w.length;u++){var ca=w[u],ea=ca.start,na=ca.count;W=ea;for(ea+=na;W<ea;W+=3)c(g[W],g[W+1],g[W+2],ca.materialIndex)}else for(u=0;u<g.length;u+=3)c(g[u],g[u+1],g[u+2]);else for(u=0;u<w.length/3;u+=3)c(u,u+1,u+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();
this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,c=this.boundingSphere.radius;c=0===c?1:1/c;var d=new y;d.set(c,0,0,-c*a.x,0,c,0,-c*a.y,0,0,c,-c*a.z,0,0,0,1);this.applyMatrix(d);return this},computeFaceNormals:function(){for(var a=new p,c=new p,d=0,g=this.faces.length;d<g;d++){var u=this.faces[d],w=this.vertices[u.a],z=this.vertices[u.b];a.subVectors(this.vertices[u.c],z);c.subVectors(w,z);a.cross(c);a.normalize();u.normal.copy(a)}},
computeVertexNormals:function(a){void 0===a&&(a=!0);var c;var d=Array(this.vertices.length);var g=0;for(c=this.vertices.length;g<c;g++)d[g]=new p;if(a){var u=new p,w=new p;a=0;for(g=this.faces.length;a<g;a++){c=this.faces[a];var z=this.vertices[c.a];var F=this.vertices[c.b];var J=this.vertices[c.c];u.subVectors(J,F);w.subVectors(z,F);u.cross(w);d[c.a].add(u);d[c.b].add(u);d[c.c].add(u)}}else for(this.computeFaceNormals(),a=0,g=this.faces.length;a<g;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),
d[c.c].add(c.normal);g=0;for(c=this.vertices.length;g<c;g++)d[g].normalize();a=0;for(g=this.faces.length;a<g;a++)c=this.faces[a],z=c.vertexNormals,3===z.length?(z[0].copy(d[c.a]),z[1].copy(d[c.b]),z[2].copy(d[c.c])):(z[0]=d[c.a].clone(),z[1]=d[c.b].clone(),z[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var a;this.computeFaceNormals();var c=0;for(a=this.faces.length;c<a;c++){var d=this.faces[c];var g=d.vertexNormals;3===g.length?(g[0].copy(d.normal),
g[1].copy(d.normal),g[2].copy(d.normal)):(g[0]=d.normal.clone(),g[1]=d.normal.clone(),g[2]=d.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,c;var d=0;for(c=this.faces.length;d<c;d++){var g=this.faces[d];g.__originalFaceNormal?g.__originalFaceNormal.copy(g.normal):g.__originalFaceNormal=g.normal.clone();g.__originalVertexNormals||(g.__originalVertexNormals=[]);var u=0;for(a=g.vertexNormals.length;u<a;u++)g.__originalVertexNormals[u]?g.__originalVertexNormals[u].copy(g.vertexNormals[u]):
g.__originalVertexNormals[u]=g.vertexNormals[u].clone()}var w=new tb;w.faces=this.faces;u=0;for(a=this.morphTargets.length;u<a;u++){if(!this.morphNormals[u]){this.morphNormals[u]={};this.morphNormals[u].faceNormals=[];this.morphNormals[u].vertexNormals=[];g=this.morphNormals[u].faceNormals;var z=this.morphNormals[u].vertexNormals;d=0;for(c=this.faces.length;d<c;d++){var F=new p;var J={a:new p,b:new p,c:new p};g.push(F);z.push(J)}}z=this.morphNormals[u];w.vertices=this.morphTargets[u].vertices;w.computeFaceNormals();
w.computeVertexNormals();d=0;for(c=this.faces.length;d<c;d++)g=this.faces[d],F=z.faceNormals[d],J=z.vertexNormals[d],F.copy(g.normal),J.a.copy(g.vertexNormals[0]),J.b.copy(g.vertexNormals[1]),J.c.copy(g.vertexNormals[2])}d=0;for(c=this.faces.length;d<c;d++)g=this.faces[d],g.normal=g.__originalFaceNormal,g.vertexNormals=g.__originalVertexNormals},computeLineDistances:function(){for(var a=0,c=this.vertices,d=0,g=c.length;d<g;d++)0<d&&(a+=c[d].distanceTo(c[d-1])),this.lineDistances[d]=a},computeBoundingBox:function(){null===
this.boundingBox&&(this.boundingBox=new wb);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Mb);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,c,d){if(!1===(a&&a.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var g,u=this.vertices.length,w=this.vertices,z=a.vertices,F=this.faces,J=a.faces,M=this.faceVertexUvs[0],R=a.faceVertexUvs[0],O=this.colors,
Q=a.colors;void 0===d&&(d=0);void 0!==c&&(g=(new Pb).getNormalMatrix(c));a=0;for(var W=z.length;a<W;a++){var ca=z[a].clone();void 0!==c&&ca.applyMatrix4(c);w.push(ca)}a=0;for(W=Q.length;a<W;a++)O.push(Q[a].clone());a=0;for(W=J.length;a<W;a++){z=J[a];var ea=z.vertexNormals;Q=z.vertexColors;O=new cc(z.a+u,z.b+u,z.c+u);O.normal.copy(z.normal);void 0!==g&&O.normal.applyMatrix3(g).normalize();c=0;for(w=ea.length;c<w;c++)ca=ea[c].clone(),void 0!==g&&ca.applyMatrix3(g).normalize(),O.vertexNormals.push(ca);
O.color.copy(z.color);c=0;for(w=Q.length;c<w;c++)ca=Q[c],O.vertexColors.push(ca.clone());O.materialIndex=z.materialIndex+d;F.push(O)}a=0;for(W=R.length;a<W;a++)if(d=R[a],g=[],void 0!==d){c=0;for(w=d.length;c<w;c++)g.push(d[c].clone());M.push(g)}}},mergeMesh:function(a){!1===(a&&a.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},c=[],d=[],g=Math.pow(10,
4),u;var w=0;for(u=this.vertices.length;w<u;w++){var z=this.vertices[w];z=Math.round(z.x*g)+"_"+Math.round(z.y*g)+"_"+Math.round(z.z*g);void 0===a[z]?(a[z]=w,c.push(this.vertices[w]),d[w]=c.length-1):d[w]=d[a[z]]}a=[];w=0;for(u=this.faces.length;w<u;w++)for(g=this.faces[w],g.a=d[g.a],g.b=d[g.b],g.c=d[g.c],g=[g.a,g.b,g.c],z=0;3>z;z++)if(g[z]===g[(z+1)%3]){a.push(w);break}for(w=a.length-1;0<=w;w--)for(g=a[w],this.faces.splice(g,1),d=0,u=this.faceVertexUvs.length;d<u;d++)this.faceVertexUvs[d].splice(g,
1);w=this.vertices.length-c.length;this.vertices=c;return w},sortFacesByMaterialIndex:function(){for(var a=this.faces,c=a.length,d=0;d<c;d++)a[d]._id=d;a.sort(function(J,M){return J.materialIndex-M.materialIndex});var g=this.faceVertexUvs[0],u=this.faceVertexUvs[1],w,z;g&&g.length===c&&(w=[]);u&&u.length===c&&(z=[]);for(d=0;d<c;d++){var F=a[d]._id;w&&w.push(g[F]);z&&z.push(u[F])}w&&(this.faceVertexUvs[0]=w);z&&(this.faceVertexUvs[1]=z)},toJSON:function(){function a(wa,ta,za){return za?wa|1<<ta:wa&
~(1<<ta)}function c(wa){var ta=wa.x.toString()+wa.y.toString()+wa.z.toString();if(void 0!==M[ta])return M[ta];M[ta]=J.length/3;J.push(wa.x,wa.y,wa.z);return M[ta]}function d(wa){var ta=wa.r.toString()+wa.g.toString()+wa.b.toString();if(void 0!==O[ta])return O[ta];O[ta]=R.length;R.push(wa.getHex());return O[ta]}function g(wa){var ta=wa.x.toString()+wa.y.toString();if(void 0!==W[ta])return W[ta];W[ta]=Q.length/2;Q.push(wa.x,wa.y);return W[ta]}var u={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};
u.uuid=this.uuid;u.type=this.type;""!==this.name&&(u.name=this.name);if(void 0!==this.parameters){var w=this.parameters,z;for(z in w)void 0!==w[z]&&(u[z]=w[z]);return u}w=[];for(z=0;z<this.vertices.length;z++){var F=this.vertices[z];w.push(F.x,F.y,F.z)}F=[];var J=[],M={},R=[],O={},Q=[],W={};for(z=0;z<this.faces.length;z++){var ca=this.faces[z],ea=void 0!==this.faceVertexUvs[0][z],na=0<ca.normal.length(),ra=0<ca.vertexNormals.length,aa=1!==ca.color.r||1!==ca.color.g||1!==ca.color.b,qa=0<ca.vertexColors.length,
oa=0;oa=a(oa,0,0);oa=a(oa,1,!0);oa=a(oa,2,!1);oa=a(oa,3,ea);oa=a(oa,4,na);oa=a(oa,5,ra);oa=a(oa,6,aa);oa=a(oa,7,qa);F.push(oa);F.push(ca.a,ca.b,ca.c);F.push(ca.materialIndex);ea&&(ea=this.faceVertexUvs[0][z],F.push(g(ea[0]),g(ea[1]),g(ea[2])));na&&F.push(c(ca.normal));ra&&(na=ca.vertexNormals,F.push(c(na[0]),c(na[1]),c(na[2])));aa&&F.push(d(ca.color));qa&&(ca=ca.vertexColors,F.push(d(ca[0]),d(ca[1]),d(ca[2])))}u.data={};u.data.vertices=w;u.data.normals=J;0<R.length&&(u.data.colors=R);0<Q.length&&
(u.data.uvs=[Q]);u.data.faces=F;return u},clone:function(){return(new tb).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];this.colors=[];for(var c=a.vertices,d=0,g=c.length;d<g;d++)this.vertices.push(c[d].clone());c=a.colors;d=0;for(g=c.length;d<g;d++)this.colors.push(c[d].clone());c=a.faces;d=0;for(g=c.length;d<g;d++)this.faces.push(c[d].clone());d=0;for(g=a.faceVertexUvs.length;d<g;d++){c=a.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=
[]);for(var u=0,w=c.length;u<w;u++){for(var z=c[u],F=[],J=0,M=z.length;J<M;J++)F.push(z[J].clone());this.faceVertexUvs[d].push(F)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(tb.prototype,h.prototype);ob.prototype={constructor:ob,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,c,d){if(!1===(c&&c.isBufferAttribute)&&!1===(c&&c.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),
this.addAttribute(a,new bb(c,d));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(c);else return this.attributes[a]=c,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,c,d){this.groups.push({start:a,count:c,materialIndex:void 0!==d?d:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,c){this.drawRange.start=a;this.drawRange.count=
c},applyMatrix:function(a){var c=this.attributes.position;void 0!==c&&(a.applyToBufferAttribute(c),c.needsUpdate=!0);c=this.attributes.normal;void 0!==c&&((new Pb).getNormalMatrix(a).applyToBufferAttribute(c),c.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(c){void 0===a&&(a=new y);a.makeRotationX(c);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(c){void 0===
a&&(a=new y);a.makeRotationY(c);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(c){void 0===a&&(a=new y);a.makeRotationZ(c);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(c,d,g){void 0===a&&(a=new y);a.makeTranslation(c,d,g);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(c,d,g){void 0===a&&(a=new y);a.makeScale(c,d,g);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(c){void 0===a&&(a=
new jb);a.lookAt(c);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var c=a.geometry;if(a.isPoints||a.isLine){a=new zb(3*c.vertices.length,3);var d=new zb(3*c.colors.length,3);this.addAttribute("position",a.copyVector3sArray(c.vertices));this.addAttribute("color",d.copyColorsArray(c.colors));c.lineDistances&&c.lineDistances.length===c.vertices.length&&
(a=new zb(c.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(c.lineDistances)));null!==c.boundingSphere&&(this.boundingSphere=c.boundingSphere.clone());null!==c.boundingBox&&(this.boundingBox=c.boundingBox.clone())}else a.isMesh&&c&&c.isGeometry&&this.fromGeometry(c);return this},updateFromObject:function(a){var c=a.geometry;if(a.isMesh){var d=c.__directGeometry;!0===c.elementsNeedUpdate&&(d=void 0,c.elementsNeedUpdate=!1);if(void 0===d)return this.fromGeometry(c);d.verticesNeedUpdate=
c.verticesNeedUpdate;d.normalsNeedUpdate=c.normalsNeedUpdate;d.colorsNeedUpdate=c.colorsNeedUpdate;d.uvsNeedUpdate=c.uvsNeedUpdate;d.groupsNeedUpdate=c.groupsNeedUpdate;c.verticesNeedUpdate=!1;c.normalsNeedUpdate=!1;c.colorsNeedUpdate=!1;c.uvsNeedUpdate=!1;c.groupsNeedUpdate=!1;c=d}!0===c.verticesNeedUpdate&&(d=this.attributes.position,void 0!==d&&(d.copyVector3sArray(c.vertices),d.needsUpdate=!0),c.verticesNeedUpdate=!1);!0===c.normalsNeedUpdate&&(d=this.attributes.normal,void 0!==d&&(d.copyVector3sArray(c.normals),
d.needsUpdate=!0),c.normalsNeedUpdate=!1);!0===c.colorsNeedUpdate&&(d=this.attributes.color,void 0!==d&&(d.copyColorsArray(c.colors),d.needsUpdate=!0),c.colorsNeedUpdate=!1);c.uvsNeedUpdate&&(d=this.attributes.uv,void 0!==d&&(d.copyVector2sArray(c.uvs),d.needsUpdate=!0),c.uvsNeedUpdate=!1);c.lineDistancesNeedUpdate&&(d=this.attributes.lineDistance,void 0!==d&&(d.copyArray(c.lineDistances),d.needsUpdate=!0),c.lineDistancesNeedUpdate=!1);c.groupsNeedUpdate&&(c.computeGroups(a.geometry),this.groups=
c.groups,c.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new se).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var c=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new bb(c,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(c=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new bb(c,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(c=new Float32Array(3*a.colors.length),
this.addAttribute("color",(new bb(c,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(c=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new bb(c,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(c=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new bb(c,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(c=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new bb(c,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var d in a.morphTargets){c=
[];for(var g=a.morphTargets[d],u=0,w=g.length;u<w;u++){var z=g[u],F=new zb(3*z.length,3);c.push(F.copyVector3sArray(z))}this.morphAttributes[d]=c}0<a.skinIndices.length&&(d=new zb(4*a.skinIndices.length,4),this.addAttribute("skinIndex",d.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(d=new zb(4*a.skinWeights.length,4),this.addAttribute("skinWeight",d.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=
a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new wb);var a=this.attributes.position;void 0!==a?this.boundingBox.setFromBufferAttribute(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=
new wb,c=new p;return function(){null===this.boundingSphere&&(this.boundingSphere=new Mb);var d=this.attributes.position;if(d){var g=this.boundingSphere.center;a.setFromBufferAttribute(d);a.getCenter(g);for(var u=0,w=0,z=d.count;w<z;w++)c.x=d.getX(w),c.y=d.getY(w),c.z=d.getZ(w),u=Math.max(u,g.distanceToSquared(c));this.boundingSphere.radius=Math.sqrt(u);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,c=this.attributes,d=this.groups;if(c.position){var g=c.position.array;if(void 0===c.normal)this.addAttribute("normal",new bb(new Float32Array(g.length),3));else for(var u=c.normal.array,w=0,z=u.length;w<z;w++)u[w]=0;u=c.normal.array;var F=new p,J=new p,M=new p,R=new p,O=new p;if(a){a=a.array;0===d.length&&this.addGroup(0,a.length);for(var Q=0,W=d.length;Q<W;++Q){w=d[Q];z=w.start;var ca=w.count;w=z;for(z+=ca;w<
z;w+=3){ca=3*a[w+0];var ea=3*a[w+1];var na=3*a[w+2];F.fromArray(g,ca);J.fromArray(g,ea);M.fromArray(g,na);R.subVectors(M,J);O.subVectors(F,J);R.cross(O);u[ca]+=R.x;u[ca+1]+=R.y;u[ca+2]+=R.z;u[ea]+=R.x;u[ea+1]+=R.y;u[ea+2]+=R.z;u[na]+=R.x;u[na+1]+=R.y;u[na+2]+=R.z}}}else for(w=0,z=g.length;w<z;w+=9)F.fromArray(g,w),J.fromArray(g,w+3),M.fromArray(g,w+6),R.subVectors(M,J),O.subVectors(F,J),R.cross(O),u[w]=R.x,u[w+1]=R.y,u[w+2]=R.z,u[w+3]=R.x,u[w+4]=R.y,u[w+5]=R.z,u[w+6]=R.x,u[w+7]=R.y,u[w+8]=R.z;this.normalizeNormals();
c.normal.needsUpdate=!0}},merge:function(a,c){if(!1===(a&&a.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===c&&(c=0);var d=this.attributes,g;for(g in d)if(void 0!==a.attributes[g]){var u=d[g].array,w=a.attributes[g],z=w.array,F=0;for(w=w.itemSize*c;F<z.length;F++,w++)u[w]=z[F]}return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,c,d,g,u=0,w=a.length;u<w;u+=3)c=a[u],d=a[u+1],g=a[u+2],c=1/
Math.sqrt(c*c+d*d+g*g),a[u]*=c,a[u+1]*=c,a[u+2]*=c},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new ob,c=this.index.array,d=this.attributes,g;for(g in d){var u=d[g],w=u.array;u=u.itemSize;for(var z=new w.constructor(c.length*u),F,J=0,M=0,R=c.length;M<R;M++){F=c[M]*u;for(var O=0;O<u;O++)z[J++]=w[F++]}a.addAttribute(g,new bb(z,u))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",
generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var c=this.parameters;for(u in c)void 0!==c[u]&&(a[u]=c[u]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(c=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:c});d=this.attributes;for(u in d){var g=d[u];c=Array.prototype.slice.call(g.array);a.data.attributes[u]={itemSize:g.itemSize,type:g.array.constructor.name,array:c,
normalized:g.normalized}}var u=this.groups;0<u.length&&(a.data.groups=JSON.parse(JSON.stringify(u)));u=this.boundingSphere;null!==u&&(a.data.boundingSphere={center:u.center.toArray(),radius:u.radius});return a},clone:function(){return(new ob).copy(this)},copy:function(a){var c=a.index;null!==c&&this.setIndex(c.clone());c=a.attributes;for(var d in c)this.addAttribute(d,c[d].clone());a=a.groups;d=0;for(c=a.length;d<c;d++){var g=a[d];this.addGroup(g.start,g.count,g.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}};
ob.MaxIndex=65535;Object.assign(ob.prototype,h.prototype);Sb.prototype=Object.assign(Object.create(jb.prototype),{constructor:Sb,isMesh:!0,setDrawMode:function(a){this.drawMode=a},copy:function(a){jb.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){var a=this.geometry.morphTargets;if(void 0!==a&&0<a.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0,d=a.length;c<d;c++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[a[c].name]=
c}},raycast:function(){function a(aa,qa,oa,wa,ta,za,Ja){bc.barycoordFromPoint(aa,qa,oa,wa,ea);ta.multiplyScalar(ea.x);za.multiplyScalar(ea.y);Ja.multiplyScalar(ea.z);ta.add(za).add(Ja);return ta.clone()}function c(aa,qa,oa,wa,ta,za,Ja){var Ia=aa.material;if(null===(1===Ia.side?oa.intersectTriangle(za,ta,wa,!0,Ja):oa.intersectTriangle(wa,ta,za,2!==Ia.side,Ja)))return null;ra.copy(Ja);ra.applyMatrix4(aa.matrixWorld);oa=qa.ray.origin.distanceTo(ra);return oa<qa.near||oa>qa.far?null:{distance:oa,point:ra.clone(),
object:aa}}function d(aa,qa,oa,wa,ta,za,Ja,Ia){z.fromArray(wa,3*za);F.fromArray(wa,3*Ja);J.fromArray(wa,3*Ia);if(aa=c(aa,qa,oa,z,F,J,na))ta&&(Q.fromArray(ta,2*za),W.fromArray(ta,2*Ja),ca.fromArray(ta,2*Ia),aa.uv=a(na,z,F,J,Q,W,ca)),aa.face=new cc(za,Ja,Ia,bc.normal(z,F,J)),aa.faceIndex=za;return aa}var g=new y,u=new sc,w=new Mb,z=new p,F=new p,J=new p,M=new p,R=new p,O=new p,Q=new l,W=new l,ca=new l,ea=new p,na=new p,ra=new p;return function(aa,qa){var oa=this.geometry,wa=this.material,ta=this.matrixWorld;
if(void 0!==wa&&(null===oa.boundingSphere&&oa.computeBoundingSphere(),w.copy(oa.boundingSphere),w.applyMatrix4(ta),!1!==aa.ray.intersectsSphere(w)&&(g.getInverse(ta),u.copy(aa.ray).applyMatrix4(g),null===oa.boundingBox||!1!==u.intersectsBox(oa.boundingBox)))){var za;if(oa.isBufferGeometry){wa=oa.index;ta=oa.attributes;oa=ta.position.array;if(void 0!==ta.uv)var Ja=ta.uv.array;if(null!==wa){ta=wa.array;for(var Ia=0,Oa=ta.length;Ia<Oa;Ia+=3){wa=ta[Ia];var Ua=ta[Ia+1];var Na=ta[Ia+2];if(za=d(this,aa,
u,oa,Ja,wa,Ua,Na))za.faceIndex=Math.floor(Ia/3),qa.push(za)}}else for(Ia=0,Oa=oa.length;Ia<Oa;Ia+=9)if(wa=Ia/3,Ua=wa+1,Na=wa+2,za=d(this,aa,u,oa,Ja,wa,Ua,Na))za.index=wa,qa.push(za)}else if(oa.isGeometry){ta=wa&&wa.isMultiMaterial;Ia=!0===ta?wa.materials:null;Oa=oa.vertices;Ua=oa.faces;Na=oa.faceVertexUvs[0];0<Na.length&&(Ja=Na);for(var Sa=0,ab=Ua.length;Sa<ab;Sa++){var Pa=Ua[Sa];za=!0===ta?Ia[Pa.materialIndex]:wa;if(void 0!==za){Na=Oa[Pa.a];var Ma=Oa[Pa.b];var Xa=Oa[Pa.c];if(!0===za.morphTargets){za=
oa.morphTargets;var Ka=this.morphTargetInfluences;z.set(0,0,0);F.set(0,0,0);J.set(0,0,0);for(var gb=0,Wa=za.length;gb<Wa;gb++){var sb=Ka[gb];if(0!==sb){var yb=za[gb].vertices;z.addScaledVector(M.subVectors(yb[Pa.a],Na),sb);F.addScaledVector(R.subVectors(yb[Pa.b],Ma),sb);J.addScaledVector(O.subVectors(yb[Pa.c],Xa),sb)}}z.add(Na);F.add(Ma);J.add(Xa);Na=z;Ma=F;Xa=J}if(za=c(this,aa,u,Na,Ma,Xa,na))Ja&&(Ka=Ja[Sa],Q.copy(Ka[0]),W.copy(Ka[1]),ca.copy(Ka[2]),za.uv=a(na,Na,Ma,Xa,Q,W,ca)),za.face=Pa,za.faceIndex=
Sa,qa.push(za)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Pc.prototype=Object.create(ob.prototype);Pc.prototype.constructor=Pc;pc.prototype=Object.create(ob.prototype);pc.prototype.constructor=pc;Xb.prototype=Object.create(jb.prototype);Xb.prototype.constructor=Xb;Xb.prototype.isCamera=!0;Xb.prototype.getWorldDirection=function(){var a=new t;return function(c){c=c||new p;this.getWorldQuaternion(a);return c.set(0,0,-1).applyQuaternion(a)}}();Xb.prototype.lookAt=
function(){var a=new y;return function(c){a.lookAt(this.position,c,this.up);this.quaternion.setFromRotationMatrix(a)}}();Xb.prototype.clone=function(){return(new this.constructor).copy(this)};Xb.prototype.copy=function(a){jb.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};ua.prototype=Object.assign(Object.create(Xb.prototype),{constructor:ua,isPerspectiveCamera:!0,copy:function(a){Xb.prototype.copy.call(this,
a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*Bb.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*Bb.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*Bb.RAD2DEG*Math.atan(Math.tan(.5*
Bb.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,c,d,g,u,w){this.aspect=a/c;this.view={fullWidth:a,fullHeight:c,offsetX:d,offsetY:g,width:u,height:w};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,c=a*Math.tan(.5*Bb.DEG2RAD*this.fov)/this.zoom,
d=2*c,g=this.aspect*d,u=-.5*g,w=this.view;if(null!==w){var z=w.fullWidth,F=w.fullHeight;u+=w.offsetX*g/z;c-=w.offsetY*d/F;g*=w.width/z;d*=w.height/F}w=this.filmOffset;0!==w&&(u+=a*w/this.getFilmWidth());this.projectionMatrix.makePerspective(u,u+g,c,c-d,a,this.far)},toJSON:function(a){a=jb.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},
this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});Da.prototype=Object.assign(Object.create(Xb.prototype),{constructor:Da,isOrthographicCamera:!0,copy:function(a){Xb.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,c,d,g,u,w){this.view={fullWidth:a,fullHeight:c,offsetX:d,
offsetY:g,width:u,height:w};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),d=(this.right+this.left)/2,g=(this.top+this.bottom)/2,u=d-a;d+=a;a=g+c;c=g-c;if(null!==this.view){d=this.zoom/(this.view.width/this.view.fullWidth);c=this.zoom/(this.view.height/this.view.fullHeight);var w=(this.right-this.left)/this.view.width;g=(this.top-
this.bottom)/this.view.height;u+=this.view.offsetX/d*w;d=u+this.view.width/d*w;a-=this.view.offsetY/c*g;c=a-this.view.height/c*g}this.projectionMatrix.makeOrthographic(u,d,a,c,this.near,this.far)},toJSON:function(a){a=jb.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});var Eg=
0;Ld.prototype.isFogExp2=!0;Ld.prototype.clone=function(){return new Ld(this.color.getHex(),this.density)};Ld.prototype.toJSON=function(a){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Md.prototype.isFog=!0;Md.prototype.clone=function(){return new Md(this.color.getHex(),this.near,this.far)};Md.prototype.toJSON=function(a){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};md.prototype=Object.create(jb.prototype);md.prototype.constructor=md;md.prototype.copy=
function(a,c){jb.prototype.copy.call(this,a,c);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};md.prototype.toJSON=function(a){var c=jb.prototype.toJSON.call(this,a);null!==this.background&&(c.object.background=this.background.toJSON(a));null!==this.fog&&(c.object.fog=this.fog.toJSON());return c};
Pf.prototype=Object.assign(Object.create(jb.prototype),{constructor:Pf,isLensFlare:!0,copy:function(a){jb.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var c=0,d=a.lensFlares.length;c<d;c++)this.lensFlares.push(a.lensFlares[c]);return this},add:function(a,c,d,g,u,w){void 0===c&&(c=-1);void 0===d&&(d=0);void 0===w&&(w=1);void 0===u&&(u=new la(16777215));void 0===g&&(g=1);d=Math.min(d,Math.max(0,d));this.lensFlares.push({texture:a,
size:c,distance:d,x:0,y:0,z:0,scale:1,rotation:0,opacity:w,color:u,blending:g})},updateLensFlares:function(){var a,c=this.lensFlares.length,d=2*-this.positionScreen.x,g=2*-this.positionScreen.y;for(a=0;a<c;a++){var u=this.lensFlares[a];u.x=this.positionScreen.x+d*u.distance;u.y=this.positionScreen.y+g*u.distance;u.wantedRotation=u.x*Math.PI*.25;u.rotation+=.25*(u.wantedRotation-u.rotation)}}});nd.prototype=Object.create($a.prototype);nd.prototype.constructor=nd;nd.prototype.copy=function(a){$a.prototype.copy.call(this,
a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};we.prototype=Object.assign(Object.create(jb.prototype),{constructor:we,isSprite:!0,raycast:function(){var a=new p;return function(c,d){a.setFromMatrixPosition(this.matrixWorld);c=c.ray.distanceSqToPoint(a);c>this.scale.x*this.scale.y/4||d.push({distance:Math.sqrt(c),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});xe.prototype=Object.assign(Object.create(jb.prototype),
{constructor:xe,copy:function(a){jb.prototype.copy.call(this,a,!1);a=a.levels;for(var c=0,d=a.length;c<d;c++){var g=a[c];this.addLevel(g.object.clone(),g.distance)}return this},addLevel:function(a,c){void 0===c&&(c=0);c=Math.abs(c);for(var d=this.levels,g=0;g<d.length&&!(c<d[g].distance);g++);d.splice(g,0,{distance:c,object:a});this.add(a)},getObjectForDistance:function(a){for(var c=this.levels,d=1,g=c.length;d<g&&!(a<c[d].distance);d++);return c[d-1].object},raycast:function(){var a=new p;return function(c,
d){a.setFromMatrixPosition(this.matrixWorld);var g=c.ray.origin.distanceTo(a);this.getObjectForDistance(g).raycast(c,d)}}(),update:function(){var a=new p,c=new p;return function(d){var g=this.levels;if(1<g.length){a.setFromMatrixPosition(d.matrixWorld);c.setFromMatrixPosition(this.matrixWorld);d=a.distanceTo(c);g[0].object.visible=!0;for(var u=1,w=g.length;u<w;u++)if(d>=g[u].distance)g[u-1].object.visible=!1,g[u].object.visible=!0;else break;for(;u<w;u++)g[u].object.visible=!1}}}(),toJSON:function(a){a=
jb.prototype.toJSON.call(this,a);a.object.levels=[];for(var c=this.levels,d=0,g=c.length;d<g;d++){var u=c[d];a.object.levels.push({object:u.object.uuid,distance:u.distance})}return a}});Object.assign(jf.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,c=this.bones.length;a<c;a++){var d=new y;this.bones[a]&&d.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(d)}},pose:function(){for(var a,c=0,d=this.bones.length;c<d;c++)(a=this.bones[c])&&a.matrixWorld.getInverse(this.boneInverses[c]);
c=0;for(d=this.bones.length;c<d;c++)if(a=this.bones[c])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new y;return function(){for(var c=0,d=this.bones.length;c<d;c++)a.multiplyMatrices(this.bones[c]?this.bones[c].matrixWorld:this.identityMatrix,this.boneInverses[c]),a.toArray(this.boneMatrices,16*c);this.useVertexTexture&&(this.boneTexture.needsUpdate=
!0)}}(),clone:function(){return new jf(this.bones,this.boneInverses,this.useVertexTexture)}});kf.prototype=Object.assign(Object.create(jb.prototype),{constructor:kf,isBone:!0});lf.prototype=Object.assign(Object.create(Sb.prototype),{constructor:lf,isSkinnedMesh:!0,bind:function(a,c){this.skeleton=a;void 0===c&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),c=this.matrixWorld);this.bindMatrix.copy(c);this.bindMatrixInverse.getInverse(c)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&
this.geometry.isGeometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var c=this.geometry.skinWeights[a],d=1/c.lengthManhattan();Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){c=new r;var g=this.geometry.attributes.skinWeight;for(a=0;a<g.count;a++)c.x=g.getX(a),c.y=g.getY(a),c.z=g.getZ(a),c.w=g.getW(a),d=1/c.lengthManhattan(),Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0),g.setXYZW(a,c.x,c.y,c.z,c.w)}},updateMatrixWorld:function(a){Sb.prototype.updateMatrixWorld.call(this,
!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});dc.prototype=Object.create($a.prototype);dc.prototype.constructor=dc;dc.prototype.isLineBasicMaterial=!0;dc.prototype.copy=function(a){$a.prototype.copy.call(this,
a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};$c.prototype=Object.assign(Object.create(jb.prototype),{constructor:$c,isLine:!0,raycast:function(){var a=new y,c=new sc,d=new Mb;return function(g,u){var w=g.linePrecision;w*=w;var z=this.geometry,F=this.matrixWorld;null===z.boundingSphere&&z.computeBoundingSphere();d.copy(z.boundingSphere);d.applyMatrix4(F);if(!1!==g.ray.intersectsSphere(d)){a.getInverse(F);c.copy(g.ray).applyMatrix4(a);
var J=new p,M=new p;F=new p;var R=new p,O=this&&this.isLineSegments?2:1;if(z.isBufferGeometry){var Q=z.index,W=z.attributes.position.array;if(null!==Q){Q=Q.array;z=0;for(var ca=Q.length-1;z<ca;z+=O){var ea=Q[z+1];J.fromArray(W,3*Q[z]);M.fromArray(W,3*ea);ea=c.distanceSqToSegment(J,M,R,F);ea>w||(R.applyMatrix4(this.matrixWorld),ea=g.ray.origin.distanceTo(R),ea<g.near||ea>g.far||u.push({distance:ea,point:F.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this}))}}else for(z=
0,ca=W.length/3-1;z<ca;z+=O)J.fromArray(W,3*z),M.fromArray(W,3*z+3),ea=c.distanceSqToSegment(J,M,R,F),ea>w||(R.applyMatrix4(this.matrixWorld),ea=g.ray.origin.distanceTo(R),ea<g.near||ea>g.far||u.push({distance:ea,point:F.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this}))}else if(z.isGeometry)for(J=z.vertices,M=J.length,z=0;z<M-1;z+=O)ea=c.distanceSqToSegment(J[z],J[z+1],R,F),ea>w||(R.applyMatrix4(this.matrixWorld),ea=g.ray.origin.distanceTo(R),ea<g.near||ea>g.far||
u.push({distance:ea,point:F.clone().applyMatrix4(this.matrixWorld),index:z,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Wb.prototype=Object.assign(Object.create($c.prototype),{constructor:Wb,isLineSegments:!0});Lc.prototype=Object.create($a.prototype);Lc.prototype.constructor=Lc;Lc.prototype.isPointsMaterial=!0;Lc.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;
this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};Nd.prototype=Object.assign(Object.create(jb.prototype),{constructor:Nd,isPoints:!0,raycast:function(){var a=new y,c=new sc,d=new Mb;return function(g,u){function w(ea,na){var ra=c.distanceSqToPoint(ea);if(ra<R){ea=c.closestPointToPoint(ea);ea.applyMatrix4(J);var aa=g.ray.origin.distanceTo(ea);aa<g.near||aa>g.far||u.push({distance:aa,distanceToRay:Math.sqrt(ra),point:ea.clone(),index:na,face:null,object:z})}}var z=this,F=this.geometry,
J=this.matrixWorld,M=g.params.Points.threshold;null===F.boundingSphere&&F.computeBoundingSphere();d.copy(F.boundingSphere);d.applyMatrix4(J);if(!1!==g.ray.intersectsSphere(d)){a.getInverse(J);c.copy(g.ray).applyMatrix4(a);M/=(this.scale.x+this.scale.y+this.scale.z)/3;var R=M*M;M=new p;if(F.isBufferGeometry){var O=F.index;F=F.attributes.position.array;if(null!==O){var Q=O.array;O=0;for(var W=Q.length;O<W;O++){var ca=Q[O];M.fromArray(F,3*ca);w(M,ca)}}else for(O=0,Q=F.length/3;O<Q;O++)M.fromArray(F,
3*O),w(M,O)}else for(M=F.vertices,O=0,Q=M.length;O<Q;O++)w(M[O],O)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});ye.prototype=Object.assign(Object.create(jb.prototype),{constructor:ye});mf.prototype=Object.create(e.prototype);mf.prototype.constructor=mf;Od.prototype=Object.create(e.prototype);Od.prototype.constructor=Od;Od.prototype.isCompressedTexture=!0;nf.prototype=Object.create(e.prototype);nf.prototype.constructor=nf;ze.prototype=Object.create(e.prototype);
ze.prototype.constructor=ze;ze.prototype.isDepthTexture=!0;Pd.prototype=Object.create(ob.prototype);Pd.prototype.constructor=Pd;Qd.prototype=Object.create(ob.prototype);Qd.prototype.constructor=Qd;Ae.prototype=Object.create(tb.prototype);Ae.prototype.constructor=Ae;uc.prototype=Object.create(ob.prototype);uc.prototype.constructor=uc;Rd.prototype=Object.create(uc.prototype);Rd.prototype.constructor=Rd;Be.prototype=Object.create(tb.prototype);Be.prototype.constructor=Be;od.prototype=Object.create(uc.prototype);
od.prototype.constructor=od;Ce.prototype=Object.create(tb.prototype);Ce.prototype.constructor=Ce;Sd.prototype=Object.create(uc.prototype);Sd.prototype.constructor=Sd;De.prototype=Object.create(tb.prototype);De.prototype.constructor=De;Td.prototype=Object.create(uc.prototype);Td.prototype.constructor=Td;Ee.prototype=Object.create(tb.prototype);Ee.prototype.constructor=Ee;Fe.prototype=Object.create(tb.prototype);Fe.prototype.constructor=Fe;Ud.prototype=Object.create(ob.prototype);Ud.prototype.constructor=
Ud;Ge.prototype=Object.create(tb.prototype);Ge.prototype.constructor=Ge;Vd.prototype=Object.create(ob.prototype);Vd.prototype.constructor=Vd;He.prototype=Object.create(tb.prototype);He.prototype.constructor=He;Wd.prototype=Object.create(ob.prototype);Wd.prototype.constructor=Wd;Ie.prototype=Object.create(tb.prototype);Ie.prototype.constructor=Ie;var kc={area:function(a){for(var c=a.length,d=0,g=c-1,u=0;u<c;g=u++)d+=a[g].x*a[u].y-a[u].x*a[g].y;return.5*d},triangulate:function(){return function(a,c){var d=
a.length;if(3>d)return null;var g=[],u=[],w=[],z;if(0<kc.area(a))for(z=0;z<d;z++)u[z]=z;else for(z=0;z<d;z++)u[z]=d-1-z;var F=2*d;for(z=d-1;2<d;){if(0>=F--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}var J=z;d<=J&&(J=0);z=J+1;d<=z&&(z=0);var M=z+1;d<=M&&(M=0);a:{var R;var O=a[u[J]].x;var Q=a[u[J]].y;var W=a[u[z]].x;var ca=a[u[z]].y;var ea=a[u[M]].x;var na=a[u[M]].y;if(0>=(W-O)*(na-Q)-(ca-Q)*(ea-O))var ra=!1;else{var aa=ea-W;var qa=na-ca;var oa=O-ea;var wa=
Q-na;var ta=W-O;ra=ca-Q;for(R=0;R<d;R++){var za=a[u[R]].x;var Ja=a[u[R]].y;if(!(za===O&&Ja===Q||za===W&&Ja===ca||za===ea&&Ja===na)){var Ia=za-O;var Oa=Ja-Q;var Ua=za-W;var Na=Ja-ca;za-=ea;Ja-=na;Na=aa*Na-qa*Ua;Oa=ta*Oa-ra*Ia;za=oa*Ja-wa*za;if(Na>=-Number.EPSILON&&za>=-Number.EPSILON&&Oa>=-Number.EPSILON){ra=!1;break a}}}ra=!0}}if(ra){g.push([a[u[J]],a[u[z]],a[u[M]]]);w.push([u[J],u[z],u[M]]);J=z;for(M=z+1;M<d;J++,M++)u[J]=u[M];d--;F=2*d}}return c?w:g}}(),triangulateShape:function(a,c){function d(O){var Q=
O.length;2<Q&&O[Q-1].equals(O[0])&&O.pop()}function g(O,Q,W){return O.x!==Q.x?O.x<Q.x?O.x<=W.x&&W.x<=Q.x:Q.x<=W.x&&W.x<=O.x:O.y<Q.y?O.y<=W.y&&W.y<=Q.y:Q.y<=W.y&&W.y<=O.y}function u(O,Q,W,ca,ea){var na=Q.x-O.x,ra=Q.y-O.y,aa=ca.x-W.x,qa=ca.y-W.y,oa=O.x-W.x,wa=O.y-W.y,ta=ra*aa-na*qa,za=ra*oa-na*wa;if(Math.abs(ta)>Number.EPSILON){if(0<ta){if(0>za||za>ta)return[];aa=qa*oa-aa*wa;if(0>aa||aa>ta)return[]}else{if(0<za||za<ta)return[];aa=qa*oa-aa*wa;if(0<aa||aa<ta)return[]}if(0===aa)return!ea||0!==za&&za!==
ta?[O]:[];if(aa===ta)return!ea||0!==za&&za!==ta?[Q]:[];if(0===za)return[W];if(za===ta)return[ca];ea=aa/ta;return[{x:O.x+ea*na,y:O.y+ea*ra}]}if(0!==za||qa*oa!==aa*wa)return[];ra=0===na&&0===ra;aa=0===aa&&0===qa;if(ra&&aa)return O.x!==W.x||O.y!==W.y?[]:[O];if(ra)return g(W,ca,O)?[O]:[];if(aa)return g(O,Q,W)?[W]:[];0!==na?(O.x<Q.x?(na=O,aa=O.x,ra=Q,O=Q.x):(na=Q,aa=Q.x,ra=O,O=O.x),W.x<ca.x?(Q=W,ta=W.x,qa=ca,W=ca.x):(Q=ca,ta=ca.x,qa=W,W=W.x)):(O.y<Q.y?(na=O,aa=O.y,ra=Q,O=Q.y):(na=Q,aa=Q.y,ra=O,O=O.y),
W.y<ca.y?(Q=W,ta=W.y,qa=ca,W=ca.y):(Q=ca,ta=ca.y,qa=W,W=W.y));return aa<=ta?O<ta?[]:O===ta?ea?[]:[Q]:O<=W?[Q,ra]:[Q,qa]:aa>W?[]:aa===W?ea?[]:[na]:O<=W?[na,ra]:[na,qa]}function w(O,Q,W,ca){var ea=Q.x-O.x,na=Q.y-O.y;Q=W.x-O.x;W=W.y-O.y;var ra=ca.x-O.x;ca=ca.y-O.y;O=ea*W-na*Q;ea=ea*ca-na*ra;return Math.abs(O)>Number.EPSILON?(Q=ra*W-ca*Q,0<O?0<=ea&&0<=Q:0<=ea||0<=Q):0<ea}d(a);c.forEach(d);var z,F={},J=a.concat();var M=0;for(z=c.length;M<z;M++)Array.prototype.push.apply(J,c[M]);M=0;for(z=J.length;M<z;M++){var R=
J[M].x+":"+J[M].y;void 0!==F[R]&&console.warn("THREE.ShapeUtils: Duplicate point",R,M);F[R]=M}M=function(O,Q){function W(Sa,ab){var Pa=na.length-1,Ma=Sa-1;0>Ma&&(Ma=Pa);var Xa=Sa+1;Xa>Pa&&(Xa=0);Pa=w(na[Sa],na[Ma],na[Xa],Ua[ab]);if(!Pa)return!1;Pa=Ua.length-1;Ma=ab-1;0>Ma&&(Ma=Pa);Xa=ab+1;Xa>Pa&&(Xa=0);return(Pa=w(Ua[ab],Ua[Ma],Ua[Xa],na[Sa]))?!0:!1}function ca(Sa,ab){var Pa;for(Pa=0;Pa<na.length;Pa++){var Ma=Pa+1;Ma%=na.length;Ma=u(Sa,ab,na[Pa],na[Ma],!0);if(0<Ma.length)return!0}return!1}function ea(Sa,
ab){var Pa,Ma;for(Pa=0;Pa<ra.length;Pa++){var Xa=Q[ra[Pa]];for(Ma=0;Ma<Xa.length;Ma++){var Ka=Ma+1;Ka%=Xa.length;Ka=u(Sa,ab,Xa[Ma],Xa[Ka],!0);if(0<Ka.length)return!0}}return!1}var na=O.concat(),ra=[],aa,qa;O=[];var oa,wa=0;for(aa=Q.length;wa<aa;wa++)ra.push(wa);var ta=0;for(var za=2*ra.length;0<ra.length;){za--;if(0>za){console.log("Infinite Loop! Holes left:"+ra.length+", Probably Hole outside Shape!");break}for(qa=ta;qa<na.length;qa++){var Ja=na[qa];aa=-1;for(wa=0;wa<ra.length;wa++){var Ia=ra[wa];
var Oa=Ja.x+":"+Ja.y+":"+Ia;if(void 0===O[Oa]){var Ua=Q[Ia];for(oa=0;oa<Ua.length;oa++)if(Ia=Ua[oa],W(qa,oa)&&!ca(Ja,Ia)&&!ea(Ja,Ia)){aa=oa;ra.splice(wa,1);ta=na.slice(0,qa+1);Ia=na.slice(qa);oa=Ua.slice(aa);var Na=Ua.slice(0,aa+1);na=ta.concat(oa).concat(Na).concat(Ia);ta=qa;break}if(0<=aa)break;O[Oa]=!0}}if(0<=aa)break}}return na}(a,c);J=kc.triangulate(M,!1);M=0;for(z=J.length;M<z;M++)for(c=J[M],a=0;3>a;a++)R=c[a].x+":"+c[a].y,R=F[R],void 0!==R&&(c[a]=R);return J.concat()},isClockWise:function(a){return 0>
kc.area(a)},b2:function(){return function(a,c,d,g){var u=1-a;return u*u*c+2*(1-a)*a*d+a*a*g}}(),b3:function(){return function(a,c,d,g,u){var w=1-a,z=1-a;return w*w*w*c+3*z*z*a*d+3*(1-a)*a*a*g+a*a*a*u}}()};Ic.prototype=Object.create(tb.prototype);Ic.prototype.constructor=Ic;Ic.prototype.addShapeList=function(a,c){for(var d=a.length,g=0;g<d;g++)this.addShape(a[g],c)};Ic.prototype.addShape=function(a,c){function d(nb,Ca,mb){Ca||console.error("THREE.ExtrudeGeometry: vec does not exist");return Ca.clone().multiplyScalar(mb).add(nb)}
function g(nb,Ca,mb){var pb=nb.x-Ca.x;var ub=nb.y-Ca.y;var fb=mb.x-nb.x;var Cb=mb.y-nb.y,Fb=pb*pb+ub*ub;if(Math.abs(pb*Cb-ub*fb)>Number.EPSILON){var Kb=Math.sqrt(Fb),Vb=Math.sqrt(fb*fb+Cb*Cb);Fb=Ca.x-ub/Kb;Ca=Ca.y+pb/Kb;Cb=((mb.x-Cb/Vb-Fb)*Cb-(mb.y+fb/Vb-Ca)*fb)/(pb*Cb-ub*fb);fb=Fb+pb*Cb-nb.x;pb=Ca+ub*Cb-nb.y;ub=fb*fb+pb*pb;if(2>=ub)return new l(fb,pb);ub=Math.sqrt(ub/2)}else nb=!1,pb>Number.EPSILON?fb>Number.EPSILON&&(nb=!0):pb<-Number.EPSILON?fb<-Number.EPSILON&&(nb=!0):Math.sign(ub)===Math.sign(Cb)&&
(nb=!0),nb?(fb=-ub,ub=Math.sqrt(Fb)):(fb=pb,pb=ub,ub=Math.sqrt(Fb/2));return new l(fb/ub,pb/ub)}function u(nb,Ca){for(Ka=nb.length;0<=--Ka;){var mb=Ka;var pb=Ka-1;0>pb&&(pb=nb.length-1);var ub,fb=W+2*R;for(ub=0;ub<fb;ub++){var Cb=Pa*ub,Fb=Pa*(ub+1),Kb=Ca+mb+Cb;Cb=Ca+pb+Cb;var Vb=Ca+pb+Fb;Fb=Ca+mb+Fb;Kb+=Ja;Cb+=Ja;Vb+=Ja;Fb+=Ja;za.faces.push(new cc(Kb,Cb,Fb,null,null,1));za.faces.push(new cc(Cb,Vb,Fb,null,null,1));Kb=na.generateSideWallUV(za,Kb,Cb,Vb,Fb);za.faceVertexUvs[0].push([Kb[0],Kb[1],Kb[3]]);
za.faceVertexUvs[0].push([Kb[1],Kb[2],Kb[3]])}}}function w(nb,Ca,mb){za.vertices.push(new p(nb,Ca,mb))}function z(nb,Ca,mb){nb+=Ja;Ca+=Ja;mb+=Ja;za.faces.push(new cc(nb,Ca,mb,null,null,0));nb=na.generateTopUV(za,nb,Ca,mb);za.faceVertexUvs[0].push(nb)}var F=void 0!==c.amount?c.amount:100,J=void 0!==c.bevelThickness?c.bevelThickness:6,M=void 0!==c.bevelSize?c.bevelSize:J-2,R=void 0!==c.bevelSegments?c.bevelSegments:3,O=void 0!==c.bevelEnabled?c.bevelEnabled:!0,Q=void 0!==c.curveSegments?c.curveSegments:
12,W=void 0!==c.steps?c.steps:1,ca=c.extrudePath,ea=!1,na=void 0!==c.UVGenerator?c.UVGenerator:Ic.WorldUVGenerator;if(ca){var ra=ca.getSpacedPoints(W);ea=!0;O=!1;var aa=void 0!==c.frames?c.frames:ca.computeFrenetFrames(W,!1);var qa=new p;var oa=new p;var wa=new p}O||(M=J=R=0);var ta,za=this,Ja=this.vertices.length;c=a.extractPoints(Q);a=c.shape;var Ia=c.holes;if(c=!kc.isClockWise(a)){a=a.reverse();var Oa=0;for(ta=Ia.length;Oa<ta;Oa++){var Ua=Ia[Oa];kc.isClockWise(Ua)&&(Ia[Oa]=Ua.reverse())}c=!1}var Na=
kc.triangulateShape(a,Ia),Sa=a;Oa=0;for(ta=Ia.length;Oa<ta;Oa++)Ua=Ia[Oa],a=a.concat(Ua);var ab,Pa=a.length,Ma,Xa=Na.length;c=[];var Ka=0;var gb=Sa.length;var Wa=gb-1;for(ab=Ka+1;Ka<gb;Ka++,Wa++,ab++)Wa===gb&&(Wa=0),ab===gb&&(ab=0),c[Ka]=g(Sa[Ka],Sa[Wa],Sa[ab]);Q=[];ca=c.concat();Oa=0;for(ta=Ia.length;Oa<ta;Oa++){Ua=Ia[Oa];var sb=[];Ka=0;gb=Ua.length;Wa=gb-1;for(ab=Ka+1;Ka<gb;Ka++,Wa++,ab++)Wa===gb&&(Wa=0),ab===gb&&(ab=0),sb[Ka]=g(Ua[Ka],Ua[Wa],Ua[ab]);Q.push(sb);ca=ca.concat(sb)}for(Wa=0;Wa<R;Wa++){gb=
Wa/R;var yb=J*Math.cos(gb*Math.PI/2);ab=M*Math.sin(gb*Math.PI/2);Ka=0;for(gb=Sa.length;Ka<gb;Ka++){var Jb=d(Sa[Ka],c[Ka],ab);w(Jb.x,Jb.y,-yb)}Oa=0;for(ta=Ia.length;Oa<ta;Oa++)for(Ua=Ia[Oa],sb=Q[Oa],Ka=0,gb=Ua.length;Ka<gb;Ka++)Jb=d(Ua[Ka],sb[Ka],ab),w(Jb.x,Jb.y,-yb)}ab=M;for(Ka=0;Ka<Pa;Ka++)Jb=O?d(a[Ka],ca[Ka],ab):a[Ka],ea?(oa.copy(aa.normals[0]).multiplyScalar(Jb.x),qa.copy(aa.binormals[0]).multiplyScalar(Jb.y),wa.copy(ra[0]).add(oa).add(qa),w(wa.x,wa.y,wa.z)):w(Jb.x,Jb.y,0);for(gb=1;gb<=W;gb++)for(Ka=
0;Ka<Pa;Ka++)Jb=O?d(a[Ka],ca[Ka],ab):a[Ka],ea?(oa.copy(aa.normals[gb]).multiplyScalar(Jb.x),qa.copy(aa.binormals[gb]).multiplyScalar(Jb.y),wa.copy(ra[gb]).add(oa).add(qa),w(wa.x,wa.y,wa.z)):w(Jb.x,Jb.y,F/W*gb);for(Wa=R-1;0<=Wa;Wa--){gb=Wa/R;yb=J*Math.cos(gb*Math.PI/2);ab=M*Math.sin(gb*Math.PI/2);Ka=0;for(gb=Sa.length;Ka<gb;Ka++)Jb=d(Sa[Ka],c[Ka],ab),w(Jb.x,Jb.y,F+yb);Oa=0;for(ta=Ia.length;Oa<ta;Oa++)for(Ua=Ia[Oa],sb=Q[Oa],Ka=0,gb=Ua.length;Ka<gb;Ka++)Jb=d(Ua[Ka],sb[Ka],ab),ea?w(Jb.x,Jb.y+ra[W-1].y,
ra[W-1].x+yb):w(Jb.x,Jb.y,F+yb)}(function(){if(O){var nb=0*Pa;for(Ka=0;Ka<Xa;Ka++)Ma=Na[Ka],z(Ma[2]+nb,Ma[1]+nb,Ma[0]+nb);nb=Pa*(W+2*R);for(Ka=0;Ka<Xa;Ka++)Ma=Na[Ka],z(Ma[0]+nb,Ma[1]+nb,Ma[2]+nb)}else{for(Ka=0;Ka<Xa;Ka++)Ma=Na[Ka],z(Ma[2],Ma[1],Ma[0]);for(Ka=0;Ka<Xa;Ka++)Ma=Na[Ka],z(Ma[0]+Pa*W,Ma[1]+Pa*W,Ma[2]+Pa*W)}})();(function(){var nb=0;u(Sa,nb);nb+=Sa.length;Oa=0;for(ta=Ia.length;Oa<ta;Oa++)Ua=Ia[Oa],u(Ua,nb),nb+=Ua.length})()};Ic.WorldUVGenerator={generateTopUV:function(a,c,d,g){a=a.vertices;
c=a[c];d=a[d];g=a[g];return[new l(c.x,c.y),new l(d.x,d.y),new l(g.x,g.y)]},generateSideWallUV:function(a,c,d,g,u){a=a.vertices;c=a[c];d=a[d];g=a[g];u=a[u];return.01>Math.abs(c.y-d.y)?[new l(c.x,1-c.z),new l(d.x,1-d.z),new l(g.x,1-g.z),new l(u.x,1-u.z)]:[new l(c.y,1-c.z),new l(d.y,1-d.z),new l(g.y,1-g.z),new l(u.y,1-u.z)]}};Je.prototype=Object.create(Ic.prototype);Je.prototype.constructor=Je;pd.prototype=Object.create(ob.prototype);pd.prototype.constructor=pd;Ke.prototype=Object.create(tb.prototype);
Ke.prototype.constructor=Ke;Xd.prototype=Object.create(ob.prototype);Xd.prototype.constructor=Xd;Le.prototype=Object.create(tb.prototype);Le.prototype.constructor=Le;Me.prototype=Object.create(tb.prototype);Me.prototype.constructor=Me;Yd.prototype=Object.create(ob.prototype);Yd.prototype.constructor=Yd;Ne.prototype=Object.create(tb.prototype);Ne.prototype.constructor=Ne;Zd.prototype=Object.create(ob.prototype);Zd.prototype.constructor=Zd;$d.prototype=Object.create(tb.prototype);$d.prototype.constructor=
$d;ae.prototype=Object.create(ob.prototype);ae.prototype.constructor=ae;ad.prototype=Object.create(ob.prototype);ad.prototype.constructor=ad;qd.prototype=Object.create(tb.prototype);qd.prototype.constructor=qd;Oe.prototype=Object.create(qd.prototype);Oe.prototype.constructor=Oe;Pe.prototype=Object.create(ad.prototype);Pe.prototype.constructor=Pe;be.prototype=Object.create(ob.prototype);be.prototype.constructor=be;Qe.prototype=Object.create(tb.prototype);Qe.prototype.constructor=Qe;ce.prototype=Object.create(tb.prototype);
ce.prototype.constructor=ce;var Nc=Object.freeze({WireframeGeometry:Pd,ParametricGeometry:Ae,ParametricBufferGeometry:Qd,TetrahedronGeometry:Be,TetrahedronBufferGeometry:Rd,OctahedronGeometry:Ce,OctahedronBufferGeometry:od,IcosahedronGeometry:De,IcosahedronBufferGeometry:Sd,DodecahedronGeometry:Ee,DodecahedronBufferGeometry:Td,PolyhedronGeometry:Fe,PolyhedronBufferGeometry:uc,TubeGeometry:Ge,TubeBufferGeometry:Ud,TorusKnotGeometry:He,TorusKnotBufferGeometry:Vd,TorusGeometry:Ie,TorusBufferGeometry:Wd,
TextGeometry:Je,SphereBufferGeometry:pd,SphereGeometry:Ke,RingGeometry:Le,RingBufferGeometry:Xd,PlaneBufferGeometry:pc,PlaneGeometry:Me,LatheGeometry:Ne,LatheBufferGeometry:Yd,ShapeGeometry:$d,ShapeBufferGeometry:Zd,ExtrudeGeometry:Ic,EdgesGeometry:ae,ConeGeometry:Oe,ConeBufferGeometry:Pe,CylinderGeometry:qd,CylinderBufferGeometry:ad,CircleBufferGeometry:be,CircleGeometry:Qe,BoxBufferGeometry:Pc,BoxGeometry:ce});de.prototype=Object.create(kb.prototype);de.prototype.constructor=de;de.prototype.isShadowMaterial=
!0;ee.prototype=Object.create(kb.prototype);ee.prototype.constructor=ee;ee.prototype.isRawShaderMaterial=!0;Re.prototype={constructor:Re,isMultiMaterial:!0,toJSON:function(a){for(var c={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},d=this.materials,g=0,u=d.length;g<u;g++){var w=d[g].toJSON(a);delete w.metadata;c.materials.push(w)}c.visible=this.visible;return c},clone:function(){for(var a=new this.constructor,c=0;c<this.materials.length;c++)a.materials.push(this.materials[c].clone());
a.visible=this.visible;return a}};Uc.prototype=Object.create($a.prototype);Uc.prototype.constructor=Uc;Uc.prototype.isMeshStandardMaterial=!0;Uc.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;
this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=
a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};rd.prototype=Object.create(Uc.prototype);rd.prototype.constructor=rd;rd.prototype.isMeshPhysicalMaterial=!0;rd.prototype.copy=function(a){Uc.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;
return this};Mc.prototype=Object.create($a.prototype);Mc.prototype.constructor=Mc;Mc.prototype.isMeshPhongMaterial=!0;Mc.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;
this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=
a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};sd.prototype=Object.create(Mc.prototype);sd.prototype.constructor=sd;sd.prototype.isMeshToonMaterial=!0;sd.prototype.copy=function(a){Mc.prototype.copy.call(this,a);this.gradientMap=a.gradientMap;return this};td.prototype=Object.create($a.prototype);td.prototype.constructor=td;td.prototype.isMeshNormalMaterial=!0;td.prototype.copy=function(a){$a.prototype.copy.call(this,
a);this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};ud.prototype=Object.create($a.prototype);ud.prototype.constructor=ud;ud.prototype.isMeshLambertMaterial=
!0;ud.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;
this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};vd.prototype=Object.create($a.prototype);vd.prototype.constructor=vd;vd.prototype.isLineDashedMaterial=!0;vd.prototype.copy=function(a){$a.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=
a.dashSize;this.gapSize=a.gapSize;return this};var Lg=Object.freeze({ShadowMaterial:de,SpriteMaterial:nd,RawShaderMaterial:ee,ShaderMaterial:kb,PointsMaterial:Lc,MultiMaterial:Re,MeshPhysicalMaterial:rd,MeshStandardMaterial:Uc,MeshPhongMaterial:Mc,MeshToonMaterial:sd,MeshNormalMaterial:td,MeshLambertMaterial:ud,MeshDepthMaterial:Ib,MeshBasicMaterial:jc,LineDashedMaterial:vd,LineBasicMaterial:dc,Material:$a}),lg={enabled:!1,files:{},add:function(a,c){!1!==this.enabled&&(this.files[a]=c)},get:function(a){if(!1!==
this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},Cc=new Qf;Object.assign(Jc.prototype,{load:function(a,c,d,g){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);var u=this,w=lg.get(a);if(void 0!==w)return u.manager.itemStart(a),setTimeout(function(){c&&c(w);u.manager.itemEnd(a)},0),w;var z=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(z){var F=z[1],J=!!z[2];z=z[3];z=window.decodeURIComponent(z);J&&(z=window.atob(z));try{var M=(this.responseType||
"").toLowerCase();switch(M){case "arraybuffer":case "blob":var R=new ArrayBuffer(z.length);var O=new Uint8Array(R);for(J=0;J<z.length;J++)O[J]=z.charCodeAt(J);"blob"===M&&(R=new Blob([R],{type:F}));break;case "document":R=(new DOMParser).parseFromString(z,F);break;case "json":R=JSON.parse(z);break;default:R=z}window.setTimeout(function(){c&&c(R);u.manager.itemEnd(a)},0)}catch(W){window.setTimeout(function(){g&&g(W);u.manager.itemError(a)},0)}}else{var Q=new XMLHttpRequest;Q.open("GET",a,!0);Q.addEventListener("load",
function(W){var ca=W.target.response;lg.add(a,ca);200===this.status?(c&&c(ca),u.manager.itemEnd(a)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),c&&c(ca),u.manager.itemEnd(a)):(g&&g(W),u.manager.itemError(a))},!1);void 0!==d&&Q.addEventListener("progress",function(W){d(W)},!1);Q.addEventListener("error",function(W){g&&g(W);u.manager.itemError(a)},!1);void 0!==this.responseType&&(Q.responseType=this.responseType);void 0!==this.withCredentials&&(Q.withCredentials=this.withCredentials);
Q.overrideMimeType&&Q.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");Q.send(null)}u.manager.itemStart(a);return Q},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setMimeType:function(a){this.mimeType=a;return this}});Object.assign(tg.prototype,{load:function(a,c,d,g){function u(Q){J.load(a[Q],function(W){W=w._parser(W,!0);z[Q]={width:W.width,height:W.height,
format:W.format,mipmaps:W.mipmaps};M+=1;6===M&&(1===W.mipmapCount&&(F.minFilter=1006),F.format=W.format,F.needsUpdate=!0,c&&c(F))},d,g)}var w=this,z=[],F=new Od;F.image=z;var J=new Jc(this.manager);J.setPath(this.path);J.setResponseType("arraybuffer");if(Array.isArray(a))for(var M=0,R=0,O=a.length;R<O;++R)u(R);else J.load(a,function(Q){Q=w._parser(Q,!0);if(Q.isCubemap)for(var W=Q.mipmaps.length/Q.mipmapCount,ca=0;ca<W;ca++){z[ca]={mipmaps:[]};for(var ea=0;ea<Q.mipmapCount;ea++)z[ca].mipmaps.push(Q.mipmaps[ca*
Q.mipmapCount+ea]),z[ca].format=Q.format,z[ca].width=Q.width,z[ca].height=Q.height}else F.image.width=Q.width,F.image.height=Q.height,F.mipmaps=Q.mipmaps;1===Q.mipmapCount&&(F.minFilter=1006);F.format=Q.format;F.needsUpdate=!0;c&&c(F)},d,g);return F},setPath:function(a){this.path=a;return this}});Object.assign(Rf.prototype,{load:function(a,c,d,g){var u=this,w=new xa,z=new Jc(this.manager);z.setResponseType("arraybuffer");z.load(a,function(F){if(F=u._parser(F))void 0!==F.image?w.image=F.image:void 0!==
F.data&&(w.image.width=F.width,w.image.height=F.height,w.image.data=F.data),w.wrapS=void 0!==F.wrapS?F.wrapS:1001,w.wrapT=void 0!==F.wrapT?F.wrapT:1001,w.magFilter=void 0!==F.magFilter?F.magFilter:1006,w.minFilter=void 0!==F.minFilter?F.minFilter:1008,w.anisotropy=void 0!==F.anisotropy?F.anisotropy:1,void 0!==F.format&&(w.format=F.format),void 0!==F.type&&(w.type=F.type),void 0!==F.mipmaps&&(w.mipmaps=F.mipmaps),1===F.mipmapCount&&(w.minFilter=1006),w.needsUpdate=!0,c&&c(w,F)},d,g);return w}});Object.assign(Se.prototype,
{load:function(a,c,d,g){var u=this,w=document.createElementNS("http://www.w3.org/1999/xhtml","img");w.onload=function(){w.onload=null;URL.revokeObjectURL(w.src);c&&c(w);u.manager.itemEnd(a)};w.onerror=g;if(0===a.indexOf("data:"))w.src=a;else if(void 0!==this.crossOrigin)w.crossOrigin=this.crossOrigin,w.src=a;else{var z=new Jc;z.setPath(this.path);z.setResponseType("blob");z.setWithCredentials(this.withCredentials);/\.svg$/.test(a)&&z.setMimeType("image/svg+xml");z.load(a,function(F){w.src=URL.createObjectURL(F)},
d,g)}u.manager.itemStart(a);return w},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(Sf.prototype,{load:function(a,c,d,g){function u(J){z.load(a[J],function(M){w.images[J]=M;F++;6===F&&(w.needsUpdate=!0,c&&c(w))},void 0,g)}var w=new A,z=new Se(this.manager);z.setCrossOrigin(this.crossOrigin);z.setPath(this.path);var F=0;for(d=0;d<a.length;++d)u(d);return w},setCrossOrigin:function(a){this.crossOrigin=
a;return this},setPath:function(a){this.path=a;return this}});Object.assign(of.prototype,{load:function(a,c,d,g){var u=new e,w=new Se(this.manager);w.setCrossOrigin(this.crossOrigin);w.setWithCredentials(this.withCredentials);w.setPath(this.path);w.load(a,function(z){var F=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data:image\/jpeg/);u.format=F?1022:1023;u.image=z;u.needsUpdate=!0;void 0!==c&&c(u)},d,g);return u},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=
a;return this},setPath:function(a){this.path=a;return this}});ec.prototype=Object.assign(Object.create(jb.prototype),{constructor:ec,isLight:!0,copy:function(a){jb.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=jb.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);
void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}});pf.prototype=Object.assign(Object.create(ec.prototype),{constructor:pf,isHemisphereLight:!0,copy:function(a){ec.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});Object.assign(wd.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=
a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;return a}});qf.prototype=Object.assign(Object.create(wd.prototype),{constructor:qf,isSpotLightShadow:!0,update:function(a){var c=2*
Bb.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height;a=a.distance||500;var g=this.camera;if(c!==g.fov||d!==g.aspect||a!==g.far)g.fov=c,g.aspect=d,g.far=a,g.updateProjectionMatrix()}});rf.prototype=Object.assign(Object.create(ec.prototype),{constructor:rf,isSpotLight:!0,copy:function(a){ec.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});sf.prototype=Object.assign(Object.create(ec.prototype),
{constructor:sf,isPointLight:!0,copy:function(a){ec.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});tf.prototype=Object.assign(Object.create(wd.prototype),{constructor:tf});uf.prototype=Object.assign(Object.create(ec.prototype),{constructor:uf,isDirectionalLight:!0,copy:function(a){ec.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});vf.prototype=Object.assign(Object.create(ec.prototype),
{constructor:vf,isAmbientLight:!0});var nc={arraySlice:function(a,c,d){return nc.isTypedArray(a)?new a.constructor(a.subarray(c,d)):a.slice(c,d)},convertArray:function(a,c,d){return!a||!d&&a.constructor===c?a:"number"===typeof c.BYTES_PER_ELEMENT?new c(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var c=a.length,d=Array(c),g=0;g!==c;++g)d[g]=g;d.sort(function(u,w){return a[u]-a[w]});return d},sortedArray:function(a,
c,d){for(var g=a.length,u=new a.constructor(g),w=0,z=0;z!==g;++w)for(var F=d[w]*c,J=0;J!==c;++J)u[z++]=a[F+J];return u},flattenJSON:function(a,c,d,g){for(var u=1,w=a[0];void 0!==w&&void 0===w[g];)w=a[u++];if(void 0!==w){var z=w[g];if(void 0!==z)if(Array.isArray(z)){do z=w[g],void 0!==z&&(c.push(w.time),d.push.apply(d,z)),w=a[u++];while(void 0!==w)}else if(void 0!==z.toArray){do z=w[g],void 0!==z&&(c.push(w.time),z.toArray(d,d.length)),w=a[u++];while(void 0!==w)}else{do z=w[g],void 0!==z&&(c.push(w.time),
d.push(z)),w=a[u++];while(void 0!==w)}}}};vc.prototype={constructor:vc,evaluate:function(a){var c=this.parameterPositions,d=this._cachedIndex,g=c[d],u=c[d-1];a:{b:{c:{d:if(!(a<g)){for(var w=d+2;;){if(void 0===g){if(a<u)break d;this._cachedIndex=d=c.length;return this.afterEnd_(d-1,a,u)}if(d===w)break;u=g;g=c[++d];if(a<g)break b}g=c.length;break c}if(a>=u)break a;else{w=c[1];a<w&&(d=2,u=w);for(w=d-2;;){if(void 0===u)return this._cachedIndex=0,this.beforeStart_(0,a,g);if(d===w)break;g=u;u=c[--d-1];
if(a>=u)break b}g=d;d=0}}for(;d<g;)u=d+g>>>1,a<c[u]?g=u:d=u+1;g=c[d];u=c[d-1];if(void 0===u)return this._cachedIndex=0,this.beforeStart_(0,a,g);if(void 0===g)return this._cachedIndex=d=c.length,this.afterEnd_(d-1,u,a)}this._cachedIndex=d;this.intervalChanged_(d,u,g)}return this.interpolate_(d,u,a,g)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var c=this.resultBuffer,d=this.sampleValues,g=this.valueSize;a*=g;for(var u=
0;u!==g;++u)c[u]=d[a+u];return c},interpolate_:function(a,c,d,g){throw Error("call to abstract method");},intervalChanged_:function(a,c,d){}};Object.assign(vc.prototype,{beforeStart_:vc.prototype.copySampleValue_,afterEnd_:vc.prototype.copySampleValue_});wf.prototype=Object.assign(Object.create(vc.prototype),{constructor:wf,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,c,d){var g=this.parameterPositions,u=a-2,w=a+1,z=g[u],F=g[w];if(void 0===z)switch(this.getSettings_().endingStart){case 2401:u=
a;z=2*c-d;break;case 2402:u=g.length-2;z=c+g[u]-g[u+1];break;default:u=a,z=d}if(void 0===F)switch(this.getSettings_().endingEnd){case 2401:w=a;F=2*d-c;break;case 2402:w=1;F=d+g[1]-g[0];break;default:w=a-1,F=c}a=.5*(d-c);g=this.valueSize;this._weightPrev=a/(c-z);this._weightNext=a/(F-d);this._offsetPrev=u*g;this._offsetNext=w*g},interpolate_:function(a,c,d,g){var u=this.resultBuffer,w=this.sampleValues,z=this.valueSize;a*=z;var F=a-z,J=this._offsetPrev,M=this._offsetNext,R=this._weightPrev,O=this._weightNext,
Q=(d-c)/(g-c);d=Q*Q;g=d*Q;c=-R*g+2*R*d-R*Q;R=(1+R)*g+(-1.5-2*R)*d+(-.5+R)*Q+1;Q=(-1-O)*g+(1.5+O)*d+.5*Q;O=O*g-O*d;for(d=0;d!==z;++d)u[d]=c*w[J+d]+R*w[F+d]+Q*w[a+d]+O*w[M+d];return u}});Te.prototype=Object.assign(Object.create(vc.prototype),{constructor:Te,interpolate_:function(a,c,d,g){var u=this.resultBuffer,w=this.sampleValues,z=this.valueSize;a*=z;var F=a-z;c=(d-c)/(g-c);d=1-c;for(g=0;g!==z;++g)u[g]=w[F+g]*d+w[a+g]*c;return u}});xf.prototype=Object.assign(Object.create(vc.prototype),{constructor:xf,
interpolate_:function(a,c,d,g){return this.copySampleValue_(a-1)}});var fd={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new xf(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new Te(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new wf(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){switch(a){case 2300:var c=
this.InterpolantFactoryMethodDiscrete;break;case 2301:c=this.InterpolantFactoryMethodLinear;break;case 2302:c=this.InterpolantFactoryMethodSmooth}if(void 0===c){c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(c);console.warn(c)}else this.createInterpolant=c},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;
case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var c=this.times,d=0,g=c.length;d!==g;++d)c[d]+=a;return this},scale:function(a){if(1!==a)for(var c=this.times,d=0,g=c.length;d!==g;++d)c[d]*=a;return this},trim:function(a,c){for(var d=this.times,g=d.length,u=0,w=g-1;u!==g&&d[u]<a;)++u;for(;-1!==w&&d[w]>c;)--w;++w;if(0!==u||w!==g)u>=w&&(w=Math.max(w,
1),u=w-1),a=this.getValueSize(),this.times=nc.arraySlice(d,u,w),this.values=nc.arraySlice(this.values,u*a,w*a);return this},validate:function(){var a=!0,c=this.getValueSize();0!==c-Math.floor(c)&&(console.error("invalid value size in track",this),a=!1);var d=this.times;c=this.values;var g=d.length;0===g&&(console.error("track is empty",this),a=!1);for(var u=null,w=0;w!==g;w++){var z=d[w];if("number"===typeof z&&isNaN(z)){console.error("time is not a valid number",this,w,z);a=!1;break}if(null!==u&&
u>z){console.error("out of order keys",this,w,z,u);a=!1;break}u=z}if(void 0!==c&&nc.isTypedArray(c))for(w=0,d=c.length;w!==d;++w)if(g=c[w],isNaN(g)){console.error("value is not a valid number",this,w,g);a=!1;break}return a},optimize:function(){for(var a=this.times,c=this.values,d=this.getValueSize(),g=2302===this.getInterpolation(),u=1,w=a.length-1,z=1;z<w;++z){var F=!1,J=a[z];if(J!==a[z+1]&&(1!==z||J!==J[0]))if(g)F=!0;else{var M=z*d,R=M-d,O=M+d;for(J=0;J!==d;++J){var Q=c[M+J];if(Q!==c[R+J]||Q!==
c[O+J]){F=!0;break}}}if(F){if(z!==u)for(a[u]=a[z],F=z*d,M=u*d,J=0;J!==d;++J)c[M+J]=c[F+J];++u}}if(0<w){a[u]=a[w];F=w*d;M=u*d;for(J=0;J!==d;++J)c[M+J]=c[F+J];++u}u!==a.length&&(this.times=nc.arraySlice(a,0,u),this.values=nc.arraySlice(c,0,u*d));return this}};fe.prototype=Object.assign(Object.create(fd),{constructor:fe,ValueTypeName:"vector"});yf.prototype=Object.assign(Object.create(vc.prototype),{constructor:yf,interpolate_:function(a,c,d,g){var u=this.resultBuffer,w=this.sampleValues,z=this.valueSize;
a*=z;c=(d-c)/(g-c);for(d=a+z;a!==d;a+=4)t.slerpFlat(u,0,w,a-z,w,a,c);return u}});Ue.prototype=Object.assign(Object.create(fd),{constructor:Ue,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new yf(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});ge.prototype=Object.assign(Object.create(fd),{constructor:ge,ValueTypeName:"number"});zf.prototype=Object.assign(Object.create(fd),{constructor:zf,ValueTypeName:"string",
ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Af.prototype=Object.assign(Object.create(fd),{constructor:Af,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Bf.prototype=Object.assign(Object.create(fd),{constructor:Bf,ValueTypeName:"color"});yd.prototype=fd;fd.constructor=yd;Object.assign(yd,{parse:function(a){if(void 0===
a.type)throw Error("track type undefined, can not parse");var c=yd._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var d=[],g=[];nc.flattenJSON(a.keys,d,g,"value");a.times=d;a.values=g}return void 0!==c.parse?c.parse(a):new c(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var c=a.constructor;if(void 0!==c.toJSON)c=c.toJSON(a);else{c={name:a.name,times:nc.convertArray(a.times,Array),values:nc.convertArray(a.values,Array)};var d=a.getInterpolation();d!==a.DefaultInterpolation&&
(c.interpolation=d)}c.type=a.ValueTypeName;return c},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return ge;case "vector":case "vector2":case "vector3":case "vector4":return fe;case "color":return Bf;case "quaternion":return Ue;case "bool":case "boolean":return Af;case "string":return zf}throw Error("Unsupported typeName: "+a);}});Dc.prototype={constructor:Dc,resetDuration:function(){for(var a=0,c=0,d=this.tracks.length;c!==
d;++c){var g=this.tracks[c];a=Math.max(a,g.times[g.times.length-1])}this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};Object.assign(Dc,{parse:function(a){for(var c=[],d=a.tracks,g=1/(a.fps||1),u=0,w=d.length;u!==w;++u)c.push(yd.parse(d[u]).scale(g));return new Dc(a.name,a.duration,c)},toJSON:function(a){var c=[],d=a.tracks;a={name:a.name,
duration:a.duration,tracks:c};for(var g=0,u=d.length;g!==u;++g)c.push(yd.toJSON(d[g]));return a},CreateFromMorphTargetSequence:function(a,c,d,g){for(var u=c.length,w=[],z=0;z<u;z++){var F=[],J=[];F.push((z+u-1)%u,z,(z+1)%u);J.push(0,1,0);var M=nc.getKeyframeOrder(F);F=nc.sortedArray(F,1,M);J=nc.sortedArray(J,1,M);g||0!==F[0]||(F.push(u),J.push(J[0]));w.push((new ge(".morphTargetInfluences["+c[z].name+"]",F,J)).scale(1/d))}return new Dc(a,-1,w)},findByName:function(a,c){var d=a;Array.isArray(a)||(d=
a.geometry&&a.geometry.animations||a.animations);for(a=0;a<d.length;a++)if(d[a].name===c)return d[a];return null},CreateClipsFromMorphTargetSequences:function(a,c,d){for(var g={},u=/^([\w-]*?)([\d]+)$/,w=0,z=a.length;w<z;w++){var F=a[w],J=F.name.match(u);if(J&&1<J.length){var M=J[1];(J=g[M])||(g[M]=J=[]);J.push(F)}}a=[];for(M in g)a.push(Dc.CreateFromMorphTargetSequence(M,g[M],c,d));return a},parseAnimation:function(a,c){if(!a)return console.error("  no animation in JSONLoader data"),null;var d=function(ea,
na,ra,aa,qa){if(0!==ra.length){var oa=[],wa=[];nc.flattenJSON(ra,oa,wa,aa);0!==oa.length&&qa.push(new ea(na,oa,wa))}},g=[],u=a.name||"default",w=a.length||-1,z=a.fps||30;a=a.hierarchy||[];for(var F=0;F<a.length;F++){var J=a[F].keys;if(J&&0!==J.length)if(J[0].morphTargets){w={};for(var M=0;M<J.length;M++)if(J[M].morphTargets)for(var R=0;R<J[M].morphTargets.length;R++)w[J[M].morphTargets[R]]=-1;for(var O in w){var Q=[],W=[];for(R=0;R!==J[M].morphTargets.length;++R){var ca=J[M];Q.push(ca.time);W.push(ca.morphTarget===
O?1:0)}g.push(new ge(".morphTargetInfluence["+O+"]",Q,W))}w=w.length*(z||1)}else M=".bones["+c[F].name+"]",d(fe,M+".position",J,"pos",g),d(Ue,M+".quaternion",J,"rot",g),d(fe,M+".scale",J,"scl",g)}return 0===g.length?null:new Dc(u,w,g)}});Object.assign(Cf.prototype,{load:function(a,c,d,g){var u=this;(new Jc(u.manager)).load(a,function(w){c(u.parse(JSON.parse(w)))},d,g)},setTextures:function(a){this.textures=a},parse:function(a){function c(z){void 0===d[z]&&console.warn("THREE.MaterialLoader: Undefined texture",
z);return d[z]}var d=this.textures,g=new Lg[a.type];void 0!==a.uuid&&(g.uuid=a.uuid);void 0!==a.name&&(g.name=a.name);void 0!==a.color&&g.color.setHex(a.color);void 0!==a.roughness&&(g.roughness=a.roughness);void 0!==a.metalness&&(g.metalness=a.metalness);void 0!==a.emissive&&g.emissive.setHex(a.emissive);void 0!==a.specular&&g.specular.setHex(a.specular);void 0!==a.shininess&&(g.shininess=a.shininess);void 0!==a.clearCoat&&(g.clearCoat=a.clearCoat);void 0!==a.clearCoatRoughness&&(g.clearCoatRoughness=
a.clearCoatRoughness);void 0!==a.uniforms&&(g.uniforms=a.uniforms);void 0!==a.vertexShader&&(g.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(g.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(g.vertexColors=a.vertexColors);void 0!==a.fog&&(g.fog=a.fog);void 0!==a.shading&&(g.shading=a.shading);void 0!==a.blending&&(g.blending=a.blending);void 0!==a.side&&(g.side=a.side);void 0!==a.opacity&&(g.opacity=a.opacity);void 0!==a.transparent&&(g.transparent=a.transparent);void 0!==a.alphaTest&&
(g.alphaTest=a.alphaTest);void 0!==a.depthTest&&(g.depthTest=a.depthTest);void 0!==a.depthWrite&&(g.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(g.colorWrite=a.colorWrite);void 0!==a.wireframe&&(g.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(g.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(g.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(g.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.skinning&&(g.skinning=a.skinning);void 0!==a.morphTargets&&
(g.morphTargets=a.morphTargets);void 0!==a.size&&(g.size=a.size);void 0!==a.sizeAttenuation&&(g.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(g.map=c(a.map));void 0!==a.alphaMap&&(g.alphaMap=c(a.alphaMap),g.transparent=!0);void 0!==a.bumpMap&&(g.bumpMap=c(a.bumpMap));void 0!==a.bumpScale&&(g.bumpScale=a.bumpScale);void 0!==a.normalMap&&(g.normalMap=c(a.normalMap));if(void 0!==a.normalScale){var u=a.normalScale;!1===Array.isArray(u)&&(u=[u,u]);g.normalScale=(new l).fromArray(u)}void 0!==a.displacementMap&&
(g.displacementMap=c(a.displacementMap));void 0!==a.displacementScale&&(g.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(g.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(g.roughnessMap=c(a.roughnessMap));void 0!==a.metalnessMap&&(g.metalnessMap=c(a.metalnessMap));void 0!==a.emissiveMap&&(g.emissiveMap=c(a.emissiveMap));void 0!==a.emissiveIntensity&&(g.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(g.specularMap=c(a.specularMap));void 0!==a.envMap&&
(g.envMap=c(a.envMap));void 0!==a.reflectivity&&(g.reflectivity=a.reflectivity);void 0!==a.lightMap&&(g.lightMap=c(a.lightMap));void 0!==a.lightMapIntensity&&(g.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(g.aoMap=c(a.aoMap));void 0!==a.aoMapIntensity&&(g.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(g.gradientMap=c(a.gradientMap));if(void 0!==a.materials){u=0;for(var w=a.materials.length;u<w;u++)g.materials.push(this.parse(a.materials[u]))}return g}});Object.assign(Tf.prototype,
{load:function(a,c,d,g){var u=this;(new Jc(u.manager)).load(a,function(w){c(u.parse(JSON.parse(w)))},d,g)},parse:function(a){var c=new ob,d=a.data.index,g={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};void 0!==d&&(d=new g[d.type](d.array),c.setIndex(new bb(d,1)));var u=a.data.attributes;for(z in u){var w=u[z];d=new g[w.type](w.array);c.addAttribute(z,new bb(d,w.itemSize,w.normalized))}g=a.data.groups||a.data.drawcalls||a.data.offsets;
if(void 0!==g){var z=0;for(d=g.length;z!==d;++z)u=g[z],c.addGroup(u.start,u.count,u.materialIndex)}a=a.data.boundingSphere;void 0!==a&&(g=new p,void 0!==a.center&&g.fromArray(a.center),c.boundingSphere=new Mb(g,a.radius));return c}});zd.prototype={constructor:zd,crossOrigin:void 0,extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,c,d){for(var g=[],u=0;u<a.length;++u)g[u]=this.createMaterial(a[u],c,d);return g},createMaterial:function(){var a=
{NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},c,d,g;return function(u,w,z){function F(Q,W,ca,ea,na){Q=w+Q;var ra=zd.Handlers.get(Q);null!==ra?Q=ra.load(Q):(d.setCrossOrigin(z),Q=d.load(Q));void 0!==W&&(Q.repeat.fromArray(W),1!==W[0]&&(Q.wrapS=1E3),1!==W[1]&&(Q.wrapT=1E3));void 0!==ca&&Q.offset.fromArray(ca);void 0!==ea&&("repeat"===ea[0]&&(Q.wrapS=1E3),"mirror"===ea[0]&&(Q.wrapS=1002),"repeat"===ea[1]&&(Q.wrapT=1E3),"mirror"===ea[1]&&
(Q.wrapT=1002));void 0!==na&&(Q.anisotropy=na);W=Bb.generateUUID();J[W]=Q;return W}void 0===c&&(c=new la);void 0===d&&(d=new of);void 0===g&&(g=new Cf);var J={},M={uuid:Bb.generateUUID(),type:"MeshLambertMaterial"},R;for(R in u){var O=u[R];switch(R){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":M.name=O;break;case "blending":M.blending=a[O];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",R,"is no longer supported.");
break;case "colorDiffuse":M.color=c.fromArray(O).getHex();break;case "colorSpecular":M.specular=c.fromArray(O).getHex();break;case "colorEmissive":M.emissive=c.fromArray(O).getHex();break;case "specularCoef":M.shininess=O;break;case "shading":"basic"===O.toLowerCase()&&(M.type="MeshBasicMaterial");"phong"===O.toLowerCase()&&(M.type="MeshPhongMaterial");"standard"===O.toLowerCase()&&(M.type="MeshStandardMaterial");break;case "mapDiffuse":M.map=F(O,u.mapDiffuseRepeat,u.mapDiffuseOffset,u.mapDiffuseWrap,
u.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":M.emissiveMap=F(O,u.mapEmissiveRepeat,u.mapEmissiveOffset,u.mapEmissiveWrap,u.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":M.lightMap=F(O,u.mapLightRepeat,u.mapLightOffset,u.mapLightWrap,u.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;
case "mapAO":M.aoMap=F(O,u.mapAORepeat,u.mapAOOffset,u.mapAOWrap,u.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":M.bumpMap=F(O,u.mapBumpRepeat,u.mapBumpOffset,u.mapBumpWrap,u.mapBumpAnisotropy);break;case "mapBumpScale":M.bumpScale=O;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":M.normalMap=F(O,u.mapNormalRepeat,u.mapNormalOffset,u.mapNormalWrap,u.mapNormalAnisotropy);
break;case "mapNormalFactor":M.normalScale=[O,O];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":M.specularMap=F(O,u.mapSpecularRepeat,u.mapSpecularOffset,u.mapSpecularWrap,u.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":M.metalnessMap=F(O,u.mapMetalnessRepeat,u.mapMetalnessOffset,u.mapMetalnessWrap,u.mapMetalnessAnisotropy);
break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":M.roughnessMap=F(O,u.mapRoughnessRepeat,u.mapRoughnessOffset,u.mapRoughnessWrap,u.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":M.alphaMap=F(O,u.mapAlphaRepeat,u.mapAlphaOffset,u.mapAlphaWrap,u.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;
case "flipSided":M.side=1;break;case "doubleSided":M.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");M.opacity=O;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":M[R]=O;break;case "vertexColors":!0===O&&(M.vertexColors=2);"face"===O&&(M.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",R,O)}}"MeshBasicMaterial"===
M.type&&delete M.emissive;"MeshPhongMaterial"!==M.type&&delete M.specular;1>M.opacity&&(M.transparent=!0);g.setTextures(J);return g.parse(M)}}()};zd.Handlers={handlers:[],add:function(a,c){this.handlers.push(a,c)},get:function(a){for(var c=this.handlers,d=0,g=c.length;d<g;d+=2){var u=c[d+1];if(c[d].test(a))return u}return null}};Object.assign(Uf.prototype,{load:function(a,c,d,g){var u=this,w=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:zd.prototype.extractUrlBase(a),z=new Jc(this.manager);
z.setWithCredentials(this.withCredentials);z.load(a,function(F){F=JSON.parse(F);var J=F.metadata;if(void 0!==J&&(J=J.type,void 0!==J)){if("object"===J.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===J.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");return}}F=u.parse(F,w);c(F.geometry,F.materials)},d,g)},setTexturePath:function(a){this.texturePath=a},parse:function(a,
c){var d=new tb,g=void 0!==a.scale?1/a.scale:1;(function(u){var w,z,F,J=a.faces;var M=a.vertices;var R=a.normals,O=a.colors,Q=0;if(void 0!==a.uvs){for(w=0;w<a.uvs.length;w++)a.uvs[w].length&&Q++;for(w=0;w<Q;w++)d.faceVertexUvs[w]=[]}var W=0;for(F=M.length;W<F;)w=new p,w.x=M[W++]*u,w.y=M[W++]*u,w.z=M[W++]*u,d.vertices.push(w);W=0;for(F=J.length;W<F;){u=J[W++];var ca=u&1;var ea=u&2;w=u&8;var na=u&16;var ra=u&32;M=u&64;u&=128;if(ca){ca=new cc;ca.a=J[W];ca.b=J[W+1];ca.c=J[W+3];var aa=new cc;aa.a=J[W+
1];aa.b=J[W+2];aa.c=J[W+3];W+=4;ea&&(ea=J[W++],ca.materialIndex=ea,aa.materialIndex=ea);ea=d.faces.length;if(w)for(w=0;w<Q;w++){var qa=a.uvs[w];d.faceVertexUvs[w][ea]=[];d.faceVertexUvs[w][ea+1]=[];for(z=0;4>z;z++){var oa=J[W++];var wa=qa[2*oa];oa=qa[2*oa+1];wa=new l(wa,oa);2!==z&&d.faceVertexUvs[w][ea].push(wa);0!==z&&d.faceVertexUvs[w][ea+1].push(wa)}}na&&(na=3*J[W++],ca.normal.set(R[na++],R[na++],R[na]),aa.normal.copy(ca.normal));if(ra)for(w=0;4>w;w++)na=3*J[W++],ra=new p(R[na++],R[na++],R[na]),
2!==w&&ca.vertexNormals.push(ra),0!==w&&aa.vertexNormals.push(ra);M&&(M=J[W++],M=O[M],ca.color.setHex(M),aa.color.setHex(M));if(u)for(w=0;4>w;w++)M=J[W++],M=O[M],2!==w&&ca.vertexColors.push(new la(M)),0!==w&&aa.vertexColors.push(new la(M));d.faces.push(ca);d.faces.push(aa)}else{ca=new cc;ca.a=J[W++];ca.b=J[W++];ca.c=J[W++];ea&&(ea=J[W++],ca.materialIndex=ea);ea=d.faces.length;if(w)for(w=0;w<Q;w++)for(qa=a.uvs[w],d.faceVertexUvs[w][ea]=[],z=0;3>z;z++)oa=J[W++],wa=qa[2*oa],oa=qa[2*oa+1],wa=new l(wa,
oa),d.faceVertexUvs[w][ea].push(wa);na&&(na=3*J[W++],ca.normal.set(R[na++],R[na++],R[na]));if(ra)for(w=0;3>w;w++)na=3*J[W++],ra=new p(R[na++],R[na++],R[na]),ca.vertexNormals.push(ra);M&&(M=J[W++],ca.color.setHex(O[M]));if(u)for(w=0;3>w;w++)M=J[W++],ca.vertexColors.push(new la(O[M]));d.faces.push(ca)}}})(g);(function(){var u=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var w=0,z=a.skinWeights.length;w<z;w+=u)d.skinWeights.push(new r(a.skinWeights[w],1<u?a.skinWeights[w+
1]:0,2<u?a.skinWeights[w+2]:0,3<u?a.skinWeights[w+3]:0));if(a.skinIndices)for(w=0,z=a.skinIndices.length;w<z;w+=u)d.skinIndices.push(new r(a.skinIndices[w],1<u?a.skinIndices[w+1]:0,2<u?a.skinIndices[w+2]:0,3<u?a.skinIndices[w+3]:0));d.bones=a.bones;d.bones&&0<d.bones.length&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length)&&console.warn("When skinning, number of vertices ("+d.vertices.length+"), skinIndices ("+d.skinIndices.length+"), and skinWeights ("+d.skinWeights.length+
") should match.")})();(function(u){if(void 0!==a.morphTargets)for(var w=0,z=a.morphTargets.length;w<z;w++){d.morphTargets[w]={};d.morphTargets[w].name=a.morphTargets[w].name;d.morphTargets[w].vertices=[];for(var F=d.morphTargets[w].vertices,J=a.morphTargets[w].vertices,M=0,R=J.length;M<R;M+=3){var O=new p;O.x=J[M]*u;O.y=J[M+1]*u;O.z=J[M+2]*u;F.push(O)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),
u=d.faces,F=a.morphColors[0].colors,w=0,z=u.length;w<z;w++)u[w].color.fromArray(F,3*w)})(g);(function(){var u=[],w=[];void 0!==a.animation&&w.push(a.animation);void 0!==a.animations&&(a.animations.length?w=w.concat(a.animations):w.push(a.animations));for(var z=0;z<w.length;z++){var F=Dc.parseAnimation(w[z],d.bones);F&&u.push(F)}d.morphTargets&&(w=Dc.CreateClipsFromMorphTargetSequences(d.morphTargets,10),u=u.concat(w));0<u.length&&(d.animations=u)})();d.computeFaceNormals();d.computeBoundingSphere();
if(void 0===a.materials||0===a.materials.length)return{geometry:d};c=zd.prototype.initMaterials(a.materials,c,this.crossOrigin);return{geometry:d,materials:c}}});Object.assign(ug.prototype,{load:function(a,c,d,g){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var u=this;(new Jc(u.manager)).load(a,function(w){var z=null;try{z=JSON.parse(w)}catch(F){console.error("THREE:ObjectLoader: Can't parse "+a+".",F.message);return}w=z.metadata;void 0===w||void 0===w.type||"geometry"===
w.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+a+". Use THREE.JSONLoader instead."):u.parse(z,c)},d,g)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,c){var d=this.parseGeometries(a.geometries),g=this.parseImages(a.images,function(){void 0!==c&&c(u)});g=this.parseTextures(a.textures,g);g=this.parseMaterials(a.materials,g);var u=this.parseObject(a.object,d,g);a.animations&&(u.animations=this.parseAnimations(a.animations));
void 0!==a.images&&0!==a.images.length||void 0===c||c(u);return u},parseGeometries:function(a){var c={};if(void 0!==a)for(var d=new Uf,g=new Tf,u=0,w=a.length;u<w;u++){var z=a[u];switch(z.type){case "PlaneGeometry":case "PlaneBufferGeometry":var F=new Nc[z.type](z.width,z.height,z.widthSegments,z.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":F=new Nc[z.type](z.width,z.height,z.depth,z.widthSegments,z.heightSegments,z.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":F=
new Nc[z.type](z.radius,z.segments,z.thetaStart,z.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":F=new Nc[z.type](z.radiusTop,z.radiusBottom,z.height,z.radialSegments,z.heightSegments,z.openEnded,z.thetaStart,z.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":F=new Nc[z.type](z.radius,z.height,z.radialSegments,z.heightSegments,z.openEnded,z.thetaStart,z.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":F=new Nc[z.type](z.radius,z.widthSegments,
z.heightSegments,z.phiStart,z.phiLength,z.thetaStart,z.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":F=new Nc[z.type](z.radius,z.detail);break;case "RingGeometry":case "RingBufferGeometry":F=new Nc[z.type](z.innerRadius,z.outerRadius,z.thetaSegments,z.phiSegments,z.thetaStart,z.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":F=new Nc[z.type](z.radius,z.tube,z.radialSegments,z.tubularSegments,z.arc);
break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":F=new Nc[z.type](z.radius,z.tube,z.tubularSegments,z.radialSegments,z.p,z.q);break;case "LatheGeometry":case "LatheBufferGeometry":F=new Nc[z.type](z.points,z.segments,z.phiStart,z.phiLength);break;case "BufferGeometry":F=g.parse(z);break;case "Geometry":F=d.parse(z.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+z.type+'"');continue}F.uuid=z.uuid;void 0!==z.name&&(F.name=z.name);
c[z.uuid]=F}return c},parseMaterials:function(a,c){var d={};if(void 0!==a){var g=new Cf;g.setTextures(c);c=0;for(var u=a.length;c<u;c++){var w=g.parse(a[c]);d[w.uuid]=w}}return d},parseAnimations:function(a){for(var c=[],d=0;d<a.length;d++){var g=Dc.parse(a[d]);c.push(g)}return c},parseImages:function(a,c){function d(M){g.manager.itemStart(M);return w.load(M,function(){g.manager.itemEnd(M)},void 0,function(){g.manager.itemError(M)})}var g=this,u={};if(void 0!==a&&0<a.length){c=new Qf(c);var w=new Se(c);
w.setCrossOrigin(this.crossOrigin);c=0;for(var z=a.length;c<z;c++){var F=a[c],J=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(F.url)?F.url:g.texturePath+F.url;u[F.uuid]=d(J)}}return u},parseTextures:function(a,c){function d(O,Q){if("number"===typeof O)return O;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",O);return Q[O]}var g={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,
CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},u={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},w={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008},z={};if(void 0!==a)for(var F=0,J=a.length;F<J;F++){var M=a[F];void 0===M.image&&console.warn('THREE.ObjectLoader: No "image" specified for',M.uuid);void 0===c[M.image]&&console.warn("THREE.ObjectLoader: Undefined image",
M.image);var R=new e(c[M.image]);R.needsUpdate=!0;R.uuid=M.uuid;void 0!==M.name&&(R.name=M.name);void 0!==M.mapping&&(R.mapping=d(M.mapping,g));void 0!==M.offset&&R.offset.fromArray(M.offset);void 0!==M.repeat&&R.repeat.fromArray(M.repeat);void 0!==M.wrap&&(R.wrapS=d(M.wrap[0],u),R.wrapT=d(M.wrap[1],u));void 0!==M.minFilter&&(R.minFilter=d(M.minFilter,w));void 0!==M.magFilter&&(R.magFilter=d(M.magFilter,w));void 0!==M.anisotropy&&(R.anisotropy=M.anisotropy);void 0!==M.flipY&&(R.flipY=M.flipY);z[M.uuid]=
R}return z},parseObject:function(){var a=new y;return function(c,d,g){function u(R){void 0===d[R]&&console.warn("THREE.ObjectLoader: Undefined geometry",R);return d[R]}function w(R){if(void 0!==R)return void 0===g[R]&&console.warn("THREE.ObjectLoader: Undefined material",R),g[R]}switch(c.type){case "Scene":var z=new md;void 0!==c.background&&Number.isInteger(c.background)&&(z.background=new la(c.background));void 0!==c.fog&&("Fog"===c.fog.type?z.fog=new Md(c.fog.color,c.fog.near,c.fog.far):"FogExp2"===
c.fog.type&&(z.fog=new Ld(c.fog.color,c.fog.density)));break;case "PerspectiveCamera":z=new ua(c.fov,c.aspect,c.near,c.far);void 0!==c.focus&&(z.focus=c.focus);void 0!==c.zoom&&(z.zoom=c.zoom);void 0!==c.filmGauge&&(z.filmGauge=c.filmGauge);void 0!==c.filmOffset&&(z.filmOffset=c.filmOffset);void 0!==c.view&&(z.view=Object.assign({},c.view));break;case "OrthographicCamera":z=new Da(c.left,c.right,c.top,c.bottom,c.near,c.far);break;case "AmbientLight":z=new vf(c.color,c.intensity);break;case "DirectionalLight":z=
new uf(c.color,c.intensity);break;case "PointLight":z=new sf(c.color,c.intensity,c.distance,c.decay);break;case "SpotLight":z=new rf(c.color,c.intensity,c.distance,c.angle,c.penumbra,c.decay);break;case "HemisphereLight":z=new pf(c.color,c.groundColor,c.intensity);break;case "Mesh":z=u(c.geometry);var F=w(c.material);z=z.bones&&0<z.bones.length?new lf(z,F):new Sb(z,F);break;case "LOD":z=new xe;break;case "Line":z=new $c(u(c.geometry),w(c.material),c.mode);break;case "LineSegments":z=new Wb(u(c.geometry),
w(c.material));break;case "PointCloud":case "Points":z=new Nd(u(c.geometry),w(c.material));break;case "Sprite":z=new we(w(c.material));break;case "Group":z=new ye;break;case "SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:z=new jb}z.uuid=c.uuid;void 0!==c.name&&(z.name=c.name);void 0!==c.matrix?(a.fromArray(c.matrix),a.decompose(z.position,z.quaternion,z.scale)):(void 0!==c.position&&z.position.fromArray(c.position),
void 0!==c.rotation&&z.rotation.fromArray(c.rotation),void 0!==c.quaternion&&z.quaternion.fromArray(c.quaternion),void 0!==c.scale&&z.scale.fromArray(c.scale));void 0!==c.castShadow&&(z.castShadow=c.castShadow);void 0!==c.receiveShadow&&(z.receiveShadow=c.receiveShadow);c.shadow&&(void 0!==c.shadow.bias&&(z.shadow.bias=c.shadow.bias),void 0!==c.shadow.radius&&(z.shadow.radius=c.shadow.radius),void 0!==c.shadow.mapSize&&z.shadow.mapSize.fromArray(c.shadow.mapSize),void 0!==c.shadow.camera&&(z.shadow.camera=
this.parseObject(c.shadow.camera)));void 0!==c.visible&&(z.visible=c.visible);void 0!==c.userData&&(z.userData=c.userData);if(void 0!==c.children)for(var J in c.children)z.add(this.parseObject(c.children[J],d,g));if("LOD"===c.type)for(c=c.levels,F=0;F<c.length;F++){var M=c[F];J=z.getObjectByProperty("uuid",M.object);void 0!==J&&z.addLevel(J,M.distance)}return z}}()});oc.prototype={constructor:oc,getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=
this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);for(var c=[],d=0;d<=a;d++)c.push(this.getPoint(d/a));return c},getSpacedPoints:function(a){a||(a=5);for(var c=[],d=0;d<=a;d++)c.push(this.getPointAt(d/a));return c},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;
this.needsUpdate=!1;var c=[],d=this.getPoint(0),g,u=0;c.push(0);for(g=1;g<=a;g++){var w=this.getPoint(g/a);u+=w.distanceTo(d);c.push(u);d=w}return this.cacheArcLengths=c},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,c){var d=this.getLengths(),g=d.length;c=c?c:a*d[g-1];for(var u=0,w=g-1,z;u<=w;)if(a=Math.floor(u+(w-u)/2),z=d[a]-c,0>z)u=a+1;else if(0<z)w=a-1;else{w=a;break}a=w;if(d[a]===c)return a/(g-1);u=d[a];return(a+(c-u)/(d[a+1]-u))/(g-1)},getTangent:function(a){var c=
a-1E-4;a+=1E-4;0>c&&(c=0);1<a&&(a=1);c=this.getPoint(c);return this.getPoint(a).clone().sub(c).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)},computeFrenetFrames:function(a,c){var d=new p,g=[],u=[],w=[],z=new p,F=new y,J;for(J=0;J<=a;J++){var M=J/a;g[J]=this.getTangentAt(M);g[J].normalize()}u[0]=new p;w[0]=new p;J=Number.MAX_VALUE;M=Math.abs(g[0].x);var R=Math.abs(g[0].y),O=Math.abs(g[0].z);M<=J&&(J=M,d.set(1,0,0));R<=J&&(J=R,d.set(0,1,0));O<=J&&d.set(0,
0,1);z.crossVectors(g[0],d).normalize();u[0].crossVectors(g[0],z);w[0].crossVectors(g[0],u[0]);for(J=1;J<=a;J++)u[J]=u[J-1].clone(),w[J]=w[J-1].clone(),z.crossVectors(g[J-1],g[J]),z.length()>Number.EPSILON&&(z.normalize(),d=Math.acos(Bb.clamp(g[J-1].dot(g[J]),-1,1)),u[J].applyMatrix4(F.makeRotationAxis(z,d))),w[J].crossVectors(g[J],u[J]);if(!0===c)for(d=Math.acos(Bb.clamp(u[0].dot(u[a]),-1,1)),d/=a,0<g[0].dot(z.crossVectors(u[0],u[a]))&&(d=-d),J=1;J<=a;J++)u[J].applyMatrix4(F.makeRotationAxis(g[J],
d*J)),w[J].crossVectors(g[J],u[J]);return{tangents:g,normals:u,binormals:w}}};oc.create=function(a,c){a.prototype=Object.create(oc.prototype);a.prototype.constructor=a;a.prototype.getPoint=c;return a};Vc.prototype=Object.create(oc.prototype);Vc.prototype.constructor=Vc;Vc.prototype.isLineCurve=!0;Vc.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var c=this.v2.clone().sub(this.v1);c.multiplyScalar(a).add(this.v1);return c};Vc.prototype.getPointAt=function(a){return this.getPoint(a)};
Vc.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};Ve.prototype=Object.assign(Object.create(oc.prototype),{constructor:Ve,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);a.equals(c)||this.curves.push(new Vc(c,a))},getPoint:function(a){var c=a*this.getLength(),d=this.getCurveLengths();for(a=0;a<d.length;){if(d[a]>=c)return c=d[a]-c,a=this.curves[a],d=a.getLength(),a.getPointAt(0===
d?0:1-c/d);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],c=0,d=0,g=this.curves.length;d<g;d++)c+=this.curves[d].getLength(),a.push(c);return this.cacheLengths=a},getSpacedPoints:function(a){a||(a=40);for(var c=[],d=0;d<=a;d++)c.push(this.getPoint(d/
a));this.autoClose&&c.push(c[0]);return c},getPoints:function(a){a=a||12;for(var c=[],d,g=0,u=this.curves;g<u.length;g++){var w=u[g];w=w.getPoints(w&&w.isEllipseCurve?2*a:w&&w.isLineCurve?1:w&&w.isSplineCurve?a*w.points.length:a);for(var z=0;z<w.length;z++){var F=w[z];d&&d.equals(F)||(c.push(F),d=F)}}this.autoClose&&1<c.length&&!c[c.length-1].equals(c[0])&&c.push(c[0]);return c},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=
this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){for(var c=new tb,d=0,g=a.length;d<g;d++){var u=a[d];c.vertices.push(new p(u.x,u.y,u.z||0))}return c}});bd.prototype=Object.create(oc.prototype);bd.prototype.constructor=bd;bd.prototype.isEllipseCurve=!0;bd.prototype.getPoint=function(a){for(var c=2*Math.PI,d=this.aEndAngle-this.aStartAngle,g=Math.abs(d)<Number.EPSILON;0>d;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=g?0:c);!0!==this.aClockwise||g||(d=d===c?-c:d-c);c=this.aStartAngle+
a*d;a=this.aX+this.xRadius*Math.cos(c);var u=this.aY+this.yRadius*Math.sin(c);0!==this.aRotation&&(c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),g=a-this.aX,u-=this.aY,a=g*c-u*d+this.aX,u=g*d+u*c+this.aY);return new l(a,u)};var cf={tangentQuadraticBezier:function(a,c,d,g){return 2*(1-a)*(d-c)+2*a*(g-d)},tangentCubicBezier:function(a,c,d,g,u){return-3*c*(1-a)*(1-a)+3*d*(1-a)*(1-a)-6*a*d*(1-a)+6*a*g*(1-a)-3*a*a*g+3*a*a*u},tangentSpline:function(a,c,d,g,u){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*
a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,c,d,g,u){a=.5*(d-a);g=.5*(g-c);var w=u*u;return(2*c-2*d+a+g)*u*w+(-3*c+3*d-2*a-g)*w+a*u+c}};Ad.prototype=Object.create(oc.prototype);Ad.prototype.constructor=Ad;Ad.prototype.isSplineCurve=!0;Ad.prototype.getPoint=function(a){var c=this.points;a*=c.length-1;var d=Math.floor(a);a-=d;var g=c[0===d?d:d-1],u=c[d],w=c[d>c.length-2?c.length-1:d+1];c=c[d>c.length-3?c.length-1:d+2];d=cf.interpolate;return new l(d(g.x,u.x,w.x,c.x,a),d(g.y,u.y,w.y,c.y,a))};Bd.prototype=
Object.create(oc.prototype);Bd.prototype.constructor=Bd;Bd.prototype.getPoint=function(a){var c=kc.b3;return new l(c(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};Bd.prototype.getTangent=function(a){var c=cf.tangentCubicBezier;return(new l(c(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};Cd.prototype=Object.create(oc.prototype);Cd.prototype.constructor=Cd;Cd.prototype.getPoint=function(a){var c=kc.b2;
return new l(c(a,this.v0.x,this.v1.x,this.v2.x),c(a,this.v0.y,this.v1.y,this.v2.y))};Cd.prototype.getTangent=function(a){var c=cf.tangentQuadraticBezier;return(new l(c(a,this.v0.x,this.v1.x,this.v2.x),c(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};var mg=Object.assign(Object.create(Ve.prototype),{fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var c=1,d=a.length;c<d;c++)this.lineTo(a[c].x,a[c].y)},moveTo:function(a,c){this.currentPoint.set(a,c)},lineTo:function(a,c){var d=new Vc(this.currentPoint.clone(),
new l(a,c));this.curves.push(d);this.currentPoint.set(a,c)},quadraticCurveTo:function(a,c,d,g){a=new Cd(this.currentPoint.clone(),new l(a,c),new l(d,g));this.curves.push(a);this.currentPoint.set(d,g)},bezierCurveTo:function(a,c,d,g,u,w){a=new Bd(this.currentPoint.clone(),new l(a,c),new l(d,g),new l(u,w));this.curves.push(a);this.currentPoint.set(u,w)},splineThru:function(a){var c=[this.currentPoint.clone()].concat(a);c=new Ad(c);this.curves.push(c);this.currentPoint.copy(a[a.length-1])},arc:function(a,
c,d,g,u,w){this.absarc(a+this.currentPoint.x,c+this.currentPoint.y,d,g,u,w)},absarc:function(a,c,d,g,u,w){this.absellipse(a,c,d,d,g,u,w)},ellipse:function(a,c,d,g,u,w,z,F){this.absellipse(a+this.currentPoint.x,c+this.currentPoint.y,d,g,u,w,z,F)},absellipse:function(a,c,d,g,u,w,z,F){a=new bd(a,c,d,g,u,w,z,F);0<this.curves.length&&(c=a.getPoint(0),c.equals(this.currentPoint)||this.lineTo(c.x,c.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});Dd.prototype=Object.assign(Object.create(mg),
{constructor:Dd,getPointsHoles:function(a){for(var c=[],d=0,g=this.holes.length;d<g;d++)c[d]=this.holes[d].getPoints(a);return c},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});We.prototype=mg;mg.constructor=We;Vf.prototype={moveTo:function(a,c){this.currentPath=new We;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,c)},lineTo:function(a,c){this.currentPath.lineTo(a,c)},quadraticCurveTo:function(a,
c,d,g){this.currentPath.quadraticCurveTo(a,c,d,g)},bezierCurveTo:function(a,c,d,g,u,w){this.currentPath.bezierCurveTo(a,c,d,g,u,w)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,c){function d(na){for(var ra=[],aa=0,qa=na.length;aa<qa;aa++){var oa=na[aa],wa=new Dd;wa.curves=oa.curves;ra.push(wa)}return ra}function g(na,ra){for(var aa=ra.length,qa=!1,oa=aa-1,wa=0;wa<aa;oa=wa++){var ta=ra[oa],za=ra[wa],Ja=za.x-ta.x,Ia=za.y-ta.y;if(Math.abs(Ia)>Number.EPSILON){if(0>Ia&&(ta=
ra[wa],Ja=-Ja,za=ra[oa],Ia=-Ia),!(na.y<ta.y||na.y>za.y))if(na.y===ta.y){if(na.x===ta.x)return!0}else{oa=Ia*(na.x-ta.x)-Ja*(na.y-ta.y);if(0===oa)return!0;0>oa||(qa=!qa)}}else if(na.y===ta.y&&(za.x<=na.x&&na.x<=ta.x||ta.x<=na.x&&na.x<=za.x))return!0}return qa}var u=kc.isClockWise,w=this.subPaths;if(0===w.length)return[];if(!0===c)return d(w);c=[];if(1===w.length){var z=w[0];var F=new Dd;F.curves=z.curves;c.push(F);return c}var J=!u(w[0].getPoints());J=a?!J:J;F=[];var M=[],R=[],O=0;M[O]=void 0;R[O]=
[];for(var Q=0,W=w.length;Q<W;Q++){z=w[Q];var ca=z.getPoints();var ea=u(ca);(ea=a?!ea:ea)?(!J&&M[O]&&O++,M[O]={s:new Dd,p:ca},M[O].s.curves=z.curves,J&&O++,R[O]=[]):R[O].push({h:z,p:ca[0]})}if(!M[0])return d(w);if(1<M.length){Q=!1;a=[];u=0;for(w=M.length;u<w;u++)F[u]=[];u=0;for(w=M.length;u<w;u++)for(z=R[u],ea=0;ea<z.length;ea++){J=z[ea];O=!0;for(ca=0;ca<M.length;ca++)g(J.p,M[ca].p)&&(u!==ca&&a.push({froms:u,tos:ca,hole:ea}),O?(O=!1,F[ca].push(J)):Q=!0);O&&F[u].push(J)}0<a.length&&(Q||(R=F))}Q=0;
for(u=M.length;Q<u;Q++)for(F=M[Q].s,c.push(F),a=R[Q],w=0,z=a.length;w<z;w++)F.holes.push(a[w].h);return c}};Object.assign(Wf.prototype,{isFont:!0,generateShapes:function(a,c,d){void 0===c&&(c=100);void 0===d&&(d=4);var g=this.data;a=String(a).split("");var u=c/g.resolution,w=0;c=[];for(var z=0;z<a.length;z++){var F;var J=u;var M=w,R=g.glyphs[a[z]]||g.glyphs["?"];if(R){var O=new Vf,Q=[],W=kc.b2,ca=kc.b3;if(R.o)for(var ea=R._cachedOutline||(R._cachedOutline=R.o.split(" ")),na=0,ra=ea.length;na<ra;)switch(ea[na++]){case "m":var aa=
ea[na++]*J+M;var qa=ea[na++]*J;O.moveTo(aa,qa);break;case "l":aa=ea[na++]*J+M;qa=ea[na++]*J;O.lineTo(aa,qa);break;case "q":var oa=ea[na++]*J+M;var wa=ea[na++]*J;var ta=ea[na++]*J+M;var za=ea[na++]*J;O.quadraticCurveTo(ta,za,oa,wa);if(F=Q[Q.length-1]){var Ja=F.x;F=F.y;for(var Ia=1;Ia<=d;Ia++){var Oa=Ia/d;W(Oa,Ja,ta,oa);W(Oa,F,za,wa)}}break;case "b":if(oa=ea[na++]*J+M,wa=ea[na++]*J,ta=ea[na++]*J+M,za=ea[na++]*J,aa=ea[na++]*J+M,qa=ea[na++]*J,O.bezierCurveTo(ta,za,aa,qa,oa,wa),F=Q[Q.length-1])for(Ja=
F.x,F=F.y,Ia=1;Ia<=d;Ia++)Oa=Ia/d,ca(Oa,Ja,ta,aa,oa),ca(Oa,F,za,qa,wa)}J={offset:R.ha*J,path:O}}else J=void 0;w+=J.offset;c.push(J.path)}d=[];g=0;for(a=c.length;g<a;g++)Array.prototype.push.apply(d,c[g].toShapes());return d}});Object.assign(vg.prototype,{load:function(a,c,d,g){var u=this;(new Jc(this.manager)).load(a,function(w){try{var z=JSON.parse(w)}catch(F){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),z=JSON.parse(w.substring(65,w.length-
2))}w=u.parse(z);c&&c(w)},d,g)},parse:function(a){return new Wf(a)}});var Jf,$f={getContext:function(){void 0===Jf&&(Jf=new (window.AudioContext||window.webkitAudioContext));return Jf},setContext:function(a){Jf=a}};Object.assign(Xf.prototype,{load:function(a,c,d,g){var u=new Jc(this.manager);u.setResponseType("arraybuffer");u.load(a,function(w){$f.getContext().decodeAudioData(w,function(z){c(z)})},d,g)}});Yf.prototype=Object.assign(Object.create(ec.prototype),{constructor:Yf,isRectAreaLight:!0,copy:function(a){ec.prototype.copy.call(this,
a);this.width=a.width;this.height=a.height;return this}});Object.assign(wg.prototype,{update:function(){var a,c,d,g,u,w,z,F=new y,J=new y;return function(M){if(a!==this||c!==M.focus||d!==M.fov||g!==M.aspect*this.aspect||u!==M.near||w!==M.far||z!==M.zoom){a=this;c=M.focus;d=M.fov;g=M.aspect*this.aspect;u=M.near;w=M.far;z=M.zoom;var R=M.projectionMatrix.clone(),O=this.eyeSep/2,Q=O*u/c,W=u*Math.tan(Bb.DEG2RAD*d*.5)/z;J.elements[12]=-O;F.elements[12]=O;O=-W*g+Q;var ca=W*g+Q;R.elements[0]=2*u/(ca-O);R.elements[8]=
(ca+O)/(ca-O);this.cameraL.projectionMatrix.copy(R);O=-W*g-Q;ca=W*g-Q;R.elements[0]=2*u/(ca-O);R.elements[8]=(ca+O)/(ca-O);this.cameraR.projectionMatrix.copy(R)}this.cameraL.matrixWorld.copy(M.matrixWorld).multiply(J);this.cameraR.matrixWorld.copy(M.matrixWorld).multiply(F)}}()});Df.prototype=Object.create(jb.prototype);Df.prototype.constructor=Df;Zf.prototype=Object.assign(Object.create(jb.prototype),{constructor:Zf,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&
(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},
setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new p,c=new t,d=new p,g=new p;return function(u){jb.prototype.updateMatrixWorld.call(this,u);u=this.context.listener;var w=this.up;this.matrixWorld.decompose(a,c,d);g.set(0,0,-1).applyQuaternion(c);u.positionX?(u.positionX.setValueAtTime(a.x,this.context.currentTime),u.positionY.setValueAtTime(a.y,this.context.currentTime),u.positionZ.setValueAtTime(a.z,this.context.currentTime),u.forwardX.setValueAtTime(g.x,this.context.currentTime),
u.forwardY.setValueAtTime(g.y,this.context.currentTime),u.forwardZ.setValueAtTime(g.z,this.context.currentTime),u.upX.setValueAtTime(w.x,this.context.currentTime),u.upY.setValueAtTime(w.y,this.context.currentTime),u.upZ.setValueAtTime(w.z,this.context.currentTime)):(u.setPosition(a.x,a.y,a.z),u.setOrientation(g.x,g.y,g.z,w.x,w.y,w.z))}}()});he.prototype=Object.assign(Object.create(jb.prototype),{constructor:he,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=
!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.buffer;a.loop=this.loop;a.onended=this.onEnded.bind(this);a.playbackRate.setValueAtTime(this.playbackRate,
this.startTime);a.start(0,this.startTime);this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<
this.filters.length){this.source.connect(this.filters[0]);for(var a=1,c=this.filters.length;a<c;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,c=this.filters.length;a<c;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());
return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,
this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=a,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},
setVolume:function(a){this.gain.gain.value=a;return this}});ag.prototype=Object.assign(Object.create(he.prototype),{constructor:ag,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=
a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new p;return function(c){jb.prototype.updateMatrixWorld.call(this,c);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(bg.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,c=this.getFrequencyData(),d=0;d<c.length;d++)a+=
c[d];return a/c.length}});Ef.prototype={constructor:Ef,accumulate:function(a,c){var d=this.buffer,g=this.valueSize;a=a*g+g;var u=this.cumulativeWeight;if(0===u){for(u=0;u!==g;++u)d[a+u]=d[u];u=c}else u+=c,this._mixBufferRegion(d,a,0,c/u,g);this.cumulativeWeight=u},apply:function(a){var c=this.valueSize,d=this.buffer;a=a*c+c;var g=this.cumulativeWeight,u=this.binding;this.cumulativeWeight=0;1>g&&this._mixBufferRegion(d,a,3*c,1-g,c);g=c;for(var w=c+c;g!==w;++g)if(d[g]!==d[g+c]){u.setValue(d,a);break}},
saveOriginalState:function(){var a=this.buffer,c=this.valueSize,d=3*c;this.binding.getValue(a,d);for(var g=c;g!==d;++g)a[g]=a[d+g%c];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,c,d,g,u){if(.5<=g)for(g=0;g!==u;++g)a[c+g]=a[d+g]},_slerp:function(a,c,d,g,u){t.slerpFlat(a,c,a,c,a,d,g)},_lerp:function(a,c,d,g,u){for(var w=1-g,z=0;z!==u;++z){var F=c+z;a[F]=a[F]*w+a[d+z]*g}}};ac.prototype={constructor:ac,getValue:function(a,
c){this.bind();this.getValue(a,c)},setValue:function(a,c){this.bind();this.setValue(a,c)},bind:function(){var a=this.node,c=this.parsedPath,d=c.objectName,g=c.propertyName,u=c.propertyIndex;a||(this.node=a=ac.findNode(this.rootNode,c.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(d){var w=c.objectIndex;switch(d){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",
this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(d=0;d<a.length;d++)if(a[d].name===w){w=d;break}break;default:if(void 0===a[d]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[d]}if(void 0!==w){if(void 0===a[w]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[w]}}w=a[g];if(void 0===w)console.error("  trying to update property for track: "+
c.nodeName+"."+g+" but it wasn't found.",a);else{c=this.Versioning.None;void 0!==a.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);d=this.BindingType.Direct;if(void 0!==u){if("morphTargetInfluences"===g){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",
this);return}for(d=0;d<this.node.geometry.morphTargets.length;d++)if(a.geometry.morphTargets[d].name===u){u=d;break}}d=this.BindingType.ArrayElement;this.resolvedProperty=w;this.propertyIndex=u}else void 0!==w.fromArray&&void 0!==w.toArray?(d=this.BindingType.HasFromToArray,this.resolvedProperty=w):void 0!==w.length?(d=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=g;this.getValue=this.GetterByBindingType[d];this.setValue=this.SetterByBindingTypeAndVersioning[d][c]}}else console.error("  trying to update node for track: "+
this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(ac.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:ac.prototype.getValue,_setValue_unbound:ac.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,c){a[c]=this.node[this.propertyName]},
function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==u;++g)a[c++]=d[g]},function(a,c){a[c]=this.resolvedProperty[this.propertyIndex]},function(a,c){this.resolvedProperty.toArray(a,c)}],SetterByBindingTypeAndVersioning:[[function(a,c){this.node[this.propertyName]=a[c]},function(a,c){this.node[this.propertyName]=a[c];this.targetObject.needsUpdate=!0},function(a,c){this.node[this.propertyName]=a[c];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){for(var d=this.resolvedProperty,
g=0,u=d.length;g!==u;++g)d[g]=a[c++]},function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==u;++g)d[g]=a[c++];this.targetObject.needsUpdate=!0},function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==u;++g)d[g]=a[c++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){this.resolvedProperty[this.propertyIndex]=a[c]},function(a,c){this.resolvedProperty[this.propertyIndex]=a[c];this.targetObject.needsUpdate=!0},function(a,c){this.resolvedProperty[this.propertyIndex]=a[c];
this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){this.resolvedProperty.fromArray(a,c)},function(a,c){this.resolvedProperty.fromArray(a,c);this.targetObject.needsUpdate=!0},function(a,c){this.resolvedProperty.fromArray(a,c);this.targetObject.matrixWorldNeedsUpdate=!0}]]});ac.Composite=function(a,c,d){d=d||ac.parseTrackName(c);this._targetGroup=a;this._bindings=a.subscribe_(c,d)};ac.Composite.prototype={constructor:ac.Composite,getValue:function(a,c){this.bind();var d=this._bindings[this._targetGroup.nCachedObjects_];
void 0!==d&&d.getValue(a,c)},setValue:function(a,c){for(var d=this._bindings,g=this._targetGroup.nCachedObjects_,u=d.length;g!==u;++g)d[g].setValue(a,c)},bind:function(){for(var a=this._bindings,c=this._targetGroup.nCachedObjects_,d=a.length;c!==d;++c)a[c].bind()},unbind:function(){for(var a=this._bindings,c=this._targetGroup.nCachedObjects_,d=a.length;c!==d;++c)a[c].unbind()}};ac.create=function(a,c,d){return a&&a.isAnimationObjectGroup?new ac.Composite(a,c,d):new ac(a,c,d)};ac.parseTrackName=function(a){var c=
/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(a);if(!c)throw Error("cannot parse trackName at all: "+a);c={nodeName:c[2],objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]};if(null===c.propertyName||0===c.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return c};ac.findNode=function(a,c){if(!c||""===c||"root"===c||"."===c||-1===c||c===a.name||c===a.uuid)return a;if(a.skeleton){var d=function(u){for(var w=
0;w<u.bones.length;w++){var z=u.bones[w];if(z.name===c)return z}return null}(a.skeleton);if(d)return d}if(a.children){var g=function(u){for(var w=0;w<u.length;w++){var z=u[w];if(z.name===c||z.uuid===c||(z=g(z.children)))return z}return null};if(a=g(a.children))return a}return null};cg.prototype={constructor:cg,isAnimationObjectGroup:!0,add:function(a){for(var c=this._objects,d=c.length,g=this.nCachedObjects_,u=this._indicesByUUID,w=this._paths,z=this._parsedPaths,F=this._bindings,J=F.length,M=0,R=
arguments.length;M!==R;++M){var O=arguments[M],Q=O.uuid,W=u[Q];if(void 0===W){W=d++;u[Q]=W;c.push(O);Q=0;for(var ca=J;Q!==ca;++Q)F[Q].push(new ac(O,w[Q],z[Q]))}else if(W<g){var ea=--g;ca=c[ea];u[ca.uuid]=W;c[W]=ca;u[Q]=ea;c[ea]=O;Q=0;for(ca=J;Q!==ca;++Q){var na=F[Q],ra=na[W];na[W]=na[ea];void 0===ra&&(ra=new ac(O,w[Q],z[Q]));na[ea]=ra}}else void 0!==c[W]&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=
g},remove:function(a){for(var c=this._objects,d=this.nCachedObjects_,g=this._indicesByUUID,u=this._bindings,w=u.length,z=0,F=arguments.length;z!==F;++z){var J=arguments[z],M=J.uuid,R=g[M];if(void 0!==R&&R>=d){var O=d++,Q=c[O];g[Q.uuid]=R;c[R]=Q;g[M]=O;c[O]=J;J=0;for(M=w;J!==M;++J){Q=u[J];var W=Q[R];Q[R]=Q[O];Q[O]=W}}}this.nCachedObjects_=d},uncache:function(a){for(var c=this._objects,d=c.length,g=this.nCachedObjects_,u=this._indicesByUUID,w=this._bindings,z=w.length,F=0,J=arguments.length;F!==J;++F){var M=
arguments[F].uuid,R=u[M];if(void 0!==R)if(delete u[M],R<g){M=--g;var O=c[M],Q=--d,W=c[Q];u[O.uuid]=R;c[R]=O;u[W.uuid]=M;c[M]=W;c.pop();O=0;for(W=z;O!==W;++O){var ca=w[O],ea=ca[Q];ca[R]=ca[M];ca[M]=ea;ca.pop()}}else for(Q=--d,W=c[Q],u[W.uuid]=R,c[R]=W,c.pop(),O=0,W=z;O!==W;++O)ca=w[O],ca[R]=ca[Q],ca.pop()}this.nCachedObjects_=g},subscribe_:function(a,c){var d=this._bindingsIndicesByPath,g=d[a],u=this._bindings;if(void 0!==g)return u[g];var w=this._paths,z=this._parsedPaths,F=this._objects,J=this.nCachedObjects_,
M=Array(F.length);g=u.length;d[a]=g;w.push(a);z.push(c);u.push(M);d=J;for(g=F.length;d!==g;++d)M[d]=new ac(F[d],a,c);return M},unsubscribe_:function(a){var c=this._bindingsIndicesByPath,d=c[a];if(void 0!==d){var g=this._paths,u=this._parsedPaths,w=this._bindings,z=w.length-1,F=w[z];c[a[z]]=d;w[d]=F;w.pop();u[d]=u[z];u.pop();g[d]=g[z];g.pop()}}};dg.prototype={constructor:dg,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},
reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,c){this.loop=a;this.repetitions=c;return this},setEffectiveWeight:function(a){this.weight=a;
this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,c,d){a.fadeOut(c);this.fadeIn(c);if(d){d=this._clip.duration;var g=a._clip.duration,u=d/g;a.warp(1,g/d,c);this.warp(u,1,c)}return this},crossFadeTo:function(a,c,d){return a.crossFadeFrom(this,c,d)},stopFading:function(){var a=this._weightInterpolant;
null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,
0,a)},warp:function(a,c,d){var g=this._mixer,u=g.time,w=this._timeScaleInterpolant,z=this.timeScale;null===w&&(this._timeScaleInterpolant=w=g._lendControlInterpolant());g=w.parameterPositions;w=w.sampleValues;g[0]=u;g[1]=u+d;w[0]=a/z;w[1]=c/z;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||
this._mixer._root},_update:function(a,c,d,g){var u=this._startTime;if(null!==u){c=(a-u)*d;if(0>c||0===d)return;this._startTime=null;c*=d}c*=this._updateTimeScale(a);d=this._updateTime(c);a=this._updateWeight(a);if(0<a){c=this._interpolants;u=this._propertyBindings;for(var w=0,z=c.length;w!==z;++w)c[w].evaluate(d),u[w].accumulate(g,a)}},_updateWeight:function(a){var c=0;if(this.enabled){c=this.weight;var d=this._weightInterpolant;if(null!==d){var g=d.evaluate(a)[0];c*=g;a>d.parameterPositions[1]&&
(this.stopFading(),0===g&&(this.enabled=!1))}}return this._effectiveWeight=c},_updateTimeScale:function(a){var c=0;if(!this.paused){c=this.timeScale;var d=this._timeScaleInterpolant;if(null!==d){var g=d.evaluate(a)[0];c*=g;a>d.parameterPositions[1]&&(this.stopWarping(),0===c?this.paused=!0:this.timeScale=c)}}return this._effectiveTimeScale=c},_updateTime:function(a){var c=this.time+a;if(0===a)return c;var d=this._clip.duration,g=this.loop,u=this._loopCount;if(2200===g)a:{if(-1===u&&(this._loopCount=
0,this._setEndings(!0,!0,!1)),c>=d)c=d;else if(0>c)c=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{g=2202===g;-1===u&&(0<=a?(u=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g));if(c>=d||0>c){var w=Math.floor(c/d);c-=d*w;u+=Math.abs(w);var z=this.repetitions-u;0>z?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,c=0<a?d:0,this._mixer.dispatchEvent({type:"finished",
action:this,direction:0<a?1:-1})):(0===z?(a=0>a,this._setEndings(a,!a,g)):this._setEndings(!1,!1,g),this._loopCount=u,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:w}))}if(g&&1===(u&1))return this.time=c,d-c}return this.time=c},_setEndings:function(a,c,d){var g=this._interpolantSettings;d?(g.endingStart=2401,g.endingEnd=2401):(g.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,g.endingEnd=c?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,c,d){var g=this._mixer,u=g.time,
w=this._weightInterpolant;null===w&&(this._weightInterpolant=w=g._lendControlInterpolant());g=w.parameterPositions;w=w.sampleValues;g[0]=u;w[0]=c;g[1]=u+a;w[1]=d;return this}};Xe.prototype={constructor:Xe,clipAction:function(a,c){var d=c||this._root,g=d.uuid;d="string"===typeof a?Dc.findByName(d,a):a;a=null!==d?d.uuid:a;var u=this._actionsByClip[a],w=null;if(void 0!==u){w=u.actionByRoot[g];if(void 0!==w)return w;w=u.knownActions[0];null===d&&(d=w._clip)}if(null===d)return null;c=new dg(this,d,c);
this._bindAction(c,w);this._addInactiveAction(c,a,g);return c},existingAction:function(a,c){var d=c||this._root;c=d.uuid;d="string"===typeof a?Dc.findByName(d,a):a;a=this._actionsByClip[d?d.uuid:a];return void 0!==a?a.actionByRoot[c]||null:null},stopAllAction:function(){for(var a=this._actions,c=this._nActiveActions,d=this._bindings,g=this._nActiveBindings,u=this._nActiveBindings=this._nActiveActions=0;u!==c;++u)a[u].reset();for(u=0;u!==g;++u)d[u].useCount=0;return this},update:function(a){a*=this.timeScale;
for(var c=this._actions,d=this._nActiveActions,g=this.time+=a,u=Math.sign(a),w=this._accuIndex^=1,z=0;z!==d;++z){var F=c[z];F.enabled&&F._update(g,a,u,w)}a=this._bindings;c=this._nActiveBindings;for(z=0;z!==c;++z)a[z].apply(w);return this},getRoot:function(){return this._root},uncacheClip:function(a){var c=this._actions;a=a.uuid;var d=this._actionsByClip,g=d[a];if(void 0!==g){g=g.knownActions;for(var u=0,w=g.length;u!==w;++u){var z=g[u];this._deactivateAction(z);var F=z._cacheIndex,J=c[c.length-1];
z._cacheIndex=null;z._byClipCacheIndex=null;J._cacheIndex=F;c[F]=J;c.pop();this._removeInactiveBindingsForAction(z)}delete d[a]}},uncacheRoot:function(a){a=a.uuid;var c=this._actionsByClip;for(g in c){var d=c[g].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}var g=this._bindingsByRootAndName[a];if(void 0!==g)for(var u in g)a=g[u],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,c){a=this.existingAction(a,c);null!==a&&(this._deactivateAction(a),
this._removeInactiveAction(a))}};Object.assign(Xe.prototype,{_bindAction:function(a,c){var d=a._localRoot||this._root,g=a._clip.tracks,u=g.length,w=a._propertyBindings;a=a._interpolants;var z=d.uuid,F=this._bindingsByRootAndName,J=F[z];void 0===J&&(J={},F[z]=J);for(F=0;F!==u;++F){var M=g[F],R=M.name,O=J[R];if(void 0===O){O=w[F];if(void 0!==O){null===O._cacheIndex&&(++O.referenceCount,this._addInactiveBinding(O,z,R));continue}O=new Ef(ac.create(d,R,c&&c._propertyBindings[F].binding.parsedPath),M.ValueTypeName,
M.getValueSize());++O.referenceCount;this._addInactiveBinding(O,z,R)}w[F]=O;a[F].resultBuffer=O.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var c=(a._localRoot||this._root).uuid,d=a._clip.uuid,g=this._actionsByClip[d];this._bindAction(a,g&&g.knownActions[0]);this._addInactiveAction(a,d,c)}c=a._propertyBindings;d=0;for(g=c.length;d!==g;++d){var u=c[d];0===u.useCount++&&(this._lendBinding(u),u.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var c=
a._propertyBindings,d=0,g=c.length;d!==g;++d){var u=c[d];0===--u.useCount&&(u.restoreOriginalState(),this._takeBackBinding(u))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},
get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,c,d){var g=this._actions,u=this._actionsByClip,w=u[c];void 0===w?(w={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,u[c]=w):(c=w.knownActions,a._byClipCacheIndex=c.length,c.push(a));a._cacheIndex=g.length;g.push(a);
w.actionByRoot[d]=a},_removeInactiveAction:function(a){var c=this._actions,d=c[c.length-1],g=a._cacheIndex;d._cacheIndex=g;c[g]=d;c.pop();a._cacheIndex=null;d=a._clip.uuid;g=this._actionsByClip;var u=g[d],w=u.knownActions,z=w[w.length-1],F=a._byClipCacheIndex;z._byClipCacheIndex=F;w[F]=z;w.pop();a._byClipCacheIndex=null;delete u.actionByRoot[(c._localRoot||this._root).uuid];0===w.length&&delete g[d];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;
for(var c=0,d=a.length;c!==d;++c){var g=a[c];0===--g.referenceCount&&this._removeInactiveBinding(g)}},_lendAction:function(a){var c=this._actions,d=a._cacheIndex,g=this._nActiveActions++,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_takeBackAction:function(a){var c=this._actions,d=a._cacheIndex,g=--this._nActiveActions,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_addInactiveBinding:function(a,c,d){var g=this._bindingsByRootAndName,u=g[c],w=this._bindings;void 0===u&&(u={},g[c]=
u);u[d]=a;a._cacheIndex=w.length;w.push(a)},_removeInactiveBinding:function(a){var c=this._bindings,d=a.binding,g=d.rootNode.uuid;d=d.path;var u=this._bindingsByRootAndName,w=u[g],z=c[c.length-1];a=a._cacheIndex;z._cacheIndex=a;c[a]=z;c.pop();delete w[d];a:{for(var F in w)break a;delete u[g]}},_lendBinding:function(a){var c=this._bindings,d=a._cacheIndex,g=this._nActiveBindings++,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_takeBackBinding:function(a){var c=this._bindings,d=a._cacheIndex,
g=--this._nActiveBindings,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_lendControlInterpolant:function(){var a=this._controlInterpolants,c=this._nActiveControlInterpolants++,d=a[c];void 0===d&&(d=new Te(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),d.__cacheIndex=c,a[c]=d);return d},_takeBackControlInterpolant:function(a){var c=this._controlInterpolants,d=a.__cacheIndex,g=--this._nActiveControlInterpolants,u=c[g];a.__cacheIndex=g;c[g]=a;u.__cacheIndex=
d;c[d]=u},_controlInterpolantsResultBuffer:new Float32Array(1)});Object.assign(Xe.prototype,h.prototype);Ff.prototype.clone=function(){return new Ff(void 0===this.value.clone?this.value:this.value.clone())};Ed.prototype=Object.create(ob.prototype);Ed.prototype.constructor=Ed;Ed.prototype.isInstancedBufferGeometry=!0;Ed.prototype.addGroup=function(a,c,d){this.groups.push({start:a,count:c,materialIndex:d})};Ed.prototype.copy=function(a){var c=a.index;null!==c&&this.setIndex(c.clone());c=a.attributes;
for(var d in c)this.addAttribute(d,c[d].clone());a=a.groups;d=0;for(c=a.length;d<c;d++){var g=a[d];this.addGroup(g.start,g.count,g.materialIndex)}return this};eg.prototype={constructor:eg,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(a,c){this.data.array[a*this.data.stride+this.offset]=c;return this},setY:function(a,c){this.data.array[a*this.data.stride+this.offset+1]=c;return this},setZ:function(a,c){this.data.array[a*this.data.stride+
this.offset+2]=c;return this},setW:function(a,c){this.data.array[a*this.data.stride+this.offset+3]=c;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+
1]=d;return this},setXYZ:function(a,c,d,g){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;this.data.array[a+2]=g;return this},setXYZW:function(a,c,d,g,u){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;this.data.array[a+2]=g;this.data.array[a+3]=u;return this}};ie.prototype={constructor:ie,isInterleavedBuffer:!0,set needsUpdate(a){!0===a&&this.version++},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
this.count=void 0!==a?a.length/this.stride:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,c,d){a*=this.stride;d*=c.stride;for(var g=0,u=this.stride;g<u;g++)this.array[a+g]=c.array[d+g];return this},set:function(a,c){void 0===c&&(c=0);this.array.set(a,c);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(a){this.onUploadCallback=
a;return this}};je.prototype=Object.create(ie.prototype);je.prototype.constructor=je;je.prototype.isInstancedInterleavedBuffer=!0;je.prototype.copy=function(a){ie.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};ke.prototype=Object.create(bb.prototype);ke.prototype.constructor=ke;ke.prototype.isInstancedBufferAttribute=!0;ke.prototype.copy=function(a){bb.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};fg.prototype={constructor:fg,
linePrecision:1,set:function(a,c){this.ray.set(a,c)},setFromCamera:function(a,c){c&&c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(c).sub(this.ray.origin).normalize()):c&&c.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,c){var d=
[];gg(a,this,d,c);d.sort(xg);return d},intersectObjects:function(a,c){var d=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),d;for(var g=0,u=a.length;g<u;g++)gg(a[g],this,d,c);d.sort(xg);return d}};hg.prototype={constructor:hg,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},
getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var c=(performance||Date).now();a=(c-this.oldTime)/1E3;this.oldTime=c;this.elapsedTime+=a}return a}};ig.prototype={constructor:ig,set:function(a,c,d){this.radius=a;this.phi=c;this.theta=d;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));
return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(Bb.clamp(a.y/this.radius,-1,1)));return this}};jg.prototype={constructor:jg,set:function(a,c,d){this.radius=a;this.theta=c;this.y=d;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.theta=a.theta;this.y=a.y;return this},setFromVector3:function(a){this.radius=Math.sqrt(a.x*a.x+a.z*a.z);
this.theta=Math.atan2(a.x,a.z);this.y=a.y;return this}};lc.prototype=Object.create(Sb.prototype);lc.prototype.constructor=lc;lc.prototype.createAnimation=function(a,c,d,g){c={start:c,end:d,length:d-c+1,fps:g,duration:(d-c)/g,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=c;this.animationsList.push(c)};lc.prototype.autoCreateAnimations=function(a){for(var c=/([a-z]+)_?(\d+)/i,d,g={},u=this.geometry,w=0,z=u.morphTargets.length;w<
z;w++){var F=u.morphTargets[w].name.match(c);if(F&&1<F.length){var J=F[1];g[J]||(g[J]={start:Infinity,end:-Infinity});F=g[J];w<F.start&&(F.start=w);w>F.end&&(F.end=w);d||(d=J)}}for(J in g)F=g[J],this.createAnimation(J,F.start,F.end,a);this.firstAnimation=d};lc.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};lc.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};lc.prototype.setAnimationFPS=
function(a,c){if(a=this.animationsMap[a])a.fps=c,a.duration=(a.end-a.start)/a.fps};lc.prototype.setAnimationDuration=function(a,c){if(a=this.animationsMap[a])a.duration=c,a.fps=(a.end-a.start)/a.duration};lc.prototype.setAnimationWeight=function(a,c){if(a=this.animationsMap[a])a.weight=c};lc.prototype.setAnimationTime=function(a,c){if(a=this.animationsMap[a])a.time=c};lc.prototype.getAnimationTime=function(a){var c=0;if(a=this.animationsMap[a])c=a.time;return c};lc.prototype.getAnimationDuration=
function(a){var c=-1;if(a=this.animationsMap[a])c=a.duration;return c};lc.prototype.playAnimation=function(a){var c=this.animationsMap[a];c?(c.time=0,c.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};lc.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};lc.prototype.update=function(a){for(var c=0,d=this.animationsList.length;c<d;c++){var g=this.animationsList[c];if(g.active){var u=g.duration/g.length;g.time+=g.direction*a;if(g.mirroredLoop){if(g.time>
g.duration||0>g.time)g.direction*=-1,g.time>g.duration&&(g.time=g.duration,g.directionBackwards=!0),0>g.time&&(g.time=0,g.directionBackwards=!1)}else g.time%=g.duration,0>g.time&&(g.time+=g.duration);var w=g.start+Bb.clamp(Math.floor(g.time/u),0,g.length-1),z=g.weight;w!==g.currentFrame&&(this.morphTargetInfluences[g.lastFrame]=0,this.morphTargetInfluences[g.currentFrame]=1*z,this.morphTargetInfluences[w]=0,g.lastFrame=g.currentFrame,g.currentFrame=w);u=g.time%u/u;g.directionBackwards&&(u=1-u);g.currentFrame!==
g.lastFrame?(this.morphTargetInfluences[g.currentFrame]=u*z,this.morphTargetInfluences[g.lastFrame]=(1-u)*z):this.morphTargetInfluences[g.currentFrame]=z}}};Ye.prototype=Object.create(jb.prototype);Ye.prototype.constructor=Ye;Ye.prototype.isImmediateRenderObject=!0;Ze.prototype=Object.create(Wb.prototype);Ze.prototype.constructor=Ze;Ze.prototype.update=function(){var a=new p,c=new p,d=new Pb;return function(){var g=["a","b","c"];this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);
var u=this.object.matrixWorld,w=this.geometry.attributes.position,z=this.object.geometry;if(z&&z.isGeometry)for(var F=z.vertices,J=z.faces,M=z=0,R=J.length;M<R;M++)for(var O=J[M],Q=0,W=O.vertexNormals.length;Q<W;Q++){var ca=O.vertexNormals[Q];a.copy(F[O[g[Q]]]).applyMatrix4(u);c.copy(ca).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);w.setXYZ(z,a.x,a.y,a.z);z+=1;w.setXYZ(z,c.x,c.y,c.z);z+=1}else if(z&&z.isBufferGeometry)for(g=z.attributes.position,F=z.attributes.normal,Q=z=0,W=g.count;Q<
W;Q++)a.set(g.getX(Q),g.getY(Q),g.getZ(Q)).applyMatrix4(u),c.set(F.getX(Q),F.getY(Q),F.getZ(Q)),c.applyMatrix3(d).normalize().multiplyScalar(this.size).add(a),w.setXYZ(z,a.x,a.y,a.z),z+=1,w.setXYZ(z,c.x,c.y,c.z),z+=1;w.needsUpdate=!0;return this}}();le.prototype=Object.create(jb.prototype);le.prototype.constructor=le;le.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};le.prototype.update=function(){var a=new p,c=new p;return function(){var d=this.light.distance?
this.light.distance:1E3,g=d*Math.tan(this.light.angle);this.cone.scale.set(g,g,d);a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(c.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();me.prototype=Object.create(Wb.prototype);me.prototype.constructor=me;me.prototype.getBoneList=function(a){var c=[];a&&a.isBone&&c.push(a);for(var d=0;d<a.children.length;d++)c.push.apply(c,this.getBoneList(a.children[d]));
return c};me.prototype.update=function(){var a=new p,c=new y,d=new y;return function(){var g=this.geometry,u=g.getAttribute("position");d.getInverse(this.root.matrixWorld);for(var w=0,z=0;w<this.bones.length;w++){var F=this.bones[w];F.parent&&F.parent.isBone&&(c.multiplyMatrices(d,F.matrixWorld),a.setFromMatrixPosition(c),u.setXYZ(z,a.x,a.y,a.z),c.multiplyMatrices(d,F.parent.matrixWorld),a.setFromMatrixPosition(c),u.setXYZ(z+1,a.x,a.y,a.z),z+=2)}g.getAttribute("position").needsUpdate=!0}}();ne.prototype=
Object.create(Sb.prototype);ne.prototype.constructor=ne;ne.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};ne.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};oe.prototype=Object.create(jb.prototype);oe.prototype.constructor=oe;oe.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose();this.children[1].geometry.dispose();this.children[1].material.dispose()};oe.prototype.update=
function(){var a=new p,c=new p;return function(){var d=this.children[0],g=this.children[1];if(this.light.target){a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);var u=c.clone().sub(a);d.lookAt(u);g.lookAt(u)}d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);g.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);g=.5*this.light.width;u=.5*this.light.height;d=d.geometry.getAttribute("position");var w=
d.array;w[0]=g;w[1]=-u;w[2]=0;w[3]=g;w[4]=u;w[5]=0;w[6]=-g;w[7]=u;w[8]=0;w[9]=-g;w[10]=u;w[11]=0;w[12]=-g;w[13]=-u;w[14]=0;w[15]=g;w[16]=-u;w[17]=0;d.needsUpdate=!0}}();pe.prototype=Object.create(jb.prototype);pe.prototype.constructor=pe;pe.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};pe.prototype.update=function(){var a=new p,c=new la,d=new la;return function(){var g=this.children[0],u=g.geometry.getAttribute("color");c.copy(this.light.color).multiplyScalar(this.light.intensity);
d.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var w=0,z=u.count;w<z;w++){var F=w<z/2?c:d;u.setXYZ(w,F.r,F.g,F.b)}g.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());u.needsUpdate=!0}}();$e.prototype=Object.create(Wb.prototype);$e.prototype.constructor=$e;Gf.prototype=Object.create(Wb.prototype);Gf.prototype.constructor=Gf;af.prototype=Object.create(Wb.prototype);af.prototype.constructor=af;af.prototype.update=function(){var a=new p,c=new p,d=new Pb;return function(){this.object.updateMatrixWorld(!0);
d.getNormalMatrix(this.object.matrixWorld);var g=this.object.matrixWorld,u=this.geometry.attributes.position,w=this.object.geometry,z=w.vertices;w=w.faces;for(var F=0,J=0,M=w.length;J<M;J++){var R=w[J],O=R.normal;a.copy(z[R.a]).add(z[R.b]).add(z[R.c]).divideScalar(3).applyMatrix4(g);c.copy(O).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);u.setXYZ(F,a.x,a.y,a.z);F+=1;u.setXYZ(F,c.x,c.y,c.z);F+=1}u.needsUpdate=!0;return this}}();qe.prototype=Object.create(jb.prototype);qe.prototype.constructor=
qe;qe.prototype.dispose=function(){var a=this.children[0],c=this.children[1];a.geometry.dispose();a.material.dispose();c.geometry.dispose();c.material.dispose()};qe.prototype.update=function(){var a=new p,c=new p,d=new p;return function(){a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);d.subVectors(c,a);var g=this.children[0],u=this.children[1];g.lookAt(d);g.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);u.lookAt(d);
u.scale.z=d.length()}}();bf.prototype=Object.create(Wb.prototype);bf.prototype.constructor=bf;bf.prototype.update=function(){function a(w,z,F,J){g.set(z,F,J).unproject(u);w=d[w];if(void 0!==w)for(z=c.getAttribute("position"),F=0,J=w.length;F<J;F++)z.setXYZ(w[F],g.x,g.y,g.z)}var c,d,g=new p,u=new Xb;return function(){c=this.geometry;d=this.pointMap;u.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",
-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);c.getAttribute("position").needsUpdate=!0}}();re.prototype=Object.create(Wb.prototype);re.prototype.constructor=re;re.prototype.update=function(){var a=new wb;return function(c){c&&c.isBox3?a.copy(c):a.setFromObject(c);if(!a.isEmpty()){c=a.min;var d=a.max,g=this.geometry.attributes.position,
u=g.array;u[0]=d.x;u[1]=d.y;u[2]=d.z;u[3]=c.x;u[4]=d.y;u[5]=d.z;u[6]=c.x;u[7]=c.y;u[8]=d.z;u[9]=d.x;u[10]=c.y;u[11]=d.z;u[12]=d.x;u[13]=d.y;u[14]=c.z;u[15]=c.x;u[16]=d.y;u[17]=c.z;u[18]=c.x;u[19]=c.y;u[20]=c.z;u[21]=d.x;u[22]=c.y;u[23]=c.z;g.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var yg=new ob;yg.addAttribute("position",new zb([0,0,0,0,1,0],3));var zg=new ad(0,.5,1,5,1);zg.translate(0,-.5,0);Fd.prototype=Object.create(jb.prototype);Fd.prototype.constructor=Fd;Fd.prototype.setDirection=
function(){var a=new p,c;return function(d){.99999<d.y?this.quaternion.set(0,0,0,1):-.99999>d.y?this.quaternion.set(1,0,0,0):(a.set(d.z,0,-d.x).normalize(),c=Math.acos(d.y),this.quaternion.setFromAxisAngle(a,c))}}();Fd.prototype.setLength=function(a,c,d){void 0===c&&(c=.2*a);void 0===d&&(d=.2*c);this.line.scale.set(1,Math.max(0,a-c),1);this.line.updateMatrix();this.cone.scale.set(d,c,d);this.cone.position.y=a;this.cone.updateMatrix()};Fd.prototype.setColor=function(a){this.line.material.color.copy(a);
this.cone.material.color.copy(a)};Hf.prototype=Object.create(Wb.prototype);Hf.prototype.constructor=Hf;var kg=function(){function a(){}var c=new p,d=new a,g=new a,u=new a;a.prototype.init=function(w,z,F,J){this.c0=w;this.c1=F;this.c2=-3*w+3*z-2*F-J;this.c3=2*w-2*z+F+J};a.prototype.initNonuniformCatmullRom=function(w,z,F,J,M,R,O){this.init(z,F,((z-w)/M-(F-w)/(M+R)+(F-z)/R)*R,((F-z)/R-(J-z)/(R+O)+(J-F)/O)*R)};a.prototype.initCatmullRom=function(w,z,F,J,M){this.init(z,F,M*(F-w),M*(J-z))};a.prototype.calc=
function(w){var z=w*w;return this.c0+this.c1*w+this.c2*z+this.c3*z*w};return oc.create(function(w){this.points=w||[];this.closed=!1},function(w){var z=this.points;var F=z.length;2>F&&console.log("duh, you need at least 2 points");w*=F-(this.closed?0:1);var J=Math.floor(w);w-=J;this.closed?J+=0<J?0:(Math.floor(Math.abs(J)/z.length)+1)*z.length:0===w&&J===F-1&&(J=F-2,w=1);if(this.closed||0<J)var M=z[(J-1)%F];else c.subVectors(z[0],z[1]).add(z[0]),M=c;var R=z[J%F];var O=z[(J+1)%F];this.closed||J+2<F?
z=z[(J+2)%F]:(c.subVectors(z[F-1],z[F-2]).add(z[F-1]),z=c);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var Q="chordal"===this.type?.5:.25;F=Math.pow(M.distanceToSquared(R),Q);J=Math.pow(R.distanceToSquared(O),Q);Q=Math.pow(O.distanceToSquared(z),Q);1E-4>J&&(J=1);1E-4>F&&(F=J);1E-4>Q&&(Q=J);d.initNonuniformCatmullRom(M.x,R.x,O.x,z.x,F,J,Q);g.initNonuniformCatmullRom(M.y,R.y,O.y,z.y,F,J,Q);u.initNonuniformCatmullRom(M.z,R.z,O.z,z.z,F,J,Q)}else"catmullrom"===this.type&&(F=
void 0!==this.tension?this.tension:.5,d.initCatmullRom(M.x,R.x,O.x,z.x,F),g.initCatmullRom(M.y,R.y,O.y,z.y,F),u.initCatmullRom(M.z,R.z,O.z,z.z,F));return new p(d.calc(w),g.calc(w),u.calc(w))})}(),Mg=oc.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0===a?[]:a},function(a){var c=this.points;a*=c.length-1;var d=Math.floor(a);a-=d;var g=c[0==d?d:d-1],u=c[d],w=c[d>c.length-2?c.length-1:d+1];c=c[d>c.length-3?c.length-1:d+2];
d=cf.interpolate;return new p(d(g.x,u.x,w.x,c.x,a),d(g.y,u.y,w.y,c.y,a),d(g.z,u.z,w.z,c.z,a))}),Ng=oc.create(function(a,c,d,g){this.v0=a;this.v1=c;this.v2=d;this.v3=g},function(a){var c=kc.b3;return new p(c(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),c(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),c(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),Og=oc.create(function(a,c,d){this.v0=a;this.v1=c;this.v2=d},function(a){var c=kc.b2;return new p(c(a,this.v0.x,this.v1.x,this.v2.x),c(a,this.v0.y,this.v1.y,this.v2.y),
c(a,this.v0.z,this.v1.z,this.v2.z))}),Pg=oc.create(function(a,c){this.v1=a;this.v2=c},function(a){if(1===a)return this.v2.clone();var c=new p;c.subVectors(this.v2,this.v1);c.multiplyScalar(a);c.add(this.v1);return c});If.prototype=Object.create(bd.prototype);If.prototype.constructor=If;Ag.prototype=Object.create(kg.prototype);$e.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Object.assign(Ba.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");
return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(wb.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");
return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");
return this.getSize(a)}});Xc.prototype.center=function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(a)};Bb.random16=function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()};Object.assign(Pb.prototype,{flattenToArrayOffset:function(a,c){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,c)},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");
return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToBuffer:function(a,c,d){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)},applyToVector3Array:function(a,c,d){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});
Object.assign(y.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},flattenToArrayOffset:function(a,c){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,c)},getPosition:function(){var a;return function(){void 0===a&&(a=new p);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");
return a.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(a,c,d){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");
return this.applyToBufferAttribute(a)},applyToVector3Array:function(a,c,d){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(a,c,d,g,u,w){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(a,c,g,d,u,w)}});Qb.prototype.isIntersectionLine=function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)};
t.prototype.multiplyVector3=function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)};Object.assign(sc.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},
isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(Dd.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Ic(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new $d(this,a)}});Object.assign(p.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},
setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,
c){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(c,a)}});tb.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")};Object.assign(jb.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},
translate:function(a,c){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(c,a)}});Object.defineProperties(jb.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(xe.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});ua.prototype.setLens=function(a,c){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==c&&(this.filmGauge=c);this.setFocalLength(a)};Object.defineProperties(ec.prototype,
{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");
this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},
shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(bb.prototype,
{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}}});Object.assign(ob.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,c,d){void 0!==d&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,
c)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(ob.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");
return this.groups}}});Object.defineProperties(Ff.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties($a.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+
": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new la}}});Object.defineProperties(Mc.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(kb.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});Object.assign(Mf.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");
return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},
supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");
return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},
addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(Mf.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");
this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties(cd.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(q.prototype,
{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");
return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");
return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},
set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});he.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var c=this;(new Xf).load(a,function(d){c.setBuffer(d)});return this};
bg.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};b.WebGLRenderTargetCube=k;b.WebGLRenderTarget=q;b.WebGLRenderer=Mf;b.ShaderLib=Gd;b.UniformsLib=Db;b.UniformsUtils=rc;b.ShaderChunk=Nb;b.FogExp2=Ld;b.Fog=Md;b.Scene=md;b.LensFlare=Pf;b.Sprite=we;b.LOD=xe;b.SkinnedMesh=lf;b.Skeleton=jf;b.Bone=kf;b.Mesh=Sb;b.LineSegments=Wb;b.Line=$c;b.Points=Nd;b.Group=ye;b.VideoTexture=mf;b.DataTexture=xa;b.CompressedTexture=
Od;b.CubeTexture=A;b.CanvasTexture=nf;b.DepthTexture=ze;b.Texture=e;b.CompressedTextureLoader=tg;b.BinaryTextureLoader=Rf;b.DataTextureLoader=Rf;b.CubeTextureLoader=Sf;b.TextureLoader=of;b.ObjectLoader=ug;b.MaterialLoader=Cf;b.BufferGeometryLoader=Tf;b.DefaultLoadingManager=Cc;b.LoadingManager=Qf;b.JSONLoader=Uf;b.ImageLoader=Se;b.FontLoader=vg;b.FileLoader=Jc;b.Loader=zd;b.Cache=lg;b.AudioLoader=Xf;b.SpotLightShadow=qf;b.SpotLight=rf;b.PointLight=sf;b.RectAreaLight=Yf;b.HemisphereLight=pf;b.DirectionalLightShadow=
tf;b.DirectionalLight=uf;b.AmbientLight=vf;b.LightShadow=wd;b.Light=ec;b.StereoCamera=wg;b.PerspectiveCamera=ua;b.OrthographicCamera=Da;b.CubeCamera=Df;b.Camera=Xb;b.AudioListener=Zf;b.PositionalAudio=ag;b.AudioContext=$f;b.AudioAnalyser=bg;b.Audio=he;b.VectorKeyframeTrack=fe;b.StringKeyframeTrack=zf;b.QuaternionKeyframeTrack=Ue;b.NumberKeyframeTrack=ge;b.ColorKeyframeTrack=Bf;b.BooleanKeyframeTrack=Af;b.PropertyMixer=Ef;b.PropertyBinding=ac;b.KeyframeTrack=yd;b.AnimationUtils=nc;b.AnimationObjectGroup=
cg;b.AnimationMixer=Xe;b.AnimationClip=Dc;b.Uniform=Ff;b.InstancedBufferGeometry=Ed;b.BufferGeometry=ob;b.GeometryIdCount=function(){return Lf++};b.Geometry=tb;b.InterleavedBufferAttribute=eg;b.InstancedInterleavedBuffer=je;b.InterleavedBuffer=ie;b.InstancedBufferAttribute=ke;b.Face3=cc;b.Object3D=jb;b.Raycaster=fg;b.Layers=Hd;b.EventDispatcher=h;b.Clock=hg;b.QuaternionLinearInterpolant=yf;b.LinearInterpolant=Te;b.DiscreteInterpolant=xf;b.CubicInterpolant=wf;b.Interpolant=vc;b.Triangle=bc;b.Spline=
function(a){function c(W,ca,ea,na,ra,aa,qa){W=.5*(ea-W);na=.5*(na-ca);return(2*(ca-ea)+W+na)*qa+(-3*(ca-ea)-2*W-na)*aa+W*ra+ca}this.points=a;var d=[],g={x:0,y:0,z:0},u,w,z,F,J,M,R,O,Q;this.initFromArray=function(W){this.points=[];for(var ca=0;ca<W.length;ca++)this.points[ca]={x:W[ca][0],y:W[ca][1],z:W[ca][2]}};this.getPoint=function(W){u=(this.points.length-1)*W;w=Math.floor(u);z=u-w;d[0]=0===w?w:w-1;d[1]=w;d[2]=w>this.points.length-2?this.points.length-1:w+1;d[3]=w>this.points.length-3?this.points.length-
1:w+2;M=this.points[d[0]];R=this.points[d[1]];O=this.points[d[2]];Q=this.points[d[3]];F=z*z;J=z*F;g.x=c(M.x,R.x,O.x,Q.x,z,F,J);g.y=c(M.y,R.y,O.y,Q.y,z,F,J);g.z=c(M.z,R.z,O.z,Q.z,z,F,J);return g};this.getControlPointsArray=function(){var W,ca=this.points.length,ea=[];for(W=0;W<ca;W++){var na=this.points[W];ea[W]=[na.x,na.y,na.z]}return ea};this.getLength=function(W){var ca=0,ea=new p,na=new p,ra=[],aa=0;ra[0]=0;W||(W=100);var qa=this.points.length*W;ea.copy(this.points[0]);for(W=1;W<qa;W++){var oa=
W/qa;var wa=this.getPoint(oa);na.copy(wa);aa+=na.distanceTo(ea);ea.copy(wa);oa*=this.points.length-1;oa=Math.floor(oa);oa!==ca&&(ra[oa]=aa,ca=oa)}ra[ra.length]=aa;return{chunks:ra,total:aa}};this.reparametrizeByArcLength=function(W){var ca,ea=[],na=new p,ra=this.getLength();ea.push(na.copy(this.points[0]).clone());for(ca=1;ca<this.points.length;ca++){var aa=ra.chunks[ca]-ra.chunks[ca-1];var qa=Math.ceil(W*aa/ra.total);var oa=(ca-1)/(this.points.length-1);var wa=ca/(this.points.length-1);for(aa=1;aa<
qa-1;aa++){var ta=oa+1/qa*aa*(wa-oa);ta=this.getPoint(ta);ea.push(na.copy(ta).clone())}ea.push(na.copy(this.points[ca]).clone())}this.points=ea}};b.Math=Bb;b.Spherical=ig;b.Cylindrical=jg;b.Plane=Qb;b.Frustum=Wc;b.Sphere=Mb;b.Ray=sc;b.Matrix4=y;b.Matrix3=Pb;b.Box3=wb;b.Box2=Ba;b.Line3=Xc;b.Euler=wc;b.Vector4=r;b.Vector3=p;b.Vector2=l;b.Quaternion=t;b.Color=la;b.MorphBlendMesh=lc;b.ImmediateRenderObject=Ye;b.VertexNormalsHelper=Ze;b.SpotLightHelper=le;b.SkeletonHelper=me;b.PointLightHelper=ne;b.RectAreaLightHelper=
oe;b.HemisphereLightHelper=pe;b.GridHelper=$e;b.PolarGridHelper=Gf;b.FaceNormalsHelper=af;b.DirectionalLightHelper=qe;b.CameraHelper=bf;b.BoxHelper=re;b.ArrowHelper=Fd;b.AxisHelper=Hf;b.CatmullRomCurve3=kg;b.SplineCurve3=Mg;b.CubicBezierCurve3=Ng;b.QuadraticBezierCurve3=Og;b.LineCurve3=Pg;b.ArcCurve=If;b.EllipseCurve=bd;b.SplineCurve=Ad;b.CubicBezierCurve=Bd;b.QuadraticBezierCurve=Cd;b.LineCurve=Vc;b.Shape=Dd;b.ShapePath=Vf;b.Path=We;b.Font=Wf;b.CurvePath=Ve;b.Curve=oc;b.ShapeUtils=kc;b.SceneUtils=
{createMultiMaterialObject:function(a,c){for(var d=new ye,g=0,u=c.length;g<u;g++)d.add(new Sb(a,c[g]));return d},detach:function(a,c,d){a.applyMatrix(c.matrixWorld);c.remove(a);d.add(a)},attach:function(a,c,d){var g=new y;g.getInverse(d.matrixWorld);a.applyMatrix(g);c.remove(a);d.add(a)}};b.CurveUtils=cf;b.WireframeGeometry=Pd;b.ParametricGeometry=Ae;b.ParametricBufferGeometry=Qd;b.TetrahedronGeometry=Be;b.TetrahedronBufferGeometry=Rd;b.OctahedronGeometry=Ce;b.OctahedronBufferGeometry=od;b.IcosahedronGeometry=
De;b.IcosahedronBufferGeometry=Sd;b.DodecahedronGeometry=Ee;b.DodecahedronBufferGeometry=Td;b.PolyhedronGeometry=Fe;b.PolyhedronBufferGeometry=uc;b.TubeGeometry=Ge;b.TubeBufferGeometry=Ud;b.TorusKnotGeometry=He;b.TorusKnotBufferGeometry=Vd;b.TorusGeometry=Ie;b.TorusBufferGeometry=Wd;b.TextGeometry=Je;b.SphereBufferGeometry=pd;b.SphereGeometry=Ke;b.RingGeometry=Le;b.RingBufferGeometry=Xd;b.PlaneBufferGeometry=pc;b.PlaneGeometry=Me;b.LatheGeometry=Ne;b.LatheBufferGeometry=Yd;b.ShapeGeometry=$d;b.ShapeBufferGeometry=
Zd;b.ExtrudeGeometry=Ic;b.EdgesGeometry=ae;b.ConeGeometry=Oe;b.ConeBufferGeometry=Pe;b.CylinderGeometry=qd;b.CylinderBufferGeometry=ad;b.CircleBufferGeometry=be;b.CircleGeometry=Qe;b.BoxBufferGeometry=Pc;b.BoxGeometry=ce;b.ShadowMaterial=de;b.SpriteMaterial=nd;b.RawShaderMaterial=ee;b.ShaderMaterial=kb;b.PointsMaterial=Lc;b.MultiMaterial=Re;b.MeshPhysicalMaterial=rd;b.MeshStandardMaterial=Uc;b.MeshPhongMaterial=Mc;b.MeshToonMaterial=sd;b.MeshNormalMaterial=td;b.MeshLambertMaterial=ud;b.MeshDepthMaterial=
Ib;b.MeshBasicMaterial=jc;b.LineDashedMaterial=vd;b.LineBasicMaterial=dc;b.Material=$a;b.Float64BufferAttribute=Zc;b.Float32BufferAttribute=zb;b.Uint32BufferAttribute=Fc;b.Int32BufferAttribute=Ec;b.Uint16BufferAttribute=tc;b.Int16BufferAttribute=dd;b.Uint8ClampedBufferAttribute=xc;b.Uint8BufferAttribute=Oc;b.Int8BufferAttribute=Yc;b.BufferAttribute=bb;b.REVISION="84dev";b.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};b.CullFaceNone=0;b.CullFaceBack=1;b.CullFaceFront=2;b.CullFaceFrontBack=3;b.FrontFaceDirectionCW=
0;b.FrontFaceDirectionCCW=1;b.BasicShadowMap=0;b.PCFShadowMap=1;b.PCFSoftShadowMap=2;b.FrontSide=0;b.BackSide=1;b.DoubleSide=2;b.FlatShading=1;b.SmoothShading=2;b.NoColors=0;b.FaceColors=1;b.VertexColors=2;b.NoBlending=0;b.NormalBlending=1;b.AdditiveBlending=2;b.SubtractiveBlending=3;b.MultiplyBlending=4;b.CustomBlending=5;b.AddEquation=100;b.SubtractEquation=101;b.ReverseSubtractEquation=102;b.MinEquation=103;b.MaxEquation=104;b.ZeroFactor=200;b.OneFactor=201;b.SrcColorFactor=202;b.OneMinusSrcColorFactor=
203;b.SrcAlphaFactor=204;b.OneMinusSrcAlphaFactor=205;b.DstAlphaFactor=206;b.OneMinusDstAlphaFactor=207;b.DstColorFactor=208;b.OneMinusDstColorFactor=209;b.SrcAlphaSaturateFactor=210;b.NeverDepth=0;b.AlwaysDepth=1;b.LessDepth=2;b.LessEqualDepth=3;b.EqualDepth=4;b.GreaterEqualDepth=5;b.GreaterDepth=6;b.NotEqualDepth=7;b.MultiplyOperation=0;b.MixOperation=1;b.AddOperation=2;b.NoToneMapping=0;b.LinearToneMapping=1;b.ReinhardToneMapping=2;b.Uncharted2ToneMapping=3;b.CineonToneMapping=4;b.UVMapping=300;
b.CubeReflectionMapping=301;b.CubeRefractionMapping=302;b.EquirectangularReflectionMapping=303;b.EquirectangularRefractionMapping=304;b.SphericalReflectionMapping=305;b.CubeUVReflectionMapping=306;b.CubeUVRefractionMapping=307;b.RepeatWrapping=1E3;b.ClampToEdgeWrapping=1001;b.MirroredRepeatWrapping=1002;b.NearestFilter=1003;b.NearestMipMapNearestFilter=1004;b.NearestMipMapLinearFilter=1005;b.LinearFilter=1006;b.LinearMipMapNearestFilter=1007;b.LinearMipMapLinearFilter=1008;b.UnsignedByteType=1009;
b.ByteType=1010;b.ShortType=1011;b.UnsignedShortType=1012;b.IntType=1013;b.UnsignedIntType=1014;b.FloatType=1015;b.HalfFloatType=1016;b.UnsignedShort4444Type=1017;b.UnsignedShort5551Type=1018;b.UnsignedShort565Type=1019;b.UnsignedInt248Type=1020;b.AlphaFormat=1021;b.RGBFormat=1022;b.RGBAFormat=1023;b.LuminanceFormat=1024;b.LuminanceAlphaFormat=1025;b.RGBEFormat=1023;b.DepthFormat=1026;b.DepthStencilFormat=1027;b.RGB_S3TC_DXT1_Format=2001;b.RGBA_S3TC_DXT1_Format=2002;b.RGBA_S3TC_DXT3_Format=2003;b.RGBA_S3TC_DXT5_Format=
2004;b.RGB_PVRTC_4BPPV1_Format=2100;b.RGB_PVRTC_2BPPV1_Format=2101;b.RGBA_PVRTC_4BPPV1_Format=2102;b.RGBA_PVRTC_2BPPV1_Format=2103;b.RGB_ETC1_Format=2151;b.LoopOnce=2200;b.LoopRepeat=2201;b.LoopPingPong=2202;b.InterpolateDiscrete=2300;b.InterpolateLinear=2301;b.InterpolateSmooth=2302;b.ZeroCurvatureEnding=2400;b.ZeroSlopeEnding=2401;b.WrapAroundEnding=2402;b.TrianglesDrawMode=0;b.TriangleStripDrawMode=1;b.TriangleFanDrawMode=2;b.LinearEncoding=3E3;b.sRGBEncoding=3001;b.GammaEncoding=3007;b.RGBEEncoding=
3002;b.LogLuvEncoding=3003;b.RGBM7Encoding=3004;b.RGBM16Encoding=3005;b.RGBDEncoding=3006;b.BasicDepthPacking=3200;b.RGBADepthPacking=3201;b.CubeGeometry=ce;b.Face4=function(a,c,d,g,u,w,z){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new cc(a,c,d,u,w,z)};b.LineStrip=0;b.LinePieces=1;b.MeshFaceMaterial=function(a){console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial.");return new Re(a)};b.PointCloud=function(a,c){console.warn("THREE.PointCloud has been renamed to THREE.Points.");
return new Nd(a,c)};b.Particle=function(a){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new we(a)};b.ParticleSystem=function(a,c){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Nd(a,c)};b.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Lc(a)};b.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");
return new Lc(a)};b.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Lc(a)};b.Vertex=function(a,c,d){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new p(a,c,d)};b.DynamicBufferAttribute=function(a,c){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new bb(a,c)).setDynamic(!0)};b.Int8Attribute=function(a,
c){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Yc(a,c)};b.Uint8Attribute=function(a,c){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Oc(a,c)};b.Uint8ClampedAttribute=function(a,c){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new xc(a,c)};b.Int16Attribute=function(a,c){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");
return new dd(a,c)};b.Uint16Attribute=function(a,c){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new tc(a,c)};b.Int32Attribute=function(a,c){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new Ec(a,c)};b.Uint32Attribute=function(a,c){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Fc(a,c)};b.Float32Attribute=
function(a,c){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new zb(a,c)};b.Float64Attribute=function(a,c){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Zc(a,c)};b.ClosedSplineCurve3=Ag;b.BoundingBoxHelper=function(a,c){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new re(a,c)};b.EdgesHelper=function(a,c){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");
return new Wb(new ae(a.geometry),new dc({color:void 0!==c?c:16777215}))};b.WireframeHelper=function(a,c){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new Wb(new Pd(a.geometry),new dc({color:void 0!==c?c:16777215}))};b.XHRLoader=function(a){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Jc(a)};b.GeometryUtils={merge:function(a,c,d){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
if(c.isMesh){c.matrixAutoUpdate&&c.updateMatrix();var g=c.matrix;c=c.geometry}a.merge(c,g,d)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};b.ImageUtils={crossOrigin:void 0,loadTexture:function(a,c,d,g){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var u=new of;u.setCrossOrigin(this.crossOrigin);a=u.load(a,d,void 0,g);c&&(a.mapping=c);return a},
loadTextureCube:function(a,c,d,g){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var u=new Sf;u.setCrossOrigin(this.crossOrigin);a=u.load(a,d,void 0,g);c&&(a.mapping=c);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
b.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};b.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");
this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(b,"__esModule",{value:!0})}));
THREE.VREffect=function(b,h){var l,e,r,q,k,t,p,y;function A(S){I=S;0<S.length?G=S[0]:h&&h("HMD not available")}function E(){var S=x.isPresenting;x.isPresenting=void 0!==G&&G.isPresenting;if(x.isPresenting){var U=G.getEyeParameters("left"),X=U.renderWidth;U=U.renderHeight;S||(m=b.getPixelRatio(),H=b.getSize(),b.setPixelRatio(1),b.setSize(2*X,U,!1))}else S&&(b.setPixelRatio(m),b.setSize(H.width,H.height,f))}function B(S,U,X,Z){var V=Math.PI/180;var ma=Math.tan(S.upDegrees*V);var ia=Math.tan(S.downDegrees*
V),ja=Math.tan(S.leftDegrees*V);S=Math.tan(S.rightDegrees*V);X=void 0===X?.01:X;Z=void 0===Z?1E4:Z;V=void 0===U||U?-1:1;var ba=new THREE.Matrix4,fa=ba.elements,ka=2/(ja+S),P=2/(ma+ia);U=[ka,P];ma=[(ja-S)*ka*.5,(ma-ia)*P*.5];fa[0]=U[0];fa[1]=0;fa[2]=ma[0]*V;fa[3]=0;fa[4]=0;fa[5]=U[1];fa[6]=-ma[1]*V;fa[7]=0;fa[8]=0;fa[9]=0;fa[10]=Z/(X-Z)*-V;fa[11]=Z*X/(X-Z);fa[12]=0;fa[13]=0;fa[14]=V;fa[15]=0;ba.transpose();return ba}var G,I,L=new THREE.Vector3,T=new THREE.Vector3,n=null;"VRFrameData"in window&&(n=
new window.VRFrameData);navigator.getVRDisplays&&navigator.getVRDisplays().then(A).catch(function(){console.warn("THREE.VREffect: Unable to get VR Displays")});this.isPresenting=!1;this.scale=1;var x=this,H=b.getSize(),f=!1,m=b.getPixelRatio();this.getVRDisplay=function(){return G};this.setVRDisplay=function(S){G=S};this.getVRDisplays=function(){console.warn("THREE.VREffect: getVRDisplays() is being deprecated.");return I};this.setSize=function(S,U,X){H={width:S,height:U};f=X;x.isPresenting?(S=G.getEyeParameters("left"),
b.setPixelRatio(1),b.setSize(2*S.renderWidth,S.renderHeight,!1)):(b.setPixelRatio(m),b.setSize(S,U,X))};var v=b.domElement,D=[0,0,.5,1],C=[.5,0,.5,1];window.addEventListener("vrdisplaypresentchange",E,!1);this.setFullScreen=function(S){return new Promise(function(U,X){void 0===G?X(Error("No VR hardware found.")):x.isPresenting===S?U():S?U(G.requestPresent([{source:v}])):U(G.exitPresent())})};this.requestPresent=function(){return this.setFullScreen(!0)};this.exitPresent=function(){return this.setFullScreen(!1)};
this.requestAnimationFrame=function(S){return void 0!==G?G.requestAnimationFrame(S):window.requestAnimationFrame(S)};this.cancelAnimationFrame=function(S){void 0!==G?G.cancelAnimationFrame(S):window.cancelAnimationFrame(S)};this.submitFrame=function(){void 0!==G&&x.isPresenting&&G.submitFrame()};this.autoSubmitFrame=!0;var K=new THREE.PerspectiveCamera;K.layers.enable(1);var N=new THREE.PerspectiveCamera;N.layers.enable(2);this.render=function(S,U,X,Z){if(G&&x.isPresenting){var V=S.autoUpdate;V&&
(S.updateMatrixWorld(),S.autoUpdate=!1);var ma=G.getEyeParameters("left"),ia=G.getEyeParameters("right");L.fromArray(ma.offset);T.fromArray(ia.offset);Array.isArray(S)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),S=S[0]);var ja=b.getSize(),ba=G.getLayers();if(ba.length){var fa=ba[0];ba=null!==fa.leftBounds&&4===fa.leftBounds.length?fa.leftBounds:D;fa=null!==fa.rightBounds&&4===fa.rightBounds.length?fa.rightBounds:C}else ba=D,fa=C;k=Math.round(ja.width*
ba[0]);t=Math.round(ja.height*ba[1]);p=Math.round(ja.width*ba[2]);y=Math.round(ja.height*ba[3]);l=Math.round(ja.width*fa[0]);e=Math.round(ja.height*fa[1]);r=Math.round(ja.width*fa[2]);q=Math.round(ja.height*fa[3]);X?(b.setRenderTarget(X),X.scissorTest=!0):(b.setRenderTarget(null),b.setScissorTest(!0));(b.autoClear||Z)&&b.clear();null===U.parent&&U.updateMatrixWorld();U.matrixWorld.decompose(K.position,K.quaternion,K.scale);U.matrixWorld.decompose(N.position,N.quaternion,N.scale);ba=this.scale;K.translateOnAxis(L,
ba);N.translateOnAxis(T,ba);G.getFrameData?(G.depthNear=U.near,G.depthFar=U.far,G.getFrameData(n),K.projectionMatrix.elements=n.leftProjectionMatrix,N.projectionMatrix.elements=n.rightProjectionMatrix):(K.projectionMatrix=B(ma.fieldOfView,!0,U.near,U.far),N.projectionMatrix=B(ia.fieldOfView,!0,U.near,U.far));X?(X.viewport.set(k,t,p,y),X.scissor.set(k,t,p,y)):(b.setViewport(k,t,p,y),b.setScissor(k,t,p,y));b.render(S,K,X,Z);X?(X.viewport.set(l,e,r,q),X.scissor.set(l,e,r,q)):(b.setViewport(l,e,r,q),
b.setScissor(l,e,r,q));b.render(S,N,X,Z);X?(X.viewport.set(0,0,ja.width,ja.height),X.scissor.set(0,0,ja.width,ja.height),X.scissorTest=!1,b.setRenderTarget(null)):(b.setViewport(0,0,ja.width,ja.height),b.setScissorTest(!1));V&&(S.autoUpdate=!0);x.autoSubmitFrame&&x.submitFrame()}else b.render(S,U,X,Z)};this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",E,!1)}};
!function(b){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=b();else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.CANNON=b()}}(function(){return function r(h,l,e){function q(p,y){if(!l[p]){if(!h[p]){var A="function"==typeof require&&require;if(!y&&A)return A(p,!0);if(k)return k(p,!0);throw Error("Cannot find module '"+p+"'");}y=l[p]={exports:{}};h[p][0].call(y.exports,function(E){var B=h[p][1][E];return q(B?
B:E)},y,y.exports,r,h,l,e)}return l[p].exports}for(var k="function"==typeof require&&require,t=0;t<e.length;t++)q(e[t]);return q}({1:[function(h,l){l.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(h,l){l.exports={version:h("../package.json").version,AABB:h("./collision/AABB"),ArrayCollisionMatrix:h("./collision/ArrayCollisionMatrix"),
Body:h("./objects/Body"),Box:h("./shapes/Box"),Broadphase:h("./collision/Broadphase"),Constraint:h("./constraints/Constraint"),ContactEquation:h("./equations/ContactEquation"),Narrowphase:h("./world/Narrowphase"),ConeTwistConstraint:h("./constraints/ConeTwistConstraint"),ContactMaterial:h("./material/ContactMaterial"),ConvexPolyhedron:h("./shapes/ConvexPolyhedron"),Cylinder:h("./shapes/Cylinder"),DistanceConstraint:h("./constraints/DistanceConstraint"),Equation:h("./equations/Equation"),EventTarget:h("./utils/EventTarget"),
FrictionEquation:h("./equations/FrictionEquation"),GSSolver:h("./solver/GSSolver"),GridBroadphase:h("./collision/GridBroadphase"),Heightfield:h("./shapes/Heightfield"),HingeConstraint:h("./constraints/HingeConstraint"),LockConstraint:h("./constraints/LockConstraint"),Mat3:h("./math/Mat3"),Material:h("./material/Material"),NaiveBroadphase:h("./collision/NaiveBroadphase"),ObjectCollisionMatrix:h("./collision/ObjectCollisionMatrix"),Pool:h("./utils/Pool"),Particle:h("./shapes/Particle"),Plane:h("./shapes/Plane"),
PointToPointConstraint:h("./constraints/PointToPointConstraint"),Quaternion:h("./math/Quaternion"),Ray:h("./collision/Ray"),RaycastVehicle:h("./objects/RaycastVehicle"),RaycastResult:h("./collision/RaycastResult"),RigidVehicle:h("./objects/RigidVehicle"),RotationalEquation:h("./equations/RotationalEquation"),RotationalMotorEquation:h("./equations/RotationalMotorEquation"),SAPBroadphase:h("./collision/SAPBroadphase"),SPHSystem:h("./objects/SPHSystem"),Shape:h("./shapes/Shape"),Solver:h("./solver/Solver"),
Sphere:h("./shapes/Sphere"),SplitSolver:h("./solver/SplitSolver"),Spring:h("./objects/Spring"),Trimesh:h("./shapes/Trimesh"),Vec3:h("./math/Vec3"),Vec3Pool:h("./utils/Vec3Pool"),World:h("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(h,l){function e(t){t=t||{};this.lowerBound=
new r;t.lowerBound&&this.lowerBound.copy(t.lowerBound);this.upperBound=new r;t.upperBound&&this.upperBound.copy(t.upperBound)}var r=h("../math/Vec3");h("../utils/Utils");l.exports=e;var q=new r;e.prototype.setFromPoints=function(t,p,y,A){var E=this.lowerBound,B=this.upperBound;E.copy(t[0]);y&&y.vmult(E,E);B.copy(E);for(var G=1;G<t.length;G++){var I=t[G];y&&(y.vmult(I,q),I=q);I.x>B.x&&(B.x=I.x);I.x<E.x&&(E.x=I.x);I.y>B.y&&(B.y=I.y);I.y<E.y&&(E.y=I.y);I.z>B.z&&(B.z=I.z);I.z<E.z&&(E.z=I.z)}return p&&
(p.vadd(E,E),p.vadd(B,B)),A&&(E.x-=A,E.y-=A,E.z-=A,B.x+=A,B.y+=A,B.z+=A),this};e.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this};e.prototype.clone=function(){return(new e).copy(this)};e.prototype.extend=function(t){var p=t.lowerBound.x;this.lowerBound.x>p&&(this.lowerBound.x=p);p=t.upperBound.x;this.upperBound.x<p&&(this.upperBound.x=p);p=t.lowerBound.y;this.lowerBound.y>p&&(this.lowerBound.y=p);p=t.upperBound.y;this.upperBound.y<p&&(this.upperBound.y=
p);p=t.lowerBound.z;this.lowerBound.z>p&&(this.lowerBound.z=p);p=t.upperBound.z;this.upperBound.z<p&&(this.upperBound.z=p)};e.prototype.overlaps=function(t){var p=this.lowerBound,y=this.upperBound,A=t.lowerBound;t=t.upperBound;return(A.x<=y.x&&y.x<=t.x||p.x<=t.x&&t.x<=y.x)&&(A.y<=y.y&&y.y<=t.y||p.y<=t.y&&t.y<=y.y)&&(A.z<=y.z&&y.z<=t.z||p.z<=t.z&&t.z<=y.z)};e.prototype.contains=function(t){var p=this.lowerBound,y=this.upperBound,A=t.lowerBound;t=t.upperBound;return p.x<=A.x&&y.x>=t.x&&p.y<=A.y&&y.y>=
t.y&&p.z<=A.z&&y.z>=t.z};e.prototype.getCorners=function(t,p,y,A,E,B,G,I){var L=this.lowerBound,T=this.upperBound;t.copy(L);p.set(T.x,L.y,L.z);y.set(T.x,T.y,L.z);A.set(L.x,T.y,T.z);E.set(T.x,L.y,L.z);B.set(L.x,T.y,L.z);G.set(L.x,L.y,T.z);I.copy(T)};var k=[new r,new r,new r,new r,new r,new r,new r,new r];e.prototype.toLocalFrame=function(t,p){this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(var y=0;8!==y;y++){var A=k[y];t.pointToLocal(A,A)}return p.setFromPoints(k)};e.prototype.toWorldFrame=
function(t,p){this.getCorners(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);for(var y=0;8!==y;y++){var A=k[y];t.pointToWorld(A,A)}return p.setFromPoints(k)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(h,l){function e(){this.matrix=[]}l.exports=e;e.prototype.get=function(r,q){if(r=r.index,q=q.index,q>r){var k=q;q=r;r=k}return this.matrix[(r*(r+1)>>1)+q-1]};e.prototype.set=function(r,q,k){if(r=r.index,q=q.index,q>r){var t=q;q=r;r=t}this.matrix[(r*(r+1)>>1)+q-1]=k?1:0};e.prototype.reset=function(){for(var r=
0,q=this.matrix.length;r!==q;r++)this.matrix[r]=0};e.prototype.setNumObjects=function(r){this.matrix.length=r*(r-1)>>1}},{}],5:[function(h,l){function e(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var r=h("../objects/Body"),q=h("../math/Vec3"),k=h("../math/Quaternion");h("../shapes/Shape");h("../shapes/Plane");l.exports=e;e.prototype.collisionPairs=function(){throw Error("collisionPairs not implemented for this BroadPhase class!");};var t=r.STATIC|r.KINEMATIC;e.prototype.needBroadphaseCollision=
function(G,I){return 0===(G.collisionFilterGroup&I.collisionFilterMask)||0===(I.collisionFilterGroup&G.collisionFilterMask)?!1:0===(G.type&t)&&G.sleepState!==r.SLEEPING||0===(I.type&t)&&I.sleepState!==r.SLEEPING?!0:!1};e.prototype.intersectionTest=function(G,I,L,T){this.useBoundingBoxes?this.doBoundingBoxBroadphase(G,I,L,T):this.doBoundingSphereBroadphase(G,I,L,T)};var p=new q;new q;new k;new q;e.prototype.doBoundingSphereBroadphase=function(G,I,L,T){I.position.vsub(G.position,p);var n=Math.pow(G.boundingRadius+
I.boundingRadius,2),x=p.norm2();n>x&&(L.push(G),T.push(I))};e.prototype.doBoundingBoxBroadphase=function(G,I,L,T){G.aabbNeedsUpdate&&G.computeAABB();I.aabbNeedsUpdate&&I.computeAABB();G.aabb.overlaps(I.aabb)&&(L.push(G),T.push(I))};var y={keys:[]},A=[],E=[];e.prototype.makePairsUnique=function(G,I){for(var L=G.length,T=0;T!==L;T++)A[T]=G[T],E[T]=I[T];G.length=0;for(T=I.length=0;T!==L;T++){var n=A[T].id,x=E[T].id;n=x>n?n+","+x:x+","+n;y[n]=T;y.keys.push(n)}for(T=0;T!==y.keys.length;T++)n=y.keys.pop(),
L=y[n],G.push(A[L]),I.push(E[L]),delete y[n]};e.prototype.setWorld=function(){};var B=new q;e.boundingSphereCheck=function(G,I){return G.position.vsub(I.position,B),Math.pow(G.shape.boundingSphereRadius+I.shape.boundingSphereRadius,2)>B.norm2()};e.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(h,l){function e(p,
y,A,E,B){r.apply(this);this.nx=A||10;this.ny=E||10;this.nz=B||10;this.aabbMin=p||new q(100,100,100);this.aabbMax=y||new q(-100,-100,-100);p=this.nx*this.ny*this.nz;if(0>=p)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=p;this.binLengths.length=p;for(y=0;p>y;y++)this.bins[y]=[],this.binLengths[y]=0}l.exports=e;var r=h("./Broadphase"),q=h("../math/Vec3"),k=h("../shapes/Shape");e.prototype=new r;e.prototype.constructor=e;var t=new q;new q;e.prototype.collisionPairs=
function(p,y,A){function E(kb,Ib,wb,Mb,Pb,Qb,Wc){kb=(kb-C)*S|0;Ib=(Ib-K)*U|0;wb=(wb-N)*X|0;Mb=fa((Mb-C)*S);Pb=fa((Pb-K)*U);Qb=fa((Qb-N)*X);0>kb?kb=0:kb>=L&&(kb=L-1);0>Ib?Ib=0:Ib>=T&&(Ib=T-1);0>wb?wb=0:wb>=n&&(wb=n-1);0>Mb?Mb=0:Mb>=L&&(Mb=L-1);0>Pb?Pb=0:Pb>=T&&(Pb=T-1);0>Qb?Qb=0:Qb>=n&&(Qb=n-1);kb*=x;Ib*=H;wb*=f;Mb*=x;Pb*=H;for(Qb*=f;Mb>=kb;kb+=x)for(var cd=Ib;Pb>=cd;cd+=H)for(var sc=wb;Qb>=sc;sc+=f){var wc=kb+cd+sc;ja[wc][ba[wc]++]=Wc}}var B=p.numObjects();p=p.bodies;var G=this.aabbMax,I=this.aabbMin,
L=this.nx,T=this.ny,n=this.nz,x=T*n,H=n,f=1,m=G.x,v=G.y,D=G.z,C=I.x,K=I.y,N=I.z,S=L/(m-C),U=T/(v-K),X=n/(D-N);m=(m-C)/L;var Z=(v-K)/T;D=(D-N)/n;var V=.5*Math.sqrt(m*m+Z*Z+D*D);v=k.types;var ma=v.SPHERE,ia=v.PLANE,ja=(v.BOX,v.COMPOUND,v.CONVEXPOLYHEDRON,this.bins),ba=this.binLengths;v=this.bins.length;for(I=0;I!==v;I++)ba[I]=0;var fa=Math.ceil;I=Math.min;G=Math.max;for(I=0;I!==B;I++){G=p[I];var ka=G.shape;switch(ka.type){case ma:var P=G.position.x,Y=G.position.y,da=G.position.z;ka=ka.radius;E(P-ka,
Y-ka,da-ka,P+ka,Y+ka,da+ka,G);break;case ia:ka.worldNormalNeedsUpdate&&ka.computeWorldNormal(G.quaternion);da=ka.worldNormal;ka=K+.5*Z-G.position.y;var pa=N+.5*D-G.position.z,la=t;la.set(C+.5*m-G.position.x,ka,pa);for(var xa=P=0;P!==L;P++,xa+=x,la.y=ka,la.x+=m)for(var Ba=Y=0;Y!==T;Y++,Ba+=H,la.z=pa,la.y+=Z)for(var ya=0,Ga=0;ya!==n;ya++,Ga+=f,la.z+=D)if(la.dot(da)<V){var $a=xa+Ba+Ga;ja[$a][ba[$a]++]=G}break;default:G.aabbNeedsUpdate&&G.computeAABB(),E(G.aabb.lowerBound.x,G.aabb.lowerBound.y,G.aabb.lowerBound.z,
G.aabb.upperBound.x,G.aabb.upperBound.y,G.aabb.upperBound.z,G)}}for(I=0;I!==v;I++)if(B=ba[I],1<B)for(p=ja[I],P=0;P!==B;P++)for(G=p[P],Y=0;Y!==P;Y++)m=p[Y],this.needBroadphaseCollision(G,m)&&this.intersectionTest(G,m,y,A);this.makePairsUnique(y,A)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(h,l){function e(){r.apply(this)}l.exports=e;var r=h("./Broadphase");h=h("./AABB");e.prototype=new r;e.prototype.constructor=e;e.prototype.collisionPairs=function(q,k,t){var p,y=q.bodies,
A=y.length;for(q=0;q!==A;q++)for(p=0;p!==q;p++){var E=y[q];var B=y[p];this.needBroadphaseCollision(E,B)&&this.intersectionTest(E,B,k,t)}};new h;e.prototype.aabbQuery=function(q,k,t){t=t||[];for(var p=0;p<q.bodies.length;p++){var y=q.bodies[p];y.aabbNeedsUpdate&&y.computeAABB();y.aabb.overlaps(k)&&t.push(y)}return t}},{"./AABB":3,"./Broadphase":5}],8:[function(h,l){function e(){this.matrix={}}l.exports=e;e.prototype.get=function(r,q){if(r=r.id,q=q.id,q>r){var k=q;q=r;r=k}return r+"-"+q in this.matrix};
e.prototype.set=function(r,q,k){if(r=r.id,q=q.id,q>r){var t=q;q=r;r=t}k?this.matrix[r+"-"+q]=!0:delete this.matrix[r+"-"+q]};e.prototype.reset=function(){this.matrix={}};e.prototype.setNumObjects=function(){}},{}],9:[function(h,l){function e(ja,ba){this.from=ja?ja.clone():new q;this.to=ba?ba.clone():new q;this._direction=new q;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=e.ANY;this.result=new t;this.hasHit=
!1;this.callback=function(){}}function r(ja,ba,fa,ka){ka.vsub(ba,ma);fa.vsub(ba,E);ja.vsub(ba,B);var P,Y;ja=ma.dot(ma);ba=ma.dot(E);fa=ma.dot(B);ka=E.dot(E);var da=E.dot(B);return 0<=(P=ka*fa-ba*da)&&0<=(Y=ja*da-ba*fa)&&ja*ka-ba*ba>P+Y}l.exports=e;var q=h("../math/Vec3");l=h("../math/Quaternion");var k=h("../math/Transform"),t=(h("../shapes/ConvexPolyhedron"),h("../shapes/Box"),h("../collision/RaycastResult")),p=h("../shapes/Shape");h=h("../collision/AABB");e.prototype.constructor=e;e.CLOSEST=1;e.ANY=
2;e.ALL=4;var y=new h,A=[];e.prototype.intersectWorld=function(ja,ba){return this.mode=ba.mode||e.ANY,this.result=ba.result||new t,this.skipBackfaces=!!ba.skipBackfaces,this.collisionFilterMask="undefined"!=typeof ba.collisionFilterMask?ba.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!=typeof ba.collisionFilterGroup?ba.collisionFilterGroup:-1,ba.from&&this.from.copy(ba.from),ba.to&&this.to.copy(ba.to),this.callback=ba.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),
this.getAABB(y),A.length=0,ja.broadphase.aabbQuery(ja,y,A),this.intersectBodies(A),this.hasHit};var E=new q,B=new q;e.pointInTriangle=r;var G=new q,I=new l;e.prototype.intersectBody=function(ja,ba){ba&&(this.result=ba,this._updateDirection());ba=this.checkCollisionResponse;if((!ba||ja.collisionResponse)&&0!==(this.collisionFilterGroup&ja.collisionFilterMask)&&0!==(ja.collisionFilterGroup&this.collisionFilterMask))for(var fa=0,ka=ja.shapes.length;ka>fa;fa++){var P=ja.shapes[fa];if((!ba||P.collisionResponse)&&
(ja.quaternion.mult(ja.shapeOrientations[fa],I),ja.quaternion.vmult(ja.shapeOffsets[fa],G),G.vadd(ja.position,G),this.intersectShape(P,I,G,ja),this.result._shouldStop))break}};e.prototype.intersectBodies=function(ja,ba){ba&&(this.result=ba,this._updateDirection());ba=0;for(var fa=ja.length;!this.result._shouldStop&&fa>ba;ba++)this.intersectBody(ja[ba])};e.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};e.prototype.intersectShape=function(ja,
ba,fa,ka){var P=this.from,Y=this._direction;fa.vsub(P,ma);var da=ma.dot(Y);Y.mult(da,ia);ia.vadd(P,ia);fa.distanceTo(ia)>ja.boundingSphereRadius||(P=this[ja.type])&&P.call(this,ja,ba,fa,ka)};var L=(new q,new q,new q),T=new q,n=new q,x=new q;new q;new t;e.prototype.intersectBox=function(ja,ba,fa,ka){return this.intersectConvex(ja.convexPolyhedronRepresentation,ba,fa,ka)};e.prototype[p.types.BOX]=e.prototype.intersectBox;e.prototype.intersectPlane=function(ja,ba,fa,ka){var P=this.from,Y=this.to,da=
this._direction,pa=new q(0,0,1);ba.vmult(pa,pa);var la=new q;P.vsub(fa,la);ba=la.dot(pa);Y.vsub(fa,la);la=la.dot(pa);if(!(0<ba*la||P.distanceTo(Y)<ba||(la=pa.dot(da),Math.abs(la)<this.precision))){var xa=new q;Y=new q;ba=new q;P.vsub(fa,xa);fa=-pa.dot(xa)/la;da.scale(fa,Y);P.vadd(Y,ba);this.reportIntersection(pa,ba,ja,ka,-1)}};e.prototype[p.types.PLANE]=e.prototype.intersectPlane;e.prototype.getAABB=function(ja){var ba=this.to,fa=this.from;ja.lowerBound.x=Math.min(ba.x,fa.x);ja.lowerBound.y=Math.min(ba.y,
fa.y);ja.lowerBound.z=Math.min(ba.z,fa.z);ja.upperBound.x=Math.max(ba.x,fa.x);ja.upperBound.y=Math.max(ba.y,fa.y);ja.upperBound.z=Math.max(ba.z,fa.z)};var H={faceList:[0]};e.prototype.intersectHeightfield=function(ja,ba,fa,ka){var P=(ja.data,ja.elementSize,new q),Y=new e(this.from,this.to);k.pointToLocalFrame(fa,ba,Y.from,Y.from);k.pointToLocalFrame(fa,ba,Y.to,Y.to);var da=[],pa=null,la=null,xa=null,Ba=null,ya=ja.getIndexOfPosition(Y.from.x,Y.from.y,da,!1);if(ya&&(pa=da[0],la=da[1],xa=da[0],Ba=da[1]),
ya=ja.getIndexOfPosition(Y.to.x,Y.to.y,da,!1),ya&&((null===pa||da[0]<pa)&&(pa=da[0]),(null===xa||da[0]>xa)&&(xa=da[0]),(null===la||da[1]<la)&&(la=da[1]),(null===Ba||da[1]>Ba)&&(Ba=da[1])),null!==pa)for(Y=[],ja.getRectMinMax(pa,la,xa,Ba,Y),pa=(Y[0],Y[1],pa);xa>=pa;pa++)for(Y=la;Ba>=Y;Y++){if(this.result._shouldStop||(ja.getConvexTrianglePillar(pa,Y,!1),k.pointToWorldFrame(fa,ba,ja.pillarOffset,P),this.intersectConvex(ja.pillarConvex,ba,P,ka,H),this.result._shouldStop))return;ja.getConvexTrianglePillar(pa,
Y,!0);k.pointToWorldFrame(fa,ba,ja.pillarOffset,P);this.intersectConvex(ja.pillarConvex,ba,P,ka,H)}};e.prototype[p.types.HEIGHTFIELD]=e.prototype.intersectHeightfield;var f=new q,m=new q;e.prototype.intersectSphere=function(ja,ba,fa,ka){ba=this.from;var P=this.to,Y=Math.pow(P.x-ba.x,2)+Math.pow(P.y-ba.y,2)+Math.pow(P.z-ba.z,2),da=2*((P.x-ba.x)*(ba.x-fa.x)+(P.y-ba.y)*(ba.y-fa.y)+(P.z-ba.z)*(ba.z-fa.z)),pa=Math.pow(da,2)-4*Y*(Math.pow(ba.x-fa.x,2)+Math.pow(ba.y-fa.y,2)+Math.pow(ba.z-fa.z,2)-Math.pow(ja.radius,
2));if(!(0>pa))if(0===pa)ba.lerp(P,pa,f),f.vsub(fa,m),m.normalize(),this.reportIntersection(m,f,ja,ka,-1);else{var la=(-da-Math.sqrt(pa))/(2*Y);Y=(-da+Math.sqrt(pa))/(2*Y);(0<=la&&1>=la&&(ba.lerp(P,la,f),f.vsub(fa,m),m.normalize(),this.reportIntersection(m,f,ja,ka,-1)),this.result._shouldStop)||0<=Y&&1>=Y&&(ba.lerp(P,Y,f),f.vsub(fa,m),m.normalize(),this.reportIntersection(m,f,ja,ka,-1))}};e.prototype[p.types.SPHERE]=e.prototype.intersectSphere;var v=new q,D=(new q,new q,new q);e.prototype.intersectConvex=
function(ja,ba,fa,ka,P){P=P&&P.faceList||null;for(var Y=ja.faces,da=ja.vertices,pa=ja.faceNormals,la=this._direction,xa=this.from,Ba=xa.distanceTo(this.to),ya=P?P.length:Y.length,Ga=this.result,$a=0;!Ga._shouldStop&&ya>$a;$a++){var kb=P?P[$a]:$a,Ib=Y[kb],wb=pa[kb],Mb=ba,Pb=fa;D.copy(da[Ib[0]]);Mb.vmult(D,D);D.vadd(Pb,D);D.vsub(xa,D);Mb.vmult(wb,v);wb=la.dot(v);if(!(Math.abs(wb)<this.precision||(wb=v.dot(D)/wb,0>wb)))for(la.mult(wb,L),L.vadd(xa,L),T.copy(da[Ib[0]]),Mb.vmult(T,T),Pb.vadd(T,T),wb=1;!Ga._shouldStop&&
wb<Ib.length-1;wb++){n.copy(da[Ib[wb]]);x.copy(da[Ib[wb+1]]);Mb.vmult(n,n);Mb.vmult(x,x);Pb.vadd(n,n);Pb.vadd(x,x);var Qb=L.distanceTo(xa);!r(L,T,n,x)&&!r(L,n,T,x)||Qb>Ba||this.reportIntersection(v,L,ja,ka,kb)}}};e.prototype[p.types.CONVEXPOLYHEDRON]=e.prototype.intersectConvex;var C=new q,K=new q,N=new q,S=new q,U=new q,X=new q,Z=(new h,[]),V=new k;e.prototype.intersectTrimesh=function(ja,ba,fa,ka,P){P=(P&&P.faceList||null,ja.indices);var Y=(ja.vertices,ja.faceNormals,this.from),da=this.to,pa=this._direction;
V.position.copy(fa);V.quaternion.copy(ba);k.vectorToLocalFrame(fa,ba,pa,K);k.pointToLocalFrame(fa,ba,Y,N);k.pointToLocalFrame(fa,ba,da,S);Y=N.distanceSquared(S);ja.tree.rayQuery(this,V,Z);da=0;for(pa=Z.length;!this.result._shouldStop&&da!==pa;da++){var la=Z[da];ja.getNormal(la,C);ja.getVertex(P[3*la],T);T.vsub(N,D);var xa=K.dot(C);xa=C.dot(D)/xa;0>xa||(K.scale(xa,L),L.vadd(N,L),ja.getVertex(P[3*la+1],n),ja.getVertex(P[3*la+2],x),xa=L.distanceSquared(N),!r(L,n,T,x)&&!r(L,T,n,x)||xa>Y||(k.vectorToWorldFrame(ba,
C,U),k.pointToWorldFrame(fa,ba,L,X),this.reportIntersection(U,X,ja,ka,la)))}Z.length=0};e.prototype[p.types.TRIMESH]=e.prototype.intersectTrimesh;e.prototype.reportIntersection=function(ja,ba,fa,ka,P){var Y=this.from,da=this.to,pa=Y.distanceTo(ba),la=this.result;if(!(this.skipBackfaces&&0<ja.dot(this._direction)))switch(la.hitFaceIndex="undefined"!=typeof P?P:-1,this.mode){case e.ALL:this.hasHit=!0;la.set(Y,da,ja,ba,fa,ka,pa);la.hasHit=!0;this.callback(la);break;case e.CLOSEST:(pa<la.distance||!la.hasHit)&&
(this.hasHit=!0,la.hasHit=!0,la.set(Y,da,ja,ba,fa,ka,pa));break;case e.ANY:this.hasHit=!0,la.hasHit=!0,la.set(Y,da,ja,ba,fa,ka,pa),la._shouldStop=!0}};var ma=new q,ia=new q},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(h,l){function e(){this.rayFromWorld=new r;this.rayToWorld=new r;this.hitNormalWorld=new r;this.hitPointWorld=new r;this.hasHit=
!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var r=h("../math/Vec3");l.exports=e;e.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};e.prototype.abort=function(){this._shouldStop=!0};e.prototype.set=function(q,k,t,p,y,A,E){this.rayFromWorld.copy(q);this.rayToWorld.copy(k);this.hitNormalWorld.copy(t);
this.hitPointWorld.copy(p);this.shape=y;this.body=A;this.distance=E}},{"../math/Vec3":30}],11:[function(h,l){function e(q){r.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var k=this.axisList;this._addBodyHandler=function(t){k.push(t.body)};this._removeBodyHandler=function(t){t=k.indexOf(t.body);-1!==t&&k.splice(t,1)};q&&this.setWorld(q)}var r=(h("../shapes/Shape"),h("../collision/Broadphase"));l.exports=e;e.prototype=new r;e.prototype.setWorld=function(q){for(var k=this.axisList.length=
0;k<q.bodies.length;k++)this.axisList.push(q.bodies[k]);q.removeEventListener("addBody",this._addBodyHandler);q.removeEventListener("removeBody",this._removeBodyHandler);q.addEventListener("addBody",this._addBodyHandler);q.addEventListener("removeBody",this._removeBodyHandler);this.world=q;this.dirty=!0};e.insertionSortX=function(q){for(var k=1,t=q.length;t>k;k++){for(var p=q[k],y=k-1;0<=y&&!(q[y].aabb.lowerBound.x<=p.aabb.lowerBound.x);y--)q[y+1]=q[y];q[y+1]=p}return q};e.insertionSortY=function(q){for(var k=
1,t=q.length;t>k;k++){for(var p=q[k],y=k-1;0<=y&&!(q[y].aabb.lowerBound.y<=p.aabb.lowerBound.y);y--)q[y+1]=q[y];q[y+1]=p}return q};e.insertionSortZ=function(q){for(var k=1,t=q.length;t>k;k++){for(var p=q[k],y=k-1;0<=y&&!(q[y].aabb.lowerBound.z<=p.aabb.lowerBound.z);y--)q[y+1]=q[y];q[y+1]=p}return q};e.prototype.collisionPairs=function(q,k,t){var p,y=this.axisList,A=y.length,E=this.axisIndex;this.dirty&&(this.sortList(),this.dirty=!1);for(q=0;q!==A;q++){var B=y[q];for(p=q+1;A>p;p++){var G=y[p];if(this.needBroadphaseCollision(B,
G)){if(!e.checkBounds(B,G,E))break;this.intersectionTest(B,G,k,t)}}}};e.prototype.sortList=function(){for(var q=this.axisList,k=this.axisIndex,t=q.length,p=0;p!==t;p++){var y=q[p];y.aabbNeedsUpdate&&y.computeAABB()}0===k?e.insertionSortX(q):1===k?e.insertionSortY(q):2===k&&e.insertionSortZ(q)};e.checkBounds=function(q,k,t){var p,y;0===t?(p=q.position.x,y=k.position.x):1===t?(p=q.position.y,y=k.position.y):2===t&&(p=q.position.z,y=k.position.z);return p+q.boundingRadius>y-k.boundingRadius};e.prototype.autoDetectAxis=
function(){for(var q=0,k=0,t=0,p=0,y=0,A=0,E=this.axisList,B=E.length,G=1/B,I=0;I!==B;I++){var L=E[I],T=L.position.x;q+=T;k+=T*T;T=L.position.y;t+=T;p+=T*T;L=L.position.z;y+=L;A+=L*L}q=k-q*q*G;t=p-t*t*G;y=A-y*y*G;this.axisIndex=q>t?q>y?0:2:t>y?1:2};e.prototype.aabbQuery=function(q,k,t){t=t||[];this.dirty&&(this.sortList(),this.dirty=!1);q=this.axisIndex;var p="x";1===q&&(p="y");2===q&&(p="z");q=this.axisList;for(p=(k.lowerBound[p],k.upperBound[p],0);p<q.length;p++){var y=q[p];y.aabbNeedsUpdate&&y.computeAABB();
y.aabb.overlaps(k)&&t.push(y)}return t}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(h,l){function e(p,y,A){A=A||{};var E="undefined"!=typeof A.maxForce?A.maxForce:1E6,B=A.pivotA?A.pivotA.clone():new t,G=A.pivotB?A.pivotB.clone():new t;this.axisA=A.axisA?A.axisA.clone():new t;this.axisB=A.axisB?A.axisB.clone():new t;r.call(this,p,B,y,G,E);this.collideConnected=!!A.collideConnected;this.angle="undefined"!=typeof A.angle?A.angle:0;B=this.coneEquation=new q(p,y,A);p=this.twistEquation=
new k(p,y,A);this.twistAngle="undefined"!=typeof A.twistAngle?A.twistAngle:0;B.maxForce=0;B.minForce=-E;p.maxForce=0;p.minForce=-E;this.equations.push(B,p)}l.exports=e;var r=(h("./Constraint"),h("./PointToPointConstraint")),q=h("../equations/ConeEquation"),k=h("../equations/RotationalEquation"),t=(h("../equations/ContactEquation"),h("../math/Vec3"));e.prototype=new r;e.constructor=e;new t;new t;e.prototype.update=function(){var p=this.bodyA,y=this.bodyB,A=this.coneEquation,E=this.twistEquation;r.prototype.update.call(this);
p.vectorToWorldFrame(this.axisA,A.axisA);y.vectorToWorldFrame(this.axisB,A.axisB);this.axisA.tangents(E.axisA,E.axisA);p.vectorToWorldFrame(E.axisA,E.axisA);this.axisB.tangents(E.axisB,E.axisB);y.vectorToWorldFrame(E.axisB,E.axisB);A.angle=this.angle;E.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(h,l){function e(q,k,t){t=r.defaults(t,
{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=q;this.bodyB=k;this.id=e.idCounter++;this.collideConnected=t.collideConnected;t.wakeUpBodies&&(q&&q.wakeUp(),k&&k.wakeUp())}l.exports=e;var r=h("../utils/Utils");e.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};e.prototype.enable=function(){for(var q=this.equations,k=0;k<q.length;k++)q[k].enabled=!0};e.prototype.disable=function(){for(var q=this.equations,k=0;k<q.length;k++)q[k].enabled=
!1};e.idCounter=0},{"../utils/Utils":53}],14:[function(h,l){function e(k,t,p,y){r.call(this,k,t);"undefined"==typeof p&&(p=k.position.distanceTo(t.position));"undefined"==typeof y&&(y=1E6);this.distance=p;k=this.distanceEquation=new q(k,t);this.equations.push(k);k.minForce=-y;k.maxForce=y}l.exports=e;var r=h("./Constraint"),q=h("../equations/ContactEquation");e.prototype=new r;e.prototype.update=function(){var k=this.distanceEquation,t=.5*this.distance,p=k.ni;this.bodyB.position.vsub(this.bodyA.position,
p);p.normalize();p.mult(t,k.ri);p.mult(-t,k.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(h,l){function e(A,E,B){B=B||{};var G="undefined"!=typeof B.maxForce?B.maxForce:1E6,I=B.pivotA?B.pivotA.clone():new t,L=B.pivotB?B.pivotB.clone():new t;r.call(this,A,I,E,L,G);(this.axisA=B.axisA?B.axisA.clone():new t(1,0,0)).normalize();(this.axisB=B.axisB?B.axisB.clone():new t(1,0,0)).normalize();I=this.rotationalEquation1=new q(A,E,B);B=this.rotationalEquation2=new q(A,E,B);A=this.motorEquation=
new k(A,E,G);A.enabled=!1;this.equations.push(I,B,A)}l.exports=e;var r=(h("./Constraint"),h("./PointToPointConstraint")),q=h("../equations/RotationalEquation"),k=h("../equations/RotationalMotorEquation"),t=(h("../equations/ContactEquation"),h("../math/Vec3"));e.prototype=new r;e.constructor=e;e.prototype.enableMotor=function(){this.motorEquation.enabled=!0};e.prototype.disableMotor=function(){this.motorEquation.enabled=!1};e.prototype.setMotorSpeed=function(A){this.motorEquation.targetVelocity=A};
e.prototype.setMotorMaxForce=function(A){this.motorEquation.maxForce=A;this.motorEquation.minForce=-A};var p=new t,y=new t;e.prototype.update=function(){var A=this.bodyA,E=this.bodyB,B=this.motorEquation,G=this.rotationalEquation1,I=this.rotationalEquation2,L=this.axisA,T=this.axisB;r.prototype.update.call(this);A.quaternion.vmult(L,p);E.quaternion.vmult(T,y);p.tangents(G.axisA,I.axisA);G.axisB.copy(y);I.axisB.copy(y);this.motorEquation.enabled&&(A.quaternion.vmult(this.axisA,B.axisA),E.quaternion.vmult(this.axisB,
B.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(h,l){function e(t,p,y){y=y||{};var A="undefined"!=typeof y.maxForce?y.maxForce:1E6,E=new k,B=new k,G=new k;t.position.vadd(p.position,G);G.scale(.5,G);p.pointToLocalFrame(G,B);t.pointToLocalFrame(G,E);r.call(this,t,E,p,B,A);A=this.rotationalEquation1=new q(t,p,y);E=this.rotationalEquation2=new q(t,
p,y);t=this.rotationalEquation3=new q(t,p,y);this.equations.push(A,E,t)}l.exports=e;var r=(h("./Constraint"),h("./PointToPointConstraint")),q=h("../equations/RotationalEquation"),k=(h("../equations/RotationalMotorEquation"),h("../equations/ContactEquation"),h("../math/Vec3"));e.prototype=new r;e.constructor=e;new k;new k;e.prototype.update=function(){var t=this.bodyA,p=this.bodyB,y=(this.motorEquation,this.rotationalEquation1),A=this.rotationalEquation2,E=this.rotationalEquation3;r.prototype.update.call(this);
t.vectorToWorldFrame(k.UNIT_X,y.axisA);p.vectorToWorldFrame(k.UNIT_Y,y.axisB);t.vectorToWorldFrame(k.UNIT_Y,A.axisA);p.vectorToWorldFrame(k.UNIT_Z,A.axisB);t.vectorToWorldFrame(k.UNIT_Z,E.axisA);p.vectorToWorldFrame(k.UNIT_X,E.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(h,l){function e(t,p,y,A,E){r.call(this,t,y);E="undefined"!=typeof E?E:
1E6;this.pivotA=p?p.clone():new k;this.pivotB=A?A.clone():new k;p=this.equationX=new q(t,y);A=this.equationY=new q(t,y);t=this.equationZ=new q(t,y);this.equations.push(p,A,t);p.minForce=A.minForce=t.minForce=-E;p.maxForce=A.maxForce=t.maxForce=E;p.ni.set(1,0,0);A.ni.set(0,1,0);t.ni.set(0,0,1)}l.exports=e;var r=h("./Constraint"),q=h("../equations/ContactEquation"),k=h("../math/Vec3");e.prototype=new r;e.prototype.update=function(){var t=this.bodyB,p=this.equationX,y=this.equationY,A=this.equationZ;
this.bodyA.quaternion.vmult(this.pivotA,p.ri);t.quaternion.vmult(this.pivotB,p.rj);y.ri.copy(p.ri);y.rj.copy(p.rj);A.ri.copy(p.ri);A.rj.copy(p.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(h,l){function e(p,y,A){A=A||{};var E="undefined"!=typeof A.maxForce?A.maxForce:1E6;q.call(this,p,y,-E,E);this.axisA=A.axisA?A.axisA.clone():new r(1,0,0);this.axisB=A.axisB?A.axisB.clone():new r(0,1,0);this.angle="undefined"!=typeof A.angle?A.angle:0}l.exports=e;var r=
h("../math/Vec3"),q=(h("../math/Mat3"),h("./Equation"));e.prototype=new q;e.prototype.constructor=e;var k=new r,t=new r;e.prototype.computeB=function(p){var y=this.a,A=this.b,E=this.axisA,B=this.axisB,G=this.jacobianElementA,I=this.jacobianElementB;E.cross(B,k);B.cross(E,t);G.rotational.copy(t);I.rotational.copy(k);E=Math.cos(this.angle)-E.dot(B);B=this.computeGW();G=this.computeGiMf();return-E*y-B*A-p*G}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(h,l){function e(I,L,T){r.call(this,
I,L,0,"undefined"!=typeof T?T:1E6);this.restitution=0;this.ri=new q;this.rj=new q;this.ni=new q}l.exports=e;var r=h("./Equation"),q=h("../math/Vec3");h("../math/Mat3");e.prototype=new r;e.prototype.constructor=e;var k=new q,t=new q,p=new q;e.prototype.computeB=function(I){var L=this.a,T=this.b,n=this.bi,x=this.bj,H=this.ri,f=this.rj,m=n.velocity,v=n.angularVelocity,D=(n.force,n.torque,x.velocity),C=x.angularVelocity,K=(x.force,x.torque,p),N=this.jacobianElementA,S=this.jacobianElementB,U=this.ni;
H.cross(U,k);f.cross(U,t);U.negate(N.spatial);k.negate(N.rotational);S.spatial.copy(U);S.rotational.copy(t);K.copy(x.position);K.vadd(f,K);K.vsub(n.position,K);K.vsub(H,K);n=U.dot(K);x=this.restitution+1;m=x*D.dot(U)-x*m.dot(U)+C.dot(t)-v.dot(k);v=this.computeGiMf();return-n*L-m*T-I*v};var y=new q,A=new q,E=new q,B=new q,G=new q;e.prototype.getImpactVelocityAlongNormal=function(){return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,B),this.bi.getVelocityAtWorldPoint(E,y),this.bj.getVelocityAtWorldPoint(B,
A),y.vsub(A,G),this.ni.dot(G)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(h,l){function e(B,G,I,L){this.id=e.id++;this.minForce="undefined"==typeof I?-1E6:I;this.maxForce="undefined"==typeof L?1E6:L;this.bi=B;this.bj=G;this.eps=this.b=this.a=0;this.jacobianElementA=new r;this.jacobianElementB=new r;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}l.exports=e;var r=h("../math/JacobianElement");h=h("../math/Vec3");e.prototype.constructor=e;e.id=0;e.prototype.setSpookParams=
function(B,G,I){this.a=4/(I*(1+4*G));this.b=4*G/(1+4*G);this.eps=4/(I*I*B*(1+4*G))};e.prototype.computeB=function(B,G,I){var L=this.computeGW(),T=this.computeGq(),n=this.computeGiMf();return-T*B-L*G-n*I};e.prototype.computeGq=function(){var B=this.jacobianElementB,G=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+B.spatial.dot(G)};var q=new h;e.prototype.computeGW=function(){var B=this.jacobianElementB,G=this.bi,I=this.bj,L=I.velocity;I=I.angularVelocity||q;return this.jacobianElementA.multiplyVectors(G.velocity,
G.angularVelocity||q)+B.multiplyVectors(L,I)};e.prototype.computeGWlambda=function(){var B=this.jacobianElementB,G=this.bi,I=this.bj,L=I.vlambda;I=I.wlambda||q;return this.jacobianElementA.multiplyVectors(G.vlambda,G.wlambda||q)+B.multiplyVectors(L,I)};var k=new h,t=new h,p=new h,y=new h;e.prototype.computeGiMf=function(){var B=this.jacobianElementA,G=this.jacobianElementB,I=this.bi,L=this.bj,T=I.force,n=I.torque,x=L.force,H=L.torque,f=I.invMassSolve,m=L.invMassSolve;return I.invInertiaWorldSolve?
I.invInertiaWorldSolve.vmult(n,p):p.set(0,0,0),L.invInertiaWorldSolve?L.invInertiaWorldSolve.vmult(H,y):y.set(0,0,0),T.mult(f,k),x.mult(m,t),B.multiplyVectors(k,p)+G.multiplyVectors(t,y)};var A=new h;e.prototype.computeGiMGt=function(){var B=this.jacobianElementA,G=this.jacobianElementB,I=this.bi,L=this.bj,T=I.invInertiaWorldSolve,n=L.invInertiaWorldSolve;I=I.invMassSolve+L.invMassSolve;return T&&(T.vmult(B.rotational,A),I+=A.dot(B.rotational)),n&&(n.vmult(G.rotational,A),I+=A.dot(G.rotational)),
I};var E=new h;new h;new h;new h;new h;new h;e.prototype.addToWlambda=function(B){var G=this.jacobianElementA,I=this.jacobianElementB,L=this.bi,T=this.bj;G.spatial.mult(L.invMassSolve*B,E);L.vlambda.vadd(E,L.vlambda);I.spatial.mult(T.invMassSolve*B,E);T.vlambda.vadd(E,T.vlambda);L.invInertiaWorldSolve&&(L.invInertiaWorldSolve.vmult(G.rotational,E),E.mult(B,E),L.wlambda.vadd(E,L.wlambda));T.invInertiaWorldSolve&&(T.invInertiaWorldSolve.vmult(I.rotational,E),E.mult(B,E),T.wlambda.vadd(E,T.wlambda))};
e.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(h,l){function e(p,y,A){r.call(this,p,y,-A,A);this.ri=new q;this.rj=new q;this.t=new q}l.exports=e;var r=h("./Equation"),q=h("../math/Vec3");h("../math/Mat3");e.prototype=new r;e.prototype.constructor=e;var k=new q,t=new q;e.prototype.computeB=function(p){var y=(this.a,this.b),A=(this.bi,this.bj,this.ri),E=this.rj,B=this.t;A.cross(B,k);E.cross(B,t);A=this.jacobianElementA;
E=this.jacobianElementB;B.negate(A.spatial);k.negate(A.rotational);E.spatial.copy(B);E.rotational.copy(t);B=this.computeGW();A=this.computeGiMf();return-B*y-p*A}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(h,l){function e(p,y,A){A=A||{};var E="undefined"!=typeof A.maxForce?A.maxForce:1E6;q.call(this,p,y,-E,E);this.axisA=A.axisA?A.axisA.clone():new r(1,0,0);this.axisB=A.axisB?A.axisB.clone():new r(0,1,0);this.maxAngle=Math.PI/2}l.exports=e;var r=h("../math/Vec3"),q=(h("../math/Mat3"),
h("./Equation"));e.prototype=new q;e.prototype.constructor=e;var k=new r,t=new r;e.prototype.computeB=function(p){var y=this.a,A=this.b,E=this.axisA,B=this.axisB,G=this.jacobianElementA,I=this.jacobianElementB;E.cross(B,k);B.cross(E,t);G.rotational.copy(t);I.rotational.copy(k);E=Math.cos(this.maxAngle)-E.dot(B);B=this.computeGW();G=this.computeGiMf();return-E*y-B*A-p*G}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(h,l){function e(k,t,p){p="undefined"!=typeof p?p:1E6;q.call(this,
k,t,-p,p);this.axisA=new r;this.axisB=new r;this.targetVelocity=0}l.exports=e;var r=h("../math/Vec3"),q=(h("../math/Mat3"),h("./Equation"));e.prototype=new q;e.prototype.constructor=e;e.prototype.computeB=function(k){var t=(this.a,this.b),p=(this.bi,this.bj,this.axisA),y=this.axisB,A=this.jacobianElementB;this.jacobianElementA.rotational.copy(p);y.negate(A.rotational);p=this.computeGW()-this.targetVelocity;y=this.computeGiMf();return-p*t-k*y}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],
24:[function(h,l){function e(q,k,t){t=r.defaults(t,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=e.idCounter++;this.materials=[q,k];this.friction=t.friction;this.restitution=t.restitution;this.contactEquationStiffness=t.contactEquationStiffness;this.contactEquationRelaxation=t.contactEquationRelaxation;this.frictionEquationStiffness=t.frictionEquationStiffness;this.frictionEquationRelaxation=
t.frictionEquationRelaxation}var r=h("../utils/Utils");l.exports=e;e.idCounter=0},{"../utils/Utils":53}],25:[function(h,l){function e(r){var q="";r=r||{};"string"==typeof r?(q=r,r={}):"object"==typeof r&&(q="");this.name=q;this.id=e.idCounter++;this.friction="undefined"!=typeof r.friction?r.friction:-1;this.restitution="undefined"!=typeof r.restitution?r.restitution:-1}l.exports=e;e.idCounter=0},{}],26:[function(h,l){function e(){this.spatial=new r;this.rotational=new r}l.exports=e;var r=h("./Vec3");
e.prototype.multiplyElement=function(q){return q.spatial.dot(this.spatial)+q.rotational.dot(this.rotational)};e.prototype.multiplyVectors=function(q,k){return q.dot(this.spatial)+k.dot(this.rotational)}},{"./Vec3":30}],27:[function(h,l){function e(q){this.elements=q?q:[0,0,0,0,0,0,0,0,0]}l.exports=e;var r=h("./Vec3");e.prototype.identity=function(){var q=this.elements;q[0]=1;q[1]=0;q[2]=0;q[3]=0;q[4]=1;q[5]=0;q[6]=0;q[7]=0;q[8]=1};e.prototype.setZero=function(){var q=this.elements;q[0]=0;q[1]=0;q[2]=
0;q[3]=0;q[4]=0;q[5]=0;q[6]=0;q[7]=0;q[8]=0};e.prototype.setTrace=function(q){var k=this.elements;k[0]=q.x;k[4]=q.y;k[8]=q.z};e.prototype.getTrace=function(q){q=q||new r;var k=this.elements;q.x=k[0];q.y=k[4];q.z=k[8]};e.prototype.vmult=function(q,k){k=k||new r;var t=this.elements,p=q.x,y=q.y;q=q.z;return k.x=t[0]*p+t[1]*y+t[2]*q,k.y=t[3]*p+t[4]*y+t[5]*q,k.z=t[6]*p+t[7]*y+t[8]*q,k};e.prototype.smult=function(q){for(var k=0;k<this.elements.length;k++)this.elements[k]*=q};e.prototype.mmult=function(q,
k){k=k||new e;for(var t=0;3>t;t++)for(var p=0;3>p;p++){for(var y=0,A=0;3>A;A++)y+=q.elements[t+3*A]*this.elements[A+3*p];k.elements[t+3*p]=y}return k};e.prototype.scale=function(q,k){k=k||new e;for(var t=this.elements,p=k.elements,y=0;3!==y;y++)p[3*y]=q.x*t[3*y],p[3*y+1]=q.y*t[3*y+1],p[3*y+2]=q.z*t[3*y+2];return k};e.prototype.solve=function(q,k){k=k||new r;for(var t=[],p=0;12>p;p++)t.push(0);var y;for(p=0;3>p;p++)for(y=0;3>y;y++)t[p+4*y]=this.elements[p+3*y];t[3]=q.x;t[7]=q.y;t[11]=q.z;var A=3,E=
A;do{if(p=E-A,0===t[p+4*p])for(y=p+1;E>y;y++)if(0!==t[p+4*y]){var B=4;do{var G=4-B;t[G+4*p]+=t[G+4*y]}while(--B);break}if(0!==t[p+4*p])for(y=p+1;E>y;y++){var I=t[p+4*y]/t[p+4*p];B=4;do G=4-B,t[G+4*y]=p>=G?0:t[G+4*y]-t[G+4*p]*I;while(--B)}}while(--A);if(k.z=t[11]/t[10],k.y=(t[7]-t[6]*k.z)/t[5],k.x=(t[3]-t[2]*k.z-t[1]*k.y)/t[0],isNaN(k.x)||isNaN(k.y)||isNaN(k.z)||1/0===k.x||1/0===k.y||1/0===k.z)throw"Could not solve equation! Got x=["+k.toString()+"], b=["+q.toString()+"], A=["+this.toString()+"]";
return k};e.prototype.e=function(q,k,t){return void 0===t?this.elements[k+3*q]:void(this.elements[k+3*q]=t)};e.prototype.copy=function(q){for(var k=0;k<q.elements.length;k++)this.elements[k]=q.elements[k];return this};e.prototype.toString=function(){for(var q="",k=0;9>k;k++)q+=this.elements[k]+",";return q};e.prototype.reverse=function(q){q=q||new e;for(var k=[],t=0;18>t;t++)k.push(0);var p;for(t=0;3>t;t++)for(p=0;3>p;p++)k[t+6*p]=this.elements[t+3*p];k[3]=1;k[9]=0;k[15]=0;k[4]=0;k[10]=1;k[16]=0;
k[5]=0;k[11]=0;k[17]=1;var y=3,A=y;do{if(t=A-y,0===k[t+6*t])for(p=t+1;A>p;p++)if(0!==k[t+6*p]){var E=6;do{var B=6-E;k[B+6*t]+=k[B+6*p]}while(--E);break}if(0!==k[t+6*t])for(p=t+1;A>p;p++){var G=k[t+6*p]/k[t+6*t];E=6;do B=6-E,k[B+6*p]=t>=B?0:k[B+6*p]-k[B+6*t]*G;while(--E)}}while(--y);t=2;do{p=t-1;do{G=k[t+6*p]/k[t+6*t];E=6;do B=6-E,k[B+6*p]-=k[B+6*t]*G;while(--E)}while(p--)}while(--t);t=2;do{G=1/k[t+6*t];E=6;do B=6-E,k[B+6*t]*=G;while(--E)}while(t--);t=2;do{p=2;do{if(B=k[3+p+6*t],isNaN(B)||1/0===B)throw"Could not reverse! A=["+
this.toString()+"]";q.e(t,p,B)}while(p--)}while(t--);return q};e.prototype.setRotationFromQuaternion=function(q){var k=q.x,t=q.y,p=q.z,y=q.w,A=k+k,E=t+t,B=p+p;q=k*A;var G=k*E;k*=B;var I=t*E;t*=B;p*=B;A*=y;E*=y;y*=B;B=this.elements;return B[0]=1-(I+p),B[1]=G-y,B[2]=k+E,B[3]=G+y,B[4]=1-(q+p),B[5]=t-A,B[6]=k-E,B[7]=t+A,B[8]=1-(q+I),this};e.prototype.transpose=function(q){q=q||new e;for(var k=q.elements,t=this.elements,p=0;3!==p;p++)for(var y=0;3!==y;y++)k[3*p+y]=t[3*y+p];return q}},{"./Vec3":30}],28:[function(h,
l){function e(A,E,B,G){this.x=void 0!==A?A:0;this.y=void 0!==E?E:0;this.z=void 0!==B?B:0;this.w=void 0!==G?G:1}l.exports=e;var r=h("./Vec3");e.prototype.set=function(A,E,B,G){this.x=A;this.y=E;this.z=B;this.w=G};e.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};e.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};e.prototype.setFromAxisAngle=function(A,E){var B=Math.sin(.5*E);this.x=A.x*B;this.y=A.y*B;this.z=A.z*B;this.w=Math.cos(.5*E)};e.prototype.toAxisAngle=
function(A){A=A||new r;this.normalize();var E=2*Math.acos(this.w),B=Math.sqrt(1-this.w*this.w);return.001>B?(A.x=this.x,A.y=this.y,A.z=this.z):(A.x=this.x/B,A.y=this.y/B,A.z=this.z/B),[A,E]};var q=new r,k=new r;e.prototype.setFromVectors=function(A,E){if(A.isAntiparallelTo(E))A.tangents(q,k),this.setFromAxisAngle(q,Math.PI);else{var B=A.cross(E);this.x=B.x;this.y=B.y;this.z=B.z;this.w=Math.sqrt(Math.pow(A.norm(),2)*Math.pow(E.norm(),2))+A.dot(E);this.normalize()}};var t=new r,p=new r,y=new r;e.prototype.mult=
function(A,E){E=E||new e;var B=this.w;return t.set(this.x,this.y,this.z),p.set(A.x,A.y,A.z),E.w=B*A.w-t.dot(p),t.cross(p,y),E.x=B*p.x+A.w*t.x+y.x,E.y=B*p.y+A.w*t.y+y.y,E.z=B*p.z+A.w*t.z+y.z,E};e.prototype.inverse=function(A){var E=this.x,B=this.y,G=this.z,I=this.w;A=A||new e;this.conjugate(A);E=1/(E*E+B*B+G*G+I*I);return A.x*=E,A.y*=E,A.z*=E,A.w*=E,A};e.prototype.conjugate=function(A){return A=A||new e,A.x=-this.x,A.y=-this.y,A.z=-this.z,A.w=this.w,A};e.prototype.normalize=function(){var A=Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===A?(this.x=0,this.y=0,this.z=0,this.w=0):(A=1/A,this.x*=A,this.y*=A,this.z*=A,this.w*=A)};e.prototype.normalizeFast=function(){var A=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===A?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=A,this.y*=A,this.z*=A,this.w*=A)};e.prototype.vmult=function(A,E){E=E||new r;var B=A.x,G=A.y,I=A.z;A=this.x;var L=this.y,T=this.z,n=this.w,x=n*B+L*I-T*G,H=n*G+T*B-A*I,f=n*I+A*G-L*B;B=-A*B-L*G-T*I;return E.x=
x*n+B*-A+H*-T-f*-L,E.y=H*n+B*-L+f*-A-x*-T,E.z=f*n+B*-T+x*-L-H*-A,E};e.prototype.copy=function(A){return this.x=A.x,this.y=A.y,this.z=A.z,this.w=A.w,this};e.prototype.toEuler=function(A,E){E=E||"YZX";var B,G,I,L=this.x,T=this.y,n=this.z,x=this.w;switch(E){case "YZX":E=L*T+n*x;if(.499<E&&(B=2*Math.atan2(L,x),G=Math.PI/2,I=0),-.499>E&&(B=-2*Math.atan2(L,x),G=-Math.PI/2,I=0),isNaN(B))I=n*n,B=Math.atan2(2*T*x-2*L*n,1-2*T*T-2*I),G=Math.asin(2*E),I=Math.atan2(2*L*x-2*T*n,1-2*L*L-2*I);break;default:throw Error("Euler order "+
E+" not supported yet.");}A.y=B;A.z=G;A.x=I};e.prototype.setFromEuler=function(A,E,B,G){G=G||"XYZ";var I=Math.cos(A/2),L=Math.cos(E/2),T=Math.cos(B/2);A=Math.sin(A/2);E=Math.sin(E/2);B=Math.sin(B/2);return"XYZ"===G?(this.x=A*L*T+I*E*B,this.y=I*E*T-A*L*B,this.z=I*L*B+A*E*T,this.w=I*L*T-A*E*B):"YXZ"===G?(this.x=A*L*T+I*E*B,this.y=I*E*T-A*L*B,this.z=I*L*B-A*E*T,this.w=I*L*T+A*E*B):"ZXY"===G?(this.x=A*L*T-I*E*B,this.y=I*E*T+A*L*B,this.z=I*L*B+A*E*T,this.w=I*L*T-A*E*B):"ZYX"===G?(this.x=A*L*T-I*E*B,this.y=
I*E*T+A*L*B,this.z=I*L*B-A*E*T,this.w=I*L*T+A*E*B):"YZX"===G?(this.x=A*L*T+I*E*B,this.y=I*E*T+A*L*B,this.z=I*L*B-A*E*T,this.w=I*L*T-A*E*B):"XZY"===G&&(this.x=A*L*T-I*E*B,this.y=I*E*T-A*L*B,this.z=I*L*B+A*E*T,this.w=I*L*T+A*E*B),this};e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(h,l){function e(t){t=t||{};this.position=new r;t.position&&this.position.copy(t.position);this.quaternion=new q;t.quaternion&&this.quaternion.copy(t.quaternion)}var r=
h("./Vec3"),q=h("./Quaternion");l.exports=e;var k=new q;e.pointToLocalFrame=function(t,p,y,A){A=A||new r;return y.vsub(t,A),p.conjugate(k),k.vmult(A,A),A};e.prototype.pointToLocal=function(t,p){return e.pointToLocalFrame(this.position,this.quaternion,t,p)};e.pointToWorldFrame=function(t,p,y,A){A=A||new r;return p.vmult(y,A),A.vadd(t,A),A};e.prototype.pointToWorld=function(t,p){return e.pointToWorldFrame(this.position,this.quaternion,t,p)};e.prototype.vectorToWorldFrame=function(t,p){p=p||new r;return this.quaternion.vmult(t,
p),p};e.vectorToWorldFrame=function(t,p,y){return t.vmult(p,y),y};e.vectorToLocalFrame=function(t,p,y,A){A=A||new r;return p.w*=-1,p.vmult(y,A),p.w*=-1,A}},{"./Quaternion":28,"./Vec3":30}],30:[function(h,l){function e(p,y,A){this.x=p||0;this.y=y||0;this.z=A||0}l.exports=e;var r=h("./Mat3");e.ZERO=new e(0,0,0);e.UNIT_X=new e(1,0,0);e.UNIT_Y=new e(0,1,0);e.UNIT_Z=new e(0,0,1);e.prototype.cross=function(p,y){var A=p.x,E=p.y;p=p.z;var B=this.x,G=this.y,I=this.z;return y=y||new e,y.x=G*p-I*E,y.y=I*A-B*
p,y.z=B*E-G*A,y};e.prototype.set=function(p,y,A){return this.x=p,this.y=y,this.z=A,this};e.prototype.setZero=function(){this.x=this.y=this.z=0};e.prototype.vadd=function(p,y){return y?(y.x=p.x+this.x,y.y=p.y+this.y,y.z=p.z+this.z,void 0):new e(this.x+p.x,this.y+p.y,this.z+p.z)};e.prototype.vsub=function(p,y){return y?(y.x=this.x-p.x,y.y=this.y-p.y,y.z=this.z-p.z,void 0):new e(this.x-p.x,this.y-p.y,this.z-p.z)};e.prototype.crossmat=function(){return new r([0,-this.z,this.y,this.z,0,-this.x,-this.y,
this.x,0])};e.prototype.normalize=function(){var p=this.x,y=this.y,A=this.z;p=Math.sqrt(p*p+y*y+A*A);0<p?(y=1/p,this.x*=y,this.y*=y,this.z*=y):this.z=this.y=this.x=0;return p};e.prototype.unit=function(p){p=p||new e;var y=this.x,A=this.y,E=this.z,B=Math.sqrt(y*y+A*A+E*E);return 0<B?(B=1/B,p.x=y*B,p.y=A*B,p.z=E*B):(p.x=1,p.y=0,p.z=0),p};e.prototype.norm=function(){var p=this.x,y=this.y,A=this.z;return Math.sqrt(p*p+y*y+A*A)};e.prototype.length=e.prototype.norm;e.prototype.norm2=function(){return this.dot(this)};
e.prototype.lengthSquared=e.prototype.norm2;e.prototype.distanceTo=function(p){var y=this.x,A=this.y,E=this.z,B=p.x,G=p.y;p=p.z;return Math.sqrt((B-y)*(B-y)+(G-A)*(G-A)+(p-E)*(p-E))};e.prototype.distanceSquared=function(p){var y=this.x,A=this.y,E=this.z,B=p.x,G=p.y;p=p.z;return(B-y)*(B-y)+(G-A)*(G-A)+(p-E)*(p-E)};e.prototype.mult=function(p,y){y=y||new e;var A=this.y,E=this.z;return y.x=p*this.x,y.y=p*A,y.z=p*E,y};e.prototype.scale=e.prototype.mult;e.prototype.dot=function(p){return this.x*p.x+this.y*
p.y+this.z*p.z};e.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};e.prototype.negate=function(p){return p=p||new e,p.x=-this.x,p.y=-this.y,p.z=-this.z,p};var q=new e,k=new e;e.prototype.tangents=function(p,y){var A=this.norm();0<A?(A=1/A,q.set(this.x*A,this.y*A,this.z*A),.9>Math.abs(q.x)?(k.set(1,0,0),q.cross(k,p)):(k.set(0,1,0),q.cross(k,p)),q.cross(p,y)):(p.set(1,0,0),y.set(0,1,0))};e.prototype.toString=function(){return this.x+","+this.y+","+this.z};e.prototype.toArray=function(){return[this.x,
this.y,this.z]};e.prototype.copy=function(p){return this.x=p.x,this.y=p.y,this.z=p.z,this};e.prototype.lerp=function(p,y,A){var E=this.x,B=this.y,G=this.z;A.x=E+(p.x-E)*y;A.y=B+(p.y-B)*y;A.z=G+(p.z-G)*y};e.prototype.almostEquals=function(p,y){return void 0===y&&(y=1E-6),Math.abs(this.x-p.x)>y||Math.abs(this.y-p.y)>y||Math.abs(this.z-p.z)>y?!1:!0};e.prototype.almostZero=function(p){return void 0===p&&(p=1E-6),Math.abs(this.x)>p||Math.abs(this.y)>p||Math.abs(this.z)>p?!1:!0};var t=new e;e.prototype.isAntiparallelTo=
function(p,y){return this.negate(t),t.almostEquals(p,y)};e.prototype.clone=function(){return new e(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(h,l){function e(K){K=K||{};r.apply(this);this.id=e.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new q;this.collisionFilterGroup="number"==typeof K.collisionFilterGroup?K.collisionFilterGroup:1;this.collisionFilterMask="number"==typeof K.collisionFilterMask?K.collisionFilterMask:1;this.collisionResponse=!0;this.position=new q;
K.position&&this.position.copy(K.position);this.previousPosition=new q;this.initPosition=new q;this.velocity=new q;K.velocity&&this.velocity.copy(K.velocity);this.initVelocity=new q;this.force=new q;var N="number"==typeof K.mass?K.mass:0;this.mass=N;this.invMass=0<N?1/N:0;this.material=K.material||null;this.linearDamping="number"==typeof K.linearDamping?K.linearDamping:.01;this.type=0>=N?e.STATIC:e.DYNAMIC;typeof K.type==typeof e.STATIC&&(this.type=K.type);this.allowSleep="undefined"!=typeof K.allowSleep?
K.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!=typeof K.sleepSpeedLimit?K.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!=typeof K.sleepTimeLimit?K.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new q;this.quaternion=new t;K.quaternion&&this.quaternion.copy(K.quaternion);this.initQuaternion=new t;this.angularVelocity=new q;K.angularVelocity&&this.angularVelocity.copy(K.angularVelocity);this.initAngularVelocity=new q;this.interpolatedPosition=
new q;this.interpolatedQuaternion=new t;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new q;this.invInertia=new q;this.invInertiaWorld=new k;this.invMassSolve=0;this.invInertiaSolve=new q;this.invInertiaWorldSolve=new k;this.fixedRotation="undefined"!=typeof K.fixedRotation?K.fixedRotation:!1;this.angularDamping="undefined"!=typeof K.angularDamping?K.angularDamping:.01;this.aabb=new p;this.aabbNeedsUpdate=!0;this.wlambda=new q;K.shape&&this.addShape(K.shape);this.updateMassProperties()}
l.exports=e;var r=h("../utils/EventTarget"),q=(h("../shapes/Shape"),h("../math/Vec3")),k=h("../math/Mat3"),t=h("../math/Quaternion"),p=(h("../material/Material"),h("../collision/AABB")),y=h("../shapes/Box");e.prototype=new r;e.prototype.constructor=e;e.DYNAMIC=1;e.STATIC=2;e.KINEMATIC=4;e.AWAKE=0;e.SLEEPY=1;e.SLEEPING=2;e.idCounter=0;e.prototype.wakeUp=function(){var K=this.sleepState;this.sleepState=0;K===e.SLEEPING&&this.dispatchEvent({type:"wakeup"})};e.prototype.sleep=function(){this.sleepState=
e.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};e.sleepyEvent={type:"sleepy"};e.sleepEvent={type:"sleep"};e.prototype.sleepTick=function(K){if(this.allowSleep){var N=this.sleepState,S=this.velocity.norm2()+this.angularVelocity.norm2(),U=Math.pow(this.sleepSpeedLimit,2);N===e.AWAKE&&U>S?(this.sleepState=e.SLEEPY,this.timeLastSleepy=K,this.dispatchEvent(e.sleepyEvent)):N===e.SLEEPY&&S>U?this.wakeUp():N===e.SLEEPY&&K-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(e.sleepEvent))}};
e.prototype.updateSolveMassProperties=function(){this.sleepState===e.SLEEPING||this.type===e.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};e.prototype.pointToLocalFrame=function(K,N){N=N||new q;return K.vsub(this.position,N),this.quaternion.conjugate().vmult(N,N),N};e.prototype.vectorToLocalFrame=function(K,N){N=N||new q;
return this.quaternion.conjugate().vmult(K,N),N};e.prototype.pointToWorldFrame=function(K,N){N=N||new q;return this.quaternion.vmult(K,N),N.vadd(this.position,N),N};e.prototype.vectorToWorldFrame=function(K,N){N=N||new q;return this.quaternion.vmult(K,N),N};var A=new q,E=new t;e.prototype.addShape=function(K,N,S){var U=new q,X=new t;return N&&U.copy(N),S&&X.copy(S),this.shapes.push(K),this.shapeOffsets.push(U),this.shapeOrientations.push(X),this.updateMassProperties(),this.updateBoundingRadius(),
this.aabbNeedsUpdate=!0,this};e.prototype.updateBoundingRadius=function(){for(var K=this.shapes,N=this.shapeOffsets,S=K.length,U=0,X=0;X!==S;X++){var Z=K[X];Z.updateBoundingSphereRadius();var V=N[X].norm();Z=Z.boundingSphereRadius;V+Z>U&&(U=V+Z)}this.boundingRadius=U};var B=new p;e.prototype.computeAABB=function(){for(var K=this.shapes,N=this.shapeOffsets,S=this.shapeOrientations,U=K.length,X=this.quaternion,Z=this.aabb,V=0;V!==U;V++){var ma=K[V];S[V].mult(X,E);E.vmult(N[V],A);A.vadd(this.position,
A);ma.calculateWorldAABB(A,E,B.lowerBound,B.upperBound);0===V?Z.copy(B):Z.extend(B)}this.aabbNeedsUpdate=!1};var G=new k,I=new k;new k;e.prototype.updateInertiaWorld=function(K){var N=this.invInertia;if(N.x!==N.y||N.y!==N.z||K)G.setRotationFromQuaternion(this.quaternion),G.transpose(I),G.scale(N,G),G.mmult(I,this.invInertiaWorld)};var L=new q,T=new q;e.prototype.applyForce=function(K,N){this.type===e.DYNAMIC&&(N.vsub(this.position,L),L.cross(K,T),this.force.vadd(K,this.force),this.torque.vadd(T,this.torque))};
var n=new q,x=new q;e.prototype.applyLocalForce=function(K,N){this.type===e.DYNAMIC&&(this.vectorToWorldFrame(K,n),this.pointToWorldFrame(N,x),this.applyForce(n,x))};var H=new q,f=new q,m=new q;e.prototype.applyImpulse=function(K,N){this.type===e.DYNAMIC&&(N.vsub(this.position,H),f.copy(K),f.mult(this.invMass,f),this.velocity.vadd(f,this.velocity),H.cross(K,m),this.invInertiaWorld.vmult(m,m),this.angularVelocity.vadd(m,this.angularVelocity))};var v=new q,D=new q;e.prototype.applyLocalImpulse=function(K,
N){this.type===e.DYNAMIC&&(this.vectorToWorldFrame(K,v),this.pointToWorldFrame(N,D),this.applyImpulse(v,D))};var C=new q;e.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var K=this.inertia,N=this.fixedRotation;this.computeAABB();C.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);y.calculateInertia(C,this.mass,K);this.invInertia.set(0<K.x&&!N?1/K.x:0,0<K.y&&!N?
1/K.y:0,0<K.z&&!N?1/K.z:0);this.updateInertiaWorld(!0)};e.prototype.getVelocityAtWorldPoint=function(K,N){var S=new q;return K.vsub(this.position,S),this.angularVelocity.cross(S,N),this.velocity.vadd(N,N),N}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(h,l){function e(U){this.chassisBody=U.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis=
"undefined"!=typeof U.indexRightAxis?U.indexRightAxis:1;this.indexForwardAxis="undefined"!=typeof U.indexForwardAxis?U.indexForwardAxis:0;this.indexUpAxis="undefined"!=typeof U.indexUpAxis?U.indexUpAxis:2}function r(U,X,Z){var V=m,ma=v,ia=D,ja=C;return X.vsub(U.position,V),V.cross(Z,ma),U.invInertiaWorld.vmult(ma,ja),ja.cross(V,ia),U.invMass+Z.dot(ia)}var q=(h("./Body"),h("../math/Vec3")),k=h("../math/Quaternion"),t=(h("../collision/RaycastResult"),h("../collision/Ray")),p=h("../objects/WheelInfo");
l.exports=e;var y=(new q,new q,new q,new q),A=new q,E=new q;new t;e.prototype.addWheel=function(U){U=U||{};U=new p(U);var X=this.wheelInfos.length;return this.wheelInfos.push(U),X};e.prototype.setSteeringValue=function(U,X){this.wheelInfos[X].steering=U};new q;e.prototype.applyEngineForce=function(U,X){this.wheelInfos[X].engineForce=U};e.prototype.setBrake=function(U,X){this.wheelInfos[X].brake=U};e.prototype.addToWorld=function(U){this.constraints;U.add(this.chassisBody);var X=this;this.preStepCallback=
function(){X.updateVehicle(U.dt)};U.addEventListener("preStep",this.preStepCallback);this.world=U};e.prototype.getVehicleAxisWorld=function(U,X){X.set(0===U?1:0,1===U?1:0,2===U?1:0);this.chassisBody.vectorToWorldFrame(X,X)};e.prototype.updateVehicle=function(U){for(var X=this.wheelInfos,Z=X.length,V=this.chassisBody,ma=0;Z>ma;ma++)this.updateWheelTransform(ma);this.currentVehicleSpeedKmHour=3.6*V.velocity.norm();ma=new q;this.getVehicleAxisWorld(this.indexForwardAxis,ma);0>ma.dot(V.velocity)&&(this.currentVehicleSpeedKmHour*=
-1);for(ma=0;Z>ma;ma++)this.castRay(X[ma]);this.updateSuspension(U);var ia=new q,ja=new q;for(ma=0;Z>ma;ma++){var ba=X[ma],fa=ba.suspensionForce;fa>ba.maxSuspensionForce&&(fa=ba.maxSuspensionForce);ba.raycastResult.hitNormalWorld.scale(fa*U,ia);ba.raycastResult.hitPointWorld.vsub(V.position,ja);V.applyImpulse(ia,ba.raycastResult.hitPointWorld)}this.updateFriction(U);ia=new q;ja=new q;fa=new q;for(ma=0;Z>ma;ma++){ba=X[ma];V.getVelocityAtWorldPoint(ba.chassisConnectionPointWorld,fa);var ka=1;switch(this.indexUpAxis){case 1:ka=
-1}if(ba.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,ja);var P=ja.dot(ba.raycastResult.hitNormalWorld);ba.raycastResult.hitNormalWorld.scale(P,ia);ja.vsub(ia,ja);P=ja.dot(fa);ba.deltaRotation=ka*P*U/ba.radius}!ba.sliding&&ba.isInContact||0===ba.engineForce||!ba.useCustomSlidingRotationalSpeed||(ba.deltaRotation=(0<ba.engineForce?1:-1)*ba.customSlidingRotationalSpeed*U);Math.abs(ba.brake)>Math.abs(ba.engineForce)&&(ba.deltaRotation=0);ba.rotation+=ba.deltaRotation;ba.deltaRotation*=
.99}};e.prototype.updateSuspension=function(){for(var U=this.chassisBody.mass,X=this.wheelInfos,Z=X.length,V=0;Z>V;V++){var ma=X[V];if(ma.isInContact){var ia=ma.suspensionStiffness*(ma.suspensionRestLength-ma.suspensionLength)*ma.clippedInvContactDotSuspension;var ja=ma.suspensionRelativeVelocity;ia-=(0>ja?ma.dampingCompression:ma.dampingRelaxation)*ja;ma.suspensionForce=ia*U;0>ma.suspensionForce&&(ma.suspensionForce=0)}else ma.suspensionForce=0}};e.prototype.removeFromWorld=function(U){this.constraints;
U.remove(this.chassisBody);U.removeEventListener("preStep",this.preStepCallback);this.world=null};var B=new q,G=new q;e.prototype.castRay=function(U){this.updateWheelTransformWorld(U);var X=this.chassisBody,Z=-1;U.directionWorld.scale(U.suspensionRestLength+U.radius,B);var V=U.chassisConnectionPointWorld;V.vadd(B,G);var ma=U.raycastResult;ma.reset();var ia=X.collisionResponse;X.collisionResponse=!1;this.world.rayTest(V,G,ma);X.collisionResponse=ia;V=ma.body;(U.raycastResult.groundObject=0,V)?(Z=ma.distance,
U.raycastResult.hitNormalWorld=ma.hitNormalWorld,U.isInContact=!0,U.suspensionLength=ma.distance-U.radius,ma=U.suspensionRestLength-U.maxSuspensionTravel,V=U.suspensionRestLength+U.maxSuspensionTravel,U.suspensionLength<ma&&(U.suspensionLength=ma),U.suspensionLength>V&&(U.suspensionLength=V,U.raycastResult.reset()),ma=U.raycastResult.hitNormalWorld.dot(U.directionWorld),V=new q,X.getVelocityAtWorldPoint(U.raycastResult.hitPointWorld,V),X=U.raycastResult.hitNormalWorld.dot(V),-.1<=ma?(U.suspensionRelativeVelocity=
0,U.clippedInvContactDotSuspension=10):(ma=-1/ma,U.suspensionRelativeVelocity=X*ma,U.clippedInvContactDotSuspension=ma)):(U.suspensionLength=U.suspensionRestLength+0*U.maxSuspensionTravel,U.suspensionRelativeVelocity=0,U.directionWorld.scale(-1,U.raycastResult.hitNormalWorld),U.clippedInvContactDotSuspension=1);return Z};e.prototype.updateWheelTransformWorld=function(U){U.isInContact=!1;var X=this.chassisBody;X.pointToWorldFrame(U.chassisConnectionPointLocal,U.chassisConnectionPointWorld);X.vectorToWorldFrame(U.directionLocal,
U.directionWorld);X.vectorToWorldFrame(U.axleLocal,U.axleWorld)};e.prototype.updateWheelTransform=function(U){U=this.wheelInfos[U];this.updateWheelTransformWorld(U);U.directionLocal.scale(-1,y);A.copy(U.axleLocal);y.cross(A,E);E.normalize();A.normalize();var X=U.steering,Z=new k;Z.setFromAxisAngle(y,X);X=new k;X.setFromAxisAngle(A,U.rotation);var V=U.worldTransform.quaternion;this.chassisBody.quaternion.mult(Z,V);V.mult(X,V);V.normalize();Z=U.worldTransform.position;Z.copy(U.directionWorld);Z.scale(U.suspensionLength,
Z);Z.vadd(U.chassisConnectionPointWorld,Z)};var I=[new q(1,0,0),new q(0,1,0),new q(0,0,1)];e.prototype.getWheelTransformWorld=function(U){return this.wheelInfos[U].worldTransform};var L=new q,T=[],n=[];e.prototype.updateFriction=function(U){for(var X=this.wheelInfos,Z=X.length,V=this.chassisBody,ma=0,ia=0;Z>ia;ia++){var ja=X[ia],ba=ja.raycastResult.body;ba&&ma++;ja.sideImpulse=0;ja.forwardImpulse=0;n[ia]||(n[ia]=new q);T[ia]||(T[ia]=new q)}for(ia=0;Z>ia;ia++)if(ja=X[ia],ba=ja.raycastResult.body){var fa=
T[ia];this.getWheelTransformWorld(ia).vectorToWorldFrame(I[this.indexRightAxis],fa);ma=ja.raycastResult.hitNormalWorld;var ka=fa.dot(ma);ma.scale(ka,L);fa.vsub(L,fa);fa.normalize();ma.cross(fa,n[ia]);n[ia].normalize();ma=ja;ka=V;var P=ja.raycastResult.hitPointWorld,Y=ja.raycastResult.hitPointWorld;if(1.1<fa.norm2())ba=0;else{var da=K,pa=N,la=S;ka.getVelocityAtWorldPoint(P,da);ba.getVelocityAtWorldPoint(Y,pa);da.vsub(pa,la);ba=-.2*fa.dot(la)*(1/(ka.invMass+ba.invMass))}ma.sideImpulse=ba;ja.sideImpulse*=
1}this.sliding=!1;for(ia=0;Z>ia;ia++){ja=X[ia];ba=ja.raycastResult.body;P=0;if(ja.slipInfo=1,ba){ma=ja.brake?ja.brake:0;pa=V;Y=ba;fa=ja.raycastResult.hitPointWorld;da=n[ia];P=ma;ka=0;la=fa;var xa=x,Ba=H,ya=f;pa.getVelocityAtWorldPoint(la,xa);Y.getVelocityAtWorldPoint(la,Ba);xa.vsub(Ba,ya);la=da.dot(ya);pa=r(pa,fa,da);Y=r(Y,fa,da);P=(ka=1/(pa+Y)*-la,ka>P&&(ka=P),-P>ka&&(ka=-P),ka);P+=ja.engineForce*U;ma/=P;ja.slipInfo*=ma}if(ja.forwardImpulse=0,ja.skidInfo=1,ba)if(ja.skidInfo=1,ba=ja.suspensionForce*
U*ja.frictionSlip,ma=ba*ba,ja.forwardImpulse=P,ka=.5*ja.forwardImpulse,P=1*ja.sideImpulse,ka=ka*ka+P*P,ja.sliding=!1,ka>ma)this.sliding=!0,ja.sliding=!0,ma=ba/Math.sqrt(ka),ja.skidInfo*=ma}if(this.sliding)for(ia=0;Z>ia;ia++)ja=X[ia],0!==ja.sideImpulse&&1>ja.skidInfo&&(ja.forwardImpulse*=ja.skidInfo,ja.sideImpulse*=ja.skidInfo);for(ia=0;Z>ia;ia++){ja=X[ia];U=new q;if(U.copy(ja.raycastResult.hitPointWorld),0!==ja.forwardImpulse)ba=new q,n[ia].scale(ja.forwardImpulse,ba),V.applyImpulse(ba,U);0!==ja.sideImpulse&&
(ba=ja.raycastResult.body,ma=new q,ma.copy(ja.raycastResult.hitPointWorld),ka=new q,T[ia].scale(ja.sideImpulse,ka),V.pointToLocalFrame(U,U),U["xyz"[this.indexUpAxis]]*=ja.rollInfluence,V.pointToWorldFrame(U,U),V.applyImpulse(ka,U),ka.scale(-1,ka),ba.applyImpulse(ka,ma))}};var x=new q,H=new q,f=new q,m=new q,v=new q,D=new q,C=new q,K=new q,N=new q,S=new q},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(h,
l){function e(E){(this.wheelBodies=[],this.coordinateSystem="undefined"==typeof E.coordinateSystem?new t(1,2,3):E.coordinateSystem.clone(),this.chassisBody=E.chassisBody,this.chassisBody)||(E=new k(new t(5,2,.5)),this.chassisBody=new r(1,E));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var r=h("./Body"),q=h("../shapes/Sphere"),k=h("../shapes/Box"),t=h("../math/Vec3"),p=h("../constraints/HingeConstraint");l.exports=e;e.prototype.addWheel=function(E){E=E||{};var B=E.body;B||(B=new r(1,
new q(1.2)));this.wheelBodies.push(B);this.wheelForces.push(0);var G=(new t,"undefined"!=typeof E.position?E.position.clone():new t),I=new t;this.chassisBody.pointToWorldFrame(G,I);B.position.set(I.x,I.y,I.z);E="undefined"!=typeof E.axis?E.axis.clone():new t(0,1,0);this.wheelAxes.push(E);B=new p(this.chassisBody,B,{pivotA:G,axisA:E,pivotB:t.ZERO,axisB:E,collideConnected:!1});return this.constraints.push(B),this.wheelBodies.length-1};e.prototype.setSteeringValue=function(E,B){var G=this.wheelAxes[B],
I=Math.cos(E);E=Math.sin(E);var L=G.x;G=G.y;this.constraints[B].axisA.set(I*L-E*G,E*L+I*G,0)};e.prototype.setMotorSpeed=function(E,B){B=this.constraints[B];B.enableMotor();B.motorTargetVelocity=E};e.prototype.disableMotor=function(E){this.constraints[E].disableMotor()};var y=new t;e.prototype.setWheelForce=function(E,B){this.wheelForces[B]=E};e.prototype.applyWheelForce=function(E,B){var G=this.wheelBodies[B],I=G.torque;this.wheelAxes[B].scale(E,y);G.vectorToWorldFrame(y,y);I.vadd(y,I)};e.prototype.addToWorld=
function(E){for(var B=this.constraints,G=this.wheelBodies.concat([this.chassisBody]),I=0;I<G.length;I++)E.add(G[I]);for(I=0;I<B.length;I++)E.addConstraint(B[I]);E.addEventListener("preStep",this._update.bind(this))};e.prototype._update=function(){for(var E=this.wheelForces,B=0;B<E.length;B++)this.applyWheelForce(E[B],B)};e.prototype.removeFromWorld=function(E){for(var B=this.constraints,G=this.wheelBodies.concat([this.chassisBody]),I=0;I<G.length;I++)E.remove(G[I]);for(I=0;I<B.length;I++)E.removeConstraint(B[I])};
var A=new t;e.prototype.getWheelSpeed=function(E){var B=this.wheelBodies[E].angularVelocity;return this.chassisBody.vectorToWorldFrame(this.wheelAxes[E],A),B.dot(A)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(h,l){function e(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}l.exports=e;l=(h("../shapes/Shape"),
h("../math/Vec3"));h("../math/Quaternion");h("../shapes/Particle");h("../objects/Body");h("../material/Material");e.prototype.add=function(E){this.particles.push(E);this.neighbors.length<this.particles.length&&this.neighbors.push([])};e.prototype.remove=function(E){E=this.particles.indexOf(E);-1!==E&&(this.particles.splice(E,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var r=new l;e.prototype.getNeighbors=function(E,B){for(var G=this.particles.length,I=E.id,L=this.smoothingRadius*
this.smoothingRadius,T=0;T!==G;T++){var n=this.particles[T];n.position.vsub(E.position,r);I!==n.id&&r.norm2()<L&&B.push(n)}};var q=new l,k=new l,t=new l,p=new l,y=new l,A=new l;e.prototype.update=function(){for(var E=this.particles.length,B=this.speedOfSound,G=this.eps,I=0;I!==E;I++){var L=this.particles[I],T=this.neighbors[I];T.length=0;this.getNeighbors(L,T);T.push(this.particles[I]);for(var n=T.length,x=0,H=0;H!==n;H++){L.position.vsub(T[H].position,q);var f=q.norm();f=this.w(f);x+=T[H].mass*f}this.densities[I]=
x;this.pressures[I]=B*B*(this.densities[I]-this.density)}for(I=0;I!==E;I++){B=this.particles[I];k.set(0,0,0);t.set(0,0,0);T=this.neighbors[I];n=T.length;for(H=0;H!==n;H++)x=T[H],B.position.vsub(x.position,y),f=y.norm(),L=-x.mass*(this.pressures[I]/(this.densities[I]*this.densities[I]+G)+this.pressures[H]/(this.densities[H]*this.densities[H]+G)),this.gradw(y,p),p.mult(L,p),k.vadd(p,k),x.velocity.vsub(B.velocity,A),A.mult(1/(1E-4+this.densities[I]*this.densities[H])*this.viscosity*x.mass,A),L=this.nablaw(f),
A.mult(L,A),t.vadd(A,t);t.mult(B.mass,t);k.mult(B.mass,k);B.force.vadd(t,B.force);B.force.vadd(k,B.force)}};e.prototype.w=function(E){var B=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(B,9))*Math.pow(B*B-E*E,3)};e.prototype.gradw=function(E,B){var G=E.norm(),I=this.smoothingRadius;E.mult(945/(32*Math.PI*Math.pow(I,9))*Math.pow(I*I-G*G,2),B)};e.prototype.nablaw=function(E){var B=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(B,9))*(B*B-E*E)*(7*E*E-3*B*B)}},{"../material/Material":25,
"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(h,l){function e(T,n,x){x=x||{};this.restLength="number"==typeof x.restLength?x.restLength:1;this.stiffness=x.stiffness||100;this.damping=x.damping||1;this.bodyA=T;this.bodyB=n;this.localAnchorA=new r;this.localAnchorB=new r;x.localAnchorA&&this.localAnchorA.copy(x.localAnchorA);x.localAnchorB&&this.localAnchorB.copy(x.localAnchorB);x.worldAnchorA&&this.setWorldAnchorA(x.worldAnchorA);
x.worldAnchorB&&this.setWorldAnchorB(x.worldAnchorB)}var r=h("../math/Vec3");l.exports=e;e.prototype.setWorldAnchorA=function(T){this.bodyA.pointToLocalFrame(T,this.localAnchorA)};e.prototype.setWorldAnchorB=function(T){this.bodyB.pointToLocalFrame(T,this.localAnchorB)};e.prototype.getWorldAnchorA=function(T){this.bodyA.pointToWorldFrame(this.localAnchorA,T)};e.prototype.getWorldAnchorB=function(T){this.bodyB.pointToWorldFrame(this.localAnchorB,T)};var q=new r,k=new r,t=new r,p=new r,y=new r,A=new r,
E=new r,B=new r,G=new r,I=new r,L=new r;e.prototype.applyForce=function(){var T=this.stiffness,n=this.damping,x=this.restLength,H=this.bodyA,f=this.bodyB;this.getWorldAnchorA(y);this.getWorldAnchorB(A);y.vsub(H.position,E);A.vsub(f.position,B);A.vsub(y,q);var m=q.norm();k.copy(q);k.normalize();f.velocity.vsub(H.velocity,t);f.angularVelocity.cross(B,L);t.vadd(L,t);H.angularVelocity.cross(E,L);t.vsub(L,t);k.mult(-T*(m-x)-n*t.dot(k),p);H.force.vsub(p,H.force);f.force.vadd(p,f.force);E.cross(p,G);B.cross(p,
I);H.torque.vsub(G,H.torque);f.torque.vadd(I,f.torque)}},{"../math/Vec3":30}],36:[function(h,l){function e(A){A=t.defaults(A,{chassisConnectionPointLocal:new r,chassisConnectionPointWorld:new r,directionLocal:new r,directionWorld:new r,axleLocal:new r,axleWorld:new r,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,
clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=A.maxSuspensionTravel;this.customSlidingRotationalSpeed=A.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=A.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=A.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=
A.chassisConnectionPointWorld.clone();this.directionLocal=A.directionLocal.clone();this.directionWorld=A.directionWorld.clone();this.axleLocal=A.axleLocal.clone();this.axleWorld=A.axleWorld.clone();this.suspensionRestLength=A.suspensionRestLength;this.suspensionMaxLength=A.suspensionMaxLength;this.radius=A.radius;this.suspensionStiffness=A.suspensionStiffness;this.dampingCompression=A.dampingCompression;this.dampingRelaxation=A.dampingRelaxation;this.frictionSlip=A.frictionSlip;this.deltaRotation=
this.rotation=this.steering=0;this.rollInfluence=A.rollInfluence;this.maxSuspensionForce=A.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=A.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new k;this.worldTransform=new q;this.isInContact=!1}var r=h("../math/Vec3"),q=h("../math/Transform"),k=h("../collision/RaycastResult"),t=h("../utils/Utils");
l.exports=e;var p=new r,y=new r;p=new r;e.prototype.updateWheel=function(A){var E=this.raycastResult;if(this.isInContact){var B=E.hitNormalWorld.dot(E.directionWorld);E.hitPointWorld.vsub(A.position,y);A.getVelocityAtWorldPoint(y,p);A=E.hitNormalWorld.dot(p);-.1<=B?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(B=-1/B,this.suspensionRelativeVelocity=A*B,this.clippedInvContactDotSuspension=B)}else E.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=
0,E.directionWorld.scale(-1,E.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(h,l){function e(y){r.call(this);this.type=r.types.BOX;this.halfExtents=y;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3"),k=h("./ConvexPolyhedron");e.prototype=new r;e.prototype.constructor=
e;e.prototype.updateConvexPolyhedronRepresentation=function(){var y=this.halfExtents.x,A=this.halfExtents.y,E=this.halfExtents.z;y=[new q(-y,-A,-E),new q(y,-A,-E),new q(y,A,-E),new q(-y,A,-E),new q(-y,-A,E),new q(y,-A,E),new q(y,A,E),new q(-y,A,E)];this.convexPolyhedronRepresentation=y=(new q(0,0,1),new q(0,1,0),new q(1,0,0),new k(y,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));y.material=this.material};e.prototype.calculateLocalInertia=function(y,A){return A=A||new q,e.calculateInertia(this.halfExtents,
y,A),A};e.calculateInertia=function(y,A,E){E.x=1/12*A*(4*y.y*y.y+4*y.z*y.z);E.y=1/12*A*(4*y.x*y.x+4*y.z*y.z);E.z=1/12*A*(4*y.y*y.y+4*y.x*y.x)};e.prototype.getSideNormals=function(y,A){var E=this.halfExtents;if(y[0].set(E.x,0,0),y[1].set(0,E.y,0),y[2].set(0,0,E.z),y[3].set(-E.x,0,0),y[4].set(0,-E.y,0),y[5].set(0,0,-E.z),void 0!==A)for(E=0;E!==y.length;E++)A.vmult(y[E],y[E]);return y};e.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};e.prototype.updateBoundingSphereRadius=
function(){this.boundingSphereRadius=this.halfExtents.norm()};var t=new q;new q;e.prototype.forEachWorldCorner=function(y,A,E){var B=this.halfExtents;B=[[B.x,B.y,B.z],[-B.x,B.y,B.z],[-B.x,-B.y,B.z],[-B.x,-B.y,-B.z],[B.x,-B.y,-B.z],[B.x,B.y,-B.z],[-B.x,B.y,-B.z],[B.x,-B.y,B.z]];for(var G=0;G<B.length;G++)t.set(B[G][0],B[G][1],B[G][2]),A.vmult(t,t),y.vadd(t,t),E(t.x,t.y,t.z)};var p=[new q,new q,new q,new q,new q,new q,new q,new q];e.prototype.calculateWorldAABB=function(y,A,E,B){var G=this.halfExtents;
p[0].set(G.x,G.y,G.z);p[1].set(-G.x,G.y,G.z);p[2].set(-G.x,-G.y,G.z);p[3].set(-G.x,-G.y,-G.z);p[4].set(G.x,-G.y,-G.z);p[5].set(G.x,G.y,-G.z);p[6].set(-G.x,G.y,-G.z);p[7].set(G.x,-G.y,G.z);var I=p[0];A.vmult(I,I);y.vadd(I,I);B.copy(I);E.copy(I);for(G=1;8>G;G++){I=p[G];A.vmult(I,I);y.vadd(I,I);var L=I.x,T=I.y;I=I.z;L>B.x&&(B.x=L);T>B.y&&(B.y=T);I>B.z&&(B.z=I);L<E.x&&(E.x=L);T<E.y&&(E.y=T);I<E.z&&(E.z=I)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(h,l){function e(ba,fa,
ka){r.call(this);this.type=r.types.CONVEXPOLYHEDRON;this.vertices=ba||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=fa||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=ka?ka.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3"),k=(h("../math/Quaternion"),h("../math/Transform"));e.prototype=new r;e.prototype.constructor=
e;var t=new q;e.prototype.computeEdges=function(){for(var ba=this.faces,fa=this.vertices,ka=(fa.length,this.uniqueEdges),P=ka.length=0;P!==ba.length;P++)for(var Y=ba[P],da=Y.length,pa=0;pa!==da;pa++){fa[Y[pa]].vsub(fa[Y[(pa+1)%da]],t);t.normalize();for(var la=!1,xa=0;xa!==ka.length;xa++)if(ka[xa].almostEquals(t)||ka[xa].almostEquals(t)){la=!0;break}la||ka.push(t.clone())}};e.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var ba=0;ba<this.faces.length;ba++){for(var fa=
0;fa<this.faces[ba].length;fa++)if(!this.vertices[this.faces[ba][fa]])throw Error("Vertex "+this.faces[ba][fa]+" not found!");fa=this.faceNormals[ba]||new q;this.getFaceNormal(ba,fa);fa.negate(fa);this.faceNormals[ba]=fa;if(0>fa.dot(this.vertices[this.faces[ba][0]]))for(console.error(".faceNormals["+ba+"] = Vec3("+fa.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),fa=0;fa<this.faces[ba].length;fa++)console.warn(".vertices["+
this.faces[ba][fa]+"] = Vec3("+this.vertices[this.faces[ba][fa]].toString()+")")}};var p=new q,y=new q;e.computeNormal=function(ba,fa,ka,P){fa.vsub(ba,y);ka.vsub(fa,p);p.cross(y,P);P.isZero()||P.normalize()};e.prototype.getFaceNormal=function(ba,fa){ba=this.faces[ba];return e.computeNormal(this.vertices[ba[0]],this.vertices[ba[1]],this.vertices[ba[2]],fa)};var A=new q;e.prototype.clipAgainstHull=function(ba,fa,ka,P,Y,da,pa,la,xa){for(var Ba=-1,ya=-Number.MAX_VALUE,Ga=0;Ga<ka.faces.length;Ga++){A.copy(ka.faceNormals[Ga]);
Y.vmult(A,A);var $a=A.dot(da);$a>ya&&(ya=$a,Ba=Ga)}ya=[];Ga=ka.faces[Ba];$a=Ga.length;for(var kb=0;$a>kb;kb++){var Ib=ka.vertices[Ga[kb]],wb=new q;wb.copy(Ib);Y.vmult(wb,wb);P.vadd(wb,wb);ya.push(wb)}0<=Ba&&this.clipFaceAgainstHull(da,ba,fa,ya,pa,la,xa)};var E=new q,B=new q,G=new q,I=new q,L=new q,T=new q;e.prototype.findSeparatingAxis=function(ba,fa,ka,P,Y,da,pa,la){var xa=Number.MAX_VALUE,Ba=0;if(this.uniqueAxes)for(var ya=0;ya!==this.uniqueAxes.length;ya++){ka.vmult(this.uniqueAxes[ya],E);var Ga=
this.testSepAxis(E,ba,fa,ka,P,Y);if(!1===Ga)return!1;xa>Ga&&(xa=Ga,da.copy(E))}else{var $a=pa?pa.length:this.faces.length;for(ya=0;$a>ya;ya++){Ga=pa?pa[ya]:ya;E.copy(this.faceNormals[Ga]);ka.vmult(E,E);Ga=this.testSepAxis(E,ba,fa,ka,P,Y);if(!1===Ga)return!1;xa>Ga&&(xa=Ga,da.copy(E))}}if(ba.uniqueAxes)for(ya=0;ya!==ba.uniqueAxes.length;ya++){Y.vmult(ba.uniqueAxes[ya],B);Ba++;Ga=this.testSepAxis(B,ba,fa,ka,P,Y);if(!1===Ga)return!1;xa>Ga&&(xa=Ga,da.copy(B))}else for(pa=la?la.length:ba.faces.length,ya=
0;pa>ya;ya++){Ga=la?la[ya]:ya;B.copy(ba.faceNormals[Ga]);Y.vmult(B,B);Ba++;Ga=this.testSepAxis(B,ba,fa,ka,P,Y);if(!1===Ga)return!1;xa>Ga&&(xa=Ga,da.copy(B))}for(la=0;la!==this.uniqueEdges.length;la++)for(ka.vmult(this.uniqueEdges[la],I),Ba=0;Ba!==ba.uniqueEdges.length;Ba++)if(Y.vmult(ba.uniqueEdges[Ba],L),I.cross(L,T),!T.almostZero()){T.normalize();ya=this.testSepAxis(T,ba,fa,ka,P,Y);if(!1===ya)return!1;xa>ya&&(xa=ya,da.copy(T))}return P.vsub(fa,G),0<G.dot(da)&&da.negate(da),!0};var n=[],x=[];e.prototype.testSepAxis=
function(ba,fa,ka,P,Y,da){e.project(this,ba,ka,P,n);e.project(fa,ba,Y,da,x);ka=n[0];ba=n[1];fa=x[0];P=x[1];if(P>ka||ba>fa)return!1;ka-=P;ba=fa-ba;return ba>ka?ka:ba};var H=new q,f=new q;e.prototype.calculateLocalInertia=function(ba,fa){this.computeLocalAABB(H,f);var ka=f.x-H.x,P=f.y-H.y,Y=f.z-H.z;fa.x=1/12*ba*(4*P*P+4*Y*Y);fa.y=1/12*ba*(4*ka*ka+4*Y*Y);fa.z=1/12*ba*(4*P*P+4*ka*ka)};e.prototype.getPlaneConstantOfFace=function(ba){return-this.faceNormals[ba].dot(this.vertices[this.faces[ba][0]])};var m=
new q,v=new q,D=new q,C=new q,K=new q,N=new q,S=new q,U=new q;e.prototype.clipFaceAgainstHull=function(ba,fa,ka,P,Y,da,pa){for(var la=[],xa=-1,Ba=Number.MAX_VALUE,ya=0;ya<this.faces.length;ya++){m.copy(this.faceNormals[ya]);ka.vmult(m,m);var Ga=m.dot(ba);Ba>Ga&&(Ba=Ga,xa=ya)}if(!(0>xa)){ba=this.faces[xa];ba.connectedFaces=[];for(Ba=0;Ba<this.faces.length;Ba++)for(ya=0;ya<this.faces[Ba].length;ya++)-1!==ba.indexOf(this.faces[Ba][ya])&&Ba!==xa&&-1===ba.connectedFaces.indexOf(Ba)&&ba.connectedFaces.push(Ba);
Ba=(P.length,ba.length);for(ya=0;Ba>ya;ya++){Ga=this.vertices[ba[ya]];Ga.vsub(this.vertices[ba[(ya+1)%Ba]],v);D.copy(v);ka.vmult(D,D);fa.vadd(D,D);C.copy(this.faceNormals[xa]);ka.vmult(C,C);fa.vadd(C,C);D.cross(C,K);K.negate(K);N.copy(Ga);ka.vmult(N,N);fa.vadd(N,N);Ga=(-N.dot(K),ba.connectedFaces[ya]);S.copy(this.faceNormals[Ga]);Ga=this.getPlaneConstantOfFace(Ga);U.copy(S);ka.vmult(U,U);Ga-=U.dot(fa);for(this.clipFaceAgainstPlane(P,la,U,Ga);P.length;)P.shift();for(;la.length;)P.push(la.shift())}S.copy(this.faceNormals[xa]);
Ga=this.getPlaneConstantOfFace(xa);U.copy(S);ka.vmult(U,U);Ga-=U.dot(fa);for(Ba=0;Ba<P.length;Ba++)if(fa=U.dot(P[Ba])+Ga,Y>=fa&&(console.log("clamped: depth="+fa+" to minDist="+(Y+"")),fa=Y),da>=fa)ka=P[Ba],0>=fa&&pa.push({point:ka,normal:U,depth:fa})}};e.prototype.clipFaceAgainstPlane=function(ba,fa,ka,P){var Y,da=ba.length;if(2>da)return fa;var pa=ba[ba.length-1],la=ba[0];var xa=ka.dot(pa)+P;for(var Ba=0;da>Ba;Ba++){if(la=ba[Ba],Y=ka.dot(la)+P,0>xa){if(0>Y){var ya=new q;ya.copy(la)}else ya=new q,
pa.lerp(la,xa/(xa-Y),ya);fa.push(ya)}else 0>Y&&(ya=new q,pa.lerp(la,xa/(xa-Y),ya),fa.push(ya),fa.push(la));pa=la;xa=Y}return fa};e.prototype.computeWorldVertices=function(ba,fa){for(var ka=this.vertices.length;this.worldVertices.length<ka;)this.worldVertices.push(new q);for(var P=this.vertices,Y=this.worldVertices,da=0;da!==ka;da++)fa.vmult(P[da],Y[da]),ba.vadd(Y[da],Y[da]);this.worldVerticesNeedsUpdate=!1};new q;e.prototype.computeLocalAABB=function(ba,fa){var ka=this.vertices.length,P=this.vertices;
ba.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);fa.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var Y=0;ka>Y;Y++){var da=P[Y];da.x<ba.x?ba.x=da.x:da.x>fa.x&&(fa.x=da.x);da.y<ba.y?ba.y=da.y:da.y>fa.y&&(fa.y=da.y);da.z<ba.z?ba.z=da.z:da.z>fa.z&&(fa.z=da.z)}};e.prototype.computeWorldFaceNormals=function(ba){for(var fa=this.faceNormals.length;this.worldFaceNormals.length<fa;)this.worldFaceNormals.push(new q);for(var ka=this.faceNormals,P=this.worldFaceNormals,Y=0;Y!==fa;Y++)ba.vmult(ka[Y],
P[Y]);this.worldFaceNormalsNeedsUpdate=!1};e.prototype.updateBoundingSphereRadius=function(){for(var ba=0,fa=this.vertices,ka=0,P=fa.length;ka!==P;ka++){var Y=fa[ka].norm2();Y>ba&&(ba=Y)}this.boundingSphereRadius=Math.sqrt(ba)};var X=new q;e.prototype.calculateWorldAABB=function(ba,fa,ka,P){for(var Y,da,pa,la,xa,Ba,ya=this.vertices.length,Ga=this.vertices,$a=0;ya>$a;$a++){X.copy(Ga[$a]);fa.vmult(X,X);ba.vadd(X,X);var kb=X;kb.x<Y||void 0===Y?Y=kb.x:(kb.x>la||void 0===la)&&(la=kb.x);kb.y<da||void 0===
da?da=kb.y:(kb.y>xa||void 0===xa)&&(xa=kb.y);kb.z<pa||void 0===pa?pa=kb.z:(kb.z>Ba||void 0===Ba)&&(Ba=kb.z)}ka.set(Y,da,pa);P.set(la,xa,Ba)};e.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};e.prototype.getAveragePointLocal=function(ba){ba=ba||new q;for(var fa=this.vertices.length,ka=this.vertices,P=0;fa>P;P++)ba.vadd(ka[P],ba);return ba.mult(1/fa,ba),ba};e.prototype.transformAllPoints=function(ba,fa){var ka=this.vertices.length,P=this.vertices;if(fa){for(var Y=0;ka>Y;Y++){var da=
P[Y];fa.vmult(da,da)}for(Y=0;Y<this.faceNormals.length;Y++)da=this.faceNormals[Y],fa.vmult(da,da)}if(ba)for(Y=0;ka>Y;Y++)da=P[Y],da.vadd(ba,da)};var Z=new q,V=new q,ma=new q;e.prototype.pointIsInside=function(ba){var fa=this.vertices,ka=this.faces,P=this.faceNormals,Y=this.faces.length;this.getAveragePointLocal(Z);for(var da=0;Y>da;da++){var pa=(this.faces[da].length,P[da]);var la=fa[ka[da][0]],xa=V;ba.vsub(la,xa);xa=pa.dot(xa);var Ba=ma;Z.vsub(la,Ba);pa=pa.dot(Ba);if(0>xa&&0<pa||0<xa&&0>pa)return!1}return-1};
var ia=(new q,new q),ja=new q;e.project=function(ba,fa,ka,P,Y){var da=ba.vertices.length;ba=ba.vertices;ja.setZero();k.vectorToLocalFrame(ka,P,fa,ia);k.pointToLocalFrame(ka,P,ja,ja);P=ja.dot(ia);ka=fa=ba[0].dot(ia);for(var pa=1;da>pa;pa++){var la=ba[pa].dot(ia);la>fa&&(fa=la);ka>la&&(ka=la)}if(ka-=P,fa-=P,ka>fa)da=ka,ka=fa,fa=da;Y[0]=fa;Y[1]=ka}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(h,l){function e(t,p,y,A){var E=[],B=[],G=[],I=[],L=[],T=Math.cos,
n=Math.sin;E.push(new q(p*T(0),p*n(0),.5*-y));I.push(0);E.push(new q(t*T(0),t*n(0),.5*y));L.push(1);for(var x=0;A>x;x++){var H=2*Math.PI/A*(x+1),f=2*Math.PI/A*(x+.5);A-1>x?(E.push(new q(p*T(H),p*n(H),.5*-y)),I.push(2*x+2),E.push(new q(t*T(H),t*n(H),.5*y)),L.push(2*x+3),G.push([2*x+2,2*x+3,2*x+1,2*x])):G.push([0,1,2*x+1,2*x]);(1===A%2||A/2>x)&&B.push(new q(T(f),n(f),0))}G.push(L);B.push(new q(0,0,1));t=[];for(x=0;x<I.length;x++)t.push(I[I.length-x-1]);G.push(t);this.type=r.types.CONVEXPOLYHEDRON;k.call(this,
E,G,B)}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3"),k=(h("../math/Quaternion"),h("./ConvexPolyhedron"));e.prototype=new k},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(h,l){function e(p,y){y=t.defaults(y,{maxValue:null,minValue:null,elementSize:1});this.data=p;this.maxValue=y.maxValue;this.minValue=y.minValue;this.elementSize=y.elementSize;null===y.minValue&&this.updateMinValue();null===y.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;
r.call(this);this.pillarConvex=new q;this.pillarOffset=new k;this.type=r.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var r=h("./Shape"),q=h("./ConvexPolyhedron"),k=h("../math/Vec3"),t=h("../utils/Utils");l.exports=e;e.prototype=new r;e.prototype.update=function(){this._cachedPillars={}};e.prototype.updateMinValue=function(){for(var p=this.data,y=p[0][0],A=0;A!==p.length;A++)for(var E=0;E!==p[A].length;E++){var B=p[A][E];y>B&&(y=B)}this.minValue=y};e.prototype.updateMaxValue=
function(){for(var p=this.data,y=p[0][0],A=0;A!==p.length;A++)for(var E=0;E!==p[A].length;E++){var B=p[A][E];B>y&&(y=B)}this.maxValue=y};e.prototype.setHeightValueAtIndex=function(p,y,A){this.data[p][y]=A;this.clearCachedConvexTrianglePillar(p,y,!1);0<p&&(this.clearCachedConvexTrianglePillar(p-1,y,!0),this.clearCachedConvexTrianglePillar(p-1,y,!1));0<y&&(this.clearCachedConvexTrianglePillar(p,y-1,!0),this.clearCachedConvexTrianglePillar(p,y-1,!1));0<y&&0<p&&this.clearCachedConvexTrianglePillar(p-
1,y-1,!0)};e.prototype.getRectMinMax=function(p,y,A,E,B){B=B||[];for(var G=this.data,I=this.minValue;A>=p;p++)for(var L=y;E>=L;L++){var T=G[p][L];T>I&&(I=T)}B[0]=this.minValue;B[1]=I};e.prototype.getIndexOfPosition=function(p,y,A,E){var B=this.elementSize,G=this.data;p=Math.floor(p/B);y=Math.floor(y/B);return A[0]=p,A[1]=y,E&&(0>p&&(p=0),0>y&&(y=0),p>=G.length-1&&(p=G.length-1),y>=G[0].length-1&&(y=G[0].length-1)),0>p||0>y||p>=G.length-1||y>=G[0].length-1?!1:!0};e.prototype.getHeightAt=function(p,
y,A){var E=[];this.getIndexOfPosition(p,y,E,A);p=[];return this.getRectMinMax(E[0],E[1]+1,E[0],E[1]+1,p),(p[0]+p[1])/2};e.prototype.getCacheConvexTrianglePillarKey=function(p,y,A){return p+"_"+y+"_"+(A?1:0)};e.prototype.getCachedConvexTrianglePillar=function(p,y,A){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(p,y,A)]};e.prototype.setCachedConvexTrianglePillar=function(p,y,A,E,B){this._cachedPillars[this.getCacheConvexTrianglePillarKey(p,y,A)]={convex:E,offset:B}};e.prototype.clearCachedConvexTrianglePillar=
function(p,y,A){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(p,y,A)]};e.prototype.getConvexTrianglePillar=function(p,y,A){var E=this.pillarConvex,B=this.pillarOffset;if(this.cacheEnabled){var G=this.getCachedConvexTrianglePillar(p,y,A);if(G)return this.pillarConvex=G.convex,void(this.pillarOffset=G.offset);E=new q;B=new k;this.pillarConvex=E;this.pillarOffset=B}G=this.data;var I=this.elementSize,L=E.faces;E.vertices.length=6;for(var T=0;6>T;T++)E.vertices[T]||(E.vertices[T]=new k);
L.length=5;for(T=0;5>T;T++)L[T]||(L[T]=[]);T=E.vertices;var n=(Math.min(G[p][y],G[p+1][y],G[p][y+1],G[p+1][y+1])-this.minValue)/2+this.minValue;A?(B.set((p+.75)*I,(y+.75)*I,n),T[0].set(.25*I,.25*I,G[p+1][y+1]-n),T[1].set(-.75*I,.25*I,G[p][y+1]-n),T[2].set(.25*I,-.75*I,G[p+1][y]-n),T[3].set(.25*I,.25*I,-n-1),T[4].set(-.75*I,.25*I,-n-1),T[5].set(.25*I,-.75*I,-n-1),L[0][0]=0,L[0][1]=1,L[0][2]=2,L[1][0]=5,L[1][1]=4,L[1][2]=3,L[2][0]=2,L[2][1]=5,L[2][2]=3,L[2][3]=0,L[3][0]=3,L[3][1]=4,L[3][2]=1,L[3][3]=
0,L[4][0]=1,L[4][1]=4,L[4][2]=5,L[4][3]=2):(B.set((p+.25)*I,(y+.25)*I,n),T[0].set(-.25*I,-.25*I,G[p][y]-n),T[1].set(.75*I,-.25*I,G[p+1][y]-n),T[2].set(-.25*I,.75*I,G[p][y+1]-n),T[3].set(-.25*I,-.25*I,-n-1),T[4].set(.75*I,-.25*I,-n-1),T[5].set(-.25*I,.75*I,-n-1),L[0][0]=0,L[0][1]=1,L[0][2]=2,L[1][0]=5,L[1][1]=4,L[1][2]=3,L[2][0]=0,L[2][1]=2,L[2][2]=5,L[2][3]=3,L[3][0]=1,L[3][1]=0,L[3][2]=3,L[3][3]=4,L[4][0]=4,L[4][1]=5,L[4][2]=2,L[4][3]=1);E.computeNormals();E.computeEdges();E.updateBoundingSphereRadius();
this.setCachedConvexTrianglePillar(p,y,A,E,B)};e.prototype.calculateLocalInertia=function(p,y){return y=y||new k,y.set(0,0,0),y};e.prototype.volume=function(){return Number.MAX_VALUE};e.prototype.calculateWorldAABB=function(p,y,A,E){A.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);E.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.prototype.updateBoundingSphereRadius=function(){var p=this.data,y=this.elementSize;this.boundingSphereRadius=(new k(p.length*y,p[0].length*y,Math.max(Math.abs(this.maxValue),
Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(h,l){function e(){r.call(this);this.type=r.types.PARTICLE}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3");e.prototype=new r;e.prototype.constructor=e;e.prototype.calculateLocalInertia=function(k,t){return t=t||new q,t.set(0,0,0),t};e.prototype.volume=function(){return 0};e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};e.prototype.calculateWorldAABB=
function(k,t,p,y){p.copy(k);y.copy(k)}},{"../math/Vec3":30,"./Shape":43}],42:[function(h,l){function e(){r.call(this);this.type=r.types.PLANE;this.worldNormal=new q;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3");e.prototype=new r;e.prototype.constructor=e;e.prototype.computeWorldNormal=function(t){var p=this.worldNormal;p.set(0,0,1);t.vmult(p,p);this.worldNormalNeedsUpdate=!1};e.prototype.calculateLocalInertia=function(t,
p){return p||new q};e.prototype.volume=function(){return Number.MAX_VALUE};var k=new q;e.prototype.calculateWorldAABB=function(t,p,y,A){k.set(0,0,1);p.vmult(k,k);p=Number.MAX_VALUE;y.set(-p,-p,-p);A.set(p,p,p);1===k.x&&(A.x=t.x);1===k.y&&(A.y=t.y);1===k.z&&(A.z=t.z);-1===k.x&&(y.x=t.x);-1===k.y&&(y.y=t.y);-1===k.z&&(y.z=t.z)};e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(h,l){function e(){this.id=e.idCounter++;
this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=null}l.exports=e;e=h("./Shape");h("../math/Vec3");h("../math/Quaternion");h("../material/Material");e.prototype.constructor=e;e.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};e.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};e.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+
this.type;};e.idCounter=0;e.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(h,l){function e(k){if(r.call(this),this.radius=void 0!==k?Number(k):1,this.type=r.types.SPHERE,0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3");e.prototype=new r;
e.prototype.constructor=e;e.prototype.calculateLocalInertia=function(k,t){t=t||new q;k=2*k*this.radius*this.radius/5;return t.x=k,t.y=k,t.z=k,t};e.prototype.volume=function(){return 4*Math.PI*this.radius/3};e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};e.prototype.calculateWorldAABB=function(k,t,p,y){t=this.radius;for(var A=["x","y","z"],E=0;E<A.length;E++){var B=A[E];p[B]=k[B]-t;y[B]=k[B]+t}}},{"../math/Vec3":30,"./Shape":43}],45:[function(h,l){function e(v,
D){r.call(this);this.type=r.types.TRIMESH;this.vertices=new Float32Array(v);this.indices=new Int16Array(D);this.normals=new Float32Array(D.length);this.aabb=new t;this.edges=null;this.scale=new q(1,1,1);this.tree=new p;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}l.exports=e;var r=h("./Shape"),q=h("../math/Vec3"),k=(h("../math/Quaternion"),h("../math/Transform")),t=h("../collision/AABB"),p=h("../utils/Octree");e.prototype=new r;e.prototype.constructor=
e;var y=new q;e.prototype.updateTree=function(){var v=this.tree;v.reset();v.aabb.copy(this.aabb);var D=this.scale;v.aabb.lowerBound.x*=1/D.x;v.aabb.lowerBound.y*=1/D.y;v.aabb.lowerBound.z*=1/D.z;v.aabb.upperBound.x*=1/D.x;v.aabb.upperBound.y*=1/D.y;v.aabb.upperBound.z*=1/D.z;D=new t;for(var C=new q,K=new q,N=new q,S=[C,K,N],U=0;U<this.indices.length/3;U++){var X=3*U;this._getUnscaledVertex(this.indices[X],C);this._getUnscaledVertex(this.indices[X+1],K);this._getUnscaledVertex(this.indices[X+2],N);
D.setFromPoints(S);v.insert(D,U)}v.removeEmptyNodes()};var A=new t;e.prototype.getTrianglesInAABB=function(v,D){A.copy(v);var C=this.scale;v=C.x;var K=C.y;C=C.z;var N=A.lowerBound,S=A.upperBound;return N.x/=v,N.y/=K,N.z/=C,S.x/=v,S.y/=K,S.z/=C,this.tree.aabbQuery(A,D)};e.prototype.setScale=function(v){var D=v.x===v.y===v.z;this.scale.x===this.scale.y===this.scale.z&&D||this.updateNormals();this.scale.copy(v);this.updateAABB();this.updateBoundingSphereRadius()};e.prototype.updateNormals=function(){for(var v=
this.normals,D=0;D<this.indices.length/3;D++){var C=3*D,K=this.indices[C+1],N=this.indices[C+2];this.getVertex(this.indices[C],L);this.getVertex(K,T);this.getVertex(N,n);e.computeNormal(T,L,n,y);v[C]=y.x;v[C+1]=y.y;v[C+2]=y.z}};e.prototype.updateEdges=function(){for(var v={},D=function(){v[S>N?N+"_"+S:S+"_"+N]=!0},C=0;C<this.indices.length/3;C++){var K=3*C,N=this.indices[K],S=this.indices[K+1];K=this.indices[K+2];D(N,S);D(S,K);D(K,N)}D=Object.keys(v);this.edges=new Int16Array(2*D.length);for(C=0;C<
D.length;C++)K=D[C].split("_"),this.edges[2*C]=parseInt(K[0],10),this.edges[2*C+1]=parseInt(K[1],10)};e.prototype.getEdgeVertex=function(v,D,C){this.getVertex(this.edges[2*v+(D?1:0)],C)};var E=new q,B=new q;e.prototype.getEdgeVector=function(v,D){this.getEdgeVertex(v,0,E);this.getEdgeVertex(v,1,B);B.vsub(E,D)};var G=new q,I=new q;e.computeNormal=function(v,D,C,K){D.vsub(v,I);C.vsub(D,G);G.cross(I,K);K.isZero()||K.normalize()};var L=new q,T=new q,n=new q;e.prototype.getVertex=function(v,D){var C=this.scale;
return this._getUnscaledVertex(v,D),D.x*=C.x,D.y*=C.y,D.z*=C.z,D};e.prototype._getUnscaledVertex=function(v,D){v*=3;var C=this.vertices;return D.set(C[v],C[v+1],C[v+2])};e.prototype.getWorldVertex=function(v,D,C,K){return this.getVertex(v,K),k.pointToWorldFrame(D,C,K,K),K};e.prototype.getTriangleVertices=function(v,D,C,K){v*=3;this.getVertex(this.indices[v],D);this.getVertex(this.indices[v+1],C);this.getVertex(this.indices[v+2],K)};e.prototype.getNormal=function(v,D){v*=3;return D.set(this.normals[v],
this.normals[v+1],this.normals[v+2])};var x=new t;e.prototype.calculateLocalInertia=function(v,D){this.computeLocalAABB(x);var C=x.upperBound.x-x.lowerBound.x,K=x.upperBound.y-x.lowerBound.y,N=x.upperBound.z-x.lowerBound.z;return D.set(1/12*v*(4*K*K+4*N*N),1/12*v*(4*C*C+4*N*N),1/12*v*(4*K*K+4*C*C))};var H=new q;e.prototype.computeLocalAABB=function(v){var D=v.lowerBound;v=v.upperBound;var C=this.vertices.length,K=(this.vertices,H);this.getVertex(0,K);D.copy(K);v.copy(K);for(var N=0;N!==C;N++)this.getVertex(N,
K),K.x<D.x?D.x=K.x:K.x>v.x&&(v.x=K.x),K.y<D.y?D.y=K.y:K.y>v.y&&(v.y=K.y),K.z<D.z?D.z=K.z:K.z>v.z&&(v.z=K.z)};e.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};e.prototype.updateBoundingSphereRadius=function(){var v=0,D=this.vertices,C=new q,K=0;for(D=D.length/3;K!==D;K++){this.getVertex(K,C);var N=C.norm2();N>v&&(v=N)}this.boundingSphereRadius=Math.sqrt(v)};var f=(new q,new k),m=new t;e.prototype.calculateWorldAABB=function(v,D,C,K){f.position=v;f.quaternion=D;this.aabb.toWorldFrame(f,
m);C.copy(m.lowerBound);K.copy(m.upperBound)};e.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};e.createTorus=function(v,D,C,K,N){v=v||1;D=D||.5;C=C||8;K=K||6;N=N||2*Math.PI;for(var S=[],U=[],X=0;C>=X;X++)for(var Z=0;K>=Z;Z++){var V=Z/K*N,ma=X/C*Math.PI*2;S.push((v+D*Math.cos(ma))*Math.cos(V),(v+D*Math.cos(ma))*Math.sin(V),D*Math.sin(ma))}for(X=1;C>=X;X++)for(Z=1;K>=Z;Z++)v=(K+1)*(X-1)+Z-1,D=(K+1)*(X-1)+Z,N=(K+1)*X+Z,U.push((K+1)*X+Z-1,v,N),U.push(v,D,N);return new e(S,U)}},
{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(h,l){function e(){r.call(this);this.iterations=10;this.tolerance=1E-7}l.exports=e;var r=(h("../math/Vec3"),h("../math/Quaternion"),h("./Solver"));e.prototype=new r;var q=[],k=[],t=[];e.prototype.solve=function(p,y){var A,E=0,B=this.iterations,G=this.tolerance*this.tolerance,I=this.equations,L=I.length;y=y.bodies;var T=y.length;if(0!==L)for(A=0;A!==T;A++)y[A].updateSolveMassProperties();
k.length=L;t.length=L;q.length=L;for(A=0;A!==L;A++){var n=I[A];q[A]=0;t[A]=n.computeB(p);k[A]=1/n.computeC()}if(0!==L){for(A=0;A!==T;A++)n=y[A],E=n.wlambda,n.vlambda.set(0,0,0),E&&E.set(0,0,0);for(E=0;E!==B;E++){for(var x=A=0;x!==L;x++){n=I[x];var H=t[x];var f=k[x];p=q[x];var m=n.computeGWlambda();H=f*(H-m-n.eps*p);p+H<n.minForce?H=n.minForce-p:p+H>n.maxForce&&(H=n.maxForce-p);q[x]+=H;A+=0<H?H:-H;n.addToWlambda(H)}if(G>A*A)break}for(A=0;A!==T;A++)n=y[A],B=n.velocity,G=n.angularVelocity,B.vadd(n.vlambda,
B),G&&G.vadd(n.wlambda,G)}return E}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(h,l){function e(){this.equations=[]}l.exports=e;e.prototype.solve=function(){return 0};e.prototype.addEquation=function(r){r.enabled&&this.equations.push(r)};e.prototype.removeEquation=function(r){var q=this.equations;r=q.indexOf(r);-1!==r&&q.splice(r,1)};e.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(h,l){function e(G){t.call(this);this.iterations=10;
this.tolerance=1E-7;this.subsolver=G;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function r(G){for(var I=G.length,L=0;L!==I;L++){var T=G[L];if(!(T.visited||T.body.type&E))return T}return!1}function q(G,I,L){I.push(G.body);I=G.eqs.length;for(var T=0;T!==I;T++){var n=G.eqs[T];-1===L.indexOf(n)&&L.push(n)}}function k(G,I){return I.id-G.id}l.exports=e;var t=(h("../math/Vec3"),h("../math/Quaternion"),h("./Solver"));h=h("../objects/Body");e.prototype=
new t;var p=[],y=[],A={bodies:[]},E=h.STATIC,B=[];e.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};e.prototype.solve=function(G,I){var L=this.nodePool,T=I.bodies,n=this.equations,x=n.length,H=T.length;for(I=this.subsolver;L.length<H;)L.push(this.createNode());p.length=H;for(var f=0;H>f;f++)p[f]=L[f];for(f=0;f!==H;f++)L=p[f],L.body=T[f],L.children.length=0,L.eqs.length=0,L.visited=!1;for(L=0;L!==x;L++){H=n[L];f=T.indexOf(H.bi);var m=T.indexOf(H.bj);f=p[f];m=p[m];f.children.push(m);
f.eqs.push(H);m.children.push(f);m.eqs.push(H)}T=0;n=y;I.tolerance=this.tolerance;for(I.iterations=this.iterations;f=r(p);){n.length=0;A.bodies.length=0;H=f;f=q;x=A.bodies;L=n;B.push(H);H.visited=!0;for(f(H,x,L);B.length;)for(m=B.pop();H=r(m.children);)H.visited=!0,f(H,x,L),B.push(H);x=n.length;n=n.sort(k);for(f=0;f!==x;f++)I.addEquation(n[f]);I.solve(G,A);I.removeAllEquations();T++}return T}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(h,l){h=function(){};
l.exports=h;h.prototype={constructor:h,addEventListener:function(e,r){void 0===this._listeners&&(this._listeners={});var q=this._listeners;return void 0===q[e]&&(q[e]=[]),-1===q[e].indexOf(r)&&q[e].push(r),this},hasEventListener:function(e,r){if(void 0===this._listeners)return!1;var q=this._listeners;return void 0!==q[e]&&-1!==q[e].indexOf(r)?!0:!1},removeEventListener:function(e,r){if(void 0===this._listeners)return this;var q=this._listeners;if(void 0===q[e])return this;r=q[e].indexOf(r);return-1!==
r&&q[e].splice(r,1),this},dispatchEvent:function(e){if(void 0===this._listeners)return this;var r=this._listeners[e.type];if(void 0!==r){e.target=this;for(var q=0,k=r.length;k>q;q++)r[q].call(this,e)}return this}}},{}],50:[function(h,l){function e(y){y=y||{};this.root=y.root||null;this.aabb=y.aabb?y.aabb.clone():new q;this.data=[];this.children=[]}function r(y,A){A=A||{};A.root=null;A.aabb=y;e.call(this,A);this.maxDepth="undefined"!=typeof A.maxDepth?A.maxDepth:8}var q=h("../collision/AABB"),k=h("../math/Vec3");
l.exports=r;r.prototype=new e;e.prototype.reset=function(){this.children.length=this.data.length=0};e.prototype.insert=function(y,A,E){var B=this.data;if(E=E||0,!this.aabb.contains(y))return!1;var G=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var I=!1;G.length||(this.subdivide(),I=!0);for(var L=0;8!==L;L++)if(G[L].insert(y,A,E+1))return!0;I&&(G.length=0)}return B.push(A),!0};var t=new k;e.prototype.subdivide=function(){var y=this.aabb,A=y.lowerBound,E=y.upperBound;y=this.children;y.push(new e({aabb:new q({lowerBound:new k(0,
0,0)})}),new e({aabb:new q({lowerBound:new k(1,0,0)})}),new e({aabb:new q({lowerBound:new k(1,1,0)})}),new e({aabb:new q({lowerBound:new k(1,1,1)})}),new e({aabb:new q({lowerBound:new k(0,1,1)})}),new e({aabb:new q({lowerBound:new k(0,0,1)})}),new e({aabb:new q({lowerBound:new k(1,0,1)})}),new e({aabb:new q({lowerBound:new k(0,1,0)})}));E.vsub(A,t);t.scale(.5,t);E=this.root||this;for(var B=0;8!==B;B++){var G=y[B];G.root=E;var I=G.aabb.lowerBound;I.x*=t.x;I.y*=t.y;I.z*=t.z;I.vadd(A,I);I.vadd(t,G.aabb.upperBound)}};
e.prototype.aabbQuery=function(y,A){for(var E=(this.data,this.children,[this]);E.length;){var B=E.pop();B.aabb.overlaps(y)&&Array.prototype.push.apply(A,B.data);Array.prototype.push.apply(E,B.children)}return A};var p=new q;e.prototype.rayQuery=function(y,A,E){return y.getAABB(p),p.toLocalFrame(A,p),this.aabbQuery(p,E),E};e.prototype.removeEmptyNodes=function(){for(var y=[this];y.length;){for(var A=y.pop(),E=A.children.length-1;0<=E;E--)A.children[E].data.length||A.children.splice(E,1);Array.prototype.push.apply(y,
A.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(h,l){function e(){this.objects=[];this.type=Object}l.exports=e;e.prototype.release=function(){for(var r=arguments.length,q=0;q!==r;q++)this.objects.push(arguments[q])};e.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};e.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(h,l){function e(){this.data=
{keys:[]}}l.exports=e;e.prototype.get=function(r,q){if(r>q){var k=q;q=r;r=k}return this.data[r+"-"+q]};e.prototype.set=function(r,q,k){if(r>q){var t=q;q=r;r=t}t=r+"-"+q;this.get(r,q)||this.data.keys.push(t);this.data[t]=k};e.prototype.reset=function(){for(var r=this.data,q=r.keys;0<q.length;){var k=q.pop();delete r[k]}}},{}],53:[function(h,l){function e(){}l.exports=e;e.defaults=function(r,q){r=r||{};for(var k in q)k in r||(r[k]=q[k]);return r}},{}],54:[function(h,l){function e(){q.call(this);this.type=
r}l.exports=e;var r=h("../math/Vec3"),q=h("./Pool");e.prototype=new q;e.prototype.constructObject=function(){return new r}},{"../math/Vec3":30,"./Pool":51}],55:[function(h,l){function e(ua){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new y;this.world=ua;this.currentContactMaterial=null;this.enableFrictionReduction=!1}l.exports=e;l=h("../collision/AABB");var r=h("../shapes/Shape"),q=h("../collision/Ray"),k=h("../math/Vec3"),t=h("../math/Transform"),
p=(h("../shapes/ConvexPolyhedron"),h("../math/Quaternion")),y=(h("../solver/Solver"),h("../utils/Vec3Pool")),A=h("../equations/ContactEquation"),E=h("../equations/FrictionEquation");e.prototype.createContactEquation=function(ua,Da,Qa,Ta,Ha,La){var Va;this.contactPointPool.length?(Va=this.contactPointPool.pop(),Va.bi=ua,Va.bj=Da):Va=new A(ua,Da);Va.enabled=ua.collisionResponse&&Da.collisionResponse&&Qa.collisionResponse&&Ta.collisionResponse;var cb=this.currentContactMaterial;Va.restitution=cb.restitution;
Va.setSpookParams(cb.contactEquationStiffness,cb.contactEquationRelaxation,this.world.dt);ua=Qa.material||ua.material;Da=Ta.material||Da.material;return ua&&Da&&0<=ua.restitution&&0<=Da.restitution&&(Va.restitution=ua.restitution*Da.restitution),Va.si=Ha||Qa,Va.sj=La||Ta,Va};e.prototype.createFrictionEquationsFromContact=function(ua,Da){var Qa=ua.bi,Ta=ua.bj,Ha=this.world,La=this.currentContactMaterial,Va=La.friction,cb=ua.si.material||Qa.material,Za=ua.sj.material||Ta.material;if(cb&&Za&&0<=cb.friction&&
0<=Za.friction&&(Va=cb.friction*Za.friction),0<Va){Va*=Ha.gravity.length();cb=Qa.invMass+Ta.invMass;0<cb&&(cb=1/cb);var Ra=this.frictionEquationPool;Za=Ra.length?Ra.pop():new E(Qa,Ta,Va*cb);Ra=Ra.length?Ra.pop():new E(Qa,Ta,Va*cb);return Za.bi=Ra.bi=Qa,Za.bj=Ra.bj=Ta,Za.minForce=Ra.minForce=-Va*cb,Za.maxForce=Ra.maxForce=Va*cb,Za.ri.copy(ua.ri),Za.rj.copy(ua.rj),Ra.ri.copy(ua.ri),Ra.rj.copy(ua.rj),ua.ni.tangents(Za.t,Ra.t),Za.setSpookParams(La.frictionEquationStiffness,La.frictionEquationRelaxation,
Ha.dt),Ra.setSpookParams(La.frictionEquationStiffness,La.frictionEquationRelaxation,Ha.dt),Za.enabled=Ra.enabled=ua.enabled,Da.push(Za,Ra),!0}return!1};var B=new k,G=new k,I=new k;e.prototype.createFrictionFromAverage=function(ua){var Da=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(Da,this.frictionResult)&&1!==ua){var Qa=this.frictionResult[this.frictionResult.length-2],Ta=this.frictionResult[this.frictionResult.length-1];B.setZero();G.setZero();I.setZero();for(var Ha=
Da.bi,La=(Da.bj,0);La!==ua;La++)Da=this.result[this.result.length-1-La],Da.bodyA!==Ha?(B.vadd(Da.ni,B),G.vadd(Da.ri,G),I.vadd(Da.rj,I)):(B.vsub(Da.ni,B),G.vadd(Da.rj,G),I.vadd(Da.ri,I));ua=1/ua;G.scale(ua,Qa.ri);I.scale(ua,Qa.rj);Ta.ri.copy(Qa.ri);Ta.rj.copy(Qa.rj);B.normalize();B.tangents(Qa.t,Ta.t)}};var L=new k,T=new k,n=new p,x=new p;e.prototype.getContacts=function(ua,Da,Qa,Ta,Ha,La,Va){this.contactPointPool=Ha;this.frictionEquationPool=Va;this.result=Ta;this.frictionResult=La;Ta=0;for(Ha=ua.length;Ta!==
Ha;Ta++){La=ua[Ta];Va=Da[Ta];var cb=null;La.material&&Va.material&&(cb=Qa.getContactMaterial(La.material,Va.material)||null);for(var Za=0;Za<La.shapes.length;Za++){La.quaternion.mult(La.shapeOrientations[Za],n);La.quaternion.vmult(La.shapeOffsets[Za],L);L.vadd(La.position,L);for(var Ra=La.shapes[Za],Ea=0;Ea<Va.shapes.length;Ea++){Va.quaternion.mult(Va.shapeOrientations[Ea],x);Va.quaternion.vmult(Va.shapeOffsets[Ea],T);T.vadd(Va.position,T);var hb=Va.shapes[Ea];if(!(L.distanceTo(T)>Ra.boundingSphereRadius+
hb.boundingSphereRadius)){var db=null;Ra.material&&hb.material&&(db=Qa.getContactMaterial(Ra.material,hb.material)||null);this.currentContactMaterial=db||cb||Qa.defaultContactMaterial;(db=this[Ra.type|hb.type])&&(Ra.type<hb.type?db.call(this,Ra,hb,L,T,n,x,La,Va,Ra,hb):db.call(this,hb,Ra,T,L,x,n,Va,La,Ra,hb))}}}}};e.prototype[r.types.BOX|r.types.BOX]=e.prototype.boxBox=function(ua,Da,Qa,Ta,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;Da.convexPolyhedronRepresentation.material=
Da.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;Da.convexPolyhedronRepresentation.collisionResponse=Da.collisionResponse;this.convexConvex(ua.convexPolyhedronRepresentation,Da.convexPolyhedronRepresentation,Qa,Ta,Ha,La,Va,cb,ua,Da)};e.prototype[r.types.BOX|r.types.CONVEXPOLYHEDRON]=e.prototype.boxConvex=function(ua,Da,Qa,Ta,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;
this.convexConvex(ua.convexPolyhedronRepresentation,Da,Qa,Ta,Ha,La,Va,cb,ua,Da)};e.prototype[r.types.BOX|r.types.PARTICLE]=e.prototype.boxParticle=function(ua,Da,Qa,Ta,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;this.convexParticle(ua.convexPolyhedronRepresentation,Da,Qa,Ta,Ha,La,Va,cb,ua,Da)};e.prototype[r.types.SPHERE]=e.prototype.sphereSphere=function(ua,Da,Qa,Ta,Ha,La,Va,cb){Ha=this.createContactEquation(Va,
cb,ua,Da);Ta.vsub(Qa,Ha.ni);Ha.ni.normalize();Ha.ri.copy(Ha.ni);Ha.rj.copy(Ha.ni);Ha.ri.mult(ua.radius,Ha.ri);Ha.rj.mult(-Da.radius,Ha.rj);Ha.ri.vadd(Qa,Ha.ri);Ha.ri.vsub(Va.position,Ha.ri);Ha.rj.vadd(Ta,Ha.rj);Ha.rj.vsub(cb.position,Ha.rj);this.result.push(Ha);this.createFrictionEquationsFromContact(Ha,this.frictionResult)};var H=new k,f=new k,m=new k;e.prototype[r.types.PLANE|r.types.TRIMESH]=e.prototype.planeTrimesh=function(ua,Da,Qa,Ta,Ha,La,Va,cb){var Za=new k;H.set(0,0,1);Ha.vmult(H,H);for(Ha=
0;Ha<Da.vertices.length/3;Ha++){Da.getVertex(Ha,Za);var Ra=new k;Ra.copy(Za);t.pointToWorldFrame(Ta,La,Ra,Za);Ra=f;Za.vsub(Qa,Ra);if(0>=H.dot(Ra)){var Ea=this.createContactEquation(Va,cb,ua,Da);Ea.ni.copy(H);var hb=m;H.scale(Ra.dot(H),hb);Za.vsub(hb,hb);Ea.ri.copy(hb);Ea.ri.vsub(Va.position,Ea.ri);Ea.rj.copy(Za);Ea.rj.vsub(cb.position,Ea.rj);this.result.push(Ea);this.createFrictionEquationsFromContact(Ea,this.frictionResult)}}};var v=new k,D=new k,C=(new k,new k),K=new k,N=new k,S=new k,U=new k,X=
new k,Z=new k,V=new k,ma=new k,ia=new k,ja=new k,ba=new l,fa=[];e.prototype[r.types.SPHERE|r.types.TRIMESH]=e.prototype.sphereTrimesh=function(ua,Da,Qa,Ta,Ha,La,Va,cb){t.pointToLocalFrame(Ta,La,Qa,Z);Ha=ua.radius;ba.lowerBound.set(Z.x-Ha,Z.y-Ha,Z.z-Ha);ba.upperBound.set(Z.x+Ha,Z.y+Ha,Z.z+Ha);Da.getTrianglesInAABB(ba,fa);var Za=ua.radius*ua.radius;for(Ha=0;Ha<fa.length;Ha++)for(var Ra=0;3>Ra;Ra++)if(Da.getVertex(Da.indices[3*fa[Ha]+Ra],C),C.vsub(Z,D),D.norm2()<=Za){K.copy(C);t.pointToWorldFrame(Ta,
La,K,C);C.vsub(Qa,D);var Ea=this.createContactEquation(Va,cb,ua,Da);Ea.ni.copy(D);Ea.ni.normalize();Ea.ri.copy(Ea.ni);Ea.ri.scale(ua.radius,Ea.ri);Ea.ri.vadd(Qa,Ea.ri);Ea.ri.vsub(Va.position,Ea.ri);Ea.rj.copy(C);Ea.rj.vsub(cb.position,Ea.rj);this.result.push(Ea);this.createFrictionEquationsFromContact(Ea,this.frictionResult)}for(Ha=0;Ha<fa.length;Ha++)for(Ra=0;3>Ra;Ra++)Da.getVertex(Da.indices[3*fa[Ha]+Ra],N),Da.getVertex(Da.indices[3*fa[Ha]+(Ra+1)%3],S),S.vsub(N,U),Z.vsub(S,V),Qa=V.dot(U),Z.vsub(N,
V),Ea=V.dot(U),0<Ea&&0>Qa&&(Z.vsub(N,V),X.copy(U),X.normalize(),Ea=V.dot(X),X.scale(Ea,V),V.vadd(N,V),Qa=V.distanceTo(Z),Qa<ua.radius&&(Ea=this.createContactEquation(Va,cb,ua,Da),V.vsub(Z,Ea.ni),Ea.ni.normalize(),Ea.ni.scale(ua.radius,Ea.ri),t.pointToWorldFrame(Ta,La,V,V),V.vsub(cb.position,Ea.rj),t.vectorToWorldFrame(La,Ea.ni,Ea.ni),t.vectorToWorldFrame(La,Ea.ri,Ea.ri),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult)));Ha=0;for(Ra=fa.length;Ha!==Ra;Ha++)if(Da.getTriangleVertices(fa[Ha],
ma,ia,ja),Da.getNormal(fa[Ha],v),Z.vsub(ma,V),Qa=V.dot(v),v.scale(Qa,V),Z.vsub(V,V),Qa=V.distanceTo(Z),q.pointInTriangle(V,ma,ia,ja)&&Qa<ua.radius)Ea=this.createContactEquation(Va,cb,ua,Da),V.vsub(Z,Ea.ni),Ea.ni.normalize(),Ea.ni.scale(ua.radius,Ea.ri),t.pointToWorldFrame(Ta,La,V,V),V.vsub(cb.position,Ea.rj),t.vectorToWorldFrame(La,Ea.ni,Ea.ni),t.vectorToWorldFrame(La,Ea.ri,Ea.ri),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult);fa.length=0};var ka=new k,P=new k;
e.prototype[r.types.SPHERE|r.types.PLANE]=e.prototype.spherePlane=function(ua,Da,Qa,Ta,Ha,La,Va,cb){Da=this.createContactEquation(Va,cb,ua,Da);if(Da.ni.set(0,0,1),La.vmult(Da.ni,Da.ni),Da.ni.negate(Da.ni),Da.ni.normalize(),Da.ni.mult(ua.radius,Da.ri),Qa.vsub(Ta,ka),Da.ni.mult(Da.ni.dot(ka),P),ka.vsub(P,Da.rj),-ka.dot(Da.ni)<=ua.radius)ua=Da.ri,La=Da.rj,ua.vadd(Qa,ua),ua.vsub(Va.position,ua),La.vadd(Ta,La),La.vsub(cb.position,La),this.result.push(Da),this.createFrictionEquationsFromContact(Da,this.frictionResult)};
var Y=new k,da=new k,pa=new k,la=new k,xa=new k,Ba=new k,ya=new k,Ga=[new k,new k,new k,new k,new k,new k],$a=new k,kb=new k,Ib=new k,wb=new k;e.prototype[r.types.SPHERE|r.types.BOX]=e.prototype.sphereBox=function(ua,Da,Qa,Ta,Ha,La,Va,cb){Ha=this.v3pool;Qa.vsub(Ta,la);Da.getSideNormals(Ga,La);La=ua.radius;for(var Za=!1,Ra=null,Ea=0,hb=0,db=0,Ab=null,Gb=0,Ob=Ga.length;Gb!==Ob&&!1===Za;Gb++){var Rb=xa;Rb.copy(Ga[Gb]);var Tb=Rb.norm();Rb.normalize();var lb=la.dot(Rb);if(Tb+La>lb&&0<lb){var $b=Ba,fc=
ya;$b.copy(Ga[(Gb+1)%3]);fc.copy(Ga[(Gb+2)%3]);var gc=$b.norm(),Kc=fc.norm();$b.normalize();fc.normalize();var qc=la.dot($b),Gc=la.dot(fc);gc>qc&&qc>-gc&&Kc>Gc&&Gc>-Kc&&(lb=Math.abs(lb-Tb-La),(null===Ab||Ab>lb)&&(Ab=lb,hb=qc,db=Gc,Ra=Tb,kb.copy(Rb),Ib.copy($b),wb.copy(fc),Ea++))}}Ea&&(Za=!0,Ea=this.createContactEquation(Va,cb,ua,Da),kb.mult(-La,Ea.ri),Ea.ni.copy(kb),Ea.ni.negate(Ea.ni),kb.mult(Ra,kb),Ib.mult(hb,Ib),kb.vadd(Ib,kb),wb.mult(db,wb),kb.vadd(wb,Ea.rj),Ea.ri.vadd(Qa,Ea.ri),Ea.ri.vsub(Va.position,
Ea.ri),Ea.rj.vadd(Ta,Ea.rj),Ea.rj.vsub(cb.position,Ea.rj),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult));lb=Ha.get();for(Ra=0;2!==Ra&&!Za;Ra++)for(hb=0;2!==hb&&!Za;hb++)for(db=0;2!==db&&!Za;db++)if(lb.set(0,0,0),Ra?lb.vadd(Ga[0],lb):lb.vsub(Ga[0],lb),hb?lb.vadd(Ga[1],lb):lb.vsub(Ga[1],lb),db?lb.vadd(Ga[2],lb):lb.vsub(Ga[2],lb),Ta.vadd(lb,$a),$a.vsub(Qa,$a),$a.norm2()<La*La)Za=!0,Ea=this.createContactEquation(Va,cb,ua,Da),Ea.ri.copy($a),Ea.ri.normalize(),Ea.ni.copy(Ea.ri),
Ea.ri.mult(La,Ea.ri),Ea.rj.copy(lb),Ea.ri.vadd(Qa,Ea.ri),Ea.ri.vsub(Va.position,Ea.ri),Ea.rj.vadd(Ta,Ea.rj),Ea.rj.vsub(cb.position,Ea.rj),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult);Ha.release(lb);Ab=Ha.get();Gb=Ha.get();Ea=Ha.get();Ob=Ha.get();lb=Ha.get();Rb=Ga.length;for(Ra=0;Ra!==Rb&&!Za;Ra++)for(hb=0;hb!==Rb&&!Za;hb++)if(Ra%3!==hb%3){Ga[hb].cross(Ga[Ra],Ab);Ab.normalize();Ga[Ra].vadd(Ga[hb],Gb);Ea.copy(Qa);Ea.vsub(Gb,Ea);Ea.vsub(Ta,Ea);Tb=Ea.dot(Ab);Ab.mult(Tb,
Ob);for(db=0;db===Ra%3||db===hb%3;)db++;lb.copy(Qa);lb.vsub(Ob,lb);lb.vsub(Gb,lb);lb.vsub(Ta,lb);Tb=Math.abs(Tb);$b=lb.norm();Tb<Ga[db].norm()&&La>$b&&(Za=!0,db=this.createContactEquation(Va,cb,ua,Da),Gb.vadd(Ob,db.rj),db.rj.copy(db.rj),lb.negate(db.ni),db.ni.normalize(),db.ri.copy(db.rj),db.ri.vadd(Ta,db.ri),db.ri.vsub(Qa,db.ri),db.ri.normalize(),db.ri.mult(La,db.ri),db.ri.vadd(Qa,db.ri),db.ri.vsub(Va.position,db.ri),db.rj.vadd(Ta,db.rj),db.rj.vsub(cb.position,db.rj),this.result.push(db),this.createFrictionEquationsFromContact(db,
this.frictionResult))}Ha.release(Ab,Gb,Ea,Ob,lb)};var Mb=new k,Pb=new k,Qb=new k,Wc=new k,cd=new k,sc=new k,wc=new k,Hd=new k,jb=new k,Xc=new k;e.prototype[r.types.SPHERE|r.types.CONVEXPOLYHEDRON]=e.prototype.sphereConvex=function(ua,Da,Qa,Ta,Ha,La,Va,cb){Ha=this.v3pool;Qa.vsub(Ta,Mb);for(var Za=Da.faceNormals,Ra=Da.faces,Ea=Da.vertices,hb=ua.radius,db=0;db!==Ea.length;db++){var Ab=cd;La.vmult(Ea[db],Ab);Ta.vadd(Ab,Ab);var Gb=Wc;if(Ab.vsub(Qa,Gb),Gb.norm2()<hb*hb)return ua=this.createContactEquation(Va,
cb,ua,Da),ua.ri.copy(Gb),ua.ri.normalize(),ua.ni.copy(ua.ri),ua.ri.mult(hb,ua.ri),Ab.vsub(Ta,ua.rj),ua.ri.vadd(Qa,ua.ri),ua.ri.vsub(Va.position,ua.ri),ua.rj.vadd(Ta,ua.rj),ua.rj.vsub(cb.position,ua.rj),this.result.push(ua),void this.createFrictionEquationsFromContact(ua,this.frictionResult)}db=0;for(Ab=Ra.length;db!==Ab;db++){Gb=Ra[db];var Ob=sc;La.vmult(Za[db],Ob);var Rb=wc;La.vmult(Ea[Gb[0]],Rb);Rb.vadd(Ta,Rb);var Tb=Hd;Ob.mult(-hb,Tb);Qa.vadd(Tb,Tb);var lb=jb;Tb.vsub(Rb,lb);Tb=lb.dot(Ob);lb=Xc;
if(Qa.vsub(Rb,lb),0>Tb&&0<lb.dot(Ob)){Rb=[];lb=0;for(var $b=Gb.length;lb!==$b;lb++){var fc=Ha.get();La.vmult(Ea[Gb[lb]],fc);Ta.vadd(fc,fc);Rb.push(fc)}a:{lb=Rb;$b=Ob;fc=Qa;for(var gc=null,Kc=lb.length,qc=0;qc!==Kc;qc++){var Gc=lb[qc],gd=Y;lb[(qc+1)%Kc].vsub(Gc,gd);var df=da;gd.cross($b,df);gd=pa;fc.vsub(Gc,gd);Gc=df.dot(gd);if(!(null===gc||0<Gc&&!0===gc||0>=Gc&&!1===gc)){lb=!1;break a}null===gc&&(gc=0<Gc)}lb=!0}if(lb){ua=this.createContactEquation(Va,cb,ua,Da);Ob.mult(-hb,ua.ri);Ob.negate(ua.ni);
Da=Ha.get();Ob.mult(-Tb,Da);La=Ha.get();Ob.mult(-hb,La);Qa.vsub(Ta,ua.rj);ua.rj.vadd(La,ua.rj);ua.rj.vadd(Da,ua.rj);ua.rj.vadd(Ta,ua.rj);ua.rj.vsub(cb.position,ua.rj);ua.ri.vadd(Qa,ua.ri);ua.ri.vsub(Va.position,ua.ri);Ha.release(Da);Ha.release(La);this.result.push(ua);this.createFrictionEquationsFromContact(ua,this.frictionResult);lb=0;for(Gb=Rb.length;lb!==Gb;lb++)Ha.release(Rb[lb]);break}for(lb=0;lb!==Gb.length;lb++){Ob=Ha.get();Tb=Ha.get();La.vmult(Ea[Gb[(lb+1)%Gb.length]],Ob);La.vmult(Ea[Gb[(lb+
2)%Gb.length]],Tb);Ta.vadd(Ob,Ob);Ta.vadd(Tb,Tb);Kc=Pb;Tb.vsub(Ob,Kc);gc=Qb;Kc.unit(gc);$b=Ha.get();fc=Ha.get();Qa.vsub(Ob,fc);qc=fc.dot(gc);gc.mult(qc,$b);$b.vadd(Ob,$b);gc=Ha.get();if($b.vsub(Qa,gc),0<qc&&qc*qc<Kc.norm2()&&gc.norm2()<hb*hb){ua=this.createContactEquation(Va,cb,ua,Da);$b.vsub(Ta,ua.rj);$b.vsub(Qa,ua.ni);ua.ni.normalize();ua.ni.mult(hb,ua.ri);ua.rj.vadd(Ta,ua.rj);ua.rj.vsub(cb.position,ua.rj);ua.ri.vadd(Qa,ua.ri);ua.ri.vsub(Va.position,ua.ri);this.result.push(ua);this.createFrictionEquationsFromContact(ua,
this.frictionResult);lb=0;for(Gb=Rb.length;lb!==Gb;lb++)Ha.release(Rb[lb]);return Ha.release(Ob),Ha.release(Tb),Ha.release($b),Ha.release(gc),void Ha.release(fc)}Ha.release(Ob);Ha.release(Tb);Ha.release($b);Ha.release(gc);Ha.release(fc)}lb=0;for(Gb=Rb.length;lb!==Gb;lb++)Ha.release(Rb[lb])}}};new k;new k;e.prototype[r.types.PLANE|r.types.BOX]=e.prototype.planeBox=function(ua,Da,Qa,Ta,Ha,La,Va,cb){Da.convexPolyhedronRepresentation.material=Da.material;Da.convexPolyhedronRepresentation.collisionResponse=
Da.collisionResponse;this.planeConvex(ua,Da.convexPolyhedronRepresentation,Qa,Ta,Ha,La,Va,cb)};var bc=new k,cc=new k,jc=new k,bb=new k;e.prototype[r.types.PLANE|r.types.CONVEXPOLYHEDRON]=e.prototype.planeConvex=function(ua,Da,Qa,Ta,Ha,La,Va,cb){cc.set(0,0,1);Ha.vmult(cc,cc);for(var Za=Ha=0;Za!==Da.vertices.length;Za++)if(bc.copy(Da.vertices[Za]),La.vmult(bc,bc),Ta.vadd(bc,bc),bc.vsub(Qa,jc),0>=cc.dot(jc)){var Ra=this.createContactEquation(Va,cb,ua,Da),Ea=bb;cc.mult(cc.dot(jc),Ea);bc.vsub(Ea,Ea);Ea.vsub(Qa,
Ra.ri);Ra.ni.copy(cc);bc.vsub(Ta,Ra.rj);Ra.ri.vadd(Qa,Ra.ri);Ra.ri.vsub(Va.position,Ra.ri);Ra.rj.vadd(Ta,Ra.rj);Ra.rj.vsub(cb.position,Ra.rj);this.result.push(Ra);Ha++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(Ra,this.frictionResult)}this.enableFrictionReduction&&Ha&&this.createFrictionFromAverage(Ha)};var Yc=new k,Oc=new k;e.prototype[r.types.CONVEXPOLYHEDRON]=e.prototype.convexConvex=function(ua,Da,Qa,Ta,Ha,La,Va,cb,Za,Ra,Ea,hb){if(!(Qa.distanceTo(Ta)>ua.boundingSphereRadius+
Da.boundingSphereRadius)&&ua.findSeparatingAxis(Da,Qa,Ha,Ta,La,Yc,Ea,hb)){Ea=[];ua.clipAgainstHull(Qa,Ha,Da,Ta,La,Yc,-100,100,Ea);for(La=Ha=0;La!==Ea.length;La++){hb=this.createContactEquation(Va,cb,ua,Da,Za,Ra);var db=hb.ri,Ab=hb.rj;Yc.negate(hb.ni);Ea[La].normal.negate(Oc);Oc.mult(Ea[La].depth,Oc);Ea[La].point.vadd(Oc,db);Ab.copy(Ea[La].point);db.vsub(Qa,db);Ab.vsub(Ta,Ab);db.vadd(Qa,db);db.vsub(Va.position,db);Ab.vadd(Ta,Ab);Ab.vsub(cb.position,Ab);this.result.push(hb);Ha++;this.enableFrictionReduction||
this.createFrictionEquationsFromContact(hb,this.frictionResult)}this.enableFrictionReduction&&Ha&&this.createFrictionFromAverage(Ha)}};var xc=new k,dd=new k,tc=new k;e.prototype[r.types.PLANE|r.types.PARTICLE]=e.prototype.planeParticle=function(ua,Da,Qa,Ta,Ha,La,Va,cb){xc.set(0,0,1);Va.quaternion.vmult(xc,xc);Ta.vsub(Va.position,dd);0>=xc.dot(dd)&&(ua=this.createContactEquation(cb,Va,Da,ua),ua.ni.copy(xc),ua.ni.negate(ua.ni),ua.ri.set(0,0,0),xc.mult(xc.dot(Ta),tc),Ta.vsub(tc,tc),ua.rj.copy(tc),this.result.push(ua),
this.createFrictionEquationsFromContact(ua,this.frictionResult))};var Ec=new k;e.prototype[r.types.PARTICLE|r.types.SPHERE]=e.prototype.sphereParticle=function(ua,Da,Qa,Ta,Ha,La,Va,cb){Ec.set(0,0,1);Ta.vsub(Qa,Ec);Ec.norm2()<=ua.radius*ua.radius&&(Da=this.createContactEquation(cb,Va,Da,ua),Ec.normalize(),Da.rj.copy(Ec),Da.rj.mult(ua.radius,Da.rj),Da.ni.copy(Ec),Da.ni.negate(Da.ni),Da.ri.set(0,0,0),this.result.push(Da),this.createFrictionEquationsFromContact(Da,this.frictionResult))};var Fc=new p,
zb=new k,Zc=(new k,new k),se=new k,tb=new k;e.prototype[r.types.PARTICLE|r.types.CONVEXPOLYHEDRON]=e.prototype.convexParticle=function(ua,Da,Qa,Ta,Ha,La,Va,cb){var Za=-1;La=null;var Ra=0;if(zb.copy(Ta),zb.vsub(Qa,zb),Ha.conjugate(Fc),Fc.vmult(zb,zb),ua.pointIsInside(zb)){ua.worldVerticesNeedsUpdate&&ua.computeWorldVertices(Qa,Ha);ua.worldFaceNormalsNeedsUpdate&&ua.computeWorldFaceNormals(Ha);Ha=0;for(var Ea=ua.faces.length;Ha!==Ea;Ha++){var hb=ua.worldFaceNormals[Ha];Ta.vsub(ua.worldVertices[ua.faces[Ha][0]],
se);var db=-hb.dot(se);(null===La||Math.abs(db)<Math.abs(La))&&(La=db,Za=Ha,Zc.copy(hb),Ra++)}-1!==Za?(ua=this.createContactEquation(cb,Va,Da,ua),Zc.mult(La,tb),tb.vadd(Ta,tb),tb.vsub(Qa,tb),ua.rj.copy(tb),Zc.negate(ua.ni),ua.ri.set(0,0,0),Da=ua.ri,La=ua.rj,Da.vadd(Ta,Da),Da.vsub(cb.position,Da),La.vadd(Qa,La),La.vsub(Va.position,La),this.result.push(ua),this.createFrictionEquationsFromContact(ua,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};
e.prototype[r.types.BOX|r.types.HEIGHTFIELD]=e.prototype.boxHeightfield=function(ua,Da,Qa,Ta,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;this.convexHeightfield(ua.convexPolyhedronRepresentation,Da,Qa,Ta,Ha,La,Va,cb)};var ob=new k,Sb=new k,Pc=[0];e.prototype[r.types.CONVEXPOLYHEDRON|r.types.HEIGHTFIELD]=e.prototype.convexHeightfield=function(ua,Da,Qa,Ta,Ha,La,Va,cb){var Za=Da.data,Ra=Da.elementSize,Ea=
ua.boundingSphereRadius;t.pointToLocalFrame(Ta,La,Qa,ob);var hb=Math.floor((ob.x-Ea)/Ra)-1,db=Math.ceil((ob.x+Ea)/Ra)+1,Ab=Math.floor((ob.y-Ea)/Ra)-1;Ra=Math.ceil((ob.y+Ea)/Ra)+1;if(!(0>db||0>Ra||hb>Za.length||Ab>Za[0].length)){0>hb&&(hb=0);0>db&&(db=0);0>Ab&&(Ab=0);0>Ra&&(Ra=0);hb>=Za.length&&(hb=Za.length-1);db>=Za.length&&(db=Za.length-1);Ra>=Za[0].length&&(Ra=Za[0].length-1);Ab>=Za[0].length&&(Ab=Za[0].length-1);Za=[];Da.getRectMinMax(hb,Ab,db,Ra,Za);var Gb=Za[0];if(!(ob.z-Ea>Za[1]||ob.z+Ea<Gb))for(Ea=
hb;db>Ea;Ea++)for(hb=Ab;Ra>hb;hb++)Da.getConvexTrianglePillar(Ea,hb,!1),t.pointToWorldFrame(Ta,La,Da.pillarOffset,Sb),Qa.distanceTo(Sb)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.convexConvex(ua,Da.pillarConvex,Qa,Sb,Ha,La,Va,cb,null,null,Pc,null),Da.getConvexTrianglePillar(Ea,hb,!0),t.pointToWorldFrame(Ta,La,Da.pillarOffset,Sb),Qa.distanceTo(Sb)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.convexConvex(ua,Da.pillarConvex,Qa,Sb,Ha,La,Va,cb,null,null,Pc,
null)}};var pc=new k,Xb=new k;e.prototype[r.types.SPHERE|r.types.HEIGHTFIELD]=e.prototype.sphereHeightfield=function(ua,Da,Qa,Ta,Ha,La,Va,cb){var Za=Da.data,Ra=ua.radius,Ea=Da.elementSize;t.pointToLocalFrame(Ta,La,Qa,pc);var hb=Math.floor((pc.x-Ra)/Ea)-1,db=Math.ceil((pc.x+Ra)/Ea)+1,Ab=Math.floor((pc.y-Ra)/Ea)-1;Ea=Math.ceil((pc.y+Ra)/Ea)+1;if(!(0>db||0>Ea||hb>Za.length||Ea>Za[0].length)){0>hb&&(hb=0);0>db&&(db=0);0>Ab&&(Ab=0);0>Ea&&(Ea=0);hb>=Za.length&&(hb=Za.length-1);db>=Za.length&&(db=Za.length-
1);Ea>=Za[0].length&&(Ea=Za[0].length-1);Ab>=Za[0].length&&(Ab=Za[0].length-1);Za=[];Da.getRectMinMax(hb,Ab,db,Ea,Za);var Gb=Za[0];if(!(pc.z-Ra>Za[1]||pc.z+Ra<Gb))for(Ra=this.result;db>hb;hb++)for(Za=Ab;Ea>Za;Za++)if(Gb=Ra.length,Da.getConvexTrianglePillar(hb,Za,!1),t.pointToWorldFrame(Ta,La,Da.pillarOffset,Xb),Qa.distanceTo(Xb)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.sphereConvex(ua,Da.pillarConvex,Qa,Xb,Ha,La,Va,cb),Da.getConvexTrianglePillar(hb,Za,!0),t.pointToWorldFrame(Ta,
La,Da.pillarOffset,Xb),Qa.distanceTo(Xb)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.sphereConvex(ua,Da.pillarConvex,Qa,Xb,Ha,La,Va,cb),2<Ra.length-Gb)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(h,l){function e(){p.apply(this);
this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new q;this.broadphase=new n;this.bodies=[];this.solver=new k;this.constraints=[];this.narrowphase=new t(this);this.collisionMatrix=new y;this.collisionMatrixPrevious=new y;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new G;this.defaultMaterial=new A("default");this.defaultContactMaterial=
new E(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null}}l.exports=e;var r=h("../shapes/Shape"),q=h("../math/Vec3");l=h("../math/Quaternion");var k=h("../solver/GSSolver"),t=(h("../utils/Vec3Pool"),h("../equations/ContactEquation"),h("../equations/FrictionEquation"),
h("./Narrowphase")),p=h("../utils/EventTarget"),y=h("../collision/ArrayCollisionMatrix"),A=h("../material/Material"),E=h("../material/ContactMaterial"),B=h("../objects/Body"),G=h("../utils/TupleDictionary"),I=h("../collision/RaycastResult"),L=h("../collision/AABB"),T=h("../collision/Ray"),n=h("../collision/NaiveBroadphase");e.prototype=new p;var x=(new L,new T);if(e.prototype.getContactMaterial=function(V,ma){return this.contactMaterialTable.get(V.id,ma.id)},e.prototype.numObjects=function(){return this.bodies.length},
e.prototype.collisionMatrixTick=function(){var V=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=V;this.collisionMatrix.reset()},e.prototype.add=e.prototype.addBody=function(V){-1===this.bodies.indexOf(V)&&(V.index=this.bodies.length,this.bodies.push(V),V.world=this,V.initPosition.copy(V.position),V.initVelocity.copy(V.velocity),V.timeLastSleepy=this.time,V instanceof B&&(V.initAngularVelocity.copy(V.angularVelocity),V.initQuaternion.copy(V.quaternion)),
this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=V,this.dispatchEvent(this.addBodyEvent))},e.prototype.addConstraint=function(V){this.constraints.push(V)},e.prototype.removeConstraint=function(V){V=this.constraints.indexOf(V);-1!==V&&this.constraints.splice(V,1)},e.prototype.rayTest=function(V,ma,ia){ia instanceof I?this.raycastClosest(V,ma,{skipBackfaces:!0},ia):this.raycastAll(V,ma,{skipBackfaces:!0},ia)},e.prototype.raycastAll=function(V,ma,ia,ja){return ia.mode=T.ALL,
ia.from=V,ia.to=ma,ia.callback=ja,x.intersectWorld(this,ia)},e.prototype.raycastAny=function(V,ma,ia,ja){return ia.mode=T.ANY,ia.from=V,ia.to=ma,ia.result=ja,x.intersectWorld(this,ia)},e.prototype.raycastClosest=function(V,ma,ia,ja){return ia.mode=T.CLOSEST,ia.from=V,ia.to=ma,ia.result=ja,x.intersectWorld(this,ia)},e.prototype.remove=function(V){V.world=null;var ma=this.bodies.length-1,ia=this.bodies,ja=ia.indexOf(V);if(-1!==ja){ia.splice(ja,1);for(ja=0;ja!==ia.length;ja++)ia[ja].index=ja;this.collisionMatrix.setNumObjects(ma);
this.removeBodyEvent.body=V;this.dispatchEvent(this.removeBodyEvent)}},e.prototype.removeBody=e.prototype.remove,e.prototype.addMaterial=function(V){this.materials.push(V)},e.prototype.addContactMaterial=function(V){this.contactmaterials.push(V);this.contactMaterialTable.set(V.materials[0].id,V.materials[1].id,V)},"undefined"==typeof performance&&(performance={}),!performance.now){var H=Date.now();performance.timing&&performance.timing.navigationStart&&(H=performance.timing.navigationStart);performance.now=
function(){return Date.now()-H}}var f=new q;e.prototype.step=function(V,ma,ia){if(ia=ia||10,ma=ma||0,0===ma)this.internalStep(V),this.time+=V;else{var ja=Math.floor((this.time+ma)/V)-Math.floor(this.time/V);ja=Math.min(ja,ia);ia=performance.now();for(var ba=0;ba!==ja&&(this.internalStep(V),!(performance.now()-ia>1E3*V));ba++);this.time+=ma;V=this.time%V/V;ma=this.bodies;for(ja=0;ja!==ma.length;ja++)ia=ma[ja],ia.type!==B.STATIC&&ia.sleepState!==B.SLEEPING?(ia.position.vsub(ia.previousPosition,f),f.scale(V,
f),ia.position.vadd(f,ia.interpolatedPosition)):(ia.interpolatedPosition.copy(ia.position),ia.interpolatedQuaternion.copy(ia.quaternion))}};var m={type:"postStep"},v={type:"preStep"},D={type:"collide",body:null,contact:null},C=[],K=[],N=[],S=[],U=(new q,new q,new q,new q,new q,new q,new q,new q,new q,new l,new l),X=new l,Z=new q;e.prototype.internalStep=function(V){this.dt=V;var ma,ia=this.contacts,ja=this.numObjects(),ba=this.bodies,fa=this.solver,ka=this.gravity,P=this.doProfiling,Y=this.profile,
da=B.DYNAMIC,pa=this.constraints,la=(ka.norm(),ka.x),xa=ka.y,Ba=ka.z;P&&(ma=performance.now());for(ka=0;ka!==ja;ka++){var ya=ba[ka];if(ya.type&da){var Ga=ya.force;ya=ya.mass;Ga.x+=ya*la;Ga.y+=ya*xa;Ga.z+=ya*Ba}}ka=0;for(ya=this.subsystems.length;ka!==ya;ka++)this.subsystems[ka].update();P&&(ma=performance.now());N.length=0;S.length=0;this.broadphase.collisionPairs(this,N,S);P&&(Y.broadphase=performance.now()-ma);ya=pa.length;for(ka=0;ka!==ya;ka++)if(la=pa[ka],!la.collideConnected)for(xa=N.length-
1;0<=xa;--xa)(la.bodyA===N[xa]&&la.bodyB===S[xa]||la.bodyB===N[xa]&&la.bodyA===S[xa])&&(N.splice(xa,1),S.splice(xa,1));this.collisionMatrixTick();P&&(ma=performance.now());ya=ia.length;for(ka=0;ka!==ya;ka++)C.push(ia[ka]);ia.length=0;ya=this.frictionEquations.length;for(ka=0;ka!==ya;ka++)K.push(this.frictionEquations[ka]);this.frictionEquations.length=0;this.narrowphase.getContacts(N,S,this,ia,C,this.frictionEquations,K);P&&(Y.narrowphase=performance.now()-ma);P&&(ma=performance.now());for(ka=0;ka<
this.frictionEquations.length;ka++)fa.addEquation(this.frictionEquations[ka]);ka=ia.length;for(xa=0;xa!==ka;xa++)la=ia[xa],ya=la.bi,Ba=la.bj,la.si,la.sj,ya.material&&Ba.material&&this.getContactMaterial(ya.material,Ba.material),(ya.material&&Ba.material&&0<=ya.material.restitution&&0<=Ba.material.restitution&&(la.restitution=ya.material.restitution*Ba.material.restitution),fa.addEquation(la),ya.allowSleep&&ya.type===B.DYNAMIC&&ya.sleepState===B.SLEEPING&&Ba.sleepState===B.AWAKE&&Ba.type!==B.STATIC)&&
Ba.velocity.norm2()+Ba.angularVelocity.norm2()>=2*Math.pow(Ba.sleepSpeedLimit,2)&&(ya._wakeUpAfterNarrowphase=!0),Ba.allowSleep&&Ba.type===B.DYNAMIC&&Ba.sleepState===B.SLEEPING&&ya.sleepState===B.AWAKE&&ya.type!==B.STATIC&&ya.velocity.norm2()+ya.angularVelocity.norm2()>=2*Math.pow(ya.sleepSpeedLimit,2)&&(Ba._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(ya,Ba,!0),this.collisionMatrixPrevious.get(ya,Ba)||(D.body=Ba,D.contact=la,ya.dispatchEvent(D),D.body=ya,Ba.dispatchEvent(D));P&&(Y.makeContactConstraints=
performance.now()-ma,ma=performance.now());for(ka=0;ka!==ja;ka++)ya=ba[ka],ya._wakeUpAfterNarrowphase&&(ya.wakeUp(),ya._wakeUpAfterNarrowphase=!1);ya=pa.length;for(ka=0;ka!==ya;ka++)for(la=pa[ka],la.update(),xa=0,ia=la.equations.length;xa!==ia;xa++)fa.addEquation(la.equations[xa]);fa.solve(V,this);P&&(Y.solve=performance.now()-ma);fa.removeAllEquations();fa=Math.pow;for(ka=0;ka!==ja;ka++)if(ya=ba[ka],ya.type&da&&(pa=fa(1-ya.linearDamping,V),ia=ya.velocity,ia.mult(pa,ia),pa=ya.angularVelocity))ia=
fa(1-ya.angularDamping,V),pa.mult(ia,pa);this.dispatchEvent(v);for(ka=0;ka!==ja;ka++)ya=ba[ka],ya.preStep&&ya.preStep.call(ya);P&&(ma=performance.now());da=B.DYNAMIC|B.KINEMATIC;fa=0===this.stepnumber%(this.quatNormalizeSkip+1);pa=this.quatNormalizeFast;ia=.5*V;r.types.PLANE;r.types.CONVEXPOLYHEDRON;for(ka=0;ka!==ja;ka++)if(ya=ba[ka],la=ya.force,xa=ya.torque,ya.type&da&&ya.sleepState!==B.SLEEPING){Ba=ya.velocity;Ga=ya.angularVelocity;var $a=ya.position,kb=ya.quaternion,Ib=ya.invMass,wb=ya.invInertiaWorld;
Ba.x+=la.x*Ib*V;Ba.y+=la.y*Ib*V;Ba.z+=la.z*Ib*V;ya.angularVelocity&&(wb.vmult(xa,Z),Z.mult(V,Z),Z.vadd(Ga,Ga));$a.x+=Ba.x*V;$a.y+=Ba.y*V;$a.z+=Ba.z*V;ya.angularVelocity&&(U.set(Ga.x,Ga.y,Ga.z,0),U.mult(kb,X),kb.x+=ia*X.x,kb.y+=ia*X.y,kb.z+=ia*X.z,kb.w+=ia*X.w,fa&&(pa?kb.normalizeFast():kb.normalize()));ya.aabb&&(ya.aabbNeedsUpdate=!0);ya.updateInertiaWorld&&ya.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;P&&(Y.integrate=performance.now()-ma);this.time+=V;this.stepnumber+=1;this.dispatchEvent(m);
for(ka=0;ka!==ja;ka++)ya=ba[ka],(V=ya.postStep)&&V.call(ya);if(this.allowSleep)for(ka=0;ka!==ja;ka++)ba[ka].sleepTick(this.time)};e.prototype.clearForces=function(){for(var V=this.bodies,ma=V.length,ia=0;ia!==ma;ia++){var ja=V[ia];ja.force;ja.torque;ja.force.set(0,0,0);ja.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});
!function(b,h,l){function e(k,t){if(!h[k]){if(!b[k]){var p="function"==typeof require&&require;if(!t&&p)return p(k,!0);if(r)return r(k,!0);throw Error("Cannot find module '"+k+"'");}t=h[k]={exports:{}};b[k][0].call(t.exports,function(y){var A=b[k][1][y];return e(A?A:y)},t,t.exports)}return h[k].exports}for(var r="function"==typeof require&&require,q=0;q<l.length;q++)e(l[q]);return e}({1:[function(b,h){var l=(b("./pointable"),b("gl-matrix")),e=l.vec3,r=l.mat3,q=l.mat4;b=(b("underscore"),h.exports=
function(k,t){this.finger=k;this._matrix=this._center=null;this.type=t.type;this.prevJoint=t.prevJoint;this.nextJoint=t.nextJoint;this.width=t.width;k=Array(3);e.sub(k,t.nextJoint,t.prevJoint);this.length=e.length(k);this.basis=t.basis});b.prototype.left=function(){return this._left?this._left:(this._left=0>r.determinant(this.basis[0].concat(this.basis[1]).concat(this.basis[2])),this._left)};b.prototype.matrix=function(){if(this._matrix)return this._matrix;var k=this.basis,t=this._matrix=q.create();
return t[0]=k[0][0],t[1]=k[0][1],t[2]=k[0][2],t[4]=k[1][0],t[5]=k[1][1],t[6]=k[1][2],t[8]=k[2][0],t[9]=k[2][1],t[10]=k[2][2],t[3]=this.center()[0],t[7]=this.center()[1],t[11]=this.center()[2],this.left()&&(t[0]*=-1,t[1]*=-1,t[2]*=-1),this._matrix};b.prototype.lerp=function(k,t){e.lerp(k,this.prevJoint,this.nextJoint,t)};b.prototype.center=function(){if(this._center)return this._center;var k=e.create();return this.lerp(k,.5),this._center=k,k};b.prototype.direction=function(){return[-1*this.basis[2][0],
-1*this.basis[2][1],-1*this.basis[2][2]]}},{"./pointable":14,"gl-matrix":23,underscore:24}],2:[function(b,h){b=h.exports=function(l){this.pos=0;this._buf=[];this.size=l};b.prototype.get=function(l){return void 0==l&&(l=0),l>=this.size?void 0:l>=this._buf.length?void 0:this._buf[(this.pos-l-1)%this.size]};b.prototype.push=function(l){return this._buf[this.pos%this.size]=l,this.pos++}},{}],3:[function(b,h){var l=b("../protocol").chooseProtocol,e=b("events").EventEmitter,r=b("underscore"),q=h.exports=
function(k){this.opts=r.defaults(k||{},{host:"127.0.0.1",enableGestures:!1,scheme:this.getScheme(),port:this.getPort(),background:!1,optimizeHMD:!1,requestProtocolVersion:q.defaultProtocolVersion});this.host=this.opts.host;this.port=this.opts.port;this.scheme=this.opts.scheme;this.protocolVersionVerified=!1;this.optimizeHMD=this.background=null;this.on("ready",function(){this.enableGestures(this.opts.enableGestures);this.setBackground(this.opts.background);this.setOptimizeHMD(this.opts.optimizeHMD);
console.log(this.opts.optimizeHMD?"Optimized for head mounted display usage.":"Optimized for desktop usage.")})};q.defaultProtocolVersion=6;q.prototype.getUrl=function(){return this.scheme+"//"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"};q.prototype.getScheme=function(){return"ws:"};q.prototype.getPort=function(){return 6437};q.prototype.setBackground=function(k){this.opts.background=k;this.protocol&&this.protocol.sendBackground&&this.background!==this.opts.background&&
(this.background=this.opts.background,this.protocol.sendBackground(this,this.opts.background))};q.prototype.setOptimizeHMD=function(k){this.opts.optimizeHMD=k;this.protocol&&this.protocol.sendOptimizeHMD&&this.optimizeHMD!==this.opts.optimizeHMD&&(this.optimizeHMD=this.opts.optimizeHMD,this.protocol.sendOptimizeHMD(this,this.opts.optimizeHMD))};q.prototype.handleOpen=function(){this.connected||(this.connected=!0,this.emit("connect"))};q.prototype.enableGestures=function(k){this.gesturesEnabled=k?
!0:!1;this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))};q.prototype.handleClose=function(k){this.connected&&(this.disconnect(),1001===k&&1<this.opts.requestProtocolVersion&&(this.protocolVersionVerified?this.protocolVersionVerified=!1:this.opts.requestProtocolVersion--),this.startReconnection())};q.prototype.startReconnection=function(){var k=this;this.reconnectionTimer||(this.reconnectionTimer=setInterval(function(){k.reconnect()},500))};q.prototype.stopReconnection=function(){this.reconnectionTimer=
clearInterval(this.reconnectionTimer)};q.prototype.disconnect=function(k){return k||this.stopReconnection(),this.socket?(this.socket.close(),delete this.socket,delete this.protocol,delete this.background,delete this.optimizeHMD,delete this.focusedState,this.connected&&(this.connected=!1,this.emit("disconnect")),!0):void 0};q.prototype.reconnect=function(){this.connected?this.stopReconnection():(this.disconnect(!0),this.connect())};q.prototype.handleData=function(k){var t;k=JSON.parse(k);void 0===
this.protocol?(t=this.protocol=l(k),this.protocolVersionVerified=!0,this.emit("ready")):t=this.protocol(k);this.emit(t.type,t)};q.prototype.connect=function(){return this.socket?void 0:(this.socket=this.setupSocket(),!0)};q.prototype.send=function(k){this.socket.send(k)};q.prototype.reportFocus=function(k){this.connected&&this.focusedState!==k&&(this.focusedState=k,this.emit(this.focusedState?"focus":"blur"),this.protocol&&this.protocol.sendFocused&&this.protocol.sendFocused(this,this.focusedState))};
r.extend(q.prototype,e.prototype)},{"../protocol":15,events:21,underscore:24}],4:[function(b,h){var l=h.exports=b("./base");b=b("underscore");h=h.exports=function(e){l.call(this,e);var r=this;this.on("ready",function(){r.startFocusLoop()});this.on("disconnect",function(){r.stopFocusLoop()})};b.extend(h.prototype,l.prototype);h.__proto__=l;h.prototype.useSecure=function(){return"https:"===location.protocol};h.prototype.getScheme=function(){return this.useSecure()?"wss:":"ws:"};h.prototype.getPort=
function(){return this.useSecure()?6436:6437};h.prototype.setupSocket=function(){var e=this,r=new WebSocket(this.getUrl());return r.onopen=function(){e.handleOpen()},r.onclose=function(q){e.handleClose(q.code,q.reason)},r.onmessage=function(q){e.handleData(q.data)},r.onerror=function(){e.useSecure()&&"wss:"===e.scheme&&(e.scheme="ws:",e.port=6437,e.disconnect(),e.connect())},r};h.prototype.startFocusLoop=function(){if(!this.focusDetectorTimer){var e=this,r=null;r="undefined"!=typeof document.hidden?
"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;void 0===e.windowVisible&&(e.windowVisible=void 0===r?!0:!1===document[r]);var q=window.addEventListener("focus",function(){e.windowVisible=!0;t()}),k=window.addEventListener("blur",function(){e.windowVisible=!1;t()});this.on("disconnect",function(){window.removeEventListener("focus",q);window.removeEventListener("blur",k)});var t=
function(){e.reportFocus((void 0===r?!0:!1===document[r])&&e.windowVisible)};t();this.focusDetectorTimer=setInterval(t,100)}};h.prototype.stopFocusLoop=function(){this.focusDetectorTimer&&(clearTimeout(this.focusDetectorTimer),delete this.focusDetectorTimer)}},{"./base":3,underscore:24}],5:[function(b,h){var l=b("__browserify_process"),e=b("./frame"),r=b("./hand"),q=b("./pointable"),k=b("./finger"),t=b("./circular_buffer"),p=b("./pipeline"),y=b("events").EventEmitter,A=b("./gesture").gestureListener,
E=b("./dialog"),B=b("underscore"),G=h.exports=function(I){var L=this;I=B.defaults(I||{},{inNode:"undefined"!=typeof l&&l.versions&&l.versions.node});this.inNode=I.inNode;I=B.defaults(I||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",suppressAnimationLoop:!this.useAnimationLoop(),loopWhileDisconnected:!0,useAllPlugins:!1,checkVersion:!0});this.animationFrameRequested=!1;this.onAnimationFrame=function(T){L.lastConnectionFrame.valid&&L.emit("animationFrame",L.lastConnectionFrame);
L.emit("frameEnd",T);L.loopWhileDisconnected&&(!1!==L.connection.focusedState||L.connection.opts.background)?window.requestAnimationFrame(L.onAnimationFrame):L.animationFrameRequested=!1};this.suppressAnimationLoop=I.suppressAnimationLoop;this.loopWhileDisconnected=I.loopWhileDisconnected;this.frameEventName=I.frameEventName;this.useAllPlugins=I.useAllPlugins;this.history=new t(200);this.lastConnectionFrame=this.lastValidFrame=this.lastFrame=e.Invalid;this.accumulatedGestures=[];this.checkVersion=
I.checkVersion;this.connectionType=void 0===I.connectionType?b(this.inBrowser()?"./connection/browser":"./connection/node"):I.connectionType;this.connection=new this.connectionType(I);this.streamingCount=0;this.devices={};this.plugins={};this._pluginPipelineSteps={};this._pluginExtendedMethods={};I.useAllPlugins&&this.useRegisteredPlugins();this.setupFrameEvents(I);this.setupConnectionEvents();this.startAnimationLoop()};G.prototype.gesture=function(I,L){I=A(this,I);return void 0!==L&&I.stop(L),I};
G.prototype.setBackground=function(I){return this.connection.setBackground(I),this};G.prototype.setOptimizeHMD=function(I){return this.connection.setOptimizeHMD(I),this};G.prototype.inBrowser=function(){return!this.inNode};G.prototype.useAnimationLoop=function(){return this.inBrowser()&&!this.inBackgroundPage()};G.prototype.inBackgroundPage=function(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===window};G.prototype.connect=
function(){return this.connection.connect(),this};G.prototype.streaming=function(){return 0<this.streamingCount};G.prototype.connected=function(){return!!this.connection.connected};G.prototype.startAnimationLoop=function(){this.suppressAnimationLoop||this.animationFrameRequested||(this.animationFrameRequested=!0,window.requestAnimationFrame(this.onAnimationFrame))};G.prototype.disconnect=function(){return this.connection.disconnect(),this};G.prototype.frame=function(I){return this.history.get(I)||
e.Invalid};G.prototype.loop=function(I){return I&&("function"==typeof I?this.on(this.frameEventName,I):this.setupFrameEvents(I)),this.connect()};G.prototype.addStep=function(I){this.pipeline||(this.pipeline=new p(this));this.pipeline.addStep(I)};G.prototype.processFrame=function(I){I.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(I.gestures));this.lastConnectionFrame=I;this.startAnimationLoop();this.emit("deviceFrame",I)};G.prototype.processFinishedFrame=function(I){if(this.lastFrame=
I,I.valid&&(this.lastValidFrame=I),I.controller=this,I.historyIdx=this.history.push(I),I.gestures){I.gestures=this.accumulatedGestures;this.accumulatedGestures=[];for(var L=0;L!=I.gestures.length;L++)this.emit("gesture",I.gestures[L],I)}this.pipeline&&(I=this.pipeline.run(I),I||(I=e.Invalid));this.emit("frame",I);this.emitHandEvents(I)};G.prototype.emitHandEvents=function(I){for(var L=0;L<I.hands.length;L++)this.emit("hand",I.hands[L])};G.prototype.setupFrameEvents=function(I){I.frame&&this.on("frame",
I.frame);I.hand&&this.on("hand",I.hand)};G.prototype.setupConnectionEvents=function(){var I=this;this.connection.on("frame",function(n){I.processFrame(n)});this.on(this.frameEventName,function(n){I.processFinishedFrame(n)});var L=function(){if(5>I.connection.opts.requestProtocolVersion&&0==I.streamingCount){I.streamingCount=1;var n={attached:!0,streaming:!0,type:"unknown",id:"Lx00000000000"};I.devices[n.id]=n;I.emit("deviceAttached",n);I.emit("deviceStreaming",n);I.emit("streamingStarted",n);I.connection.removeListener("frame",
L)}},T=function(){if(0<I.streamingCount){for(var n in I.devices)I.emit("deviceStopped",I.devices[n]),I.emit("deviceRemoved",I.devices[n]);I.emit("streamingStopped",I.devices[n]);I.streamingCount=0;for(n in I.devices)delete I.devices[n]}};this.connection.on("focus",function(){I.loopWhileDisconnected&&I.startAnimationLoop();I.emit("focus")});this.connection.on("blur",function(){I.emit("blur")});this.connection.on("protocol",function(n){n.on("beforeFrameCreated",function(x){I.emit("beforeFrameCreated",
x)});n.on("afterFrameCreated",function(x,H){I.emit("afterFrameCreated",x,H)});I.emit("protocol",n)});this.connection.on("ready",function(){I.checkVersion&&!I.inNode&&I.checkOutOfDate();I.emit("ready")});this.connection.on("connect",function(){I.emit("connect");I.connection.removeListener("frame",L);I.connection.on("frame",L)});this.connection.on("disconnect",function(){I.emit("disconnect");T()});this.connection.on("deviceConnect",function(n){n.state?(I.emit("deviceConnected"),I.connection.removeListener("frame",
L),I.connection.on("frame",L)):(I.emit("deviceDisconnected"),T())});this.connection.on("deviceEvent",function(n){n=n.state;var x=I.devices[n.id],H={},f;for(f in n)x&&x.hasOwnProperty(f)&&x[f]==n[f]||(H[f]=!0);I.devices[n.id]=n;H.attached&&I.emit(n.attached?"deviceAttached":"deviceRemoved",n);H.streaming&&(n.streaming?(I.streamingCount++,I.emit("deviceStreaming",n),1==I.streamingCount&&I.emit("streamingStarted",n),H.attached||I.emit("deviceConnected")):H.attached&&n.attached||(I.streamingCount--,I.emit("deviceStopped",
n),0==I.streamingCount&&I.emit("streamingStopped",n),I.emit("deviceDisconnected")))});this.on("newListener",function(n){"deviceConnected"!=n&&"deviceDisconnected"!=n||console.warn(n+" events are depricated.  Consider using 'streamingStarted/streamingStopped' or 'deviceStreaming/deviceStopped' instead")})};G.prototype.checkOutOfDate=function(){console.assert(this.connection&&this.connection.protocol);var I=this.connection.protocol.serviceVersion,L=this.connection.protocol.version,T=this.connectionType.defaultProtocolVersion;
return T>L?(console.warn("Your Protocol Version is v"+L+", this app was designed for v"+T),E.warnOutOfDate({sV:I,pV:L}),!0):!1};G._pluginFactories={};G.plugin=function(I,L){return this._pluginFactories[I]&&console.warn('Plugin "'+I+'" already registered'),this._pluginFactories[I]=L};G.plugins=function(){return B.keys(this._pluginFactories)};G.prototype.use=function(I,L){var T,n;if(T="function"==typeof I?I:G._pluginFactories[I],!T)throw"Leap Plugin "+I+" not found.";if(L||(L={}),this.plugins[I])return B.extend(this.plugins[I],
L),this;this.plugins[I]=L;L=T.call(this,L);for(n in L)if(T=L[n],"function"==typeof T){var x=I,H=n;-1!=["beforeFrameCreated","afterFrameCreated"].indexOf(H)?this.on(H,T):(this.pipeline||(this.pipeline=new p(this)),this._pluginPipelineSteps[x]||(this._pluginPipelineSteps[x]=[]),this._pluginPipelineSteps[x].push(this.pipeline.addWrappedStep(H,T)))}else{x=I;H=n;switch(this._pluginExtendedMethods[x]||(this._pluginExtendedMethods[x]=[]),H){case "frame":H=e;break;case "hand":H=r;break;case "pointable":H=
q;B.extend(k.prototype,T);B.extend(k.Invalid,T);break;case "finger":H=k;break;default:throw x+' specifies invalid object type "'+H+'" for prototypical extension';}B.extend(H.prototype,T);B.extend(H.Invalid,T);this._pluginExtendedMethods[x].push([H,T])}return this};G.prototype.stopUsing=function(I){var L=this._pluginPipelineSteps[I];var T=this._pluginExtendedMethods[I],n;if(this.plugins[I]){if(L)for(n=0;n<L.length;n++)this.pipeline.removeStep(L[n]);if(T)for(n=0;n<T.length;n++){L=T[n][0];var x=T[n][1];
for(var H in x)delete L.prototype[H],delete L.Invalid[H]}return delete this.plugins[I],this}};G.prototype.useRegisteredPlugins=function(){for(var I in G._pluginFactories)this.use(I)};B.extend(G.prototype,y.prototype)},{"./circular_buffer":2,"./connection/browser":4,"./connection/node":20,"./dialog":6,"./finger":7,"./frame":8,"./gesture":9,"./hand":10,"./pipeline":13,"./pointable":14,__browserify_process:22,events:21,underscore:24}],6:[function(b,h){var l=b("__browserify_process"),e=h.exports=function(r,
q){this.options=q||{};this.message=r;this.createElement()};e.prototype.createElement=function(){this.element=document.createElement("div");this.element.className="leapjs-dialog";this.element.style.position="fixed";this.element.style.top="8px";this.element.style.left=0;this.element.style.right=0;this.element.style.textAlign="center";this.element.style.zIndex=1E3;var r=document.createElement("div");this.element.appendChild(r);r.style.className="leapjs-dialog";r.style.display="inline-block";r.style.margin=
"auto";r.style.padding="8px";r.style.color="#222";r.style.background="#eee";r.style.borderRadius="4px";r.style.border="1px solid #999";r.style.textAlign="left";r.style.cursor="pointer";r.style.whiteSpace="nowrap";r.style.transition="box-shadow 1s linear";r.innerHTML=this.message;this.options.onclick&&r.addEventListener("click",this.options.onclick);this.options.onmouseover&&r.addEventListener("mouseover",this.options.onmouseover);this.options.onmouseout&&r.addEventListener("mouseout",this.options.onmouseout);
this.options.onmousemove&&r.addEventListener("mousemove",this.options.onmousemove)};e.prototype.show=function(){return document.body.appendChild(this.element),this};e.prototype.hide=function(){return document.body.removeChild(this.element),this};e.warnOutOfDate=function(r){r||(r={});var q="http://developer.leapmotion.com?";r.returnTo=window.location.href;for(var k in r)q+=k+"="+encodeURIComponent(r[k])+"&";var t;return t=new e("This site requires Leap Motion Tracking V2.<button id='leapjs-accept-upgrade'  style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 16px;'>Upgrade</button><button id='leapjs-decline-upgrade' style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 8px; '>Not Now</button>",
{onclick:function(p){"leapjs-decline-upgrade"!=p.target.id&&(p=window.open(q,"_blank","height=800,width=1000,location=1,menubar=1,resizable=1,status=1,toolbar=1,scrollbars=1"),window.focus&&p.focus());return t.hide(),!0},onmousemove:function(p){p.target==document.getElementById("leapjs-decline-upgrade")?(document.getElementById("leapjs-decline-upgrade").style.color="#000",document.getElementById("leapjs-decline-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-accept-upgrade").style.color=
"#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"):(document.getElementById("leapjs-accept-upgrade").style.color="#000",document.getElementById("leapjs-accept-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none")},onmouseout:function(){document.getElementById("leapjs-decline-upgrade").style.color="#444";document.getElementById("leapjs-decline-upgrade").style.boxShadow=
"none";document.getElementById("leapjs-accept-upgrade").style.color="#444";document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}}),t.show()};e.hasWarnedBones=!1;e.warnBones=function(){this.hasWarnedBones||(this.hasWarnedBones=!0,console.warn("Your Leap Service is out of date"),"undefined"!=typeof l&&l.versions&&l.versions.node||this.warnOutOfDate({reason:"bones"}))}},{__browserify_process:22}],7:[function(b,h){var l=b("./pointable"),e=b("./bone"),r=b("./dialog");b=b("underscore");
h=h.exports=function(q){l.call(this,q);this.dipPosition=q.dipPosition;this.pipPosition=q.pipPosition;this.mcpPosition=q.mcpPosition;this.carpPosition=q.carpPosition;this.extended=q.extended;this.type=q.type;this.finger=!0;this.positions=[this.carpPosition,this.mcpPosition,this.pipPosition,this.dipPosition,this.tipPosition];q.bases?this.addBones(q):r.warnBones()};b.extend(h.prototype,l.prototype);h.prototype.addBones=function(q){this.metacarpal=new e(this,{type:0,width:this.width,prevJoint:this.carpPosition,
nextJoint:this.mcpPosition,basis:q.bases[0]});this.proximal=new e(this,{type:1,width:this.width,prevJoint:this.mcpPosition,nextJoint:this.pipPosition,basis:q.bases[1]});this.medial=new e(this,{type:2,width:this.width,prevJoint:this.pipPosition,nextJoint:this.dipPosition,basis:q.bases[2]});this.distal=new e(this,{type:3,width:this.width,prevJoint:this.dipPosition,nextJoint:q.btipPosition,basis:q.bases[3]});this.bones=[this.metacarpal,this.proximal,this.medial,this.distal]};h.prototype.toString=function(){return"Finger [ id:"+
this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};h.Invalid={valid:!1}},{"./bone":1,"./dialog":6,"./pointable":14,underscore:24}],8:[function(b,h){var l=b("./hand"),e=b("./pointable"),r=b("./gesture").createGesture,q=b("gl-matrix"),k=q.mat3,t=q.vec3,p=b("./interaction_box"),y=b("./finger"),A=b("underscore");b=h.exports=function(E){if(this.valid=!0,this.id=E.id,this.timestamp=E.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=
[],E.interactionBox&&(this.interactionBox=new p(E.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=E.t,this._rotation=A.flatten(E.r),this._scaleFactor=E.s,this.data=E,this.type="frame",this.currentFrameRate=E.currentFrameRate,E.gestures)for(var B=0,G=E.gestures.length;B!=G;B++)this.gestures.push(r(E.gestures[B]));this.postprocessData(E)};b.prototype.postprocessData=function(E){E||(E=this.data);for(var B=0,G=E.hands.length;B!=G;B++){var I=new l(E.hands[B]);I.frame=this;this.hands.push(I);
this.handsMap[I.id]=I}E.pointables=A.sortBy(E.pointables,function(L){return L.id});B=0;for(G=E.pointables.length;B!=G;B++)I=E.pointables[B],I=I.dipPosition?new y(I):new e(I),I.frame=this,this.addPointable(I)};b.prototype.addPointable=function(E){if(this.pointables.push(E),this.pointablesMap[E.id]=E,(E.tool?this.tools:this.fingers).push(E),void 0!==E.handId&&this.handsMap.hasOwnProperty(E.handId)){var B=this.handsMap[E.handId];switch(B.pointables.push(E),(E.tool?B.tools:B.fingers).push(E),E.type){case 0:B.thumb=
E;break;case 1:B.indexFinger=E;break;case 2:B.middleFinger=E;break;case 3:B.ringFinger=E;break;case 4:B.pinky=E}}};b.prototype.tool=function(E){E=this.pointable(E);return E.tool?E:e.Invalid};b.prototype.pointable=function(E){return this.pointablesMap[E]||e.Invalid};b.prototype.finger=function(E){E=this.pointable(E);return E.tool?e.Invalid:E};b.prototype.hand=function(E){return this.handsMap[E]||l.Invalid};b.prototype.rotationAngle=function(E,B){if(!this.valid||!E.valid)return 0;var G=this.rotationMatrix(E);
G=Math.acos(.5*(G[0]+G[4]+G[8]-1));if(G=isNaN(G)?0:G,void 0!==B)E=this.rotationAxis(E),G*=t.dot(E,t.normalize(t.create(),B));return G};b.prototype.rotationAxis=function(E){return this.valid&&E.valid?t.normalize(t.create(),[this._rotation[7]-E._rotation[5],this._rotation[2]-E._rotation[6],this._rotation[3]-E._rotation[1]]):t.create()};b.prototype.rotationMatrix=function(E){if(!this.valid||!E.valid)return k.create();var B=k.transpose(k.create(),this._rotation);return k.multiply(k.create(),E._rotation,
B)};b.prototype.scaleFactor=function(E){return this.valid&&E.valid?Math.exp(this._scaleFactor-E._scaleFactor):1};b.prototype.translation=function(E){return this.valid&&E.valid?t.subtract(t.create(),this._translation,E._translation):t.create()};b.prototype.toString=function(){var E="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(E+=" | Gesture count:("+this.gestures.length+")"),E+" ]"};
b.prototype.dump=function(){var E="Frame Info:<br/>"+this.toString();E+="<br/><br/>Hands:<br/>";for(var B=0,G=this.hands.length;B!=G;B++)E+="  "+this.hands[B].toString()+"<br/>";E+="<br/><br/>Pointables:<br/>";B=0;for(G=this.pointables.length;B!=G;B++)E+="  "+this.pointables[B].toString()+"<br/>";if(this.gestures)for(E+="<br/><br/>Gestures:<br/>",B=0,G=this.gestures.length;B!=G;B++)E+="  "+this.gestures[B].toString()+"<br/>";return E+="<br/><br/>Raw JSON:<br/>",E+JSON.stringify(this.data)};b.Invalid=
{valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return e.Invalid},finger:function(){return e.Invalid},hand:function(){return l.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return k.create()},rotationAxis:function(){return t.create()},scaleFactor:function(){return 1},translation:function(){return t.create()}}},{"./finger":7,"./gesture":9,"./hand":10,"./interaction_box":12,
"./pointable":14,"gl-matrix":23,underscore:24}],9:[function(b,h,l){var e=b("gl-matrix").vec3;h=b("events").EventEmitter;var r=b("underscore"),q=(l.createGesture=function(A){switch(A.type){case "circle":var E=new k(A);break;case "swipe":E=new t(A);break;case "screenTap":E=new p(A);break;case "keyTap":E=new y(A);break;default:throw"unknown gesture type";}return E.id=A.id,E.handIds=A.handIds.slice(),E.pointableIds=A.pointableIds.slice(),E.duration=A.duration,E.state=A.state,E.type=A.type,E},l.gestureListener=
function(A,E){var B={},G={};A.on("gesture",function(L,T){if(L.type==E){if(("start"==L.state||"stop"==L.state)&&void 0===G[L.id]){var n=new q(L,T);G[L.id]=n;r.each(B,function(x,H){n.on(H,x)})}G[L.id].update(L,T);"stop"==L.state&&delete G[L.id]}});var I={start:function(L){return B.start=L,I},stop:function(L){return B.stop=L,I},complete:function(L){return B.stop=L,I},update:function(L){return B.update=L,I}};return I},l.Gesture=function(A,E){this.gestures=[A];this.frames=[E]});q.prototype.update=function(A,
E){this.lastGesture=A;this.lastFrame=E;this.gestures.push(A);this.frames.push(E);this.emit(A.state,this)};q.prototype.translation=function(){return e.subtract(e.create(),this.lastGesture.startPosition,this.lastGesture.position)};r.extend(q.prototype,h.prototype);var k=function(A){this.center=A.center;this.normal=A.normal;this.progress=A.progress;this.radius=A.radius};k.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var t=function(A){this.startPosition=A.startPosition;
this.position=A.position;this.direction=A.direction;this.speed=A.speed};t.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var p=function(A){this.position=A.position;this.direction=A.direction;this.progress=A.progress};p.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var y=function(A){this.position=A.position;this.direction=A.direction;this.progress=A.progress};y.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+
"]"}},{events:21,"gl-matrix":23,underscore:24}],10:[function(b,h){var l=b("./pointable"),e=b("./bone"),r=b("gl-matrix"),q=r.mat3,k=r.vec3,t=b("underscore");b=h.exports=function(p){this.id=p.id;this.palmPosition=p.palmPosition;this.direction=p.direction;this.palmVelocity=p.palmVelocity;this.palmNormal=p.palmNormal;this.sphereCenter=p.sphereCenter;this.sphereRadius=p.sphereRadius;this.valid=!0;this.pointables=[];this.fingers=[];this.arm=p.armBasis?new e(this,{type:4,width:p.armWidth,prevJoint:p.elbow,
nextJoint:p.wrist,basis:p.armBasis}):null;this.tools=[];this._translation=p.t;this._rotation=t.flatten(p.r);this._scaleFactor=p.s;this.timeVisible=p.timeVisible;this.stabilizedPalmPosition=p.stabilizedPalmPosition;this.type=p.type;this.grabStrength=p.grabStrength;this.pinchStrength=p.pinchStrength;this.confidence=p.confidence};b.prototype.finger=function(p){return(p=this.frame.finger(p))&&p.handId==this.id?p:l.Invalid};b.prototype.rotationAngle=function(p,y){if(!this.valid||!p.valid||!p.hand(this.id).valid)return 0;
var A=this.rotationMatrix(p);A=Math.acos(.5*(A[0]+A[4]+A[8]-1));if(A=isNaN(A)?0:A,void 0!==y)p=this.rotationAxis(p),A*=k.dot(p,k.normalize(k.create(),y));return A};b.prototype.rotationAxis=function(p){if(!this.valid||!p.valid)return k.create();p=p.hand(this.id);return p.valid?k.normalize(k.create(),[this._rotation[7]-p._rotation[5],this._rotation[2]-p._rotation[6],this._rotation[3]-p._rotation[1]]):k.create()};b.prototype.rotationMatrix=function(p){if(!this.valid||!p.valid)return q.create();p=p.hand(this.id);
if(!p.valid)return q.create();var y=q.transpose(q.create(),this._rotation);return q.multiply(q.create(),p._rotation,y)};b.prototype.scaleFactor=function(p){if(!this.valid||!p.valid)return 1;p=p.hand(this.id);return p.valid?Math.exp(this._scaleFactor-p._scaleFactor):1};b.prototype.translation=function(p){if(!this.valid||!p.valid)return k.create();p=p.hand(this.id);return p.valid?[this._translation[0]-p._translation[0],this._translation[1]-p._translation[1],this._translation[2]-p._translation[2]]:k.create()};
b.prototype.toString=function(){return"Hand ("+this.type+") [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "};b.prototype.pitch=function(){return Math.atan2(this.direction[1],-this.direction[2])};b.prototype.yaw=function(){return Math.atan2(this.direction[0],-this.direction[2])};b.prototype.roll=function(){return Math.atan2(this.palmNormal[0],-this.palmNormal[1])};b.Invalid={valid:!1,fingers:[],tools:[],pointables:[],left:!1,pointable:function(){return l.Invalid},
finger:function(){return l.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return q.create()},rotationAxis:function(){return k.create()},scaleFactor:function(){return 1},translation:function(){return k.create()}}},{"./bone":1,"./pointable":14,"gl-matrix":23,underscore:24}],11:[function(b,h){h.exports={Controller:b("./controller"),Frame:b("./frame"),Gesture:b("./gesture"),Hand:b("./hand"),Pointable:b("./pointable"),
Finger:b("./finger"),InteractionBox:b("./interaction_box"),CircularBuffer:b("./circular_buffer"),UI:b("./ui"),JSONProtocol:b("./protocol").JSONProtocol,glMatrix:b("gl-matrix"),mat3:b("gl-matrix").mat3,vec3:b("gl-matrix").vec3,loopController:void 0,version:b("./version.js"),_:b("underscore"),EventEmitter:b("events").EventEmitter,loop:function(l,e){return l&&void 0===e&&"[object Function]"==={}.toString.call(l)&&(e=l,l={}),this.loopController?l&&this.loopController.setupFrameEvents(l):this.loopController=
new this.Controller(l),this.loopController.loop(e),this.loopController},plugin:function(l,e){this.Controller.plugin(l,e)}}},{"./circular_buffer":2,"./controller":5,"./finger":7,"./frame":8,"./gesture":9,"./hand":10,"./interaction_box":12,"./pointable":14,"./protocol":15,"./ui":16,"./version.js":19,events:21,"gl-matrix":23,underscore:24}],12:[function(b,h){var l=b("gl-matrix").vec3;b=h.exports=function(e){this.valid=!0;this.center=e.center;this.size=e.size;this.width=e.size[0];this.height=e.size[1];
this.depth=e.size[2]};b.prototype.denormalizePoint=function(e){return l.fromValues((e[0]-.5)*this.size[0]+this.center[0],(e[1]-.5)*this.size[1]+this.center[1],(e[2]-.5)*this.size[2]+this.center[2])};b.prototype.normalizePoint=function(e,r){e=l.fromValues((e[0]-this.center[0])/this.size[0]+.5,(e[1]-this.center[1])/this.size[1]+.5,(e[2]-this.center[2])/this.size[2]+.5);return r&&(e[0]=Math.min(Math.max(e[0],0),1),e[1]=Math.min(Math.max(e[1],0),1),e[2]=Math.min(Math.max(e[2],0),1)),e};b.prototype.toString=
function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"};b.Invalid={valid:!1}},{"gl-matrix":23}],13:[function(b,h){b=h.exports=function(l){this.steps=[];this.controller=l};b.prototype.addStep=function(l){this.steps.push(l)};b.prototype.run=function(l){for(var e=this.steps.length,r=0;r!=e&&l;r++)l=this.steps[r](l);return l};b.prototype.removeStep=function(l){l=this.steps.indexOf(l);if(-1===l)throw"Step not found in pipeline";this.steps.splice(l,1)};
b.prototype.addWrappedStep=function(l,e){var r=this.controller,q=function(k){var t;var p="frame"==l?[k]:k[l+"s"]||[];var y=0;for(t=p.length;t>y;y++)e.call(r,p[y]);return k};return this.addStep(q),q}},{}],14:[function(b,h){b=b("gl-matrix");h=(b.vec3,h.exports=function(l){this.valid=!0;this.id=l.id;this.handId=l.handId;this.length=l.length;this.tool=l.tool;this.width=l.width;this.direction=l.direction;this.stabilizedTipPosition=l.stabilizedTipPosition;this.tipPosition=l.tipPosition;this.tipVelocity=
l.tipVelocity;this.touchZone=l.touchZone;this.touchDistance=l.touchDistance;this.timeVisible=l.timeVisible});h.prototype.toString=function(){return"Pointable [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};h.prototype.hand=function(){return this.frame.hand(this.handId)};h.Invalid={valid:!1}},{"gl-matrix":23}],15:[function(b,h,l){var e=b("./frame"),r=(b("./hand"),b("./pointable"),b("./finger"),b("underscore")),q=b("events").EventEmitter,k=function(p){this.type=
p.type;this.state=p.state};l.chooseProtocol=function(p){switch(p.version){case 1:case 2:case 3:case 4:case 5:case 6:var y=t(p);y.sendBackground=function(A,E){A.send(y.encode({background:E}))};y.sendFocused=function(A,E){A.send(y.encode({focused:E}))};y.sendOptimizeHMD=function(A,E){A.send(y.encode({optimizeHMD:E}))};break;default:throw"unrecognized version";}return y};var t=l.JSONProtocol=function(p){var y=function(A){if(A.event)return new k(A.event);y.emit("beforeFrameCreated",A);var E=new e(A);
return y.emit("afterFrameCreated",E,A),E};return y.encode=function(A){return JSON.stringify(A)},y.version=p.version,y.serviceVersion=p.serviceVersion,y.versionLong="Version "+p.version,y.type="protocol",r.extend(y,q.prototype),y}},{"./finger":7,"./frame":8,"./hand":10,"./pointable":14,events:21,underscore:24}],16:[function(b,h,l){l.UI={Region:b("./ui/region"),Cursor:b("./ui/cursor")}},{"./ui/cursor":17,"./ui/region":18}],17:[function(b,h){h.exports=function(){return function(l){var e=l.pointables.sort(function(r,
q){return r.z-q.z})[0];return e&&e.valid&&(l.cursorPosition=e.tipPosition),l}}},{}],18:[function(b,h){var l=b("events").EventEmitter;b=b("underscore");var e=h.exports=function(r,q){this.start=new Vector(r);this.end=new Vector(q);this.enteredFrame=null};e.prototype.hasPointables=function(r){for(var q=0;q!=r.pointables.length;q++){var k=r.pointables[q].tipPosition;if(k.x>=this.start.x&&k.x<=this.end.x&&k.y>=this.start.y&&k.y<=this.end.y&&k.z>=this.start.z&&k.z<=this.end.z)return!0}return!1};e.prototype.listener=
function(r){var q=this;return r&&r.nearThreshold&&this.setupNearRegion(r.nearThreshold),function(k){return q.updatePosition(k)}};e.prototype.clipper=function(){var r=this;return function(q){return r.updatePosition(q),r.enteredFrame?q:null}};e.prototype.setupNearRegion=function(r){r=this.nearRegion=new e([this.start.x-r,this.start.y-r,this.start.z-r],[this.end.x+r,this.end.y+r,this.end.z+r]);var q=this;r.on("enter",function(k){q.emit("near",k)});r.on("exit",function(k){q.emit("far",k)});q.on("exit",
function(k){q.emit("near",k)})};e.prototype.updatePosition=function(r){return this.nearRegion&&this.nearRegion.updatePosition(r),this.hasPointables(r)&&null==this.enteredFrame?(this.enteredFrame=r,this.emit("enter",this.enteredFrame)):this.hasPointables(r)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),r};e.prototype.normalize=function(r){return new Vector([(r.x-this.start.x)/(this.end.x-this.start.x),(r.y-this.start.y)/(this.end.y-this.start.y),(r.z-this.start.z)/
(this.end.z-this.start.z)])};e.prototype.mapToXY=function(r,q,k){r=this.normalize(r);var t=r.x,p=r.y;return 1<t?t=1:-1>t&&(t=-1),1<p?p=1:-1>p&&(p=-1),[(t+1)/2*q,(1-p)/2*k,r.z]};b.extend(e.prototype,l.prototype)},{events:21,underscore:24}],19:[function(b,h){h.exports={full:"0.6.4",major:0,minor:6,dot:4}},{}],20:[function(){},{}],21:[function(b,h,l){b=b("__browserify_process");b.EventEmitter||(b.EventEmitter=function(){});l=l.EventEmitter=b.EventEmitter;var e="function"==typeof Array.isArray?Array.isArray:
function(r){return"[object Array]"===Object.prototype.toString.call(r)};l.prototype.setMaxListeners=function(r){this._events||(this._events={});this._events.maxListeners=r};l.prototype.emit=function(r){if("error"===r&&(!this._events||!this._events.error||e(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var q=this._events[r];if(!q)return!1;if("function"==typeof q){switch(arguments.length){case 1:q.call(this);
break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:var k=Array.prototype.slice.call(arguments,1);q.apply(this,k)}return!0}if(e(q)){k=Array.prototype.slice.call(arguments,1);q=q.slice();for(var t=0,p=q.length;p>t;t++)q[t].apply(this,k);return!0}return!1};l.prototype.addListener=function(r,q){if("function"!=typeof q)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",r,q),this._events[r])if(e(this._events[r])){if(!this._events[r].warned){var k;
(k=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<k&&this._events[r].length>k&&(this._events[r].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[r].length),console.trace())}this._events[r].push(q)}else this._events[r]=[this._events[r],q];else this._events[r]=q;return this};l.prototype.on=l.prototype.addListener;l.prototype.once=function(r,q){var k=this;return k.on(r,
function p(){k.removeListener(r,p);q.apply(this,arguments)}),this};l.prototype.removeListener=function(r,q){if("function"!=typeof q)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[r])return this;var k=this._events[r];if(e(k)){a:if(k.indexOf)q=k.indexOf(q);else{for(var t=0;t<k.length;t++)if(q===k[t]){q=t;break a}q=-1}if(0>q)return this;k.splice(q,1);0==k.length&&delete this._events[r]}else this._events[r]===q&&delete this._events[r];return this};l.prototype.removeAllListeners=
function(r){return 0===arguments.length?(this._events={},this):(r&&this._events&&this._events[r]&&(this._events[r]=null),this)};l.prototype.listeners=function(r){return this._events||(this._events={}),this._events[r]||(this._events[r]=[]),e(this._events[r])||(this._events[r]=[this._events[r]]),this._events[r]};l.listenerCount=function(r,q){return r._events&&r._events[q]?"function"==typeof r._events[q]?1:r._events[q].length:0}},{__browserify_process:22}],22:[function(b,h){b=h.exports={};b.nextTick=
function(){if("undefined"!=typeof window&&window.setImmediate)return function(e){return window.setImmediate(e)};if("undefined"!=typeof window&&window.postMessage&&window.addEventListener){var l=[];return window.addEventListener("message",function(e){var r=e.source;(r===window||null===r)&&"process-tick"===e.data&&(e.stopPropagation(),0<l.length)&&l.shift()()},!0),function(e){l.push(e);window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}();b.title="browser";b.browser=!0;b.env=
{};b.argv=[];b.binding=function(){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(){throw Error("process.chdir is not supported");}},{}],23:[function(b,h,l){!function(e){var r;"undefined"==typeof l?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(r={},define(function(){return r})):r="undefined"!=typeof window?window:e:r=l;(function(q){if(!k)var k=1E-6;if(!t)var t="undefined"!=typeof Float32Array?Float32Array:Array;if(!p)var p=Math.random;
var y={setMatrixArrayType:function(n){t=n}};"undefined"!=typeof q&&(q.glMatrix=y);var A=Math.PI/180;y.toRadian=function(n){return n*A};var E={create:function(){var n=new t(2);return n[0]=0,n[1]=0,n},clone:function(n){var x=new t(2);return x[0]=n[0],x[1]=n[1],x},fromValues:function(n,x){var H=new t(2);return H[0]=n,H[1]=x,H},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n},set:function(n,x,H){return n[0]=x,n[1]=H,n},add:function(n,x,H){return n[0]=x[0]+H[0],n[1]=x[1]+H[1],n},subtract:function(n,x,
H){return n[0]=x[0]-H[0],n[1]=x[1]-H[1],n}};E.sub=E.subtract;E.multiply=function(n,x,H){return n[0]=x[0]*H[0],n[1]=x[1]*H[1],n};E.mul=E.multiply;E.divide=function(n,x,H){return n[0]=x[0]/H[0],n[1]=x[1]/H[1],n};E.div=E.divide;E.min=function(n,x,H){return n[0]=Math.min(x[0],H[0]),n[1]=Math.min(x[1],H[1]),n};E.max=function(n,x,H){return n[0]=Math.max(x[0],H[0]),n[1]=Math.max(x[1],H[1]),n};E.scale=function(n,x,H){return n[0]=x[0]*H,n[1]=x[1]*H,n};E.scaleAndAdd=function(n,x,H,f){return n[0]=x[0]+H[0]*
f,n[1]=x[1]+H[1]*f,n};E.distance=function(n,x){var H=x[0]-n[0];n=x[1]-n[1];return Math.sqrt(H*H+n*n)};E.dist=E.distance;E.squaredDistance=function(n,x){var H=x[0]-n[0];n=x[1]-n[1];return H*H+n*n};E.sqrDist=E.squaredDistance;E.length=function(n){var x=n[0];n=n[1];return Math.sqrt(x*x+n*n)};E.len=E.length;E.squaredLength=function(n){var x=n[0];n=n[1];return x*x+n*n};E.sqrLen=E.squaredLength;E.negate=function(n,x){return n[0]=-x[0],n[1]=-x[1],n};E.normalize=function(n,x){var H=x[0],f=x[1];H=H*H+f*f;
return 0<H&&(H=1/Math.sqrt(H),n[0]=x[0]*H,n[1]=x[1]*H),n};E.dot=function(n,x){return n[0]*x[0]+n[1]*x[1]};E.cross=function(n,x,H){x=x[0]*H[1]-x[1]*H[0];return n[0]=n[1]=0,n[2]=x,n};E.lerp=function(n,x,H,f){var m=x[0];x=x[1];return n[0]=m+f*(H[0]-m),n[1]=x+f*(H[1]-x),n};E.random=function(n,x){x=x||1;var H=2*p()*Math.PI;return n[0]=Math.cos(H)*x,n[1]=Math.sin(H)*x,n};E.transformMat2=function(n,x,H){var f=x[0];x=x[1];return n[0]=H[0]*f+H[2]*x,n[1]=H[1]*f+H[3]*x,n};E.transformMat2d=function(n,x,H){var f=
x[0];x=x[1];return n[0]=H[0]*f+H[2]*x+H[4],n[1]=H[1]*f+H[3]*x+H[5],n};E.transformMat3=function(n,x,H){var f=x[0];x=x[1];return n[0]=H[0]*f+H[3]*x+H[6],n[1]=H[1]*f+H[4]*x+H[7],n};E.transformMat4=function(n,x,H){var f=x[0];x=x[1];return n[0]=H[0]*f+H[4]*x+H[12],n[1]=H[1]*f+H[5]*x+H[13],n};E.forEach=function(){var n=E.create();return function(x,H,f,m,v,D){H||(H=2);f||(f=0);for(m=m?Math.min(m*H+f,x.length):x.length;m>f;f+=H)n[0]=x[f],n[1]=x[f+1],v(n,n,D),x[f]=n[0],x[f+1]=n[1];return x}}();E.str=function(n){return"vec2("+
n[0]+", "+n[1]+")"};"undefined"!=typeof q&&(q.vec2=E);var B={create:function(){var n=new t(3);return n[0]=0,n[1]=0,n[2]=0,n},clone:function(n){var x=new t(3);return x[0]=n[0],x[1]=n[1],x[2]=n[2],x},fromValues:function(n,x,H){var f=new t(3);return f[0]=n,f[1]=x,f[2]=H,f},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],n},set:function(n,x,H,f){return n[0]=x,n[1]=H,n[2]=f,n},add:function(n,x,H){return n[0]=x[0]+H[0],n[1]=x[1]+H[1],n[2]=x[2]+H[2],n},subtract:function(n,x,H){return n[0]=x[0]-H[0],
n[1]=x[1]-H[1],n[2]=x[2]-H[2],n}};B.sub=B.subtract;B.multiply=function(n,x,H){return n[0]=x[0]*H[0],n[1]=x[1]*H[1],n[2]=x[2]*H[2],n};B.mul=B.multiply;B.divide=function(n,x,H){return n[0]=x[0]/H[0],n[1]=x[1]/H[1],n[2]=x[2]/H[2],n};B.div=B.divide;B.min=function(n,x,H){return n[0]=Math.min(x[0],H[0]),n[1]=Math.min(x[1],H[1]),n[2]=Math.min(x[2],H[2]),n};B.max=function(n,x,H){return n[0]=Math.max(x[0],H[0]),n[1]=Math.max(x[1],H[1]),n[2]=Math.max(x[2],H[2]),n};B.scale=function(n,x,H){return n[0]=x[0]*H,
n[1]=x[1]*H,n[2]=x[2]*H,n};B.scaleAndAdd=function(n,x,H,f){return n[0]=x[0]+H[0]*f,n[1]=x[1]+H[1]*f,n[2]=x[2]+H[2]*f,n};B.distance=function(n,x){var H=x[0]-n[0],f=x[1]-n[1];n=x[2]-n[2];return Math.sqrt(H*H+f*f+n*n)};B.dist=B.distance;B.squaredDistance=function(n,x){var H=x[0]-n[0],f=x[1]-n[1];n=x[2]-n[2];return H*H+f*f+n*n};B.sqrDist=B.squaredDistance;B.length=function(n){var x=n[0],H=n[1];n=n[2];return Math.sqrt(x*x+H*H+n*n)};B.len=B.length;B.squaredLength=function(n){var x=n[0],H=n[1];n=n[2];return x*
x+H*H+n*n};B.sqrLen=B.squaredLength;B.negate=function(n,x){return n[0]=-x[0],n[1]=-x[1],n[2]=-x[2],n};B.normalize=function(n,x){var H=x[0],f=x[1],m=x[2];H=H*H+f*f+m*m;return 0<H&&(H=1/Math.sqrt(H),n[0]=x[0]*H,n[1]=x[1]*H,n[2]=x[2]*H),n};B.dot=function(n,x){return n[0]*x[0]+n[1]*x[1]+n[2]*x[2]};B.cross=function(n,x,H){var f=x[0],m=x[1];x=x[2];var v=H[0],D=H[1];H=H[2];return n[0]=m*H-x*D,n[1]=x*v-f*H,n[2]=f*D-m*v,n};B.lerp=function(n,x,H,f){var m=x[0],v=x[1];x=x[2];return n[0]=m+f*(H[0]-m),n[1]=v+f*
(H[1]-v),n[2]=x+f*(H[2]-x),n};B.random=function(n,x){x=x||1;var H=2*p()*Math.PI,f=2*p()-1,m=Math.sqrt(1-f*f)*x;return n[0]=Math.cos(H)*m,n[1]=Math.sin(H)*m,n[2]=f*x,n};B.transformMat4=function(n,x,H){var f=x[0],m=x[1];x=x[2];return n[0]=H[0]*f+H[4]*m+H[8]*x+H[12],n[1]=H[1]*f+H[5]*m+H[9]*x+H[13],n[2]=H[2]*f+H[6]*m+H[10]*x+H[14],n};B.transformMat3=function(n,x,H){var f=x[0],m=x[1];x=x[2];return n[0]=f*H[0]+m*H[3]+x*H[6],n[1]=f*H[1]+m*H[4]+x*H[7],n[2]=f*H[2]+m*H[5]+x*H[8],n};B.transformQuat=function(n,
x,H){var f=x[0],m=x[1],v=x[2];x=H[0];var D=H[1],C=H[2];H=H[3];var K=H*f+D*v-C*m,N=H*m+C*f-x*v,S=H*v+x*m-D*f;f=-x*f-D*m-C*v;return n[0]=K*H+f*-x+N*-C-S*-D,n[1]=N*H+f*-D+S*-x-K*-C,n[2]=S*H+f*-C+K*-D-N*-x,n};B.rotateX=function(n,x,H,f){var m=[],v=[];return m[0]=x[0]-H[0],m[1]=x[1]-H[1],m[2]=x[2]-H[2],v[0]=m[0],v[1]=m[1]*Math.cos(f)-m[2]*Math.sin(f),v[2]=m[1]*Math.sin(f)+m[2]*Math.cos(f),n[0]=v[0]+H[0],n[1]=v[1]+H[1],n[2]=v[2]+H[2],n};B.rotateY=function(n,x,H,f){var m=[],v=[];return m[0]=x[0]-H[0],m[1]=
x[1]-H[1],m[2]=x[2]-H[2],v[0]=m[2]*Math.sin(f)+m[0]*Math.cos(f),v[1]=m[1],v[2]=m[2]*Math.cos(f)-m[0]*Math.sin(f),n[0]=v[0]+H[0],n[1]=v[1]+H[1],n[2]=v[2]+H[2],n};B.rotateZ=function(n,x,H,f){var m=[],v=[];return m[0]=x[0]-H[0],m[1]=x[1]-H[1],m[2]=x[2]-H[2],v[0]=m[0]*Math.cos(f)-m[1]*Math.sin(f),v[1]=m[0]*Math.sin(f)+m[1]*Math.cos(f),v[2]=m[2],n[0]=v[0]+H[0],n[1]=v[1]+H[1],n[2]=v[2]+H[2],n};B.forEach=function(){var n=B.create();return function(x,H,f,m,v,D){H||(H=3);f||(f=0);for(m=m?Math.min(m*H+f,x.length):
x.length;m>f;f+=H)n[0]=x[f],n[1]=x[f+1],n[2]=x[f+2],v(n,n,D),x[f]=n[0],x[f+1]=n[1],x[f+2]=n[2];return x}}();B.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"};"undefined"!=typeof q&&(q.vec3=B);var G={create:function(){var n=new t(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},clone:function(n){var x=new t(4);return x[0]=n[0],x[1]=n[1],x[2]=n[2],x[3]=n[3],x},fromValues:function(n,x,H,f){var m=new t(4);return m[0]=n,m[1]=x,m[2]=H,m[3]=f,m},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],
n[3]=x[3],n},set:function(n,x,H,f,m){return n[0]=x,n[1]=H,n[2]=f,n[3]=m,n},add:function(n,x,H){return n[0]=x[0]+H[0],n[1]=x[1]+H[1],n[2]=x[2]+H[2],n[3]=x[3]+H[3],n},subtract:function(n,x,H){return n[0]=x[0]-H[0],n[1]=x[1]-H[1],n[2]=x[2]-H[2],n[3]=x[3]-H[3],n}};G.sub=G.subtract;G.multiply=function(n,x,H){return n[0]=x[0]*H[0],n[1]=x[1]*H[1],n[2]=x[2]*H[2],n[3]=x[3]*H[3],n};G.mul=G.multiply;G.divide=function(n,x,H){return n[0]=x[0]/H[0],n[1]=x[1]/H[1],n[2]=x[2]/H[2],n[3]=x[3]/H[3],n};G.div=G.divide;
G.min=function(n,x,H){return n[0]=Math.min(x[0],H[0]),n[1]=Math.min(x[1],H[1]),n[2]=Math.min(x[2],H[2]),n[3]=Math.min(x[3],H[3]),n};G.max=function(n,x,H){return n[0]=Math.max(x[0],H[0]),n[1]=Math.max(x[1],H[1]),n[2]=Math.max(x[2],H[2]),n[3]=Math.max(x[3],H[3]),n};G.scale=function(n,x,H){return n[0]=x[0]*H,n[1]=x[1]*H,n[2]=x[2]*H,n[3]=x[3]*H,n};G.scaleAndAdd=function(n,x,H,f){return n[0]=x[0]+H[0]*f,n[1]=x[1]+H[1]*f,n[2]=x[2]+H[2]*f,n[3]=x[3]+H[3]*f,n};G.distance=function(n,x){var H=x[0]-n[0],f=x[1]-
n[1],m=x[2]-n[2];n=x[3]-n[3];return Math.sqrt(H*H+f*f+m*m+n*n)};G.dist=G.distance;G.squaredDistance=function(n,x){var H=x[0]-n[0],f=x[1]-n[1],m=x[2]-n[2];n=x[3]-n[3];return H*H+f*f+m*m+n*n};G.sqrDist=G.squaredDistance;G.length=function(n){var x=n[0],H=n[1],f=n[2];n=n[3];return Math.sqrt(x*x+H*H+f*f+n*n)};G.len=G.length;G.squaredLength=function(n){var x=n[0],H=n[1],f=n[2];n=n[3];return x*x+H*H+f*f+n*n};G.sqrLen=G.squaredLength;G.negate=function(n,x){return n[0]=-x[0],n[1]=-x[1],n[2]=-x[2],n[3]=-x[3],
n};G.normalize=function(n,x){var H=x[0],f=x[1],m=x[2],v=x[3];H=H*H+f*f+m*m+v*v;return 0<H&&(H=1/Math.sqrt(H),n[0]=x[0]*H,n[1]=x[1]*H,n[2]=x[2]*H,n[3]=x[3]*H),n};G.dot=function(n,x){return n[0]*x[0]+n[1]*x[1]+n[2]*x[2]+n[3]*x[3]};G.lerp=function(n,x,H,f){var m=x[0],v=x[1],D=x[2];x=x[3];return n[0]=m+f*(H[0]-m),n[1]=v+f*(H[1]-v),n[2]=D+f*(H[2]-D),n[3]=x+f*(H[3]-x),n};G.random=function(n,x){return x=x||1,n[0]=p(),n[1]=p(),n[2]=p(),n[3]=p(),G.normalize(n,n),G.scale(n,n,x),n};G.transformMat4=function(n,
x,H){var f=x[0],m=x[1],v=x[2];x=x[3];return n[0]=H[0]*f+H[4]*m+H[8]*v+H[12]*x,n[1]=H[1]*f+H[5]*m+H[9]*v+H[13]*x,n[2]=H[2]*f+H[6]*m+H[10]*v+H[14]*x,n[3]=H[3]*f+H[7]*m+H[11]*v+H[15]*x,n};G.transformQuat=function(n,x,H){var f=x[0],m=x[1],v=x[2];x=H[0];var D=H[1],C=H[2];H=H[3];var K=H*f+D*v-C*m,N=H*m+C*f-x*v,S=H*v+x*m-D*f;f=-x*f-D*m-C*v;return n[0]=K*H+f*-x+N*-C-S*-D,n[1]=N*H+f*-D+S*-x-K*-C,n[2]=S*H+f*-C+K*-D-N*-x,n};G.forEach=function(){var n=G.create();return function(x,H,f,m,v,D){H||(H=4);f||(f=0);
for(m=m?Math.min(m*H+f,x.length):x.length;m>f;f+=H)n[0]=x[f],n[1]=x[f+1],n[2]=x[f+2],n[3]=x[f+3],v(n,n,D),x[f]=n[0],x[f+1]=n[1],x[f+2]=n[2],x[f+3]=n[3];return x}}();G.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};"undefined"!=typeof q&&(q.vec4=G);y={create:function(){var n=new t(4);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},clone:function(n){var x=new t(4);return x[0]=n[0],x[1]=n[1],x[2]=n[2],x[3]=n[3],x},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],n[3]=x[3],n},identity:function(n){return n[0]=
1,n[1]=0,n[2]=0,n[3]=1,n},transpose:function(n,x){if(n===x){var H=x[1];n[1]=x[2];n[2]=H}else n[0]=x[0],n[1]=x[2],n[2]=x[1],n[3]=x[3];return n},invert:function(n,x){var H=x[0],f=x[1],m=x[2];x=x[3];var v=H*x-m*f;return v?(v=1/v,n[0]=x*v,n[1]=-f*v,n[2]=-m*v,n[3]=H*v,n):null},adjoint:function(n,x){var H=x[0];return n[0]=x[3],n[1]=-x[1],n[2]=-x[2],n[3]=H,n},determinant:function(n){return n[0]*n[3]-n[2]*n[1]},multiply:function(n,x,H){var f=x[0],m=x[1],v=x[2];x=x[3];var D=H[0],C=H[1],K=H[2];H=H[3];return n[0]=
f*D+v*C,n[1]=m*D+x*C,n[2]=f*K+v*H,n[3]=m*K+x*H,n}};y.mul=y.multiply;y.rotate=function(n,x,H){var f=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(H);H=Math.cos(H);return n[0]=f*H+v*D,n[1]=m*H+x*D,n[2]=f*-D+v*H,n[3]=m*-D+x*H,n};y.scale=function(n,x,H){var f=x[1],m=x[2],v=x[3],D=H[0];H=H[1];return n[0]=x[0]*D,n[1]=f*D,n[2]=m*H,n[3]=v*H,n};y.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};y.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],
2))};y.LDU=function(n,x,H,f){return n[2]=f[2]/f[0],H[0]=f[0],H[1]=f[1],H[3]=f[3]-n[2]*H[1],[n,x,H]};"undefined"!=typeof q&&(q.mat2=y);y={create:function(){var n=new t(6);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},clone:function(n){var x=new t(6);return x[0]=n[0],x[1]=n[1],x[2]=n[2],x[3]=n[3],x[4]=n[4],x[5]=n[5],x},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],n[3]=x[3],n[4]=x[4],n[5]=x[5],n},identity:function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},invert:function(n,
x){var H=x[0],f=x[1],m=x[2],v=x[3],D=x[4];x=x[5];var C=H*v-f*m;return C?(C=1/C,n[0]=v*C,n[1]=-f*C,n[2]=-m*C,n[3]=H*C,n[4]=(m*x-v*D)*C,n[5]=(f*D-H*x)*C,n):null},determinant:function(n){return n[0]*n[3]-n[1]*n[2]},multiply:function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=x[4];x=x[5];var K=H[0],N=H[1],S=H[2],U=H[3],X=H[4];H=H[5];return n[0]=f*K+v*N,n[1]=m*K+D*N,n[2]=f*S+v*U,n[3]=m*S+D*U,n[4]=f*X+v*H+C,n[5]=m*X+D*H+x,n}};y.mul=y.multiply;y.rotate=function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=x[4];
x=x[5];var K=Math.sin(H);H=Math.cos(H);return n[0]=f*H+v*K,n[1]=m*H+D*K,n[2]=f*-K+v*H,n[3]=m*-K+D*H,n[4]=C,n[5]=x,n};y.scale=function(n,x,H){var f=x[1],m=x[2],v=x[3],D=x[4],C=x[5],K=H[0];H=H[1];return n[0]=x[0]*K,n[1]=f*K,n[2]=m*H,n[3]=v*H,n[4]=D,n[5]=C,n};y.translate=function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=x[4];x=x[5];var K=H[0];H=H[1];return n[0]=f,n[1]=m,n[2]=v,n[3]=D,n[4]=f*K+v*H+C,n[5]=m*K+D*H+x,n};y.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+
")"};y.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+1)};"undefined"!=typeof q&&(q.mat2d=y);var I={create:function(){var n=new t(9);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},fromMat4:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],n[3]=x[4],n[4]=x[5],n[5]=x[6],n[6]=x[8],n[7]=x[9],n[8]=x[10],n},clone:function(n){var x=new t(9);return x[0]=n[0],x[1]=n[1],x[2]=n[2],x[3]=n[3],x[4]=
n[4],x[5]=n[5],x[6]=n[6],x[7]=n[7],x[8]=n[8],x},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],n[3]=x[3],n[4]=x[4],n[5]=x[5],n[6]=x[6],n[7]=x[7],n[8]=x[8],n},identity:function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},transpose:function(n,x){if(n===x){var H=x[1],f=x[2],m=x[5];n[1]=x[3];n[2]=x[6];n[3]=H;n[5]=x[7];n[6]=f;n[7]=m}else n[0]=x[0],n[1]=x[3],n[2]=x[6],n[3]=x[1],n[4]=x[4],n[5]=x[7],n[6]=x[2],n[7]=x[5],n[8]=x[8];return n},invert:function(n,x){var H=
x[0],f=x[1],m=x[2],v=x[3],D=x[4],C=x[5],K=x[6],N=x[7];x=x[8];var S=x*D-C*N,U=-x*v+C*K,X=N*v-D*K,Z=H*S+f*U+m*X;return Z?(Z=1/Z,n[0]=S*Z,n[1]=(-x*f+m*N)*Z,n[2]=(C*f-m*D)*Z,n[3]=U*Z,n[4]=(x*H-m*K)*Z,n[5]=(-C*H+m*v)*Z,n[6]=X*Z,n[7]=(-N*H+f*K)*Z,n[8]=(D*H-f*v)*Z,n):null},adjoint:function(n,x){var H=x[0],f=x[1],m=x[2],v=x[3],D=x[4],C=x[5],K=x[6],N=x[7];x=x[8];return n[0]=D*x-C*N,n[1]=m*N-f*x,n[2]=f*C-m*D,n[3]=C*K-v*x,n[4]=H*x-m*K,n[5]=m*v-H*C,n[6]=v*N-D*K,n[7]=f*K-H*N,n[8]=H*D-f*v,n},determinant:function(n){var x=
n[3],H=n[4],f=n[5],m=n[6],v=n[7],D=n[8];return n[0]*(D*H-f*v)+n[1]*(-D*x+f*m)+n[2]*(v*x-H*m)},multiply:function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=x[4],K=x[5],N=x[6],S=x[7];x=x[8];var U=H[0],X=H[1],Z=H[2],V=H[3],ma=H[4],ia=H[5],ja=H[6],ba=H[7];H=H[8];return n[0]=U*f+X*D+Z*N,n[1]=U*m+X*C+Z*S,n[2]=U*v+X*K+Z*x,n[3]=V*f+ma*D+ia*N,n[4]=V*m+ma*C+ia*S,n[5]=V*v+ma*K+ia*x,n[6]=ja*f+ba*D+H*N,n[7]=ja*m+ba*C+H*S,n[8]=ja*v+ba*K+H*x,n}};I.mul=I.multiply;I.translate=function(n,x,H){var f=x[0],m=x[1],v=x[2],
D=x[3],C=x[4],K=x[5],N=x[6],S=x[7];x=x[8];var U=H[0];H=H[1];return n[0]=f,n[1]=m,n[2]=v,n[3]=D,n[4]=C,n[5]=K,n[6]=U*f+H*D+N,n[7]=U*m+H*C+S,n[8]=U*v+H*K+x,n};I.rotate=function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=x[4],K=x[5],N=x[6],S=x[7];x=x[8];var U=Math.sin(H);H=Math.cos(H);return n[0]=H*f+U*D,n[1]=H*m+U*C,n[2]=H*v+U*K,n[3]=H*D-U*f,n[4]=H*C-U*m,n[5]=H*K-U*v,n[6]=N,n[7]=S,n[8]=x,n};I.scale=function(n,x,H){var f=H[0];H=H[1];return n[0]=f*x[0],n[1]=f*x[1],n[2]=f*x[2],n[3]=H*x[3],n[4]=H*x[4],n[5]=
H*x[5],n[6]=x[6],n[7]=x[7],n[8]=x[8],n};I.fromMat2d=function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=0,n[3]=x[2],n[4]=x[3],n[5]=0,n[6]=x[4],n[7]=x[5],n[8]=1,n};I.fromQuat=function(n,x){var H=x[0],f=x[1],m=x[2];x=x[3];var v=H+H,D=f+f,C=m+m;H*=v;var K=f*v;f*=D;var N=m*v,S=m*D;m*=C;v*=x;D*=x;x*=C;return n[0]=1-f-m,n[3]=K-x,n[6]=N+D,n[1]=K+x,n[4]=1-H-m,n[7]=S-v,n[2]=N-D,n[5]=S+v,n[8]=1-H-f,n};I.normalFromMat4=function(n,x){var H=x[0],f=x[1],m=x[2],v=x[3],D=x[4],C=x[5],K=x[6],N=x[7],S=x[8],U=x[9],X=x[10],
Z=x[11],V=x[12],ma=x[13],ia=x[14];x=x[15];var ja=H*C-f*D,ba=H*K-m*D,fa=H*N-v*D,ka=f*K-m*C,P=f*N-v*C,Y=m*N-v*K,da=S*ma-U*V,pa=S*ia-X*V;S=S*x-Z*V;var la=U*ia-X*ma;U=U*x-Z*ma;X=X*x-Z*ia;return(Z=ja*X-ba*U+fa*la+ka*S-P*pa+Y*da)?(Z=1/Z,n[0]=(C*X-K*U+N*la)*Z,n[1]=(K*S-D*X-N*pa)*Z,n[2]=(D*U-C*S+N*da)*Z,n[3]=(m*U-f*X-v*la)*Z,n[4]=(H*X-m*S+v*pa)*Z,n[5]=(f*S-H*U-v*da)*Z,n[6]=(ma*Y-ia*P+x*ka)*Z,n[7]=(ia*fa-V*Y-x*ba)*Z,n[8]=(V*P-ma*fa+x*ja)*Z,n):null};I.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+
", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"};I.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2))};"undefined"!=typeof q&&(q.mat3=I);var L={create:function(){var n=new t(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},clone:function(n){var x=new t(16);return x[0]=
n[0],x[1]=n[1],x[2]=n[2],x[3]=n[3],x[4]=n[4],x[5]=n[5],x[6]=n[6],x[7]=n[7],x[8]=n[8],x[9]=n[9],x[10]=n[10],x[11]=n[11],x[12]=n[12],x[13]=n[13],x[14]=n[14],x[15]=n[15],x},copy:function(n,x){return n[0]=x[0],n[1]=x[1],n[2]=x[2],n[3]=x[3],n[4]=x[4],n[5]=x[5],n[6]=x[6],n[7]=x[7],n[8]=x[8],n[9]=x[9],n[10]=x[10],n[11]=x[11],n[12]=x[12],n[13]=x[13],n[14]=x[14],n[15]=x[15],n},identity:function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,
n[14]=0,n[15]=1,n},transpose:function(n,x){if(n===x){var H=x[1],f=x[2],m=x[3],v=x[6],D=x[7],C=x[11];n[1]=x[4];n[2]=x[8];n[3]=x[12];n[4]=H;n[6]=x[9];n[7]=x[13];n[8]=f;n[9]=v;n[11]=x[14];n[12]=m;n[13]=D;n[14]=C}else n[0]=x[0],n[1]=x[4],n[2]=x[8],n[3]=x[12],n[4]=x[1],n[5]=x[5],n[6]=x[9],n[7]=x[13],n[8]=x[2],n[9]=x[6],n[10]=x[10],n[11]=x[14],n[12]=x[3],n[13]=x[7],n[14]=x[11],n[15]=x[15];return n},invert:function(n,x){var H=x[0],f=x[1],m=x[2],v=x[3],D=x[4],C=x[5],K=x[6],N=x[7],S=x[8],U=x[9],X=x[10],Z=
x[11],V=x[12],ma=x[13],ia=x[14];x=x[15];var ja=H*C-f*D,ba=H*K-m*D,fa=H*N-v*D,ka=f*K-m*C,P=f*N-v*C,Y=m*N-v*K,da=S*ma-U*V,pa=S*ia-X*V,la=S*x-Z*V,xa=U*ia-X*ma,Ba=U*x-Z*ma,ya=X*x-Z*ia,Ga=ja*ya-ba*Ba+fa*xa+ka*la-P*pa+Y*da;return Ga?(Ga=1/Ga,n[0]=(C*ya-K*Ba+N*xa)*Ga,n[1]=(m*Ba-f*ya-v*xa)*Ga,n[2]=(ma*Y-ia*P+x*ka)*Ga,n[3]=(X*P-U*Y-Z*ka)*Ga,n[4]=(K*la-D*ya-N*pa)*Ga,n[5]=(H*ya-m*la+v*pa)*Ga,n[6]=(ia*fa-V*Y-x*ba)*Ga,n[7]=(S*Y-X*fa+Z*ba)*Ga,n[8]=(D*Ba-C*la+N*da)*Ga,n[9]=(f*la-H*Ba-v*da)*Ga,n[10]=(V*P-ma*fa+x*
ja)*Ga,n[11]=(U*fa-S*P-Z*ja)*Ga,n[12]=(C*pa-D*xa-K*da)*Ga,n[13]=(H*xa-f*pa+m*da)*Ga,n[14]=(ma*ba-V*ka-ia*ja)*Ga,n[15]=(S*ka-U*ba+X*ja)*Ga,n):null},adjoint:function(n,x){var H=x[0],f=x[1],m=x[2],v=x[3],D=x[4],C=x[5],K=x[6],N=x[7],S=x[8],U=x[9],X=x[10],Z=x[11],V=x[12],ma=x[13],ia=x[14];x=x[15];return n[0]=C*(X*x-Z*ia)-U*(K*x-N*ia)+ma*(K*Z-N*X),n[1]=-(f*(X*x-Z*ia)-U*(m*x-v*ia)+ma*(m*Z-v*X)),n[2]=f*(K*x-N*ia)-C*(m*x-v*ia)+ma*(m*N-v*K),n[3]=-(f*(K*Z-N*X)-C*(m*Z-v*X)+U*(m*N-v*K)),n[4]=-(D*(X*x-Z*ia)-S*
(K*x-N*ia)+V*(K*Z-N*X)),n[5]=H*(X*x-Z*ia)-S*(m*x-v*ia)+V*(m*Z-v*X),n[6]=-(H*(K*x-N*ia)-D*(m*x-v*ia)+V*(m*N-v*K)),n[7]=H*(K*Z-N*X)-D*(m*Z-v*X)+S*(m*N-v*K),n[8]=D*(U*x-Z*ma)-S*(C*x-N*ma)+V*(C*Z-N*U),n[9]=-(H*(U*x-Z*ma)-S*(f*x-v*ma)+V*(f*Z-v*U)),n[10]=H*(C*x-N*ma)-D*(f*x-v*ma)+V*(f*N-v*C),n[11]=-(H*(C*Z-N*U)-D*(f*Z-v*U)+S*(f*N-v*C)),n[12]=-(D*(U*ia-X*ma)-S*(C*ia-K*ma)+V*(C*X-K*U)),n[13]=H*(U*ia-X*ma)-S*(f*ia-m*ma)+V*(f*X-m*U),n[14]=-(H*(C*ia-K*ma)-D*(f*ia-m*ma)+V*(f*K-m*C)),n[15]=H*(C*X-K*U)-D*(f*X-
m*U)+S*(f*K-m*C),n},determinant:function(n){var x=n[0],H=n[1],f=n[2],m=n[3],v=n[4],D=n[5],C=n[6],K=n[7],N=n[8],S=n[9],U=n[10],X=n[11],Z=n[12],V=n[13],ma=n[14];n=n[15];return(x*D-H*v)*(U*n-X*ma)-(x*C-f*v)*(S*n-X*V)+(x*K-m*v)*(S*ma-U*V)+(H*C-f*D)*(N*n-X*Z)-(H*K-m*D)*(N*ma-U*Z)+(f*K-m*C)*(N*V-S*Z)},multiply:function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=x[4],K=x[5],N=x[6],S=x[7],U=x[8],X=x[9],Z=x[10],V=x[11],ma=x[12],ia=x[13],ja=x[14];x=x[15];var ba=H[0],fa=H[1],ka=H[2],P=H[3];return n[0]=ba*f+fa*
C+ka*U+P*ma,n[1]=ba*m+fa*K+ka*X+P*ia,n[2]=ba*v+fa*N+ka*Z+P*ja,n[3]=ba*D+fa*S+ka*V+P*x,ba=H[4],fa=H[5],ka=H[6],P=H[7],n[4]=ba*f+fa*C+ka*U+P*ma,n[5]=ba*m+fa*K+ka*X+P*ia,n[6]=ba*v+fa*N+ka*Z+P*ja,n[7]=ba*D+fa*S+ka*V+P*x,ba=H[8],fa=H[9],ka=H[10],P=H[11],n[8]=ba*f+fa*C+ka*U+P*ma,n[9]=ba*m+fa*K+ka*X+P*ia,n[10]=ba*v+fa*N+ka*Z+P*ja,n[11]=ba*D+fa*S+ka*V+P*x,ba=H[12],fa=H[13],ka=H[14],P=H[15],n[12]=ba*f+fa*C+ka*U+P*ma,n[13]=ba*m+fa*K+ka*X+P*ia,n[14]=ba*v+fa*N+ka*Z+P*ja,n[15]=ba*D+fa*S+ka*V+P*x,n}};L.mul=L.multiply;
L.translate=function(n,x,H){var f,m,v,D,C,K,N,S,U,X,Z,V,ma=H[0],ia=H[1];H=H[2];return x===n?(n[12]=x[0]*ma+x[4]*ia+x[8]*H+x[12],n[13]=x[1]*ma+x[5]*ia+x[9]*H+x[13],n[14]=x[2]*ma+x[6]*ia+x[10]*H+x[14],n[15]=x[3]*ma+x[7]*ia+x[11]*H+x[15]):(f=x[0],m=x[1],v=x[2],D=x[3],C=x[4],K=x[5],N=x[6],S=x[7],U=x[8],X=x[9],Z=x[10],V=x[11],n[0]=f,n[1]=m,n[2]=v,n[3]=D,n[4]=C,n[5]=K,n[6]=N,n[7]=S,n[8]=U,n[9]=X,n[10]=Z,n[11]=V,n[12]=f*ma+C*ia+U*H+x[12],n[13]=m*ma+K*ia+X*H+x[13],n[14]=v*ma+N*ia+Z*H+x[14],n[15]=D*ma+S*ia+
V*H+x[15]),n};L.scale=function(n,x,H){var f=H[0],m=H[1];H=H[2];return n[0]=x[0]*f,n[1]=x[1]*f,n[2]=x[2]*f,n[3]=x[3]*f,n[4]=x[4]*m,n[5]=x[5]*m,n[6]=x[6]*m,n[7]=x[7]*m,n[8]=x[8]*H,n[9]=x[9]*H,n[10]=x[10]*H,n[11]=x[11]*H,n[12]=x[12],n[13]=x[13],n[14]=x[14],n[15]=x[15],n};L.rotate=function(n,x,H,f){var m,v,D,C,K,N,S,U,X,Z,V,ma,ia,ja,ba,fa,ka,P,Y,da,pa,la,xa,Ba,ya=f[0],Ga=f[1];f=f[2];var $a=Math.sqrt(ya*ya+Ga*Ga+f*f);return Math.abs($a)<k?null:($a=1/$a,ya*=$a,Ga*=$a,f*=$a,m=Math.sin(H),v=Math.cos(H),D=
1-v,C=x[0],K=x[1],N=x[2],S=x[3],U=x[4],X=x[5],Z=x[6],V=x[7],ma=x[8],ia=x[9],ja=x[10],ba=x[11],fa=ya*ya*D+v,ka=Ga*ya*D+f*m,P=f*ya*D-Ga*m,Y=ya*Ga*D-f*m,da=Ga*Ga*D+v,pa=f*Ga*D+ya*m,la=ya*f*D+Ga*m,xa=Ga*f*D-ya*m,Ba=f*f*D+v,n[0]=C*fa+U*ka+ma*P,n[1]=K*fa+X*ka+ia*P,n[2]=N*fa+Z*ka+ja*P,n[3]=S*fa+V*ka+ba*P,n[4]=C*Y+U*da+ma*pa,n[5]=K*Y+X*da+ia*pa,n[6]=N*Y+Z*da+ja*pa,n[7]=S*Y+V*da+ba*pa,n[8]=C*la+U*xa+ma*Ba,n[9]=K*la+X*xa+ia*Ba,n[10]=N*la+Z*xa+ja*Ba,n[11]=S*la+V*xa+ba*Ba,x!==n&&(n[12]=x[12],n[13]=x[13],n[14]=
x[14],n[15]=x[15]),n)};L.rotateX=function(n,x,H){var f=Math.sin(H);H=Math.cos(H);var m=x[4],v=x[5],D=x[6],C=x[7],K=x[8],N=x[9],S=x[10],U=x[11];return x!==n&&(n[0]=x[0],n[1]=x[1],n[2]=x[2],n[3]=x[3],n[12]=x[12],n[13]=x[13],n[14]=x[14],n[15]=x[15]),n[4]=m*H+K*f,n[5]=v*H+N*f,n[6]=D*H+S*f,n[7]=C*H+U*f,n[8]=K*H-m*f,n[9]=N*H-v*f,n[10]=S*H-D*f,n[11]=U*H-C*f,n};L.rotateY=function(n,x,H){var f=Math.sin(H);H=Math.cos(H);var m=x[0],v=x[1],D=x[2],C=x[3],K=x[8],N=x[9],S=x[10],U=x[11];return x!==n&&(n[4]=x[4],
n[5]=x[5],n[6]=x[6],n[7]=x[7],n[12]=x[12],n[13]=x[13],n[14]=x[14],n[15]=x[15]),n[0]=m*H-K*f,n[1]=v*H-N*f,n[2]=D*H-S*f,n[3]=C*H-U*f,n[8]=m*f+K*H,n[9]=v*f+N*H,n[10]=D*f+S*H,n[11]=C*f+U*H,n};L.rotateZ=function(n,x,H){var f=Math.sin(H);H=Math.cos(H);var m=x[0],v=x[1],D=x[2],C=x[3],K=x[4],N=x[5],S=x[6],U=x[7];return x!==n&&(n[8]=x[8],n[9]=x[9],n[10]=x[10],n[11]=x[11],n[12]=x[12],n[13]=x[13],n[14]=x[14],n[15]=x[15]),n[0]=m*H+K*f,n[1]=v*H+N*f,n[2]=D*H+S*f,n[3]=C*H+U*f,n[4]=K*H-m*f,n[5]=N*H-v*f,n[6]=S*H-
D*f,n[7]=U*H-C*f,n};L.fromRotationTranslation=function(n,x,H){var f=x[0],m=x[1],v=x[2],D=x[3],C=f+f,K=m+m,N=v+v;x=f*C;var S=f*K;f*=N;var U=m*K;m*=N;v*=N;C*=D;K*=D;D*=N;return n[0]=1-(U+v),n[1]=S+D,n[2]=f-K,n[3]=0,n[4]=S-D,n[5]=1-(x+v),n[6]=m+C,n[7]=0,n[8]=f+K,n[9]=m-C,n[10]=1-(x+U),n[11]=0,n[12]=H[0],n[13]=H[1],n[14]=H[2],n[15]=1,n};L.fromQuat=function(n,x){var H=x[0],f=x[1],m=x[2];x=x[3];var v=H+H,D=f+f,C=m+m;H*=v;var K=f*v;f*=D;var N=m*v,S=m*D;m*=C;v*=x;D*=x;x*=C;return n[0]=1-f-m,n[1]=K+x,n[2]=
N-D,n[3]=0,n[4]=K-x,n[5]=1-H-m,n[6]=S+v,n[7]=0,n[8]=N+D,n[9]=S-v,n[10]=1-H-f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};L.frustum=function(n,x,H,f,m,v,D){var C=1/(H-x),K=1/(m-f),N=1/(v-D);return n[0]=2*v*C,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*v*K,n[6]=0,n[7]=0,n[8]=(H+x)*C,n[9]=(m+f)*K,n[10]=(D+v)*N,n[11]=-1,n[12]=0,n[13]=0,n[14]=D*v*2*N,n[15]=0,n};L.perspective=function(n,x,H,f,m){x=1/Math.tan(x/2);var v=1/(f-m);return n[0]=x/H,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(m+
f)*v,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*m*f*v,n[15]=0,n};L.ortho=function(n,x,H,f,m,v,D){var C=1/(x-H),K=1/(f-m),N=1/(v-D);return n[0]=-2*C,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*K,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*N,n[11]=0,n[12]=(x+H)*C,n[13]=(m+f)*K,n[14]=(D+v)*N,n[15]=1,n};L.lookAt=function(n,x,H,f){var m,v,D,C,K,N,S,U,X,Z,V=x[0],ma=x[1];x=x[2];var ia=f[0],ja=f[1];f=f[2];var ba=H[0],fa=H[1];H=H[2];return Math.abs(V-ba)<k&&Math.abs(ma-fa)<k&&Math.abs(x-H)<k?L.identity(n):(S=V-ba,U=ma-fa,X=x-H,Z=1/
Math.sqrt(S*S+U*U+X*X),S*=Z,U*=Z,X*=Z,m=ja*X-f*U,v=f*S-ia*X,D=ia*U-ja*S,Z=Math.sqrt(m*m+v*v+D*D),Z?(Z=1/Z,m*=Z,v*=Z,D*=Z):(m=0,v=0,D=0),C=U*D-X*v,K=X*m-S*D,N=S*v-U*m,Z=Math.sqrt(C*C+K*K+N*N),Z?(Z=1/Z,C*=Z,K*=Z,N*=Z):(C=0,K=0,N=0),n[0]=m,n[1]=C,n[2]=S,n[3]=0,n[4]=v,n[5]=K,n[6]=U,n[7]=0,n[8]=D,n[9]=N,n[10]=X,n[11]=0,n[12]=-(m*V+v*ma+D*x),n[13]=-(C*V+K*ma+N*x),n[14]=-(S*V+U*ma+X*x),n[15]=1,n)};L.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+
", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"};L.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2)+Math.pow(n[9],2)+Math.pow(n[10],2)+Math.pow(n[11],2)+Math.pow(n[12],2)+Math.pow(n[13],2)+Math.pow(n[14],2)+Math.pow(n[15],2))};"undefined"!=typeof q&&(q.mat4=L);var T={create:function(){var n=new t(4);return n[0]=
0,n[1]=0,n[2]=0,n[3]=1,n}};T.rotationTo=function(){var n=B.create(),x=B.fromValues(1,0,0),H=B.fromValues(0,1,0);return function(f,m,v){var D=B.dot(m,v);return-.999999>D?(B.cross(n,x,m),1E-6>B.length(n)&&B.cross(n,H,m),B.normalize(n,n),T.setAxisAngle(f,n,Math.PI),f):.999999<D?(f[0]=0,f[1]=0,f[2]=0,f[3]=1,f):(B.cross(n,m,v),f[0]=n[0],f[1]=n[1],f[2]=n[2],f[3]=1+D,T.normalize(f,f))}}();T.setAxes=function(){var n=I.create();return function(x,H,f,m){return n[0]=f[0],n[3]=f[1],n[6]=f[2],n[1]=m[0],n[4]=m[1],
n[7]=m[2],n[2]=-H[0],n[5]=-H[1],n[8]=-H[2],T.normalize(x,T.fromMat3(x,n))}}();T.clone=G.clone;T.fromValues=G.fromValues;T.copy=G.copy;T.set=G.set;T.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n};T.setAxisAngle=function(n,x,H){H*=.5;var f=Math.sin(H);return n[0]=f*x[0],n[1]=f*x[1],n[2]=f*x[2],n[3]=Math.cos(H),n};T.add=G.add;T.multiply=function(n,x,H){var f=x[0],m=x[1],v=x[2];x=x[3];var D=H[0],C=H[1],K=H[2];H=H[3];return n[0]=f*H+x*D+m*K-v*C,n[1]=m*H+x*C+v*D-f*K,n[2]=v*H+x*K+f*C-m*D,n[3]=
x*H-f*D-m*C-v*K,n};T.mul=T.multiply;T.scale=G.scale;T.rotateX=function(n,x,H){H*=.5;var f=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(H);H=Math.cos(H);return n[0]=f*H+x*D,n[1]=m*H+v*D,n[2]=v*H-m*D,n[3]=x*H-f*D,n};T.rotateY=function(n,x,H){H*=.5;var f=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(H);H=Math.cos(H);return n[0]=f*H-v*D,n[1]=m*H+x*D,n[2]=v*H+f*D,n[3]=x*H-m*D,n};T.rotateZ=function(n,x,H){H*=.5;var f=x[0],m=x[1],v=x[2];x=x[3];var D=Math.sin(H);H=Math.cos(H);return n[0]=f*H+m*D,n[1]=m*H-f*D,n[2]=
v*H+x*D,n[3]=x*H-v*D,n};T.calculateW=function(n,x){var H=x[0],f=x[1];x=x[2];return n[0]=H,n[1]=f,n[2]=x,n[3]=-Math.sqrt(Math.abs(1-H*H-f*f-x*x)),n};T.dot=G.dot;T.lerp=G.lerp;T.slerp=function(n,x,H,f){var m,v,D,C,K,N=x[0],S=x[1],U=x[2];x=x[3];var X=H[0],Z=H[1],V=H[2];H=H[3];return v=N*X+S*Z+U*V+x*H,0>v&&(v=-v,X=-X,Z=-Z,V=-V,H=-H),1E-6<1-v?(m=Math.acos(v),D=Math.sin(m),C=Math.sin((1-f)*m)/D,K=Math.sin(f*m)/D):(C=1-f,K=f),n[0]=C*N+K*X,n[1]=C*S+K*Z,n[2]=C*U+K*V,n[3]=C*x+K*H,n};T.invert=function(n,x){var H=
x[0],f=x[1],m=x[2];x=x[3];var v=H*H+f*f+m*m+x*x;v=v?1/v:0;return n[0]=-H*v,n[1]=-f*v,n[2]=-m*v,n[3]=x*v,n};T.conjugate=function(n,x){return n[0]=-x[0],n[1]=-x[1],n[2]=-x[2],n[3]=x[3],n};T.length=G.length;T.len=T.length;T.squaredLength=G.squaredLength;T.sqrLen=T.squaredLength;T.normalize=G.normalize;T.fromMat3=function(n,x){var H=x[0]+x[4]+x[8];if(0<H)H=Math.sqrt(H+1),n[3]=.5*H,H=.5/H,n[0]=(x[7]-x[5])*H,n[1]=(x[2]-x[6])*H,n[2]=(x[3]-x[1])*H;else{var f=0;x[4]>x[0]&&(f=1);x[8]>x[3*f+f]&&(f=2);var m=
(f+1)%3,v=(f+2)%3;H=Math.sqrt(x[3*f+f]-x[3*m+m]-x[3*v+v]+1);n[f]=.5*H;H=.5/H;n[3]=(x[3*v+m]-x[3*m+v])*H;n[m]=(x[3*m+f]+x[3*f+m])*H;n[v]=(x[3*v+f]+x[3*f+v])*H}return n};T.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};"undefined"!=typeof q&&(q.quat=T)})(r)}(this)},{}],24:[function(b,h,l){(function(){var e=this,r=e._,q={},k=Array.prototype,t=Object.prototype,p=k.push,y=k.slice,A=k.concat,E=t.toString,B=t.hasOwnProperty,G=k.forEach,I=k.map,L=k.reduce,T=k.reduceRight,n=k.filter,
x=k.every,H=k.some,f=k.indexOf,m=k.lastIndexOf;t=Array.isArray;var v=Object.keys,D=Function.prototype.bind,C=function(P){return P instanceof C?P:this instanceof C?void(this._wrapped=P):new C(P)};"undefined"!=typeof l?("undefined"!=typeof h&&h.exports&&(l=h.exports=C),l._=C):e._=C;C.VERSION="1.4.4";var K=C.each=C.forEach=function(P,Y,da){if(null!=P)if(G&&P.forEach===G)P.forEach(Y,da);else if(P.length===+P.length)for(var pa=0,la=P.length;la>pa&&Y.call(da,P[pa],pa,P)!==q;pa++);else for(pa in P)if(C.has(P,
pa)&&Y.call(da,P[pa],pa,P)===q)break};C.map=C.collect=function(P,Y,da){var pa=[];return null==P?pa:I&&P.map===I?P.map(Y,da):(K(P,function(la,xa,Ba){pa[pa.length]=Y.call(da,la,xa,Ba)}),pa)};C.reduce=C.foldl=C.inject=function(P,Y,da,pa){var la=2<arguments.length;if(null==P&&(P=[]),L&&P.reduce===L)return pa&&(Y=C.bind(Y,pa)),la?P.reduce(Y,da):P.reduce(Y);if(K(P,function(xa,Ba,ya){la?da=Y.call(pa,da,xa,Ba,ya):(da=xa,la=!0)}),!la)throw new TypeError("Reduce of empty array with no initial value");return da};
C.reduceRight=C.foldr=function(P,Y,da,pa){var la=2<arguments.length;if(null==P&&(P=[]),T&&P.reduceRight===T)return pa&&(Y=C.bind(Y,pa)),la?P.reduceRight(Y,da):P.reduceRight(Y);var xa=P.length;if(xa!==+xa){var Ba=C.keys(P);xa=Ba.length}if(K(P,function(ya,Ga,$a){Ga=Ba?Ba[--xa]:--xa;la?da=Y.call(pa,da,P[Ga],Ga,$a):(da=P[Ga],la=!0)}),!la)throw new TypeError("Reduce of empty array with no initial value");return da};C.find=C.detect=function(P,Y,da){var pa;return N(P,function(la,xa,Ba){return Y.call(da,
la,xa,Ba)?(pa=la,!0):void 0}),pa};C.filter=C.select=function(P,Y,da){var pa=[];return null==P?pa:n&&P.filter===n?P.filter(Y,da):(K(P,function(la,xa,Ba){Y.call(da,la,xa,Ba)&&(pa[pa.length]=la)}),pa)};C.reject=function(P,Y,da){return C.filter(P,function(pa,la,xa){return!Y.call(da,pa,la,xa)},da)};C.every=C.all=function(P,Y,da){Y||(Y=C.identity);var pa=!0;return null==P?pa:x&&P.every===x?P.every(Y,da):(K(P,function(la,xa,Ba){return(pa=pa&&Y.call(da,la,xa,Ba))?void 0:q}),!!pa)};var N=C.some=C.any=function(P,
Y,da){Y||(Y=C.identity);var pa=!1;return null==P?pa:H&&P.some===H?P.some(Y,da):(K(P,function(la,xa,Ba){return pa||(pa=Y.call(da,la,xa,Ba))?q:void 0}),!!pa)};C.contains=C.include=function(P,Y){return null==P?!1:f&&P.indexOf===f?-1!=P.indexOf(Y):N(P,function(da){return da===Y})};C.invoke=function(P,Y){var da=y.call(arguments,2),pa=C.isFunction(Y);return C.map(P,function(la){return(pa?Y:la[Y]).apply(la,da)})};C.pluck=function(P,Y){return C.map(P,function(da){return da[Y]})};C.where=function(P,Y,da){return C.isEmpty(Y)?
da?null:[]:C[da?"find":"filter"](P,function(pa){for(var la in Y)if(Y[la]!==pa[la])return!1;return!0})};C.findWhere=function(P,Y){return C.where(P,Y,!0)};C.max=function(P,Y,da){if(!Y&&C.isArray(P)&&P[0]===+P[0]&&65535>P.length)return Math.max.apply(Math,P);if(!Y&&C.isEmpty(P))return-1/0;var pa={computed:-1/0,value:-1/0};return K(P,function(la,xa,Ba){xa=Y?Y.call(da,la,xa,Ba):la;xa>=pa.computed&&(pa={value:la,computed:xa})}),pa.value};C.min=function(P,Y,da){if(!Y&&C.isArray(P)&&P[0]===+P[0]&&65535>P.length)return Math.min.apply(Math,
P);if(!Y&&C.isEmpty(P))return 1/0;var pa={computed:1/0,value:1/0};return K(P,function(la,xa,Ba){xa=Y?Y.call(da,la,xa,Ba):la;xa<pa.computed&&(pa={value:la,computed:xa})}),pa.value};C.shuffle=function(P){var Y,da=0,pa=[];return K(P,function(la){Y=C.random(da++);pa[da-1]=pa[Y];pa[Y]=la}),pa};var S=function(P){return C.isFunction(P)?P:function(Y){return Y[P]}};C.sortBy=function(P,Y,da){var pa=S(Y);return C.pluck(C.map(P,function(la,xa,Ba){return{value:la,index:xa,criteria:pa.call(da,la,xa,Ba)}}).sort(function(la,
xa){var Ba=la.criteria,ya=xa.criteria;if(Ba!==ya){if(Ba>ya||void 0===Ba)return 1;if(ya>Ba||void 0===ya)return-1}return la.index<xa.index?-1:1}),"value")};var U=function(P,Y,da,pa){var la={},xa=S(Y||C.identity);return K(P,function(Ba,ya){ya=xa.call(da,Ba,ya,P);pa(la,ya,Ba)}),la};C.groupBy=function(P,Y,da){return U(P,Y,da,function(pa,la,xa){(C.has(pa,la)?pa[la]:pa[la]=[]).push(xa)})};C.countBy=function(P,Y,da){return U(P,Y,da,function(pa,la){C.has(pa,la)||(pa[la]=0);pa[la]++})};C.sortedIndex=function(P,
Y,da,pa){da=null==da?C.identity:S(da);Y=da.call(pa,Y);for(var la=0,xa=P.length;xa>la;){var Ba=la+xa>>>1;da.call(pa,P[Ba])<Y?la=Ba+1:xa=Ba}return la};C.toArray=function(P){return P?C.isArray(P)?y.call(P):P.length===+P.length?C.map(P,C.identity):C.values(P):[]};C.size=function(P){return null==P?0:P.length===+P.length?P.length:C.keys(P).length};C.first=C.head=C.take=function(P,Y,da){return null==P?void 0:null==Y||da?P[0]:y.call(P,0,Y)};C.initial=function(P,Y,da){return y.call(P,0,P.length-(null==Y||
da?1:Y))};C.last=function(P,Y,da){return null==P?void 0:null==Y||da?P[P.length-1]:y.call(P,Math.max(P.length-Y,0))};C.rest=C.tail=C.drop=function(P,Y,da){return y.call(P,null==Y||da?1:Y)};C.compact=function(P){return C.filter(P,C.identity)};var X=function(P,Y,da){return K(P,function(pa){C.isArray(pa)?Y?p.apply(da,pa):X(pa,Y,da):da.push(pa)}),da};C.flatten=function(P,Y){return X(P,Y,[])};C.without=function(P){return C.difference(P,y.call(arguments,1))};C.uniq=C.unique=function(P,Y,da,pa){C.isFunction(Y)&&
(pa=da,da=Y,Y=!1);da=da?C.map(P,da,pa):P;var la=[],xa=[];return K(da,function(Ba,ya){(Y?ya&&xa[xa.length-1]===Ba:C.contains(xa,Ba))||(xa.push(Ba),la.push(P[ya]))}),la};C.union=function(){return C.uniq(A.apply(k,arguments))};C.intersection=function(P){var Y=y.call(arguments,1);return C.filter(C.uniq(P),function(da){return C.every(Y,function(pa){return 0<=C.indexOf(pa,da)})})};C.difference=function(P){var Y=A.apply(k,y.call(arguments,1));return C.filter(P,function(da){return!C.contains(Y,da)})};C.zip=
function(){for(var P=y.call(arguments),Y=C.max(C.pluck(P,"length")),da=Array(Y),pa=0;Y>pa;pa++)da[pa]=C.pluck(P,""+pa);return da};C.object=function(P,Y){if(null==P)return{};for(var da={},pa=0,la=P.length;la>pa;pa++)Y?da[P[pa]]=Y[pa]:da[P[pa][0]]=P[pa][1];return da};C.indexOf=function(P,Y,da){if(null==P)return-1;var pa=0,la=P.length;if(da){if("number"!=typeof da)return pa=C.sortedIndex(P,Y),P[pa]===Y?pa:-1;pa=0>da?Math.max(0,la+da):da}if(f&&P.indexOf===f)return P.indexOf(Y,da);for(;la>pa;pa++)if(P[pa]===
Y)return pa;return-1};C.lastIndexOf=function(P,Y,da){if(null==P)return-1;var pa=null!=da;if(m&&P.lastIndexOf===m)return pa?P.lastIndexOf(Y,da):P.lastIndexOf(Y);for(da=pa?da:P.length;da--;)if(P[da]===Y)return da;return-1};C.range=function(P,Y,da){1>=arguments.length&&(Y=P||0,P=0);da=arguments[2]||1;for(var pa=Math.max(Math.ceil((Y-P)/da),0),la=0,xa=Array(pa);pa>la;)xa[la++]=P,P+=da;return xa};C.bind=function(P,Y){if(P.bind===D&&D)return D.apply(P,y.call(arguments,1));var da=y.call(arguments,2);return function(){return P.apply(Y,
da.concat(y.call(arguments)))}};C.partial=function(P){var Y=y.call(arguments,1);return function(){return P.apply(this,Y.concat(y.call(arguments)))}};C.bindAll=function(P){var Y=y.call(arguments,1);return 0===Y.length&&(Y=C.functions(P)),K(Y,function(da){P[da]=C.bind(P[da],P)}),P};C.memoize=function(P,Y){var da={};return Y||(Y=C.identity),function(){var pa=Y.apply(this,arguments);return C.has(da,pa)?da[pa]:da[pa]=P.apply(this,arguments)}};C.delay=function(P,Y){var da=y.call(arguments,2);return setTimeout(function(){return P.apply(null,
da)},Y)};C.defer=function(P){return C.delay.apply(C,[P,1].concat(y.call(arguments,1)))};C.throttle=function(P,Y){var da,pa,la,xa,Ba=0,ya=function(){Ba=new Date;la=null;xa=P.apply(da,pa)};return function(){var Ga=new Date,$a=Y-(Ga-Ba);return da=this,pa=arguments,0>=$a?(clearTimeout(la),la=null,Ba=Ga,xa=P.apply(da,pa)):la||(la=setTimeout(ya,$a)),xa}};C.debounce=function(P,Y,da){var pa,la;return function(){var xa=this,Ba=arguments,ya=da&&!pa;return clearTimeout(pa),pa=setTimeout(function(){pa=null;da||
(la=P.apply(xa,Ba))},Y),ya&&(la=P.apply(xa,Ba)),la}};C.once=function(P){var Y,da=!1;return function(){return da?Y:(da=!0,Y=P.apply(this,arguments),P=null,Y)}};C.wrap=function(P,Y){return function(){var da=[P];return p.apply(da,arguments),Y.apply(this,da)}};C.compose=function(){var P=arguments;return function(){for(var Y=arguments,da=P.length-1;0<=da;da--)Y=[P[da].apply(this,Y)];return Y[0]}};C.after=function(P,Y){return 0>=P?Y():function(){return 1>--P?Y.apply(this,arguments):void 0}};C.keys=v||function(P){if(P!==
Object(P))throw new TypeError("Invalid object");var Y=[],da;for(da in P)C.has(P,da)&&(Y[Y.length]=da);return Y};C.values=function(P){var Y=[],da;for(da in P)C.has(P,da)&&Y.push(P[da]);return Y};C.pairs=function(P){var Y=[],da;for(da in P)C.has(P,da)&&Y.push([da,P[da]]);return Y};C.invert=function(P){var Y={},da;for(da in P)C.has(P,da)&&(Y[P[da]]=da);return Y};C.functions=C.methods=function(P){var Y=[],da;for(da in P)C.isFunction(P[da])&&Y.push(da);return Y.sort()};C.extend=function(P){return K(y.call(arguments,
1),function(Y){if(Y)for(var da in Y)P[da]=Y[da]}),P};C.pick=function(P){var Y={},da=A.apply(k,y.call(arguments,1));return K(da,function(pa){pa in P&&(Y[pa]=P[pa])}),Y};C.omit=function(P){var Y={},da=A.apply(k,y.call(arguments,1)),pa;for(pa in P)C.contains(da,pa)||(Y[pa]=P[pa]);return Y};C.defaults=function(P){return K(y.call(arguments,1),function(Y){if(Y)for(var da in Y)null==P[da]&&(P[da]=Y[da])}),P};C.clone=function(P){return C.isObject(P)?C.isArray(P)?P.slice():C.extend({},P):P};C.tap=function(P,
Y){return Y(P),P};var Z=function(P,Y,da,pa){if(P===Y)return 0!==P||1/P==1/Y;if(null==P||null==Y)return P===Y;P instanceof C&&(P=P._wrapped);Y instanceof C&&(Y=Y._wrapped);var la=E.call(P);if(la!=E.call(Y))return!1;switch(la){case "[object String]":return P==String(Y);case "[object Number]":return P!=+P?Y!=+Y:0==P?1/P==1/Y:P==+Y;case "[object Date]":case "[object Boolean]":return+P==+Y;case "[object RegExp]":return P.source==Y.source&&P.global==Y.global&&P.multiline==Y.multiline&&P.ignoreCase==Y.ignoreCase}if("object"!=
typeof P||"object"!=typeof Y)return!1;for(var xa=da.length;xa--;)if(da[xa]==P)return pa[xa]==Y;da.push(P);pa.push(Y);xa=0;var Ba=!0;if("[object Array]"==la){if(xa=P.length,Ba=xa==Y.length)for(;xa--&&(Ba=Z(P[xa],Y[xa],da,pa)););}else{la=P.constructor;var ya=Y.constructor;if(la!==ya&&!(C.isFunction(la)&&la instanceof la&&C.isFunction(ya)&&ya instanceof ya))return!1;for(var Ga in P)if(C.has(P,Ga)&&(xa++,!(Ba=C.has(Y,Ga)&&Z(P[Ga],Y[Ga],da,pa))))break;if(Ba){for(Ga in Y)if(C.has(Y,Ga)&&!xa--)break;Ba=
!xa}}return da.pop(),pa.pop(),Ba};C.isEqual=function(P,Y){return Z(P,Y,[],[])};C.isEmpty=function(P){if(null==P)return!0;if(C.isArray(P)||C.isString(P))return 0===P.length;for(var Y in P)if(C.has(P,Y))return!1;return!0};C.isElement=function(P){return!(!P||1!==P.nodeType)};C.isArray=t||function(P){return"[object Array]"==E.call(P)};C.isObject=function(P){return P===Object(P)};K("Arguments Function String Number Date RegExp".split(" "),function(P){C["is"+P]=function(Y){return E.call(Y)=="[object "+
P+"]"}});C.isArguments(arguments)||(C.isArguments=function(P){return!(!P||!C.has(P,"callee"))});"function"!=typeof/./&&(C.isFunction=function(P){return"function"==typeof P});C.isFinite=function(P){return isFinite(P)&&!isNaN(parseFloat(P))};C.isNaN=function(P){return C.isNumber(P)&&P!=+P};C.isBoolean=function(P){return!0===P||!1===P||"[object Boolean]"==E.call(P)};C.isNull=function(P){return null===P};C.isUndefined=function(P){return void 0===P};C.has=function(P,Y){return B.call(P,Y)};C.noConflict=
function(){return e._=r,this};C.identity=function(P){return P};C.times=function(P,Y,da){for(var pa=Array(P),la=0;P>la;la++)pa[la]=Y.call(da,la);return pa};C.random=function(P,Y){return null==Y&&(Y=P,P=0),P+Math.floor(Math.random()*(Y-P+1))};var V={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};V.unescape=C.invert(V.escape);var ma={escape:new RegExp("["+C.keys(V.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(V.unescape).join("|")+")","g")};C.each(["escape",
"unescape"],function(P){C[P]=function(Y){return null==Y?"":(""+Y).replace(ma[P],function(da){return V[P][da]})}});C.result=function(P,Y){if(null==P)return null;Y=P[Y];return C.isFunction(Y)?Y.call(P):Y};C.mixin=function(P){K(C.functions(P),function(Y){var da=C[Y]=P[Y];C.prototype[Y]=function(){var pa=[this._wrapped];return p.apply(pa,arguments),ka.call(this,da.apply(C,pa))}})};var ia=0;C.uniqueId=function(P){var Y=++ia+"";return P?P+Y:Y};C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var ja=/(.)^/,ba={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},fa=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(P,Y,da){da=C.defaults({},da,C.templateSettings);var pa=new RegExp([(da.escape||ja).source,(da.interpolate||ja).source,(da.evaluate||ja).source].join("|")+"|$","g"),la=0,xa="__p+='";P.replace(pa,function(ya,Ga,$a,kb,Ib){return xa+=P.slice(la,Ib).replace(fa,function(wb){return"\\"+ba[wb]}),Ga&&(xa+="'+\n((__t=("+Ga+"))==null?'':_.escape(__t))+\n'"),
$a&&(xa+="'+\n((__t=("+$a+"))==null?'':__t)+\n'"),kb&&(xa+="';\n"+kb+"\n__p+='"),la=Ib+ya.length,ya});xa+="';\n";da.variable||(xa="with(obj||{}){\n"+xa+"}\n");xa="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+xa+"return __p;\n";try{var Ba=new Function(da.variable||"obj","_",xa)}catch(ya){throw ya.source=xa,ya;}if(Y)return Ba(Y,C);Y=function(ya){return Ba.call(this,ya,C)};return Y.source="function("+(da.variable||"obj")+"){\n"+xa+"}",Y};C.chain=function(P){return C(P).chain()};
var ka=function(P){return this._chain?C(P).chain():P};C.mixin(C);K("pop push reverse shift sort splice unshift".split(" "),function(P){var Y=k[P];C.prototype[P]=function(){var da=this._wrapped;return Y.apply(da,arguments),"shift"!=P&&"splice"!=P||0!==da.length||delete da[0],ka.call(this,da)}});K(["concat","join","slice"],function(P){var Y=k[P];C.prototype[P]=function(){return ka.call(this,Y.apply(this._wrapped,arguments))}});C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},
{}],25:[function(b){"undefined"!=typeof window&&"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(h){setTimeout(h,1E3/60)});Leap=b("../lib/index")},{"../lib/index":11}]},{},[25]);
var Stats=function(){function b(A){e.appendChild(A.dom);return A}function h(A){for(var E=0;E<e.children.length;E++)e.children[E].style.display=E===A?"block":"none";l=A}var l=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";e.addEventListener("click",function(A){A.preventDefault();h(++l%e.children.length)},!1);var r=(performance||Date).now(),q=r,k=0,t=b(new Stats.Panel("FPS","#fff","#222")),p=b(new Stats.Panel("MS","#fff","#222"));
if(self.performance&&self.performance.memory)var y=b(new Stats.Panel("MB","#fff","#222"));h(0);return{REVISION:17,dom:e,addPanel:b,showPanel:h,begin:function(){r=(performance||Date).now()},end:function(){k++;var A=(performance||Date).now();p.update(A-r,200);if(A>q+1E3&&(t.update(1E3*k/(A-q),100),q=A,k=0,y)){var E=performance.memory;y.update(E.usedJSHeapSize/1048576,E.jsHeapSizeLimit/1048576)}return A},update:function(){r=this.end()},domElement:e,setMode:h}};
Stats.Panel=function(b,h,l){var e=Infinity,r=0,q=Math.round,k=q(window.devicePixelRatio||1),t=80*k,p=48*k,y=3*k,A=2*k,E=3*k,B=15*k,G=74*k,I=30*k,L=document.createElement("canvas");L.width=t;L.height=p;L.style.cssText="width:80px;height:48px";var T=L.getContext("2d");T.font="bold "+9*k+"px Helvetica,Arial,sans-serif";T.textBaseline="top";T.fillStyle=l;T.fillRect(0,0,t,p);T.fillStyle=h;T.fillText(b,y,A);T.fillRect(E,B,G,I);T.fillStyle=l;T.globalAlpha=.9;T.fillRect(E,B,G,I);return{dom:L,update:function(n,
x){e=Math.min(e,n);r=Math.max(r,n);T.fillStyle=l;T.globalAlpha=1;T.fillRect(0,0,t,B);T.fillStyle=h;T.fillText(q(n)+" "+b+" ("+q(e)+"-"+q(r)+")",y,A);T.drawImage(L,E+k,B,G-k,I,E,B,G-k,I);T.fillRect(E+G-k,B,k,I);T.fillStyle=l;T.globalAlpha=.9;T.fillRect(E+G-k,B,k,q((1-n/x)*I))}}};"object"===typeof module&&(module.exports=Stats);var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};
"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE);SPE.TypedArrayHelper=function(b,h,l,e){this.componentSize=l||1;this.size=h||1;this.TypedArrayConstructor=b||Float32Array;this.array=new b(h*this.componentSize);this.indexOffset=e||0};SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper;
SPE.TypedArrayHelper.prototype.setSize=function(b,h){var l=this.array.length;return h||(b*=this.componentSize),l>b?this.shrink(b):b>l?this.grow(b):void console.info("TypedArray is already of size:",b+".","Will not resize.")};SPE.TypedArrayHelper.prototype.shrink=function(b){return this.array=this.array.subarray(0,b),this.size=b,this};SPE.TypedArrayHelper.prototype.grow=function(b){var h=this.array,l=new this.TypedArrayConstructor(b);return l.set(h),this.array=l,this.size=b,this};
SPE.TypedArrayHelper.prototype.splice=function(b,h){b*=this.componentSize;h*=this.componentSize;for(var l=[],e=this.array,r=e.length,q=0;r>q;++q)(b>q||q>=h)&&l.push(e[q]);return this.setFromArray(0,l),this};SPE.TypedArrayHelper.prototype.setFromArray=function(b,h){var l=b+h.length;return l>this.array.length?this.grow(l):l<this.array.length&&this.shrink(l),this.array.set(h,this.indexOffset+b),this};SPE.TypedArrayHelper.prototype.setVec2=function(b,h){return this.setVec2Components(b,h.x,h.y)};
SPE.TypedArrayHelper.prototype.setVec2Components=function(b,h,l){var e=this.array;b=this.indexOffset+b*this.componentSize;return e[b]=h,e[b+1]=l,this};SPE.TypedArrayHelper.prototype.setVec3=function(b,h){return this.setVec3Components(b,h.x,h.y,h.z)};SPE.TypedArrayHelper.prototype.setVec3Components=function(b,h,l,e){var r=this.array;b=this.indexOffset+b*this.componentSize;return r[b]=h,r[b+1]=l,r[b+2]=e,this};
SPE.TypedArrayHelper.prototype.setVec4=function(b,h){return this.setVec4Components(b,h.x,h.y,h.z,h.w)};SPE.TypedArrayHelper.prototype.setVec4Components=function(b,h,l,e,r){var q=this.array;b=this.indexOffset+b*this.componentSize;return q[b]=h,q[b+1]=l,q[b+2]=e,q[b+3]=r,this};SPE.TypedArrayHelper.prototype.setMat3=function(b,h){return this.setFromArray(this.indexOffset+b*this.componentSize,h.elements)};
SPE.TypedArrayHelper.prototype.setMat4=function(b,h){return this.setFromArray(this.indexOffset+b*this.componentSize,h.elements)};SPE.TypedArrayHelper.prototype.setColor=function(b,h){return this.setVec3Components(b,h.r,h.g,h.b)};SPE.TypedArrayHelper.prototype.setNumber=function(b,h){return this.array[this.indexOffset+b*this.componentSize]=h,this};SPE.TypedArrayHelper.prototype.getValueAtIndex=function(b){return this.array[this.indexOffset+b]};
SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(b){return this.array.subarray(this.indexOffset+b*this.componentSize)};SPE.ShaderAttribute=function(b,h,l){var e=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof b&&e.hasOwnProperty(b)?b:"f";this.componentSize=e[this.type];this.arrayType=l||Float32Array;this.bufferAttribute=this.typedArray=null;this.dynamicBuffer=!!h;this.updateMax=this.updateMin=0};SPE.ShaderAttribute.constructor=SPE.ShaderAttribute;
SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16};SPE.ShaderAttribute.prototype.setUpdateRange=function(b,h){this.updateMin=Math.min(b*this.componentSize,this.updateMin*this.componentSize);this.updateMax=Math.max(h*this.componentSize,this.updateMax*this.componentSize)};
SPE.ShaderAttribute.prototype.flagUpdate=function(){var b=this.bufferAttribute,h=b.updateRange;h.offset=this.updateMin;h.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length);b.needsUpdate=!0};SPE.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMax=this.updateMin=0};SPE.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.dynamic=this.dynamicBuffer};
SPE.ShaderAttribute.prototype.splice=function(b,h){this.typedArray.splice(b,h);this.forceUpdateAll()};SPE.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array;this.bufferAttribute.updateRange.offset=0;this.bufferAttribute.updateRange.count=-1;this.bufferAttribute.dynamic=!1;this.bufferAttribute.needsUpdate=!0};
SPE.ShaderAttribute.prototype._ensureTypedArray=function(b){null!==this.typedArray&&this.typedArray.size===b*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==b?this.typedArray.setSize(b):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,b,this.componentSize)))};
SPE.ShaderAttribute.prototype._createBufferAttribute=function(b){return this._ensureTypedArray(b),null!==this.bufferAttribute?(this.bufferAttribute.array=this.typedArray.array,void(this.bufferAttribute.needsUpdate=!0)):(this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),void(this.bufferAttribute.dynamic=this.dynamicBuffer))};SPE.ShaderAttribute.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length};
SPE.shaderChunks={defines:"#define PACKED_COLOR_SIZE 256.0\n#define PACKED_COLOR_DIVISOR 255.0",uniforms:"uniform float deltaTime;\nuniform float runTime;\nuniform sampler2D texture;\nuniform vec4 textureAnimation;\nuniform float scale;",attributes:"attribute vec4 acceleration;\nattribute vec3 velocity;\nattribute vec4 rotation;\nattribute vec3 rotationCenter;\nattribute vec4 params;\nattribute vec4 size;\nattribute vec4 angle;\nattribute vec4 color;\nattribute vec4 opacity;",varyings:"varying vec4 vColor;\n#ifdef SHOULD_ROTATE_TEXTURE\n    varying float vAngle;\n#endif\n#ifdef SHOULD_CALCULATE_SPRITE\n    varying vec4 vSpriteSheet;\n#endif",
branchAvoidanceFunctions:"float when_gt(float x, float y) {\n    return max(sign(x - y), 0.0);\n}\nfloat when_lt(float x, float y) {\n    return min( max(1.0 - sign(x - y), 0.0), 1.0 );\n}\nfloat when_eq( float x, float y ) {\n    return 1.0 - abs( sign( x - y ) );\n}\nfloat when_ge(float x, float y) {\n  return 1.0 - when_lt(x, y);\n}\nfloat when_le(float x, float y) {\n  return 1.0 - when_gt(x, y);\n}\nfloat and(float a, float b) {\n    return a * b;\n}\nfloat or(float a, float b) {\n    return min(a + b, 1.0);\n}",
unpackColor:"vec3 unpackColor( in float hex ) {\n   vec3 c = vec3( 0.0 );\n   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float b = mod( hex, PACKED_COLOR_SIZE );\n   c.r = r / PACKED_COLOR_DIVISOR;\n   c.g = g / PACKED_COLOR_DIVISOR;\n   c.b = b / PACKED_COLOR_DIVISOR;\n   return c;\n}",unpackRotationAxis:"vec3 unpackRotationAxis( in float hex ) {\n   vec3 c = vec3( 0.0 );\n   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float b = mod( hex, PACKED_COLOR_SIZE );\n   c.r = r / PACKED_COLOR_DIVISOR;\n   c.g = g / PACKED_COLOR_DIVISOR;\n   c.b = b / PACKED_COLOR_DIVISOR;\n   c *= vec3( 2.0 );\n   c -= vec3( 1.0 );\n   return c;\n}",
floatOverLifetime:"float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {\n    highp float value = 0.0;\n    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );\n    float fIndex = 0.0;\n    float shouldApplyValue = 0.0;\n    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );\n\n    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {\n       fIndex = float( i );\n       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );\n       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );\n    }\n\n    return value;\n}",
colorOverLifetime:"vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {\n    vec3 value = vec3( 0.0 );\n    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );\n    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );\n    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );\n    return value;\n}",
paramFetchingFunctions:"float getAlive() {\n   return params.x;\n}\nfloat getAge() {\n   return params.y;\n}\nfloat getMaxAge() {\n   return params.z;\n}\nfloat getWiggle() {\n   return params.w;\n}",forceFetchingFunctions:"vec4 getPosition( in float age ) {\n   return modelViewMatrix * vec4( position, 1.0 );\n}\nvec3 getVelocity( in float age ) {\n   return velocity * age;\n}\nvec3 getAcceleration( in float age ) {\n   return acceleration.xyz * age;\n}",rotationFunctions:"#ifdef SHOULD_ROTATE_PARTICLES\n   mat4 getRotationMatrix( in vec3 axis, in float angle) {\n       axis = normalize(axis);\n       float s = sin(angle);\n       float c = cos(angle);\n       float oc = 1.0 - c;\n\n       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                   0.0,                                0.0,                                0.0,                                1.0);\n   }\n\n   vec3 getRotation( in vec3 pos, in float positionInTime ) {\n      if( rotation.y == 0.0 ) {\n           return pos;\n      }\n\n      vec3 axis = unpackRotationAxis( rotation.x );\n      vec3 center = rotationCenter;\n      vec3 translated;\n      mat4 rotationMatrix;\n      float angle = 0.0;\n      angle += when_eq( rotation.z, 0.0 ) * rotation.y;\n      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );\n      translated = rotationCenter - pos;\n      rotationMatrix = getRotationMatrix( axis, angle );\n      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );\n   }\n#endif",
rotateTexture:"    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );\n\n    #ifdef SHOULD_ROTATE_TEXTURE\n       float x = gl_PointCoord.x - 0.5;\n       float y = 1.0 - gl_PointCoord.y - 0.5;\n       float c = cos( -vAngle );\n       float s = sin( -vAngle );\n       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );\n    #endif\n\n    #ifdef SHOULD_CALCULATE_SPRITE\n        float framesX = vSpriteSheet.x;\n        float framesY = vSpriteSheet.y;\n        float columnNorm = vSpriteSheet.z;\n        float rowNorm = vSpriteSheet.w;\n        vUv.x = gl_PointCoord.x * framesX + columnNorm;\n        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);\n    #endif\n\n    vec4 rotatedTexture = texture2D( texture, vUv );"};
SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {\n    highp float age = getAge();\n    highp float alive = getAlive();\n    highp float maxAge = getMaxAge();\n    highp float positionInTime = (age / maxAge);\n    highp float isAlive = when_gt( alive, 0.0 );\n    #ifdef SHOULD_WIGGLE_PARTICLES\n        float wiggleAmount = positionInTime * getWiggle();\n        float wiggleSin = isAlive * sin( wiggleAmount );\n        float wiggleCos = isAlive * cos( wiggleAmount );\n    #endif\n    vec3 vel = getVelocity( age );\n    vec3 accel = getAcceleration( age );\n    vec3 force = vec3( 0.0 );\n    vec3 pos = vec3( position );\n    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;\n    force += vel;\n    force *= drag;\n    force += accel * age;\n    pos += force;\n    #ifdef SHOULD_WIGGLE_PARTICLES\n        pos.x += wiggleSin;\n        pos.y += wiggleCos;\n        pos.z += wiggleSin;\n    #endif\n    #ifdef SHOULD_ROTATE_PARTICLES\n        pos = getRotation( pos, positionInTime );\n    #endif\n    vec4 mvPos = modelViewMatrix * vec4( pos, 1.0 );\n    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;\n    #ifdef HAS_PERSPECTIVE\n        float perspective = scale / length( mvPos.xyz );\n    #else\n        float perspective = 1.0;\n    #endif\n    float pointSizePerspective = pointSize * perspective;\n    #ifdef COLORIZE\n       vec3 c = isAlive * getColorOverLifetime(\n           positionInTime,\n           unpackColor( color.x ),\n           unpackColor( color.y ),\n           unpackColor( color.z ),\n           unpackColor( color.w )\n       );\n    #else\n       vec3 c = vec3(1.0);\n    #endif\n    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );\n    vColor = vec4( c, o );\n    #ifdef SHOULD_ROTATE_TEXTURE\n        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );\n    #endif\n    #ifdef SHOULD_CALCULATE_SPRITE\n        float framesX = textureAnimation.x;\n        float framesY = textureAnimation.y;\n        float loopCount = textureAnimation.w;\n        float totalFrames = textureAnimation.z;\n        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );\n        float column = floor(mod( frameNumber, framesX ));\n        float row = floor( (frameNumber - column) / framesX );\n        float columnNorm = column / framesX;\n        float rowNorm = row / framesY;\n        vSpriteSheet.x = 1.0 / framesX;\n        vSpriteSheet.y = 1.0 / framesY;\n        vSpriteSheet.z = columnNorm;\n        vSpriteSheet.w = rowNorm;\n    #endif\n    gl_PointSize = pointSizePerspective;\n    gl_Position = projectionMatrix * mvPos;",
THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {\n    vec3 outgoingLight = vColor.xyz;\n    \n    #ifdef ALPHATEST\n       if ( vColor.w < float(ALPHATEST) ) discard;\n    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;",
THREE.ShaderChunk.fog_fragment,"    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );\n}"].join("\n")};
SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(b,h,l){return typeof b===h?b:l},ensureArrayTypedArg:function(b,h,l){if(Array.isArray(b)){for(var e=b.length-1;0<=e;--e)if(typeof b[e]!==h)return l;return b}return this.ensureTypedArg(b,h,l)},ensureInstanceOf:function(b,h,l){return void 0!==h&&b instanceof h?b:l},ensureArrayInstanceOf:function(b,h,l){if(Array.isArray(b)){for(var e=b.length-1;0<=e;--e)if(void 0!==h&&0==b[e]instanceof h)return l;
return b}return this.ensureInstanceOf(b,h,l)},ensureValueOverLifetimeCompliance:function(b,h,l){h=h||3;l=l||3;!1===Array.isArray(b._value)&&(b._value=[b._value]);!1===Array.isArray(b._spread)&&(b._spread=[b._spread]);var e=this.clamp(b._value.length,h,l);h=this.clamp(b._spread.length,h,l);e=Math.max(e,h);b._value.length!==e&&(b._value=this.interpolateArray(b._value,e));b._spread.length!==e&&(b._spread=this.interpolateArray(b._spread,e))},interpolateArray:function(b,h){for(var l=b.length,e=["function"==
typeof b[0].clone?b[0].clone():b[0]],r=(l-1)/(h-1),q=1;h-1>q;++q){var k=q*r,t=Math.floor(k);e[q]=this.lerpTypeAgnostic(b[t],b[Math.ceil(k)],k-t)}return e.push("function"==typeof b[l-1].clone?b[l-1].clone():b[l-1]),e},clamp:function(b,h,l){return Math.max(h,Math.min(b,l))},zeroToEpsilon:function(b,h){var l=b;return l=h?1E-4*Math.random():1E-5,0>b&&-1E-5<b&&(l=-l),l},lerpTypeAgnostic:function(b,h,l){var e,r=this.types;return typeof b===r.NUMBER&&typeof h===r.NUMBER?b+(h-b)*l:b instanceof THREE.Vector2&&
h instanceof THREE.Vector2?(e=b.clone(),e.x=this.lerp(b.x,h.x,l),e.y=this.lerp(b.y,h.y,l),e):b instanceof THREE.Vector3&&h instanceof THREE.Vector3?(e=b.clone(),e.x=this.lerp(b.x,h.x,l),e.y=this.lerp(b.y,h.y,l),e.z=this.lerp(b.z,h.z,l),e):b instanceof THREE.Vector4&&h instanceof THREE.Vector4?(e=b.clone(),e.x=this.lerp(b.x,h.x,l),e.y=this.lerp(b.y,h.y,l),e.z=this.lerp(b.z,h.z,l),e.w=this.lerp(b.w,h.w,l),e):b instanceof THREE.Color&&h instanceof THREE.Color?(e=b.clone(),e.r=this.lerp(b.r,h.r,l),e.g=
this.lerp(b.g,h.g,l),e.b=this.lerp(b.b,h.b,l),e):void console.warn("Invalid argument types, or argument types do not match:",b,h)},lerp:function(b,h,l){return b+(h-b)*l},roundToNearestMultiple:function(b,h){var l=0;return 0===h?b:(l=Math.abs(b)%h,0===l?b:0>b?-(Math.abs(b)-l):b+h-l)},arrayValuesAreEqual:function(b){for(var h=0;h<b.length-1;++h)if(b[h]!==b[h+1])return!1;return!0},randomFloat:function(b,h){return b+h*(Math.random()-.5)},randomVector3:function(b,h,l,e,r){var q=l.x+(Math.random()*e.x-
.5*e.x),k=l.y+(Math.random()*e.y-.5*e.y);l=l.z+(Math.random()*e.z-.5*e.z);r&&(q=.5*-r.x+this.roundToNearestMultiple(q,r.x),k=.5*-r.y+this.roundToNearestMultiple(k,r.y),l=.5*-r.z+this.roundToNearestMultiple(l,r.z));b.typedArray.setVec3Components(h,q,k,l)},randomColor:function(b,h,l,e){var r=l.r+Math.random()*e.x,q=l.g+Math.random()*e.y;l=l.b+Math.random()*e.z;r=this.clamp(r,0,1);q=this.clamp(q,0,1);l=this.clamp(l,0,1);b.typedArray.setVec3Components(h,r,q,l)},randomColorAsHex:function(){var b=new THREE.Color;
return function(h,l,e,r){for(var q=e.length,k=[],t=0;q>t;++t){var p=r[t];b.copy(e[t]);b.r+=Math.random()*p.x-.5*p.x;b.g+=Math.random()*p.y-.5*p.y;b.b+=Math.random()*p.z-.5*p.z;b.r=this.clamp(b.r,0,1);b.g=this.clamp(b.g,0,1);b.b=this.clamp(b.b,0,1);k.push(b.getHex())}h.typedArray.setVec4Components(l,k[0],k[1],k[2],k[3])}}(),randomVector3OnSphere:function(b,h,l,e,r,q,k,t){t=2*Math.random()-1;var p=6.2832*Math.random(),y=Math.sqrt(1-t*t);e=this.randomFloat(e,r);k&&(e=Math.round(e/k)*k);k=y*Math.cos(p)*
e;p=y*Math.sin(p)*e;k*=q.x;p*=q.y;q=t*e*q.z;k+=l.x;p+=l.y;q+=l.z;b.typedArray.setVec3Components(h,k,p,q)},seededRandom:function(b){b=1E4*Math.sin(b);return b-(0|b)},randomVector3OnDisc:function(b,h,l,e,r,q,k){var t=6.2832*Math.random();e=Math.abs(this.randomFloat(e,r));k&&(e=Math.round(e/k)*k);k=Math.cos(t)*e;t=Math.sin(t)*e;k*=q.x;t*=q.y;k+=l.x;t+=l.y;l=0+l.z;b.typedArray.setVec3Components(h,k,t,l)},randomDirectionVector3OnSphere:function(){var b=new THREE.Vector3;return function(h,l,e,r,q,k,t,p){b.copy(k);
b.x-=e;b.y-=r;b.z-=q;b.normalize().multiplyScalar(-this.randomFloat(t,p));h.typedArray.setVec3Components(l,b.x,b.y,b.z)}}(),randomDirectionVector3OnDisc:function(){var b=new THREE.Vector3;return function(h,l,e,r,q,k,t,p){b.copy(k);b.x-=e;b.y-=r;b.z-=q;b.normalize().multiplyScalar(-this.randomFloat(t,p));h.typedArray.setVec3Components(l,b.x,b.y,0)}}(),getPackedRotationAxis:function(){var b=new THREE.Vector3,h=new THREE.Vector3,l=new THREE.Color,e=new THREE.Vector3(1,1,1);return function(r,q){return b.copy(r).normalize(),
h.copy(q).normalize(),b.x+=.5*-q.x+Math.random()*q.x,b.y+=.5*-q.y+Math.random()*q.y,b.z+=.5*-q.z+Math.random()*q.z,b.normalize().add(e).multiplyScalar(.5),l.setRGB(b.x,b.y,b.z),l.getHex()}}()};
SPE.Group=function(b){var h=SPE.utils,l=h.types;b=h.ensureTypedArg(b,l.OBJECT,{});b.texture=h.ensureTypedArg(b.texture,l.OBJECT,{});this.uuid=THREE.Math.generateUUID();this.fixedTimeStep=h.ensureTypedArg(b.fixedTimeStep,l.NUMBER,.016);this.texture=h.ensureInstanceOf(b.texture.value,THREE.Texture,null);this.textureFrames=h.ensureInstanceOf(b.texture.frames,THREE.Vector2,new THREE.Vector2(1,1));this.textureFrameCount=h.ensureTypedArg(b.texture.frameCount,l.NUMBER,this.textureFrames.x*this.textureFrames.y);
this.textureLoop=h.ensureTypedArg(b.texture.loop,l.NUMBER,1);this.textureFrames.max(new THREE.Vector2(1,1));this.hasPerspective=h.ensureTypedArg(b.hasPerspective,l.BOOLEAN,!0);this.colorize=h.ensureTypedArg(b.colorize,l.BOOLEAN,!0);this.maxParticleCount=h.ensureTypedArg(b.maxParticleCount,l.NUMBER,null);this.blending=h.ensureTypedArg(b.blending,l.NUMBER,THREE.AdditiveBlending);this.transparent=h.ensureTypedArg(b.transparent,l.BOOLEAN,!0);this.alphaTest=parseFloat(h.ensureTypedArg(b.alphaTest,l.NUMBER,
0));this.depthWrite=h.ensureTypedArg(b.depthWrite,l.BOOLEAN,!1);this.depthTest=h.ensureTypedArg(b.depthTest,l.BOOLEAN,!0);this.fog=h.ensureTypedArg(b.fog,l.BOOLEAN,!0);this.scale=h.ensureTypedArg(b.scale,l.NUMBER,300);this.emitters=[];this.emitterIDs=[];this._pool=[];this._poolCreationSettings=null;this._createNewWhenPoolEmpty=0;this._attributesNeedDynamicReset=this._attributesNeedRefresh=!1;this.particleCount=0;this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,
this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}};this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,
SHOULD_CALCULATE_SPRITE:1<this.textureFrames.x||1<this.textureFrames.y};this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",
!0)};this.attributeKeys=Object.keys(this.attributes);this.attributeCount=this.attributeKeys.length;this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog});this.geometry=new THREE.BufferGeometry;this.mesh=new THREE.Points(this.geometry,this.material);null===this.maxParticleCount&&
console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")};SPE.Group.constructor=SPE.Group;
SPE.Group.prototype._updateDefines=function(){var b=this.emitters,h=b.length-1,l=this.defines;for(h;0<=h;--h){var e=b[h];l.SHOULD_CALCULATE_SPRITE||(l.SHOULD_ROTATE_TEXTURE=l.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread)));l.SHOULD_ROTATE_PARTICLES=l.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread);l.SHOULD_WIGGLE_PARTICLES=l.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread)}this.material.needsUpdate=
!0};SPE.Group.prototype._applyAttributesToGeometry=function(){var b,h,l=this.attributes,e=this.geometry,r=e.attributes,q;for(q in l)l.hasOwnProperty(q)&&(b=l[q],h=r[q],h?h.array=b.typedArray.array:e.addAttribute(q,b.bufferAttribute),b.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)};
SPE.Group.prototype.addEmitter=function(b){if(0==b instanceof SPE.Emitter)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",b);if(-1<this.emitterIDs.indexOf(b.uuid))return void console.error("Emitter already exists in this group. Will not add again.");if(null!==b.group)return void console.error("Emitter already belongs to another group. Will not add to requested group.");var h=this.attributes,l=this.particleCount,e=l+b.particleCount;this.particleCount=
e;null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount);b._calculatePPSValue(b.maxAge._value+b.maxAge._spread);b._setBufferUpdateRanges(this.attributeKeys);b._setAttributeOffset(l);b.group=this;b.attributes=this.attributes;for(var r in h)h.hasOwnProperty(r)&&h[r]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);
for(h=l;e>h;++h)b._assignPositionValue(h),b._assignForceValue(h,"velocity"),b._assignForceValue(h,"acceleration"),b._assignAbsLifetimeValue(h,"opacity"),b._assignAbsLifetimeValue(h,"size"),b._assignAngleValue(h),b._assignRotationValue(h),b._assignParamsValue(h),b._assignColorValue(h);return this._applyAttributesToGeometry(),this.emitters.push(b),this.emitterIDs.push(b.uuid),this._updateDefines(b),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this};
SPE.Group.prototype.removeEmitter=function(b){var h=this.emitterIDs.indexOf(b.uuid);if(0==b instanceof SPE.Emitter)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",b);if(-1===h)return void console.error("Emitter does not exist in this group. Will not remove.");for(var l=b.attributeOffset,e=l+b.particleCount,r=this.attributes.params.typedArray,q=l;e>q;++q)r.array[4*q]=0,r.array[4*q+1]=0;this.emitters.splice(h,1);this.emitterIDs.splice(h,1);for(var k in this.attributes)this.attributes.hasOwnProperty(k)&&
this.attributes[k].splice(l,e);this.particleCount-=b.particleCount;b._onRemove();this._attributesNeedRefresh=!0};SPE.Group.prototype.getFromPool=function(){var b=this._pool,h=this._createNewWhenPoolEmpty;return b.length?b.pop():h?new SPE.Emitter(this._poolCreationSettings):null};SPE.Group.prototype.releaseIntoPool=function(b){return 0==b instanceof SPE.Emitter?void console.error("Argument is not instanceof SPE.Emitter:",b):(b.reset(),this._pool.unshift(b),this)};SPE.Group.prototype.getPool=function(){return this._pool};
SPE.Group.prototype.addPool=function(b,h,l){this._poolCreationSettings=h;this._createNewWhenPoolEmpty=!!l;for(var e=0;b>e;++e)l=Array.isArray(h)?new SPE.Emitter(h[e]):new SPE.Emitter(h),this.addEmitter(l),this.releaseIntoPool(l);return this};
SPE.Group.prototype._triggerSingleEmitter=function(b){var h=this.getFromPool(),l=this;return null===h?void console.log("SPE.Group pool ran out."):(b instanceof THREE.Vector3&&(h.position.value.copy(b),h.position.value=h.position.value),h.enable(),setTimeout(function(){h.disable();l.releaseIntoPool(h)},1E3*Math.max(h.duration,h.maxAge.value+h.maxAge.spread)),this)};
SPE.Group.prototype.triggerPoolEmitter=function(b,h){if("number"==typeof b&&1<b)for(var l=0;b>l;++l)this._triggerSingleEmitter(h);else this._triggerSingleEmitter(h);return this};SPE.Group.prototype._updateUniforms=function(b){this.uniforms.runTime.value+=b;this.uniforms.deltaTime.value=b};SPE.Group.prototype._resetBufferRanges=function(){var b=this.attributeKeys,h=this.attributeCount-1,l=this.attributes;for(h;0<=h;--h)l[b[h]].resetUpdateRange()};
SPE.Group.prototype._updateBuffers=function(b){var h=this.attributeKeys,l=this.attributeCount-1,e=this.attributes,r=b.bufferUpdateRanges;for(l;0<=l;--l){var q=h[l];b=r[q];q=e[q];q.setUpdateRange(b.min,b.max);q.flagUpdate()}};
SPE.Group.prototype.tick=function(b){var h=this.emitters,l=h.length,e=b||this.fixedTimeStep,r=this.attributeKeys,q=this.attributes;if(this._updateUniforms(e),this._resetBufferRanges(),0!==l||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(b=0;l>b;++b){var k=h[b];k.tick(e);this._updateBuffers(k)}if(!0===this._attributesNeedDynamicReset){for(b=this.attributeCount-1;0<=b;--b)q[r[b]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(b=
this.attributeCount-1;0<=b;--b)q[r[b]].forceUpdateAll();this._attributesNeedRefresh=!1;this._attributesNeedDynamicReset=!0}}};SPE.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this};
SPE.Emitter=function(b){var h=SPE.utils,l=h.types,e=SPE.valueOverLifetimeLength;b=h.ensureTypedArg(b,l.OBJECT,{});b.position=h.ensureTypedArg(b.position,l.OBJECT,{});b.velocity=h.ensureTypedArg(b.velocity,l.OBJECT,{});b.acceleration=h.ensureTypedArg(b.acceleration,l.OBJECT,{});b.radius=h.ensureTypedArg(b.radius,l.OBJECT,{});b.drag=h.ensureTypedArg(b.drag,l.OBJECT,{});b.rotation=h.ensureTypedArg(b.rotation,l.OBJECT,{});b.color=h.ensureTypedArg(b.color,l.OBJECT,{});b.opacity=h.ensureTypedArg(b.opacity,
l.OBJECT,{});b.size=h.ensureTypedArg(b.size,l.OBJECT,{});b.angle=h.ensureTypedArg(b.angle,l.OBJECT,{});b.wiggle=h.ensureTypedArg(b.wiggle,l.OBJECT,{});b.maxAge=h.ensureTypedArg(b.maxAge,l.OBJECT,{});b.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime.");this.uuid=THREE.Math.generateUUID();this.type=h.ensureTypedArg(b.type,l.NUMBER,SPE.distributions.BOX);this.position={_value:h.ensureInstanceOf(b.position.value,THREE.Vector3,
new THREE.Vector3),_spread:h.ensureInstanceOf(b.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:h.ensureInstanceOf(b.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:h.ensureTypedArg(b.position.distribution,l.NUMBER,this.type),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1),_radius:h.ensureTypedArg(b.position.radius,l.NUMBER,10),_radiusScale:h.ensureInstanceOf(b.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:h.ensureTypedArg(b.position.distributionClamp,
l.NUMBER,0)};this.velocity={_value:h.ensureInstanceOf(b.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:h.ensureInstanceOf(b.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:h.ensureTypedArg(b.velocity.distribution,l.NUMBER,this.type),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.acceleration={_value:h.ensureInstanceOf(b.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:h.ensureInstanceOf(b.acceleration.spread,THREE.Vector3,new THREE.Vector3),
_distribution:h.ensureTypedArg(b.acceleration.distribution,l.NUMBER,this.type),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.drag={_value:h.ensureTypedArg(b.drag.value,l.NUMBER,0),_spread:h.ensureTypedArg(b.drag.spread,l.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.wiggle={_value:h.ensureTypedArg(b.wiggle.value,l.NUMBER,0),_spread:h.ensureTypedArg(b.wiggle.spread,l.NUMBER,0)};this.rotation={_axis:h.ensureInstanceOf(b.rotation.axis,THREE.Vector3,
new THREE.Vector3(0,1,0)),_axisSpread:h.ensureInstanceOf(b.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:h.ensureTypedArg(b.rotation.angle,l.NUMBER,0),_angleSpread:h.ensureTypedArg(b.rotation.angleSpread,l.NUMBER,0),_static:h.ensureTypedArg(b.rotation["static"],l.BOOLEAN,!1),_center:h.ensureInstanceOf(b.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.maxAge={_value:h.ensureTypedArg(b.maxAge.value,l.NUMBER,
2),_spread:h.ensureTypedArg(b.maxAge.spread,l.NUMBER,0)};this.color={_value:h.ensureArrayInstanceOf(b.color.value,THREE.Color,new THREE.Color),_spread:h.ensureArrayInstanceOf(b.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.opacity={_value:h.ensureArrayTypedArg(b.opacity.value,l.NUMBER,1),_spread:h.ensureArrayTypedArg(b.opacity.spread,l.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.size={_value:h.ensureArrayTypedArg(b.size.value,
l.NUMBER,1),_spread:h.ensureArrayTypedArg(b.size.spread,l.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.angle={_value:h.ensureArrayTypedArg(b.angle.value,l.NUMBER,0),_spread:h.ensureArrayTypedArg(b.angle.spread,l.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)};this.particleCount=h.ensureTypedArg(b.particleCount,l.NUMBER,100);this.duration=h.ensureTypedArg(b.duration,l.NUMBER,null);this.isStatic=h.ensureTypedArg(b.isStatic,l.BOOLEAN,!1);this.activeMultiplier=
h.ensureTypedArg(b.activeMultiplier,l.NUMBER,1);this.direction=h.ensureTypedArg(b.direction,l.NUMBER,1);this.alive=h.ensureTypedArg(b.alive,l.BOOLEAN,!0);this.activeParticleCount=this.age=this.attributeEnd=this.attributeOffset=this.activationIndex=this.particlesPerSecond=0;this.paramsArray=this.attributes=this.group=null;this.resetFlags={position:h.ensureTypedArg(b.position.randomise,l.BOOLEAN,!1)||h.ensureTypedArg(b.radius.randomise,l.BOOLEAN,!1),velocity:h.ensureTypedArg(b.velocity.randomise,l.BOOLEAN,
!1),acceleration:h.ensureTypedArg(b.acceleration.randomise,l.BOOLEAN,!1)||h.ensureTypedArg(b.drag.randomise,l.BOOLEAN,!1),rotation:h.ensureTypedArg(b.rotation.randomise,l.BOOLEAN,!1),rotationCenter:h.ensureTypedArg(b.rotation.randomise,l.BOOLEAN,!1),size:h.ensureTypedArg(b.size.randomise,l.BOOLEAN,!1),color:h.ensureTypedArg(b.color.randomise,l.BOOLEAN,!1),opacity:h.ensureTypedArg(b.opacity.randomise,l.BOOLEAN,!1),angle:h.ensureTypedArg(b.angle.randomise,l.BOOLEAN,!1)};this.updateFlags={};this.updateCounts=
{};this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var r in this.updateMap)this.updateMap.hasOwnProperty(r)&&(this.updateCounts[this.updateMap[r]]=0,this.updateFlags[this.updateMap[r]]=!1,this._createGetterSetters(this[r],r));this.bufferUpdateRanges={};this.attributeKeys=null;this.attributeCount=0;h.ensureValueOverLifetimeCompliance(this.color,
e,e);h.ensureValueOverLifetimeCompliance(this.opacity,e,e);h.ensureValueOverLifetimeCompliance(this.size,e,e);h.ensureValueOverLifetimeCompliance(this.angle,e,e)};SPE.Emitter.constructor=SPE.Emitter;
SPE.Emitter.prototype._createGetterSetters=function(b,h){var l=this,e;for(e in b)if(b.hasOwnProperty(e)){var r=e.replace("_","");Object.defineProperty(b,r,{get:function(q){return function(){return this[q]}}(e),set:function(q){return function(k){var t=l.updateMap[h],p=this[q],y=SPE.valueOverLifetimeLength;"_rotationCenter"===q?(l.updateFlags.rotationCenter=!0,l.updateCounts.rotationCenter=0):"_randomise"===q?l.resetFlags[t]=k:(l.updateFlags[t]=!0,l.updateCounts[t]=0);l.group._updateDefines();this[q]=
k;Array.isArray(p)&&SPE.utils.ensureValueOverLifetimeCompliance(l[h],y,y)}}(e)})}};SPE.Emitter.prototype._setBufferUpdateRanges=function(b){this.attributeKeys=b;this.attributeCount=b.length;for(var h=this.attributeCount-1;0<=h;--h)this.bufferUpdateRanges[b[h]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}};SPE.Emitter.prototype._calculatePPSValue=function(b){var h=this.particleCount;this.duration?this.particlesPerSecond=h/(b<this.duration?b:this.duration):this.particlesPerSecond=h/b};
SPE.Emitter.prototype._setAttributeOffset=function(b){this.activationIndex=this.attributeOffset=b;this.activationEnd=b+this.particleCount};
SPE.Emitter.prototype._assignValue=function(b,h){switch(b){case "position":this._assignPositionValue(h);break;case "velocity":case "acceleration":this._assignForceValue(h,b);break;case "size":case "opacity":this._assignAbsLifetimeValue(h,b);break;case "angle":this._assignAngleValue(h);break;case "params":this._assignParamsValue(h);break;case "rotation":this._assignRotationValue(h);break;case "color":this._assignColorValue(h)}};
SPE.Emitter.prototype._assignPositionValue=function(b){var h=SPE.distributions,l=SPE.utils,e=this.position,r=this.attributes.position,q=e._value,k=e._spread;switch(e._distribution){case h.BOX:l.randomVector3(r,b,q,k,e._spreadClamp);break;case h.SPHERE:l.randomVector3OnSphere(r,b,q,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x,e._distributionClamp||this.particleCount);break;case h.DISC:l.randomVector3OnDisc(r,b,q,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x)}};
SPE.Emitter.prototype._assignForceValue=function(b,h){var l=SPE.distributions;var e=SPE.utils,r=this[h];var q=r._value;var k=r._spread;switch(r._distribution){case l.BOX:e.randomVector3(this.attributes[h],b,q,k);break;case l.SPHERE:k=this.attributes.position.typedArray.array;var t=3*b;l=k[t];q=k[t+1];k=k[t+2];e.randomDirectionVector3OnSphere(this.attributes[h],b,l,q,k,this.position._value,r._value.x,r._spread.x);break;case l.DISC:k=this.attributes.position.typedArray.array,t=3*b,l=k[t],q=k[t+1],k=
k[t+2],e.randomDirectionVector3OnDisc(this.attributes[h],b,l,q,k,this.position._value,r._value.x,r._spread.x)}"acceleration"===h&&(h=e.clamp(e.randomFloat(this.drag._value,this.drag._spread),0,1),this.attributes.acceleration.typedArray.array[4*b+3]=h)};
SPE.Emitter.prototype._assignAbsLifetimeValue=function(b,h){var l,e=this.attributes[h].typedArray;h=this[h];var r=SPE.utils;r.arrayValuesAreEqual(h._value)&&r.arrayValuesAreEqual(h._spread)?(l=Math.abs(r.randomFloat(h._value[0],h._spread[0])),e.setVec4Components(b,l,l,l,l)):e.setVec4Components(b,Math.abs(r.randomFloat(h._value[0],h._spread[0])),Math.abs(r.randomFloat(h._value[1],h._spread[1])),Math.abs(r.randomFloat(h._value[2],h._spread[2])),Math.abs(r.randomFloat(h._value[3],h._spread[3])))};
SPE.Emitter.prototype._assignAngleValue=function(b){var h,l=this.attributes.angle.typedArray,e=this.angle,r=SPE.utils;r.arrayValuesAreEqual(e._value)&&r.arrayValuesAreEqual(e._spread)?(h=r.randomFloat(e._value[0],e._spread[0]),l.setVec4Components(b,h,h,h,h)):l.setVec4Components(b,r.randomFloat(e._value[0],e._spread[0]),r.randomFloat(e._value[1],e._spread[1]),r.randomFloat(e._value[2],e._spread[2]),r.randomFloat(e._value[3],e._spread[3]))};
SPE.Emitter.prototype._assignParamsValue=function(b){this.attributes.params.typedArray.setVec4Components(b,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))};
SPE.Emitter.prototype._assignRotationValue=function(b){this.attributes.rotation.typedArray.setVec3Components(b,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1);this.attributes.rotationCenter.typedArray.setVec3(b,this.rotation._center)};SPE.Emitter.prototype._assignColorValue=function(b){SPE.utils.randomColorAsHex(this.attributes.color,b,this.color._value,this.color._spread)};
SPE.Emitter.prototype._resetParticle=function(b){for(var h,l,e=this.resetFlags,r=this.updateFlags,q=this.updateCounts,k=this.attributeKeys,t=this.attributeCount-1;0<=t;--t)h=k[t],l=r[h],!0!==e[h]&&!0!==l||(this._assignValue(h,b),this._updateAttributeUpdateRange(h,b),!0===l&&q[h]===this.particleCount?(r[h]=!1,q[h]=0):1==l&&++q[h])};SPE.Emitter.prototype._updateAttributeUpdateRange=function(b,h){b=this.bufferUpdateRanges[b];b.min=Math.min(h,b.min);b.max=Math.max(h,b.max)};
SPE.Emitter.prototype._resetBufferRanges=function(){var b=this.bufferUpdateRanges,h=this.bufferUpdateKeys,l=this.bufferUpdateCount-1;for(l;0<=l;--l){var e=h[l];b[e].min=Number.POSITIVE_INFINITY;b[e].max=Number.NEGATIVE_INFINITY}};SPE.Emitter.prototype._onRemove=function(){this.activeParticleCount=this.activationIndex=this.attributeOffset=this.particlesPerSecond=0;this.paramsArray=this.attributes=this.group=null;this.age=0};SPE.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount};
SPE.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount};SPE.Emitter.prototype._checkParticleAges=function(b,h,l,e){for(var r,q,k,t=h-1;t>=b;--t)h=4*t,k=l[h],0!==k&&(q=l[h+1],r=l[h+2],1===this.direction?(q+=e,q>=r&&(q=0,k=0,this._decrementParticleCount())):(q-=e,0>=q&&(q=r,k=0,this._decrementParticleCount())),l[h]=k,l[h+1]=q,this._updateAttributeUpdateRange("params",t))};
SPE.Emitter.prototype._activateParticles=function(b,h,l,e){for(var r,q,k=this.direction,t=b;h>t;++t)r=4*t,0!=l[r]&&1!==this.particleCount||(this._incrementParticleCount(),l[r]=1,this._resetParticle(t),q=e*(t-b),l[r+1]=-1===k?l[r+2]-q:q,this._updateAttributeUpdateRange("params",t))};
SPE.Emitter.prototype.tick=function(b){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var h=this.attributeOffset,l=h+this.particleCount,e=this.paramsArray,r=this.particlesPerSecond*this.activeMultiplier*b,q=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(h,l,e,b),!1===this.alive)return void(this.age=0);if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);q=1===this.particleCount?q:0|
q;var k=Math.min(q+r,this.activationEnd),t=k-this.activationIndex|0;this._activateParticles(q,k,e,0<t?b/t:0);this.activationIndex+=r;this.activationIndex>l&&(this.activationIndex=h);this.age+=b}};SPE.Emitter.prototype.reset=function(b){if(this.age=0,this.alive=!1,!0===b){for(var h=this.attributeOffset,l=this.paramsArray,e=this.attributes.params.bufferAttribute,r=h+this.particleCount-1;r>=h;--r)b=4*r,l[b]=0,l[b+1]=0;e.updateRange.offset=0;e.updateRange.count=-1;e.needsUpdate=!0}return this};
SPE.Emitter.prototype.enable=function(){return this.alive=!0,this};SPE.Emitter.prototype.disable=function(){return this.alive=!1,this};SPE.Emitter.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this};
var __extends=this&&this.__extends||function(b,h){function l(){this.constructor=b}for(var e in h)h.hasOwnProperty(e)&&(b[e]=h[e]);b.prototype=null===h?Object.create(h):(l.prototype=h.prototype,new l)},spine;
(function(b){var h=function(){function k(t,p,y){if(null==t)throw Error("name cannot be null.");if(null==p)throw Error("timelines cannot be null.");this.name=t;this.timelines=p;this.duration=y}k.prototype.apply=function(t,p,y,A,E,B,G,I){if(null==t)throw Error("skeleton cannot be null.");A&&0!=this.duration&&(y%=this.duration,0<p&&(p%=this.duration));A=this.timelines;for(var L=0,T=A.length;L<T;L++)A[L].apply(t,p,y,E,B,G,I)};k.binarySearch=function(t,p,y){void 0===y&&(y=1);var A=0,E=t.length/y-2;if(0==
E)return y;for(var B=E>>>1;;){t[(B+1)*y]<=p?A=B+1:E=B;if(A==E)return(A+1)*y;B=A+E>>>1}};k.linearSearch=function(t,p,y){for(var A=0,E=t.length-y;A<=E;A+=y)if(t[A]>p)return A;return-1};return k}();b.Animation=h;(function(k){k[k.rotate=0]="rotate";k[k.translate=1]="translate";k[k.scale=2]="scale";k[k.shear=3]="shear";k[k.attachment=4]="attachment";k[k.color=5]="color";k[k.deform=6]="deform";k[k.event=7]="event";k[k.drawOrder=8]="drawOrder";k[k.ikConstraint=9]="ikConstraint";k[k.transformConstraint=10]=
"transformConstraint";k[k.pathConstraintPosition=11]="pathConstraintPosition";k[k.pathConstraintSpacing=12]="pathConstraintSpacing";k[k.pathConstraintMix=13]="pathConstraintMix"})(b.TimelineType||(b.TimelineType={}));var l=b.TimelineType,e=function(){function k(t){if(0>=t)throw Error("frameCount must be > 0: "+t);this.curves=b.Utils.newFloatArray((t-1)*k.BEZIER_SIZE)}k.prototype.getFrameCount=function(){return this.curves.length/k.BEZIER_SIZE+1};k.prototype.setLinear=function(t){this.curves[t*k.BEZIER_SIZE]=
k.LINEAR};k.prototype.setStepped=function(t){this.curves[t*k.BEZIER_SIZE]=k.STEPPED};k.prototype.getCurveType=function(t){t*=k.BEZIER_SIZE;if(t==this.curves.length)return k.LINEAR;t=this.curves[t];return t==k.LINEAR?k.LINEAR:t==k.STEPPED?k.STEPPED:k.BEZIER};k.prototype.setCurve=function(t,p,y,A,E){var B=.03*(2*-p+A),G=.03*(2*-y+E);A=.006*(3*(p-A)+1);E=.006*(3*(y-E)+1);var I=2*B+A,L=2*G+E;p=.3*p+B+.16666667*A;y=.3*y+G+.16666667*E;t*=k.BEZIER_SIZE;G=this.curves;G[t++]=k.BEZIER;B=p;for(var T=y,n=t+k.BEZIER_SIZE-
1;t<n;t+=2)G[t]=B,G[t+1]=T,p+=I,y+=L,I+=A,L+=E,B+=p,T+=y};k.prototype.getCurvePercent=function(t,p){p=b.MathUtils.clamp(p,0,1);var y=this.curves;t*=k.BEZIER_SIZE;var A=y[t];if(A==k.LINEAR)return p;if(A==k.STEPPED)return 0;t++;A=0;for(var E=t,B=t+k.BEZIER_SIZE-1;t<B;t+=2)if(A=y[t],A>=p)return t==E?B=E=0:(E=y[t-2],B=y[t-1]),B+(y[t+1]-B)*(p-E)/(A-E);y=y[t-1];return y+(1-y)*(p-A)/(1-A)};k.LINEAR=0;k.STEPPED=1;k.BEZIER=2;k.BEZIER_SIZE=19;return k}();b.CurveTimeline=e;var r=function(k){function t(p){k.call(this,
p);this.frames=b.Utils.newFloatArray(p<<1)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.rotate<<24)+this.boneIndex};t.prototype.setFrame=function(p,y,A){p<<=1;this.frames[p]=y;this.frames[p+t.ROTATION]=A};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.bones[this.boneIndex];if(A<y[0])G&&(p.rotation=p.data.rotation);else if(A>=y[y.length-t.ENTRIES])G?p.rotation=p.data.rotation+y[y.length+t.PREV_ROTATION]*B:(G=p.data.rotation+y[y.length+t.PREV_ROTATION]-p.rotation,p.rotation+=
(G-360*(16384-(16384.499999999996-G/360|0)))*B);else{I=h.binarySearch(y,A,t.ENTRIES);E=y[I+t.PREV_ROTATION];var L=y[I];A=this.getCurvePercent((I>>1)-1,1-(A-L)/(y[I+t.PREV_TIME]-L));y=y[I+t.ROTATION]-E;y=E+(y-360*(16384-(16384.499999999996-y/360|0)))*A;G?p.rotation=p.data.rotation+(y-360*(16384-(16384.499999999996-y/360|0)))*B:(y=p.data.rotation+y-p.rotation,p.rotation+=(y-360*(16384-(16384.499999999996-y/360|0)))*B)}};t.ENTRIES=2;t.PREV_TIME=-2;t.PREV_ROTATION=-1;t.ROTATION=1;return t}(e);b.RotateTimeline=
r;r=function(k){function t(p){k.call(this,p);this.frames=b.Utils.newFloatArray(p*t.ENTRIES)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.translate<<24)+this.boneIndex};t.prototype.setFrame=function(p,y,A,E){p*=t.ENTRIES;this.frames[p]=y;this.frames[p+t.X]=A;this.frames[p+t.Y]=E};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.bones[this.boneIndex];if(A<y[0])G&&(p.x=p.data.x,p.y=p.data.y);else{if(A>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_X],I=y[y.length+t.PREV_Y];else{var L=
h.binarySearch(y,A,t.ENTRIES);E=y[L+t.PREV_X];I=y[L+t.PREV_Y];var T=y[L];A=this.getCurvePercent(L/t.ENTRIES-1,1-(A-T)/(y[L+t.PREV_TIME]-T));E+=(y[L+t.X]-E)*A;I+=(y[L+t.Y]-I)*A}G?(p.x=p.data.x+E*B,p.y=p.data.y+I*B):(p.x+=(p.data.x+E-p.x)*B,p.y+=(p.data.y+I-p.y)*B)}};t.ENTRIES=3;t.PREV_TIME=-3;t.PREV_X=-2;t.PREV_Y=-1;t.X=1;t.Y=2;return t}(e);b.TranslateTimeline=r;var q=function(k){function t(p){k.call(this,p)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.scale<<24)+this.boneIndex};t.prototype.apply=
function(p,y,A,E,B,G,I){var L=this.frames;p=p.bones[this.boneIndex];if(A<L[0])G&&(p.scaleX=p.data.scaleX,p.scaleY=p.data.scaleY);else{if(A>=L[L.length-t.ENTRIES])y=L[L.length+t.PREV_X]*p.data.scaleX,E=L[L.length+t.PREV_Y]*p.data.scaleY;else{var T=h.binarySearch(L,A,t.ENTRIES);y=L[T+t.PREV_X];E=L[T+t.PREV_Y];var n=L[T];A=this.getCurvePercent(T/t.ENTRIES-1,1-(A-n)/(L[T+t.PREV_TIME]-n));y=(y+(L[T+t.X]-y)*A)*p.data.scaleX;E=(E+(L[T+t.Y]-E)*A)*p.data.scaleY}1==B?(p.scaleX=y,p.scaleY=E):(G?(G=p.data.scaleX,
A=p.data.scaleY):(G=p.scaleX,A=p.scaleY),I?(y=Math.abs(y)*b.MathUtils.signum(G),E=Math.abs(E)*b.MathUtils.signum(A)):(G=Math.abs(G)*b.MathUtils.signum(y),A=Math.abs(A)*b.MathUtils.signum(E)),p.scaleX=G+(y-G)*B,p.scaleY=A+(E-A)*B)}};return t}(r);b.ScaleTimeline=q;r=function(k){function t(p){k.call(this,p)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.shear<<24)+this.boneIndex};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.bones[this.boneIndex];if(A<y[0])G&&(p.shearX=p.data.shearX,
p.shearY=p.data.shearY);else{if(A>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_X],I=y[y.length+t.PREV_Y];else{var L=h.binarySearch(y,A,t.ENTRIES);E=y[L+t.PREV_X];I=y[L+t.PREV_Y];var T=y[L];A=this.getCurvePercent(L/t.ENTRIES-1,1-(A-T)/(y[L+t.PREV_TIME]-T));E+=(y[L+t.X]-E)*A;I+=(y[L+t.Y]-I)*A}G?(p.shearX=p.data.shearX+E*B,p.shearY=p.data.shearY+I*B):(p.shearX+=(p.data.shearX+E-p.shearX)*B,p.shearY+=(p.data.shearY+I-p.shearY)*B)}};return t}(r);b.ShearTimeline=r;r=function(k){function t(p){k.call(this,
p);this.frames=b.Utils.newFloatArray(p*t.ENTRIES)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.color<<24)+this.slotIndex};t.prototype.setFrame=function(p,y,A,E,B,G){p*=t.ENTRIES;this.frames[p]=y;this.frames[p+t.R]=A;this.frames[p+t.G]=E;this.frames[p+t.B]=B;this.frames[p+t.A]=G};t.prototype.apply=function(p,y,A,E,B,G,I){p=p.slots[this.slotIndex];var L=this.frames;if(A<L[0])G&&p.color.setFromColor(p.data.color);else{if(A>=L[L.length-t.ENTRIES]){A=L.length;y=L[A+t.PREV_R];E=L[A+t.PREV_G];
I=L[A+t.PREV_B];var T=L[A+t.PREV_A]}else{var n=h.binarySearch(L,A,t.ENTRIES);y=L[n+t.PREV_R];E=L[n+t.PREV_G];I=L[n+t.PREV_B];T=L[n+t.PREV_A];var x=L[n];A=this.getCurvePercent(n/t.ENTRIES-1,1-(A-x)/(L[n+t.PREV_TIME]-x));y+=(L[n+t.R]-y)*A;E+=(L[n+t.G]-E)*A;I+=(L[n+t.B]-I)*A;T+=(L[n+t.A]-T)*A}1==B?p.color.set(y,E,I,T):(A=p.color,G&&A.setFromColor(p.data.color),A.add((y-A.r)*B,(E-A.g)*B,(I-A.b)*B,(T-A.a)*B))}};t.ENTRIES=5;t.PREV_TIME=-5;t.PREV_R=-4;t.PREV_G=-3;t.PREV_B=-2;t.PREV_A=-1;t.R=1;t.G=2;t.B=
3;t.A=4;return t}(e);b.ColorTimeline=r;r=function(){function k(t){this.frames=b.Utils.newFloatArray(t);this.attachmentNames=Array(t)}k.prototype.getPropertyId=function(){return(l.attachment<<24)+this.slotIndex};k.prototype.getFrameCount=function(){return this.frames.length};k.prototype.setFrame=function(t,p,y){this.frames[t]=p;this.attachmentNames[t]=y};k.prototype.apply=function(t,p,y,A,E,B,G){p=t.slots[this.slotIndex];G&&B?(y=p.data.attachmentName,p.setAttachment(null==y?null:t.getAttachment(this.slotIndex,
y))):(G=this.frames,y<G[0]?B&&(y=p.data.attachmentName,p.setAttachment(null==y?null:t.getAttachment(this.slotIndex,y))):(y=y>=G[G.length-1]?G.length-1:h.binarySearch(G,y,1)-1,y=this.attachmentNames[y],t.slots[this.slotIndex].setAttachment(null==y?null:t.getAttachment(this.slotIndex,y))))};return k}();b.AttachmentTimeline=r;r=function(k){function t(p){k.call(this,p);this.frames=b.Utils.newFloatArray(p);this.frameVertices=Array(p)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.deform<<
24)+this.slotIndex};t.prototype.setFrame=function(p,y,A){this.frames[p]=y;this.frameVertices[p]=A};t.prototype.apply=function(p,y,A,E,B,G,I){p=p.slots[this.slotIndex];var L=p.getAttachment();if(L instanceof b.VertexAttachment&&L.applyDeform(this.attachment)){var T=this.frames;y=p.attachmentVertices;if(A<T[0])G&&b.Utils.setArraySize(y,0);else if(I=this.frameVertices,p=I[0].length,y.length!=p&&(B=1),y=b.Utils.setArraySize(y,p),A>=T[T.length-1])if(A=I[T.length-1],1==B)b.Utils.arrayCopy(A,0,y,0,p);else if(G)if(G=
L,null==G.bones)for(G=G.vertices,L=0;L<p;L++)T=G[L],y[L]=T+(A[L]-T)*B;else for(L=0;L<p;L++)y[L]=A[L]*B;else for(L=0;L<p;L++)y[L]+=(A[L]-y[L])*B;else{var n=h.binarySearch(T,A);E=I[n-1];I=I[n];var x=T[n];A=this.getCurvePercent(n-1,1-(A-x)/(T[n-1]-x));if(1==B)for(L=0;L<p;L++)n=E[L],y[L]=n+(I[L]-n)*A;else if(G)if(G=L,null==G.bones)for(G=G.vertices,L=0;L<p;L++)n=E[L],T=G[L],y[L]=T+(n+(I[L]-n)*A-T)*B;else for(L=0;L<p;L++)n=E[L],y[L]=(n+(I[L]-n)*A)*B;else for(L=0;L<p;L++)n=E[L],y[L]+=(n+(I[L]-n)*A-y[L])*
B}}};return t}(e);b.DeformTimeline=r;r=function(){function k(t){this.frames=b.Utils.newFloatArray(t);this.events=Array(t)}k.prototype.getPropertyId=function(){return l.event<<24};k.prototype.getFrameCount=function(){return this.frames.length};k.prototype.setFrame=function(t,p){this.frames[t]=p.time;this.events[t]=p};k.prototype.apply=function(t,p,y,A,E,B,G){if(null!=A){var I=this.frames,L=this.frames.length;if(p>y)this.apply(t,p,Number.MAX_VALUE,A,E,B,G),p=-1;else if(p>=I[L-1])return;if(!(y<I[0])){if(p<
I[0])t=0;else for(t=h.binarySearch(I,p),p=I[t];0<t&&I[t-1]==p;)t--;for(;t<L&&y>=I[t];t++)A.push(this.events[t])}}};return k}();b.EventTimeline=r;r=function(){function k(t){this.frames=b.Utils.newFloatArray(t);this.drawOrders=Array(t)}k.prototype.getPropertyId=function(){return l.drawOrder<<24};k.prototype.getFrameCount=function(){return this.frames.length};k.prototype.setFrame=function(t,p,y){this.frames[t]=p;this.drawOrders[t]=y};k.prototype.apply=function(t,p,y,A,E,B,G){p=t.drawOrder;A=t.slots;
if(G&&B)b.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else if(G=this.frames,y<G[0])B&&b.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else if(t=y>=G[G.length-1]?G.length-1:h.binarySearch(G,y)-1,t=this.drawOrders[t],null==t)b.Utils.arrayCopy(A,0,p,0,A.length);else for(y=0,B=t.length;y<B;y++)p[y]=A[t[y]]};return k}();b.DrawOrderTimeline=r;r=function(k){function t(p){k.call(this,p);this.frames=b.Utils.newFloatArray(p*t.ENTRIES)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.ikConstraint<<
24)+this.ikConstraintIndex};t.prototype.setFrame=function(p,y,A,E){p*=t.ENTRIES;this.frames[p]=y;this.frames[p+t.MIX]=A;this.frames[p+t.BEND_DIRECTION]=E};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.ikConstraints[this.ikConstraintIndex];if(A<y[0])G&&(p.mix=p.data.mix,p.bendDirection=p.data.bendDirection);else if(A>=y[y.length-t.ENTRIES])G?(p.mix=p.data.mix+(y[y.length+t.PREV_MIX]-p.data.mix)*B,p.bendDirection=I?p.data.bendDirection:y[y.length+t.PREV_BEND_DIRECTION]):(p.mix+=(y[y.length+
t.PREV_MIX]-p.mix)*B,I||(p.bendDirection=y[y.length+t.PREV_BEND_DIRECTION]));else{E=h.binarySearch(y,A,t.ENTRIES);var L=y[E+t.PREV_MIX],T=y[E];A=this.getCurvePercent(E/t.ENTRIES-1,1-(A-T)/(y[E+t.PREV_TIME]-T));G?(p.mix=p.data.mix+(L+(y[E+t.MIX]-L)*A-p.data.mix)*B,p.bendDirection=I?p.data.bendDirection:y[E+t.PREV_BEND_DIRECTION]):(p.mix+=(L+(y[E+t.MIX]-L)*A-p.mix)*B,I||(p.bendDirection=y[E+t.PREV_BEND_DIRECTION]))}};t.ENTRIES=3;t.PREV_TIME=-3;t.PREV_MIX=-2;t.PREV_BEND_DIRECTION=-1;t.MIX=1;t.BEND_DIRECTION=
2;return t}(e);b.IkConstraintTimeline=r;r=function(k){function t(p){k.call(this,p);this.frames=b.Utils.newFloatArray(p*t.ENTRIES)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.transformConstraint<<24)+this.transformConstraintIndex};t.prototype.setFrame=function(p,y,A,E,B,G){p*=t.ENTRIES;this.frames[p]=y;this.frames[p+t.ROTATE]=A;this.frames[p+t.TRANSLATE]=E;this.frames[p+t.SCALE]=B;this.frames[p+t.SHEAR]=G};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.transformConstraints[this.transformConstraintIndex];
if(A<y[0])G&&(G=p.data,p.rotateMix=G.rotateMix,p.translateMix=G.rotateMix,p.scaleMix=G.scaleMix,p.shearMix=G.shearMix);else{if(A>=y[y.length-t.ENTRIES]){A=y.length;E=y[A+t.PREV_ROTATE];I=y[A+t.PREV_TRANSLATE];var L=y[A+t.PREV_SCALE];var T=y[A+t.PREV_SHEAR]}else{var n=h.binarySearch(y,A,t.ENTRIES);E=y[n+t.PREV_ROTATE];I=y[n+t.PREV_TRANSLATE];L=y[n+t.PREV_SCALE];T=y[n+t.PREV_SHEAR];var x=y[n];A=this.getCurvePercent(n/t.ENTRIES-1,1-(A-x)/(y[n+t.PREV_TIME]-x));E+=(y[n+t.ROTATE]-E)*A;I+=(y[n+t.TRANSLATE]-
I)*A;L+=(y[n+t.SCALE]-L)*A;T+=(y[n+t.SHEAR]-T)*A}G?(G=p.data,p.rotateMix=G.rotateMix+(E-G.rotateMix)*B,p.translateMix=G.translateMix+(I-G.translateMix)*B,p.scaleMix=G.scaleMix+(L-G.scaleMix)*B,p.shearMix=G.shearMix+(T-G.shearMix)*B):(p.rotateMix+=(E-p.rotateMix)*B,p.translateMix+=(I-p.translateMix)*B,p.scaleMix+=(L-p.scaleMix)*B,p.shearMix+=(T-p.shearMix)*B)}};t.ENTRIES=5;t.PREV_TIME=-5;t.PREV_ROTATE=-4;t.PREV_TRANSLATE=-3;t.PREV_SCALE=-2;t.PREV_SHEAR=-1;t.ROTATE=1;t.TRANSLATE=2;t.SCALE=3;t.SHEAR=
4;return t}(e);b.TransformConstraintTimeline=r;r=function(k){function t(p){k.call(this,p);this.frames=b.Utils.newFloatArray(p*t.ENTRIES)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.pathConstraintPosition<<24)+this.pathConstraintIndex};t.prototype.setFrame=function(p,y,A){p*=t.ENTRIES;this.frames[p]=y;this.frames[p+t.VALUE]=A};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.pathConstraints[this.pathConstraintIndex];if(A<y[0])G&&(p.position=p.data.position);else{if(A>=y[y.length-
t.ENTRIES])E=y[y.length+t.PREV_VALUE];else{I=h.binarySearch(y,A,t.ENTRIES);E=y[I+t.PREV_VALUE];var L=y[I];A=this.getCurvePercent(I/t.ENTRIES-1,1-(A-L)/(y[I+t.PREV_TIME]-L));E+=(y[I+t.VALUE]-E)*A}p.position=G?p.data.position+(E-p.data.position)*B:p.position+(E-p.position)*B}};t.ENTRIES=2;t.PREV_TIME=-2;t.PREV_VALUE=-1;t.VALUE=1;return t}(e);b.PathConstraintPositionTimeline=r;r=function(k){function t(p){k.call(this,p)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.pathConstraintSpacing<<
24)+this.pathConstraintIndex};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.pathConstraints[this.pathConstraintIndex];if(A<y[0])G&&(p.spacing=p.data.spacing);else{if(A>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_VALUE];else{I=h.binarySearch(y,A,t.ENTRIES);E=y[I+t.PREV_VALUE];var L=y[I];A=this.getCurvePercent(I/t.ENTRIES-1,1-(A-L)/(y[I+t.PREV_TIME]-L));E+=(y[I+t.VALUE]-E)*A}p.spacing=G?p.data.spacing+(E-p.data.spacing)*B:p.spacing+(E-p.spacing)*B}};return t}(r);b.PathConstraintSpacingTimeline=
r;e=function(k){function t(p){k.call(this,p);this.frames=b.Utils.newFloatArray(p*t.ENTRIES)}__extends(t,k);t.prototype.getPropertyId=function(){return(l.pathConstraintMix<<24)+this.pathConstraintIndex};t.prototype.setFrame=function(p,y,A,E){p*=t.ENTRIES;this.frames[p]=y;this.frames[p+t.ROTATE]=A;this.frames[p+t.TRANSLATE]=E};t.prototype.apply=function(p,y,A,E,B,G,I){y=this.frames;p=p.pathConstraints[this.pathConstraintIndex];if(A<y[0])G&&(p.rotateMix=p.data.rotateMix,p.translateMix=p.data.translateMix);
else{if(A>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_ROTATE],I=y[y.length+t.PREV_TRANSLATE];else{var L=h.binarySearch(y,A,t.ENTRIES);E=y[L+t.PREV_ROTATE];I=y[L+t.PREV_TRANSLATE];var T=y[L];A=this.getCurvePercent(L/t.ENTRIES-1,1-(A-T)/(y[L+t.PREV_TIME]-T));E+=(y[L+t.ROTATE]-E)*A;I+=(y[L+t.TRANSLATE]-I)*A}G?(p.rotateMix=p.data.rotateMix+(E-p.data.rotateMix)*B,p.translateMix=p.data.translateMix+(I-p.data.translateMix)*B):(p.rotateMix+=(E-p.rotateMix)*B,p.translateMix+=(I-p.translateMix)*B)}};t.ENTRIES=
3;t.PREV_TIME=-3;t.PREV_ROTATE=-2;t.PREV_TRANSLATE=-1;t.ROTATE=1;t.TRANSLATE=2;return t}(e);b.PathConstraintMixTimeline=e})(spine||(spine={}));
(function(b){var h=function(){function q(k){this.tracks=[];this.events=[];this.listeners=[];this.queue=new e(this);this.propertyIDs=new b.IntSet;this.animationsChanged=!1;this.timeScale=1;this.trackEntryPool=new b.Pool(function(){return new l});this.data=k}q.prototype.update=function(k){k*=this.timeScale;for(var t=this.tracks,p=0,y=t.length;p<y;p++){var A=t[p];if(null!=A){A.animationLast=A.nextAnimationLast;A.trackLast=A.nextTrackLast;var E=k*A.timeScale;if(0<A.delay){A.delay-=E;if(0<A.delay)continue;
E=-A.delay;A.delay=0}var B=A.next;if(null!=B){var G=A.trackLast-B.delay;if(0<=G){B.delay=0;B.trackTime=G+k*B.timeScale;A.trackTime+=E;for(this.setCurrent(p,B);null!=B.mixingFrom;)B.mixTime+=E,B=B.mixingFrom;continue}}else if(A.trackLast>=A.trackEnd&&null==A.mixingFrom){t[p]=null;this.queue.end(A);this.disposeNext(A);continue}this.updateMixingFrom(A,k);A.trackTime+=E}}this.queue.drain()};q.prototype.updateMixingFrom=function(k,t){var p=k.mixingFrom;null!=p&&(this.updateMixingFrom(p,t),k.mixTime>=k.mixDuration&&
null!=p.mixingFrom&&0<k.mixTime?(k.mixingFrom=null,this.queue.end(p)):(p.animationLast=p.nextAnimationLast,p.trackLast=p.nextTrackLast,p.trackTime+=t*p.timeScale,k.mixTime+=t*p.timeScale))};q.prototype.apply=function(k){if(null==k)throw Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var t=this.events,p=this.tracks,y=0,A=p.length;y<A;y++){var E=p[y];if(!(null==E||0<E.delay)){var B=E.alpha;null!=E.mixingFrom?B*=this.applyMixingFrom(E,k):E.trackTime>=E.trackEnd&&
(B=0);var G=E.animationLast,I=E.getAnimationTime(),L=E.animation.timelines.length,T=E.animation.timelines;if(1==B)for(var n=0;n<L;n++)T[n].apply(k,G,I,t,1,!0,!1);else{var x=0==E.timelinesRotation.length;x&&b.Utils.setArraySize(E.timelinesRotation,L<<1,null);var H=E.timelinesRotation,f=E.timelinesFirst;for(n=0;n<L;n++){var m=T[n];m instanceof b.RotateTimeline?this.applyRotateTimeline(m,k,I,B,f[n],H,n<<1,x):m.apply(k,G,I,t,B,f[n],!1)}}this.queueEvents(E,I);E.nextAnimationLast=I;E.nextTrackLast=E.trackTime}}this.queue.drain()};
q.prototype.applyMixingFrom=function(k,t){var p=k.mixingFrom;null!=p.mixingFrom&&this.applyMixingFrom(p,t);var y;0==k.mixDuration?y=1:(y=k.mixTime/k.mixDuration,1<y&&(y=1));var A=y<p.eventThreshold?this.events:null,E=y<p.attachmentThreshold,B=y<p.drawOrderThreshold,G=p.animationLast,I=p.getAnimationTime(),L=p.animation.timelines.length,T=p.animation.timelines,n=p.timelinesFirst;k=p.alpha*k.mixAlpha*(1-y);var x=0==p.timelinesRotation.length;x&&b.Utils.setArraySize(p.timelinesRotation,L<<1,null);for(var H=
p.timelinesRotation,f=0;f<L;f++){var m=T[f],v=n[f];if(m instanceof b.RotateTimeline)this.applyRotateTimeline(m,t,I,k,v,H,f<<1,x);else{if(!v){if(!E&&m instanceof b.AttachmentTimeline)continue;if(!B&&m instanceof b.DrawOrderTimeline)continue}m.apply(t,G,I,A,k,v,!0)}}this.queueEvents(p,I);p.nextAnimationLast=I;p.nextTrackLast=p.trackTime;return y};q.prototype.applyRotateTimeline=function(k,t,p,y,A,E,B,G){if(1==y)k.apply(t,0,p,null,1,A,!1);else{var I=k.frames;t=t.bones[k.boneIndex];if(p<I[0])A&&(t.rotation=
t.data.rotation);else{if(p>=I[I.length-b.RotateTimeline.ENTRIES])I=t.data.rotation+I[I.length+b.RotateTimeline.PREV_ROTATION];else{var L=b.Animation.binarySearch(I,p,b.RotateTimeline.ENTRIES),T=I[L+b.RotateTimeline.PREV_ROTATION],n=I[L];k=k.getCurvePercent((L>>1)-1,1-(p-n)/(I[L+b.RotateTimeline.PREV_TIME]-n));I=I[L+b.RotateTimeline.ROTATION]-T;I=T+(I-360*(16384-(16384.499999999996-I/360|0)))*k+t.data.rotation;I-=360*(16384-(16384.499999999996-I/360|0))}A=A?t.data.rotation:t.rotation;I-=A;0==I?p=G?
E[B]=0:E[B]:(I-=360*(16384-(16384.499999999996-I/360|0)),G?(G=0,p=I):(G=E[B],p=E[B+1]),T=0<I,k=0<=G,b.MathUtils.signum(p)!=b.MathUtils.signum(I)&&90>=Math.abs(p)&&(180<Math.abs(G)&&(G+=360*b.MathUtils.signum(G)),k=T),p=I+G-G%360,k!=T&&(p+=360*b.MathUtils.signum(G)),E[B]=p);E[B+1]=I;A+=p*y;t.rotation=A-360*(16384-(16384.499999999996-A/360|0))}}};q.prototype.queueEvents=function(k,t){for(var p=k.animationStart,y=k.animationEnd,A=y-p,E=k.trackLast%A,B=this.events,G=0,I=B.length;G<I;G++){var L=B[G];if(L.time<
E)break;L.time>y||this.queue.event(k,L)}for((k.loop?E>k.trackTime%A:t>=y&&k.animationLast<y)&&this.queue.complete(k);G<I;G++)B[G].time<p||this.queue.event(k,B[G]);this.events.length=0};q.prototype.clearTracks=function(){this.queue.drainDisabled=!0;for(var k=0,t=this.tracks.length;k<t;k++)this.clearTrack(k);this.tracks.length=0;this.queue.drainDisabled=!1;this.queue.drain()};q.prototype.clearTrack=function(k){if(!(k>=this.tracks.length)&&(k=this.tracks[k],null!=k)){this.queue.end(k);this.disposeNext(k);
for(var t=k;;){var p=t.mixingFrom;if(null==p)break;this.queue.end(p);t.mixingFrom=null;t=p}this.tracks[k.trackIndex]=null;this.queue.drain()}};q.prototype.setCurrent=function(k,t){var p=this.expandToIndex(k);this.tracks[k]=t;null!=p&&(this.queue.interrupt(p),t.mixingFrom=p,t.mixTime=0,null!=p.mixingFrom&&(t.mixAlpha*=Math.min(p.mixTime/p.mixDuration,1)));this.queue.start(t)};q.prototype.setAnimation=function(k,t,p){var y=this.data.skeletonData.findAnimation(t);if(null==y)throw Error("Animation not found: "+
t);return this.setAnimationWith(k,y,p)};q.prototype.setAnimationWith=function(k,t,p){if(null==t)throw Error("animation cannot be null.");var y=this.expandToIndex(k);null!=y&&(-1==y.nextTrackLast?(this.tracks[k]=y.mixingFrom,this.queue.interrupt(y),this.queue.end(y),this.disposeNext(y),y=y.mixingFrom):this.disposeNext(y));t=this.trackEntry(k,t,p,y);this.setCurrent(k,t);this.queue.drain();return t};q.prototype.addAnimation=function(k,t,p,y){var A=this.data.skeletonData.findAnimation(t);if(null==A)throw Error("Animation not found: "+
t);return this.addAnimationWith(k,A,p,y)};q.prototype.addAnimationWith=function(k,t,p,y){if(null==t)throw Error("animation cannot be null.");var A=this.expandToIndex(k);if(null!=A)for(;null!=A.next;)A=A.next;p=this.trackEntry(k,t,p,A);null==A?(this.setCurrent(k,p),this.queue.drain()):(A.next=p,0>=y&&(k=A.animationEnd-A.animationStart,y=0!=k?y+(k*(1+(A.trackTime/k|0))-this.data.getMix(A.animation,t)):0));p.delay=y;return p};q.prototype.setEmptyAnimation=function(k,t){k=this.setAnimationWith(k,q.emptyAnimation,
!1);k.mixDuration=t;k.trackEnd=t;return k};q.prototype.addEmptyAnimation=function(k,t,p){0>=p&&(p-=t);k=this.addAnimationWith(k,q.emptyAnimation,!1,p);k.mixDuration=t;k.trackEnd=t;return k};q.prototype.setEmptyAnimations=function(k){this.queue.drainDisabled=!0;for(var t=0,p=this.tracks.length;t<p;t++){var y=this.tracks[t];null!=y&&this.setEmptyAnimation(y.trackIndex,k)}this.queue.drainDisabled=!1;this.queue.drain()};q.prototype.expandToIndex=function(k){if(k<this.tracks.length)return this.tracks[k];
b.Utils.ensureArrayCapacity(this.tracks,k-this.tracks.length+1,null);this.tracks.length=k+1;return null};q.prototype.trackEntry=function(k,t,p,y){var A=this.trackEntryPool.obtain();A.trackIndex=k;A.animation=t;A.loop=p;A.eventThreshold=0;A.attachmentThreshold=0;A.drawOrderThreshold=0;A.animationStart=0;A.animationEnd=t.duration;A.animationLast=-1;A.nextAnimationLast=-1;A.delay=0;A.trackTime=0;A.trackLast=-1;A.nextTrackLast=-1;A.trackEnd=p?Number.MAX_VALUE:A.animationEnd;A.timeScale=1;A.alpha=1;A.mixAlpha=
1;A.mixTime=0;A.mixDuration=null==y?0:this.data.getMix(y.animation,t);return A};q.prototype.disposeNext=function(k){for(var t=k.next;null!=t;)this.queue.dispose(t),t=t.next;k.next=null};q.prototype._animationsChanged=function(){this.animationsChanged=!1;var k=0,t=this.tracks.length;for(this.propertyIDs.clear();k<t;k++){var p=this.tracks[k];if(null!=p){this.setTimelinesFirst(p);k++;break}}for(;k<t;k++)p=this.tracks[k],null!=p&&this.checkTimelinesFirst(p)};q.prototype.setTimelinesFirst=function(k){if(null!=
k.mixingFrom)this.setTimelinesFirst(k.mixingFrom),this.checkTimelinesUsage(k,k.timelinesFirst);else{var t=this.propertyIDs,p=k.animation.timelines,y=p.length;k=b.Utils.setArraySize(k.timelinesFirst,y,!1);for(var A=0;A<y;A++)t.add(p[A].getPropertyId()),k[A]=!0}};q.prototype.checkTimelinesFirst=function(k){null!=k.mixingFrom&&this.checkTimelinesFirst(k.mixingFrom);this.checkTimelinesUsage(k,k.timelinesFirst)};q.prototype.checkTimelinesUsage=function(k,t){var p=this.propertyIDs;k=k.animation.timelines;
var y=k.length;t=b.Utils.setArraySize(t,y);for(var A=0;A<y;A++)t[A]=p.add(k[A].getPropertyId())};q.prototype.getCurrent=function(k){return k>=this.tracks.length?null:this.tracks[k]};q.prototype.addListener=function(k){if(null==k)throw Error("listener cannot be null.");this.listeners.push(k)};q.prototype.removeListener=function(k){k=this.listeners.indexOf(k);0<=k&&this.listeners.splice(k,1)};q.prototype.clearListeners=function(){this.listeners.length=0};q.prototype.clearListenerNotifications=function(){this.queue.clear()};
q.emptyAnimation=new b.Animation("<empty>",[],0);return q}();b.AnimationState=h;var l=function(){function q(){this.timelinesFirst=[];this.timelinesRotation=[]}q.prototype.reset=function(){this.listener=this.animation=this.mixingFrom=this.next=null;this.timelinesFirst.length=0;this.timelinesRotation.length=0};q.prototype.getAnimationTime=function(){if(this.loop){var k=this.animationEnd-this.animationStart;return 0==k?this.animationStart:this.trackTime%k+this.animationStart}return Math.min(this.trackTime+
this.animationStart,this.animationEnd)};q.prototype.setAnimationLast=function(k){this.nextAnimationLast=this.animationLast=k};q.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart};q.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};return q}();b.TrackEntry=l;var e=function(){function q(k){this.objects=[];this.drainDisabled=!1;this.animState=k}q.prototype.start=function(k){this.objects.push(r.start);this.objects.push(k);this.animState.animationsChanged=
!0};q.prototype.interrupt=function(k){this.objects.push(r.interrupt);this.objects.push(k)};q.prototype.end=function(k){this.objects.push(r.end);this.objects.push(k);this.animState.animationsChanged=!0};q.prototype.dispose=function(k){this.objects.push(r.dispose);this.objects.push(k)};q.prototype.complete=function(k){this.objects.push(r.complete);this.objects.push(k)};q.prototype.event=function(k,t){this.objects.push(r.event);this.objects.push(k);this.objects.push(t)};q.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=
!0;for(var k=this.objects,t=this.animState.listeners,p=0;p<k.length;p+=2){var y=k[p+1];switch(k[p]){case r.start:null!=y.listener&&y.listener.start&&y.listener.start(y);for(var A=0;A<t.length;A++)t[A].start&&t[A].start(y);break;case r.interrupt:null!=y.listener&&y.listener.interrupt&&y.listener.interrupt(y);for(A=0;A<t.length;A++)t[A].interrupt&&t[A].interrupt(y);break;case r.end:for(null!=y.listener&&y.listener.end&&y.listener.end(y),A=0;A<t.length;A++)t[A].end&&t[A].end(y);case r.dispose:null!=
y.listener&&y.listener.dispose&&y.listener.dispose(y);for(A=0;A<t.length;A++)t[A].dispose&&t[A].dispose(y);this.animState.trackEntryPool.free(y);break;case r.complete:null!=y.listener&&y.listener.complete&&y.listener.complete(y);for(A=0;A<t.length;A++)t[A].complete&&t[A].complete(y);break;case r.event:var E=k[p++ +2];null!=y.listener&&y.listener.event&&y.listener.event(y,E);for(A=0;A<t.length;A++)t[A].event&&t[A].event(y,E)}}this.clear();this.drainDisabled=!1}};q.prototype.clear=function(){this.objects.length=
0};return q}();b.EventQueue=e;(function(q){q[q.start=0]="start";q[q.interrupt=1]="interrupt";q[q.end=2]="end";q[q.dispose=3]="dispose";q[q.complete=4]="complete";q[q.event=5]="event"})(b.EventType||(b.EventType={}));var r=b.EventType;h=function(){function q(){}q.prototype.start=function(k){};q.prototype.interrupt=function(k){};q.prototype.end=function(k){};q.prototype.dispose=function(k){};q.prototype.complete=function(k){};q.prototype.event=function(k,t){};return q}();b.AnimationStateAdapter2=h})(spine||
(spine={}));
(function(b){var h=function(){function l(e){this.animationToMixTime={};this.defaultMix=0;if(null==e)throw Error("skeletonData cannot be null.");this.skeletonData=e}l.prototype.setMix=function(e,r,q){var k=this.skeletonData.findAnimation(e);if(null==k)throw Error("Animation not found: "+e);e=this.skeletonData.findAnimation(r);if(null==e)throw Error("Animation not found: "+r);this.setMixWith(k,e,q)};l.prototype.setMixWith=function(e,r,q){if(null==e)throw Error("from cannot be null.");if(null==r)throw Error("to cannot be null.");
this.animationToMixTime[e.name+r.name]=q};l.prototype.getMix=function(e,r){e=this.animationToMixTime[e.name+r.name];return void 0===e?this.defaultMix:e};return l}();b.AnimationStateData=h})(spine||(spine={}));
(function(b){var h=function(){function l(e,r){void 0===r&&(r="");this.assets={};this.errors={};this.loaded=this.toLoad=0;this.textureLoader=e;this.pathPrefix=r}l.prototype.loadText=function(e,r,q){var k=this;void 0===r&&(r=null);void 0===q&&(q=null);e=this.pathPrefix+e;this.toLoad++;var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(200<=t.status&&300>t.status?(k.assets[e]=t.responseText,r&&r(e,t.responseText)):(k.errors[e]="Couldn't load text "+e+": status "+
t.status+", "+t.responseText,q&&q(e,"Couldn't load text "+e+": status "+t.status+", "+t.responseText)),k.toLoad--,k.loaded++)};t.open("GET",e,!0);t.send()};l.prototype.loadTexture=function(e,r,q){var k=this;void 0===r&&(r=null);void 0===q&&(q=null);e=this.pathPrefix+e;this.toLoad++;var t=new Image;t.crossOrigin="anonymous";t.src=e;t.onload=function(p){p=k.textureLoader(t);k.assets[e]=p;k.toLoad--;k.loaded++;r&&r(e,t)};t.onerror=function(p){k.errors[e]="Couldn't load image "+e;k.toLoad--;k.loaded++;
q&&q(e,"Couldn't load image "+e)}};l.prototype.get=function(e){e=this.pathPrefix+e;return this.assets[e]};l.prototype.remove=function(e){e=this.pathPrefix+e;var r=this.assets[e];r.dispose&&r.dispose();this.assets[e]=null};l.prototype.removeAll=function(){for(var e in this.assets){var r=this.assets[e];r.dispose&&r.dispose()}this.assets={}};l.prototype.isLoadingComplete=function(){return 0==this.toLoad};l.prototype.getToLoad=function(){return this.toLoad};l.prototype.getLoaded=function(){return this.loaded};
l.prototype.dispose=function(){this.removeAll()};l.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length};l.prototype.getErrors=function(){return this.errors};return l}();b.AssetManager=h})(spine||(spine={}));
(function(b){var h=function(){function l(e){this.atlas=e}l.prototype.newRegionAttachment=function(e,r,q){e=this.atlas.findRegion(q);if(null==e)throw Error("Region not found in atlas: "+q+" (region attachment: "+r+")");e.renderObject=e;r=new b.RegionAttachment(r);r.setRegion(e);return r};l.prototype.newMeshAttachment=function(e,r,q){e=this.atlas.findRegion(q);if(null==e)throw Error("Region not found in atlas: "+q+" (mesh attachment: "+r+")");e.renderObject=e;r=new b.MeshAttachment(r);r.region=e;return r};
l.prototype.newBoundingBoxAttachment=function(e,r){return new b.BoundingBoxAttachment(r)};l.prototype.newPathAttachment=function(e,r){return new b.PathAttachment(r)};return l}();b.AtlasAttachmentLoader=h})(spine||(spine={}));
(function(b){var h=function(){return function(l){if(null==l)throw Error("name cannot be null.");this.name=l}}();b.Attachment=h;h=function(l){function e(r){l.call(this,r);this.worldVerticesLength=0}__extends(e,l);e.prototype.computeWorldVertices=function(r,q){this.computeWorldVerticesWith(r,0,this.worldVerticesLength,q,0)};e.prototype.computeWorldVerticesWith=function(r,q,k,t,p){k+=p;var y=r.bone.skeleton,A=r.attachmentVertices,E=this.vertices,B=this.bones;if(null==B){0<A.length&&(E=A);r=r.bone;A=
r.worldX;B=r.worldY;var G=r.a;y=r.b;var I=r.c;r=r.d;for(var L=q;p<k;L+=2,p+=2){q=E[L];var T=E[L+1];t[p]=q*G+T*y+A;t[p+1]=q*I+T*r+B}}else{for(T=r=G=0;T<q;T+=2)I=B[G],G+=I+1,r+=I;L=y.bones;if(0==A.length)for(y=3*r;p<k;p+=2){var n=0,x=0;I=B[G++];for(I+=G;G<I;G++,y+=3){r=L[B[G]];q=E[y];T=E[y+1];var H=E[y+2];n+=(q*r.a+T*r.b+r.worldX)*H;x+=(q*r.c+T*r.d+r.worldY)*H}t[p]=n;t[p+1]=x}else{y=3*r;for(var f=r<<1;p<k;p+=2){x=n=0;I=B[G++];for(I+=G;G<I;G++,y+=3,f+=2)r=L[B[G]],q=E[y]+A[f],T=E[y+1]+A[f+1],H=E[y+2],
n+=(q*r.a+T*r.b+r.worldX)*H,x+=(q*r.c+T*r.d+r.worldY)*H;t[p]=n;t[p+1]=x}}}};e.prototype.applyDeform=function(r){return this==r};return e}(h);b.VertexAttachment=h})(spine||(spine={}));(function(b){b=b.AttachmentType||(b.AttachmentType={});b[b.Region=0]="Region";b[b.BoundingBox=1]="BoundingBox";b[b.Mesh=2]="Mesh";b[b.LinkedMesh=3]="LinkedMesh";b[b.Path=4]="Path"})(spine||(spine={}));
(function(b){var h=function(l){function e(r){l.call(this,r);this.color=new b.Color(1,1,1,1)}__extends(e,l);return e}(b.VertexAttachment);b.BoundingBoxAttachment=h})(spine||(spine={}));
(function(b){var h=function(l){function e(r){l.call(this,r);this.color=new b.Color(1,1,1,1);this.inheritDeform=!1;this.tempColor=new b.Color(0,0,0,0)}__extends(e,l);e.prototype.updateUVs=function(){var r=this.regionUVs,q=r.length,k=8*(q>>1);if(null==this.worldVertices||this.worldVertices.length!=k)this.worldVertices=b.Utils.newFloatArray(k);var t,p,y;null==this.region?(k=t=0,p=y=1):(k=this.region.u,t=this.region.v,p=this.region.u2-k,y=this.region.v2-t);if(this.region.rotate)for(var A=0,E=6;A<q;A+=
2,E+=8)this.worldVertices[E]=k+r[A+1]*p,this.worldVertices[E+1]=t+y-r[A]*y;else for(A=0,E=6;A<q;A+=2,E+=8)this.worldVertices[E]=k+r[A]*p,this.worldVertices[E+1]=t+r[A+1]*y};e.prototype.updateWorldVertices=function(r,q){var k=r.bone.skeleton,t=k.color,p=r.color,y=this.color,A=t.a*p.a*y.a;q=q?A:1;var E=this.tempColor;E.set(t.r*p.r*y.r*q,t.g*p.g*y.g*q,t.b*p.b*y.b*q,A);var B=r.attachmentVertices;t=this.vertices;p=this.worldVertices;var G=this.bones;if(null==G){G=t.length;0<B.length&&(t=B);r=r.bone;B=
r.worldX;var I=r.worldY,L=r.a;k=r.b;var T=r.c;r=r.d;for(A=y=0;y<G;y+=2,A+=8){q=t[y];var n=t[y+1];p[A]=q*L+n*k+B;p[A+1]=q*T+n*r+I;p[A+2]=E.r;p[A+3]=E.g;p[A+4]=E.b;p[A+5]=E.a}return p}I=k.bones;if(0==B.length)for(k=y=A=0,L=G.length;y<L;A+=8){for(var x=T=0,H=G[y++]+y;y<H;y++,k+=3){r=I[G[y]];q=t[k];n=t[k+1];var f=t[k+2];T+=(q*r.a+n*r.b+r.worldX)*f;x+=(q*r.c+n*r.d+r.worldY)*f}p[A]=T;p[A+1]=x;p[A+2]=E.r;p[A+3]=E.g;p[A+4]=E.b;p[A+5]=E.a}else{var m=k=y=A=0;for(L=G.length;y<L;A+=8){x=T=0;for(H=G[y++]+y;y<
H;y++,k+=3,m+=2)r=I[G[y]],q=t[k]+B[m],n=t[k+1]+B[m+1],f=t[k+2],T+=(q*r.a+n*r.b+r.worldX)*f,x+=(q*r.c+n*r.d+r.worldY)*f;p[A]=T;p[A+1]=x;p[A+2]=E.r;p[A+3]=E.g;p[A+4]=E.b;p[A+5]=E.a}}return p};e.prototype.applyDeform=function(r){return this==r||this.inheritDeform&&this.parentMesh==r};e.prototype.getParentMesh=function(){return this.parentMesh};e.prototype.setParentMesh=function(r){this.parentMesh=r;null!=r&&(this.bones=r.bones,this.vertices=r.vertices,this.regionUVs=r.regionUVs,this.triangles=r.triangles,
this.hullLength=r.hullLength)};return e}(b.VertexAttachment);b.MeshAttachment=h})(spine||(spine={}));(function(b){var h=function(l){function e(r){l.call(this,r);this.constantSpeed=this.closed=!1;this.color=new b.Color(1,1,1,1)}__extends(e,l);return e}(b.VertexAttachment);b.PathAttachment=h})(spine||(spine={}));
(function(b){var h=function(l){function e(r){l.call(this,r);this.y=this.x=0;this.scaleY=this.scaleX=1;this.height=this.width=this.rotation=0;this.color=new b.Color(1,1,1,1);this.offset=b.Utils.newFloatArray(8);this.vertices=b.Utils.newFloatArray(32);this.tempColor=new b.Color(1,1,1,1)}__extends(e,l);e.prototype.setRegion=function(r){var q=this.vertices;r.rotate?(q[e.U2]=r.u,q[e.V2]=r.v2,q[e.U3]=r.u,q[e.V3]=r.v,q[e.U4]=r.u2,q[e.V4]=r.v,q[e.U1]=r.u2,q[e.V1]=r.v2):(q[e.U1]=r.u,q[e.V1]=r.v2,q[e.U2]=r.u,
q[e.V2]=r.v,q[e.U3]=r.u2,q[e.V3]=r.v,q[e.U4]=r.u2,q[e.V4]=r.v2);this.region=r};e.prototype.updateOffset=function(){var r=this.width/this.region.originalWidth*this.scaleX,q=this.height/this.region.originalHeight*this.scaleY,k=-this.width/2*this.scaleX+this.region.offsetX*r,t=-this.height/2*this.scaleY+this.region.offsetY*q,p=k+this.region.width*r;r=t+this.region.height*q;q=this.rotation*Math.PI/180;var y=Math.cos(q),A=Math.sin(q);q=k*y+this.x;k*=A;var E=t*y+this.y;t*=A;var B=p*y+this.x;p*=A;y=r*y+
this.y;r*=A;A=this.offset;A[e.OX1]=q-t;A[e.OY1]=E+k;A[e.OX2]=q-r;A[e.OY2]=y+k;A[e.OX3]=B-r;A[e.OY3]=y+p;A[e.OX4]=B-t;A[e.OY4]=E+p};e.prototype.updateWorldVertices=function(r,q){var k=r.bone.skeleton.color,t=r.color,p=this.color,y=k.a*t.a*p.a;q=q?y:1;var A=this.tempColor;A.set(k.r*t.r*p.r*q,k.g*t.g*p.g*q,k.b*t.b*p.b*q,y);k=this.vertices;t=this.offset;r=r.bone;p=r.worldX;y=r.worldY;q=r.a;var E=r.b,B=r.c;r=r.d;var G=t[e.OX1];var I=t[e.OY1];k[e.X1]=G*q+I*E+p;k[e.Y1]=G*B+I*r+y;k[e.C1R]=A.r;k[e.C1G]=A.g;
k[e.C1B]=A.b;k[e.C1A]=A.a;G=t[e.OX2];I=t[e.OY2];k[e.X2]=G*q+I*E+p;k[e.Y2]=G*B+I*r+y;k[e.C2R]=A.r;k[e.C2G]=A.g;k[e.C2B]=A.b;k[e.C2A]=A.a;G=t[e.OX3];I=t[e.OY3];k[e.X3]=G*q+I*E+p;k[e.Y3]=G*B+I*r+y;k[e.C3R]=A.r;k[e.C3G]=A.g;k[e.C3B]=A.b;k[e.C3A]=A.a;G=t[e.OX4];I=t[e.OY4];k[e.X4]=G*q+I*E+p;k[e.Y4]=G*B+I*r+y;k[e.C4R]=A.r;k[e.C4G]=A.g;k[e.C4B]=A.b;k[e.C4A]=A.a;return k};e.OX1=0;e.OY1=1;e.OX2=2;e.OY2=3;e.OX3=4;e.OY3=5;e.OX4=6;e.OY4=7;e.X1=0;e.Y1=1;e.C1R=2;e.C1G=3;e.C1B=4;e.C1A=5;e.U1=6;e.V1=7;e.X2=8;e.Y2=
9;e.C2R=10;e.C2G=11;e.C2B=12;e.C2A=13;e.U2=14;e.V2=15;e.X3=16;e.Y3=17;e.C3R=18;e.C3G=19;e.C3B=20;e.C3A=21;e.U3=22;e.V3=23;e.X4=24;e.Y4=25;e.C4R=26;e.C4G=27;e.C4B=28;e.C4A=29;e.U4=30;e.V4=31;return e}(b.Attachment);b.RegionAttachment=h})(spine||(spine={}));(function(b){b=b.BlendMode||(b.BlendMode={});b[b.Normal=0]="Normal";b[b.Additive=1]="Additive";b[b.Multiply=2]="Multiply";b[b.Screen=3]="Screen"})(spine||(spine={}));
(function(b){var h=function(){function l(e,r,q){this.children=[];this.ashearY=this.ashearX=this.ascaleY=this.ascaleX=this.arotation=this.ay=this.ax=this.shearY=this.shearX=this.scaleY=this.scaleX=this.rotation=this.y=this.x=0;this.appliedValid=!1;this.worldY=this.d=this.c=this.worldX=this.b=this.a=0;this.sorted=!1;if(null==e)throw Error("data cannot be null.");if(null==r)throw Error("skeleton cannot be null.");this.data=e;this.skeleton=r;this.parent=q;this.setToSetupPose()}l.prototype.update=function(){this.updateWorldTransformWith(this.x,
this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};l.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};l.prototype.updateWorldTransformWith=function(e,r,q,k,t,p,y){this.ax=e;this.ay=r;this.arotation=q;this.ascaleX=k;this.ascaleY=t;this.ashearX=p;this.ashearY=y;this.appliedValid=!0;var A=this.parent;if(null==A){y=q+90+y;A=b.MathUtils.cosDeg(q+p)*k;var E=b.MathUtils.cosDeg(y)*t;k*=
b.MathUtils.sinDeg(q+p);t*=b.MathUtils.sinDeg(y);var B=this.skeleton;B.flipX&&(e=-e,A=-A,E=-E);B.flipY&&(r=-r,k=-k,t=-t);this.a=A;this.b=E;this.c=k;this.d=t;this.worldX=e+B.x;this.worldY=r+B.y}else{B=A.a;var G=A.b,I=A.c,L=A.d;this.worldX=B*e+G*r+A.worldX;this.worldY=I*e+L*r+A.worldY;switch(this.data.transformMode){case b.TransformMode.Normal:y=q+90+y;A=b.MathUtils.cosDeg(q+p)*k;E=b.MathUtils.cosDeg(y)*t;k*=b.MathUtils.sinDeg(q+p);t*=b.MathUtils.sinDeg(y);this.a=B*A+G*k;this.b=B*E+G*t;this.c=I*A+L*
k;this.d=I*E+L*t;return;case b.TransformMode.OnlyTranslation:y=q+90+y;this.a=b.MathUtils.cosDeg(q+p)*k;this.b=b.MathUtils.cosDeg(y)*t;this.c=b.MathUtils.sinDeg(q+p)*k;this.d=b.MathUtils.sinDeg(y)*t;break;case b.TransformMode.NoRotationOrReflection:A=B*B+I*I;1E-4<A?(A=Math.abs(B*L-G*I)/A,G=I*A,L=B*A,A=Math.atan2(I,B)*b.MathUtils.radDeg):(I=B=0,A=90-Math.atan2(L,G)*b.MathUtils.radDeg);p=q+p-A;y=q+y-A+90;A=b.MathUtils.cosDeg(p)*k;E=b.MathUtils.cosDeg(y)*t;k*=b.MathUtils.sinDeg(p);t*=b.MathUtils.sinDeg(y);
this.a=B*A-G*k;this.b=B*E-G*t;this.c=I*A+L*k;this.d=I*E+L*t;break;case b.TransformMode.NoScale:case b.TransformMode.NoScaleOrReflection:A=b.MathUtils.cosDeg(q);E=b.MathUtils.sinDeg(q);q=B*A+G*E;e=I*A+L*E;A=Math.sqrt(q*q+e*e);1E-5<A&&(A=1/A);q*=A;e*=A;A=Math.sqrt(q*q+e*e);E=Math.PI/2+Math.atan2(e,q);r=Math.cos(E)*A;var T=Math.sin(E)*A;A=b.MathUtils.cosDeg(p)*k;E=b.MathUtils.cosDeg(90+y)*t;k*=b.MathUtils.sinDeg(p);t*=b.MathUtils.sinDeg(90+y);this.a=q*A+r*k;this.b=q*E+r*t;this.c=e*A+T*k;this.d=e*E+T*
t;if(this.data.transformMode!=b.TransformMode.NoScaleOrReflection?0>B*L-G*I:this.skeleton.flipX!=this.skeleton.flipY)this.b=-this.b,this.d=-this.d;return}this.skeleton.flipX&&(this.a=-this.a,this.b=-this.b);this.skeleton.flipY&&(this.c=-this.c,this.d=-this.d)}};l.prototype.setToSetupPose=function(){var e=this.data;this.x=e.x;this.y=e.y;this.rotation=e.rotation;this.scaleX=e.scaleX;this.scaleY=e.scaleY;this.shearX=e.shearX;this.shearY=e.shearY};l.prototype.getWorldRotationX=function(){return Math.atan2(this.c,
this.a)*b.MathUtils.radDeg};l.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*b.MathUtils.radDeg};l.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)};l.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)};l.prototype.worldToLocalRotationX=function(){var e=this.parent;if(null==e)return this.arotation;var r=this.a,q=this.c;return Math.atan2(e.a*q-e.c*r,e.d*r-e.b*q)*b.MathUtils.radDeg};l.prototype.worldToLocalRotationY=
function(){var e=this.parent;if(null==e)return this.arotation;var r=this.b,q=this.d;return Math.atan2(e.a*q-e.c*r,e.d*r-e.b*q)*b.MathUtils.radDeg};l.prototype.rotateWorld=function(e){var r=this.a,q=this.b,k=this.c,t=this.d,p=b.MathUtils.cosDeg(e);e=b.MathUtils.sinDeg(e);this.a=p*r-e*k;this.b=p*q-e*t;this.c=e*r+p*k;this.d=e*q+p*t;this.appliedValid=!1};l.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)this.ax=this.worldX,this.ay=this.worldY,this.arotation=
Math.atan2(this.c,this.a)*b.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*b.MathUtils.radDeg;else{var r=e.a,q=e.b,k=e.c,t=e.d,p=1/(r*t-q*k),y=this.worldX-e.worldX;e=this.worldY-e.worldY;this.ax=y*t*p-e*q*p;this.ay=e*r*p-y*k*p;t*=p;r*=p;q*=p;p*=k;k=t*this.a-q*this.c;q=t*this.b-q*this.d;t=r*this.c-p*this.a;p=r*this.d-p*this.b;this.ashearX=
0;this.ascaleX=Math.sqrt(k*k+t*t);1E-4<this.ascaleX?(r=k*p-q*t,this.ascaleY=r/this.ascaleX,this.ashearY=Math.atan2(k*q+t*p,r)*b.MathUtils.radDeg,this.arotation=Math.atan2(t,k)*b.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(q*q+p*p),this.ashearY=0,this.arotation=90-Math.atan2(p,q)*b.MathUtils.radDeg)}};l.prototype.worldToLocal=function(e){var r=this.a,q=this.b,k=this.c,t=this.d,p=1/(r*t-q*k),y=e.x-this.worldX,A=e.y-this.worldY;e.x=y*t*p-A*q*p;e.y=A*r*p-y*k*p;return e};l.prototype.localToWorld=
function(e){var r=e.x,q=e.y;e.x=r*this.a+q*this.b+this.worldX;e.y=r*this.c+q*this.d+this.worldY;return e};return l}();b.Bone=h})(spine||(spine={}));
(function(b){var h=function(){return function(e,r,q){this.rotation=this.y=this.x=0;this.scaleY=this.scaleX=1;this.shearY=this.shearX=0;this.transformMode=l.Normal;if(0>e)throw Error("index must be >= 0.");if(null==r)throw Error("name cannot be null.");this.index=e;this.name=r;this.parent=q}}();b.BoneData=h;(function(e){e[e.Normal=0]="Normal";e[e.OnlyTranslation=1]="OnlyTranslation";e[e.NoRotationOrReflection=2]="NoRotationOrReflection";e[e.NoScale=3]="NoScale";e[e.NoScaleOrReflection=4]="NoScaleOrReflection"})(b.TransformMode||
(b.TransformMode={}));var l=b.TransformMode})(spine||(spine={}));(function(b){var h=function(){return function(l,e){if(null==e)throw Error("data cannot be null.");this.time=l;this.data=e}}();b.Event=h})(spine||(spine={}));(function(b){var h=function(){return function(l){this.name=l}}();b.EventData=h})(spine||(spine={}));
(function(b){var h=function(){function l(e,r){this.mix=1;this.bendDirection=0;if(null==e)throw Error("data cannot be null.");if(null==r)throw Error("skeleton cannot be null.");this.data=e;this.mix=e.mix;this.bendDirection=e.bendDirection;this.bones=[];for(var q=0;q<e.bones.length;q++)this.bones.push(r.findBone(e.bones[q].name));this.target=r.findBone(e.target.name)}l.prototype.getOrder=function(){return this.data.order};l.prototype.apply=function(){this.update()};l.prototype.update=function(){var e=
this.target,r=this.bones;switch(r.length){case 1:this.apply1(r[0],e.worldX,e.worldY,this.mix);break;case 2:this.apply2(r[0],r[1],e.worldX,e.worldY,this.bendDirection,this.mix)}};l.prototype.apply1=function(e,r,q,k){e.appliedValid||e.updateAppliedTransform();var t=e.parent,p=1/(t.a*t.d-t.b*t.c);r-=t.worldX;q-=t.worldY;t=Math.atan2((q*t.a-r*t.c)*p-e.ay,(r*t.d-q*t.b)*p-e.ax)*b.MathUtils.radDeg-e.ashearX-e.arotation;0>e.ascaleX&&(t+=180);180<t?t-=360:-180>t&&(t+=360);e.updateWorldTransformWith(e.ax,e.ay,
e.arotation+t*k,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)};l.prototype.apply2=function(e,r,q,k,t,p){if(0==p)r.updateWorldTransform();else{e.appliedValid||e.updateAppliedTransform();r.appliedValid||r.updateAppliedTransform();var y=e.ax,A=e.ay,E=e.ascaleX,B=e.ascaleY,G=r.ascaleX,I,L,T;0>E?(E=-E,I=180,T=-1):(I=0,T=1);0>B&&(B=-B,T=-T);0>G?(G=-G,L=180):L=0;var n=r.ax,x,H,f,m=e.a,v=e.b,D=e.c,C=e.d,K=1E-4>=Math.abs(E-B);K?(x=r.ay,H=m*n+v*x+e.worldX,f=D*n+C*x+e.worldY):(x=0,H=m*n+e.worldX,f=D*n+e.worldY);
var N=e.parent;m=N.a;v=N.b;D=N.c;C=N.d;var S=1/(m*C-v*D);q-=N.worldX;k-=N.worldY;var U=(q*C-k*v)*S-y,X=(k*m-q*D)*S-A;q=H-N.worldX;k=f-N.worldY;v=(q*C-k*v)*S-y;m=(k*m-q*D)*S-A;S=Math.sqrt(v*v+m*m);v=r.data.length*G;if(K)v*=E,m=(U*U+X*X-S*S-v*v)/(2*S*v),-1>m?m=-1:1<m&&(m=1),t*=Math.acos(m),m=S+v*m,v*=Math.sin(t),m=Math.atan2(X*m-U*v,U*m+X*v);else if(m=E*v,v*=B,k=m*m,G=v*v,K=U*U+X*X,U=Math.atan2(X,U),D=G*S*S+k*K-k*G,q=-2*G*S,X=G-k,C=q*q-4*X*D,0<=C&&(C=Math.sqrt(C),0>q&&(C=-C),C=-(q+C)/2,q=C/X,C=D/C,
C=Math.abs(q)<Math.abs(C)?q:C,C*C<=K))k=Math.sqrt(K-C*C)*t,m=U-Math.atan2(k,C),t=Math.atan2(k/B,(C-S)/E);else{E=0;D=Number.MAX_VALUE;var Z=N=f=B=H=X=0;q=S+m;C=q*q;C>f&&(B=0,f=C,N=q);q=S-m;C=q*q;C<D&&(E=b.MathUtils.PI,D=C,X=q);G=Math.acos(-m*S/(k-G));q=m*Math.cos(G)+S;k=v*Math.sin(G);C=q*q+k*k;C<D&&(E=G,D=C,X=q,H=k);C>f&&(B=G,f=C,N=q,Z=k);K<=(D+f)/2?(m=U-Math.atan2(H*t,X),t*=E):(m=U-Math.atan2(Z*t,N),t*=B)}v=Math.atan2(x,n)*T;S=e.arotation;m=(m-v)*b.MathUtils.radDeg+I-S;180<m?m-=360:-180>m&&(m+=360);
e.updateWorldTransformWith(y,A,S+m*p,e.ascaleX,e.ascaleY,0,0);S=r.arotation;t=((t+v)*b.MathUtils.radDeg-r.ashearX)*T+L-S;180<t?t-=360:-180>t&&(t+=360);r.updateWorldTransformWith(n,x,S+t*p,r.ascaleX,r.ascaleY,r.ashearX,r.ashearY)}};return l}();b.IkConstraint=h})(spine||(spine={}));(function(b){var h=function(){return function(l){this.order=0;this.bones=[];this.mix=this.bendDirection=1;this.name=l}}();b.IkConstraintData=h})(spine||(spine={}));
(function(b){var h=function(){function l(e,r){this.translateMix=this.rotateMix=this.spacing=this.position=0;this.spaces=[];this.positions=[];this.world=[];this.curves=[];this.lengths=[];this.segments=[];if(null==e)throw Error("data cannot be null.");if(null==r)throw Error("skeleton cannot be null.");this.data=e;this.bones=[];for(var q=0,k=e.bones.length;q<k;q++)this.bones.push(r.findBone(e.bones[q].name));this.target=r.findSlot(e.target.name);this.position=e.position;this.spacing=e.spacing;this.rotateMix=
e.rotateMix;this.translateMix=e.translateMix}l.prototype.apply=function(){this.update()};l.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof b.PathAttachment){var r=this.rotateMix,q=this.translateMix,k=0<r;if(0<q||k){var t=this.data,p=t.spacingMode,y=p==b.SpacingMode.Length,A=t.rotateMode,E=A==b.RotateMode.Tangent,B=A==b.RotateMode.ChainScale,G=this.bones.length,I=E?G:G+1,L=this.bones,T=b.Utils.setArraySize(this.spaces,I),n=null,x=this.spacing;if(B||y){B&&(n=b.Utils.setArraySize(this.lengths,
G));for(var H=0,f=I-1;H<f;){var m=L[H],v=m.data.length,D=v*m.a;v*=m.c;v=Math.sqrt(D*D+v*v);B&&(n[H]=v);T[++H]=y?Math.max(0,v+x):x}}else for(H=1;H<I;H++)T[H]=x;e=this.computeWorldPositions(e,I,E,t.positionMode==b.PositionMode.Percent,p==b.SpacingMode.Percent);p=e[0];y=e[1];t=t.offsetRotation;0==t?A=A==b.RotateMode.Chain:(A=!1,I=this.target.bone,t*=0<I.a*I.d-I.b*I.c?b.MathUtils.degRad:-b.MathUtils.degRad);H=0;for(I=3;H<G;H++,I+=3){m=L[H];m.worldX+=(p-m.worldX)*q;m.worldY+=(y-m.worldY)*q;D=e[I];v=e[I+
1];x=D-p;f=v-y;B&&(p=n[H],0!=p&&(p=(Math.sqrt(x*x+f*f)/p-1)*r+1,m.a*=p,m.c*=p));p=D;y=v;if(k){D=m.a;v=m.b;var C=m.c,K=m.d;var N=E?e[I-1]:0==T[H+1]?e[I+2]:Math.atan2(f,x);N-=Math.atan2(C,D);if(A){var S=Math.cos(N);var U=Math.sin(N);var X=m.data.length;p+=(X*(S*D-U*C)-x)*r;y+=(X*(U*D+S*C)-f)*r}else N+=t;N>b.MathUtils.PI?N-=b.MathUtils.PI2:N<-b.MathUtils.PI&&(N+=b.MathUtils.PI2);N*=r;S=Math.cos(N);U=Math.sin(N);m.a=S*D-U*C;m.b=S*v-U*K;m.c=U*D+S*C;m.d=U*v+S*K}m.appliedValid=!1}}}};l.prototype.computeWorldPositions=
function(e,r,q,k,t){var p=this.target,y=this.position,A=this.spaces,E=b.Utils.setArraySize(this.positions,3*r+2),B=e.closed,G=e.worldVerticesLength,I=G/6,L=l.NONE;if(!e.constantSpeed){var T=e.lengths;I-=B?1:2;var n=T[I];k&&(y*=n);if(t)for(var x=0;x<r;x++)A[x]*=n;var H=b.Utils.setArraySize(this.world,8);for(t=k=x=0;x<r;x++,k+=3){var f=A[x],m=y+=f;if(B)m%=n,0>m&&(m+=n),t=0;else if(0>m){L!=l.BEFORE&&(L=l.BEFORE,e.computeWorldVerticesWith(p,2,4,H,0));this.addBeforePosition(m,H,0,E,k);continue}else if(m>
n){L!=l.AFTER&&(L=l.AFTER,e.computeWorldVerticesWith(p,G-6,4,H,0));this.addAfterPosition(m-n,H,0,E,k);continue}for(;;t++){var v=T[t];if(!(m>v)){if(0==t)m/=v;else{var D=T[t-1];m=(m-D)/(v-D)}break}}t!=L&&(L=t,B&&t==I?(e.computeWorldVerticesWith(p,G-4,4,H,0),e.computeWorldVerticesWith(p,0,4,H,4)):e.computeWorldVerticesWith(p,6*t+2,8,H,0));this.addCurvePosition(m,H[0],H[1],H[2],H[3],H[4],H[5],H[6],H[7],E,k,q||0<x&&0==f)}return E}B?(G+=2,H=b.Utils.setArraySize(this.world,G),e.computeWorldVerticesWith(p,
2,G-4,H,0),e.computeWorldVerticesWith(p,0,2,H,G-4),H[G-2]=H[0],H[G-1]=H[1]):(I--,G-=4,H=b.Utils.setArraySize(this.world,G),e.computeWorldVerticesWith(p,2,G,H,0));e=b.Utils.setArraySize(this.curves,I);p=0;T=H[0];n=H[1];var C=v=0,K=0,N=0,S=0,U=0;x=0;for(f=2;x<I;x++,f+=6){v=H[f];C=H[f+1];K=H[f+2];N=H[f+3];S=H[f+4];U=H[f+5];var X=.1875*(T-2*v+K);var Z=.1875*(n-2*C+N);D=.09375*(3*(v-K)-T+S);var V=.09375*(3*(C-N)-n+U);var ma=2*X+D;var ia=2*Z+V;X=.75*(v-T)+X+.16666667*D;Z=.75*(C-n)+Z+.16666667*V;p+=Math.sqrt(X*
X+Z*Z);X+=ma;Z+=ia;ma+=D;ia+=V;p+=Math.sqrt(X*X+Z*Z);X+=ma;Z+=ia;p+=Math.sqrt(X*X+Z*Z);X+=ma+D;Z+=ia+V;p+=Math.sqrt(X*X+Z*Z);e[x]=p;T=S;n=U}k&&(y*=p);if(t)for(x=0;x<r;x++)A[x]*=p;I=this.segments;var ja=0;for(V=t=k=x=0;x<r;x++,k+=3){f=A[x];m=y+=f;if(B)m%=p,0>m&&(m+=p),t=0;else if(0>m){this.addBeforePosition(m,H,0,E,k);continue}else if(m>p){this.addAfterPosition(m-p,H,G-4,E,k);continue}for(;;t++)if(ma=e[t],!(m>ma)){0==t?m/=ma:(D=e[t-1],m=(m-D)/(ma-D));break}if(t!=L){L=t;var ba=6*t;T=H[ba];n=H[ba+1];
v=H[ba+2];C=H[ba+3];K=H[ba+4];N=H[ba+5];S=H[ba+6];U=H[ba+7];X=.03*(T-2*v+K);Z=.03*(n-2*C+N);D=.006*(3*(v-K)-T+S);V=.006*(3*(C-N)-n+U);ma=2*X+D;ia=2*Z+V;X=.3*(v-T)+X+.16666667*D;Z=.3*(C-n)+Z+.16666667*V;ja=Math.sqrt(X*X+Z*Z);I[0]=ja;for(ba=1;8>ba;ba++)X+=ma,Z+=ia,ma+=D,ia+=V,ja+=Math.sqrt(X*X+Z*Z),I[ba]=ja;X+=ma;Z+=ia;ja+=Math.sqrt(X*X+Z*Z);I[8]=ja;X+=ma+D;Z+=ia+V;ja+=Math.sqrt(X*X+Z*Z);I[9]=ja;V=0}for(m*=ja;;V++)if(ma=I[V],!(m>ma)){0==V?m/=ma:(D=I[V-1],m=V+(m-D)/(ma-D));break}this.addCurvePosition(.1*
m,T,n,v,C,K,N,S,U,E,k,q||0<x&&0==f)}return E};l.prototype.addBeforePosition=function(e,r,q,k,t){var p=r[q],y=r[q+1];r=Math.atan2(r[q+3]-y,r[q+2]-p);k[t]=p+e*Math.cos(r);k[t+1]=y+e*Math.sin(r);k[t+2]=r};l.prototype.addAfterPosition=function(e,r,q,k,t){var p=r[q+2],y=r[q+3];r=Math.atan2(y-r[q+1],p-r[q]);k[t]=p+e*Math.cos(r);k[t+1]=y+e*Math.sin(r);k[t+2]=r};l.prototype.addCurvePosition=function(e,r,q,k,t,p,y,A,E,B,G,I){if(0==e||isNaN(e))e=1E-4;var L=e*e,T=L*e,n=1-e,x=n*n,H=x*n,f=n*e,m=3*f;n*=m;e*=m;
A=r*H+k*n+p*e+A*T;E=q*H+t*n+y*e+E*T;B[G]=A;B[G+1]=E;I&&(B[G+2]=Math.atan2(E-(q*x+t*f*2+y*L),A-(r*x+k*f*2+p*L)))};l.prototype.getOrder=function(){return this.data.order};l.NONE=-1;l.BEFORE=-2;l.AFTER=-3;return l}();b.PathConstraint=h})(spine||(spine={}));
(function(b){var h=function(){return function(l){this.order=0;this.bones=[];this.name=l}}();b.PathConstraintData=h;(function(l){l[l.Fixed=0]="Fixed";l[l.Percent=1]="Percent"})(b.PositionMode||(b.PositionMode={}));(function(l){l[l.Length=0]="Length";l[l.Fixed=1]="Fixed";l[l.Percent=2]="Percent"})(b.SpacingMode||(b.SpacingMode={}));(function(l){l[l.Tangent=0]="Tangent";l[l.Chain=1]="Chain";l[l.ChainScale=2]="ChainScale"})(b.RotateMode||(b.RotateMode={}))})(spine||(spine={}));
(function(b){var h=function(){function e(r){this.toLoad=[];this.assets={};this.clientId=r}e.prototype.loaded=function(){var r=0,q;for(q in this.assets)r++;return r};return e}(),l=function(){function e(r){void 0===r&&(r="");this.clientAssets={};this.queuedAssets={};this.rawAssets={};this.errors={};this.pathPrefix=r}e.prototype.queueAsset=function(r,q,k){var t=this.clientAssets[r];if(null===t||void 0===t)t=new h(r),this.clientAssets[r]=t;null!==q&&(t.textureLoader=q);t.toLoad.push(k);if(this.queuedAssets[k]===
k)return!1;this.queuedAssets[k]=k;return!0};e.prototype.loadText=function(r,q){var k=this;q=this.pathPrefix+q;if(this.queueAsset(r,null,q)){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(200<=t.status&&300>t.status?k.rawAssets[q]=t.responseText:k.errors[q]="Couldn't load text "+q+": status "+t.status+", "+t.responseText)};t.open("GET",q,!0);t.send()}};e.prototype.loadJson=function(r,q){var k=this;q=this.pathPrefix+q;if(this.queueAsset(r,null,q)){var t=
new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(200<=t.status&&300>t.status?k.rawAssets[q]=JSON.parse(t.responseText):k.errors[q]="Couldn't load text "+q+": status "+t.status+", "+t.responseText)};t.open("GET",q,!0);t.send()}};e.prototype.loadTexture=function(r,q,k){var t=this;k=this.pathPrefix+k;if(this.queueAsset(r,q,k)){var p=new Image;p.src=k;p.crossOrigin="anonymous";p.onload=function(y){t.rawAssets[k]=p};p.onerror=function(y){t.errors[k]="Couldn't load image "+
k}}};e.prototype.get=function(r,q){q=this.pathPrefix+q;r=this.clientAssets[r];return null===r||void 0===r?!0:r.assets[q]};e.prototype.updateClientAssets=function(r){for(var q=0;q<r.toLoad.length;q++){var k=r.toLoad[q],t=r.assets[k];if(null===t||void 0===t)t=this.rawAssets[k],null!==t&&void 0!==t&&(r.assets[k]=t instanceof HTMLImageElement?r.textureLoader(t):t)}};e.prototype.isLoadingComplete=function(r){r=this.clientAssets[r];if(null===r||void 0===r)return!0;this.updateClientAssets(r);return r.toLoad.length==
r.loaded()};e.prototype.dispose=function(){};e.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length};e.prototype.getErrors=function(){return this.errors};return e}();b.SharedAssetManager=l})(spine||(spine={}));
(function(b){var h=function(){function l(e){this._updateCache=[];this.updateCacheReset=[];this.time=0;this.flipY=this.flipX=!1;this.y=this.x=0;if(null==e)throw Error("data cannot be null.");this.data=e;this.bones=[];for(var r=0;r<e.bones.length;r++){var q=e.bones[r];if(null==q.parent)q=new b.Bone(q,this,null);else{var k=this.bones[q.parent.index];q=new b.Bone(q,this,k);k.children.push(q)}this.bones.push(q)}this.slots=[];this.drawOrder=[];for(r=0;r<e.slots.length;r++)k=e.slots[r],q=this.bones[k.boneData.index],
q=new b.Slot(k,q),this.slots.push(q),this.drawOrder.push(q);this.ikConstraints=[];for(r=0;r<e.ikConstraints.length;r++)this.ikConstraints.push(new b.IkConstraint(e.ikConstraints[r],this));this.transformConstraints=[];for(r=0;r<e.transformConstraints.length;r++)this.transformConstraints.push(new b.TransformConstraint(e.transformConstraints[r],this));this.pathConstraints=[];for(r=0;r<e.pathConstraints.length;r++)this.pathConstraints.push(new b.PathConstraint(e.pathConstraints[r],this));this.color=new b.Color(1,
1,1,1);this.updateCache()}l.prototype.updateCache=function(){this._updateCache.length=0;for(var e=this.bones,r=0,q=e.length;r<q;r++)e[r].sorted=!1;q=this.ikConstraints;var k=this.transformConstraints,t=this.pathConstraints,p=q.length,y=k.length,A=t.length,E=p+y+A;r=0;a:for(;r<E;r++){for(var B=0;B<p;B++){var G=q[B];if(G.data.order==r){this.sortIkConstraint(G);continue a}}for(B=0;B<y;B++)if(G=k[B],G.data.order==r){this.sortTransformConstraint(G);continue a}for(B=0;B<A;B++)if(G=t[B],G.data.order==r){this.sortPathConstraint(G);
continue a}}r=0;for(q=e.length;r<q;r++)this.sortBone(e[r])};l.prototype.sortIkConstraint=function(e){this.sortBone(e.target);var r=e.bones,q=r[0];this.sortBone(q);if(1<r.length){var k=r[r.length-1];-1<this._updateCache.indexOf(k)||this.updateCacheReset.push(k)}this._updateCache.push(e);this.sortReset(q.children);r[r.length-1].sorted=!0};l.prototype.sortPathConstraint=function(e){var r=e.target,q=r.data.index,k=r.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,q,k);null!=this.data.defaultSkin&&
this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,q,k);for(var t=0,p=this.data.skins.length;t<p;t++)this.sortPathConstraintAttachment(this.data.skins[t],q,k);t=r.getAttachment();t instanceof b.PathAttachment&&this.sortPathConstraintAttachmentWith(t,k);k=e.bones;r=k.length;for(t=0;t<r;t++)this.sortBone(k[t]);this._updateCache.push(e);for(t=0;t<r;t++)this.sortReset(k[t].children);for(t=0;t<r;t++)k[t].sorted=!0};l.prototype.sortTransformConstraint=function(e){this.sortBone(e.target);
for(var r=e.bones,q=r.length,k=0;k<q;k++)this.sortBone(r[k]);this._updateCache.push(e);for(k=0;k<q;k++)this.sortReset(r[k].children);for(k=0;k<q;k++)r[k].sorted=!0};l.prototype.sortPathConstraintAttachment=function(e,r,q){if(e=e.attachments[r])for(var k in e)this.sortPathConstraintAttachmentWith(e[k],q)};l.prototype.sortPathConstraintAttachmentWith=function(e,r){if(e instanceof b.PathAttachment)if(e=e.bones,null==e)this.sortBone(r);else{r=this.bones;for(var q=0;q<e.length;){var k=e[q++];for(k=q+k;q<
k;q++)this.sortBone(r[e[q]])}}};l.prototype.sortBone=function(e){if(!e.sorted){var r=e.parent;null!=r&&this.sortBone(r);e.sorted=!0;this._updateCache.push(e)}};l.prototype.sortReset=function(e){for(var r=0,q=e.length;r<q;r++){var k=e[r];k.sorted&&this.sortReset(k.children);k.sorted=!1}};l.prototype.updateWorldTransform=function(){for(var e=this.updateCacheReset,r=0,q=e.length;r<q;r++){var k=e[r];k.ax=k.x;k.ay=k.y;k.arotation=k.rotation;k.ascaleX=k.scaleX;k.ascaleY=k.scaleY;k.ashearX=k.shearX;k.ashearY=
k.shearY;k.appliedValid=!0}e=this._updateCache;r=0;for(q=e.length;r<q;r++)e[r].update()};l.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()};l.prototype.setBonesToSetupPose=function(){for(var e=this.bones,r=0,q=e.length;r<q;r++)e[r].setToSetupPose();var k=this.ikConstraints;r=0;for(q=k.length;r<q;r++)e=k[r],e.bendDirection=e.data.bendDirection,e.mix=e.data.mix;var t=this.transformConstraints;r=0;for(q=t.length;r<q;r++)e=t[r],k=e.data,e.rotateMix=k.rotateMix,
e.translateMix=k.translateMix,e.scaleMix=k.scaleMix,e.shearMix=k.shearMix;t=this.pathConstraints;r=0;for(q=t.length;r<q;r++)e=t[r],k=e.data,e.position=k.position,e.spacing=k.spacing,e.rotateMix=k.rotateMix,e.translateMix=k.translateMix};l.prototype.setSlotsToSetupPose=function(){var e=this.slots;b.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var r=0,q=e.length;r<q;r++)e[r].setToSetupPose()};l.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]};l.prototype.findBone=
function(e){if(null==e)throw Error("boneName cannot be null.");for(var r=this.bones,q=0,k=r.length;q<k;q++){var t=r[q];if(t.data.name==e)return t}return null};l.prototype.findBoneIndex=function(e){if(null==e)throw Error("boneName cannot be null.");for(var r=this.bones,q=0,k=r.length;q<k;q++)if(r[q].data.name==e)return q;return-1};l.prototype.findSlot=function(e){if(null==e)throw Error("slotName cannot be null.");for(var r=this.slots,q=0,k=r.length;q<k;q++){var t=r[q];if(t.data.name==e)return t}return null};
l.prototype.findSlotIndex=function(e){if(null==e)throw Error("slotName cannot be null.");for(var r=this.slots,q=0,k=r.length;q<k;q++)if(r[q].data.name==e)return q;return-1};l.prototype.setSkinByName=function(e){var r=this.data.findSkin(e);if(null==r)throw Error("Skin not found: "+e);this.setSkin(r)};l.prototype.setSkin=function(e){if(null!=e)if(null!=this.skin)e.attachAll(this,this.skin);else for(var r=this.slots,q=0,k=r.length;q<k;q++){var t=r[q],p=t.data.attachmentName;null!=p&&(p=e.getAttachment(q,
p),null!=p&&t.setAttachment(p))}this.skin=e};l.prototype.getAttachmentByName=function(e,r){return this.getAttachment(this.data.findSlotIndex(e),r)};l.prototype.getAttachment=function(e,r){if(null==r)throw Error("attachmentName cannot be null.");if(null!=this.skin){var q=this.skin.getAttachment(e,r);if(null!=q)return q}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,r):null};l.prototype.setAttachment=function(e,r){if(null==e)throw Error("slotName cannot be null.");for(var q=
this.slots,k=0,t=q.length;k<t;k++){var p=q[k];if(p.data.name==e){q=null;if(null!=r&&(q=this.getAttachment(k,r),null==q))throw Error("Attachment not found: "+r+", for slot: "+e);p.setAttachment(q);return}}throw Error("Slot not found: "+e);};l.prototype.findIkConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var r=this.ikConstraints,q=0,k=r.length;q<k;q++){var t=r[q];if(t.data.name==e)return t}return null};l.prototype.findTransformConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");
for(var r=this.transformConstraints,q=0,k=r.length;q<k;q++){var t=r[q];if(t.data.name==e)return t}return null};l.prototype.findPathConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var r=this.pathConstraints,q=0,k=r.length;q<k;q++){var t=r[q];if(t.data.name==e)return t}return null};l.prototype.getBounds=function(e,r){if(null==e)throw Error("offset cannot be null.");if(null==r)throw Error("size cannot be null.");for(var q=this.drawOrder,k=Number.POSITIVE_INFINITY,
t=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,y=Number.NEGATIVE_INFINITY,A=0,E=q.length;A<E;A++){var B=q[A],G=null,I=B.getAttachment();I instanceof b.RegionAttachment?G=I.updateWorldVertices(B,!1):I instanceof b.MeshAttachment&&(G=I.updateWorldVertices(B,!0));if(null!=G)for(B=0,I=G.length;B<I;B+=8){var L=G[B],T=G[B+1];k=Math.min(k,L);t=Math.min(t,T);p=Math.max(p,L);y=Math.max(y,T)}}e.set(k,t);r.set(p-k,y-t)};l.prototype.update=function(e){this.time+=e};return l}();b.Skeleton=h})(spine||(spine=
{}));
(function(b){var h=function(){function l(){this.maxY=this.maxX=this.minY=this.minX=0;this.boundingBoxes=[];this.polygons=[];this.polygonPool=new b.Pool(function(){return b.Utils.newFloatArray(16)})}l.prototype.update=function(e,r){if(null==e)throw Error("skeleton cannot be null.");var q=this.boundingBoxes,k=this.polygons,t=this.polygonPool;e=e.slots;var p=e.length;q.length=0;t.freeAll(k);for(var y=k.length=0;y<p;y++){var A=e[y],E=A.getAttachment();if(E instanceof b.BoundingBoxAttachment){q.push(E);var B=
t.obtain();B.length!=E.worldVerticesLength&&(B=b.Utils.newFloatArray(E.worldVerticesLength));k.push(B);E.computeWorldVertices(A,B)}}r?this.aabbCompute():(this.minY=this.minX=Number.POSITIVE_INFINITY,this.maxY=this.maxX=Number.NEGATIVE_INFINITY)};l.prototype.aabbCompute=function(){for(var e=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY,t=this.polygons,p=0,y=t.length;p<y;p++){var A=t[p],E=A,B=0;for(A=A.length;B<A;B+=2){var G=E[B],I=E[B+1];
e=Math.min(e,G);r=Math.min(r,I);q=Math.max(q,G);k=Math.max(k,I)}}this.minX=e;this.minY=r;this.maxX=q;this.maxY=k};l.prototype.aabbContainsPoint=function(e,r){return e>=this.minX&&e<=this.maxX&&r>=this.minY&&r<=this.maxY};l.prototype.aabbIntersectsSegment=function(e,r,q,k){var t=this.minX,p=this.minY,y=this.maxX,A=this.maxY;if(e<=t&&q<=t||r<=p&&k<=p||e>=y&&q>=y||r>=A&&k>=A)return!1;q=(k-r)/(q-e);k=q*(t-e)+r;if(k>p&&k<A)return!0;k=q*(y-e)+r;if(k>p&&k<A)return!0;p=(p-r)/q+e;if(p>t&&p<y)return!0;p=(A-
r)/q+e;return p>t&&p<y?!0:!1};l.prototype.aabbIntersectsSkeleton=function(e){return this.minX<e.maxX&&this.maxX>e.minX&&this.minY<e.maxY&&this.maxY>e.minY};l.prototype.containsPoint=function(e,r){for(var q=this.polygons,k=0,t=q.length;k<t;k++)if(this.containsPointPolygon(q[k],e,r))return this.boundingBoxes[k];return null};l.prototype.containsPointPolygon=function(e,r,q){for(var k=e.length,t=k-2,p=!1,y=0;y<k;y+=2){var A=e[y+1],E=e[t+1];if(A<q&&E>=q||E<q&&A>=q){var B=e[y];B+(q-A)/(E-A)*(e[t]-B)<r&&
(p=!p)}t=y}return p};l.prototype.intersectsSegment=function(e,r,q,k){for(var t=this.polygons,p=0,y=t.length;p<y;p++)if(this.intersectsSegmentPolygon(t[p],e,r,q,k))return this.boundingBoxes[p];return null};l.prototype.intersectsSegmentPolygon=function(e,r,q,k,t){for(var p=e.length,y=r-k,A=q-t,E=r*t-q*k,B=e[p-2],G=e[p-1],I=0;I<p;I+=2){var L=e[I],T=e[I+1],n=B*T-G*L,x=B-L,H=G-T,f=y*H-A*x;x=(E*x-y*n)/f;if((x>=B&&x<=L||x>=L&&x<=B)&&(x>=r&&x<=k||x>=k&&x<=r)&&(B=(E*H-A*n)/f,(B>=G&&B<=T||B>=T&&B<=G)&&(B>=
q&&B<=t||B>=t&&B<=q)))return!0;B=L;G=T}return!1};l.prototype.getPolygon=function(e){if(null==e)throw Error("boundingBox cannot be null.");e=this.boundingBoxes.indexOf(e);return-1==e?null:this.polygons[e]};l.prototype.getWidth=function(){return this.maxX-this.minX};l.prototype.getHeight=function(){return this.maxY-this.minY};return l}();b.SkeletonBounds=h})(spine||(spine={}));
(function(b){var h=function(){function l(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[];this.transformConstraints=[];this.pathConstraints=[];this.fps=0}l.prototype.findBone=function(e){if(null==e)throw Error("boneName cannot be null.");for(var r=this.bones,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findBoneIndex=function(e){if(null==e)throw Error("boneName cannot be null.");for(var r=this.bones,q=0,k=r.length;q<
k;q++)if(r[q].name==e)return q;return-1};l.prototype.findSlot=function(e){if(null==e)throw Error("slotName cannot be null.");for(var r=this.slots,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findSlotIndex=function(e){if(null==e)throw Error("slotName cannot be null.");for(var r=this.slots,q=0,k=r.length;q<k;q++)if(r[q].name==e)return q;return-1};l.prototype.findSkin=function(e){if(null==e)throw Error("skinName cannot be null.");for(var r=this.skins,q=0,k=r.length;q<
k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findEvent=function(e){if(null==e)throw Error("eventDataName cannot be null.");for(var r=this.events,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findAnimation=function(e){if(null==e)throw Error("animationName cannot be null.");for(var r=this.animations,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findIkConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");
for(var r=this.ikConstraints,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findTransformConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var r=this.transformConstraints,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};l.prototype.findPathConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var r=this.pathConstraints,q=0,k=r.length;q<k;q++){var t=r[q];if(t.name==e)return t}return null};
l.prototype.findPathConstraintIndex=function(e){if(null==e)throw Error("pathConstraintName cannot be null.");for(var r=this.pathConstraints,q=0,k=r.length;q<k;q++)if(r[q].name==e)return q;return-1};return l}();b.SkeletonData=h})(spine||(spine={}));
(function(b){var h=function(){function e(r){this.scale=1;this.linkedMeshes=[];this.attachmentLoader=r}e.prototype.readSkeletonData=function(r){var q=this.scale,k=new b.SkeletonData;r="string"===typeof r?JSON.parse(r):r;var t=r.skeleton;null!=t&&(k.hash=t.hash,k.version=t.spine,k.width=t.width,k.height=t.height,k.fps=t.fps,k.imagesPath=t.images);if(r.bones)for(t=0;t<r.bones.length;t++){var p=r.bones[t],y=null,A=this.getValue(p,"parent",null);if(null!=A&&(y=k.findBone(A),null==y))throw Error("Parent bone not found: "+
A);y=new b.BoneData(k.bones.length,p.name,y);y.length=this.getValue(p,"length",0)*q;y.x=this.getValue(p,"x",0)*q;y.y=this.getValue(p,"y",0)*q;y.rotation=this.getValue(p,"rotation",0);y.scaleX=this.getValue(p,"scaleX",1);y.scaleY=this.getValue(p,"scaleY",1);y.shearX=this.getValue(p,"shearX",0);y.shearY=this.getValue(p,"shearY",0);y.transformMode=e.transformModeFromString(this.getValue(p,"transform","normal"));k.bones.push(y)}if(r.slots)for(t=0;t<r.slots.length;t++){p=r.slots[t];var E=p.name;A=p.bone;
y=k.findBone(A);if(null==y)throw Error("Slot bone not found: "+A);y=new b.SlotData(k.slots.length,E,y);A=this.getValue(p,"color",null);null!=A&&y.color.setFromString(A);y.attachmentName=this.getValue(p,"attachment",null);y.blendMode=e.blendModeFromString(this.getValue(p,"blend","normal"));k.slots.push(y)}if(r.ik)for(t=0;t<r.ik.length;t++){p=r.ik[t];y=new b.IkConstraintData(p.name);y.order=this.getValue(p,"order",0);for(var B=0;B<p.bones.length;B++){A=p.bones[B];var G=k.findBone(A);if(null==G)throw Error("IK bone not found: "+
A);y.bones.push(G)}A=p.target;y.target=k.findBone(A);if(null==y.target)throw Error("IK target bone not found: "+A);y.bendDirection=this.getValue(p,"bendPositive",!0)?1:-1;y.mix=this.getValue(p,"mix",1);k.ikConstraints.push(y)}if(r.transform)for(t=0;t<r.transform.length;t++){p=r.transform[t];y=new b.TransformConstraintData(p.name);y.order=this.getValue(p,"order",0);for(B=0;B<p.bones.length;B++){A=p.bones[B];G=k.findBone(A);if(null==G)throw Error("Transform constraint bone not found: "+A);y.bones.push(G)}A=
p.target;y.target=k.findBone(A);if(null==y.target)throw Error("Transform constraint target bone not found: "+A);y.offsetRotation=this.getValue(p,"rotation",0);y.offsetX=this.getValue(p,"x",0)*q;y.offsetY=this.getValue(p,"y",0)*q;y.offsetScaleX=this.getValue(p,"scaleX",0);y.offsetScaleY=this.getValue(p,"scaleY",0);y.offsetShearY=this.getValue(p,"shearY",0);y.rotateMix=this.getValue(p,"rotateMix",1);y.translateMix=this.getValue(p,"translateMix",1);y.scaleMix=this.getValue(p,"scaleMix",1);y.shearMix=
this.getValue(p,"shearMix",1);k.transformConstraints.push(y)}if(r.path)for(t=0;t<r.path.length;t++){p=r.path[t];y=new b.PathConstraintData(p.name);y.order=this.getValue(p,"order",0);for(B=0;B<p.bones.length;B++){A=p.bones[B];G=k.findBone(A);if(null==G)throw Error("Transform constraint bone not found: "+A);y.bones.push(G)}A=p.target;y.target=k.findSlot(A);if(null==y.target)throw Error("Path target slot not found: "+A);y.positionMode=e.positionModeFromString(this.getValue(p,"positionMode","percent"));
y.spacingMode=e.spacingModeFromString(this.getValue(p,"spacingMode","length"));y.rotateMode=e.rotateModeFromString(this.getValue(p,"rotateMode","tangent"));y.offsetRotation=this.getValue(p,"rotation",0);y.position=this.getValue(p,"position",0);y.positionMode==b.PositionMode.Fixed&&(y.position*=q);y.spacing=this.getValue(p,"spacing",0);if(y.spacingMode==b.SpacingMode.Length||y.spacingMode==b.SpacingMode.Fixed)y.spacing*=q;y.rotateMix=this.getValue(p,"rotateMix",1);y.translateMix=this.getValue(p,"translateMix",
1);k.pathConstraints.push(y)}if(r.skins)for(var I in r.skins){t=r.skins[I];q=new b.Skin(I);for(E in t){y=k.findSlotIndex(E);if(-1==y)throw Error("Slot not found: "+E);p=t[E];for(var L in p)A=this.readAttachment(p[L],q,y,L),null!=A&&q.addAttachment(y,L,A)}k.skins.push(q);"default"==q.name&&(k.defaultSkin=q)}t=0;for(E=this.linkedMeshes.length;t<E;t++){I=this.linkedMeshes[t];q=null==I.skin?k.defaultSkin:k.findSkin(I.skin);if(null==q)throw Error("Skin not found: "+I.skin);L=q.getAttachment(I.slotIndex,
I.parent);if(null==L)throw Error("Parent mesh not found: "+I.parent);I.mesh.setParentMesh(L);I.mesh.updateUVs()}this.linkedMeshes.length=0;if(r.events)for(var T in r.events)E=r.events[T],y=new b.EventData(T),y.intValue=this.getValue(E,"int",0),y.floatValue=this.getValue(E,"float",0),y.stringValue=this.getValue(E,"string",""),k.events.push(y);if(r.animations)for(var n in r.animations)this.readAnimation(r.animations[n],n,k);return k};e.prototype.readAttachment=function(r,q,k,t){var p=this.scale;t=this.getValue(r,
"name",t);switch(this.getValue(r,"type","region")){case "region":var y=this.getValue(r,"path",t);k=this.attachmentLoader.newRegionAttachment(q,t,y);if(null==k)break;k.path=y;k.x=this.getValue(r,"x",0)*p;k.y=this.getValue(r,"y",0)*p;k.scaleX=this.getValue(r,"scaleX",1);k.scaleY=this.getValue(r,"scaleY",1);k.rotation=this.getValue(r,"rotation",0);k.width=r.width*p;k.height=r.height*p;p=this.getValue(r,"color",null);null!=p&&k.color.setFromString(p);k.updateOffset();return k;case "boundingbox":y=this.attachmentLoader.newBoundingBoxAttachment(q,
t);if(null==y)break;this.readVertices(r,y,r.vertexCount<<1);p=this.getValue(r,"color",null);null!=p&&y.color.setFromString(p);return y;case "mesh":case "linkedmesh":y=this.getValue(r,"path",t);q=this.attachmentLoader.newMeshAttachment(q,t,y);if(null==q)break;q.path=y;p=this.getValue(r,"color",null);null!=p&&q.color.setFromString(p);y=this.getValue(r,"parent",null);if(null!=y)return q.inheritDeform=this.getValue(r,"deform",!0),this.linkedMeshes.push(new l(q,this.getValue(r,"skin",null),k,y)),q;y=r.uvs;
this.readVertices(r,q,y.length);q.triangles=r.triangles;q.regionUVs=y;q.updateUVs();q.hullLength=2*this.getValue(r,"hull",0);return q;case "path":if(y=this.attachmentLoader.newPathAttachment(q,t),null!=y){y.closed=this.getValue(r,"closed",!1);y.constantSpeed=this.getValue(r,"constantSpeed",!0);k=r.vertexCount;this.readVertices(r,y,k<<1);k=b.Utils.newArray(k/3,0);for(q=0;q<r.lengths.length;q++)k[q++]=r.lengths[q]*p;y.lengths=k;p=this.getValue(r,"color",null);null!=p&&y.color.setFromString(p);return y}}return null};
e.prototype.readVertices=function(r,q,k){var t=this.scale;q.worldVerticesLength=k;r=r.vertices;if(k==r.length){if(1!=t){k=0;for(var p=r.length;k<p;k++)r[k]*=t}q.vertices=b.Utils.toFloatArray(r)}else{var y=[],A=[];k=0;for(p=r.length;k<p;){var E=r[k++];A.push(E);for(E=k+4*E;k<E;k+=4)A.push(r[k]),y.push(r[k+1]*t),y.push(r[k+2]*t),y.push(r[k+3])}q.bones=A;q.vertices=b.Utils.toFloatArray(y)}};e.prototype.readAnimation=function(r,q,k){var t=this.scale,p=[],y=0;if(r.slots)for(var A in r.slots){var E=r.slots[A],
B=k.findSlotIndex(A);if(-1==B)throw Error("Slot not found: "+A);for(var G in E){var I=E[G];if("color"==G){var L=new b.ColorTimeline(I.length);L.slotIndex=B;for(var T=0,n=0;n<I.length;n++){var x=I[n],H=new b.Color;H.setFromString(x.color);L.setFrame(T,x.time,H.r,H.g,H.b,H.a);this.readCurve(x,L,T);T++}p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.ColorTimeline.ENTRIES])}else{G="attachment";L=new b.AttachmentTimeline(I.length);L.slotIndex=B;for(n=T=0;n<I.length;n++)x=I[n],L.setFrame(T++,x.time,
x.name);p.push(L);y=Math.max(y,L.frames[L.getFrameCount()-1])}}}if(r.bones)for(var f in r.bones){E=r.bones[f];H=k.findBoneIndex(f);if(-1==H)throw Error("Bone not found: "+f);for(G in E)if(I=E[G],"rotate"===G){L=new b.RotateTimeline(I.length);L.boneIndex=H;for(n=T=0;n<I.length;n++)x=I[n],L.setFrame(T,x.time,x.angle),this.readCurve(x,L,T),T++;p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.RotateTimeline.ENTRIES])}else if("translate"===G||"scale"===G||"shear"===G){B=1;"scale"===G?L=new b.ScaleTimeline(I.length):
"shear"===G?L=new b.ShearTimeline(I.length):(L=new b.TranslateTimeline(I.length),B=t);L.boneIndex=H;for(n=T=0;n<I.length;n++){x=I[n];var m=this.getValue(x,"x",0),v=this.getValue(x,"y",0);L.setFrame(T,x.time,m*B,v*B);this.readCurve(x,L,T);T++}p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.TranslateTimeline.ENTRIES])}else throw Error("Invalid timeline type for a bone: "+G+" ("+f+")");}if(r.ik)for(var D in r.ik){E=r.ik[D];T=k.findIkConstraint(D);L=new b.IkConstraintTimeline(E.length);L.ikConstraintIndex=
k.ikConstraints.indexOf(T);for(n=T=0;n<E.length;n++)x=E[n],L.setFrame(T,x.time,this.getValue(x,"mix",1),this.getValue(x,"bendPositive",!0)?1:-1),this.readCurve(x,L,T),T++;p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.IkConstraintTimeline.ENTRIES])}if(r.transform)for(D in r.transform){E=r.transform[D];T=k.findTransformConstraint(D);L=new b.TransformConstraintTimeline(E.length);L.transformConstraintIndex=k.transformConstraints.indexOf(T);for(n=T=0;n<E.length;n++)x=E[n],L.setFrame(T,x.time,
this.getValue(x,"rotateMix",1),this.getValue(x,"translateMix",1),this.getValue(x,"scaleMix",1),this.getValue(x,"shearMix",1)),this.readCurve(x,L,T),T++;p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.TransformConstraintTimeline.ENTRIES])}if(r.paths)for(D in r.paths){E=r.paths[D];f=k.findPathConstraintIndex(D);if(-1==f)throw Error("Path constraint not found: "+D);H=k.pathConstraints[f];for(G in E)if(I=E[G],"position"===G||"spacing"===G){B=1;if("spacing"===G){if(L=new b.PathConstraintSpacingTimeline(I.length),
H.spacingMode==b.SpacingMode.Length||H.spacingMode==b.SpacingMode.Fixed)B=t}else L=new b.PathConstraintPositionTimeline(I.length),H.positionMode==b.PositionMode.Fixed&&(B=t);L.pathConstraintIndex=f;for(n=T=0;n<I.length;n++)x=I[n],L.setFrame(T,x.time,this.getValue(x,G,0)*B),this.readCurve(x,L,T),T++;p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===G){L=new b.PathConstraintMixTimeline(I.length);L.pathConstraintIndex=f;for(n=T=0;n<I.length;n++)x=
I[n],L.setFrame(T,x.time,this.getValue(x,"rotateMix",1),this.getValue(x,"translateMix",1)),this.readCurve(x,L,T),T++;p.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.PathConstraintMixTimeline.ENTRIES])}}if(r.deform)for(var C in r.deform){f=r.deform[C];H=k.findSkin(C);if(null==H)throw Error("Skin not found: "+C);for(A in f){E=f[A];B=k.findSlotIndex(A);if(-1==B)throw Error("Slot not found: "+E.name);for(G in E){I=E[G];T=H.getAttachment(B,G);if(null==T)throw Error("Deform attachment not found: "+
I.name);m=null!=T.bones;v=T.vertices;var K=m?v.length/3*2:v.length;L=new b.DeformTimeline(I.length);L.slotIndex=B;L.attachment=T;for(D=T=0;D<I.length;D++){x=I[D];var N=this.getValue(x,"vertices",null);if(null==N)var S=m?b.Utils.newFloatArray(K):v;else{S=b.Utils.newFloatArray(K);n=this.getValue(x,"offset",0);b.Utils.arrayCopy(N,0,S,n,N.length);if(1!=t)for(N=n+N.length;n<N;n++)S[n]*=t;if(!m)for(n=0;n<K;n++)S[n]+=v[n]}L.setFrame(T,x.time,S);this.readCurve(x,L,T);T++}p.push(L);y=Math.max(y,L.frames[L.getFrameCount()-
1])}}}t=r.drawOrder;null==t&&(t=r.draworder);if(null!=t){L=new b.DrawOrderTimeline(t.length);A=k.slots.length;for(D=T=0;D<t.length;D++){G=t[D];C=null;I=this.getValue(G,"offsets",null);if(null!=I){C=b.Utils.newArray(A,-1);x=b.Utils.newArray(A-I.length,0);for(n=f=E=0;n<I.length;n++){H=I[n];B=k.findSlotIndex(H.slot);if(-1==B)throw Error("Slot not found: "+H.slot);for(;E!=B;)x[f++]=E++;C[E+H.offset]=E++}for(;E<A;)x[f++]=E++;for(n=A-1;0<=n;n--)-1==C[n]&&(C[n]=x[--f])}L.setFrame(T++,G.time,C)}p.push(L);
y=Math.max(y,L.frames[L.getFrameCount()-1])}if(r.events){L=new b.EventTimeline(r.events.length);for(n=T=0;n<r.events.length;n++){t=r.events[n];A=k.findEvent(t.name);if(null==A)throw Error("Event not found: "+t.name);B=new b.Event(t.time,A);B.intValue=this.getValue(t,"int",A.intValue);B.floatValue=this.getValue(t,"float",A.floatValue);B.stringValue=this.getValue(t,"string",A.stringValue);L.setFrame(T++,B)}p.push(L);y=Math.max(y,L.frames[L.getFrameCount()-1])}if(isNaN(y))throw Error("Error while parsing animation, duration is NaN");
k.animations.push(new b.Animation(q,p,y))};e.prototype.readCurve=function(r,q,k){r.curve&&("stepped"===r.curve?q.setStepped(k):"[object Array]"===Object.prototype.toString.call(r.curve)&&(r=r.curve,q.setCurve(k,r[0],r[1],r[2],r[3])))};e.prototype.getValue=function(r,q,k){return void 0!==r[q]?r[q]:k};e.blendModeFromString=function(r){r=r.toLowerCase();if("normal"==r)return b.BlendMode.Normal;if("additive"==r)return b.BlendMode.Additive;if("multiply"==r)return b.BlendMode.Multiply;if("screen"==r)return b.BlendMode.Screen;
throw Error("Unknown blend mode: "+r);};e.positionModeFromString=function(r){r=r.toLowerCase();if("fixed"==r)return b.PositionMode.Fixed;if("percent"==r)return b.PositionMode.Percent;throw Error("Unknown position mode: "+r);};e.spacingModeFromString=function(r){r=r.toLowerCase();if("length"==r)return b.SpacingMode.Length;if("fixed"==r)return b.SpacingMode.Fixed;if("percent"==r)return b.SpacingMode.Percent;throw Error("Unknown position mode: "+r);};e.rotateModeFromString=function(r){r=r.toLowerCase();
if("tangent"==r)return b.RotateMode.Tangent;if("chain"==r)return b.RotateMode.Chain;if("chainscale"==r)return b.RotateMode.ChainScale;throw Error("Unknown rotate mode: "+r);};e.transformModeFromString=function(r){r=r.toLowerCase();if("normal"==r)return b.TransformMode.Normal;if("onlytranslation"==r)return b.TransformMode.OnlyTranslation;if("norotationorreflection"==r)return b.TransformMode.NoRotationOrReflection;if("noscale"==r)return b.TransformMode.NoScale;if("noscaleorreflection"==r)return b.TransformMode.NoScaleOrReflection;
throw Error("Unknown transform mode: "+r);};return e}();b.SkeletonJson=h;var l=function(){return function(e,r,q,k){this.mesh=e;this.skin=r;this.slotIndex=q;this.parent=k}}()})(spine||(spine={}));
(function(b){var h=function(){function l(e){this.attachments=[];if(null==e)throw Error("name cannot be null.");this.name=e}l.prototype.addAttachment=function(e,r,q){if(null==q)throw Error("attachment cannot be null.");var k=this.attachments;e>=k.length&&(k.length=e+1);k[e]||(k[e]={});k[e][r]=q};l.prototype.getAttachment=function(e,r){return(e=this.attachments[e])?e[r]:null};l.prototype.attachAll=function(e,r){for(var q=0,k=0;k<e.slots.length;k++){var t=e.slots[k],p=t.getAttachment();if(p&&q<r.attachments.length){var y=
r.attachments[q],A;for(A in y)if(p==y[A]){p=this.getAttachment(q,A);null!=p&&t.setAttachment(p);break}}q++}};return l}();b.Skin=h})(spine||(spine={}));
(function(b){var h=function(){function l(e,r){this.attachmentVertices=[];if(null==e)throw Error("data cannot be null.");if(null==r)throw Error("bone cannot be null.");this.data=e;this.bone=r;this.color=new b.Color;this.setToSetupPose()}l.prototype.getAttachment=function(){return this.attachment};l.prototype.setAttachment=function(e){this.attachment!=e&&(this.attachment=e,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)};l.prototype.setAttachmentTime=function(e){this.attachmentTime=
this.bone.skeleton.time-e};l.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime};l.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))};return l}();b.Slot=h})(spine||(spine={}));
(function(b){var h=function(){return function(l,e,r){this.color=new b.Color(1,1,1,1);if(0>l)throw Error("index must be >= 0.");if(null==e)throw Error("name cannot be null.");if(null==r)throw Error("boneData cannot be null.");this.index=l;this.name=e;this.boneData=r}}();b.SlotData=h})(spine||(spine={}));
(function(b){var h=function(){function r(q){this._image=q}r.prototype.getImage=function(){return this._image};r.filterFromString=function(q){switch(q.toLowerCase()){case "nearest":return l.Nearest;case "linear":return l.Linear;case "mipmap":return l.MipMap;case "mipmapnearestnearest":return l.MipMapNearestNearest;case "mipmaplinearnearest":return l.MipMapLinearNearest;case "mipmapnearestlinear":return l.MipMapNearestLinear;case "mipmaplinearlinear":return l.MipMapLinearLinear;default:throw Error("Unknown texture filter "+
q);}};r.wrapFromString=function(q){switch(q.toLowerCase()){case "mirroredtepeat":return e.MirroredRepeat;case "clamptoedge":return e.ClampToEdge;case "repeat":return e.Repeat;default:throw Error("Unknown texture wrap "+q);}};return r}();b.Texture=h;(function(r){r[r.Nearest=9728]="Nearest";r[r.Linear=9729]="Linear";r[r.MipMap=9987]="MipMap";r[r.MipMapNearestNearest=9984]="MipMapNearestNearest";r[r.MipMapLinearNearest=9985]="MipMapLinearNearest";r[r.MipMapNearestLinear=9986]="MipMapNearestLinear";r[r.MipMapLinearLinear=
9987]="MipMapLinearLinear"})(b.TextureFilter||(b.TextureFilter={}));var l=b.TextureFilter;(function(r){r[r.MirroredRepeat=33648]="MirroredRepeat";r[r.ClampToEdge=33071]="ClampToEdge";r[r.Repeat=10497]="Repeat"})(b.TextureWrap||(b.TextureWrap={}));var e=b.TextureWrap;h=function(){return function(){this.height=this.width=this.v2=this.u2=this.v=this.u=0;this.rotate=!1;this.originalHeight=this.originalWidth=this.offsetY=this.offsetX=0}}();b.TextureRegion=h})(spine||(spine={}));
(function(b){var h=function(){function q(k,t){this.pages=[];this.regions=[];this.load(k,t)}q.prototype.load=function(k,t){if(null==t)throw Error("textureLoader cannot be null.");k=new l(k);for(var p=Array(4),y=null;;){var A=k.readLine();if(null==A)break;A=A.trim();if(0==A.length)y=null;else if(y){var E=new r;E.name=A;E.page=y;E.rotate="true"==k.readValue();k.readTuple(p);A=parseInt(p[0]);var B=parseInt(p[1]);k.readTuple(p);var G=parseInt(p[0]),I=parseInt(p[1]);E.u=A/y.width;E.v=B/y.height;E.rotate?
(E.u2=(A+I)/y.width,E.v2=(B+G)/y.height):(E.u2=(A+G)/y.width,E.v2=(B+I)/y.height);E.x=A;E.y=B;E.width=Math.abs(G);E.height=Math.abs(I);4==k.readTuple(p)&&4==k.readTuple(p)&&k.readTuple(p);E.originalWidth=parseInt(p[0]);E.originalHeight=parseInt(p[1]);k.readTuple(p);E.offsetX=parseInt(p[0]);E.offsetY=parseInt(p[1]);E.index=parseInt(k.readValue());E.texture=y.texture;this.regions.push(E)}else y=new e,y.name=A,2==k.readTuple(p)&&(y.width=parseInt(p[0]),y.height=parseInt(p[1]),k.readTuple(p)),k.readTuple(p),
y.minFilter=b.Texture.filterFromString(p[0]),y.magFilter=b.Texture.filterFromString(p[1]),E=k.readValue(),y.uWrap=b.TextureWrap.ClampToEdge,y.vWrap=b.TextureWrap.ClampToEdge,"x"==E?y.uWrap=b.TextureWrap.Repeat:"y"==E?y.vWrap=b.TextureWrap.Repeat:"xy"==E&&(y.uWrap=y.vWrap=b.TextureWrap.Repeat),y.texture=t(A),y.texture.setFilters(y.minFilter,y.magFilter),y.texture.setWraps(y.uWrap,y.vWrap),y.width=y.texture.getImage().width,y.height=y.texture.getImage().height,this.pages.push(y)}};q.prototype.findRegion=
function(k){for(var t=0;t<this.regions.length;t++)if(this.regions[t].name==k)return this.regions[t];return null};q.prototype.dispose=function(){for(var k=0;k<this.pages.length;k++)this.pages[k].texture.dispose()};return q}();b.TextureAtlas=h;var l=function(){function q(k){this.index=0;this.lines=k.split(/\r\n|\r|\n/)}q.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]};q.prototype.readValue=function(){var k=this.readLine(),t=k.indexOf(":");if(-1==t)throw Error("Invalid line: "+
k);return k.substring(t+1).trim()};q.prototype.readTuple=function(k){var t=this.readLine(),p=t.indexOf(":");if(-1==p)throw Error("Invalid line: "+t);var y=0;for(p+=1;3>y;y++){var A=t.indexOf(",",p);if(-1==A)break;k[y]=t.substr(p,A-p).trim();p=A+1}k[y]=t.substring(p).trim();return y+1};return q}(),e=function(){return function(){}}();b.TextureAtlasPage=e;var r=function(q){function k(){q.apply(this,arguments)}__extends(k,q);return k}(b.TextureRegion);b.TextureAtlasRegion=r})(spine||(spine={}));
(function(b){var h=function(){function l(e,r){this.shearMix=this.scaleMix=this.translateMix=this.rotateMix=0;this.temp=new b.Vector2;if(null==e)throw Error("data cannot be null.");if(null==r)throw Error("skeleton cannot be null.");this.data=e;this.rotateMix=e.rotateMix;this.translateMix=e.translateMix;this.scaleMix=e.scaleMix;this.shearMix=e.shearMix;this.bones=[];for(var q=0;q<e.bones.length;q++)this.bones.push(r.findBone(e.bones[q].name));this.target=r.findBone(e.target.name)}l.prototype.apply=
function(){this.update()};l.prototype.update=function(){var e=this.rotateMix,r=this.translateMix,q=this.scaleMix,k=this.shearMix,t=this.target,p=t.a,y=t.b,A=t.c,E=t.d,B=0<p*E-y*A?b.MathUtils.degRad:-b.MathUtils.degRad,G=this.data.offsetRotation*B;B*=this.data.offsetShearY;for(var I=this.bones,L=0,T=I.length;L<T;L++){var n=I[L],x=!1;if(0!=e){var H=n.a;x=n.b;var f=n.c,m=n.d,v=Math.atan2(A,p)-Math.atan2(f,H)+G;v>b.MathUtils.PI?v-=b.MathUtils.PI2:v<-b.MathUtils.PI&&(v+=b.MathUtils.PI2);v*=e;var D=Math.cos(v);
v=Math.sin(v);n.a=D*H-v*f;n.b=D*x-v*m;n.c=v*H+D*f;n.d=v*x+D*m;x=!0}0!=r&&(x=this.temp,t.localToWorld(x.set(this.data.offsetX,this.data.offsetY)),n.worldX+=(x.x-n.worldX)*r,n.worldY+=(x.y-n.worldY)*r,x=!0);0<q&&(x=Math.sqrt(n.a*n.a+n.c*n.c),m=Math.sqrt(p*p+A*A),1E-5<x&&(x=(x+(m-x+this.data.offsetScaleX)*q)/x),n.a*=x,n.c*=x,x=Math.sqrt(n.b*n.b+n.d*n.d),m=Math.sqrt(y*y+E*E),1E-5<x&&(x=(x+(m-x+this.data.offsetScaleY)*q)/x),n.b*=x,n.d*=x,x=!0);0<k&&(x=n.b,m=n.d,H=Math.atan2(m,x),v=Math.atan2(E,y)-Math.atan2(A,
p)-(H-Math.atan2(n.c,n.a)),v>b.MathUtils.PI?v-=b.MathUtils.PI2:v<-b.MathUtils.PI&&(v+=b.MathUtils.PI2),v=H+(v+B)*k,x=Math.sqrt(x*x+m*m),n.b=Math.cos(v)*x,n.d=Math.sin(v)*x,x=!0);x&&(n.appliedValid=!1)}};l.prototype.getOrder=function(){return this.data.order};return l}();b.TransformConstraint=h})(spine||(spine={}));
(function(b){var h=function(){return function(l){this.order=0;this.bones=[];this.offsetShearY=this.offsetScaleY=this.offsetScaleX=this.offsetY=this.offsetX=this.offsetRotation=this.shearMix=this.scaleMix=this.translateMix=this.rotateMix=0;if(null==l)throw Error("name cannot be null.");this.name=l}}();b.TransformConstraintData=h})(spine||(spine={}));
(function(b){var h=function(){function l(){this.array=[]}l.prototype.add=function(e){var r=this.contains(e);this.array[e|0]=e|0;return!r};l.prototype.contains=function(e){return void 0!=this.array[e|0]};l.prototype.remove=function(e){this.array[e|0]=void 0};l.prototype.clear=function(){this.array.length=0};return l}();b.IntSet=h;h=function(){function l(e,r,q,k){void 0===e&&(e=0);void 0===r&&(r=0);void 0===q&&(q=0);void 0===k&&(k=0);this.r=e;this.g=r;this.b=q;this.a=k}l.prototype.set=function(e,r,
q,k){this.r=e;this.g=r;this.b=q;this.a=k;this.clamp();return this};l.prototype.setFromColor=function(e){this.r=e.r;this.g=e.g;this.b=e.b;this.a=e.a;return this};l.prototype.setFromString=function(e){e="#"==e.charAt(0)?e.substr(1):e;this.r=parseInt(e.substr(0,2),16)/255;this.g=parseInt(e.substr(2,2),16)/255;this.b=parseInt(e.substr(4,2),16)/255;this.a=(8!=e.length?255:parseInt(e.substr(6,2),16))/255;return this};l.prototype.add=function(e,r,q,k){this.r+=e;this.g+=r;this.b+=q;this.a+=k;this.clamp();
return this};l.prototype.clamp=function(){0>this.r?this.r=0:1<this.r&&(this.r=1);0>this.g?this.g=0:1<this.g&&(this.g=1);0>this.b?this.b=0:1<this.b&&(this.b=1);0>this.a?this.a=0:1<this.a&&(this.a=1);return this};l.WHITE=new l(1,1,1,1);l.RED=new l(1,0,0,1);l.GREEN=new l(0,1,0,1);l.BLUE=new l(0,0,1,1);l.MAGENTA=new l(1,0,1,1);return l}();b.Color=h;h=function(){function l(){}l.clamp=function(e,r,q){return e<r?r:e>q?q:e};l.cosDeg=function(e){return Math.cos(e*l.degRad)};l.sinDeg=function(e){return Math.sin(e*
l.degRad)};l.signum=function(e){return 0<e?1:0>e?-1:0};l.toInt=function(e){return 0<e?Math.floor(e):Math.ceil(e)};l.cbrt=function(e){var r=Math.pow(Math.abs(e),1/3);return 0>e?-r:r};l.PI=3.1415927;l.PI2=2*l.PI;l.radiansToDegrees=180/l.PI;l.radDeg=l.radiansToDegrees;l.degreesToRadians=l.PI/180;l.degRad=l.degreesToRadians;return l}();b.MathUtils=h;h=function(){function l(){}l.arrayCopy=function(e,r,q,k,t){for(var p=r;p<r+t;p++,k++)q[k]=e[p]};l.setArraySize=function(e,r,q){void 0===q&&(q=0);var k=e.length;
if(k==r)return e;e.length=r;if(k<r)for(;k<r;k++)e[k]=q;return e};l.ensureArrayCapacity=function(e,r,q){void 0===q&&(q=0);return e.length>=r?e:l.setArraySize(e,r,q)};l.newArray=function(e,r){for(var q=Array(e),k=0;k<e;k++)q[k]=r;return q};l.newFloatArray=function(e){if(l.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);e=Array(e);for(var r=0;r<e.length;r++)e[r]=0;return e};l.toFloatArray=function(e){return l.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e};l.SUPPORTS_TYPED_ARRAYS="undefined"!==typeof Float32Array;
return l}();b.Utils=h;h=function(){function l(){}l.logBones=function(e){for(var r=0;r<e.bones.length;r++){var q=e.bones[r];console.log(q.data.name+", "+q.a+", "+q.b+", "+q.c+", "+q.d+", "+q.worldX+", "+q.worldY)}};return l}();b.DebugUtils=h;h=function(){function l(e){this.items=[];this.instantiator=e}l.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()};l.prototype.free=function(e){e.reset&&e.reset();this.items.push(e)};l.prototype.freeAll=function(e){for(var r=
0;r<e.length;r++)e[r].reset&&e[r].reset(),this.items[r]=e[r]};l.prototype.clear=function(){this.items.length=0};return l}();b.Pool=h;h=function(){function l(e,r){void 0===e&&(e=0);void 0===r&&(r=0);this.x=e;this.y=r}l.prototype.set=function(e,r){this.x=e;this.y=r;return this};l.prototype.length=function(){var e=this.x,r=this.y;return Math.sqrt(e*e+r*r)};l.prototype.normalize=function(){var e=this.length();0!=e&&(this.x/=e,this.y/=e);return this};return l}();b.Vector2=h;h=function(){function l(){this.maxDelta=
.064;this.totalTime=this.delta=this.framesPerSecond=0;this.lastTime=Date.now()/1E3;this.frameTime=this.frameCount=0}l.prototype.update=function(){var e=Date.now()/1E3;this.delta=e-this.lastTime;this.frameTime+=this.delta;this.totalTime+=this.delta;this.delta>this.maxDelta&&(this.delta=this.maxDelta);this.lastTime=e;this.frameCount++;1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameCount=this.frameTime=0)};return l}();b.TimeKeeper=h})(spine||(spine={}));
(function(b){(function(h){var l=function(e){function r(q){void 0===q&&(q="");e.call(this,function(k){return new h.ThreeJsTexture(k)},q)}__extends(r,e);return r}(b.AssetManager);h.AssetManager=l})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){(function(h){var l=function(){function e(r,q){void 0===q&&(q=10920);this.indicesLength=this.verticesLength=0;if(10920<q)throw Error("Can't have more than 10920 triangles per batch: "+q);var k=this.vertices=new Float32Array(q*e.VERTEX_SIZE);q=this.indices=new Uint16Array(3*q);this.mesh=r;var t=new THREE.BufferGeometry;k=this.vertexBuffer=new THREE.InterleavedBuffer(k,e.VERTEX_SIZE);k.dynamic=!0;t.addAttribute("position",new THREE.InterleavedBufferAttribute(k,3,0,!1));t.addAttribute("color",
new THREE.InterleavedBufferAttribute(k,4,3,!1));t.addAttribute("uv",new THREE.InterleavedBufferAttribute(k,2,7,!1));t.setIndex(new THREE.BufferAttribute(q,1));t.getIndex().dynamic=!0;t.drawRange.start=0;t.drawRange.count=0;r.geometry=t}e.prototype.begin=function(){this.indicesLength=this.verticesLength=0};e.prototype.batch=function(r,q,k){void 0===k&&(k=0);for(var t=this.verticesLength/e.VERTEX_SIZE,p=this.vertices,y=this.verticesLength,A=0;A<r.length;)p[y++]=r[A++],p[y++]=r[A++],p[y++]=k,p[y++]=
r[A++],p[y++]=r[A++],p[y++]=r[A++],p[y++]=r[A++],p[y++]=r[A++],p[y++]=r[A++];this.verticesLength=y;r=this.indices;y=this.indicesLength;for(A=0;A<q.length;y++,A++)r[y]=q[A]+t;this.indicesLength+=q.length};e.prototype.end=function(){this.vertexBuffer.needsUpdate=!0;this.vertexBuffer.updateRange.offset=0;this.vertexBuffer.updateRange.count=this.verticesLength;var r=this.mesh.geometry;r.getIndex().needsUpdate=!0;r.getIndex().updateRange.offset=0;r.getIndex().updateRange.count=this.indicesLength;r.drawRange.start=
0;r.drawRange.count=this.indicesLength};e.VERTEX_SIZE=9;return e}();h.MeshBatcher=l})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){(function(h){var l=function(e){function r(q){e.call(this);this.zOffset=.1;this.skeleton=new b.Skeleton(q);q=new b.AnimationStateData(q);this.state=new b.AnimationState(q);q=this.material=new THREE.MeshBasicMaterial;q.side=THREE.DoubleSide;q.transparent=!0;q.alphaTest=.5;this.batcher=new h.MeshBatcher(this)}__extends(r,e);r.prototype.update=function(q){var k=this.state,t=this.skeleton;k.update(q);k.apply(t);t.updateWorldTransform();this.updateGeometry()};r.prototype.updateGeometry=function(){var q=
this.skeleton.drawOrder,k=this.batcher;k.begin();for(var t=0,p=this.zOffset,y=0,A=q.length;y<A;y++){var E=q[y];var B=E.getAttachment();if(B instanceof b.RegionAttachment){var G=B;E=G.updateWorldVertices(E,!1);B=r.QUAD_TRIANGLES;G=G.region.renderObject.texture}else if(B instanceof b.MeshAttachment)G=B,E=G.updateWorldVertices(E,!1),B=G.triangles,G=G.region.renderObject.texture;else continue;if(null!=G){if(!this.material.map){var I=this.material;I.map=G.texture;I.needsUpdate=!0}this.batcher.batch(E,
B,t);t+=p}}k.end()};r.createMesh=function(q){var k=new THREE.BufferGeometry,t=new Float32Array(1024);t.set([-200,-200,1,0,0,1,0,0,200,-200,0,1,0,1,1,0,200,200,0,0,1,1,1,1,-200,200,1,1,0,.1,0,1],0);t=new THREE.InterleavedBuffer(t,8);var p=new THREE.InterleavedBufferAttribute(t,2,0,!1);k.addAttribute("position",p);p=new THREE.InterleavedBufferAttribute(t,4,2,!1);k.addAttribute("color",p);new THREE.InterleavedBufferAttribute(t,2,6,!1);k.addAttribute("uv",p);t=new Uint16Array(1024);t.set([0,1,2,2,3,0],
0);k.setIndex(new THREE.BufferAttribute(t,1));k.drawRange.start=0;k.drawRange.count=6;t=new THREE.MeshBasicMaterial;t.vertexColors=THREE.VertexColors;t.transparent=!0;t.map=q;return new THREE.Mesh(k,t)};r.QUAD_TRIANGLES=[0,1,2,2,3,0];return r}(THREE.Mesh);h.SkeletonMesh=l})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){(function(h){var l=function(e){function r(q){e.call(this,q);this.texture=new THREE.Texture(q);this.texture.flipY=!1;this.texture.needsUpdate=!0}__extends(r,e);r.prototype.setFilters=function(q,k){this.texture.minFilter=r.toThreeJsTextureFilter(q);this.texture.magFilter=r.toThreeJsTextureFilter(k)};r.prototype.setWraps=function(q,k){this.texture.wrapS=r.toThreeJsTextureWrap(q);this.texture.wrapT=r.toThreeJsTextureWrap(k)};r.prototype.dispose=function(){this.texture.dispose()};r.toThreeJsTextureFilter=
function(q){if(q===b.TextureFilter.Linear)return THREE.LinearFilter;if(q===b.TextureFilter.MipMap)return THREE.LinearMipMapLinearFilter;if(q===b.TextureFilter.MipMapLinearNearest)return THREE.LinearMipMapNearestFilter;if(q===b.TextureFilter.MipMapNearestLinear)return THREE.NearestMipMapLinearFilter;if(q===b.TextureFilter.MipMapNearestNearest)return THREE.NearestMipMapNearestFilter;if(q===b.TextureFilter.Nearest)return THREE.NearestFilter;throw Error("Unknown texture filter: "+q);};r.toThreeJsTextureWrap=
function(q){if(q===b.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(q===b.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(q===b.TextureWrap.Repeat)return THREE.RepeatWrapping;throw Error("Unknown texture wrap: "+q);};return r}(b.Texture);h.ThreeJsTexture=l})(b.threejs||(b.threejs={}))})(spine||(spine={}));
THREE.Animation=function(b,h){this.root=b;this.data=THREE.AnimationHandler.init(h);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};
THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(b,h){this.currentTime=void 0!==b?b:0;this.weight=void 0!==h?h:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)},reset:function(){for(var b=0,h=this.hierarchy.length;b<h;b++){var l=this.hierarchy[b];void 0===l.animationCache&&(l.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});
var e=this.data.name,r=l.animationCache.animations,q=r[e];void 0===q&&(q={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:l.matrix},r[e]=q);for(l=0;3>l;l++){e=this.keyTypes[l];r=this.data.hierarchy[b].keys[0];for(var k=this.getNextKeyWith(e,b,1);k.time<this.currentTime&&k.index>r.index;)r=k,k=this.getNextKeyWith(e,b,k.index+1);q.prevKey[e]=r;q.nextKey[e]=k}}},resetBlendWeights:function(){for(var b=0,h=this.hierarchy.length;b<h;b++){var l=this.hierarchy[b].animationCache;void 0!==
l&&(l=l.blending,l.positionWeight=0,l.quaternionWeight=0,l.scaleWeight=0)}},update:function(){var b=[],h=new THREE.Vector3,l=new THREE.Vector3,e=new THREE.Quaternion,r=function(k,t){var p=[],y=[];t*=k.length-1;var A=Math.floor(t);t-=A;p[0]=0===A?A:A-1;p[1]=A;p[2]=A>k.length-2?A:A+1;p[3]=A>k.length-3?A:A+2;A=k[p[0]];var E=k[p[1]];var B=k[p[2]];var G=k[p[3]];k=t*t;p=t*k;y[0]=q(A[0],E[0],B[0],G[0],t,k,p);y[1]=q(A[1],E[1],B[1],G[1],t,k,p);y[2]=q(A[2],E[2],B[2],G[2],t,k,p);return y},q=function(k,t,p,y,
A,E,B){k=.5*(p-k);y=.5*(y-t);return(2*(t-p)+k+y)*B+(-3*(t-p)-2*k-y)*E+k*A+t};return function(k){if(!1!==this.isPlaying&&(this.currentTime+=k*this.timeScale,0!==this.weight)){k=this.data.length;if(this.currentTime>k||0>this.currentTime)this.loop?(this.currentTime%=k,0>this.currentTime&&(this.currentTime+=k),this.reset()):this.stop();k=0;for(var t=this.hierarchy.length;k<t;k++)for(var p=this.hierarchy[k],y=p.animationCache.animations[this.data.name],A=p.animationCache.blending,E=0;3>E;E++){var B=this.keyTypes[E],
G=y.prevKey[B],I=y.nextKey[B];if(0<this.timeScale&&I.time<=this.currentTime||0>this.timeScale&&G.time>=this.currentTime){G=this.data.hierarchy[k].keys[0];for(I=this.getNextKeyWith(B,k,1);I.time<this.currentTime&&I.index>G.index;)G=I,I=this.getNextKeyWith(B,k,I.index+1);y.prevKey[B]=G;y.nextKey[B]=I}var L=(this.currentTime-G.time)/(I.time-G.time),T=G[B],n=I[B];0>L&&(L=0);1<L&&(L=1);if("pos"===B)if(this.interpolationType===THREE.AnimationHandler.LINEAR)l.x=T[0]+(n[0]-T[0])*L,l.y=T[1]+(n[1]-T[1])*L,
l.z=T[2]+(n[2]-T[2])*L,G=this.weight/(this.weight+A.positionWeight),p.position.lerp(l,G),A.positionWeight+=this.weight;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)b[0]=this.getPrevKeyWith("pos",k,G.index-1).pos,b[1]=T,b[2]=n,b[3]=this.getNextKeyWith("pos",k,I.index+1).pos,L=.33*L+.33,I=r(b,L),G=this.weight/(this.weight+A.positionWeight),A.positionWeight+=this.weight,B=p.position,B.x+=(I[0]-B.x)*G,B.y+=(I[1]-
B.y)*G,B.z+=(I[2]-B.z)*G,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(L=r(b,1.01*L),h.set(L[0],L[1],L[2]),h.sub(B),h.y=0,h.normalize(),p.rotation.set(0,Math.atan2(h.x,h.z),0))}else"rot"===B?(THREE.Quaternion.slerp(T,n,e,L),0===A.quaternionWeight?(p.quaternion.copy(e),A.quaternionWeight=this.weight):(G=this.weight/(this.weight+A.quaternionWeight),THREE.Quaternion.slerp(p.quaternion,e,p.quaternion,G),A.quaternionWeight+=this.weight)):"scl"===B&&(l.x=T[0]+(n[0]-T[0])*L,l.y=T[1]+
(n[1]-T[1])*L,l.z=T[2]+(n[2]-T[2])*L,G=this.weight/(this.weight+A.scaleWeight),p.scale.lerp(l,G),A.scaleWeight+=this.weight)}return!0}}}(),getNextKeyWith:function(b,h,l){var e=this.data.hierarchy[h].keys;for(l=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?l<e.length-1?l:e.length-1:l%e.length;l<e.length;l++)if(void 0!==e[l][b])return e[l];return this.data.hierarchy[h].keys[0]},getPrevKeyWith:function(b,h,l){var e=this.data.hierarchy[h].keys;
for(l=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<l?l:0:0<=l?l:l+e.length;0<=l;l--)if(void 0!==e[l][b])return e[l];return this.data.hierarchy[h].keys[e.length-1]}};
THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(b){if(!0===b.initialized)return b;for(var h=0;h<b.hierarchy.length;h++){for(var l=0;l<b.hierarchy[h].keys.length;l++)if(0>b.hierarchy[h].keys[l].time&&(b.hierarchy[h].keys[l].time=
0),void 0!==b.hierarchy[h].keys[l].rot&&!(b.hierarchy[h].keys[l].rot instanceof THREE.Quaternion)){var e=b.hierarchy[h].keys[l].rot;b.hierarchy[h].keys[l].rot=(new THREE.Quaternion).fromArray(e)}if(b.hierarchy[h].keys.length&&void 0!==b.hierarchy[h].keys[0].morphTargets){e={};for(l=0;l<b.hierarchy[h].keys.length;l++)for(var r=0;r<b.hierarchy[h].keys[l].morphTargets.length;r++){var q=b.hierarchy[h].keys[l].morphTargets[r];e[q]=-1}b.hierarchy[h].usedMorphTargets=e;for(l=0;l<b.hierarchy[h].keys.length;l++){var k=
{};for(q in e){for(r=0;r<b.hierarchy[h].keys[l].morphTargets.length;r++)if(b.hierarchy[h].keys[l].morphTargets[r]===q){k[q]=b.hierarchy[h].keys[l].morphTargetsInfluences[r];break}r===b.hierarchy[h].keys[l].morphTargets.length&&(k[q]=0)}b.hierarchy[h].keys[l].morphTargetsInfluences=k}}for(l=1;l<b.hierarchy[h].keys.length;l++)b.hierarchy[h].keys[l].time===b.hierarchy[h].keys[l-1].time&&(b.hierarchy[h].keys.splice(l,1),l--);for(l=0;l<b.hierarchy[h].keys.length;l++)b.hierarchy[h].keys[l].index=l}b.initialized=
!0;return b},parse:function(b){var h=function(r,q){q.push(r);for(var k=0;k<r.children.length;k++)h(r.children[k],q)},l=[];if(b instanceof THREE.SkinnedMesh)for(var e=0;e<b.skeleton.bones.length;e++)l.push(b.skeleton.bones[e]);else h(b,l);return l},play:function(b){-1===this.animations.indexOf(b)&&this.animations.push(b)},stop:function(b){b=this.animations.indexOf(b);-1!==b&&this.animations.splice(b,1)},update:function(b){for(var h=0;h<this.animations.length;h++)this.animations[h].resetBlendWeights();
for(h=0;h<this.animations.length;h++)this.animations[h].update(b)}};
THREE.KeyFrameAnimation=function(b){this.root=b.node;this.data=THREE.AnimationHandler.init(b);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;b=0;for(var h=this.hierarchy.length;b<h;b++){var l=this.data.hierarchy[b].sids,e=this.hierarchy[b];if(this.data.hierarchy[b].keys.length&&l){for(var r=0;r<l.length;r++){var q=l[r],k=this.getNextKeyWith(q,b,0);k&&k.apply(q)}e.matrixAutoUpdate=!1;this.data.hierarchy[b].node.updateMatrix();
e.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(b){this.currentTime=void 0!==b?b:0;if(!1===this.isPlaying){this.isPlaying=!0;var h=this.hierarchy.length;for(b=0;b<h;b++){var l=this.hierarchy[b];var e=this.data.hierarchy[b];void 0===e.animationCache&&(e.animationCache={},e.animationCache.prevKey=null,e.animationCache.nextKey=null,e.animationCache.originalMatrix=l.matrix);l=this.data.hierarchy[b].keys;1<l.length&&(e.animationCache.prevKey=l[0],e.animationCache.nextKey=
l[1],this.startTime=Math.min(l[0].time,this.startTime),this.endTime=Math.max(l[l.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1},stop:function(){this.isPaused=this.isPlaying=!1;for(var b=0;b<this.data.hierarchy.length;b++){var h=this.hierarchy[b],l=this.data.hierarchy[b];if(void 0!==l.animationCache){var e=l.animationCache.originalMatrix;e.copy(h.matrix);h.matrix=e;delete l.animationCache}}},update:function(b){if(!1!==this.isPlaying){this.currentTime+=b*this.timeScale;b=this.data.length;
!0===this.loop&&this.currentTime>b&&(this.currentTime%=b);this.currentTime=Math.min(this.currentTime,b);b=0;for(var h=this.hierarchy.length;b<h;b++){var l=this.hierarchy[b],e=this.data.hierarchy[b],r=e.keys;e=e.animationCache;if(r.length){var q=e.prevKey,k=e.nextKey;if(k.time<=this.currentTime){for(;k.time<this.currentTime&&k.index>q.index;)q=k,k=r[q.index+1];e.prevKey=q;e.nextKey=k}k.time>=this.currentTime?q.interpolate(k,this.currentTime):q.interpolate(k,k.time);this.data.hierarchy[b].node.updateMatrix();
l.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(b,h,l){h=this.data.hierarchy[h].keys;for(l%=h.length;l<h.length;l++)if(h[l].hasTarget(b))return h[l];return h[0]},getPrevKeyWith:function(b,h,l){h=this.data.hierarchy[h].keys;for(l=0<=l?l:l+h.length;0<=l;l--)if(h[l].hasTarget(b))return h[l];return h[h.length-1]}};
(function(b){function h(f){B.debug&&console.log("Graph created");this.list_of_graphcanvas=null;this.clear();f&&this.configure(f)}function l(f,m,v,D,C,K){this.id=f;this.type=m;this.origin_id=v;this.origin_slot=D;this.target_id=C;this.target_slot=K;this._data=null;this._pos=new Float32Array(2)}function e(f){this._ctor(f)}function r(f){this._ctor(f)}function q(f,m){this.offset=new Float32Array([0,0]);this.scale=1;this.max_scale=10;this.min_scale=.1;this.onredraw=null;this.enabled=!0;this.last_mouse=
[0,0];this.element=null;this.visible_area=new Float32Array(4);f&&(this.element=f,m||this.bindEvents(f))}function k(f,m,v){v=v||{};this.background_image=k.DEFAULT_BACKGROUND_IMAGE;f&&f.constructor===String&&(f=document.querySelector(f));this.ds=new q;this.zoom_modify_alpha=!0;this.title_text_font=""+B.NODE_TEXT_SIZE+"px Arial";this.inner_text_font="normal "+B.NODE_SUBTEXT_SIZE+"px Arial";this.node_title_color=B.NODE_TITLE_COLOR;this.default_link_color=B.LINK_COLOR;this.default_connection_color={input_off:"#778",
input_on:"#7F7",output_off:"#778",output_on:"#7F7"};this.highquality_render=!0;this.use_gradients=!1;this.editor_alpha=1;this.pause_rendering=!1;this.clear_background=!0;this.read_only=!1;this.render_only_selected=!0;this.live_mode=!1;this.allow_searchbox=this.allow_interaction=this.allow_dragnodes=this.allow_dragcanvas=this.show_info=!0;this.drag_mode=this.allow_reconnect_links=!1;this.filter=this.dragging_rectangle=null;this.set_canvas_dirty_on_mouse_event=!0;this.always_render_background=!1;this.render_canvas_border=
this.render_shadows=!0;this.render_connections_shadows=!1;this.render_connections_border=!0;this.render_connection_arrows=this.render_curved_connections=!1;this.render_collapsed_slots=!0;this.render_execution_order=!1;this.render_link_tooltip=this.render_title_colored=!0;this.links_render_mode=B.SPLINE_LINK;this.mouse=[0,0];this.canvas_mouse=this.graph_mouse=[0,0];this.onAfterChange=this.onBeforeChange=this.onConnectingChange=this.onSelectionChange=this.onNodeMoved=this.onDrawLinkTooltip=this.onDrawOverlay=
this.onDrawForeground=this.onDrawBackground=this.onMouse=this.onSearchBoxSelection=this.onSearchBox=null;this.connections_width=3;this.round_radius=8;this.over_link_center=this.node_widget=this.current_node=null;this.last_mouse_position=[0,0];this.visible_area=this.ds.visible_area;this.visible_links=[];m&&m.attachCanvas(this);this.setCanvas(f);this.clear();v.skip_render||this.startRendering();this.autoresize=v.autoresize}function t(f,m){return Math.sqrt((m[0]-f[0])*(m[0]-f[0])+(m[1]-f[1])*(m[1]-f[1]))}
function p(f,m,v,D,C,K){return v<f&&v+C>f&&D<m&&D+K>m?!0:!1}function y(f,m){var v=f[0]+f[2],D=f[1]+f[3],C=m[1]+m[3];return f[0]>m[0]+m[2]||f[1]>C||v<m[0]||D<m[1]?!1:!0}function A(f,m){function v(U){var X=parseInt(K.style.top);K.style.top=(X+U.deltaY*m.scroll_speed).toFixed()+"px";U.preventDefault();return!0}this.options=m=m||{};var D=this;m.parentMenu&&(m.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),m.parentMenu=null):(this.parentMenu=
m.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var C=null;m.event&&(C=m.event.constructor.name);"MouseEvent"!==C&&"CustomEvent"!==C&&"PointerEvent"!==C&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),m.event=null);var K=document.createElement("div");K.className="litegraph litecontextmenu litemenubar-panel";m.className&&(K.className+=" "+m.className);K.style.minWidth=100;K.style.minHeight=100;K.style.pointerEvents="none";
setTimeout(function(){K.style.pointerEvents="auto"},100);K.addEventListener("mouseup",function(U){U.preventDefault();return!0},!0);K.addEventListener("contextmenu",function(U){if(2!=U.button)return!1;U.preventDefault();return!1},!0);K.addEventListener("mousedown",function(U){if(2==U.button)return D.close(),U.preventDefault(),!0},!0);m.scroll_speed||(m.scroll_speed=.1);K.addEventListener("wheel",v,!0);K.addEventListener("mousewheel",v,!0);this.root=K;m.title&&(C=document.createElement("div"),C.className=
"litemenu-title",C.innerHTML=m.title,K.appendChild(C));for(var N=C=0;N<f.length;N++){var S=f.constructor==Array?f[N]:N;null!=S&&S.constructor!==String&&(S=void 0===S.content?String(S):S.content);this.addItem(S,f[N],m);C++}K.addEventListener("mouseleave",function(U){D.lock||(K.closing_timer&&clearTimeout(K.closing_timer),K.closing_timer=setTimeout(D.close.bind(D,U),500))});K.addEventListener("mouseenter",function(U){K.closing_timer&&clearTimeout(K.closing_timer)});f=document;m.event&&(f=m.event.target.ownerDocument);
f||(f=document);f.fullscreenElement?f.fullscreenElement.appendChild(K):f.body.appendChild(K);C=m.left||0;f=m.top||0;m.event&&(C=m.event.clientX-10,f=m.event.clientY-10,m.title&&(f-=20),m.parentMenu&&(C=m.parentMenu.root.getBoundingClientRect(),C=C.left+C.width),N=document.body.getBoundingClientRect(),S=K.getBoundingClientRect(),0==N.height&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),N.width&&C>N.width-S.width-10&&(C=N.width-S.width-10),N.height&&
f>N.height-S.height-10&&(f=N.height-S.height-10));K.style.left=C+"px";K.style.top=f+"px";m.scale&&(K.style.transform="scale("+m.scale+")")}function E(f){this.points=f;this.nearest=this.selected=-1;this.size=null;this.must_update=!0;this.margin=5}var B=b.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_TEXT_SIZE:14,
NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1E3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,
ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},registerNodeType:function(f,m){if(!m.prototype)throw"Cannot register a simple object, it must be a class with a prototype";
m.type=f;B.debug&&console.log("Node registered: "+f);f.split("/");var v=m.name,D=f.lastIndexOf("/");m.category=f.substr(0,D);m.title||(m.title=v);if(m.prototype)for(var C in e.prototype)m.prototype[C]||(m.prototype[C]=e.prototype[C]);D=this.registered_node_types[f];if(!D&&(Object.hasOwnProperty(m.prototype,"shape")||Object.defineProperty(m.prototype,"shape",{set:function(N){switch(N){case "default":delete this._shape;break;case "box":this._shape=B.BOX_SHAPE;break;case "round":this._shape=B.ROUND_SHAPE;
break;case "circle":this._shape=B.CIRCLE_SHAPE;break;case "card":this._shape=B.CARD_SHAPE;break;default:this._shape=N}},get:function(N){return this._shape},enumerable:!0,configurable:!0}),m.prototype.onPropertyChange&&console.warn("LiteGraph node class "+f+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),m.supported_extensions))for(C in m.supported_extensions){var K=m.supported_extensions[C];K&&K.constructor===String&&(this.node_types_by_file_extension[K.toLowerCase()]=
m)}this.registered_node_types[f]=m;m.constructor.name&&(this.Nodes[v]=m);if(B.onNodeTypeRegistered)B.onNodeTypeRegistered(f,m);if(D&&B.onNodeTypeReplaced)B.onNodeTypeReplaced(f,m,D);m.prototype.onPropertyChange&&console.warn("LiteGraph node class "+f+" has onPropertyChange method, it must be called onPropertyChanged with d at the end");if(m.supported_extensions)for(C=0;C<m.supported_extensions.length;C++)(K=m.supported_extensions[C])&&K.constructor===String&&(this.node_types_by_file_extension[K.toLowerCase()]=
m)},unregisterNodeType:function(f){var m=f.constructor===String?this.registered_node_types[f]:f;if(!m)throw"node type not found: "+f;delete this.registered_node_types[m.type];m.constructor.name&&delete this.Nodes[m.constructor.name]},wrapFunctionAsNode:function(f,m,v,D,C){for(var K=Array(m.length),N="",S=B.getParameterNames(m),U=0;U<S.length;++U)N+="this.addInput('"+S[U]+"',"+(v&&v[U]?"'"+v[U]+"'":"0")+");\n";N+="this.addOutput('out',"+(D?"'"+D+"'":0)+");\n";C&&(N+="this.properties = "+JSON.stringify(C)+
";\n");v=Function(N);v.title=f.split("/").pop();v.desc="Generated from "+m.name;v.prototype.onExecute=function(){for(var X=0;X<K.length;++X)K[X]=this.getInputData(X);X=m.apply(this,K);this.setOutputData(0,X)};this.registerNodeType(f,v)},clearRegisteredTypes:function(){this.registered_node_types={};this.node_types_by_file_extension={};this.Nodes={};this.searchbox_extras={}},addNodeMethod:function(f,m){e.prototype[f]=m;for(var v in this.registered_node_types){var D=this.registered_node_types[v];D.prototype[f]&&
(D.prototype["_"+f]=D.prototype[f]);D.prototype[f]=m}},createNode:function(f,m,v){var D=this.registered_node_types[f];if(!D)return B.debug&&console.log('GraphNode type "'+f+'" not registered.'),null;m=m||D.title||f;var C=null;if(B.catch_exceptions)try{C=new D(m)}catch(N){return console.error(N),null}else C=new D(m);C.type=f;!C.title&&m&&(C.title=m);C.properties||(C.properties={});C.properties_info||(C.properties_info=[]);C.flags||(C.flags={});C.size||(C.size=C.computeSize());C.pos||(C.pos=B.DEFAULT_POSITION.concat());
C.mode||(C.mode=B.ALWAYS);if(v)for(var K in v)C[K]=v[K];return C},getNodeType:function(f){return this.registered_node_types[f]},getNodeTypesInCategory:function(f,m){var v=[],D;for(D in this.registered_node_types){var C=this.registered_node_types[D];C.filter==m&&(""==f?null==C.category&&v.push(C):C.category==f&&v.push(C))}return v},getNodeTypesCategories:function(f){var m={"":1},v;for(v in this.registered_node_types){var D=this.registered_node_types[v];D.category&&!D.skip_list&&D.filter==f&&(m[D.category]=
1)}f=[];for(v in m)f.push(v);return f},reloadNodes:function(f){for(var m=document.getElementsByTagName("script"),v=[],D=0;D<m.length;D++)v.push(m[D]);m=document.getElementsByTagName("head")[0];f=document.location.href+f;for(D=0;D<v.length;D++){var C=v[D].src;if(C&&C.substr(0,f.length)==f)try{B.debug&&console.log("Reloading: "+C);var K=document.createElement("script");K.type="text/javascript";K.src=C;m.appendChild(K);m.removeChild(v[D])}catch(N){if(B.throw_errors)throw N;B.debug&&console.log("Error while reloading "+
C)}}B.debug&&console.log("Nodes reloaded")},cloneObject:function(f,m){if(null==f)return null;f=JSON.parse(JSON.stringify(f));if(!m)return f;for(var v in f)m[v]=f[v];return m},isValidConnection:function(f,m){if(!f||!m||f==m||f==B.EVENT&&m==B.ACTION)return!0;f=String(f);m=String(m);f=f.toLowerCase();m=m.toLowerCase();if(-1==f.indexOf(",")&&-1==m.indexOf(","))return f==m;f=f.split(",");m=m.split(",");for(var v=0;v<f.length;++v)for(var D=0;D<m.length;++D)if(f[v]==m[D])return!0;return!1},registerSearchboxExtra:function(f,
m,v){this.searchbox_extras[m.toLowerCase()]={type:f,desc:m,data:v}},fetchFile:function(f,m,v,D){if(!f)return null;m=m||"text";if(f.constructor===String)return"http"==f.substr(0,4)&&B.proxy&&(f=B.proxy+f.substr(f.indexOf(":")+3)),fetch(f).then(function(K){if(!K.ok)throw Error("File not found");if("arraybuffer"==m)return K.arrayBuffer();if("text"==m||"string"==m)return K.text();if("json"==m)return K.json();if("blob"==m)return K.blob()}).then(function(K){v&&v(K)}).catch(function(K){console.error("error fetching file:",
f);D&&D(K)});if(f.constructor===File||f.constructor===Blob){var C=new FileReader;C.onload=function(K){K=K.target.result;"json"==m&&(K=JSON.parse(K));v&&v(K)};if("arraybuffer"==m)return C.readAsArrayBuffer(f);if("text"==m||"json"==m)return C.readAsText(f);if("blob"==m)return C.readAsBinaryString(f)}return null}};B.getTime="undefined"!=typeof performance?performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?Date.now.bind(Date):"undefined"!=typeof process?function(){var f=process.hrtime();
return.001*f[0]+1E-6*f[1]}:function(){return(new Date).getTime()};b.LGraph=B.LGraph=h;h.supported_types=["number","string","boolean"];h.prototype.getSupportedTypes=function(){return this.supported_types||h.supported_types};h.STATUS_STOPPED=1;h.STATUS_RUNNING=2;h.prototype.clear=function(){this.stop();this.status=h.STATUS_STOPPED;this.last_link_id=this.last_node_id=0;this._version=-1;if(this._nodes)for(var f=0;f<this._nodes.length;++f){var m=this._nodes[f];if(m.onRemoved)m.onRemoved()}this._nodes=
[];this._nodes_by_id={};this._nodes_in_order=[];this._nodes_executable=null;this._groups=[];this.links={};this.iteration=0;this.config={};this.vars={};this.extra={};this.fixedtime=this.runningtime=this.globaltime=0;this.elapsed_time=this.fixedtime_lapse=.01;this.starttime=this.last_update_time=0;this.catch_errors=!0;this.inputs={};this.outputs={};this.change();this.sendActionToCanvas("clear")};h.prototype.attachCanvas=function(f){if(f.constructor!=k)throw"attachCanvas expects a LGraphCanvas instance";
f.graph&&f.graph!=this&&f.graph.detachCanvas(f);f.graph=this;this.list_of_graphcanvas||(this.list_of_graphcanvas=[]);this.list_of_graphcanvas.push(f)};h.prototype.detachCanvas=function(f){if(this.list_of_graphcanvas){var m=this.list_of_graphcanvas.indexOf(f);-1!=m&&(f.graph=null,this.list_of_graphcanvas.splice(m,1))}};h.prototype.start=function(f){if(this.status!=h.STATUS_RUNNING){this.status=h.STATUS_RUNNING;if(this.onPlayEvent)this.onPlayEvent();this.sendEventToAllNodes("onStart");this.last_update_time=
this.starttime=B.getTime();f=f||0;var m=this;if(0==f&&"undefined"!=typeof window&&window.requestAnimationFrame){var v=function(){if(-1==m.execution_timer_id){window.requestAnimationFrame(v);if(m.onBeforeStep)m.onBeforeStep();m.runStep(1,!m.catch_errors);if(m.onAfterStep)m.onAfterStep()}};this.execution_timer_id=-1;v()}else this.execution_timer_id=setInterval(function(){if(m.onBeforeStep)m.onBeforeStep();m.runStep(1,!m.catch_errors);if(m.onAfterStep)m.onAfterStep()},f)}};h.prototype.stop=function(){if(this.status!=
h.STATUS_STOPPED){this.status=h.STATUS_STOPPED;if(this.onStopEvent)this.onStopEvent();null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null);this.sendEventToAllNodes("onStop")}};h.prototype.runStep=function(f,m,v){f=f||1;var D=B.getTime();this.globaltime=.001*(D-this.starttime);var C=this._nodes_executable?this._nodes_executable:this._nodes;if(C){v=v||C.length;if(m){for(var K=0;K<f;K++){for(var N=0;N<v;++N){var S=C[N];if(S.mode==
B.ALWAYS&&S.onExecute)S.onExecute()}this.fixedtime+=this.fixedtime_lapse;if(this.onExecuteStep)this.onExecuteStep()}if(this.onAfterExecute)this.onAfterExecute()}else try{for(K=0;K<f;K++){for(N=0;N<v;++N)if(S=C[N],S.mode==B.ALWAYS&&S.onExecute)S.onExecute();this.fixedtime+=this.fixedtime_lapse;if(this.onExecuteStep)this.onExecuteStep()}if(this.onAfterExecute)this.onAfterExecute();this.errors_in_execution=!1}catch(U){this.errors_in_execution=!0;if(B.throw_errors)throw U;B.debug&&console.log("Error during execution: "+
U);this.stop()}f=B.getTime();D=f-D;0==D&&(D=1);this.execution_time=.001*D;this.globaltime+=.001*D;this.iteration+=1;this.elapsed_time=.001*(f-this.last_update_time);this.last_update_time=f}};h.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1);this._nodes_executable=[];for(var f=0;f<this._nodes_in_order.length;++f)this._nodes_in_order[f].onExecute&&this._nodes_executable.push(this._nodes_in_order[f])};h.prototype.computeExecutionOrder=function(f,m){for(var v=
[],D=[],C={},K={},N={},S=0,U=this._nodes.length;S<U;++S){var X=this._nodes[S];if(!f||X.onExecute){C[X.id]=X;var Z=0;if(X.inputs)for(var V=0,ma=X.inputs.length;V<ma;V++)X.inputs[V]&&null!=X.inputs[V].link&&(Z+=1);0==Z?(D.push(X),m&&(X._level=1)):(m&&(X._level=0),N[X.id]=Z)}}for(;0!=D.length;)if(X=D.shift(),v.push(X),delete C[X.id],X.outputs)for(S=0;S<X.outputs.length;S++)if(f=X.outputs[S],null!=f&&null!=f.links&&0!=f.links.length)for(V=0;V<f.links.length;V++)(U=this.links[f.links[V]])&&!K[U.id]&&(Z=
this.getNodeById(U.target_id),null==Z?K[U.id]=!0:(m&&(!Z._level||Z._level<=X._level)&&(Z._level=X._level+1),K[U.id]=!0,--N[Z.id],0==N[Z.id]&&D.push(Z)));for(S in C)v.push(C[S]);v.length!=this._nodes.length&&B.debug&&console.warn("something went wrong, nodes missing");U=v.length;for(S=0;S<U;++S)v[S].order=S;v=v.sort(function(ia,ja){var ba=ia.constructor.priority||ia.priority||0,fa=ja.constructor.priority||ja.priority||0;return ba==fa?ia.order-ja.order:ba-fa});for(S=0;S<U;++S)v[S].order=S;return v};
h.prototype.getAncestors=function(f){for(var m=[],v=[f],D={};v.length;){var C=v.shift();if(C.inputs){D[C.id]||C==f||(D[C.id]=!0,m.push(C));for(var K=0;K<C.inputs.length;++K){var N=C.getInputNode(K);N&&-1==m.indexOf(N)&&v.push(N)}}}m.sort(function(S,U){return S.order-U.order});return m};h.prototype.arrange=function(f){f=f||100;for(var m=this.computeExecutionOrder(!1,!0),v=[],D=0;D<m.length;++D){var C=m[D],K=C._level||1;v[K]||(v[K]=[]);v[K].push(C)}m=f;for(D=0;D<v.length;++D)if(K=v[D]){for(var N=100,
S=f+B.NODE_TITLE_HEIGHT,U=0;U<K.length;++U)C=K[U],C.pos[0]=m,C.pos[1]=S,C.size[0]>N&&(N=C.size[0]),S+=C.size[1]+f+B.NODE_TITLE_HEIGHT;m+=N+f}this.setDirtyCanvas(!0,!0)};h.prototype.getTime=function(){return this.globaltime};h.prototype.getFixedTime=function(){return this.fixedtime};h.prototype.getElapsedTime=function(){return this.elapsed_time};h.prototype.sendEventToAllNodes=function(f,m,v){v=v||B.ALWAYS;var D=this._nodes_in_order?this._nodes_in_order:this._nodes;if(D)for(var C=0,K=D.length;C<K;++C){var N=
D[C];if(N.constructor===B.Subgraph&&"onExecute"!=f)N.mode==v&&N.sendEventToAllNodes(f,m,v);else if(N[f]&&N.mode==v)if(void 0===m)N[f]();else if(m&&m.constructor===Array)N[f].apply(N,m);else N[f](m)}};h.prototype.sendActionToCanvas=function(f,m){if(this.list_of_graphcanvas)for(var v=0;v<this.list_of_graphcanvas.length;++v){var D=this.list_of_graphcanvas[v];D[f]&&D[f].apply(D,m)}};h.prototype.add=function(f,m){if(f)if(f.constructor===r)this._groups.push(f),this.setDirtyCanvas(!0),this.change(),f.graph=
this,this._version++;else{-1!=f.id&&null!=this._nodes_by_id[f.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),f.id=++this.last_node_id);if(this._nodes.length>=B.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";null==f.id||-1==f.id?f.id=++this.last_node_id:this.last_node_id<f.id&&(this.last_node_id=f.id);f.graph=this;this._version++;this._nodes.push(f);this._nodes_by_id[f.id]=f;if(f.onAdded)f.onAdded(this);this.config.align_to_grid&&f.alignToGrid();
m||this.updateExecutionOrder();if(this.onNodeAdded)this.onNodeAdded(f);this.setDirtyCanvas(!0);this.change();return f}};h.prototype.remove=function(f){if(f.constructor===B.LGraphGroup){var m=this._groups.indexOf(f);-1!=m&&this._groups.splice(m,1);f.graph=null;this._version++;this.setDirtyCanvas(!0,!0);this.change()}else if(null!=this._nodes_by_id[f.id]&&!f.ignore_remove){if(f.inputs)for(m=0;m<f.inputs.length;m++){var v=f.inputs[m];null!=v.link&&f.disconnectInput(m)}if(f.outputs)for(m=0;m<f.outputs.length;m++)v=
f.outputs[m],null!=v.links&&v.links.length&&f.disconnectOutput(m);if(f.onRemoved)f.onRemoved();f.graph=null;this._version++;if(this.list_of_graphcanvas)for(m=0;m<this.list_of_graphcanvas.length;++m)v=this.list_of_graphcanvas[m],v.selected_nodes[f.id]&&delete v.selected_nodes[f.id],v.node_dragged==f&&(v.node_dragged=null);m=this._nodes.indexOf(f);-1!=m&&this._nodes.splice(m,1);delete this._nodes_by_id[f.id];if(this.onNodeRemoved)this.onNodeRemoved(f);this.sendActionToCanvas("checkPanels");this.setDirtyCanvas(!0,
!0);this.change();this.updateExecutionOrder()}};h.prototype.getNodeById=function(f){return null==f?null:this._nodes_by_id[f]};h.prototype.findNodesByClass=function(f,m){m=m||[];for(var v=m.length=0,D=this._nodes.length;v<D;++v)this._nodes[v].constructor===f&&m.push(this._nodes[v]);return m};h.prototype.findNodesByType=function(f,m){f=f.toLowerCase();m=m||[];for(var v=m.length=0,D=this._nodes.length;v<D;++v)this._nodes[v].type.toLowerCase()==f&&m.push(this._nodes[v]);return m};h.prototype.findNodeByTitle=
function(f){for(var m=0,v=this._nodes.length;m<v;++m)if(this._nodes[m].title==f)return this._nodes[m];return null};h.prototype.findNodesByTitle=function(f){for(var m=[],v=0,D=this._nodes.length;v<D;++v)this._nodes[v].title==f&&m.push(this._nodes[v]);return m};h.prototype.getNodeOnPos=function(f,m,v,D){v=v||this._nodes;for(var C=v.length-1;0<=C;C--){var K=v[C];if(K.isPointInside(f,m,D))return K}return null};h.prototype.getGroupOnPos=function(f,m){for(var v=this._groups.length-1;0<=v;v--){var D=this._groups[v];
if(D.isPointInside(f,m,2,!0))return D}return null};h.prototype.checkNodeTypes=function(){for(var f=0;f<this._nodes.length;f++){var m=this._nodes[f];if(m.constructor!=B.registered_node_types[m.type]){console.log("node being replaced by newer version: "+m.type);var v=B.createNode(m.type);this._nodes[f]=v;v.configure(m.serialize());v.graph=this;this._nodes_by_id[v.id]=v;m.inputs&&(v.inputs=m.inputs.concat());m.outputs&&(v.outputs=m.outputs.concat())}}this.updateExecutionOrder()};h.prototype.onAction=
function(f,m){this._input_nodes=this.findNodesByClass(B.GraphInput,this._input_nodes);for(var v=0;v<this._input_nodes.length;++v){var D=this._input_nodes[v];if(D.properties.name==f){D.onAction(f,m);break}}};h.prototype.trigger=function(f,m){if(this.onTrigger)this.onTrigger(f,m)};h.prototype.addInput=function(f,m,v){if(!this.inputs[f]){this.beforeChange();this.inputs[f]={name:f,type:m,value:v};this._version++;this.afterChange();if(this.onInputAdded)this.onInputAdded(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()}};
h.prototype.setInputData=function(f,m){if(f=this.inputs[f])f.value=m};h.prototype.getInputData=function(f){return(f=this.inputs[f])?f.value:null};h.prototype.renameInput=function(f,m){if(m!=f){if(!this.inputs[f])return!1;if(this.inputs[m])return console.error("there is already one input with that name"),!1;this.inputs[m]=this.inputs[f];delete this.inputs[f];this._version++;if(this.onInputRenamed)this.onInputRenamed(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()}};h.prototype.changeInputType=
function(f,m){if(!this.inputs[f])return!1;if(!this.inputs[f].type||String(this.inputs[f].type).toLowerCase()!=String(m).toLowerCase())if(this.inputs[f].type=m,this._version++,this.onInputTypeChanged)this.onInputTypeChanged(f,m)};h.prototype.removeInput=function(f){if(!this.inputs[f])return!1;delete this.inputs[f];this._version++;if(this.onInputRemoved)this.onInputRemoved(f);if(this.onInputsOutputsChange)this.onInputsOutputsChange();return!0};h.prototype.addOutput=function(f,m,v){this.outputs[f]={name:f,
type:m,value:v};this._version++;if(this.onOutputAdded)this.onOutputAdded(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()};h.prototype.setOutputData=function(f,m){if(f=this.outputs[f])f.value=m};h.prototype.getOutputData=function(f){return(f=this.outputs[f])?f.value:null};h.prototype.renameOutput=function(f,m){if(!this.outputs[f])return!1;if(this.outputs[m])return console.error("there is already one output with that name"),!1;this.outputs[m]=this.outputs[f];delete this.outputs[f];this._version++;
if(this.onOutputRenamed)this.onOutputRenamed(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()};h.prototype.changeOutputType=function(f,m){if(!this.outputs[f])return!1;if(!this.outputs[f].type||String(this.outputs[f].type).toLowerCase()!=String(m).toLowerCase())if(this.outputs[f].type=m,this._version++,this.onOutputTypeChanged)this.onOutputTypeChanged(f,m)};h.prototype.removeOutput=function(f){if(!this.outputs[f])return!1;delete this.outputs[f];this._version++;if(this.onOutputRemoved)this.onOutputRemoved(f);
if(this.onInputsOutputsChange)this.onInputsOutputsChange();return!0};h.prototype.triggerInput=function(f,m){f=this.findNodesByTitle(f);for(var v=0;v<f.length;++v)f[v].onTrigger(m)};h.prototype.setCallback=function(f,m){f=this.findNodesByTitle(f);for(var v=0;v<f.length;++v)f[v].setTrigger(m)};h.prototype.beforeChange=function(f){if(this.onBeforeChange)this.onBeforeChange(this,f);this.sendActionToCanvas("onBeforeChange",this)};h.prototype.afterChange=function(f){if(this.onAfterChange)this.onAfterChange(this,
f);this.sendActionToCanvas("onAfterChange",this)};h.prototype.connectionChange=function(f,m){this.updateExecutionOrder();if(this.onConnectionChange)this.onConnectionChange(f);this._version++;this.sendActionToCanvas("onConnectionChange")};h.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var f=0;f<this.list_of_graphcanvas.length;++f)if(this.list_of_graphcanvas[f].live_mode)return!0;return!1};h.prototype.clearTriggeredSlots=function(){for(var f in this.links){var m=this.links[f];
m&&m._last_time&&(m._last_time=0)}};h.prototype.change=function(){B.debug&&console.log("Graph changed");this.sendActionToCanvas("setDirty",[!0,!0]);if(this.on_change)this.on_change(this)};h.prototype.setDirtyCanvas=function(f,m){this.sendActionToCanvas("setDirty",[f,m])};h.prototype.removeLink=function(f){if(f=this.links[f]){var m=this.getNodeById(f.target_id);m&&m.disconnectInput(f.target_slot)}};h.prototype.serialize=function(){for(var f=[],m=0,v=this._nodes.length;m<v;++m)f.push(this._nodes[m].serialize());
v=[];for(m in this.links){var D=this.links[m];if(!D.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var C=new l;for(K in D)C[K]=D[K];D=this.links[m]=C}v.push(D.serialize())}var K=[];for(m=0;m<this._groups.length;++m)K.push(this._groups[m].serialize());f={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:f,links:v,groups:K,config:this.config,extra:this.extra,version:B.VERSION};if(this.onSerialize)this.onSerialize(f);return f};h.prototype.configure=
function(f,m){if(f){m||this.clear();m=f.nodes;if(f.links&&f.links.constructor===Array){for(var v=[],D=0;D<f.links.length;++D){var C=f.links[D];if(C){var K=new l;K.configure(C);v[K.id]=K}else console.warn("serialized graph link data contains errors, skipping.")}f.links=v}for(D in f)"nodes"!=D&&"groups"!=D&&(this[D]=f[D]);v=!1;this._nodes=[];if(m){D=0;for(C=m.length;D<C;++D){K=m[D];var N=B.createNode(K.type,K.title);N||(B.debug&&console.log("Node not found or has errors: "+K.type),N=new e,N.last_serialization=
K,v=N.has_errors=!0);N.id=K.id;this.add(N,!0)}D=0;for(C=m.length;D<C;++D)K=m[D],(N=this.getNodeById(K.id))&&N.configure(K)}this._groups.length=0;if(f.groups)for(D=0;D<f.groups.length;++D)m=new B.LGraphGroup,m.configure(f.groups[D]),this.add(m);this.updateExecutionOrder();this.extra=f.extra||{};if(this.onConfigure)this.onConfigure(f);this._version++;this.setDirtyCanvas(!0,!0);return v}};h.prototype.load=function(f){var m=this,v=new XMLHttpRequest;v.open("GET",f,!0);v.send(null);v.onload=function(D){200!==
v.status?console.error("Error loading graph:",v.status,v.response):(D=JSON.parse(v.response),m.configure(D))};v.onerror=function(D){console.error("Error loading graph:",D)}};h.prototype.onNodeTrace=function(f,m,v){};l.prototype.configure=function(f){f.constructor===Array?(this.id=f[0],this.origin_id=f[1],this.origin_slot=f[2],this.target_id=f[3],this.target_slot=f[4],this.type=f[5]):(this.id=f.id,this.type=f.type,this.origin_id=f.origin_id,this.origin_slot=f.origin_slot,this.target_id=f.target_id,
this.target_slot=f.target_slot)};l.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]};B.LLink=l;b.LGraphNode=B.LGraphNode=e;e.prototype._ctor=function(f){this.title=f||"Unnamed";this.size=[B.NODE_WIDTH,60];this.graph=null;this._pos=new Float32Array(10,10);Object.defineProperty(this,"pos",{set:function(m){!m||2>m.length||(this._pos[0]=m[0],this._pos[1]=m[1])},get:function(){return this._pos},enumerable:!0});this.id=-1;this.type=
null;this.inputs=[];this.outputs=[];this.connections=[];this.properties={};this.properties_info=[];this.flags={}};e.prototype.configure=function(f){this.graph&&this.graph._version++;for(var m in f)if("properties"==m)for(var v in f.properties){if(this.properties[v]=f.properties[v],this.onPropertyChanged)this.onPropertyChanged(v,f.properties[v])}else null!=f[m]&&("object"==typeof f[m]?this[m]&&this[m].configure?this[m].configure(f[m]):this[m]=B.cloneObject(f[m],this[m]):this[m]=f[m]);f.title||(this.title=
this.constructor.title);if(this.onConnectionsChange){if(this.inputs)for(v=0;v<this.inputs.length;++v){m=this.inputs[v];var D=this.graph?this.graph.links[m.link]:null;this.onConnectionsChange(B.INPUT,v,!0,D,m)}if(this.outputs)for(v=0;v<this.outputs.length;++v){var C=this.outputs[v];if(C.links)for(m=0;m<C.links.length;++m)D=this.graph?this.graph.links[C.links[m]]:null,this.onConnectionsChange(B.OUTPUT,v,!0,D,C)}}if(this.widgets){for(v=0;v<this.widgets.length;++v)(m=this.widgets[v])&&m.options&&m.options.property&&
this.properties[m.options.property]&&(m.value=JSON.parse(JSON.stringify(this.properties[m.options.property])));if(f.widgets_values)for(v=0;v<f.widgets_values.length;++v)this.widgets[v]&&(this.widgets[v].value=f.widgets_values[v])}if(this.onConfigure)this.onConfigure(f)};e.prototype.serialize=function(){var f={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:B.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===e&&this.last_serialization)return this.last_serialization;
this.inputs&&(f.inputs=this.inputs);if(this.outputs){for(var m=0;m<this.outputs.length;m++)delete this.outputs[m]._data;f.outputs=this.outputs}this.title&&this.title!=this.constructor.title&&(f.title=this.title);this.properties&&(f.properties=B.cloneObject(this.properties));if(this.widgets&&this.serialize_widgets)for(f.widgets_values=[],m=0;m<this.widgets.length;++m)f.widgets_values[m]=this.widgets[m]?this.widgets[m].value:null;f.type||(f.type=this.constructor.type);this.color&&(f.color=this.color);
this.bgcolor&&(f.bgcolor=this.bgcolor);this.boxcolor&&(f.boxcolor=this.boxcolor);this.shape&&(f.shape=this.shape);this.onSerialize&&this.onSerialize(f)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter");return f};e.prototype.clone=function(){var f=B.createNode(this.type);if(!f)return null;var m=B.cloneObject(this.serialize());if(m.inputs)for(var v=0;v<m.inputs.length;++v)m.inputs[v].link=null;if(m.outputs)for(v=0;v<m.outputs.length;++v)m.outputs[v].links&&
(m.outputs[v].links.length=0);delete m.id;f.configure(m);return f};e.prototype.toString=function(){return JSON.stringify(this.serialize())};e.prototype.getTitle=function(){return this.title||this.constructor.title};e.prototype.setProperty=function(f,m){this.properties||(this.properties={});if(m!==this.properties[f]){var v=this.properties[f];this.properties[f]=m;this.onPropertyChanged&&!1===this.onPropertyChanged(f,m,v)&&(this.properties[f]=v);if(this.widgets)for(v=0;v<this.widgets.length;++v){var D=
this.widgets[v];if(D&&D.options.property==f){D.value=m;break}}}};e.prototype.setOutputData=function(f,m){if(this.outputs&&!(-1==f||f>=this.outputs.length)){var v=this.outputs[f];if(v&&(v._data=m,this.outputs[f].links))for(v=0;v<this.outputs[f].links.length;v++){var D=this.graph.links[this.outputs[f].links[v]];D&&(D.data=m)}}};e.prototype.setOutputDataType=function(f,m){if(this.outputs&&!(-1==f||f>=this.outputs.length)){var v=this.outputs[f];if(v&&(v.type=m,this.outputs[f].links))for(v=0;v<this.outputs[f].links.length;v++)this.graph.links[this.outputs[f].links[v]].type=
m}};e.prototype.getInputData=function(f,m){if(this.inputs&&!(f>=this.inputs.length||null==this.inputs[f].link)){f=this.graph.links[this.inputs[f].link];if(!f)return null;if(!m)return f.data;m=this.graph.getNodeById(f.origin_id);if(!m)return f.data;if(m.updateOutputData)m.updateOutputData(f.origin_slot);else if(m.onExecute)m.onExecute();return f.data}};e.prototype.getInputDataType=function(f){if(!this.inputs||f>=this.inputs.length||null==this.inputs[f].link)return null;f=this.graph.links[this.inputs[f].link];
if(!f)return null;var m=this.graph.getNodeById(f.origin_id);return m?(f=m.outputs[f.origin_slot])?f.type:null:f.type};e.prototype.getInputDataByName=function(f,m){f=this.findInputSlot(f);return-1==f?null:this.getInputData(f,m)};e.prototype.isInputConnected=function(f){return this.inputs?f<this.inputs.length&&null!=this.inputs[f].link:!1};e.prototype.getInputInfo=function(f){return this.inputs?f<this.inputs.length?this.inputs[f]:null:null};e.prototype.getInputLink=function(f){return this.inputs?f<
this.inputs.length?this.graph.links[this.inputs[f].link]:null:null};e.prototype.getInputNode=function(f){if(!this.inputs||f>=this.inputs.length)return null;f=this.inputs[f];return f&&null!==f.link?(f=this.graph.links[f.link])?this.graph.getNodeById(f.origin_id):null:null};e.prototype.getInputOrProperty=function(f){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[f]:null;for(var m=0,v=this.inputs.length;m<v;++m){var D=this.inputs[m];if(f==D.name&&null!=D.link&&(D=this.graph.links[D.link]))return D.data}return this.properties[f]};
e.prototype.getOutputData=function(f){return!this.outputs||f>=this.outputs.length?null:this.outputs[f]._data};e.prototype.getOutputInfo=function(f){return this.outputs?f<this.outputs.length?this.outputs[f]:null:null};e.prototype.isOutputConnected=function(f){return this.outputs?f<this.outputs.length&&this.outputs[f].links&&this.outputs[f].links.length:!1};e.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var f=0;f<this.outputs.length;++f)if(this.outputs[f].links&&this.outputs[f].links.length)return!0;
return!1};e.prototype.getOutputNodes=function(f){if(!this.outputs||0==this.outputs.length||f>=this.outputs.length)return null;f=this.outputs[f];if(!f.links||0==f.links.length)return null;for(var m=[],v=0;v<f.links.length;v++){var D=this.graph.links[f.links[v]];D&&(D=this.graph.getNodeById(D.target_id))&&m.push(D)}return m};e.prototype.trigger=function(f,m){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=B.getTime());for(var v=0;v<this.outputs.length;++v){var D=this.outputs[v];
!D||D.type!==B.EVENT||f&&D.name!=f||this.triggerSlot(v,m)}}};e.prototype.triggerSlot=function(f,m,v){if(this.outputs&&(f=this.outputs[f])&&(f=f.links)&&f.length){this.graph&&(this.graph._last_trigger_time=B.getTime());for(var D=0;D<f.length;++D){var C=f[D];if(null==v||v==C){var K=this.graph.links[f[D]];if(K&&(K._last_time=B.getTime(),C=this.graph.getNodeById(K.target_id)))if(K=C.inputs[K.target_slot],C.onAction)C.onAction(K.name,m);else if(C.mode===B.ON_TRIGGER&&C.onExecute)C.onExecute(m)}}}};e.prototype.clearTriggeredSlot=
function(f,m){if(this.outputs&&(f=this.outputs[f])&&(f=f.links)&&f.length)for(var v=0;v<f.length;++v){var D=f[v];if(null==m||m==D)if(D=this.graph.links[f[v]])D._last_time=0}};e.prototype.setSize=function(f){this.size=f;if(this.onResize)this.onResize(this.size)};e.prototype.addProperty=function(f,m,v,D){v={name:f,type:v,default_value:m};if(D)for(var C in D)v[C]=D[C];this.properties_info||(this.properties_info=[]);this.properties_info.push(v);this.properties||(this.properties={});this.properties[f]=
m;return v};e.prototype.addOutput=function(f,m,v){f={name:f,type:m,links:null};if(v)for(var D in v)f[D]=v[D];this.outputs||(this.outputs=[]);this.outputs.push(f);if(this.onOutputAdded)this.onOutputAdded(f);this.setSize(this.computeSize());this.setDirtyCanvas(!0,!0);return f};e.prototype.addOutputs=function(f){for(var m=0;m<f.length;++m){var v=f[m],D={name:v[0],type:v[1],link:null};if(f[2])for(var C in v[2])D[C]=v[2][C];this.outputs||(this.outputs=[]);this.outputs.push(D);if(this.onOutputAdded)this.onOutputAdded(D)}this.setSize(this.computeSize());
this.setDirtyCanvas(!0,!0)};e.prototype.removeOutput=function(f){this.disconnectOutput(f);this.outputs.splice(f,1);for(var m=f;m<this.outputs.length;++m)if(this.outputs[m]&&this.outputs[m].links)for(var v=this.outputs[m].links,D=0;D<v.length;++D){var C=this.graph.links[v[D]];C&&--C.origin_slot}this.setSize(this.computeSize());if(this.onOutputRemoved)this.onOutputRemoved(f);this.setDirtyCanvas(!0,!0)};e.prototype.addInput=function(f,m,v){f={name:f,type:m||0,link:null};if(v)for(var D in v)f[D]=v[D];
this.inputs||(this.inputs=[]);this.inputs.push(f);this.setSize(this.computeSize());if(this.onInputAdded)this.onInputAdded(f);this.setDirtyCanvas(!0,!0);return f};e.prototype.addInputs=function(f){for(var m=0;m<f.length;++m){var v=f[m],D={name:v[0],type:v[1],link:null};if(f[2])for(var C in v[2])D[C]=v[2][C];this.inputs||(this.inputs=[]);this.inputs.push(D);if(this.onInputAdded)this.onInputAdded(D)}this.setSize(this.computeSize());this.setDirtyCanvas(!0,!0)};e.prototype.removeInput=function(f){this.disconnectInput(f);
for(var m=this.inputs.splice(f,1),v=f;v<this.inputs.length;++v)if(this.inputs[v]){var D=this.graph.links[this.inputs[v].link];D&&--D.target_slot}this.setSize(this.computeSize());if(this.onInputRemoved)this.onInputRemoved(f,m[0]);this.setDirtyCanvas(!0,!0)};e.prototype.addConnection=function(f,m,v,D){f={name:f,type:m,pos:v,direction:D,links:null};this.connections.push(f);return f};e.prototype.computeSize=function(f){function m(Z){return Z?D*Z.length*.6:0}if(this.constructor.size)return this.constructor.size.concat();
var v=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1);f=f||new Float32Array([0,0]);v=Math.max(v,1);var D=B.NODE_TEXT_SIZE,C=m(this.title),K=0,N=0;if(this.inputs)for(var S=0,U=this.inputs.length;S<U;++S){var X=this.inputs[S];X=X.label||X.name||"";X=m(X);K<X&&(K=X)}if(this.outputs)for(S=0,U=this.outputs.length;S<U;++S)X=this.outputs[S],X=X.label||X.name||"",X=m(X),N<X&&(N=X);f[0]=Math.max(K+N+10,C);f[0]=Math.max(f[0],B.NODE_WIDTH);this.widgets&&this.widgets.length&&(f[0]=
Math.max(f[0],1.5*B.NODE_WIDTH));f[1]=(this.constructor.slot_start_y||0)+v*B.NODE_SLOT_HEIGHT;v=0;if(this.widgets&&this.widgets.length){S=0;for(U=this.widgets.length;S<U;++S)v=this.widgets[S].computeSize?v+(this.widgets[S].computeSize(f[0])[1]+4):v+(B.NODE_WIDGET_HEIGHT+4);v+=8}f[1]=this.widgets_up?Math.max(f[1],v):null!=this.widgets_start_y?Math.max(f[1],v+this.widgets_start_y):f[1]+v;this.constructor.min_height&&f[1]<this.constructor.min_height&&(f[1]=this.constructor.min_height);f[1]+=6;return f};
e.prototype.getPropertyInfo=function(f){var m=null;if(this.properties_info)for(var v=0;v<this.properties_info.length;++v)if(this.properties_info[v].name==f){m=this.properties_info[v];break}this.constructor["@"+f]&&(m=this.constructor["@"+f]);this.constructor.widgets_info&&this.constructor.widgets_info[f]&&(m=this.constructor.widgets_info[f]);!m&&this.onGetPropertyInfo&&(m=this.onGetPropertyInfo(f));m||(m={});m.type||(m.type=typeof this.properties[f]);"combo"==m.widget&&(m.type="enum");return m};e.prototype.addWidget=
function(f,m,v,D,C){this.widgets||(this.widgets=[]);!C&&D&&D.constructor===Object&&(C=D,D=null);C&&C.constructor===String&&(C={property:C});D&&D.constructor===String&&(C||(C={}),C.property=D,D=null);D&&D.constructor!==Function&&(console.warn("addWidget: callback must be a function"),D=null);m={type:f.toLowerCase(),name:m,value:v,callback:D,options:C||{}};void 0!==m.options.y&&(m.y=m.options.y);D||m.options.callback||m.options.property||console.warn("LiteGraph addWidget(...) without a callback or property assigned");
if("combo"==f&&!m.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";this.widgets.push(m);this.setSize(this.computeSize());return m};e.prototype.addCustomWidget=function(f){this.widgets||(this.widgets=[]);this.widgets.push(f);return f};e.prototype.getBounding=function(f){f=f||new Float32Array(4);f[0]=this.pos[0]-4;f[1]=this.pos[1]-B.NODE_TITLE_HEIGHT;f[2]=this.size[0]+4;f[3]=this.size[1]+B.NODE_TITLE_HEIGHT;if(this.onBounding)this.onBounding(f);
return f};e.prototype.isPointInside=function(f,m,v,D){v=v||0;var C=this.graph&&this.graph.isLive()?0:B.NODE_TITLE_HEIGHT;D&&(C=0);if(this.flags&&this.flags.collapsed){if(p(f,m,this.pos[0]-v,this.pos[1]-B.NODE_TITLE_HEIGHT-v,(this._collapsed_width||B.NODE_COLLAPSED_WIDTH)+2*v,B.NODE_TITLE_HEIGHT+2*v))return!0}else if(this.pos[0]-4-v<f&&this.pos[0]+this.size[0]+4+v>f&&this.pos[1]-C-v<m&&this.pos[1]+this.size[1]+v>m)return!0;return!1};e.prototype.getSlotInPosition=function(f,m){var v=new Float32Array(2);
if(this.inputs)for(var D=0,C=this.inputs.length;D<C;++D){var K=this.inputs[D];this.getConnectionPos(!0,D,v);if(p(f,m,v[0]-10,v[1]-5,20,10))return{input:K,slot:D,link_pos:v}}if(this.outputs)for(D=0,C=this.outputs.length;D<C;++D)if(K=this.outputs[D],this.getConnectionPos(!1,D,v),p(f,m,v[0]-10,v[1]-5,20,10))return{output:K,slot:D,link_pos:v};return null};e.prototype.findInputSlot=function(f){if(!this.inputs)return-1;for(var m=0,v=this.inputs.length;m<v;++m)if(f==this.inputs[m].name)return m;return-1};
e.prototype.findOutputSlot=function(f){if(!this.outputs)return-1;for(var m=0,v=this.outputs.length;m<v;++m)if(f==this.outputs[m].name)return m;return-1};e.prototype.connect=function(f,m,v){v=v||0;if(!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(f.constructor===String){if(f=this.findOutputSlot(f),-1==f)return B.debug&&console.log("Connect: Error, no slot of name "+f),null}else if(!this.outputs||
f>=this.outputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),null;m&&m.constructor===Number&&(m=this.graph.getNodeById(m));if(!m)throw"target node is null";if(m==this)return null;if(v.constructor===String){if(v=m.findInputSlot(v),-1==v)return B.debug&&console.log("Connect: Error, no slot of name "+v),null}else{if(v===B.EVENT)return null;if(!m.inputs||v>=m.inputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),null}var D=!1;null!=m.inputs[v].link&&
(this.graph.beforeChange(),m.disconnectInput(v),D=!0);var C=this.outputs[f];if(m.onConnectInput&&!1===m.onConnectInput(v,C.type,C,this,f))return null;var K=m.inputs[v],N=null;if(!B.isValidConnection(C.type,K.type))return this.setDirtyCanvas(!1,!0),D&&this.graph.connectionChange(this,N),null;D||this.graph.beforeChange();N=new l(++this.graph.last_link_id,K.type,this.id,f,m.id,v);this.graph.links[N.id]=N;null==C.links&&(C.links=[]);C.links.push(N.id);m.inputs[v].link=N.id;this.graph&&this.graph._version++;
if(this.onConnectionsChange)this.onConnectionsChange(B.OUTPUT,f,!0,N,C);if(m.onConnectionsChange)m.onConnectionsChange(B.INPUT,v,!0,N,K);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.INPUT,m,v,this,f),this.graph.onNodeConnectionChange(B.OUTPUT,this,f,m,v));this.setDirtyCanvas(!1,!0);this.graph.afterChange();this.graph.connectionChange(this,N);return N};e.prototype.disconnectOutput=function(f,m){if(f.constructor===String){if(f=this.findOutputSlot(f),-1==f)return B.debug&&
console.log("Connect: Error, no slot of name "+f),!1}else if(!this.outputs||f>=this.outputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),!1;var v=this.outputs[f];if(!v||!v.links||0==v.links.length)return!1;if(m){m.constructor===Number&&(m=this.graph.getNodeById(m));if(!m)throw"Target Node not found";for(var D=0,C=v.links.length;D<C;D++){var K=v.links[D],N=this.graph.links[K];if(N.target_id==m.id){v.links.splice(D,1);var S=m.inputs[N.target_slot];S.link=null;delete this.graph.links[K];
this.graph&&this.graph._version++;if(m.onConnectionsChange)m.onConnectionsChange(B.INPUT,N.target_slot,!1,N,S);if(this.onConnectionsChange)this.onConnectionsChange(B.OUTPUT,f,!1,N,v);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange(B.OUTPUT,this,f);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.OUTPUT,this,f),this.graph.onNodeConnectionChange(B.INPUT,m,N.target_slot));break}}}else{D=0;for(C=v.links.length;D<C;D++)if(K=v.links[D],
N=this.graph.links[K]){m=this.graph.getNodeById(N.target_id);this.graph&&this.graph._version++;if(m){S=m.inputs[N.target_slot];S.link=null;if(m.onConnectionsChange)m.onConnectionsChange(B.INPUT,N.target_slot,!1,N,S);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange(B.INPUT,m,N.target_slot)}delete this.graph.links[K];if(this.onConnectionsChange)this.onConnectionsChange(B.OUTPUT,f,!1,N,v);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.OUTPUT,
this,f),this.graph.onNodeConnectionChange(B.INPUT,m,N.target_slot))}v.links=null}this.setDirtyCanvas(!1,!0);this.graph.connectionChange(this);return!0};e.prototype.disconnectInput=function(f){if(f.constructor===String){if(f=this.findInputSlot(f),-1==f)return B.debug&&console.log("Connect: Error, no slot of name "+f),!1}else if(!this.inputs||f>=this.inputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),!1;var m=this.inputs[f];if(!m)return!1;var v=this.inputs[f].link;this.inputs[f].link=
null;var D=this.graph.links[v];if(D){var C=this.graph.getNodeById(D.origin_id);if(!C)return!1;var K=C.outputs[D.origin_slot];if(!K||!K.links||0==K.links.length)return!1;for(var N=0,S=K.links.length;N<S;N++)if(K.links[N]==v){K.links.splice(N,1);break}delete this.graph.links[v];this.graph&&this.graph._version++;if(this.onConnectionsChange)this.onConnectionsChange(B.INPUT,f,!1,D,m);if(C.onConnectionsChange)C.onConnectionsChange(B.OUTPUT,N,!1,D,K);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.OUTPUT,
C,N),this.graph.onNodeConnectionChange(B.INPUT,this,f))}this.setDirtyCanvas(!1,!0);this.graph.connectionChange(this);return!0};e.prototype.getConnectionPos=function(f,m,v){v=v||new Float32Array(2);var D=0;f&&this.inputs&&(D=this.inputs.length);!f&&this.outputs&&(D=this.outputs.length);var C=.5*B.NODE_SLOT_HEIGHT;if(this.flags.collapsed)return m=this._collapsed_width||B.NODE_COLLAPSED_WIDTH,this.horizontal?(v[0]=this.pos[0]+.5*m,v[1]=f?this.pos[1]-B.NODE_TITLE_HEIGHT:this.pos[1]):(v[0]=f?this.pos[0]:
this.pos[0]+m,v[1]=this.pos[1]-.5*B.NODE_TITLE_HEIGHT),v;if(f&&-1==m)return v[0]=this.pos[0]+.5*B.NODE_TITLE_HEIGHT,v[1]=this.pos[1]+.5*B.NODE_TITLE_HEIGHT,v;if(f&&D>m&&this.inputs[m].pos)return v[0]=this.pos[0]+this.inputs[m].pos[0],v[1]=this.pos[1]+this.inputs[m].pos[1],v;if(!f&&D>m&&this.outputs[m].pos)return v[0]=this.pos[0]+this.outputs[m].pos[0],v[1]=this.pos[1]+this.outputs[m].pos[1],v;if(this.horizontal)return v[0]=this.pos[0]+this.size[0]/D*(m+.5),v[1]=f?this.pos[1]-B.NODE_TITLE_HEIGHT:this.pos[1]+
this.size[1],v;v[0]=f?this.pos[0]+C:this.pos[0]+this.size[0]+1-C;v[1]=this.pos[1]+(m+.7)*B.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0);return v};e.prototype.alignToGrid=function(){this.pos[0]=B.CANVAS_GRID_SIZE*Math.round(this.pos[0]/B.CANVAS_GRID_SIZE);this.pos[1]=B.CANVAS_GRID_SIZE*Math.round(this.pos[1]/B.CANVAS_GRID_SIZE)};e.prototype.trace=function(f){this.console||(this.console=[]);this.console.push(f);this.console.length>e.MAX_CONSOLE&&this.console.shift();if(this.graph.onNodeTrace)this.graph.onNodeTrace(this,
f)};e.prototype.setDirtyCanvas=function(f,m){this.graph&&this.graph.sendActionToCanvas("setDirty",[f,m])};e.prototype.loadImage=function(f){var m=new Image;m.src=B.node_images_path+f;m.ready=!1;var v=this;m.onload=function(){this.ready=!0;v.setDirtyCanvas(!0)};return m};e.prototype.captureInput=function(f){if(this.graph&&this.graph.list_of_graphcanvas)for(var m=this.graph.list_of_graphcanvas,v=0;v<m.length;++v){var D=m[v];if(f||D.node_capturing_input==this)D.node_capturing_input=f?this:null}};e.prototype.collapse=
function(f){this.graph._version++;if(!1!==this.constructor.collapsable||f)this.flags.collapsed=this.flags.collapsed?!1:!0,this.setDirtyCanvas(!0,!0)};e.prototype.pin=function(f){this.graph._version++;this.flags.pinned=void 0===f?!this.flags.pinned:f};e.prototype.localToScreen=function(f,m,v){return[(f+this.pos[0])*v.scale+v.offset[0],(m+this.pos[1])*v.scale+v.offset[1]]};b.LGraphGroup=B.LGraphGroup=r;r.prototype._ctor=function(f){this.title=f||"Group";this.font_size=24;this.color=k.node_colors.pale_blue?
k.node_colors.pale_blue.groupcolor:"#AAA";this._bounding=new Float32Array([10,10,140,80]);this._pos=this._bounding.subarray(0,2);this._size=this._bounding.subarray(2,4);this._nodes=[];this.graph=null;Object.defineProperty(this,"pos",{set:function(m){!m||2>m.length||(this._pos[0]=m[0],this._pos[1]=m[1])},get:function(){return this._pos},enumerable:!0});Object.defineProperty(this,"size",{set:function(m){!m||2>m.length||(this._size[0]=Math.max(140,m[0]),this._size[1]=Math.max(80,m[1]))},get:function(){return this._size},
enumerable:!0})};r.prototype.configure=function(f){this.title=f.title;this._bounding.set(f.bounding);this.color=f.color;this.font=f.font};r.prototype.serialize=function(){var f=this._bounding;return{title:this.title,bounding:[Math.round(f[0]),Math.round(f[1]),Math.round(f[2]),Math.round(f[3])],color:this.color,font:this.font}};r.prototype.move=function(f,m,v){this._pos[0]+=f;this._pos[1]+=m;if(!v)for(v=0;v<this._nodes.length;++v){var D=this._nodes[v];D.pos[0]+=f;D.pos[1]+=m}};r.prototype.recomputeInsideNodes=
function(){this._nodes.length=0;for(var f=this.graph._nodes,m=new Float32Array(4),v=0;v<f.length;++v){var D=f[v];D.getBounding(m);y(this._bounding,m)&&this._nodes.push(D)}};r.prototype.isPointInside=e.prototype.isPointInside;r.prototype.setDirtyCanvas=e.prototype.setDirtyCanvas;B.DragAndScale=q;q.prototype.bindEvents=function(f){this.last_mouse=new Float32Array(2);this._binded_mouse_callback=this.onMouse.bind(this);f.addEventListener("mousedown",this._binded_mouse_callback);f.addEventListener("mousemove",
this._binded_mouse_callback);f.addEventListener("mousewheel",this._binded_mouse_callback,!1);f.addEventListener("wheel",this._binded_mouse_callback,!1)};q.prototype.computeVisibleArea=function(){if(this.element){var f=-this.offset[0],m=-this.offset[1],v=f+this.element.width/this.scale,D=m+this.element.height/this.scale;this.visible_area[0]=f;this.visible_area[1]=m;this.visible_area[2]=v-f;this.visible_area[3]=D-m}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=
0};q.prototype.onMouse=function(f){if(this.enabled){var m=this.element,v=m.getBoundingClientRect(),D=f.clientX-v.left;v=f.clientY-v.top;f.canvasx=D;f.canvasy=v;f.dragging=this.dragging;var C=!1;this.onmouse&&(C=this.onmouse(f));if("mousedown"==f.type)this.dragging=!0,m.removeEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mouseup",this._binded_mouse_callback);else if("mousemove"==f.type)C||
(m=D-this.last_mouse[0],C=v-this.last_mouse[1],this.dragging&&this.mouseDrag(m,C));else if("mouseup"==f.type)this.dragging=!1,document.body.removeEventListener("mousemove",this._binded_mouse_callback),document.body.removeEventListener("mouseup",this._binded_mouse_callback),m.addEventListener("mousemove",this._binded_mouse_callback);else if("mousewheel"==f.type||"wheel"==f.type||"DOMMouseScroll"==f.type)f.eventType="mousewheel",f.wheel="wheel"==f.type?-f.deltaY:null!=f.wheelDeltaY?f.wheelDeltaY:-60*
f.detail,f.delta=f.wheelDelta?f.wheelDelta/40:f.deltaY?-f.deltaY/3:0,this.changeDeltaScale(1+.05*f.delta);this.last_mouse[0]=D;this.last_mouse[1]=v;f.preventDefault();f.stopPropagation();return!1}};q.prototype.toCanvasContext=function(f){f.scale(this.scale,this.scale);f.translate(this.offset[0],this.offset[1])};q.prototype.convertOffsetToCanvas=function(f){return[(f[0]+this.offset[0])*this.scale,(f[1]+this.offset[1])*this.scale]};q.prototype.convertCanvasToOffset=function(f,m){m=m||[0,0];m[0]=f[0]/
this.scale-this.offset[0];m[1]=f[1]/this.scale-this.offset[1];return m};q.prototype.mouseDrag=function(f,m){this.offset[0]+=f/this.scale;this.offset[1]+=m/this.scale;if(this.onredraw)this.onredraw(this)};q.prototype.changeScale=function(f,m){f<this.min_scale?f=this.min_scale:f>this.max_scale&&(f=this.max_scale);if(f!=this.scale&&this.element){var v=this.element.getBoundingClientRect();if(v&&(m=m||[.5*v.width,.5*v.height],v=this.convertCanvasToOffset(m),this.scale=f,.01>Math.abs(this.scale-1)&&(this.scale=
1),f=this.convertCanvasToOffset(m),f=[f[0]-v[0],f[1]-v[1]],this.offset[0]+=f[0],this.offset[1]+=f[1],this.onredraw))this.onredraw(this)}};q.prototype.changeDeltaScale=function(f,m){this.changeScale(this.scale*f,m)};q.prototype.reset=function(){this.scale=1;this.offset[0]=0;this.offset[1]=0};b.LGraphCanvas=B.LGraphCanvas=k;k.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=";
k.link_type_colors={"-1":B.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"};k.gradients={};k.prototype.clear=function(){this.fps=this.render_time=this.last_draw_time=this.frame=0;this.dragging_rectangle=null;this.selected_nodes={};this.selected_group=null;this.visible_nodes=[];this.connecting_node=this.node_capturing_input=this.node_over=this.node_dragged=null;this.highlighted_links={};this.dragging_canvas=!1;this.dirty_bgcanvas=this.dirty_canvas=!0;this.node_widget=this.node_in_panel=this.dirty_area=
null;this.last_mouse=[0,0];this.last_mouseclick=0;this.visible_area.set([0,0,0,0]);if(this.onClear)this.onClear()};k.prototype.setGraph=function(f,m){this.graph!=f&&(m||this.clear(),!f&&this.graph?this.graph.detachCanvas(this):(f.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)))};k.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph};k.prototype.openSubgraph=function(f){if(!f)throw"graph cannot be null";if(this.graph==
f)throw"graph cannot be the same";this.clear();this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph));f.attachCanvas(this);this.checkPanels();this.setDirty(!0,!0)};k.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var f=this.graph._subgraph_node,m=this._graph_stack.pop();this.selected_nodes={};this.highlighted_links={};m.attachCanvas(this);this.setDirty(!0,!0);f&&(this.centerOnNode(f),this.selectNodes([f]))}};k.prototype.getCurrentGraph=
function(){return this.graph};k.prototype.setCanvas=function(f,m){if(f&&f.constructor===String&&(f=document.getElementById(f),!f))throw"Error creating LiteGraph canvas: Canvas not found";if(f!==this.canvas&&(!f&&this.canvas&&(m||this.unbindEvents()),this.canvas=f,this.ds.element=f)){f.className+=" lgraphcanvas";f.data=this;f.tabindex="1";this.bgcanvas=null;this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height);
if(null==f.getContext){if("canvas"!=f.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+f.localName;throw"This browser doesn't support Canvas";}null==(this.ctx=f.getContext("2d"))&&(f.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL());this._mousemove_callback=this.processMouseMove.bind(this);this._mouseup_callback=this.processMouseUp.bind(this);m||this.bindEvents()}};k.prototype._doNothing=function(f){f.preventDefault();
return!1};k.prototype._doReturnTrue=function(f){f.preventDefault();return!0};k.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var f=this.canvas,m=this.getCanvasWindow().document;this._mousedown_callback=this.processMouseDown.bind(this);this._mousewheel_callback=this.processMouseWheel.bind(this);f.addEventListener("mousedown",this._mousedown_callback,!0);f.addEventListener("mousemove",this._mousemove_callback);f.addEventListener("mousewheel",
this._mousewheel_callback,!1);f.addEventListener("contextmenu",this._doNothing);f.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1);f.addEventListener("touchstart",this.touchHandler,!0);f.addEventListener("touchmove",this.touchHandler,!0);f.addEventListener("touchend",this.touchHandler,!0);f.addEventListener("touchcancel",this.touchHandler,!0);this._key_callback=this.processKey.bind(this);f.addEventListener("keydown",this._key_callback,!0);m.addEventListener("keyup",this._key_callback,
!0);this._ondrop_callback=this.processDrop.bind(this);f.addEventListener("dragover",this._doNothing,!1);f.addEventListener("dragend",this._doNothing,!1);f.addEventListener("drop",this._ondrop_callback,!1);f.addEventListener("dragenter",this._doReturnTrue,!1);this._events_binded=!0}};k.prototype.unbindEvents=function(){if(this._events_binded){var f=this.getCanvasWindow().document;this.canvas.removeEventListener("mousedown",this._mousedown_callback);this.canvas.removeEventListener("mousewheel",this._mousewheel_callback);
this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback);this.canvas.removeEventListener("keydown",this._key_callback);f.removeEventListener("keyup",this._key_callback);this.canvas.removeEventListener("contextmenu",this._doNothing);this.canvas.removeEventListener("drop",this._ondrop_callback);this.canvas.removeEventListener("dragenter",this._doReturnTrue);this.canvas.removeEventListener("touchstart",this.touchHandler);this.canvas.removeEventListener("touchmove",this.touchHandler);
this.canvas.removeEventListener("touchend",this.touchHandler);this.canvas.removeEventListener("touchcancel",this.touchHandler);this._ondrop_callback=this._key_callback=this._mousewheel_callback=this._mousedown_callback=null;this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")};k.getFileExtension=function(f){var m=f.indexOf("?");-1!=m&&(f=f.substr(0,m));m=f.lastIndexOf(".");return-1==m?"":f.substr(m+1).toLowerCase()};k.prototype.enableWebGL=function(){this.gl=this.ctx=enableWebGLCanvas(this.canvas);
this.ctx.webgl=!0;this.bgcanvas=this.canvas;this.bgctx=this.gl;this.canvas.webgl_enabled=!0};k.prototype.setDirty=function(f,m){f&&(this.dirty_canvas=!0);m&&(this.dirty_bgcanvas=!0)};k.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var f=this.canvas.ownerDocument;return f.defaultView||f.parentWindow};k.prototype.startRendering=function(){function f(){this.pause_rendering||this.draw();var m=this.getCanvasWindow();this.is_rendering&&m.requestAnimationFrame(f.bind(this))}this.is_rendering||
(this.is_rendering=!0,f.call(this))};k.prototype.stopRendering=function(){this.is_rendering=!1};k.prototype.blockClick=function(){this.block_click=!0;this.last_mouseclick=0};k.prototype.processMouseDown=function(f){this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){this.adjustMouseEvent(f);var m=this.getCanvasWindow();k.active_canvas=this;var v=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback);m.document.addEventListener("mousemove",this._mousemove_callback,
!0);m.document.addEventListener("mouseup",this._mouseup_callback,!0);var D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes,5),C=!1,K=300>B.getTime()-this.last_mouseclick;this.mouse[0]=f.localX;this.mouse[1]=f.localY;this.graph_mouse[0]=f.canvasX;this.graph_mouse[1]=f.canvasY;this.last_click_position=[this.mouse[0],this.mouse[1]];this.canvas.focus();B.closeAllContextMenus(m);if(!this.onMouse||1!=this.onMouse(f)){if(1==f.which){f.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),
this.dragging_rectangle[0]=f.canvasX,this.dragging_rectangle[1]=f.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,C=!0);var N=!1;if(D&&this.allow_interaction&&!C&&!this.read_only){this.live_mode||D.flags.pinned||this.bringToFront(D);if(!this.connecting_node&&!D.flags.collapsed&&!this.live_mode)if(!C&&!1!==D.resizable&&p(f.canvasX,f.canvasY,D.pos[0]+D.size[0]-5,D.pos[1]+D.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=D,this.canvas.style.cursor="se-resize",C=!0;else{if(D.outputs)for(var S=
0,U=D.outputs.length;S<U;++S){var X=D.outputs[S],Z=D.getConnectionPos(!1,S);if(p(f.canvasX,f.canvasY,Z[0]-15,Z[1]-10,30,20)){this.connecting_node=D;this.connecting_output=X;this.connecting_pos=D.getConnectionPos(!1,S);this.connecting_slot=S;f.shiftKey&&D.disconnectOutput(S);if(K){if(D.onOutputDblClick)D.onOutputDblClick(S,f)}else if(D.onOutputClick)D.onOutputClick(S,f);C=!0;break}}if(D.inputs)for(S=0,U=D.inputs.length;S<U;++S)if(X=D.inputs[S],Z=D.getConnectionPos(!0,S),p(f.canvasX,f.canvasY,Z[0]-
15,Z[1]-10,30,20)){if(K){if(D.onInputDblClick)D.onInputDblClick(S,f)}else if(D.onInputClick)D.onInputClick(S,f);if(null!==X.link){C=this.graph.links[X.link];D.disconnectInput(S);if(this.allow_reconnect_links||f.shiftKey)this.connecting_node=this.graph._nodes_by_id[C.origin_id],this.connecting_slot=C.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot);C=this.dirty_bgcanvas=!0}}}if(!C){S=
!1;U=[f.canvasX-D.pos[0],f.canvasY-D.pos[1]];if(Z=this.processNodeWidgets(D,this.graph_mouse,f))S=!0,this.node_widget=[D,Z];if(K&&this.selected_nodes[D.id]){if(D.onDblClick)D.onDblClick(f,U,this);this.processNodeDblClicked(D);S=!0}D.onMouseDown&&D.onMouseDown(f,U,this)?S=!0:(D.subgraph&&!D.skip_subgraph_button&&!D.flags.collapsed&&U[0]>D.size[0]-B.NODE_TITLE_HEIGHT&&0>U[1]&&(v=this,setTimeout(function(){v.openSubgraph(D.subgraph)},10)),this.live_mode&&(S=N=!0));S||(this.allow_dragnodes&&(this.graph.beforeChange(),
this.node_dragged=D),this.selected_nodes[D.id]||this.processNodeSelected(D,f));this.dirty_canvas=!0}}else{if(!this.read_only)for(S=0;S<this.visible_links.length;++S)if(N=this.visible_links[S],U=N._pos,!(!U||f.canvasX<U[0]-4||f.canvasX>U[0]+4||f.canvasY<U[1]-4||f.canvasY>U[1]+4)){this.showLinkMenu(N,f);this.over_link_center=null;break}this.selected_group=this.graph.getGroupOnPos(f.canvasX,f.canvasY);this.selected_group_resizing=!1;this.selected_group&&!this.read_only&&(f.ctrlKey&&(this.dragging_rectangle=
null),10>t([f.canvasX,f.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.ds.scale?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes());K&&!this.read_only&&this.allow_searchbox&&this.showSearchBox(f);N=!0}!C&&N&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2!=f.which&&3==f.which&&(this.read_only||this.processContextMenu(D,f));this.last_mouse[0]=f.localX;this.last_mouse[1]=f.localY;this.last_mouseclick=
B.getTime();this.last_mouse_dragging=!0;this.graph.change();(!m.document.activeElement||"input"!=m.document.activeElement.nodeName.toLowerCase()&&"textarea"!=m.document.activeElement.nodeName.toLowerCase())&&f.preventDefault();f.stopPropagation();if(this.onMouseDown)this.onMouseDown(f);return!1}}};k.prototype.processMouseMove=function(f){this.autoresize&&this.resize();this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){k.active_canvas=this;this.adjustMouseEvent(f);var m=[f.localX,
f.localY];this.mouse[0]=m[0];this.mouse[1]=m[1];var v=[m[0]-this.last_mouse[0],m[1]-this.last_mouse[1]];this.last_mouse=m;this.graph_mouse[0]=f.canvasX;this.graph_mouse[1]=f.canvasY;if(this.block_click)return f.preventDefault(),!1;f.dragging=this.last_mouse_dragging;this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,f,this.node_widget[1]),this.dirty_canvas=!0);if(this.dragging_rectangle)this.dragging_rectangle[2]=f.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=
f.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only)this.selected_group_resizing?this.selected_group.size=[f.canvasX-this.selected_group.pos[0],f.canvasY-this.selected_group.pos[1]]:(this.selected_group.move(v[0]/this.ds.scale,v[1]/this.ds.scale,f.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)),this.dirty_bgcanvas=!0;else if(this.dragging_canvas)this.ds.offset[0]+=v[0]/this.ds.scale,this.ds.offset[1]+=v[1]/this.ds.scale,this.dirty_bgcanvas=
this.dirty_canvas=!0;else if(this.allow_interaction&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);var D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes);m=0;for(var C=this.graph._nodes.length;m<C;++m)if(this.graph._nodes[m].mouseOver&&D!=this.graph._nodes[m]){this.graph._nodes[m].mouseOver=!1;if(this.node_over&&this.node_over.onMouseLeave)this.node_over.onMouseLeave(f);this.node_over=null;this.dirty_canvas=!0}if(D){D.redraw_on_mouse&&(this.dirty_canvas=!0);if(!D.mouseOver&&
(D.mouseOver=!0,this.node_over=D,this.dirty_canvas=!0,D.onMouseEnter))D.onMouseEnter(f);if(D.onMouseMove)D.onMouseMove(f,[f.canvasX-D.pos[0],f.canvasY-D.pos[1]],this);if(this.connecting_node&&(C=this._highlight_input||[0,0],!this.isOverNodeBox(D,f.canvasX,f.canvasY))){var K=this.isOverNodeInput(D,f.canvasX,f.canvasY,C);-1!=K&&D.inputs[K]?B.isValidConnection(this.connecting_output.type,D.inputs[K].type)&&(this._highlight_input=C):this._highlight_input=null}this.canvas&&(p(f.canvasX,f.canvasY,D.pos[0]+
D.size[0]-5,D.pos[1]+D.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{C=null;for(m=0;m<this.visible_links.length;++m){K=this.visible_links[m];var N=K._pos;if(!(!N||f.canvasX<N[0]-4||f.canvasX>N[0]+4||f.canvasY<N[1]-4||f.canvasY>N[1]+4)){C=K;break}}C!=this.over_link_center&&(this.over_link_center=C,this.dirty_canvas=!0);this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=D&&this.node_capturing_input.onMouseMove)this.node_capturing_input.onMouseMove(f,
[f.canvasX-this.node_capturing_input.pos[0],f.canvasY-this.node_capturing_input.pos[1]],this);if(this.node_dragged&&!this.live_mode){for(m in this.selected_nodes)D=this.selected_nodes[m],D.pos[0]+=v[0]/this.ds.scale,D.pos[1]+=v[1]/this.ds.scale;this.dirty_bgcanvas=this.dirty_canvas=!0}this.resizing_node&&!this.live_mode&&(v=[f.canvasX-this.resizing_node.pos[0],f.canvasY-this.resizing_node.pos[1]],m=this.resizing_node.computeSize(),v[0]=Math.max(m[0],v[0]),v[1]=Math.max(m[1],v[1]),this.resizing_node.setSize(v),
this.canvas.style.cursor="se-resize",this.dirty_bgcanvas=this.dirty_canvas=!0)}f.preventDefault();return!1}};k.prototype.processMouseUp=function(f){this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){var m=this.getCanvasWindow().document;k.active_canvas=this;m.removeEventListener("mousemove",this._mousemove_callback,!0);this.canvas.addEventListener("mousemove",this._mousemove_callback,!0);m.removeEventListener("mouseup",this._mouseup_callback,!0);this.adjustMouseEvent(f);m=
B.getTime();f.click_time=m-this.last_mouseclick;this.last_mouse_dragging=!1;this.last_click_position=null;this.block_click&&(console.log("foo"),this.block_click=!1);if(1==f.which)if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,f),this.node_widget=null,this.selected_group&&(this.selected_group.move(this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]),f.ctrlKey),this.selected_group.pos[0]=
Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null),this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){m=this.graph._nodes;var v=new Float32Array(4);this.deselectAllNodes();var D=Math.abs(this.dragging_rectangle[2]),C=Math.abs(this.dragging_rectangle[3]),K=0>this.dragging_rectangle[3]?this.dragging_rectangle[1]-C:this.dragging_rectangle[1];this.dragging_rectangle[0]=
0>this.dragging_rectangle[2]?this.dragging_rectangle[0]-D:this.dragging_rectangle[0];this.dragging_rectangle[1]=K;this.dragging_rectangle[2]=D;this.dragging_rectangle[3]=C;C=[];for(K=0;K<m.length;++K)D=m[K],D.getBounding(v),y(this.dragging_rectangle,v)&&C.push(D);C.length&&this.selectNodes(C)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_bgcanvas=this.dirty_canvas=!0;if(D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes))this.connecting_output.type==B.EVENT&&
this.isOverNodeBox(D,f.canvasX,f.canvasY)?this.connecting_node.connect(this.connecting_slot,D,B.EVENT):(m=this.isOverNodeInput(D,f.canvasX,f.canvasY),-1!=m?this.connecting_node.connect(this.connecting_slot,D,m):(m=D.getInputInfo(0),this.connecting_output.type==B.EVENT?this.connecting_node.connect(this.connecting_slot,D,B.EVENT):m&&!m.link&&B.isValidConnection(m.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,D,0)));this.connecting_node=this.connecting_pos=this.connecting_output=
null;this.connecting_slot=-1}else if(this.resizing_node)this.dirty_bgcanvas=this.dirty_canvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){(D=this.node_dragged)&&300>f.click_time&&p(f.canvasX,f.canvasY,D.pos[0],D.pos[1]-B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT)&&D.collapse();this.dirty_bgcanvas=this.dirty_canvas=!0;this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]);this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]);
this.graph.config.align_to_grid&&this.node_dragged.alignToGrid();if(this.onNodeMoved)this.onNodeMoved(this.node_dragged);this.graph.afterChange(this.node_dragged);this.node_dragged=null}else{D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes);!D&&300>f.click_time&&this.deselectAllNodes();this.dirty_canvas=!0;this.dragging_canvas=!1;if(this.node_over&&this.node_over.onMouseUp)this.node_over.onMouseUp(f,[f.canvasX-this.node_over.pos[0],f.canvasY-this.node_over.pos[1]],this);if(this.node_capturing_input&&
this.node_capturing_input.onMouseUp)this.node_capturing_input.onMouseUp(f,[f.canvasX-this.node_capturing_input.pos[0],f.canvasY-this.node_capturing_input.pos[1]])}else 2==f.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==f.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);this.graph.change();f.stopPropagation();f.preventDefault();return!1}};k.prototype.processMouseWheel=function(f){if(this.graph&&this.allow_dragcanvas){var m=null!=f.wheelDeltaY?f.wheelDeltaY:-60*f.detail;this.adjustMouseEvent(f);
var v=this.ds.scale;0<m?v*=1.1:0>m&&(v*=1/1.1);this.ds.changeScale(v,[f.localX,f.localY]);this.graph.change();f.preventDefault();return!1}};k.prototype.isOverNodeBox=function(f,m,v){var D=B.NODE_TITLE_HEIGHT;return p(m,v,f.pos[0]+2,f.pos[1]+2-D,D-4,D-4)?!0:!1};k.prototype.isOverNodeInput=function(f,m,v,D){if(f.inputs)for(var C=0,K=f.inputs.length;C<K;++C){var N=f.getConnectionPos(!0,C);if(f.horizontal?p(m,v,N[0]-5,N[1]-10,10,20):p(m,v,N[0]-10,N[1]-5,40,10))return D&&(D[0]=N[0],D[1]=N[1]),C}return-1};
k.prototype.processKey=function(f){if(this.graph){var m=!1;if("input"!=f.target.localName){if("keydown"==f.type){if(32==f.keyCode&&(m=this.dragging_canvas=!0),65==f.keyCode&&f.ctrlKey&&(this.selectNodes(),m=!0),"KeyC"==f.code&&(f.metaKey||f.ctrlKey)&&!f.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),m=!0),"KeyV"!=f.code||!f.metaKey&&!f.ctrlKey||f.shiftKey||this.pasteFromClipboard(),46!=f.keyCode&&8!=f.keyCode||"input"==f.target.localName||"textarea"==f.target.localName||(this.deleteSelectedNodes(),
m=!0),this.selected_nodes)for(var v in this.selected_nodes)if(this.selected_nodes[v].onKeyDown)this.selected_nodes[v].onKeyDown(f)}else if("keyup"==f.type&&(32==f.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(v in this.selected_nodes)if(this.selected_nodes[v].onKeyUp)this.selected_nodes[v].onKeyUp(f);this.graph.change();if(m)return f.preventDefault(),f.stopImmediatePropagation(),!1}}};k.prototype.copyToClipboard=function(){var f={nodes:[],links:[]},m=0,v=[],D;for(D in this.selected_nodes){var C=
this.selected_nodes[D];C._relative_id=m;v.push(C);m+=1}for(D=0;D<v.length;++D)if(C=v[D],m=C.clone()){if(f.nodes.push(m.serialize()),C.inputs&&C.inputs.length)for(m=0;m<C.inputs.length;++m){var K=C.inputs[m];if(K&&null!=K.link&&(K=this.graph.links[K.link])){var N=this.graph.getNodeById(K.origin_id);N&&this.selected_nodes[N.id]&&f.links.push([N._relative_id,K.origin_slot,C._relative_id,K.target_slot])}}}else console.warn("node type not found: "+C.type);localStorage.setItem("litegrapheditor_clipboard",
JSON.stringify(f))};k.prototype.pasteFromClipboard=function(){var f=localStorage.getItem("litegrapheditor_clipboard");if(f){this.graph.beforeChange();f=JSON.parse(f);for(var m=[],v=0;v<f.nodes.length;++v){var D=f.nodes[v],C=B.createNode(D.type);C&&(C.configure(D),C.pos[0]+=5,C.pos[1]+=5,this.graph.add(C),m.push(C))}for(v=0;v<f.links.length;++v){D=f.links[v];C=m[D[0]];var K=m[D[2]];C&&K?C.connect(D[1],K,D[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(m);this.graph.afterChange()}};
k.prototype.processDrop=function(f){f.preventDefault();this.adjustMouseEvent(f);var m=[f.canvasX,f.canvasY],v=this.graph?this.graph.getNodeOnPos(m[0],m[1]):null;if(v){if((v.onDropFile||v.onDropData)&&(m=f.dataTransfer.files)&&m.length)for(var D=0;D<m.length;D++){var C=f.dataTransfer.files[0],K=C.name;k.getFileExtension(K);if(v.onDropFile)v.onDropFile(C);if(v.onDropData){var N=new FileReader;N.onload=function(U){v.onDropData(U.target.result,K,C)};var S=C.type.split("/")[0];"text"==S||""==S?N.readAsText(C):
"image"==S?N.readAsDataURL(C):N.readAsArrayBuffer(C)}}return v.onDropItem&&v.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}m=null;this.onDropItem&&(m=this.onDropItem(event));m||this.checkDropItem(f)};k.prototype.checkDropItem=function(f){if(f.dataTransfer.files.length){var m=f.dataTransfer.files[0],v=k.getFileExtension(m.name).toLowerCase();if(v=B.node_types_by_file_extension[v]){this.graph.beforeChange();v=B.createNode(v.type);v.pos=[f.canvasX,f.canvasY];this.graph.add(v);if(v.onDropFile)v.onDropFile(m);
this.graph.afterChange()}}};k.prototype.processNodeDblClicked=function(f){if(this.onShowNodePanel)this.onShowNodePanel(f);else this.showShowNodePanel(f);if(this.onNodeDblClicked)this.onNodeDblClicked(f);this.setDirty(!0)};k.prototype.processNodeSelected=function(f,m){this.selectNode(f,m&&m.shiftKey);if(this.onNodeSelected)this.onNodeSelected(f)};k.prototype.selectNode=function(f,m){null==f?this.deselectAllNodes():this.selectNodes([f],m)};k.prototype.selectNodes=function(f,m){m||this.deselectAllNodes();
f=f||this.graph._nodes;for(m=0;m<f.length;++m){var v=f[m];if(!v.is_selected){if(!v.is_selected&&v.onSelected)v.onSelected();v.is_selected=!0;this.selected_nodes[v.id]=v;if(v.inputs)for(var D=0;D<v.inputs.length;++D)this.highlighted_links[v.inputs[D].link]=!0;if(v.outputs)for(D=0;D<v.outputs.length;++D){var C=v.outputs[D];if(C.links)for(var K=0;K<C.links.length;++K)this.highlighted_links[C.links[K]]=!0}}}if(this.onSelectionChange)this.onSelectionChange(this.selected_nodes);this.setDirty(!0)};k.prototype.deselectNode=
function(f){if(f.is_selected){if(f.onDeselected)f.onDeselected();f.is_selected=!1;if(this.onNodeDeselected)this.onNodeDeselected(f);if(f.inputs)for(var m=0;m<f.inputs.length;++m)delete this.highlighted_links[f.inputs[m].link];if(f.outputs)for(m=0;m<f.outputs.length;++m){var v=f.outputs[m];if(v.links)for(var D=0;D<v.links.length;++D)delete this.highlighted_links[v.links[D]]}}};k.prototype.deselectAllNodes=function(){if(this.graph){for(var f=this.graph._nodes,m=0,v=f.length;m<v;++m){var D=f[m];if(D.is_selected){if(D.onDeselected)D.onDeselected();
D.is_selected=!1;if(this.onNodeDeselected)this.onNodeDeselected(D)}}this.selected_nodes={};this.current_node=null;this.highlighted_links={};if(this.onSelectionChange)this.onSelectionChange(this.selected_nodes);this.setDirty(!0)}};k.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var f in this.selected_nodes){var m=this.selected_nodes[f];if(!m.block_delete){if(m.inputs&&m.inputs.length&&m.outputs&&m.outputs.length&&B.isValidConnection(m.inputs[0].type,m.outputs[0].type)&&m.inputs[0].link&&
m.outputs[0].links&&m.outputs[0].links.length){var v=m.graph.links[m.inputs[0].link],D=m.graph.links[m.outputs[0].links[0]],C=m.getInputNode(0),K=m.getOutputNodes(0)[0];C&&K&&C.connect(v.origin_slot,K,D.target_slot)}this.graph.remove(m);if(this.onNodeDeselected)this.onNodeDeselected(m)}}this.selected_nodes={};this.current_node=null;this.highlighted_links={};this.setDirty(!0);this.graph.afterChange()};k.prototype.centerOnNode=function(f){this.ds.offset[0]=-f.pos[0]-.5*f.size[0]+.5*this.canvas.width/
this.ds.scale;this.ds.offset[1]=-f.pos[1]-.5*f.size[1]+.5*this.canvas.height/this.ds.scale;this.setDirty(!0,!0)};k.prototype.adjustMouseEvent=function(f){if(this.canvas){var m=this.canvas.getBoundingClientRect();f.localX=f.clientX-m.left;f.localY=f.clientY-m.top}else f.localX=f.clientX,f.localY=f.clientY;f.deltaX=f.localX-this.last_mouse_position[0];f.deltaY=f.localY-this.last_mouse_position[1];this.last_mouse_position[0]=f.localX;this.last_mouse_position[1]=f.localY;f.canvasX=f.localX/this.ds.scale-
this.ds.offset[0];f.canvasY=f.localY/this.ds.scale-this.ds.offset[1]};k.prototype.setZoom=function(f,m){this.ds.changeScale(f,m);this.dirty_bgcanvas=this.dirty_canvas=!0};k.prototype.convertOffsetToCanvas=function(f,m){return this.ds.convertOffsetToCanvas(f,m)};k.prototype.convertCanvasToOffset=function(f,m){return this.ds.convertCanvasToOffset(f,m)};k.prototype.convertEventToCanvasOffset=function(f){var m=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([f.clientX-m.left,f.clientY-
m.top])};k.prototype.bringToFront=function(f){var m=this.graph._nodes.indexOf(f);-1!=m&&(this.graph._nodes.splice(m,1),this.graph._nodes.push(f))};k.prototype.sendToBack=function(f){var m=this.graph._nodes.indexOf(f);-1!=m&&(this.graph._nodes.splice(m,1),this.graph._nodes.unshift(f))};var G=new Float32Array(4);k.prototype.computeVisibleNodes=function(f,m){m=m||[];m.length=0;f=f||this.graph._nodes;for(var v=0,D=f.length;v<D;++v){var C=f[v];(!this.live_mode||C.onDrawBackground||C.onDrawForeground)&&
y(this.visible_area,C.getBounding(G))&&m.push(C)}return m};k.prototype.draw=function(f,m){if(this.canvas&&0!=this.canvas.width&&0!=this.canvas.height){var v=B.getTime();this.render_time=.001*(v-this.last_draw_time);this.last_draw_time=v;this.graph&&this.ds.computeVisibleArea();(this.dirty_bgcanvas||m||this.always_render_background||this.graph&&this.graph._last_trigger_time&&1E3>v-this.graph._last_trigger_time)&&this.drawBackCanvas();(this.dirty_canvas||f)&&this.drawFrontCanvas();this.fps=this.render_time?
1/this.render_time:0;this.frame+=1}};k.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1;this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var f=this.ctx;if(f){f.start2D&&f.start2D();var m=this.canvas;f.restore();f.setTransform(1,0,0,1,0,0);this.dirty_area&&(f.save(),f.beginPath(),f.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),f.clip());this.clear_background&&f.clearRect(0,0,m.width,m.height);this.bgcanvas==this.canvas?this.drawBackCanvas():f.drawImage(this.bgcanvas,
0,0);if(this.onRender)this.onRender(m,f);this.show_info&&this.renderInfo(f);if(this.graph){f.save();this.ds.toCanvasContext(f);m=this.computeVisibleNodes(null,this.visible_nodes);for(var v=0;v<m.length;++v){var D=m[v];f.save();f.translate(D.pos[0],D.pos[1]);this.drawNode(D,f);f.restore()}this.render_execution_order&&this.drawExecutionOrder(f);this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(f));if(null!=this.connecting_pos){f.lineWidth=this.connections_width;switch(this.connecting_output.type){case B.EVENT:m=
B.EVENT_LINK_COLOR;break;default:m=B.CONNECTING_LINK_COLOR}this.renderLink(f,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,m,this.connecting_output.dir||(this.connecting_node.horizontal?B.DOWN:B.RIGHT),B.CENTER);f.beginPath();this.connecting_output.type===B.EVENT||this.connecting_output.shape===B.BOX_SHAPE?f.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):f.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI);f.fill();f.fillStyle="#ffcc00";
this._highlight_input&&(f.beginPath(),f.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),f.fill())}this.dragging_rectangle&&(f.strokeStyle="#FFF",f.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3]));if(this.over_link_center&&this.render_link_tooltip)this.drawLinkTooltip(f,this.over_link_center);else if(this.onDrawLinkTooltip)this.onDrawLinkTooltip(f,null);if(this.onDrawForeground)this.onDrawForeground(f,this.visible_rect);
f.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(f);if(this.onDrawOverlay)this.onDrawOverlay(f);this.dirty_area&&f.restore();f.finish2D&&f.finish2D()}};k.prototype.drawSubgraphPanel=function(f){var m=this.graph,v=m._subgraph_node;if(v){var D=v.inputs?v.inputs.length:0,C=Math.floor(1.6*B.NODE_SLOT_HEIGHT);f.fillStyle="#111";f.globalAlpha=.8;f.beginPath();f.roundRect(10,10,300,(D+1)*C+50,8);f.fill();f.globalAlpha=1;f.fillStyle="#888";f.font="14px Arial";f.textAlign="left";
f.fillText("Graph Inputs",20,34);if(this.drawButton(280,20,20,20,"X","#151515"))this.closeSubgraph();else{D=50;f.font="20px Arial";if(v.inputs)for(var K=0;K<v.inputs.length;++K){var N=v.inputs[K];if(!N.not_subgraph_input){if(this.drawButton(20,D+2,280,C-2)){var S=v.constructor.input_node_type||"graph/input";this.graph.beforeChange();var U=B.createNode(S);U?(m.add(U),this.block_click=!1,this.last_click_position=null,this.selectNodes([U]),this.node_dragged=U,this.dragging_canvas=!1,U.setProperty("name",
N.name),U.setProperty("type",N.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",S)}f.fillStyle="#9C9";f.beginPath();f.arc(284,D+.5*C,5,0,2*Math.PI);f.fill();f.fillStyle="#AAA";f.fillText(N.name,50,D+.75*C);S=f.measureText(N.name);f.fillStyle="#777";f.fillText(N.type,50+S.width+10,D+.75*C);D+=C}}this.drawButton(20,D+2,280,C-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(v)}}else console.warn("subgraph without subnode")};
k.prototype.drawButton=function(f,m,v,D,C,K,N,S){var U=this.ctx;K=K||B.NODE_DEFAULT_COLOR;N=N||"#555";S=S||B.NODE_TEXT_COLOR;var X=this.mouse,Z=B.isInsideRectangle(X[0],X[1],f,m,v,D);X=(X=this.last_click_position)&&B.isInsideRectangle(X[0],X[1],f,m,v,D);U.fillStyle=Z?N:K;X&&(U.fillStyle="#AAA");U.beginPath();U.roundRect(f,m,v,D,4);U.fill();null!=C&&C.constructor==String&&(U.fillStyle=S,U.textAlign="center",U.font=(.65*D|0)+"px Arial",U.fillText(C,f+.5*v,m+.75*D),U.textAlign="left");f=X&&!this.block_click;
X&&this.blockClick();return f};k.prototype.isAreaClicked=function(f,m,v,D,C){var K=this.mouse;B.isInsideRectangle(K[0],K[1],f,m,v,D);m=(f=(K=this.last_click_position)&&B.isInsideRectangle(K[0],K[1],f,m,v,D))&&!this.block_click;f&&C&&this.blockClick();return m};k.prototype.renderInfo=function(f,m,v){m=m||10;v=v||this.canvas.height-80;f.save();f.translate(m,v);f.font="10px Arial";f.fillStyle="#888";this.graph?(f.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),f.fillText("I: "+this.graph.iteration,
5,26),f.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),f.fillText("V: "+this.graph._version,5,52),f.fillText("FPS:"+this.fps.toFixed(2),5,65)):f.fillText("No graph selected",5,13);f.restore()};k.prototype.drawBackCanvas=function(){var f=this.bgcanvas;if(f.width!=this.canvas.width||f.height!=this.canvas.height)f.width=this.canvas.width,f.height=this.canvas.height;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var m=this.bgctx;m.start&&m.start();this.clear_background&&
m.clearRect(0,0,f.width,f.height);if(this._graph_stack&&this._graph_stack.length){m.save();var v=this.graph._subgraph_node;m.strokeStyle=v.bgcolor;m.lineWidth=10;m.strokeRect(1,1,f.width-2,f.height-2);m.lineWidth=1;m.font="40px Arial";m.textAlign="center";m.fillStyle=v.bgcolor||"#AAA";for(var D="",C=1;C<this._graph_stack.length;++C)D+=this._graph_stack[C]._subgraph_node.getTitle()+" >> ";m.fillText(D+v.getTitle(),.5*f.width,40);m.restore()}v=!1;this.onRenderBackground&&(v=this.onRenderBackground(f,
m));m.restore();m.setTransform(1,0,0,1,0,0);this.visible_links.length=0;if(this.graph){m.save();this.ds.toCanvasContext(m);if(this.background_image&&.5<this.ds.scale&&!v){m.globalAlpha=this.zoom_modify_alpha?(1-.5/this.ds.scale)*this.editor_alpha:this.editor_alpha;m.imageSmoothingEnabled=m.mozImageSmoothingEnabled=m.imageSmoothingEnabled=!1;if(!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image;this._bg_img.name=this.background_image;this._bg_img.src=this.background_image;
var K=this;this._bg_img.onload=function(){K.draw(!0,!0)}}v=null;null==this._pattern&&0<this._bg_img.width?(v=m.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=v):v=this._pattern;v&&(m.fillStyle=v,m.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),m.fillStyle="transparent");m.globalAlpha=1;m.imageSmoothingEnabled=m.mozImageSmoothingEnabled=m.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(f,
m);if(this.onDrawBackground)this.onDrawBackground(m,this.visible_area);this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null);this.render_canvas_border&&(m.strokeStyle="#235",m.strokeRect(0,0,f.width,f.height));this.render_connections_shadows?(m.shadowColor="#000",m.shadowOffsetX=0,m.shadowOffsetY=0,m.shadowBlur=6):m.shadowColor="rgba(0,0,0,0)";this.live_mode||this.drawConnections(m);m.shadowColor="rgba(0,0,0,0)";
m.restore()}m.finish&&m.finish();this.dirty_bgcanvas=!1;this.dirty_canvas=!0};var I=new Float32Array(2);k.prototype.drawNode=function(f,m){this.current_node=f;var v=f.color||f.constructor.color||B.NODE_DEFAULT_COLOR,D=f.bgcolor||f.constructor.bgcolor||B.NODE_DEFAULT_BGCOLOR,C=.6>this.ds.scale;if(this.live_mode){if(!f.flags.collapsed&&(m.shadowColor="transparent",f.onDrawForeground))f.onDrawForeground(m,this,this.canvas)}else{var K=this.editor_alpha;m.globalAlpha=K;this.render_shadows&&!C?(m.shadowColor=
B.DEFAULT_SHADOW_COLOR,m.shadowOffsetX=2*this.ds.scale,m.shadowOffsetY=2*this.ds.scale,m.shadowBlur=3*this.ds.scale):m.shadowColor="transparent";if(!f.flags.collapsed||!f.onDrawCollapsed||1!=f.onDrawCollapsed(m,this)){var N=f._shape||B.BOX_SHAPE;I.set(f.size);var S=f.horizontal;if(f.flags.collapsed){m.font=this.inner_text_font;var U=f.getTitle?f.getTitle():f.title;null!=U&&(f._collapsed_width=Math.min(f.size[0],m.measureText(U).width+2*B.NODE_TITLE_HEIGHT),I[0]=f._collapsed_width,I[1]=0)}f.clip_area&&
(m.save(),m.beginPath(),N==B.BOX_SHAPE?m.rect(0,0,I[0],I[1]):N==B.ROUND_SHAPE?m.roundRect(0,0,I[0],I[1],10):N==B.CIRCLE_SHAPE&&m.arc(.5*I[0],.5*I[1],.5*I[0],0,2*Math.PI),m.clip());f.has_errors&&(D="red");this.drawNodeShape(f,m,I,v,D,f.is_selected,f.mouseOver);m.shadowColor="transparent";if(f.onDrawForeground)f.onDrawForeground(m,this,this.canvas);m.textAlign=S?"center":"left";m.font=this.inner_text_font;D=!C;N=this.connecting_output;m.lineWidth=1;U=0;var X=new Float32Array(2);if(!f.flags.collapsed){if(f.inputs)for(v=
0;v<f.inputs.length;v++){var Z=f.inputs[v];m.globalAlpha=K;this.connecting_node&&!B.isValidConnection(Z.type,N.type)&&(m.globalAlpha=.4*K);m.fillStyle=null!=Z.link?Z.color_on||this.default_connection_color.input_on:Z.color_off||this.default_connection_color.input_off;var V=f.getConnectionPos(!0,v,X);V[0]-=f.pos[0];V[1]-=f.pos[1];U<V[1]+.5*B.NODE_SLOT_HEIGHT&&(U=V[1]+.5*B.NODE_SLOT_HEIGHT);m.beginPath();Z.type===B.EVENT||Z.shape===B.BOX_SHAPE?S?m.rect(V[0]-5+.5,V[1]-8+.5,10,14):m.rect(V[0]-6+.5,V[1]-
5+.5,14,10):Z.shape===B.ARROW_SHAPE?(m.moveTo(V[0]+8,V[1]+.5),m.lineTo(V[0]-4,V[1]+6+.5),m.lineTo(V[0]-4,V[1]-6+.5),m.closePath()):C?m.rect(V[0]-4,V[1]-4,8,8):m.arc(V[0],V[1],4,0,2*Math.PI);m.fill();if(D){var ma=null!=Z.label?Z.label:Z.name;ma&&(m.fillStyle=B.NODE_TEXT_COLOR,S||Z.dir==B.UP?m.fillText(ma,V[0],V[1]-10):m.fillText(ma,V[0]+10,V[1]+5))}}this.connecting_node&&(m.globalAlpha=.4*K);m.textAlign=S?"center":"right";m.strokeStyle="black";if(f.outputs)for(v=0;v<f.outputs.length;v++)if(Z=f.outputs[v],
V=f.getConnectionPos(!1,v,X),V[0]-=f.pos[0],V[1]-=f.pos[1],U<V[1]+.5*B.NODE_SLOT_HEIGHT&&(U=V[1]+.5*B.NODE_SLOT_HEIGHT),m.fillStyle=Z.links&&Z.links.length?Z.color_on||this.default_connection_color.output_on:Z.color_off||this.default_connection_color.output_off,m.beginPath(),Z.type===B.EVENT||Z.shape===B.BOX_SHAPE?S?m.rect(V[0]-5+.5,V[1]-8+.5,10,14):m.rect(V[0]-6+.5,V[1]-5+.5,14,10):Z.shape===B.ARROW_SHAPE?(m.moveTo(V[0]+8,V[1]+.5),m.lineTo(V[0]-4,V[1]+6+.5),m.lineTo(V[0]-4,V[1]-6+.5),m.closePath()):
C?m.rect(V[0]-4,V[1]-4,8,8):m.arc(V[0],V[1],4,0,2*Math.PI),m.fill(),C||m.stroke(),D&&(ma=null!=Z.label?Z.label:Z.name))m.fillStyle=B.NODE_TEXT_COLOR,S||Z.dir==B.DOWN?m.fillText(ma,V[0],V[1]-8):m.fillText(ma,V[0]-10,V[1]+5);m.textAlign="left";m.globalAlpha=1;if(f.widgets){Z=U;if(S||f.widgets_up)Z=2;null!=f.widgets_start_y&&(Z=f.widgets_start_y);this.drawNodeWidgets(f,Z,m,this.node_widget&&this.node_widget[0]==f?this.node_widget[1]:null)}}else if(this.render_collapsed_slots){C=K=null;if(f.inputs)for(v=
0;v<f.inputs.length;v++)if(Z=f.inputs[v],null!=Z.link){K=Z;break}if(f.outputs)for(v=0;v<f.outputs.length;v++)Z=f.outputs[v],Z.links&&Z.links.length&&(C=Z);K&&(K=0,v=-.5*B.NODE_TITLE_HEIGHT,S&&(K=.5*f._collapsed_width,v=-B.NODE_TITLE_HEIGHT),m.fillStyle="#686",m.beginPath(),Z.type===B.EVENT||Z.shape===B.BOX_SHAPE?m.rect(K-7+.5,v-4,14,8):Z.shape===B.ARROW_SHAPE?(m.moveTo(K+8,v),m.lineTo(K+-4,v-4),m.lineTo(K+-4,v+4),m.closePath()):m.arc(K,v,4,0,2*Math.PI),m.fill());C&&(K=f._collapsed_width,v=-.5*B.NODE_TITLE_HEIGHT,
S&&(K=.5*f._collapsed_width,v=0),m.fillStyle="#686",m.strokeStyle="black",m.beginPath(),Z.type===B.EVENT||Z.shape===B.BOX_SHAPE?m.rect(K-7+.5,v-4,14,8):Z.shape===B.ARROW_SHAPE?(m.moveTo(K+6,v),m.lineTo(K-6,v-4),m.lineTo(K-6,v+4),m.closePath()):m.arc(K,v,4,0,2*Math.PI),m.fill())}f.clip_area&&m.restore();m.globalAlpha=1}}};k.prototype.drawLinkTooltip=function(f,m){var v=m._pos;f.fillStyle="black";f.beginPath();f.arc(v[0],v[1],3,0,2*Math.PI);f.fill();if(null!=m.data&&(!this.onDrawLinkTooltip||1!=this.onDrawLinkTooltip(f,
m,this))&&(m=m.data,m=m.constructor===Number?m.toFixed(2):m.constructor===String?'"'+m+'"':m.constructor===Boolean?String(m):m.toToolTip?m.toToolTip():"["+m.constructor.name+"]",null!=m)){m=m.substr(0,30);f.font="14px Courier New";var D=f.measureText(m).width+20;f.shadowColor="black";f.shadowOffsetX=2;f.shadowOffsetY=2;f.shadowBlur=3;f.fillStyle="#454";f.beginPath();f.roundRect(v[0]-.5*D,v[1]-15-24,D,24,3,3);f.moveTo(v[0]-10,v[1]-15);f.lineTo(v[0]+10,v[1]-15);f.lineTo(v[0],v[1]-5);f.fill();f.shadowColor=
"transparent";f.textAlign="center";f.fillStyle="#CEC";f.fillText(m,v[0],v[1]-15-24*.3)}};var L=new Float32Array(4);k.prototype.drawNodeShape=function(f,m,v,D,C,K,N){m.strokeStyle=D;m.fillStyle=C;C=B.NODE_TITLE_HEIGHT;var S=.5>this.ds.scale,U=f._shape||f.constructor.shape||B.ROUND_SHAPE,X=f.constructor.title_mode,Z=!0;X==B.TRANSPARENT_TITLE?Z=!1:X==B.AUTOHIDE_TITLE&&N&&(Z=!0);L[0]=0;L[1]=Z?-C:0;L[2]=v[0]+1;L[3]=Z?v[1]+C:v[1];N=m.globalAlpha;m.beginPath();U==B.BOX_SHAPE||S?m.fillRect(L[0],L[1],L[2],
L[3]):U==B.ROUND_SHAPE||U==B.CARD_SHAPE?m.roundRect(L[0],L[1],L[2],L[3],this.round_radius,U==B.CARD_SHAPE?0:this.round_radius):U==B.CIRCLE_SHAPE&&m.arc(.5*v[0],.5*v[1],.5*v[0],0,2*Math.PI);m.fill();f.flags.collapsed||(m.shadowColor="transparent",m.fillStyle="rgba(0,0,0,0.2)",m.fillRect(0,-1,L[2],2));m.shadowColor="transparent";if(f.onDrawBackground)f.onDrawBackground(m,this,this.canvas,this.graph_mouse);if(Z||X==B.TRANSPARENT_TITLE){if(f.onDrawTitleBar)f.onDrawTitleBar(m,C,v,this.ds.scale,D);else if(X!=
B.TRANSPARENT_TITLE&&(f.constructor.title_color||this.render_title_colored)){Z=f.constructor.title_color||D;f.flags.collapsed&&(m.shadowColor=B.DEFAULT_SHADOW_COLOR);if(this.use_gradients){var V=k.gradients[Z];V||(V=k.gradients[Z]=m.createLinearGradient(0,0,400,0),V.addColorStop(0,Z),V.addColorStop(.25,D));m.fillStyle=V}else m.fillStyle=Z;m.beginPath();U==B.BOX_SHAPE||S?m.rect(0,-C,v[0]+1,C):(U==B.ROUND_SHAPE||U==B.CARD_SHAPE)&&m.roundRect(0,-C,v[0]+1,C,this.round_radius,f.flags.collapsed?this.round_radius:
0);m.fill();m.shadowColor="transparent"}if(f.onDrawTitleBox)f.onDrawTitleBox(m,C,v,this.ds.scale);else U==B.ROUND_SHAPE||U==B.CIRCLE_SHAPE||U==B.CARD_SHAPE?(S&&(m.fillStyle="black",m.beginPath(),m.arc(.5*C,-.5*C,6,0,2*Math.PI),m.fill()),m.fillStyle=f.boxcolor||B.NODE_DEFAULT_BOXCOLOR,S?m.fillRect(.5*C-5,-.5*C-5,10,10):(m.beginPath(),m.arc(.5*C,-.5*C,5,0,2*Math.PI),m.fill())):(S&&(m.fillStyle="black",m.fillRect(.5*(C-10)-1,-.5*(C+10)-1,12,12)),m.fillStyle=f.boxcolor||B.NODE_DEFAULT_BOXCOLOR,m.fillRect(.5*
(C-10),-.5*(C+10),10,10));m.globalAlpha=N;if(f.onDrawTitleText)f.onDrawTitleText(m,C,v,this.ds.scale,this.title_text_font,K);!S&&(m.font=this.title_text_font,N=String(f.getTitle()))&&(m.fillStyle=K?"white":f.constructor.title_text_color||this.node_title_color,f.flags.collapsed?(m.textAlign="left",m.measureText(N),m.fillText(N.substr(0,20),C,B.NODE_TITLE_TEXT_Y-C),m.textAlign="left"):(m.textAlign="left",m.fillText(N,C,B.NODE_TITLE_TEXT_Y-C)));f.flags.collapsed||!f.subgraph||f.skip_subgraph_button||
(N=B.NODE_TITLE_HEIGHT,Z=f.size[0]-N,V=B.isInsideRectangle(this.graph_mouse[0]-f.pos[0],this.graph_mouse[1]-f.pos[1],Z+2,-N+2,N-4,N-4),m.fillStyle=V?"#888":"#555",U==B.BOX_SHAPE||S?m.fillRect(Z+2,-N+2,N-4,N-4):(m.beginPath(),m.roundRect(Z+2,-N+2,N-4,N-4,4),m.fill()),m.fillStyle="#333",m.beginPath(),m.moveTo(Z+.2*N,.6*-N),m.lineTo(Z+.8*N,.6*-N),m.lineTo(Z+.5*N,.3*-N),m.fill());if(f.onDrawTitle)f.onDrawTitle(m)}if(K){if(f.onBounding)f.onBounding(L);X==B.TRANSPARENT_TITLE&&(L[1]-=C,L[3]+=C);m.lineWidth=
1;m.globalAlpha=.8;m.beginPath();U==B.BOX_SHAPE?m.rect(-6+L[0],-6+L[1],12+L[2],12+L[3]):U==B.ROUND_SHAPE||U==B.CARD_SHAPE&&f.flags.collapsed?m.roundRect(-6+L[0],-6+L[1],12+L[2],12+L[3],2*this.round_radius):U==B.CARD_SHAPE?m.roundRect(-6+L[0],-6+L[1],12+L[2],12+L[3],2*this.round_radius,2):U==B.CIRCLE_SHAPE&&m.arc(.5*v[0],.5*v[1],.5*v[0]+6,0,2*Math.PI);m.strokeStyle="#FFF";m.stroke();m.strokeStyle=D;m.globalAlpha=1}};var T=new Float32Array(4),n=new Float32Array(4),x=new Float32Array(2),H=new Float32Array(2);
k.prototype.drawConnections=function(f){var m=B.getTime(),v=this.visible_area;T[0]=v[0]-20;T[1]=v[1]-20;T[2]=v[2]+40;T[3]=v[3]+40;f.lineWidth=this.connections_width;f.fillStyle="#AAA";f.strokeStyle="#AAA";f.globalAlpha=this.editor_alpha;v=this.graph._nodes;for(var D=0,C=v.length;D<C;++D){var K=v[D];if(K.inputs&&K.inputs.length)for(var N=0;N<K.inputs.length;++N){var S=K.inputs[N];if(S&&null!=S.link&&(S=this.graph.links[S.link])){var U=this.graph.getNodeById(S.origin_id);if(null!=U){var X=S.origin_slot;
var Z=-1==X?[U.pos[0]+10,U.pos[1]+10]:U.getConnectionPos(!1,X,x);var V=K.getConnectionPos(!0,N,H);n[0]=Z[0];n[1]=Z[1];n[2]=V[0]-Z[0];n[3]=V[1]-Z[1];0>n[2]&&(n[0]+=n[2],n[2]=Math.abs(n[2]));0>n[3]&&(n[1]+=n[3],n[3]=Math.abs(n[3]));if(y(n,T)){var ma=U.outputs[X];X=K.inputs[N];if(ma&&X&&(U=ma.dir||(U.horizontal?B.DOWN:B.RIGHT),X=X.dir||(K.horizontal?B.UP:B.LEFT),this.renderLink(f,Z,V,S,!1,0,null,U,X),S&&S._last_time&&1E3>m-S._last_time)){ma=2-.002*(m-S._last_time);var ia=f.globalAlpha;f.globalAlpha=
ia*ma;this.renderLink(f,Z,V,S,!0,ma,"white",U,X);f.globalAlpha=ia}}}}}}f.globalAlpha=1};k.prototype.renderLink=function(f,m,v,D,C,K,N,S,U,X){D&&this.visible_links.push(D);!N&&D&&(N=D.color||k.link_type_colors[D.type]);N||(N=this.default_link_color);null!=D&&this.highlighted_links[D.id]&&(N="#FFF");S=S||B.RIGHT;U=U||B.LEFT;var Z=t(m,v);this.render_connections_border&&.6<this.ds.scale&&(f.lineWidth=this.connections_width+4);f.lineJoin="round";X=X||1;1<X&&(f.lineWidth=.5);f.beginPath();for(var V=0;V<
X;V+=1){var ma=5*(V-.5*(X-1));if(this.links_render_mode==B.SPLINE_LINK){f.moveTo(m[0],m[1]+ma);var ia=0,ja=0,ba=0,fa=0;switch(S){case B.LEFT:ia=-.25*Z;break;case B.RIGHT:ia=.25*Z;break;case B.UP:ja=-.25*Z;break;case B.DOWN:ja=.25*Z}switch(U){case B.LEFT:ba=-.25*Z;break;case B.RIGHT:ba=.25*Z;break;case B.UP:fa=-.25*Z;break;case B.DOWN:fa=.25*Z}f.bezierCurveTo(m[0]+ia,m[1]+ja+ma,v[0]+ba,v[1]+fa+ma,v[0],v[1]+ma)}else if(this.links_render_mode==B.LINEAR_LINK){f.moveTo(m[0],m[1]+ma);fa=ba=ja=ia=0;switch(S){case B.LEFT:ia=
-1;break;case B.RIGHT:ia=1;break;case B.UP:ja=-1;break;case B.DOWN:ja=1}switch(U){case B.LEFT:ba=-1;break;case B.RIGHT:ba=1;break;case B.UP:fa=-1;break;case B.DOWN:fa=1}f.lineTo(m[0]+15*ia,m[1]+15*ja+ma);f.lineTo(v[0]+15*ba,v[1]+15*fa+ma);f.lineTo(v[0],v[1]+ma)}else if(this.links_render_mode==B.STRAIGHT_LINK)f.moveTo(m[0],m[1]),ma=m[0],ia=m[1],ja=v[0],ba=v[1],S==B.RIGHT?ma+=10:ia+=10,U==B.LEFT?ja-=10:ba-=10,f.lineTo(ma,ia),f.lineTo(.5*(ma+ja),ia),f.lineTo(.5*(ma+ja),ba),f.lineTo(ja,ba),f.lineTo(v[0],
v[1]);else return}this.render_connections_border&&.6<this.ds.scale&&!C&&(f.strokeStyle="rgba(0,0,0,0.5)",f.stroke());f.lineWidth=this.connections_width;f.fillStyle=f.strokeStyle=N;f.stroke();C=this.computeConnectionPoint(m,v,.5,S,U);D&&D._pos&&(D._pos[0]=C[0],D._pos[1]=C[1]);.6<=this.ds.scale&&this.highquality_render&&U!=B.CENTER&&(this.render_connection_arrows&&(V=this.computeConnectionPoint(m,v,.25,S,U),Z=this.computeConnectionPoint(m,v,.26,S,U),D=this.computeConnectionPoint(m,v,.75,S,U),X=this.computeConnectionPoint(m,
v,.76,S,U),this.render_curved_connections?(Z=-Math.atan2(Z[0]-V[0],Z[1]-V[1]),X=-Math.atan2(X[0]-D[0],X[1]-D[1])):X=Z=v[1]>m[1]?0:Math.PI,f.save(),f.translate(V[0],V[1]),f.rotate(Z),f.beginPath(),f.moveTo(-5,-3),f.lineTo(0,7),f.lineTo(5,-3),f.fill(),f.restore(),f.save(),f.translate(D[0],D[1]),f.rotate(X),f.beginPath(),f.moveTo(-5,-3),f.lineTo(0,7),f.lineTo(5,-3),f.fill(),f.restore()),f.beginPath(),f.arc(C[0],C[1],5,0,2*Math.PI),f.fill());if(K)for(f.fillStyle=N,V=0;5>V;++V)K=(.001*B.getTime()+.2*V)%
1,C=this.computeConnectionPoint(m,v,K,S,U),f.beginPath(),f.arc(C[0],C[1],5,0,2*Math.PI),f.fill()};k.prototype.computeConnectionPoint=function(f,m,v,D,C){D=D||B.RIGHT;C=C||B.LEFT;var K=t(f,m),N=[f[0],f[1]],S=[m[0],m[1]];switch(D){case B.LEFT:N[0]+=-.25*K;break;case B.RIGHT:N[0]+=.25*K;break;case B.UP:N[1]+=-.25*K;break;case B.DOWN:N[1]+=.25*K}switch(C){case B.LEFT:S[0]+=-.25*K;break;case B.RIGHT:S[0]+=.25*K;break;case B.UP:S[1]+=-.25*K;break;case B.DOWN:S[1]+=.25*K}D=(1-v)*(1-v)*(1-v);C=3*(1-v)*(1-
v)*v;K=3*(1-v)*v*v;v*=v*v;return[D*f[0]+C*N[0]+K*S[0]+v*m[0],D*f[1]+C*N[1]+K*S[1]+v*m[1]]};k.prototype.drawExecutionOrder=function(f){f.shadowColor="transparent";f.globalAlpha=.25;f.textAlign="center";f.strokeStyle="white";f.globalAlpha=.75;for(var m=this.visible_nodes,v=0;v<m.length;++v){var D=m[v];f.fillStyle="black";f.fillRect(D.pos[0]-B.NODE_TITLE_HEIGHT,D.pos[1]-B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT);0==D.order&&f.strokeRect(D.pos[0]-B.NODE_TITLE_HEIGHT+.5,D.pos[1]-B.NODE_TITLE_HEIGHT+
.5,B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT);f.fillStyle="#FFF";f.fillText(D.order,D.pos[0]+-.5*B.NODE_TITLE_HEIGHT,D.pos[1]-6)}f.globalAlpha=1};k.prototype.drawNodeWidgets=function(f,m,v,D){if(!f.widgets||!f.widgets.length)return 0;var C=f.size[0],K=f.widgets;m+=2;var N=B.NODE_WIDGET_HEIGHT,S=.5<this.ds.scale;v.save();v.globalAlpha=this.editor_alpha;for(var U=B.WIDGET_OUTLINE_COLOR,X=B.WIDGET_BGCOLOR,Z=B.WIDGET_TEXT_COLOR,V=B.WIDGET_SECONDARY_TEXT_COLOR,ma=0;ma<K.length;++ma){var ia=K[ma],ja=m;ia.y&&
(ja=ia.y);ia.last_y=ja;v.strokeStyle=U;v.fillStyle="#222";v.textAlign="left";ia.disabled&&(v.globalAlpha*=.5);var ba=ia.width||C;switch(ia.type){case "button":ia.clicked&&(v.fillStyle="#AAA",ia.clicked=!1,this.dirty_canvas=!0);v.fillRect(15,ja,ba-30,N);S&&!ia.disabled&&v.strokeRect(15,ja,ba-30,N);S&&(v.textAlign="center",v.fillStyle=Z,v.fillText(ia.name,.5*ba,ja+.7*N));break;case "toggle":v.textAlign="left";v.strokeStyle=U;v.fillStyle=X;v.beginPath();S?v.roundRect(15,m,ba-30,N,.5*N):v.rect(15,m,ba-
30,N);v.fill();S&&!ia.disabled&&v.stroke();v.fillStyle=ia.value?"#89A":"#333";v.beginPath();v.arc(ba-30,ja+.5*N,.36*N,0,2*Math.PI);v.fill();S&&(v.fillStyle=V,null!=ia.name&&v.fillText(ia.name,30,ja+.7*N),v.fillStyle=ia.value?Z:V,v.textAlign="right",v.fillText(ia.value?ia.options.on||"true":ia.options.off||"false",ba-40,ja+.7*N));break;case "slider":v.fillStyle=X;v.fillRect(15,ja,ba-30,N);var fa=ia.options.max-ia.options.min,ka=(ia.value-ia.options.min)/fa;v.fillStyle=D==ia?"#89A":"#678";v.fillRect(15,
ja,ka*(ba-30),N);S&&!ia.disabled&&v.strokeRect(15,ja,ba-30,N);ia.marker&&(fa=(ia.marker-ia.options.min)/fa,v.fillStyle="#AA9",v.fillRect(15+fa*(ba-30),ja,2,N));S&&(v.textAlign="center",v.fillStyle=Z,v.fillText(ia.name+"  "+Number(ia.value).toFixed(3),.5*ba,ja+.7*N));break;case "number":case "combo":v.textAlign="left";v.strokeStyle=U;v.fillStyle=X;v.beginPath();S?v.roundRect(15,m,ba-30,N,.5*N):v.rect(15,m,ba-30,N);v.fill();S&&(ia.disabled||v.stroke(),v.fillStyle=Z,ia.disabled||(v.beginPath(),v.moveTo(31,
m+5),v.lineTo(21,m+.5*N),v.lineTo(31,m+N-5),v.fill(),v.beginPath(),v.moveTo(ba-15-16,m+5),v.lineTo(ba-15-6,m+.5*N),v.lineTo(ba-15-16,m+N-5),v.fill()),v.fillStyle=V,v.fillText(ia.name,35,ja+.7*N),v.fillStyle=Z,v.textAlign="right","number"==ia.type?v.fillText(Number(ia.value).toFixed(void 0!==ia.options.precision?ia.options.precision:3),ba-30-20,ja+.7*N):(fa=ia.value,ia.options.values&&(ka=ia.options.values,ka.constructor===Function&&(ka=ka()),ka&&ka.constructor!==Array&&(fa=ka[ia.value])),v.fillText(fa,
ba-30-20,ja+.7*N)));break;case "string":case "text":v.textAlign="left";v.strokeStyle=U;v.fillStyle=X;v.beginPath();S?v.roundRect(15,m,ba-30,N,.5*N):v.rect(15,m,ba-30,N);v.fill();S&&(v.save(),v.beginPath(),v.rect(15,m,ba-30,N),v.clip(),v.stroke(),v.fillStyle=V,null!=ia.name&&v.fillText(ia.name,30,ja+.7*N),v.fillStyle=Z,v.textAlign="right",v.fillText(String(ia.value).substr(0,30),ba-30,ja+.7*N),v.restore());break;default:ia.draw&&ia.draw(v,f,ba,ja,N)}m+=(ia.computeSize?ia.computeSize(ba)[1]:N)+4;v.globalAlpha=
this.editor_alpha}v.restore();v.textAlign="left"};k.prototype.processNodeWidgets=function(f,m,v,D){function C(ka,P){ka.value=P;ka.options&&ka.options.property&&void 0!==f.properties[ka.options.property]&&f.setProperty(ka.options.property,P);ka.callback&&ka.callback(ka.value,U,f,m,v)}if(!f.widgets||!f.widgets.length)return null;for(var K=m[0]-f.pos[0],N=m[1]-f.pos[1],S=f.size[0],U=this,X=this.getCanvasWindow(),Z=0;Z<f.widgets.length;++Z){var V=f.widgets[Z];if(V&&!V.disabled){var ma=V.computeSize?V.computeSize(S)[1]:
B.NODE_WIDGET_HEIGHT,ia=V.width||S;if(V==D||!(6>K||K>ia-12||N<V.last_y||N>V.last_y+ma)){D=V.value;switch(V.type){case "button":if("mousemove"===v.type)break;V.callback&&setTimeout(function(){V.callback(V,U,f,m,v)},20);this.dirty_canvas=V.clicked=!0;break;case "slider":X=Math.clamp((K-10)/(ia-20),0,1);V.value=V.options.min+(V.options.max-V.options.min)*X;V.callback&&setTimeout(function(){C(V,V.value)},20);this.dirty_canvas=!0;break;case "number":case "combo":D=V.value;if("mousemove"==v.type&&"number"==
V.type)V.value+=.1*v.deltaX*(V.options.step||1),null!=V.options.min&&V.value<V.options.min&&(V.value=V.options.min),null!=V.options.max&&V.value>V.options.max&&(V.value=V.options.max);else if("mousedown"==v.type){var ja=V.options.values;ja&&ja.constructor===Function&&(ja=V.options.values(V,f));var ba=null;"number"!=V.type&&(ba=ja.constructor===Array?ja:Object.keys(ja));K=40>K?-1:K>ia-40?1:0;if("number"==V.type)V.value+=.1*K*(V.options.step||1),null!=V.options.min&&V.value<V.options.min&&(V.value=
V.options.min),null!=V.options.max&&V.value>V.options.max&&(V.value=V.options.max);else if(K)X=-1,this.last_mouseclick=0,X=ja.constructor===Object?ba.indexOf(String(V.value))+K:ba.indexOf(V.value)+K,X>=ba.length&&(X=ba.length-1),0>X&&(X=0),V.value=ja.constructor===Array?ja[X]:X;else{var fa=ja!=ba?Object.values(ja):ja;new B.ContextMenu(fa,{scale:Math.max(1,this.ds.scale),event:v,className:"dark",callback:function(ka,P,Y){ja!=ba&&(ka=fa.indexOf(ka));this.value=ka;C(this,ka);U.dirty_canvas=!0;return!1}.bind(V)},
X)}}else"mouseup"==v.type&&"number"==V.type&&(K=40>K?-1:K>ia-40?1:0,200>v.click_time&&0==K&&this.prompt("Value",V.value,function(ka){this.value=Number(ka);C(this,this.value)}.bind(V),v));D!=V.value&&setTimeout(function(){C(this,this.value)}.bind(V),20);this.dirty_canvas=!0;break;case "toggle":"mousedown"==v.type&&(V.value=!V.value,setTimeout(function(){C(V,V.value)},20));break;case "string":case "text":"mousedown"==v.type&&this.prompt("Value",V.value,function(ka){this.value=ka;C(this,ka)}.bind(V),
v);break;default:V.mouse&&(this.dirty_canvas=V.mouse(v,[K,N],f))}if(D!=V.value){if(f.onWidgetChanged)f.onWidgetChanged(V.name,V.value,D,V);f.graph._version++}return V}}}return null};k.prototype.drawGroups=function(f,m){if(this.graph){f=this.graph._groups;m.save();m.globalAlpha=.5*this.editor_alpha;for(var v=0;v<f.length;++v){var D=f[v];if(y(this.visible_area,D._bounding)){m.fillStyle=D.color||"#335";m.strokeStyle=D.color||"#335";var C=D._pos,K=D._size;m.globalAlpha=.25*this.editor_alpha;m.beginPath();
m.rect(C[0]+.5,C[1]+.5,K[0],K[1]);m.fill();m.globalAlpha=this.editor_alpha;m.stroke();m.beginPath();m.moveTo(C[0]+K[0],C[1]+K[1]);m.lineTo(C[0]+K[0]-10,C[1]+K[1]);m.lineTo(C[0]+K[0],C[1]+K[1]-10);m.fill();K=D.font_size||B.DEFAULT_GROUP_FONT_SIZE;m.font=K+"px Arial";m.fillText(D.title,C[0]+4,C[1]+K)}}m.restore()}};k.prototype.adjustNodesSize=function(){for(var f=this.graph._nodes,m=0;m<f.length;++m)f[m].size=f[m].computeSize();this.setDirty(!0,!0)};k.prototype.resize=function(f,m){f||m||(m=this.canvas.parentNode,
f=m.offsetWidth,m=m.offsetHeight);if(this.canvas.width!=f||this.canvas.height!=m)this.canvas.width=f,this.canvas.height=m,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0)};k.prototype.switchLiveMode=function(f){if(f){var m=this,v=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var D=setInterval(function(){m.editor_alpha*=v;m.dirty_canvas=!0;m.dirty_bgcanvas=!0;1>v&&.01>m.editor_alpha&&(clearInterval(D),1>v&&(m.live_mode=
!0));1<v&&.99<m.editor_alpha&&(clearInterval(D),m.editor_alpha=1)},1)}else this.live_mode=!this.live_mode,this.dirty_bgcanvas=this.dirty_canvas=!0};k.prototype.onNodeSelectionChange=function(f){};k.prototype.touchHandler=function(f){var m=f.changedTouches[0];switch(f.type){case "touchstart":var v="mousedown";break;case "touchmove":v="mousemove";break;case "touchend":v="mouseup";break;default:return}var D=this.getCanvasWindow(),C=D.document.createEvent("MouseEvent");C.initMouseEvent(v,!0,!0,D,1,m.screenX,
m.screenY,m.clientX,m.clientY,!1,!1,!1,!1,0,null);m.target.dispatchEvent(C);f.preventDefault()};k.onGroupAdd=function(f,m,v){f=k.active_canvas;f.getCanvasWindow();m=new B.LGraphGroup;m.pos=f.convertEventToCanvasOffset(v);f.graph.add(m)};k.onMenuAdd=function(f,m,v,D,C){function K(ma,ia){ia=D.getFirstEvent();N.graph.beforeChange();if(ma=B.createNode(ma.value))ma.pos=N.convertEventToCanvasOffset(ia),N.graph.add(ma);C&&C(ma);N.graph.afterChange()}var N=k.active_canvas,S=N.getCanvasWindow(),U=N.graph;
if(U){f=B.getNodeTypesCategories(N.filter||U.filter);m=[];for(var X=0;X<f.length;X++)if(f[X]){var Z=f[X];-1!=Z.indexOf("::")&&(Z=Z.split("::")[1]);m.push({value:f[X],content:Z,has_submenu:!0})}var V=new B.ContextMenu(m,{event:v,callback:function(ma,ia,ja){ma=B.getNodeTypesInCategory(ma.value,N.filter||U.filter);ia=[];for(var ba=0;ba<ma.length;ba++)ma[ba].skip_list||ia.push({content:ma[ba].title,value:ma[ba].type});new B.ContextMenu(ia,{event:ja,callback:K,parentMenu:V},S);return!1},parentMenu:D},
S);return!1}};k.onMenuCollapseAll=function(){};k.onMenuNodeEdit=function(){};k.showMenuNodeOptionalInputs=function(f,m,v,D,C){if(C){var K=this;f=k.active_canvas.getCanvasWindow();m=C.optional_inputs;C.onGetInputs&&(m=C.onGetInputs());var N=[];if(m)for(var S=0;S<m.length;S++){var U=m[S];if(U){var X=U[0];U[2]&&U[2].label&&(X=U[2].label);X={content:X,value:U};U[1]==B.ACTION&&(X.className="event");N.push(X)}else N.push(null)}this.onMenuNodeInputs&&(N=this.onMenuNodeInputs(N));if(N.length)return new B.ContextMenu(N,
{event:v,callback:function(Z,V,ma){C&&(Z.callback&&Z.callback.call(K,C,Z,V,ma),Z.value&&(C.graph.beforeChange(),C.addInput(Z.value[0],Z.value[1],Z.value[2]),C.setDirtyCanvas(!0,!0),C.graph.afterChange()))},parentMenu:D,node:C},f),!1;console.log("no input entries")}};k.showMenuNodeOptionalOutputs=function(f,m,v,D,C){function K(V,ma,ia){if(C&&(V.callback&&V.callback.call(N,C,V,ma,ia),V.value))if(ia=V.value[1],!ia||ia.constructor!==Object&&ia.constructor!==Array)C.graph.beforeChange(),C.addOutput(V.value[0],
V.value[1],V.value[2]),C.setDirtyCanvas(!0,!0),C.graph.afterChange();else{V=[];for(var ja in ia)V.push({content:ja,value:ia[ja]});new B.ContextMenu(V,{event:ma,callback:K,parentMenu:D,node:C});return!1}}if(C){var N=this;f=k.active_canvas.getCanvasWindow();m=C.optional_outputs;C.onGetOutputs&&(m=C.onGetOutputs());var S=[];if(m)for(var U=0;U<m.length;U++){var X=m[U];if(!X)S.push(null);else if(!C.flags||!C.flags.skip_repeated_outputs||-1==C.findOutputSlot(X[0])){var Z=X[0];X[2]&&X[2].label&&(Z=X[2].label);
Z={content:Z,value:X};X[1]==B.EVENT&&(Z.className="event");S.push(Z)}}this.onMenuNodeOutputs&&(S=this.onMenuNodeOutputs(S));if(S.length)return new B.ContextMenu(S,{event:v,callback:K,parentMenu:D,node:C},f),!1}};k.onShowMenuNodeProperties=function(f,m,v,D,C){if(C&&C.properties){var K=k.active_canvas;m=K.getCanvasWindow();var N=[],S;for(S in C.properties){f=void 0!==C.properties[S]?C.properties[S]:" ";"object"==typeof f&&(f=JSON.stringify(f));var U=C.getPropertyInfo(S);if("enum"==U.type||"combo"==
U.type)f=k.getPropertyPrintableValue(f,U.values);f=k.decodeHTML(f);N.push({content:"<span class='property_name'>"+S+"</span><span class='property_value'>"+f+"</span>",value:S})}if(N.length)return new B.ContextMenu(N,{event:v,callback:function(X,Z,V,ma){C&&(Z=this.getBoundingClientRect(),K.showEditPropertyValue(C,X.value,{position:[Z.left,Z.top]}))},parentMenu:D,allow_html:!0,node:C},m),!1}};k.decodeHTML=function(f){var m=document.createElement("div");m.innerText=f;return m.innerHTML};k.onResizeNode=
function(f,m,v,D,C){if(C){C.size=C.computeSize();if(C.onResize)C.onResize(C.size);C.setDirtyCanvas(!0,!0)}};k.prototype.showLinkMenu=function(f,m){var v=this;console.log(f);var D=new B.ContextMenu(["Add Node",null,"Delete"],{event:m,title:null!=f.data?f.data.constructor.name:null,callback:function(C,K,N){switch(C){case "Add Node":k.onMenuAdd(null,null,N,D,function(S){console.log("node autoconnect");var U=v.graph.getNodeById(f.origin_id),X=v.graph.getNodeById(f.target_id);S.inputs&&S.inputs.length&&
S.outputs&&S.outputs.length&&U.outputs[f.origin_slot].type==S.inputs[0].type&&S.outputs[0].type==X.inputs[0].type&&(U.connect(f.origin_slot,S,0),S.connect(0,X,f.target_slot),S.pos[0]-=.5*S.size[0])});break;case "Delete":v.graph.removeLink(f.id)}}});return!1};k.onShowPropertyEditor=function(f,m,v,D,C){function K(){var Z=U.value;"Number"==f.type?Z=Number(Z):"Boolean"==f.type&&(Z=!!Z);C[N]=Z;S.parentNode&&S.parentNode.removeChild(S);C.setDirtyCanvas(!0,!0)}var N=f.property||"title";m=C[N];var S=document.createElement("div");
S.className="graphdialog";S.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>";S.querySelector(".name").innerText=N;var U=S.querySelector("input");U&&(U.value=m,U.addEventListener("blur",function(Z){this.focus()}),U.addEventListener("keydown",function(Z){13==Z.keyCode&&(K(),Z.preventDefault(),Z.stopPropagation())}));m=k.active_canvas.canvas;v=m.getBoundingClientRect();var X=D=-20;v&&(D-=v.left,X-=v.top);event?(S.style.left=event.clientX+D+"px",S.style.top=
event.clientY+X+"px"):(S.style.left=.5*m.width+D+"px",S.style.top=.5*m.height+X+"px");S.querySelector("button").addEventListener("click",K);m.parentNode.appendChild(S)};k.prototype.prompt=function(f,m,v,D){var C=this;f=f||"";var K=!1,N=document.createElement("div");N.className="graphdialog rounded";N.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>";N.close=function(){C.prompt_box=null;N.parentNode&&N.parentNode.removeChild(N)};
1<this.ds.scale&&(N.style.transform="scale("+this.ds.scale+")");N.addEventListener("mouseleave",function(Z){K||N.close()});C.prompt_box&&C.prompt_box.close();C.prompt_box=N;N.querySelector(".name").innerText=f;N.querySelector(".value").value=m;var S=N.querySelector("input");S.addEventListener("keydown",function(Z){K=!0;if(27==Z.keyCode)N.close();else if(13==Z.keyCode)v&&v(this.value),N.close();else return;Z.preventDefault();Z.stopPropagation()});N.querySelector("button").addEventListener("click",
function(Z){v&&v(S.value);C.setDirty(!0);N.close()});f=k.active_canvas.canvas;m=f.getBoundingClientRect();var U=-20,X=-20;m&&(U-=m.left,X-=m.top);D?(N.style.left=D.clientX+U+"px",N.style.top=D.clientY+X+"px"):(N.style.left=.5*f.width+U+"px",N.style.top=.5*f.height+X+"px");f.parentNode.appendChild(N);setTimeout(function(){S.focus()},10);return N};k.search_limit=-1;k.prototype.showSearchBox=function(f){function m(fa){if(fa)if(C.onSearchBoxSelection)C.onSearchBoxSelection(fa,f,K);else{var ka=B.searchbox_extras[fa.toLowerCase()];
ka&&(fa=ka.type);K.graph.beforeChange();if(fa=B.createNode(fa))fa.pos=K.convertEventToCanvasOffset(f),K.graph.add(fa);if(ka&&ka.data){if(ka.data.properties)for(var P in ka.data.properties)fa.addProperty(P,ka.data.properties[P]);if(ka.data.inputs)for(P in fa.inputs=[],ka.data.inputs)fa.addOutput(ka.data.inputs[P][0],ka.data.inputs[P][1]);if(ka.data.outputs)for(P in fa.outputs=[],ka.data.outputs)fa.addOutput(ka.data.outputs[P][0],ka.data.outputs[P][1]);ka.data.title&&(fa.title=ka.data.title);ka.data.json&&
fa.configure(ka.data.json);K.graph.afterChange()}}U.close()}function v(fa){var ka=ia;ia&&ia.classList.remove("selected");ia?(ia=fa?ia.nextSibling:ia.previousSibling)||(ia=ka):ia=fa?Z.childNodes[0]:Z.childNodes[Z.childNodes.length];ia&&(ia.classList.add("selected"),ia.scrollIntoView({block:"end",behavior:"smooth"}))}function D(){function fa(Ba,ya){var Ga=document.createElement("div");V||(V=Ba);Ga.innerText=Ba;Ga.dataset.type=escape(Ba);Ga.className="litegraph lite-search-item";ya&&(Ga.className+=" "+
ya);Ga.addEventListener("click",function($a){m(unescape(this.dataset.type))});Z.appendChild(Ga)}ma=null;var ka=ja.value;V=null;Z.innerHTML="";if(ka)if(C.onSearchBox){var P=C.onSearchBox(Z,ka,K);if(P)for(var Y=0;Y<P.length;++Y)fa(P[Y])}else{P=function(Ba){var ya=B.registered_node_types[Ba];return pa&&ya.filter!=pa?!1:-1!==Ba.toLowerCase().indexOf(ka)};var da=0;ka=ka.toLowerCase();var pa=K.filter||K.graph.filter;for(Y in B.searchbox_extras){var la=B.searchbox_extras[Y];if(-1!==la.desc.toLowerCase().indexOf(ka)){var xa=
B.registered_node_types[la.type];if(!xa||!xa.filter||xa.filter==pa)if(fa(la.desc,"searchbox_extra"),-1!==k.search_limit&&da++>k.search_limit)break}}la=null;if(Array.prototype.filter)la=Object.keys(B.registered_node_types).filter(P);else for(Y in la=[],B.registered_node_types)P(Y)&&la.push(Y);for(Y=0;Y<la.length&&!(fa(la[Y]),-1!==k.search_limit&&da++>k.search_limit);Y++);}}var C=this,K=k.active_canvas,N=K.canvas,S=N.ownerDocument||document,U=document.createElement("div");U.className="litegraph litesearchbox graphdialog rounded";
U.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>";U.close=function(){C.search_box=null;S.body.focus();S.body.style.overflow="";setTimeout(function(){C.canvas.focus()},20);U.parentNode&&U.parentNode.removeChild(U)};var X=null;1<this.ds.scale&&(U.style.transform="scale("+this.ds.scale+")");U.addEventListener("mouseenter",function(fa){X&&(clearTimeout(X),X=null)});U.addEventListener("mouseleave",function(fa){X=setTimeout(function(){U.close()},
500)});C.search_box&&C.search_box.close();C.search_box=U;var Z=U.querySelector(".helper"),V=null,ma=null,ia=null,ja=U.querySelector("input");ja&&(ja.addEventListener("blur",function(fa){this.focus()}),ja.addEventListener("keydown",function(fa){if(38==fa.keyCode)v(!1);else if(40==fa.keyCode)v(!0);else if(27==fa.keyCode)U.close();else if(13==fa.keyCode)ia?m(ia.innerHTML):V?m(V):U.close();else{ma&&clearInterval(ma);ma=setTimeout(D,10);return}fa.preventDefault();fa.stopPropagation();fa.stopImmediatePropagation();
return!0}));S.fullscreenElement?S.fullscreenElement.appendChild(U):(S.body.appendChild(U),S.body.style.overflow="hidden");N=N.getBoundingClientRect();var ba=(f?f.clientY:N.top+.5*N.height)-20;U.style.left=(f?f.clientX:N.left+.5*N.width)-80+"px";U.style.top=ba+"px";f.layerY>N.height-200&&(Z.style.maxHeight=N.height-f.layerY-20+"px");ja.focus();return U};k.prototype.showEditPropertyValue=function(f,m,v){function D(){C(V.value)}function C(ma){K&&K.values&&K.values.constructor===Object&&void 0!=K.values[ma]&&
(ma=K.values[ma]);"number"==typeof f.properties[m]&&(ma=Number(ma));if("array"==N||"object"==N)ma=JSON.parse(ma);f.properties[m]=ma;f.graph&&f.graph._version++;if(f.onPropertyChanged)f.onPropertyChanged(m,ma);if(v.onclose)v.onclose();Z.close();f.setDirtyCanvas(!0,!0)}if(f&&void 0!==f.properties[m]){v=v||{};var K=f.getPropertyInfo(m),N=K.type,S="";if("string"==N||"number"==N||"array"==N||"object"==N)S="<input autofocus type='text' class='value'/>";else if("enum"!=N&&"combo"!=N||!K.values)if("boolean"==
N)S="<input autofocus type='checkbox' class='value' "+(f.properties[m]?"checked":"")+"/>";else{console.warn("unknown type: "+N);return}else{S="<select autofocus type='text' class='value'>";for(var U in K.values){var X=U;K.values.constructor===Array&&(X=K.values[U]);S+="<option value='"+X+"' "+(X==f.properties[m]?"selected":"")+">"+K.values[U]+"</option>"}S+="</select>"}var Z=this.createDialog("<span class='name'>"+m+"</span>"+S+"<button>OK</button>",v);if("enum"!=N&&"combo"!=N||!K.values)if("boolean"==
N)(V=Z.querySelector("input"))&&V.addEventListener("click",function(ma){C(!!V.checked)});else{if(V=Z.querySelector("input"))V.addEventListener("blur",function(ma){this.focus()}),X=void 0!==f.properties[m]?f.properties[m]:"",X=JSON.stringify(X),V.value=X,V.addEventListener("keydown",function(ma){13==ma.keyCode&&(D(),ma.preventDefault(),ma.stopPropagation())})}else{var V=Z.querySelector("select");V.addEventListener("change",function(ma){C(ma.target.value)})}Z.querySelector("button").addEventListener("click",
D);return Z}};k.prototype.createDialog=function(f,m){m=m||{};var v=document.createElement("div");v.className="graphdialog";v.innerHTML=f;f=this.canvas.getBoundingClientRect();var D=-20,C=-20;f&&(D-=f.left,C-=f.top);m.position?(D+=m.position[0],C+=m.position[1]):m.event?(D+=m.event.clientX,C+=m.event.clientY):(D+=.5*this.canvas.width,C+=.5*this.canvas.height);v.style.left=D+"px";v.style.top=C+"px";this.canvas.parentNode.appendChild(v);v.close=function(){this.parentNode&&this.parentNode.removeChild(this)};
return v};k.prototype.createPanel=function(f,m){m=m||{};var v=m.window||window,D=document.createElement("div");D.className="litegraph dialog";D.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div class='dialog-footer'></div>";D.header=D.querySelector(".dialog-header");m.width&&(D.style.width=m.width+(m.width.constructor===Number?"px":""));m.height&&(D.style.height=m.height+(m.height.constructor===Number?"px":""));m.closable&&(m=document.createElement("span"),
m.innerHTML="&#10005;",m.classList.add("close"),m.addEventListener("click",function(){D.close()}),D.header.appendChild(m));D.title_element=D.querySelector(".dialog-title");D.title_element.innerText=f;D.content=D.querySelector(".dialog-content");D.footer=D.querySelector(".dialog-footer");D.close=function(){this.parentNode.removeChild(this)};D.clear=function(){this.content.innerHTML=""};D.addHTML=function(C,K,N){var S=document.createElement("div");K&&(S.className=K);S.innerHTML=C;N?D.footer.appendChild(S):
D.content.appendChild(S);return S};D.addButton=function(C,K,N){var S=document.createElement("button");S.innerText=C;S.options=N;S.classList.add("btn");S.addEventListener("click",K);D.footer.appendChild(S);return S};D.addSeparator=function(){var C=document.createElement("div");C.className="separator";D.content.appendChild(C)};D.addWidget=function(C,K,N,S,U){function X(ia,ja){console.log("change",ia,ja);S.callback&&S.callback(ia,ja);U&&U(ia,ja)}S=S||{};var Z=String(N);C=C.toLowerCase();"number"==C&&
(Z=N.toFixed(3));var V=document.createElement("div");V.className="property";V.innerHTML="<span class='property_name'></span><span class='property_value'></span>";V.querySelector(".property_name").innerText=K;var ma=V.querySelector(".property_value");ma.innerText=Z;V.dataset.property=K;V.dataset.type=S.type||C;V.options=S;V.value=N;if("boolean"==C)V.classList.add("boolean"),N&&V.classList.add("bool-on"),V.addEventListener("click",function(){var ia=this.dataset.property;this.value=!this.value;this.classList.toggle("bool-on");
this.querySelector(".property_value").innerText=this.value?"true":"false";X(ia,this.value)});else if("string"==C||"number"==C)ma.setAttribute("contenteditable",!0),ma.addEventListener("keydown",function(ia){"Enter"==ia.code&&(ia.preventDefault(),this.blur())}),ma.addEventListener("blur",function(){var ia=this.innerText,ja=this.parentNode.dataset.property;"number"==this.parentNode.dataset.type&&(ia=Number(ia));X(ja,ia)});else if("enum"==C||"combo"==C)Z=k.getPropertyPrintableValue(N,S.values);ma.innerText=
Z;ma.addEventListener("click",function(ia){var ja=this.parentNode.dataset.property,ba=this;new B.ContextMenu(S.values||[],{event:ia,className:"dark",callback:function(fa,ka,P){ba.innerText=fa;X(ja,fa);return!1}},v)});D.content.appendChild(V);return V};return D};k.getPropertyPrintableValue=function(f,m){if(!m||m.constructor===Array)return String(f);if(m.constructor===Object){var v="",D;for(D in m)if(m[D]==f){v=D;break}return String(f)+" ("+v+")"}};k.prototype.showShowNodePanel=function(f){};k.prototype.showSubgraphPropertiesDialog=
function(f){function m(){D.clear();if(f.inputs)for(var C=0;C<f.inputs.length;++C){var K=f.inputs[C];if(!K.not_subgraph_input){var N=D.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");N.dataset.name=K.name;N.dataset.slot=C;N.querySelector(".name").innerText=K.name;N.querySelector(".type").innerText=K.type;N.querySelector("button").addEventListener("click",function(S){f.removeInput(Number(this.parentNode.dataset.slot));
m()})}}}console.log("showing subgraph properties dialog");var v=this.canvas.parentNode.querySelector(".subgraph_dialog");v&&v.close();var D=this.createPanel("Subgraph Inputs",{closable:!0,width:500});D.node=f;D.classList.add("subgraph_dialog");D.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0).querySelector("button").addEventListener("click",function(C){C=this.parentNode;var K=
C.querySelector(".name").value,N=C.querySelector(".type").value;K&&-1==f.findInputSlot(K)&&(f.addInput(K,N),C.querySelector(".name").value="",C.querySelector(".type").value="",m())});m();this.canvas.parentNode.appendChild(D);return D};k.prototype.checkPanels=function(){if(this.canvas)for(var f=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),m=0;m<f.length;++m){var v=f[m];v.node&&(v.node.graph&&v.graph==this.graph||v.close())}};k.onMenuNodeCollapse=function(f,m,v,D,C){C.graph.beforeChange(C);
C.collapse();C.graph.afterChange(C)};k.onMenuNodePin=function(f,m,v,D,C){C.pin()};k.onMenuNodeMode=function(f,m,v,D,C){new B.ContextMenu(["Always","On Event","On Trigger","Never"],{event:v,callback:function(K){if(C)switch(K){case "On Event":C.mode=B.ON_EVENT;break;case "On Trigger":C.mode=B.ON_TRIGGER;break;case "Never":C.mode=B.NEVER;break;default:C.mode=B.ALWAYS}},parentMenu:D,node:C});return!1};k.onMenuNodeColors=function(f,m,v,D,C){if(!C)throw"no node for color";m=[];m.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});
for(var K in k.node_colors)f=k.node_colors[K],f={value:K,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+f.color+"; background-color:"+f.bgcolor+"'>"+K+"</span>"},m.push(f);new B.ContextMenu(m,{event:v,callback:function(N){C&&((N=N.value?k.node_colors[N.value]:null)?C.constructor===B.LGraphGroup?C.color=N.groupcolor:(C.color=N.color,C.bgcolor=N.bgcolor):(delete C.color,delete C.bgcolor),C.setDirtyCanvas(!0,!0))},parentMenu:D,node:C});return!1};k.onMenuNodeShapes=
function(f,m,v,D,C){if(!C)throw"no node passed";new B.ContextMenu(B.VALID_SHAPES,{event:v,callback:function(K){C&&(C.graph.beforeChange(C),C.shape=K,C.graph.afterChange(C),C.setDirtyCanvas(!0))},parentMenu:D,node:C});return!1};k.onMenuNodeRemove=function(f,m,v,D,C){if(!C)throw"no node passed";!1!==C.removable&&(f=C.graph,f.beforeChange(),f.remove(C),f.afterChange(),C.setDirtyCanvas(!0,!0))};k.onMenuNodeToSubgraph=function(f,m,v,D,C){f=C.graph;if(m=k.active_canvas)v=Object.values(m.selected_nodes||
{}),v.length||(v=[C]),D=B.createNode("graph/subgraph"),D.pos=C.pos.concat(),f.add(D),D.buildFromNodes(v),m.deselectAllNodes(),C.setDirtyCanvas(!0,!0)};k.onMenuNodeClone=function(f,m,v,D,C){0!=C.clonable&&(f=C.clone())&&(f.pos=[C.pos[0]+5,C.pos[1]+5],C.graph.beforeChange(),C.graph.add(f),C.graph.afterChange(),C.setDirtyCanvas(!0,!0))};k.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",
groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};k.prototype.getCanvasMenuOptions=function(){if(this.getMenuOptions)var f=this.getMenuOptions();else f=[{content:"Add Node",has_submenu:!0,
callback:k.onMenuAdd},{content:"Add Group",callback:k.onGroupAdd}],this._graph_stack&&0<this._graph_stack.length&&f.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)});if(this.getExtraMenuOptions){var m=this.getExtraMenuOptions(this,f);m&&(f=f.concat(m))}return f};k.prototype.getNodeMenuOptions=function(f){var m=f.getMenuOptions?f.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:k.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,
callback:k.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:k.onShowMenuNodeProperties},null,{content:"Title",callback:k.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:k.onMenuNodeMode},{content:"Resize",callback:k.onResizeNode},{content:"Collapse",callback:k.onMenuNodeCollapse},{content:"Pin",callback:k.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:k.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:k.onMenuNodeShapes},null];if(f.onGetInputs){var v=
f.onGetInputs();v&&v.length&&(m[0].disabled=!1)}f.onGetOutputs&&(v=f.onGetOutputs())&&v.length&&(m[1].disabled=!1);f.getExtraMenuOptions&&(v=f.getExtraMenuOptions(this,m))&&(v.push(null),m=v.concat(m));!1!==f.clonable&&m.push({content:"Clone",callback:k.onMenuNodeClone});m.push(null,{content:"Remove",disabled:!(!1!==f.removable&&!f.block_delete),callback:k.onMenuNodeRemove});if(f.graph&&f.graph.onGetNodeMenuOptions)f.graph.onGetNodeMenuOptions(m,f);return m};k.prototype.getGroupMenuOptions=function(f){return[{content:"Title",
callback:k.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:k.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:k.onShowPropertyEditor},null,{content:"Remove",callback:k.onMenuNodeRemove}]};k.prototype.processContextMenu=function(f,m){var v=this,D=k.active_canvas.getCanvasWindow(),C=null,K={event:m,callback:function(S,U,X){if(S)if("Remove Slot"==S.content)S=S.slot,S.input?f.removeInput(S.slot):S.output&&f.removeOutput(S.slot);else if("Disconnect Links"==
S.content)S=S.slot,S.output?f.disconnectOutput(S.slot):S.input&&f.disconnectInput(S.slot);else if("Rename Slot"==S.content){S=S.slot;var Z=S.input?f.getInputInfo(S.slot):f.getOutputInfo(S.slot),V=v.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",U),ma=V.querySelector("input");ma&&Z&&(ma.value=Z.label||"");V.querySelector("button").addEventListener("click",function(ia){ma.value&&(Z&&(Z.label=ma.value),v.setDirty(!0));V.close()})}},extra:f};f&&(K.title=
f.type);var N=null;f&&(N=f.getSlotInPosition(m.canvasX,m.canvasY),k.active_node=f);N?(C=[],f.getSlotMenuOptions?C=f.getSlotMenuOptions(N,f,m):(N&&N.output&&N.output.links&&N.output.links.length&&C.push({content:"Disconnect Links",slot:N}),m=N.input||N.output,C.push(m.locked?"Cannot remove":{content:"Remove Slot",slot:N}),C.push(m.nameLocked?"Cannot rename":{content:"Rename Slot",slot:N})),K.title=(N.input?N.input.type:N.output.type)||"*",N.input&&N.input.type==B.ACTION&&(K.title="Action"),N.output&&
N.output.type==B.EVENT&&(K.title="Event")):f?C=this.getNodeMenuOptions(f):(C=this.getCanvasMenuOptions(),(N=this.graph.getGroupOnPos(m.canvasX,m.canvasY))&&C.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:N,options:this.getGroupMenuOptions(N)}}));C&&new B.ContextMenu(C,K,D)};"undefined"!=typeof window&&window.CanvasRenderingContext2D&&(window.CanvasRenderingContext2D.prototype.roundRect=function(f,m,v,D,C,K){void 0===C&&(C=5);void 0===K&&(K=C);this.moveTo(f+C,m);this.lineTo(f+
v-C,m);this.quadraticCurveTo(f+v,m,f+v,m+C);this.lineTo(f+v,m+D-K);this.quadraticCurveTo(f+v,m+D,f+v-K,m+D);this.lineTo(f+K,m+D);this.quadraticCurveTo(f,m+D,f,m+D-K);this.lineTo(f,m+C);this.quadraticCurveTo(f,m,f+C,m)});B.compareObjects=function(f,m){for(var v in f)if(f[v]!=m[v])return!1;return!0};B.distance=t;B.colorToString=function(f){return"rgba("+Math.round(255*f[0]).toFixed()+","+Math.round(255*f[1]).toFixed()+","+Math.round(255*f[2]).toFixed()+","+(4==f.length?f[3].toFixed(2):"1.0")+")"};B.isInsideRectangle=
p;B.growBounding=function(f,m,v){m<f[0]?f[0]=m:m>f[2]&&(f[2]=m);v<f[1]?f[1]=v:v>f[3]&&(f[3]=v)};B.isInsideBounding=function(f,m){return f[0]<m[0][0]||f[1]<m[0][1]||f[0]>m[1][0]||f[1]>m[1][1]?!1:!0};B.overlapBounding=y;B.hex2num=function(f){"#"==f.charAt(0)&&(f=f.slice(1));f=f.toUpperCase();for(var m=Array(3),v=0,D,C,K=0;6>K;K+=2)D="0123456789ABCDEF".indexOf(f.charAt(K)),C="0123456789ABCDEF".indexOf(f.charAt(K+1)),m[v]=16*D+C,v++;return m};B.num2hex=function(f){for(var m="#",v,D,C=0;3>C;C++)v=f[C]/
16,D=f[C]%16,m+="0123456789ABCDEF".charAt(v)+"0123456789ABCDEF".charAt(D);return m};A.prototype.addItem=function(f,m,v){function D(U){var X=this.value;X&&X.has_submenu&&C.call(this,U)}function C(U){var X=this.value,Z=!0;K.current_submenu&&K.current_submenu.close(U);if(v.callback){var V=v.callback.call(this,X,v,U,K,v.node);!0===V&&(Z=!1)}if(X&&(X.callback&&!v.ignore_item_callbacks&&!0!==X.disabled&&(V=X.callback.call(this,X,v,U,K,v.extra),!0===V&&(Z=!1)),X.submenu)){if(!X.submenu.options)throw"ContextMenu submenu needs options";
new K.constructor(X.submenu.options,{callback:X.submenu.callback,event:U,parentMenu:K,ignore_item_callbacks:X.submenu.ignore_item_callbacks,title:X.submenu.title,extra:X.submenu.extra,autoopen:v.autoopen});Z=!1}Z&&!K.lock&&K.close()}var K=this;v=v||{};var N=document.createElement("div");N.className="litemenu-entry submenu";var S=!1;if(null===m)N.classList.add("separator");else{N.innerHTML=m&&m.title?m.title:f;if(N.value=m)m.disabled&&(S=!0,N.classList.add("disabled")),(m.submenu||m.has_submenu)&&
N.classList.add("has_submenu");"function"==typeof m?(N.dataset.value=f,N.onclick_callback=m):N.dataset.value=m;m.className&&(N.className+=" "+m.className)}this.root.appendChild(N);S||N.addEventListener("click",C);v.autoopen&&N.addEventListener("mouseenter",D);return N};A.prototype.close=function(f,m){this.root.parentNode&&this.root.parentNode.removeChild(this.root);this.parentMenu&&!m&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===f?this.parentMenu.close():f&&!A.isCursorOverElement(f,
this.parentMenu.root)&&A.trigger(this.parentMenu.root,"mouseleave",f));this.current_submenu&&this.current_submenu.close(f,!0);this.root.closing_timer&&clearTimeout(this.root.closing_timer)};A.trigger=function(f,m,v,D){var C=document.createEvent("CustomEvent");C.initCustomEvent(m,!0,!0,v);C.srcElement=D;f.dispatchEvent?f.dispatchEvent(C):f.__events&&f.__events.dispatchEvent(C);return C};A.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this};A.prototype.getFirstEvent=
function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event};A.isCursorOverElement=function(f,m){var v=f.clientX;f=f.clientY;return(m=m.getBoundingClientRect())?f>m.top&&f<m.top+m.height&&v>m.left&&v<m.left+m.width?!0:!1:!1};B.ContextMenu=A;B.closeAllContextMenus=function(f){f=f||window;f=f.document.querySelectorAll(".litecontextmenu");if(f.length){for(var m=[],v=0;v<f.length;v++)m.push(f[v]);for(v=0;v<m.length;v++)m[v].close?m[v].close():m[v].parentNode&&
m[v].parentNode.removeChild(m[v])}};B.extendClass=function(f,m){for(var v in m)f.hasOwnProperty(v)||(f[v]=m[v]);if(m.prototype)for(v in m.prototype)m.prototype.hasOwnProperty(v)&&!f.prototype.hasOwnProperty(v)&&(m.prototype.__lookupGetter__(v)?f.prototype.__defineGetter__(v,m.prototype.__lookupGetter__(v)):f.prototype[v]=m.prototype[v],m.prototype.__lookupSetter__(v)&&f.prototype.__defineSetter__(v,m.prototype.__lookupSetter__(v)))};E.sampleCurve=function(f,m){if(m){for(var v=0;v<m.length-1;++v){var D=
m[v],C=m[v+1];if(!(C[0]<f)){m=C[0]-D[0];if(1E-5>Math.abs(m))return D[1];f=(f-D[0])/m;return D[1]*(1-f)+C[1]*f}}return 0}};E.prototype.draw=function(f,m,v,D,C,K){if(v=this.points){this.size=m;var N=m[0]-2*this.margin;m=m[1]-2*this.margin;C=C||"#666";f.save();f.translate(this.margin,this.margin);D&&(f.fillStyle="#111",f.fillRect(0,0,N,m),f.fillStyle="#222",f.fillRect(.5*N,0,1,m),f.strokeStyle="#333",f.strokeRect(0,0,N,m));f.strokeStyle=C;K&&(f.globalAlpha=.5);f.beginPath();for(D=0;D<v.length;++D)C=
v[D],f.lineTo(C[0]*N,(1-C[1])*m);f.stroke();f.globalAlpha=1;if(!K)for(D=0;D<v.length;++D)C=v[D],f.fillStyle=this.selected==D?"#FFF":this.nearest==D?"#DDD":"#AAA",f.beginPath(),f.arc(C[0]*N,(1-C[1])*m,2,0,2*Math.PI),f.fill();f.restore()}};E.prototype.onMouseDown=function(f,m){var v=this.points;if(v&&!(0>f[1])){var D=this.size[0]-2*this.margin,C=this.size[1]-2*this.margin,K=f[0]-this.margin;f=f[1]-this.margin;this.selected=this.getCloserPoint([K,f],30/m.ds.scale);-1==this.selected&&(m=[K/D,1-f/C],v.push(m),
v.sort(function(N,S){return N[0]-S[0]}),this.selected=v.indexOf(m),this.must_update=!0);if(-1!=this.selected)return!0}};E.prototype.onMouseMove=function(f,m){var v=this.points;if(v){var D=this.selected;if(!(0>D)){var C=(f[0]-this.margin)/(this.size[0]-2*this.margin),K=(f[1]-this.margin)/(this.size[1]-2*this.margin);this._nearest=this.getCloserPoint([f[0]-this.margin,f[1]-this.margin],30/m.ds.scale);if(m=v[D]){var N=0==D||D==v.length-1;!N&&(-10>f[0]||f[0]>this.size[0]+10||-10>f[1]||f[1]>this.size[1]+
10)?(v.splice(D,1),this.selected=-1):(m[0]=N?0==D?0:1:Math.clamp(C,0,1),m[1]=1-Math.clamp(K,0,1),v.sort(function(S,U){return S[0]-U[0]}),this.selected=v.indexOf(m),this.must_update=!0)}}}};E.prototype.onMouseUp=function(f,m){this.selected=-1;return!1};E.prototype.getCloserPoint=function(f,m){var v=this.points;if(!v)return-1;m=m||30;for(var D=this.size[0]-2*this.margin,C=this.size[1]-2*this.margin,K=v.length,N=[0,0],S=1E6,U=-1,X=0;X<K;++X){var Z=v[X];N[0]=Z[0]*D;N[1]=(1-Z[1])*C;Z=vec2.distance(f,N);
Z>S||Z>m||(U=X,S=Z)}return U};B.CurveEditor=E;B.getParameterNames=function(f){return(f+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};Math.clamp=function(f,m,v){return m>f?m:v<f?v:f};"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(f){window.setTimeout(f,1E3/
60)})})(this);"undefined"!=typeof exports&&(exports.LiteGraph=this.LiteGraph);
var BufferAttribute=THREE.BufferAttribute,BufferGeometry=THREE.BufferGeometry,Clock=THREE.Clock,Face3=THREE.Face3,Geometry=THREE.Geometry,Object3D=THREE.Object3D,Raycaster=THREE.Raycaster,Material=THREE.Material,LineBasicMaterial=THREE.LineBasicMaterial,LineDashedMaterial=THREE.LineDashedMaterial,MeshPhysicalMaterial=THREE.MeshPhysicalMaterial,MultiMaterial=THREE.MultiMaterial,PointsMaterial=THREE.PointsMaterial,RawShaderMaterial=THREE.RawShaderMaterial,BoxBufferGeometry=THREE.BoxBufferGeometry,BoxGeometry=
THREE.BoxGeometry,CircleBufferGeometry=THREE.CircleBufferGeometry,CircleGeometry=THREE.CircleGeometry,ConeBufferGeometry=THREE.ConeBufferGeometry,ConeGeometry=THREE.ConeGeometry,CylinderBufferGeometry=THREE.CylinderBufferGeometry,CylinderGeometry=THREE.CylinderGeometry,DodecahedronBufferGeometry=THREE.DodecahedronBufferGeometry,DodecahedronGeometry=THREE.DodecahedronGeometry,ExtrudeGeometry=THREE.ExtrudeGeometry,IcosahedronBufferGeometry=THREE.IcosahedronBufferGeometry,IcosahedronGeometry=THREE.IcosahedronGeometry,
LatheBufferGeometry=THREE.LatheBufferGeometry,LatheGeometry=THREE.LatheGeometry,OctahedronBufferGeometry=THREE.OctahedronBufferGeometry,OctahedronGeometry=THREE.OctahedronGeometry,ParametricBufferGeometry=THREE.ParametricBufferGeometry,ParametricGeometry=THREE.ParametricGeometry,PlaneBufferGeometry=THREE.PlaneBufferGeometry,PlaneGeometry=THREE.PlaneGeometry,PolyhedronBufferGeometry=THREE.PolyhedronBufferGeometry,PolyhedronGeometry=THREE.PolyhedronGeometry,RingBufferGeometry=THREE.RingBufferGeometry,
RingGeometry=THREE.RingGeometry,ShapeGeometry=THREE.ShapeGeometry,SphereBufferGeometry=THREE.SphereBufferGeometry,SphereGeometry=THREE.SphereGeometry,TetrahedronBufferGeometry=THREE.TetrahedronBufferGeometry,TetrahedronGeometry=THREE.TetrahedronGeometry,TextGeometry=THREE.TextGeometry,TorusBufferGeometry=THREE.TorusBufferGeometry,TorusGeometry=THREE.TorusGeometry,TorusKnotBufferGeometry=THREE.TorusKnotBufferGeometry,TorusKnotGeometry=THREE.TorusKnotGeometry,TubeGeometry=THREE.TubeGeometry,TubeBufferGeometry=
THREE.TubeBufferGeometry,Box2=THREE.Box2,Box3=THREE.Box3,Color=THREE.Color,Euler=THREE.Euler,Line3=THREE.Line3,Frustum=THREE.Frustum,Matrix3=THREE.Matrix3,Matrix4=THREE.Matrix4,Plane=THREE.Plane,Quarternion=THREE.Quarternion,Ray=THREE.Ray,Sphere=THREE.Sphere,Spline=THREE.Spline,Triangle=THREE.Triangle,Vector2=THREE.Vector2,Vector3=THREE.Vector3,Vector4=THREE.Vector4,LOD=THREE.LOD,LensFlare=THREE.LensFlare,Line=THREE.Line,LineSegments=THREE.LineSegments,AABB=CANNON.AABB,ArrayCollisionMatrix=CANNON.ArrayCollisionMatrix,
Body=CANNON.Body,Box=CANNON.Box,Broadphase=CANNON.Broadphase,ConeEquation=CANNON.ConeEquation,ConeTwistConstraint=CANNON.ConeTwistConstraint,Constraint=CANNON.Constraint,ContactEquation=CANNON.ContactEquation,ContactMaterial=CANNON.ContactMaterial,ConvexPolyhedron=CANNON.ConvexPolyhedron,Cylinder=CANNON.Cylinder,DistanceConstraint=CANNON.DistanceConstraint,Equation=CANNON.Equation,EventTarget=CANNON.EventTarget,FrictionEquation=CANNON.FrictionEquation,GridBroadphase=CANNON.GridBroadphase,GSSolver=
CANNON.GSSolver,Heightfield=CANNON.Heightfield,HingeConstraint=CANNON.HingeConstraint,JacobianElement=CANNON.JacobianElement,LockConstraint=CANNON.LockConstraint,Mat3=CANNON.Mat3,PhysicsMaterial=CANNON.Material,NaiveBroadphase=CANNON.NaiveBroadphase,Narrowphase=CANNON.Narrowphase,ObjectCollisionMatrix=CANNON.ObjectCollisionMatrix,Octree=CANNON.Octree,OctreeNode=CANNON.OctreeNode,Particle=CANNON.Particle,PointToPointConstraint=CANNON.PointToPointConstraint,Pool=CANNON.Pool,PhysicsRay=CANNON.Ray,RaycastResult=
CANNON.RaycastResult,RaycastVehicle=CANNON.RaycastVehicle,RigidVehicle=CANNON.RigidVehicle,RotationalEquation=CANNON.RotationalEquation,RotationalMotorEquation=CANNON.RotationalMotorEquation,SAPBroadphase=CANNON.SAPBroadphase,Shape=CANNON.Shape,Solver=CANNON.Solver,SPHSystem=CANNON.SPHSystem,SplitSolver=CANNON.SplitSolver,Spring=CANNON.Spring,Transform=CANNON.Transform,Trimesh=CANNON.Trimesh,TupleDictionary=CANNON.TupleDictionary,Vec3=CANNON.Vec3,Vec3Pool=CANNON.Vec3Pool,WheelInfo=CANNON.WheelInfo,
World=CANNON.World;function FileSystem(){}try{FileSystem.fs=require("fs")}catch(b){}FileSystem.readFile=function(b,h,l){void 0===h&&(h=!0);if(void 0!==FileSystem.fs){if(h)return FileSystem.fs.readFileSync(b,"utf8");FileSystem.fs.readFile(b,"utf8",l)}else{var e=new XMLHttpRequest;e.overrideMimeType("text/plain");e.open("GET",b,!h);e.onreadystatechange=function(){200!==e.status&&0!==e.status||void 0===l||l(e.responseText)};e.send(null);return e.responseText}};
FileSystem.readFileArrayBuffer=function(b){if(void 0!==FileSystem.fs){b=FileSystem.fs.readFileSync(b);for(var h=b.length,l=new ArrayBuffer(h),e=new Uint8Array(l),r=0;r<h;r++)e[r]=b[r];return l}h=new XMLHttpRequest;h.open("GET",b,!1);h.overrideMimeType("text/plain; charset=x-user-defined");h.send(null);return ArraybufferUtils.fromBinaryString(h.response)};
FileSystem.readFileBase64=function(b){if(void 0!==FileSystem.fs)return b=FileSystem.fs.readFileSync(b),(new Buffer(b)).toString("base64");var h=new XMLHttpRequest;h.open("GET",b,!1);h.overrideMimeType("text/plain; charset=x-user-defined");h.send(null);return Base64Utils.fromBinaryString(h.response)};FileSystem.writeFile=function(b,h){void 0!==FileSystem.fs&&(b=FileSystem.fs.createWriteStream(b,"utf8"),b.write(h),b.end())};
FileSystem.writeFileBase64=function(b,h){void 0!==FileSystem.fs&&(h=Buffer.from(Base64Utils.removeHeader(h),"base64"),b=FileSystem.fs.createWriteStream(b),b.write(h),b.end())};FileSystem.copyFile=function(b,h){void 0!==FileSystem.fs&&FileSystem.fs.createReadStream(b).pipe(FileSystem.fs.createWriteStream(h))};FileSystem.makeDirectory=function(b){if(void 0!==FileSystem.fs)try{FileSystem.fs.mkdirSync(b)}catch(h){}};FileSystem.getFilesDirectory=function(b){if(void 0!==FileSystem.fs)try{return FileSystem.fs.readdirSync(b)}catch(h){}return[]};
FileSystem.copyFolder=function(b,h){if(void 0!==FileSystem.fs){FileSystem.makeDirectory(h);for(var l=FileSystem.fs.readdirSync(b),e=0;e<l.length;e++){var r=b+"/"+l[e],q=h+"/"+l[e],k=FileSystem.fs.statSync(r);k.isDirectory()?FileSystem.copyFolder(r,q):k.isSymbolicLink()?FileSystem.fs.symlinkSync(FileSystem.fs.readlinkSync(r),q):FileSystem.copyFile(r,q)}}};
FileSystem.chooseFile=function(b,h,l){var e=document.createElement("input");e.type="file";e.accept=void 0!==h?h:"";void 0!==l&&(e.nwsaveas=!0!==l?l:"file");e.onchange=function(r){void 0!==b&&b(e.files)};e.click()};FileSystem.getFileName=function(b){return b.substring(b.lastIndexOf("/")+1,b.lastIndexOf("."))};FileSystem.getFileExtension=function(b){return b.substring(b.lastIndexOf(".")+1,b.length)};THREE.Object3D.prototype.folded=!1;THREE.Object3D.prototype.hidden=!1;
THREE.Object3D.prototype.initialize=function(){for(var b=0;b<this.children.length;b++)this.children[b].initialize()};THREE.Object3D.prototype.update=function(){for(var b=0;b<this.children.length;b++)this.children[b].update()};THREE.Object3D.prototype.dispose=function(){for(var b=0;b<this.children.length;b++)this.children[b].dispose()};THREE.Object3D.prototype.removeAll=function(){for(var b=this.children.length-1;-1<b;b--)this.remove(this.children[b])};
THREE.Object3D.prototype.destroy=function(){for(;0<this.children.length;)this.children[0].destroy();null!==this.parent&&(this.dispose&&this.dispose(),this.parent.remove(this))};
THREE.Object3D.prototype.toJSON=function(b,h,l){function e(t){var p=[],y;for(y in t){var A=t[y];delete A.metadata;p.push(A)}return p}var r=void 0===b,q={};r&&(b={fonts:{},videos:{},images:{},audio:{},geometries:{},materials:{},textures:{},asset_objects:{}},q.metadata={version:GORLOT.VERSION,type:"GorlotProgram"});var k={};k.uuid=this.uuid;k.type=this.type;k.name=this.name;k.folded=this.folded;k.hidden=this.hidden;k.castShadow=this.castShadow;k.receiveShadow=this.receiveShadow;k.visible=this.visible;
k.matrixAutoUpdate=this.matrixAutoUpdate;k.matrix=this.matrix.toArray();void 0!==this.components&&(k.components=this.components);"{}"!==JSON.stringify(this.userData)&&(k.userData=this.userData);void 0!==this.geometry&&(void 0===b.geometries[this.geometry.uuid]&&(b.geometries[this.geometry.uuid]=this.geometry.toJSON(b)),k.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===b.materials[this.material.uuid]&&(b.materials[this.material.uuid]=this.material.toJSON(b)),k.material=this.material.uuid);
void 0!==h&&h(b,k);if(!1!==l&&0<this.children.length)for(k.children=[],h=0;h<this.children.length;h++)(this.children[h]instanceof BlockScript||!this.children[h].hidden)&&k.children.push(this.children[h].toJSON(b).object);r&&(q.geometries=e(b.geometries),q.materials=e(b.materials),q.textures=e(b.textures),q.images=e(b.images),q.videos=e(b.videos),q.audio=e(b.audio),q.fonts=e(b.fonts),q.asset_objects=e(b.asset_objects));q.object=k;return q};
THREE.Vector3.fromJSON=function(b){return new THREE.Vector3(b.x,b.y,b.z)};THREE.Vector3.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z}};THREE.Vector2.fromJSON=function(b){return new THREE.Vector2(b.x,b.y)};THREE.Vector2.prototype.toJSON=function(){return{x:this.x,y:this.y}};
THREE.Texture.prototype.toJSON=function(b){if(void 0!==b.textures[this.uuid])return b.textures[this.uuid];var h={metadata:{version:GORLOT.VERSION,type:"Texture"},uuid:this.uuid,name:this.name,category:this.category,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};return b.textures[this.uuid]=h};
THREE.LightShadow.prototype.toJSON=function(){var b={};b.bias=this.bias;b.radius=this.radius;b.mapSize={};b.mapSize.x=this.mapSize.x;b.mapSize.y=this.mapSize.y;b.camera={};b.camera.top=this.camera.top;b.camera.bottom=this.camera.bottom;b.camera.far=this.camera.far;b.camera.near=this.camera.near;b.camera.left=this.camera.left;b.camera.right=this.camera.right;return b};
THREE.LightShadow.prototype.fromJSON=function(b){void 0!==b.bias&&(this.bias=b.bias);void 0!==b.radius&&(this.radius=b.radius);if(void 0!==b.mapSize){var h=b.mapSize;this.mapSize.set(h.x,h.y)}void 0!==b.camera&&(b=b.camera,this.camera.top=b.top,this.camera.bottom=b.bottom,this.camera.left=b.left,this.camera.right=b.right,this.camera.near=b.near,this.camera.far=b.far)};THREE.Fog.NONE=0;THREE.Fog.LINEAR=1;THREE.Fog.EXPONENTIAL=2;THREE.Material.prototype.nodes={};
THREE.Material.prototype.updateNodes=function(b){void 0!==this.nodes&&(this.nodes=b)};THREE.Material.prototype.setPath=function(b){void 0!==b&&(this.path=b)};function Key(){this.just_released=this.just_pressed=this.pressed=!1}Key.DOWN=-1;Key.UP=1;Key.RESET=0;
Key.prototype.update=function(b){this.just_released=this.just_pressed=!1;b===Key.DOWN?(!1===this.pressed&&(this.just_pressed=!0),this.pressed=!0):b===Key.UP?(this.pressed&&(this.just_released=!0),this.pressed=!1):b===Key.RESET&&(this.just_pressed=this.just_released=!1)};Key.prototype.set=function(b,h,l){this.just_pressed=b;this.pressed=h;this.just_released=l};Key.prototype.reset=function(){this.just_released=this.pressed=this.just_pressed=!1};function Keyboard(){}
Keyboard.initialize=function(){Keyboard.keys=[];Keyboard.actions=[];for(var b=0;256>b;b++)Keyboard.keys.push(new Key);Keyboard.events=[];Keyboard.events.push([window,"keydown",function(l){Keyboard.actions.push(l.keyCode);Keyboard.actions.push(Key.DOWN)}]);Keyboard.events.push([window,"keyup",function(l){Keyboard.actions.push(l.keyCode);Keyboard.actions.push(Key.UP)}]);for(b=0;b<Keyboard.events.length;b++){var h=Keyboard.events[b];h[0].addEventListener(h[1],h[2])}};
Keyboard.update=function(){for(var b=0;Keyboard.actions.length>b;){var h=Keyboard.actions.shift(),l=Keyboard.actions.shift();Keyboard.keys[h].update(l);if(Keyboard.keys[h].just_released||Keyboard.keys[h].just_pressed)Keyboard.actions.push(h),Keyboard.actions.push(Key.RESET),b+=2}};Keyboard.reset=function(){Keyboard.actions=[];for(var b=0;b<Keyboard.keys.length;b++)Keyboard.keys[b].reset()};Keyboard.keyPressed=function(b){return 256>b&&Keyboard.keys[b].pressed};
Keyboard.keyJustPressed=function(b){return 256>b&&Keyboard.keys[b].just_pressed};Keyboard.keyJustReleased=function(b){return 256>b&&Keyboard.keys[b].just_released};Keyboard.dispose=function(){for(var b=0;b<Keyboard.events.length;b++){var h=Keyboard.events[b];h[0].removeEventListener(h[1],h[2])}};Keyboard.BACKSPACE=8;Keyboard.TAB=9;Keyboard.ENTER=13;Keyboard.SHIFT=16;Keyboard.CTRL=17;Keyboard.ALT=18;Keyboard.CAPS_LOCK=20;Keyboard.ESC=27;Keyboard.SPACEBAR=32;Keyboard.PAGE_UP=33;Keyboard.PAGE_DOWN=34;
Keyboard.END=35;Keyboard.HOME=36;Keyboard.INSERT=45;Keyboard.DEL=46;Keyboard.LEFT=37;Keyboard.RIGHT=39;Keyboard.UP=38;Keyboard.DOWN=40;Keyboard.NUM0=48;Keyboard.NUM1=49;Keyboard.NUM2=50;Keyboard.NUM3=51;Keyboard.NUM4=52;Keyboard.NUM5=53;Keyboard.NUM6=54;Keyboard.NUM7=55;Keyboard.NUM8=56;Keyboard.NUM9=57;Keyboard.A=65;Keyboard.B=66;Keyboard.C=67;Keyboard.D=68;Keyboard.E=69;Keyboard.F=70;Keyboard.G=71;Keyboard.H=72;Keyboard.I=73;Keyboard.J=74;Keyboard.K=75;Keyboard.L=76;Keyboard.M=77;Keyboard.N=78;
Keyboard.O=79;Keyboard.P=80;Keyboard.Q=81;Keyboard.R=82;Keyboard.S=83;Keyboard.T=84;Keyboard.U=85;Keyboard.V=86;Keyboard.W=87;Keyboard.X=88;Keyboard.Y=89;Keyboard.Z=90;Keyboard.F1=112;Keyboard.F2=113;Keyboard.F3=114;Keyboard.F4=115;Keyboard.F5=116;Keyboard.F6=117;Keyboard.F7=118;Keyboard.F8=119;Keyboard.F9=120;Keyboard.F10=121;Keyboard.F11=122;Keyboard.F12=123;function Mouse(){}
Mouse.initialize=function(){Mouse._keys=[];Mouse._position=new THREE.Vector2(0,0);Mouse._position_updated=!1;Mouse._delta=new THREE.Vector2(0,0);Mouse._wheel=0;Mouse._wheel_updated=!1;Mouse._double_clicked=!1;Mouse.keys=[];Mouse.position=new THREE.Vector2(0,0);Mouse.delta=new THREE.Vector2(0,0);Mouse.wheel=0;Mouse.double_clicked=!1;Mouse.canvas=null;Mouse.events=[];for(var b=0;3>b;b++)Mouse._keys.push(new Key),Mouse.keys.push(new Key);void 0!==window.onmousewheel?Mouse.events.push([window,"mousewheel",
function(e){Mouse._wheel=e.deltaY;Mouse._wheel_updated=!0}]):void 0!==window.addEventListener?Mouse.events.push([window,"DOMMouseScroll",function(e){Mouse._wheel=30*e.detail;Mouse._wheel_updated=!0}]):Mouse.events.push([window,"wheel",function(e){Mouse._wheel=e.deltaY;Mouse._wheel_updated=!0}]);if("ontouchstart"in window||0<navigator.msMaxTouchPoints){var h=new Vector2(0,0);Mouse.events.push([window,"touchstart",function(e){e=e.touches[0];h.set(e.clientX,e.clientY);Mouse.updateKey(Mouse.LEFT,Key.DOWN)}]);
Mouse.events.push([window,"touchend",function(e){Mouse.updateKey(Mouse.LEFT,Key.UP)}]);Mouse.events.push([window,"touchmove",function(e){e=e.touches[0];if(null!==Mouse.canvas){var r=Mouse.canvas.getBoundingClientRect();Mouse.updatePosition(e.clientX-r.left,e.clientY-r.top,e.clientX-h.x,e.clientY-h.y)}else Mouse.updatePosition(e.clientX,e.clientY,e.clientX-h.x,e.clientY-h.y);h.set(e.clientX,e.clientY)}])}else Mouse.events.push([window,"mousemove",function(e){if(null!==Mouse.canvas){var r=Mouse.canvas.getBoundingClientRect();
Mouse.updatePosition(e.clientX-r.left,e.clientY-r.top,e.movementX,e.movementY)}else Mouse.updatePosition(e.clientX,e.clientY,e.movementX,e.movementY)}]),Mouse.events.push([window,"mousedown",function(e){Mouse.updateKey(e.which-1,Key.DOWN)}]),Mouse.events.push([window,"mouseup",function(e){Mouse.updateKey(e.which-1,Key.UP)}]);Mouse.events.push([window,"dblclick",function(e){Mouse._double_clicked=!0}]);for(b=0;b<Mouse.events.length;b++){var l=Mouse.events[b];l[0].addEventListener(l[1],l[2],!1)}};
Mouse.LEFT=0;Mouse.MIDDLE=1;Mouse.RIGHT=2;Mouse.setCanvas=function(b){Mouse.canvas=b;b.mouseInside=!1;b.addEventListener("mouseenter",function(){this.mouseInside=!0},!1);b.addEventListener("mouseleave",function(){this.mouseInside=!1},!1)};Mouse.insideCanvas=function(){return null===Mouse.canvas?!1:Mouse.canvas.mouseInside};
Mouse.setLock=function(b){null!==Mouse.canvas&&(b?Mouse.canvas.requestPointerLock?Mouse.canvas.requestPointerLock():Mouse.canvas.mozRequestPointerLock?Mouse.canvas.mozRequestPointerLock():Mouse.canvas.webkitRequestPointerLock&&Mouse.canvas.webkitRequestPointerLock():document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock())};Mouse.buttonPressed=function(b){return Mouse.keys[b].pressed};
Mouse.buttonDoubleClicked=function(){return Mouse.double_clicked};Mouse.buttonJustPressed=function(b){return Mouse.keys[b].just_pressed};Mouse.buttonJustReleased=function(b){return Mouse.keys[b].just_released};Mouse.updatePosition=function(b,h,l,e){Mouse._position.set(b,h);Mouse._delta.x+=l;Mouse._delta.y+=e;Mouse._position_updated=!0};Mouse.updateKey=function(b,h){-1<b&&Mouse._keys[b].update(h)};
Mouse.update=function(){for(var b=0;b<Mouse._keys.length;b++)Mouse._keys[b].just_pressed&&Mouse.keys[b].just_pressed&&(Mouse._keys[b].just_pressed=!1),Mouse._keys[b].just_released&&Mouse.keys[b].just_released&&(Mouse._keys[b].just_released=!1),Mouse.keys[b].set(Mouse._keys[b].just_pressed,Mouse._keys[b].pressed,Mouse._keys[b].just_released);Mouse._wheel_updated?(Mouse.wheel=Mouse._wheel,Mouse._wheel_updated=!1):Mouse.wheel=0;Mouse._double_clicked?(Mouse.double_clicked=!0,Mouse._double_clicked=!1):
Mouse.double_clicked=!1;Mouse._position_updated?(Mouse.delta.x=Mouse._delta.x,Mouse.delta.y=Mouse._delta.y,Mouse._delta.set(0,0),Mouse.position.x=Mouse._position.x,Mouse.position.y=Mouse._position.y,Mouse._position_updated=!1):(Mouse.delta.x=0,Mouse.delta.y=0)};Mouse.dispose=function(){for(var b=0;b<Mouse.events.length;b++){var h=Mouse.events[b];h[0].removeEventListener(h[1],h[2])}};
function VRControls(b,h){function l(r){for(var q=0;q<r.length;q++)if("VRDisplay"in window&&r[q]instanceof VRDisplay||"PositionSensorVRDevice"in window&&r[q]instanceof PositionSensorVRDevice){e.vr_input=r[q];break}e.vr_input||h&&h("VR input not available")}this.vr_input=null;this.scale=1;this.standing=!1;this.userHeight=1.6;this.object=null;void 0!==b&&(this.object=b);this.position=new THREE.Vector3;this.quaternion=new THREE.Quaternion;var e=this;void 0!==navigator.getVRDisplays&&navigator.getVRDisplays().then(l)}
VRControls.prototype.update=function(){if(null!==this.vr_input){var b=this.vr_input.getPose();null!==b.orientation&&this.quaternion.fromArray(b.orientation);null!==b.position?this.position.fromArray(b.position):this.position.set(0,0,0);this.standing&&(this.position.y+=this.userHeight);this.position.multiplyScalar(this.scale);null!==this.object&&(this.object.position.copy(this.position),this.object.quaternion.copy(this.quaternion))}};VRControls.prototype.dispose=function(){this.vr_input=null};
VRControls.prototype.resetPose=function(){null!==this.vr_input&&this.vr_input.resetPose()};VRControls.prototype.attachObject=function(b){this.object=b};
function Font(b){this.name="font";this.uuid=THREE.Math.generateUUID();this.type="Font";this.path="/";this.encoding=this.format="";this.font=this.data=null;if(void 0!==b)if("object"===typeof b)this.font=this.data=b,this.name=b.original_font_information.fullName,this.encoding=this.format="json";else if(this.encoding=b.split(".").pop().toLowerCase(),"json"===this.encoding)this.font=this.data=JSON.parse(FileSystem.readFile(b)),this.name=this.data.original_font_information.fullName,this.format="json";
else if("ttf"===this.encoding||"otf"===this.encoding||"ttc"===this.encoding||"otc"===this.encoding)this.data=FileSystem.readFileArrayBuffer(b),this.font=(new TTFLoader).parse(this.data),this.name=FileSystem.getFileName(b),this.format="arraybuffer"}Font.prototype.isFont=!0;Font.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
Font.prototype.getOpentypeFont=function(){if("json"===this.encoding){var b=new opentype.Font({familyName:this.data.original_font_information.fontFamily||" ",styleName:this.data.original_font_information.fontSubfamily||this.data.styleName||" ",unitsPerEm:this.data.unitsPerEm||2048,ascender:this.data.ascender,descender:this.data.descender}),h=this.data.glyphs,l;for(l in h);return b}return null};
Font.prototype.generateShapes=function(b,h,l){void 0===h&&(h=100);void 0===l&&(l=10);var e=this.font;b=String(b).split("");var r=h/e.resolution,q=0;h=[];for(var k=0;k<b.length;k++){var t;var p=r;var y=q,A=e.glyphs[b[k]]||e.glyphs["?"];if(A){var E=new THREE.ShapePath,B=[],G=THREE.ShapeUtils.b2,I=THREE.ShapeUtils.b3;if(A.o)for(var L=A._cachedOutline||(A._cachedOutline=A.o.split(" ")),T=0,n=L.length;T<n;){var x=L[T++];if("m"===x){var H=L[T++]*p+y;var f=L[T++]*p;E.moveTo(H,f)}if("l"===x)H=L[T++]*p+y,
f=L[T++]*p,E.lineTo(H,f);else if("q"===x){var m=L[T++]*p+y;var v=L[T++]*p;var D=L[T++]*p+y;x=L[T++]*p;E.quadraticCurveTo(D,x,m,v);if(t=B[B.length-1]){var C=t.x;t=t.y;for(var K=1;K<=l;K++){var N=K/l;G(N,C,D,m);G(N,t,x,v)}}}else if("b"===x&&(m=L[T++]*p+y,v=L[T++]*p,D=L[T++]*p+y,x=L[T++]*p,H=L[T++]*p+y,f=L[T++]*p,E.bezierCurveTo(D,x,H,f,m,v),t=B[B.length-1]))for(C=t.x,t=t.y,K=1;K<=l;K++)N=K/l,I(N,C,D,H,m),I(N,t,x,f,v)}p={offset:A.ha*p,path:E}}else p=void 0;q+=p.offset;h.push(p.path)}l=[];for(e=0;e<h.length;e++)Array.prototype.push.apply(l,
h[e].toShapes());return l};Font.prototype.toJSON=function(b){if(void 0!==b.fonts[this.uuid])return b.fonts[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.encoding=this.encoding;h.type=this.type;h.format=this.format;h.data=this.data;h.path=this.path;return b.fonts[this.uuid]=h};
function Video(b){this.name="video";this.uuid=THREE.Math.generateUUID();this.type="Video";this.data=this.encoding=this.format="";this.path="/";void 0!==b&&(this.encoding=b.split(".").pop().toLowerCase(),this.data="data:video/"+this.encoding+";base64,"+FileSystem.readFileBase64(b),this.format="base64")}Video.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
Video.prototype.toJSON=function(b){if(void 0!==b.videos[this.uuid])return b.videos[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.format=this.format;h.data=this.data;h.path=this.path;return b.videos[this.uuid]=h};
function Audio(b){this.name="audio";this.uuid=THREE.Math.generateUUID();this.type="Audio";this.path="/";this.encoding=this.format="";this.data=null;void 0!==b&&(this.data=FileSystem.readFileArrayBuffer(b),this.encoding=b.split(".").pop().toLowerCase(),this.format="arraybuffer")}Audio.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
Audio.prototype.toJSON=function(b){if(void 0!==b.audio[this.uuid])return b.audio[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.data=Base64Utils.fromArrayBuffer(this.data);h.format="base64";h.path=this.path;return b.audio[this.uuid]=h};
GORLOT.Image=function(b){this.name="image";this.uuid=THREE.Math.generateUUID();this.type="Image";this.path="/";this.encoding=this.format="";this.data=null;void 0!==b&&(this.encoding=b.split(".").pop().toLowerCase(),"gif"===this.encoding?(this.data="data:image/"+this.encoding+";base64,"+FileSystem.readFileBase64(b),this.format="base64"):"tga"===this.encoding?(b=(new THREE.TGALoader).parse(FileSystem.readFileBase64(b)),this.encoding="jpeg",this.format="base64",this.data=b.toDataURL("image/jpeg",.8)):
(this.format="url",this.data=b))};GORLOT.Image.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
GORLOT.Image.prototype.encodeData=function(){if("url"===this.format){var b=document.createElement("img");b.src=this.data;var h=document.createElement("canvas");h.width=b.width;h.height=b.height;var l=h.getContext("2d");l.drawImage(b,0,0,b.width,b.height);var e=!1;b=l.getImageData(0,0,b.width,b.height).data;for(l=3;l<b.length;l+=4)if(255!==b[l]){e=!0;break}e?(this.format="base64",this.encoding="png",this.data=h.toDataURL("image/png")):(this.format="base64",this.encoding="jpeg",this.data=h.toDataURL("image/jpeg",
.8))}};GORLOT.Image.prototype.toJSON=function(b){if(void 0!==b.images[this.uuid])return b.images[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.format=this.format;h.data=this.data;h.path=this.path;return b.images[this.uuid]=h};
function CanvasTexture(b,h,l,e,r,q,k,t,p,y,A){THREE.Texture.call(this,document.createElement("canvas"),l,e,r,q,k,t,p,y,A);this.name="canvas";this.category="Canvas";this.path="/";this.width=void 0!==b?b:512;this.height=void 0!==h?h:512;this.image.width=b;this.image.height=h;this.context=this.image.getContext("2d");this.context.font="Normal 55px Arial";this.context.textAlign="center";this.context.fillStyle="#FFFF00";this.context.fillText("Canvas Texture",this.width/2,this.height/2);this.needsUpdate=
!0}CanvasTexture.prototype=Object.create(THREE.Texture.prototype);CanvasTexture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};CanvasTexture.prototype.toJSON=function(b){b=THREE.Texture.prototype.toJSON.call(this);b.width=this.width;b.height=this.height;b.path=this.path;return b};
function VideoTexture(b,h,l,e,r,q){function k(){b.readyState>=b.HAVE_CURRENT_DATA&&(t.needsUpdate=!0);t.disposed||requestAnimationFrame(k)}"string"===typeof b?this.video=new Video(b):b instanceof Video&&(this.video=b);THREE.Texture.call(this,document.createElement("video"),h,l,e,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,r,q);this.disposed=this.generateMipmaps=!1;this.name="video";this.category="Video";this.path="/";this.loop=this.autoplay=!0;this.volume=this.speed=1;this.image.playbackRate=
this.speed;this.image.autoplay=this.autoplay;this.image.loop=this.loop;this.image.volume=this.volume;this.image.src=this.video.data;var t=this;b=this.image;k()}VideoTexture.prototype=Object.create(THREE.Texture.prototype);VideoTexture.prototype.setTime=function(b){this.image.currentImage=b};VideoTexture.prototype.setLoop=function(b){this.loop=b;this.image.loop=b};VideoTexture.prototype.setVolume=function(b){this.volume=0<=b&&1>=b?b:0<=b?1:0;this.image.volume=this.volume};
VideoTexture.prototype.setPlaybackRate=function(b){this.speed=b;this.image.playbackRate=b};VideoTexture.prototype.pause=function(){this.image.paused||this.image.pause()};VideoTexture.prototype.play=function(){this.image.paused&&this.image.play()};VideoTexture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};VideoTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};
VideoTexture.prototype.toJSON=function(b){var h=THREE.Texture.prototype.toJSON.call(this,b);b=this.video.toJSON(b);h.video=b.uuid;h.loop=this.loop;h.autoplay=this.autoplay;h.path=this.path;h.speed=this.speed;h.volume=this.volume;return h};
function WebcamTexture(b,h,l,e,r,q,k){function t(){p.readyState>=p.HAVE_CURRENT_DATA&&(y.needsUpdate=!0);y.disposed||requestAnimationFrame(t)}var p=document.createElement("video");p.autoplay=!0;p.loop=!0;navigator.webkitGetUserMedia?navigator.webkitGetUserMedia({video:!0},function(A){p.src=URL.createObjectURL(A)},function(A){console.warn("WebcamTexture: No webcam available")}):navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(A){p.src=URL.createObjectURL(A)}).catch(function(A){console.warn("No webcam available")});
THREE.Texture.call(this,p,b,h,l,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,q,k);this.disposed=this.generateMipmaps=!1;this.name="webcam";this.category="Webcam";this.path="/";var y=this;t()}WebcamTexture.prototype=Object.create(THREE.VideoTexture.prototype);WebcamTexture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};WebcamTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};
WebcamTexture.prototype.toJSON=function(b){b=THREE.VideoTexture.prototype.toJSON.call(this,b);b.path=this.path;return b};
function Texture(b,h,l,e,r,q,k,t,p,y){this.img="string"===typeof b?new GORLOT.Image(b):void 0===b?new GORLOT.Image:b;THREE.Texture.call(this,document.createElement("img"),h,l,e,r,q,k,t,p,y);var A=this;this.disposed=!1;this.name="texture";this.category="Image";this.path="/";this.image.src=this.img.data;this.image.onload=function(){A.needsUpdate=!0};if("gif"===this.img.encoding){var E=function(){A.disposed||(A.needsUpdate=!0,requestAnimationFrame(E))};E()}}Texture.prototype=Object.create(THREE.Texture.prototype);
Texture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};Texture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0};Texture.prototype.toJSON=function(b){var h=THREE.Texture.prototype.toJSON.call(this,b);b=this.img.toJSON(b);h.image=b.uuid;h.path=this.path;return h};function FontLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}FontLoader.fileIsFont=function(b){return b.endsWith("ttf")||b.endsWith("otf")||b.endsWith("ttc")||b.endsWith("otc")};
FontLoader.prototype.load=function(b,h,l,e){(new THREE.XHRLoader(this.manager)).load(b,function(r){h(new Font(JSON.parse(r)))},l,e)};FontLoader.prototype.parse=function(b){if(void 0!==b.data){var h=new Font;h.name=b.name;h.uuid=b.uuid;h.encoding=b.encoding;"base64"===b.format?(h.format="arraybuffer",h.data=ArraybufferUtils.fromBase64(b.data),h.font=(new TTFLoader).parse(h.data)):(h.format=b.format,h.data=b.data,h.font=b.data);void 0!==b.path&&(h.path=b.path);return h}return new Font(b)};
function ImageLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}ImageLoader.prototype.load=function(b,h,l,e){var r=this;(new THREE.XHRLoader(this.manager)).load(b,function(q){r.parse(JSON.parse(q),h)},l,e)};ImageLoader.prototype.parse=function(b,h){h=new GORLOT.Image;h.name=b.name;h.uuid=b.uuid;h.format=b.forma;h.encoding=b.encoding;h.data=b.data;void 0!==b.path&&(h.path=b.path);return h};function VideoLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}
VideoLoader.prototype.load=function(b,h,l,e){var r=this;(new THREE.XHRLoader(this.manager)).load(b,q=>{r.parse(JSON.parse(q),h)},l,e)};VideoLoader.prototype.parse=function(b,h){h=new Video;h.name=b.name;h.uuid=b.uuid;h.format=b.uuid;h.encoding=b.encoding;h.data=b.data;void 0!==b.path&&(h.path=b.path);return h};function AudioLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}
AudioLoader.prototype.load=function(b,h,l,e){var r=this;(new THREE.XHRLoader(this.manager)).load(b,q=>{r.parse(JSON.parse(q),h)},l,e)};AudioLoader.prototype.parse=function(b){var h=new Audio;h.name=b.name;h.uuid=b.uuid;h.encoding=b.encoding;h.format="arraybuffer";h.data=ArraybufferUtils.fromBase64(b.data);void 0!==b.path&&(h.path=b.path);return h};function TextureLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.images=[];this.videos=[];this.fonts=[]}
TextureLoader.prototype.load=function(b,h,l,e){var r=this;(new THREE.XHRLoader(this.manager)).load(b,q=>{r.parse(JSON.parse(q),h)},l,e)};
TextureLoader.prototype.parse=function(b,h){var l=b.category;"Video"===l?(void 0===b.video&&console.warn("TextureLoader: No video specified for",b.uuid),void 0===this.videos[b.video]&&console.warn("TextureLoader: Undefined video",b.video),l=new VideoTexture(this.videos[b.video])):"Webcam"===l?l=new WebcamTexture:"Canvas"===l?l=new CanvasTexture(b.width,b.height):(void 0===b.image&&console.warn("TextureLoader: No image specified for",b.uuid),void 0===this.images[b.image]&&console.warn("TextureLoader: Undefined image",
b.image),l=new Texture(this.images[b.image]));l.uuid=b.uuid;l.name=b.name;l.mapping=b.mapping;l.offset=new THREE.Vector2(b.offset[0],b.offset[1]);l.repeat=new THREE.Vector2(b.repeat[0],b.repeat[1]);l.wrapS=b.wrap[0];l.wrapT=b.wrap[1];l.minFilter=b.minFilter;l.magFilter=b.magFilter;l.anisotropy=b.anisotropy;l.flipY=b.flipY;void 0!==b.path&&(l.path=b.path);void 0!==h&&h(l);return l};TextureLoader.prototype.setImages=function(b){this.images=b;return this};
TextureLoader.prototype.setVideos=function(b){this.videos=b;return this};TextureLoader.prototype.setFonts=function(b){this.fonts=b;return this};function ObjectLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.texturePath=""}ObjectLoader.prototype.load=function(b,h,l,e){""===this.texturePath&&(this.texturePath=b.substring(0,b.lastIndexOf("/")+1));var r=this;(new THREE.XHRLoader(this.manager)).load(b,function(q){r.parse(JSON.parse(q),h)},l,e)};
ObjectLoader.prototype.parse=function(b,h){var l=this.parseGeometries(b.geometries),e=this.parseImages(b.images),r=this.parseVideos(b.videos),q=this.parseAudio(b.audio),k=this.parseFonts(b.fonts);e=this.parseTextures(b.textures,e,r);r=this.parseMaterials(b.materials,e);var t=this.parseAssetObjects(b.asset_objects);l=this.parseObject(b.object,l,r,e,q,k,t);b.animations&&(l.animations=this.parseAnimations(b.animations));void 0!==b.images&&0!==b.images.length||void 0===h||h(l);return l};
ObjectLoader.prototype.setTexturePath=function(b){this.texturePath=b};ObjectLoader.prototype.setCrossOrigin=function(b){this.crossOrigin=b};
ObjectLoader.prototype.parseGeometries=function(b){var h=[];if(void 0!==b)for(var l=new THREE.JSONLoader,e=new THREE.BufferGeometryLoader,r=0;r<b.length;r++){var q=b[r];switch(q.type){case "PlaneGeometry":case "PlaneBufferGeometry":var k=new THREE[q.type](q.width,q.height,q.widthSegments,q.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":k=new THREE[q.type](q.width,q.height,q.depth,q.widthSegments,q.heightSegments,q.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":k=
new THREE[q.type](q.radius,q.segments,q.thetaStart,q.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":k=new THREE[q.type](q.radiusTop,q.radiusBottom,q.height,q.radialSegments,q.heightSegments,q.openEnded,q.thetaStart,q.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":k=new THREE[q.type](q.radius,q.height,q.radialSegments,q.heightSegments,q.openEnded,q.thetaStart,q.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":k=new THREE[q.type](q.radius,
q.widthSegments,q.heightSegments,q.phiStart,q.phiLength,q.thetaStart,q.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":k=new THREE[q.type](q.radius,q.detail);break;case "RingGeometry":case "RingBufferGeometry":k=new THREE[q.type](q.innerRadius,q.outerRadius,q.thetaSegments,q.phiSegments,q.thetaStart,q.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":k=new THREE[q.type](q.radius,q.tube,q.radialSegments,
q.tubularSegments,q.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":k=new THREE[q.type](q.radius,q.tube,q.tubularSegments,q.radialSegments,q.p,q.q);break;case "LatheGeometry":case "LatheBufferGeometry":k=new THREE[q.type](q.points,q.segments,q.phiStart,q.phiLength);break;case "BufferGeometry":k=e.parse(q);break;case "Geometry":k=l.parse(q.data,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+q.type+'"');continue}k.uuid=q.uuid;k.name=
void 0!==q.name?q.name:"geometry";h[q.uuid]=k}return h};ObjectLoader.prototype.parseMaterials=function(b,h){var l=[],e=new MaterialLoader;e.setTextures(h);if(void 0!==b)for(h=0;h<b.length;h++){var r=e.parse(b[h]);l[r.uuid]=r}return l};ObjectLoader.prototype.parseAnimations=function(b){for(var h=[],l=0;l<b.length;l++){var e=THREE.AnimationClip.parse(b[l]);h.push(e)}return h};
ObjectLoader.prototype.parseImages=function(b){var h=new ImageLoader,l=[];if(void 0!==b)for(var e=0;e<b.length;e++)l[b[e].uuid]=h.parse(b[e]);return l};ObjectLoader.prototype.parseVideos=function(b){var h=new VideoLoader,l=[];if(void 0!==b)for(var e=0;e<b.length;e++)l[b[e].uuid]=h.parse(b[e]);return l};ObjectLoader.prototype.parseAudio=function(b){var h=new AudioLoader,l=[];if(void 0!==b)for(var e=0;e<b.length;e++)l[b[e].uuid]=h.parse(b[e]);return l};
ObjectLoader.prototype.parseFonts=function(b){var h=new FontLoader,l=[];if(void 0!==b)for(var e=0;e<b.length;e++)l[b[e].uuid]=h.parse(b[e]);return l};ObjectLoader.prototype.parseTextures=function(b,h,l){var e=new TextureLoader;e.setImages(h);e.setVideos(l);h=[];if(void 0!==b)for(l=0;l<b.length;l++){var r=e.parse(b[l]);h[r.uuid]=r}return h};ObjectLoader.prototype.parseAssetObjects=function(b){var h=new ObjectLoader,l=[];if(void 0!==b)for(var e=0;e<b.length;e++){var r=h.parse(b[e]);l[r.uuid]=r}return l};
ObjectLoader.prototype.parseObject=function(b,h,l,e,r,q,k){function t(n){void 0===e[n]&&console.warn("ObjectLoader: Undefined texture",n);return e[n]}function p(n){void 0===h[n]&&console.warn("ObjectLoader: Undefined geometry",n);return h[n]}function y(n){void 0===l[n]&&console.warn("ObjectLoader: Undefined material",n);return l[n]}function A(n){void 0===q[n]&&console.warn("ObjectLoader: Undefined font",n);return q[n]}var E=new THREE.Matrix4;switch(b.type){case "SpineAnimation":for(var B=0;B<b.textures.length;B++)b.textures[B].texture=
t(b.textures[B].texture);var G=new SpineAnimation(b.json,b.atlas,"",b.textures);break;case "Audio":void 0===r[b.audio]&&console.warn();G=new AudioEmitter(void 0);G.autoplay=b.autoplay;G.startTime=b.startTime;G.playbackRate=b.playbackRate;G.loop=void 0!==b.source?b.source.loop:b.loop;break;case "PositionalAudio":void 0===r[b.audio]&&console.warn();G=new PositionalAudio(void 0);G.autoplay=b.autoplay;G.startTime=b.startTime;G.playbackRate=b.playbackRate;G.loop=void 0!==b.source?b.source.loop:b.loop;
break;case "Physics":G=new PhysicsObject;G.body.type=b.body.type;G.body.mass=b.body.mass;G.body.linearDamping=b.body.linearDamping;G.body.angularDamping=b.body.angularDamping;G.body.allowSleep=b.body.allowSleep;G.body.sleepSpeedLimit=b.body.sleepSpeedLimit;G.body.sleepTimeLimit=b.body.sleepTimeLimit;G.body.collisionFilterGroup=b.body.collisionFilterGroup;G.body.collisionFilterMask=b.body.collisionFilterMask;G.body.fixedRotation=b.body.fixedRotation;var I=b.body.shapes;for(B=0;B<I.length;B++){var L=
I[B];L.type===CANNON.Shape.types.SPHERE?G.body.addShape(new CANNON.Sphere(L.radius)):L.type===CANNON.Shape.types.BOX?G.body.addShape(new CANNON.Box(new CANNON.Vec3(L.halfExtents.x,L.halfExtents.y,L.halfExtents.z))):L.type===CANNON.Shape.types.PARTICLE?G.body.addShape(new CANNON.Particle):L.type===CANNON.Shape.types.PLANE?G.body.addShape(new CANNON.Plane):L.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&G.body.addShape(new CANNON.ConvexPolyhedron(L.vertices,L.faces))}break;case "ParticleEmiter":void 0!==
b.group&&(G=b.group,G.texture.value=t(G.texture.value),G.textureFrames=THREE.Vector2(G.textureFrames));if(void 0!==b.emitter)for(G=b.emitter,G.position.value=THREE.Vector3.fromJSON(G.position.value),G.position.spread=THREE.Vector3.fromJSON(G.position.spread),G.velocity.value=THREE.Vector3.fromJSON(G.velocity.value),G.velocity.spread=THREE.Vector3.fromJSON(G.velocity.spread),G.acceleration.value=THREE.Vector3.fromJSON(G.acceleration.value),G.acceleration.spread=THREE.Vector3.fromJSON(G.acceleration.spread),
B=0;B<G.color.value.length;B++)G.color.value[B]=new THREE.Color(G.color.value[B]),G.color.spread[B]=THREE.Vector3.fromJSON(G.color.spread[B]);G=new ParticleEmitter(b.group,b.emitter);break;case "Text3D":G=new Text3D(b.text,y(b.material),A(b.font),b.height,b.bevel,b.bevel_thickness,b.bevel_size,b.size,b.curve_segments);break;case "Program":G=new Program(b.name);G.description=b.description;G.author=b.author;G.version=b.version;G.vr=b.vr;G.vr_scale=b.vr_scale;void 0!==b.lock_pointer&&(G.lock_pointer=
b.lock_pointer);void 0!==b.default_scene&&(G.default_scene=b.default_scene);break;case "LeapDevice":G=new LeapMotion;G.mode=b.mode;G.use_arm=b.use_arm;void 0!==b.debug_model&&(G.debug_model=b.debug_model);void 0!==b.gestures_enabled&&(G.gestures_enabled=b.gestures_enabled);void 0!==b.poses_enabled&&(G.poses_enabled=b.poses_enabled);break;case "Kinect":G=new KinectDevice;void 0!==b.debug_model&&(G.debug_model=b.debug_model);break;case "Sky":G=new Sky(b.auto_update,b.day_time,b.sun_distance,b.time);
void 0!==b.sun&&G.sun.shadow.fromJSON(b.sun.shadow);break;case "Scene":G=new Scene;void 0!==b.background&&Number.isInteger(b.background)&&(G.background=new THREE.Color(b.background));void 0!==b.fog&&("Fog"===b.fog.type?G.fog=new THREE.Fog(b.fog.color,b.fog.near,b.fog.far):"FogExp2"===b.fog.type&&(G.fog=new THREE.FogExp2(b.fog.color,b.fog.density)));void 0!==b.cameras&&(G.cameras=b.cameras);void 0!==b.world&&G.world.gravity.set(b.world.gravity.x,b.world.gravity.y,b.world.gravity.z);break;case "PerspectiveCamera":G=
new PerspectiveCamera(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(G.focus=b.focus);void 0!==b.zoom&&(G.zoom=b.zoom);void 0!==b.filmGauge&&(G.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(G.filmOffset=b.filmOffset);void 0!==b.view&&(G.view=Object.assign({},b.view));void 0!==b.viewport&&G.viewport.fromArray(b.viewport);void 0!==b.offset&&G.offset.fromArray(b.offset);void 0!==b.clear_color&&(G.clear_color=b.clear_color);void 0!==b.clear_depth&&(G.clear_depth=b.clear_depth);break;case "OrthographicCamera":G=
new OrthographicCamera(b.size,b.aspect,b.mode,b.near,b.far);void 0!==b.viewport&&G.viewport.fromArray(b.viewport);void 0!==b.offset&&G.offset.fromArray(b.offset);void 0!==b.clear_color&&(G.clear_color=b.clear_color);void 0!==b.clear_depth&&(G.clear_depth=b.clear_color);break;case "RectAreaLight":G=new RectAreaLight(b.color,b.intensity,b.width,b.height);break;case "AmbientLight":G=new AmbientLight(b.color,b.intensity);break;case "DirectionalLight":G=new DirectionalLight(b.color,b.intensity);break;
case "PointLight":G=new PointLight(b.color,b.intensity,b.distance,b.decay);break;case "SpotLight":G=new SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":G=new HemisphereLight(b.color,b.groundColor,b.intensity);break;case "Mesh":G=new Mesh(p(b.geometry),y(b.material));break;case "SkinnedMesh":G=new SkinnedMesh(p(b.geometry),y(b.material));break;case "LOD":G=new THREE.LOD;break;case "Line":G=new THREE.Line(p(b.geometry),y(b.material),b.mode);break;case "PointCloud":case "Points":G=
new THREE.Points(p(b.geometry),y(b.material));break;case "Sprite":G=new Sprite(y(b.material));break;case "Group":G=new Empty;break;case "ObjectCaller":G=new ObjectCaller(b.obj_uuid,b.obj_type);break;case "Script":G=new Script(b.code);break;case "BlockScript":G=new BlockScript(b.nodes);break;case "Bone":G=new Bone;break;default:G=new Empty}G.uuid=b.uuid;void 0!==b.name&&(G.name=b.name);void 0!==b.hidden&&(G.hidden=b.hidden);void 0!==b.folded&&(G.folded=b.folded);void 0!==b.path&&(G.path=b.path);void 0!==
b.matrix?(E.fromArray(b.matrix),E.decompose(G.position,G.quaternion,G.scale)):(void 0!==b.position&&G.position.fromArray(b.position),void 0!==b.rotation&&G.rotation.fromArray(b.rotation),void 0!==b.scale&&G.scale.fromArray(b.scale));void 0!==b.castShadow&&(G.castShadow=b.castShadow);void 0!==b.receiveShadow&&(G.receiveShadow=b.receiveShadow);void 0!==b.shadow&&G.shadow.fromJSON(b.shadow);void 0!==b.visible&&(G.visible=b.visible);void 0!==b.userData&&(G.userData=b.userData);if(void 0!==b.children)for(var T in b.children)G.add(this.parseObject(b.children[T],
h,l,e,r,q));void 0!==b.nodes&&(G.nodes=b.nodes);void 0!==b.blocks_type&&(G.blocks_type=b.blocks_type);if(void 0!==b.components)for(B in b.components)eval(`
				object.components.push(new ${b.components[B].className}())
				object.components[object.components.length - 1].values = compo.values
			`);void 0!==b.matrixAutoUpdate&&(G.matrixAutoUpdate=b.matrixAutoUpdate,G.matrixAutoUpdate||(G.updateMatrix(),G.updateMatrixWorld(!0)));if("Program"===b.type){G.materials=l;G.asset_objects=k;G.textures=e;T=[];for(B=0;B<b.folders.length;B++)k=new Folder(b.folders[B].name),k.uuid=b.folders[B].uuid,k.path=b.folders[B].path,T[k.uuid]=k;G.folders=T;G.fonts=q;G.audio=r}else if("Scene"===b.type)for(B=0;B<G.cameras.length;B++)T=G.getCamera(G.cameras[B]),null!==T?G.cameras[B]=T:G.cameras.splice(B,1);else if("LOD"===
b.type)for(B=b.levels,b=0;b<B.length;b++)r=B[b],T=G.getObjectByProperty("uuid",r.object),void 0!==T&&G.addLevel(T,r.distance);return G};var MaterialLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.textures={}};
MaterialLoader.prototype={constructor:MaterialLoader,load:function(b,h,l,e){var r=this;(new THREE.XHRLoader(r.manager)).load(b,function(q){h(r.parse(JSON.parse(q)))},l,e)},setTextures:function(b){this.textures=b},getTexture:function(b){var h=this.textures;void 0===h[b]&&console.warn("THREE.MaterialLoader: Undefined texture",b);return h[b]},parse:function(b){var h=b.type;"MeshPhongMaterial"===h?h=new MeshPhongMaterial:"MeshStandardMaterial"===h?h=new MeshStandardMaterial:"MeshLambertMaterial"===h?
h=new MeshLambertMaterial:"SpriteMaterial"===h?h=new SpriteMaterial:"ShaderMaterial"===h?h=new MeshShaderMaterial:"MeshNormalMaterial"===h?h=new MeshNormalMaterial:"MeshDepthMaterial"===h?h=new MeshDepthMaterial:"MeshToonMaterial"===h?h=new MeshToonMaterial:(console.log('Unregistered material in "MaterialLoader": '+b.type),h=new THREE[b.type]);void 0!==b.path&&(h.path=b.path);void 0!==b.uuid&&(h.uuid=b.uuid);void 0!==b.name&&(h.name=b.name);void 0!==b.color&&h.color.setHex(b.color);void 0!==b.roughness&&
(h.roughness=b.roughness);void 0!==b.metalness&&(h.metalness=b.metalness);void 0!==b.emissive&&h.emissive.setHex(b.emissive);void 0!==b.nodes&&(h.nodes=b.nodes);void 0!==b.specular&&h.specular.setHex(b.specular);void 0!==b.shininess&&(h.shininess=b.shininess);void 0!==b.uniforms&&(h.uniforms=b.uniforms);void 0!==b.vertexShader&&(h.vertexShader=b.vertexShader);void 0!==b.fragmentShader&&(h.fragmentShader=b.fragmentShader);void 0!==b.vertexColors&&(h.vertexColors=b.vertexColors);void 0!==b.shading&&
(h.shading=b.shading);void 0!==b.blending&&(h.blending=b.blending);void 0!==b.side&&(h.side=b.side);void 0!==b.opacity&&(h.opacity=b.opacity);void 0!==b.transparent&&(h.transparent=b.transparent);void 0!==b.alphaTest&&(h.alphaTest=b.alphaTest);void 0!==b.depthTest&&(h.depthTest=b.depthTest);void 0!==b.depthWrite&&(h.depthWrite=b.depthWrite);void 0!==b.colorWrite&&(h.colorWrite=b.colorWrite);void 0!==b.wireframe&&(h.wireframe=b.wireframe);void 0!==b.wireframeLinewidth&&(h.wireframeLinewidth=b.wireframeLinewidth);
void 0!==b.size&&(h.size=b.size);void 0!==b.sizeAttenuation&&(h.sizeAttenuation=b.sizeAttenuation);void 0!==b.map&&(h.map=this.getTexture(b.map));void 0!==b.alphaMap&&(h.alphaMap=this.getTexture(b.alphaMap),h.transparent=!0);void 0!==b.bumpMap&&(h.bumpMap=this.getTexture(b.bumpMap));void 0!==b.bumpScale&&(h.bumpScale=b.bumpScale);void 0!==b.normalMap&&(h.normalMap=this.getTexture(b.normalMap));if(void 0!==b.normalScale){var l=b.normalScale;!1===Array.isArray(l)&&(l=[l,l]);h.normalScale=(new THREE.Vector2).fromArray(l)}void 0!==
b.displacementMap&&(h.displacementMap=this.getTexture(b.displacementMap));void 0!==b.displacementScale&&(h.displacementScale=b.displacementScale);void 0!==b.displacementBias&&(h.displacementBias=b.displacementBias);void 0!==b.roughnessMap&&(h.roughnessMap=this.getTexture(b.roughnessMap));void 0!==b.metalnessMap&&(h.metalnessMap=this.getTexture(b.metalnessMap));void 0!==b.emissiveMap&&(h.emissiveMap=this.getTexture(b.emissiveMap));void 0!==b.emissiveIntensity&&(h.emissiveIntensity=b.emissiveIntensity);
void 0!==b.specularMap&&(h.specularMap=this.getTexture(b.specularMap));void 0!==b.envMap&&(h.envMap=this.getTexture(b.envMap),h.combine=THREE.MultiplyOperation);b.reflectivity&&(h.reflectivity=b.reflectivity);void 0!==b.lightMap&&(h.lightMap=this.getTexture(b.lightMap));void 0!==b.lightMapIntensity&&(h.lightMapIntensity=b.lightMapIntensity);void 0!==b.aoMap&&(h.aoMap=this.getTexture(b.aoMap));void 0!==b.aoMapIntensity&&(h.aoMapIntensity=b.aoMapIntensity);if(void 0!==b.materials){l=0;for(var e=b.materials.length;l<
e;l++)h.materials.push(this.parse(b.materials[l]))}return h}};function TTFLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.reversed=!1}TTFLoader.prototype.load=function(b,h,l,e){var r=this,q=new THREE.XHRLoader(this.manager);q.setResponseType("arraybuffer");q.load(b,function(k){k=r.parse(k);void 0!==h&&h(k)},l,e)};TTFLoader.prototype.parse=function(b){b=opentype.parse(b);return TTFLoader.convert(b,this.reversed)};
TTFLoader.convert=function(b,h){for(var l=1E5/(72*(b.unitsPerEm||2048)),e={glyphs:{}},r=0;r<b.glyphs.length;r++){var q=b.glyphs.glyphs[r];if(void 0!==q.unicode){var k={};k.ha=Math.round(q.advanceWidth*l);k.x_min=Math.round(q.xMin*l);k.x_max=Math.round(q.xMax*l);k.o="";h&&(q.path.commands=TTFLoader.reverseCommands(q.path.commands));q.path.commands.forEach(function(t,p){"c"===t.type.toLowerCase()&&(t.type="b");k.o+=t.type.toLowerCase();k.o+=" ";void 0!==t.x&&void 0!==t.y&&(k.o+=Math.round(t.x*l),k.o+=
" ",k.o+=Math.round(t.y*l),k.o+=" ");void 0!==t.x1&&void 0!==t.y1&&(k.o+=Math.round(t.x1*l),k.o+=" ",k.o+=Math.round(t.y1*l),k.o+=" ");void 0!==t.x2&&void 0!==t.y2&&(k.o+=Math.round(t.x2*l),k.o+=" ",k.o+=Math.round(t.y2*l),k.o+=" ")});e.glyphs[String.fromCharCode(q.unicode)]=k}}e.resolution=1E3;e.original_font_information=b.names;e.unitsPerEm=b.unitsPerEm;e.ascender=Math.round(b.ascender*l);e.descender=Math.round(b.descender*l);e.underlinePosition=b.tables.post.underlinePosition;e.underlineThickness=
b.tables.post.underlineThickness;e.boundingBox={yMin:b.tables.head.yMin,xMin:b.tables.head.xMin,yMax:b.tables.head.yMax,xMax:b.tables.head.xMax};return e};
TTFLoader.reverseCommands=function(b){var h=[],l;b.forEach(function(r){"m"===r.type.toLowerCase()?(l=[r],h.push(l)):"z"!==r.type.toLowerCase()&&l.push(r)});var e=[];h.forEach(function(r){var q={type:"m",x:r[r.length-1].x,y:r[r.length-1].y};e.push(q);for(var k=r.length-1;0<k;k--){var t=r[k];q={type:t.type};void 0!==t.x2&&void 0!==t.y2?(q.x1=t.x2,q.y1=t.y2,q.x2=t.x1,q.y2=t.y1):void 0!==t.x1&&void 0!==t.y1&&(q.x1=t.x1,q.y1=t.y1);q.x=r[k-1].x;q.y=r[k-1].y;e.push(q)}});return e};
function LeapMotion(){THREE.Object3D.call(this);this.type="LeapDevice";this.name="leap";this.poses_enabled=this.gestures_enabled=this.debug_model=!0;this.mode=LeapMotion.DESK;this.use_arm=!1;this.bone_meshes=[];this.arm_meshes=[];this.material=new THREE.MeshPhongMaterial;this.geometry=new THREE.BoxBufferGeometry(1,1,1);this.physics_world=null;this.physics_bodys=[];this.gesture=[];for(var b=0;10>b;b++)this.gesture[b]=!1;this.pose=[];for(b=0;3>b;b++)this.pose[b]=!1;this.data=null;this.components=[];
this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LeapComponent)}LeapMotion.prototype=Object.create(THREE.Object3D.prototype);LeapMotion.DESK=0;LeapMotion.HDM=1;LeapMotion.SWIPE=0;LeapMotion.SWIPE_LEFT=1;LeapMotion.SWIPE_RIGHT=2;LeapMotion.SWIPE_FRONT=3;LeapMotion.SWIPE_BACK=4;LeapMotion.SWIPE_UP=5;LeapMotion.SWIPE_DOWN=6;LeapMotion.CIRCLE=7;LeapMotion.SCREEN_TAP=8;LeapMotion.KEY_TAP=9;
LeapMotion.CLOSED=0;LeapMotion.OPEN=1;LeapMotion.POINTING=2;LeapMotion.prototype.initialize=function(){var b=this;Leap.loop({background:!0},function(l){b.data=l}).connect();for(var h=0;h<this.children.length;h++)this.children[h].initialize()};LeapMotion.prototype.update=function(){null!==this.data&&(this.gestures_enabled&&this.updateGestures(),this.poses_enabled&&this.updatePoses(),this.debug_model&&this.updateDebugModel());for(var b=0;b<this.children.length;b++)this.children[b].update()};
LeapMotion.prototype.checkGesture=function(b){return void 0!==this.gesture[b]?this.gesture[b]:!1};LeapMotion.prototype.checkPose=function(b){return void 0!==this.pose[b]?this.pose[b]:!1};LeapMotion.prototype.setMode=function(b){this.mode=b};
LeapMotion.prototype.updatePoses=function(){for(var b=0;b<this.pose.length;b++)this.pose[b]=!0;for(var h=0;h<this.data.hands.length;h++){var l=this.data.hands[h],e=l.sphereCenter;e=new THREE.Vector3(e[0],e[1],e[2]);var r=[],q=0;for(b=0;b<this.pose.length;b++)this.pose[b]=!0;var k=[];for(b=0;b<l.fingers.length;b++){var t=l.fingers[b];k.push(t.direction);t=t.distal.nextJoint;t=new THREE.Vector3(t[0],t[1],t[2]);r.push(e.distanceTo(t)/l._scaleFactor);0!==b&&(.3>k[b][2]&&(this.pose[LeapMotion.CLOSED]=
!1),-.5<k[b][2]&&(this.pose[LeapMotion.OPEN]=!1),1===b?q=r[1]:q<2*r[b]-15&&(this.pose[LeapMotion.POINTING]=!1))}q<2*r[0]-15&&(this.pose[LeapMotion.POINTING]=!1)}};
LeapMotion.prototype.updateGestures=function(){for(var b=0;b<this.gesture.length;b++)this.gesture[b]=!1;var h=this;this.data.valid&&0<this.data.gestures.length&&this.data.gestures.forEach(function(l){"swipe"===l.type?(h.gesture[LeapMotion.SWIPE]=!0,0<l.direction[0]?h.gesture[LeapMotion.SWIPE_RIGHT]=!0:h.gesture[LeapMotion.SWIPE_LEFT]=!0,0<l.direction[1]?h.gesture[LeapMotion.SWIPE_UP]=!0:h.gesture[LeapMotion.SWIPE_DOWN]=!0,0<l.direction[2]?h.gesture[LeapMotion.SWIPE_FRONT]=!0:h.gesture[LeapMotion.SWIPE_BACK]=
!0):"circle"===l.type?h.gesture[LeapMotion.CIRCLE]=!0:"keyTap"===l.type?h.gesture[LeapMotion.KEY_TAP]=!0:"screenTap"===l.type&&(h.gesture[LeapMotion.SCREEN_TAP]=!0)})};
LeapMotion.prototype.updateDebugModel=function(){var b=this;this.arm_meshes.forEach(function(A){b.remove(A)});this.bone_meshes.forEach(function(A){b.remove(A)});for(var h=0,l=0,e=0;e<this.data.hands.length;e++){for(var r=this.data.hands[e],q=0;q<r.fingers.length;q++)for(var k=r.fingers[e],t=0;t<k.bones.length;t++){var p=k.bones[t];if(0!==h){var y=this.bone_meshes[h]||this.addMesh(this.bone_meshes);this.updateMesh(p,y)}h++}this.show_arm&&(r=r.arm,q=this.arm_meshes[l++]||this.addMesh(this.arm_meshes),
this.updateMesh(r,q),q.scale.set(r.width/1200,r.width/300,r.length/150))}null!==this.physics_world&&this.updatePhysics()};
LeapMotion.prototype.updatePhysics=function(){for(var b=0;b<this.physics_bodys.length;b++)this.physics_world.removeBody(this.physics_bodys[b].pop());this.children.forEach(function(h,l){h=new THREE.BoundingBoxHelper(h);h.update();l=new THREE.Vector3(h.box.max.x-h.box.min.x,h.box.max.y-h.box.min.y,h.box.max.z-h.box.min.z);l.x*=this.scale.x;l.y*=this.scale.y;l.z*=this.scale.z;l.divideScalar(2);h=h.box.center();h.x*=this.scale.x;h.y*=this.scale.y;h.z*=this.scale.z;h.add(this.position);l=new CANNON.Box(new CANNON.Vec3(l.x,
l.y,l.z));var e=new CANNON.Body({mass:0});e.addShape(l);e.position.set(h.x-this.position.x,h.y-this.position.y,h.z-this.position.z);e.updateMassProperties();this.physics_bodys.push(e);this.physics_world.addBody(e)})};LeapMotion.prototype.addMesh=function(b){var h=new Mesh(this.geometry,this.material);h.castShadow=this.castShadow;h.receiveShadow=this.receiveShadow;b.push(h);return h};
LeapMotion.prototype.updateMesh=function(b,h){h.position.fromArray(b.center());h.position.divideScalar(150);h.setRotationFromMatrix((new THREE.Matrix4).fromArray(b.matrix()));h.scale.set(b.width/150,b.width/150,b.length/150);this.add(h)};LeapMotion.prototype.getMovement=function(){var b=this.data.gestures[0].position,h=this.data.gestures[0].startPosition;b=new THREE.Vector3(b[0]-h[0],b[1]-h[1],b[2]-h[2]);b.divideScalar(this.data.currentFrameRate);return b};
LeapMotion.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.type=this.type;b.object.debug_model=this.debug_model;b.object.gestures_enabled=this.gestures_enabled;b.object.poses_enabled=this.poses_enabled;b.object.mode=this.mode;b.object.use_arm=this.use_arm;return b};
function KinectDevice(){THREE.Object3D.call(this);this.type="Kinect";this.name="kinect";this.socket=new WebSocket("ws://127.0.0.1:8181");this.connected=!1;this.debug_model=!0;this.data_timeout=0;this.data=this.camera=null;this.data_received=!1;var b=this;this.socket.onopen=function(){b.connected=!0};this.socket.onclose=function(){b.connected=!1};this.socket.onmessage=function(h){"string"===typeof h.data?(b.data=JSON.parse(h.data),b.data_received=!0,b.data_timeout=KinectDevice.DATA_TIMEOUT):h.data instanceof
Blob&&(b.camera=h.data)};this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new KinectComponent)}KinectDevice.DATA_TIMEOUT=20;KinectDevice.DEPTH=0;KinectDevice.COLOR=1;
KinectDevice.JOINTS_NAME=[["head","shouldercenter"],["shouldercenter","shoulderright"],["shouldercenter","shoulderleft"],["shoulderright","elbowright"],["shoulderleft","elbowleft"],["elbowright","wristright"],["elbowleft","wristleft"],["wristright","handright"],["wristleft","handleft"],["shouldercenter","spine"],["spine","hipcenter"],["hipcenter","hipright"],["hipcenter","hipleft"],["hipright","kneeright"],["hipleft","kneeleft"],["kneeright","ankleright"],["kneeleft","ankleleft"],["ankleright","footright"],
["ankleleft","footleft"]];KinectDevice.prototype=Object.create(THREE.Object3D.prototype);
KinectDevice.prototype.update=function(){if(null!==this.data)if(this.data_received){for(this.data_received=!1;0<this.children.length;)this.children.pop();if(this.debug_model)for(var b=new THREE.SphereGeometry(.04,6,6),h=new THREE.MeshPhongMaterial(16711680),l=0;l<this.data.skeletons.length;l++)for(var e=this.data.skeletons[l].joints,r=0;r<e.length;r++){var q=new Mesh(b,h);q.position.set(e[r].x,e[r].y,e[r].z);q.castShadow=!0;this.add(q)}}else if(0<this.data_timeout&&(this.data_timeout--,0===this.data_timeout))for(;0<
this.children.length;)this.children.pop();for(r=0;r<this.children.length;r++)this.children[r].update()};KinectDevice.prototype.isConnected=function(){return this.connected};KinectDevice.prototype.setCameraMode=function(b){b===KinectDevice.COLOR?socket.send("Color"):b===KinectDevice.DEPTH&&socket.send("Depth")};KinectDevice.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.debug_model=this.debug_model;return b};
function Mesh(b,h){THREE.Mesh.call(this,b,h);this.name="model";this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Mesh.prototype=Object.create(THREE.Mesh.prototype);Mesh.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
function SkinnedMesh(b,h,l){THREE.SkinnedMesh.call(this,b,h,l);this.name="model";this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}SkinnedMesh.prototype=Object.create(THREE.SkinnedMesh.prototype);SkinnedMesh.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
function Text3D(b,h,l,e,r,q,k,t,p){THREE.Mesh.call(this,void 0,h);this.name="text";this.type="Text3D";this.font=l;this.text=void 0!==b?b:"text";this.size=void 0!==t?t:1;this.height=void 0!==e?e:.5;this.curve_segments=void 0!==p?p:15;this.bevel=void 0!=r?r:!1;this.bevel_thickness=void 0!==q?q:.1;this.bevel_size=void 0!==k?k:.05;this.setText(this.text);this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);
this.defaultComponents.push(new Text3DComponent)}Text3D.prototype=Object.create(THREE.Mesh.prototype);Text3D.prototype.setFont=function(b){this.font=b;this.setText()};Text3D.prototype.setText=function(b){void 0!==b&&(this.text=b);void 0!==this.geometry&&this.geometry.dispose();this.updateText()};
Text3D.prototype.updateText=function(){null!==this.font&&(this.geometry=new THREE.TextGeometry(this.text,{size:this.size,curveSegments:this.curve_segments,font:this.font,height:this.height,bevelEnabled:this.bevel,bevelSize:this.bevel_size,bevelThickness:this.bevel_thickness}))};Text3D.prototype.clone=function(){return new Text3D(this.text,this.material,this.font,this.height,this.bevel,this.bevel_thickness,this.bevel_size,this.size,this.curve_segments)};
Text3D.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();void 0!==this.geometry&&this.geometry.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
Text3D.prototype.toJSON=function(b){var h=this.geometry;this.geometry=void 0;var l=this.font;b=THREE.Object3D.prototype.toJSON.call(this,b,(e,r)=>{l=l.toJSON(e)});b.object.text=this.text;b.object.font=l.uuid;b.object.size=this.size;b.object.curve_segments=this.curve_segments;b.object.height=this.height;b.object.bevel=this.bevel;b.object.bevel_thickness=this.bevel_thickness;b.object.bevel_size=this.bevel_size;this.geometry=h;return b};
function Sprite(b){THREE.Sprite.call(this,b);this.name="sprite";this.type="Sprite";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Sprite.prototype=Object.create(THREE.Sprite.prototype);Sprite.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
function PointLight(b,h,l,e){THREE.PointLight.call(this,b,h,l,e);this.name="point light";this.castShadow=!0;this.shadow.camera.near=.05;this.shadow.camera.far=5E3;this.shadow.bias=.01;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}PointLight.prototype=Object.create(THREE.PointLight.prototype);
PointLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};
function SpotLight(b,h,l,e,r,q){THREE.SpotLight.call(this,b,h,l,e,r,q);this.name="spot light";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=5E3;this.shadow.mapSize.width=512;this.shadow.mapSize.height=512;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}SpotLight.prototype=Object.create(THREE.SpotLight.prototype);
SpotLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function AmbientLight(b){THREE.AmbientLight.call(this,b);this.name="ambient light";this.matrixAutoUpdate=!1;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}AmbientLight.prototype=Object.create(THREE.AmbientLight.prototype);
function DirectionalLight(b,h){THREE.DirectionalLight.call(this,b,h);this.name="directional light";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=1E4;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}DirectionalLight.prototype=Object.create(THREE.DirectionalLight.prototype);
DirectionalLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function HemisphereLight(b,h,l){THREE.HemisphereLight.call(this,b,h,l);this.name="hemisphere light";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}HemisphereLight.prototype=Object.create(THREE.HemisphereLight.prototype);
function RectAreaLight(b,h,l,e){THREE.RectAreaLight.call(this,b,h,l,e);this.name="rectarea light"}RectAreaLight.prototype=Object.create(THREE.RectAreaLight.prototype);RectAreaLight.prototype.toJSON=function(b){b=Light.prototype.toJSON.call(this,b);b.object.width=this.width;b.object.height=this.height;return b};
function Sky(b,h,l,e){THREE.Object3D.call(this);this.name="sky";this.type="Sky";this.clock=new THREE.Clock;this.color_top=[new THREE.Color(7844859),new THREE.Color(30463),new THREE.Color(220086),new THREE.Color(9273)];this.color_bottom=[new THREE.Color(15461606),new THREE.Color(16777215),new THREE.Color(16705495),new THREE.Color(26023)];this.sun_color=16777130;this.moon_color=8947967;this.hemisphere=new HemisphereLight(16777215,16777215,.5);this.hemisphere.color.setHSL(.6,1,.6);this.hemisphere.groundColor.setHSL(.1,
1,.75);this.hemisphere.position.set(0,500,0);this.hemisphere.hidden=!0;this.hemisphere.rotationAutoUpdate=!1;this.hemisphere.matrixAutoUpdate=!1;this.add(this.hemisphere);this.sun=new DirectionalLight(this.sun_color,.3);this.sun.castShadow=!0;this.sun.hidden=!0;this.add(this.sun);var r={top_color:{type:"c",value:new THREE.Color(0,.46,1)},bottom_color:{type:"c",value:new THREE.Color(1,1,1)},offset:{type:"f",value:20},exponent:{type:"f",value:.4}};r.top_color.value.copy(this.hemisphere.color);var q=
new THREE.SphereBufferGeometry(1E3,16,16);r=new THREE.ShaderMaterial({vertexShader:"varying vec3 vWorldPosition; \tvoid main() \t{ \t\tvec4 worldPosition = modelMatrix * vec4(position, 1.0); \t\tvWorldPosition = worldPosition.xyz; \t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \t}",fragmentShader:"uniform vec3 top_color; \tuniform vec3 bottom_color; \tuniform float offset; \tuniform float exponent; \tvarying vec3 vWorldPosition; \tvoid main() \t{ \t\tfloat h = normalize(vWorldPosition + offset).y; \t\tgl_FragColor = vec4(mix(bottom_color, top_color, max(pow(max(h , 0.0), exponent), 0.0)), 1.0); \t}",
uniforms:r,side:THREE.BackSide});this.sky=new THREE.Mesh(q,r);this.sky.hidden=!0;this.sky.rotationAutoUpdate=!1;this.sky.matrixAutoUpdate=!1;this.add(this.sky);this.sky.raycast=function(){return null};this.auto_update=void 0!==b?b:!0;this.sun_distance=void 0!==l?l:500;this.day_time=void 0!==h?h:240;this.time=void 0!==e?e:150;this.updateSky();this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new SkyComponent)}
Sky.prototype=Object.create(THREE.Object3D.prototype);Sky.prototype.initialize=function(){this.updateSky();for(var b=0;b<this.children.length;b++)this.children[b].initialize()};Sky.prototype.update=function(){this.auto_update&&(this.time+=this.clock.getDelta(),this.time>this.day_time&&(this.time-=this.day_time),this.updateSky());for(var b=0;b<this.children.length;b++)this.children[b].update()};
Sky.prototype.updateSky=function(){var b=this.time/this.day_time;if(.25>b)this.sky.material.uniforms.top_color.value.setRGB(this.color_top[3].r,this.color_top[3].g,this.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(this.color_bottom[3].r,this.color_bottom[3].g,this.color_bottom[3].b);else if(.292>b){var h=23.81*(b-.25),l=1-h;this.sky.material.uniforms.top_color.value.setRGB(l*this.color_top[3].r+h*this.color_top[0].r,l*this.color_top[3].g+h*this.color_top[0].g,l*this.color_top[3].b+
h*this.color_top[0].b);this.sky.material.uniforms.bottom_color.value.setRGB(l*this.color_bottom[3].r+h*this.color_bottom[0].r,l*this.color_bottom[3].g+h*this.color_bottom[0].g,l*this.color_bottom[3].b+h*this.color_bottom[0].b)}else.4167>b?(this.sky.material.uniforms.top_color.value.setRGB(this.color_top[0].r,this.color_top[0].g,this.color_top[0].b),this.sky.material.uniforms.bottom_color.value.setRGB(this.color_bottom[0].r,this.color_bottom[0].g,this.color_bottom[0].b)):.5>b?(h=12*(b-.4167),l=1-h,
this.sky.material.uniforms.top_color.value.setRGB(l*this.color_top[0].r+h*this.color_top[1].r,l*this.color_top[0].g+h*this.color_top[1].g,l*this.color_top[0].b+h*this.color_top[1].b),this.sky.material.uniforms.bottom_color.value.setRGB(l*this.color_bottom[0].r+h*this.color_bottom[1].r,l*this.color_bottom[0].g+h*this.color_bottom[1].g,l*this.color_bottom[0].b+h*this.color_bottom[1].b)):.708>b?(this.sky.material.uniforms.top_color.value.setRGB(this.color_top[1].r,this.color_top[1].g,this.color_top[1].b),
this.sky.material.uniforms.bottom_color.value.setRGB(this.color_bottom[1].r,this.color_bottom[1].g,this.color_bottom[1].b)):.75>b?(h=23.81*(b-.708),l=1-h,this.sky.material.uniforms.top_color.value.setRGB(l*this.color_top[1].r+h*this.color_top[2].r,l*this.color_top[1].g+h*this.color_top[2].g,l*this.color_top[1].b+h*this.color_top[2].b),this.sky.material.uniforms.bottom_color.value.setRGB(l*this.color_bottom[1].r+h*this.color_bottom[2].r,l*this.color_bottom[1].g+h*this.color_bottom[2].g,l*this.color_bottom[1].b+
h*this.color_bottom[2].b)):.8333>b?(h=12.048*(b-.75),l=1-h,this.sky.material.uniforms.top_color.value.setRGB(l*this.color_top[2].r+h*this.color_top[3].r,l*this.color_top[2].g+h*this.color_top[3].g,l*this.color_top[2].b+h*this.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(l*this.color_bottom[2].r+h*this.color_bottom[3].r,l*this.color_bottom[2].g+h*this.color_bottom[3].g,l*this.color_bottom[2].b+h*this.color_bottom[3].b)):(this.sky.material.uniforms.top_color.value.setRGB(this.color_top[3].r,
this.color_top[3].g,this.color_top[3].b),this.sky.material.uniforms.bottom_color.value.setRGB(this.color_bottom[3].r,this.color_bottom[3].g,this.color_bottom[3].b));.2>b?this.sun.color.setHex(this.moon_color):.3>b?(h=10*(b-.2),.5>h?(this.sun.intensity=.3*(2-2*h),this.sun.color.setHex(this.moon_color)):(this.sun.intensity=.6*h,this.sun.color.setHex(Sky.sun_color))):.7>b?this.sun.color.setHex(Sky.sun_color):.8>b?(h=10*(b-.7),.5>h?(this.sun.intensity=.3*(2-2*h),this.sun.color.setHex(Sky.sun_color)):
(this.sun.intensity=.6*h,this.sun.color.setHex(this.moon_color))):this.sun.color.setHex(this.moon_color);h=MathUtils.pi2*b-MathUtils.pid2;.25<b&&.75>b?(this.sun.position.x=this.sun_distance*Math.cos(h),this.sun.position.y=this.sun_distance*Math.sin(h)):(this.sun.position.x=this.sun_distance*Math.cos(h+Math.PI),this.sun.position.y=this.sun_distance*Math.sin(h+Math.PI))};
Sky.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.auto_update=this.auto_update;b.object.sun_distance=this.sun_distance;b.object.day_time=this.day_time;b.object.time=this.time;b.object.sun={};b.object.sun.shadow=this.sun.shadow.toJSON();return b};
function PerspectiveCamera(b,h,l,e){THREE.PerspectiveCamera.call(this,b,h,l,e);this.name="camera";this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clear_depth=this.clear_color=!1;this.listener=new THREE.AudioListener;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new CameraComponent)}PerspectiveCamera.prototype=Object.create(THREE.PerspectiveCamera.prototype);
PerspectiveCamera.prototype.destroy=function(){var b=ObjectUtils.getScene(this);null!==b&&b.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};PerspectiveCamera.prototype.updateMatrixWorld=function(b){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===b)null!==this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld=this.matrix,this.matrixWorldNeedsUpdate=!1,b=!0;for(var h=this.children,l=0;l<this.children.length;l++)h[l].updateMatrixWorld(b)};
PerspectiveCamera.prototype.updateProjectionMatrix=function(){var b=this.near*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,h=2*b,l=this.aspect*h*(void 0!==this.viewport?this.viewport.x/this.viewport.y:1),e=-.5*l;0!==this.filmOffset&&(e+=this.near*this.filmOffset/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+l,b-h,b,this.near,this.far)};
PerspectiveCamera.prototype.toJSON=function(b){b=THREE.PerspectiveCamera.prototype.toJSON.call(this,b);b.object.clear_color=this.clear_color;b.object.clear_depth=this.clear_depth;b.object.viewport=this.viewport.toArray();b.object.offset=this.offset.toArray();return b};
function OrthographicCamera(b,h,l,e,r){THREE.OrthographicCamera.call(this,-1,1,1,-1,e,r);this.name="camera";this.size=void 0!==b?b:1;this.aspect=void 0!==h?h:1;this.mode=void 0!==l?l:OrthographicCamera.RESIZE_HORIZONTAL;this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clear_depth=this.clear_color=!1;this.updateProjectionMatrix();this.listener=new THREE.AudioListener;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);
this.defaultComponents.push(new CameraComponent)}OrthographicCamera.prototype=Object.create(THREE.OrthographicCamera.prototype);OrthographicCamera.RESIZE_HORIZONTAL=0;OrthographicCamera.RESIZE_VERTICAL=1;OrthographicCamera.prototype.destroy=function(){var b=ObjectUtils.getScene(this);null!==b&&b.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};
OrthographicCamera.prototype.updateProjectionMatrix=function(){this.mode===OrthographicCamera.RESIZE_HORIZONTAL?(this.top=this.size/2,this.bottom=-this.top,this.right=this.viewport.x/this.viewport.y*this.aspect*this.top,this.left=-this.right):this.mode===OrthographicCamera.RESIZE_VERTICAL&&(this.right=this.size/2,this.left=-this.right,this.top=this.right/this.aspect*(this.viewport.x/this.viewport.y),this.bottom=-this.top);THREE.OrthographicCamera.prototype.updateProjectionMatrix.call(this)};
OrthographicCamera.prototype.toJSON=function(b){b=THREE.OrthographicCamera.prototype.toJSON.call(this,b);b.object.size=this.size;b.object.aspect=this.aspect;b.object.mode=this.mode;b.object.clear_color=this.clear_color;b.object.clear_depth=this.clear_depth;b.object.viewport=this.viewport.toArray();b.object.offset=this.offset.toArray();return b};
function AudioEmitter(b){THREE.Audio.call(this,AudioEmitter.listener);this.name="audio";this.type="Audio";this.matrixAutoUpdate=!1;this.audio=void 0!==b?b:Editor.default_audio;this.autoplay=!0;this.playbackRate=1;this.startTime=0;this.loop=!0;this.isPlaying=!1;this.hasPlaybackControl=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new AudioComponent)}AudioEmitter.listener=new THREE.AudioListener;AudioEmitter.prototype=Object.create(THREE.Audio.prototype);
AudioEmitter.prototype.initialize=function(){var b=this;null!==this.audio&&THREE.AudioContext.getContext().decodeAudioData(this.audio.data,l=>{b.setBuffer(l)});for(var h=0;h<this.children.length;h++)this.children[h].initialize()};AudioEmitter.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect());for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
AudioEmitter.prototype.toJSON=function(b){var h=this.audio;b=THREE.Object3D.prototype.toJSON.call(this,b,(l,e)=>{h=h.toJSON(l)});b.object.audio=h.uuid;b.object.autoplay=this.autoplay;b.object.startTime=this.startTime;b.object.playbackRate=this.playbackRate;b.object.loop=this.loop;return b};
function PositionalAudio(b){THREE.PositionalAudio.call(this,PositionalAudio.listener);this.name="audio";this.type="PositionalAudio";this.audio=void 0!==b?b:null;this.autoplay=!0;this.playbackRate=1;this.startTime=0;this.loop=!0;this.isPlaying=!1;this.hasPlaybackControl=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent)}PositionalAudio.listener=new THREE.AudioListener;PositionalAudio.prototype=Object.create(THREE.Audio.prototype);
PositionalAudio.prototype.initialize=function(){var b=this;null!==this.audio&&(THREE,AudioContext.getContext().decodeAudioData(this.audio.data,l=>{b.setBuffer(l)}));for(var h=0;h<this.children.length;h++)this.children[h].initialize()};PositionalAudio.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect());for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
PositionalAudio.prototype.toJSON=function(b){var h=this.audio;b=THREE.Object3D.prototype.toJSON.call(this,b,(l,e)=>{h=h.toJSON(l)});b.object.audio=h.uuid;b.object.autoplay=this.autoplay;b.object.startTime=this.startTime;b.object.playbackRate=this.playbackRate;b.object.loop=this.loop;return b};
function Script(b){THREE.Object3D.call(this);this.type="Script";this.name="script";this.path="/";this.func=this.scene=this.program=null;this.setCode(void 0!==b?b:Script.default);this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ScriptComponent)}Script.prototype=Object.create(THREE.Object3D.prototype);Script.default="// This block of code is executed one\nthis.initialize = function() {\n\n}\n\n// This block of code is executed once per frame\nthis.update = function() {\n\n}\n\n// When mouse is over children\nthis.onMouseOver = function(object) {\n\n}\n\n// When the window is resized\nthis.onResize = function() {\n\n}\n\n// When the game is closed\nthis.onExit = function() {\n\n}\n";
Script.prototype.initialize=function(){for(var b=this;null!==b.parent;)b=b.parent,b instanceof Scene?this.scene=b:b instanceof Program&&(this.program=b);void 0!==this.script.initialize&&this.script.initialize.call(this);for(b=0;b<this.children.length;b++)this.children[b].initialize()};
Script.prototype.update=function(){if(void 0!==this.script.onMouseOver){var b=this.scene.raycaster.intersectObjects(this.children,!0);0<b.length&&this.script.onMouseOver.call(this,b)}void 0!==this.script.update&&this.script.update.call(this);for(b=0;b<this.children.length;b++)this.children[b].update()};Script.prototype.resize=function(){void 0!==this.script.onResize&&this.script.onResize.call(this)};
Script.prototype.setCode=function(b){try{this.code=b,this.script=new (new Function(this.code))}catch(h){console.error(h),this.script=new function(){}}};Script.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.code=this.code;b.object.path=this.path;return b};
function BlockScript(b,h,l){THREE.Object3D.call(this);this.type="BlockScript";this.name="blocks";this.obj_uuid=void 0!==h?h:this.uuid;this.blocks_type=void 0!==l?l:"scene";this.path="/";this.nodes={config:{blocks:"Blocks",type:this.blocks_type,uuid:this.obj_uuid},extra:{},groups:{},last_link_id:0,last_node_id:0,links:[],nodes:[{flags:{},id:1,mode:0,order:0,outputs:[Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.passer),Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.event)],
pos:[100,352],properties:{},size:[120,26],type:"Events/BeginPlay"},{flags:{},id:2,inputs:[],mode:0,order:1,outputs:[Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.passer)],pos:[100,429],properties:{},size:[120,26],type:"Events/EventTick"}],version:.4};void 0!==b&&(this.nodes=b);this.graph=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent)}BlockScript.prototype=Object.create(THREE.Object3D.prototype);
BlockScript.prototype.initialize=function(){var b=this;this.graph=new LGraph(this.nodes);this.graph.config.scene=ObjectUtils.getScene(this);if("scene"===this.graph.config.type)this.graph.config.self=this;else if("class"===this.graph.config.type){var h=void 0!==Editor.program_running&&null!==Editor.program_running?Editor.program_running.scene:Main.program.scene;this.graph.config.scene=h;h.traverse(l=>{void 0!==l.obj_uuid&&l.obj_uuid===b.uuid&&(b.graph.config.self=l)})}setTimeout(()=>{b.graph.start()},
100);for(h=0;h<this.children.length;h++)this.children[h].initialize()};BlockScript.prototype.update=function(){for(var b=0;b<this.children.length;b++)this.children[b].update()};BlockScript.prototype.dispose=function(){null!==this.graph&&(this.graph.sendEventToAllNodes("onDispose"),this.graph.stop(),this.nodes.extra={});for(var b=0;b<this.children.length;b++)this.children[b].dispose()};BlockScript.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
BlockScript.prototype.updateNodes=function(b){this.nodes=b};BlockScript.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);delete this.nodes.config.self;delete this.nodes.config.scene;b.object.nodes=this.nodes;b.object.path=this.path;return b};
function PhysicsObject(){THREE.Object3D.call(this);this.name="physics";this.type="Physics";this.body=new CANNON.Body;this.body.type=CANNON.Body.DYNAMIC;this.body.mass=1;this.world=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new PhysicsComponent)}PhysicsObject.prototype=Object.create(THREE.Object3D.prototype);
PhysicsObject.prototype.initialize=function(){this.body.position.copy(this.position);this.body.quaternion.copy(this.quaternion);for(var b=this;null!==b.parent;)b=b.parent,b instanceof Scene&&(this.world=b.world,this.world.addBody(this.body));for(b=0;b<this.children.length;b++)this.children[b].initialize()};PhysicsObject.prototype.update=function(){this.position.copy(this.body.position);this.body.fixedRotation||this.quaternion.copy(this.body.quaternion);for(var b=0;b<this.children.length;b++)this.children[b].update()};
PhysicsObject.prototype.addShape=function(b){b instanceof CANNON.Shape&&this.body.addShape(b)};
PhysicsObject.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.body={};b.object.body.type=this.body.type;b.object.body.mass=this.body.mass;b.object.body.linearDamping=this.body.linearDamping;b.object.body.angularDamping=this.body.angularDamping;b.object.body.allowSleep=this.body.allowSleep;b.object.body.sleepSpeedLimit=this.body.sleepSpeedLimit;b.object.body.sleepTimeLimit=this.body.sleepTimeLimit;b.object.body.collisionFilterGroup=this.body.collisionFilterGroup;
b.object.body.collisionFilterMask=this.body.collisionFilterMask;b.object.body.fixedRotation=this.body.fixedRotation;b.object.body.shapes=[];for(var h=this.body.shapes,l=0;l<h.length;l++){var e=h[l],r={};r.type=e.type;e.type===CANNON.Shape.types.SPHERE?r.radius=e.radius:e.type===CANNON.Shape.types.BOX?(r.halfExtents={},r.halfExtents.x=e.halfExtents.x,r.halfExtents.y=e.halfExtents.y,r.halfExtents.z=e.halfExtents.z):e.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&(r.vertices=e.vertices,r.faces=e.faces);
b.object.body.shapes[l]=r}return b};
function SpineAnimation(b,h,l,e){if(void 0!==e)var r=new spine.TextureAtlas(h,q=>{for(var k=0;k<e.length;k++)if(e[k].name===q)return q=new SpineTexture(e[k].texture),k=q.texture.image,k.width=1024,k.height=1024,q});else e=[],r=new spine.TextureAtlas(h,q=>{var k=new SpineTexture(new Texture(new GORLOT.Image(l+"/"+q))),t=new k.texture.image;t.width=1024;t.height=1024;e.push({name:q,texture:k.texture});return k});r=new spine.AtlasAttachementLoader(r);r=(new spine.SkeletonJson(r)).readSkeletonData(b);THREE.Mesh.call(this);
this.zOffset=.1;this.skeleton=new spine.Skeleton(r);r=new spine.AnimationStateData(r);this.state=new spine.AnimationState(r);this.batcher=new spine.threejs.MeshBatcher(this);r=new THREE.MeshBasicMaterial;r.side=THREE.DoubleSide;r.transparent=!0;r.name="spine";r.alphaTest=.5;this.material=r;this.json=b;this.atlas=h;this.textures=e;this.name="spine";this.type="SpineAnimation";this.scale.set(.01,.01,.01);this.frustumCulled=!1;this.castShadow=this.receiveShadow=!0;this.clock=new THREE.Clock;this.components=
[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}SpineAnimation.prototype=Object.create(THREE.Mesh.prototype);SpineAnimation.QUAD_TRIANGLES=[0,1,2,2,3,0];SpineAnimation.prototype.update=function(){var b=this.state,h=this.skeleton;b.update(this.clock.getDelta());b.apply(h);h.updateWorldTransform();this.updateGeometry();for(b=0;b<this.children.length;b++)this.children[b].update()};SpineAnimation.prototype.getAnimations=function(){return this.state.data.skeletonData.animations};
SpineAnimation.prototype.setAnimation=function(b,h){try{this.state.setAnimation(b,h,!0)}catch(l){}};SpineAnimation.prototype.getSkins=function(){return this.state.data.skeletonData.skins};
SpineAnimation.prototype.updateGeometry=function(){var b=this.skeleton.drawOrder,h=0,l=this.batcher;l.begin();for(var e=0,r=b.length;e<r;e++){var q=b[e];var k=q.getAttachment();if(k instanceof spine.RegionAttachment){var t=k;q=t.updateWorldVertices(q,!1);k=SpineAnimation.QUAD_TRIANGLES;t=t.region.renderObject.texture}else if(k instanceof spine.MeshAttachment)t=k,q=t.updateWorldVertices(q,!1),k=t.triangles,t=t.region.renderObject.texture;else continue;if(null!==t){if(!this.material.map){var p=this.material;
p.map=t.texture;p.needsUpdate=!0}l.batch(q,k,h);h+=this.zOffset}}l.end()};SpineAnimation.prototype.toJSON=function(b){var h=this.geometry,l=this.material;this.material=this.geometry=void 0;var e=[],r=this;b=THREE.Object3D.prototype.toJSON.call(this,b,(q,k)=>{for(k=0;k<r.textures.length;k++){var t=r.textures[k].texture.toJSON(q);e.push({name:r.textures[k].name,texture:t.uuid})}});b.object.json=this.json;b.object.atlas=this.atlas;b.object.textures=e;this.geometry=h;this.material=l;return b};
function SpineTexture(b){spine.Texture.call(this,b.image);this.texture=b;this.texture.flipY=!1}SpineTexture.prototype=Object.create(spine.Texture.prototype);SpineTexture.prototype.setFilters=function(b,h){this.texture.minFilter=SpineTexture.getTextureFilter(b);this.texture.magFilter=SpineTexture.getTextureFilter(h)};SpineTexture.prototype.setWraps=function(b,h){this.texture.wrapS=SpineTexture.getTextureWrap(b);this.texture.wrapT=SpineTexture.getTextureWrap(h)};SpineTexture.prototype.dispose=function(){this.texture.dispose()};
SpineTexture.getTextureFilter=function(b){return b===spine.TextureFilter.Linear?THREE.LinearFilter:b===spine.TextureFilter.MipMap||b===spine.TextureFilter.MipMapLinearLinear?THREE.LinearMipMapLinearFilter:b===spine.TextureFilter.MipMapLinearNearest?THREE.LinearMipMapNearestFilter:b===spine.TextureFilter.MipMapNearestNearest?THREE.NearestMipMapNearestFilter:b===spine.TextureFilter.Nearest?THREE.NearestFilter:null};
SpineTexture.getTextureWrap=function(b){if(b===spine.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(b===spine.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(b===spine.TextureWrap.Repeat)return THREE.RepeatWrapping};function Bone(){THREE.Bone.call(this);this.name="bone";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Bone.prototype=Object.create(THREE.Bone.prototype);
function Empty(){THREE.Object3D.call(this);this.name="empty";this.type="Group";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Empty.prototype=Object.create(THREE.Object3D.prototype);
function ParticleEmitter(b,h){THREE.Object3D.call(this);this.type="ParticleEmiter";this.name="particle";this.nodes={config:{},groups:[],last_link_id:0,last_node_id:1,links:[],nodes:[{flags:{},id:1,mode:0,order:0,outputs:[],pos:[130,130],properties:{},extra:{},size:[210,234],type:"Particles/Particles"}],version:.4};this.clock=new THREE.Clock;this.group=void 0!==b?new SPE.Group(b):new SPE.Group({texture:{value:new Texture(new GORLOT.Image("Engine/Data/particle.png"))},maxParticleCount:2E3,blending:THREE.AdditiveBlending,
hasPerspective:!0});this.group.mesh.frustumCulled=!1;this.emitter=void 0!==h?new SPE.Emitter(h):new SPE.Emitter({particleCount:2E3,type:SPE.distributions.BOX,maxAge:{value:2,spread:0},velocity:{value:new THREE.Vector3(0,25,0),spread:new THREE.Vector3(10,7.5,10)},acceleration:{value:new THREE.Vector3(0,-10,0),spread:new THREE.Vector3(10,0,10)},color:{value:[new THREE.Color(1,1,1)],spread:[new THREE.Vector3(0,0,0)]}});this.group.addEmitter(this.emitter);this.components=[];this.defaultComponents=[];
this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}ParticleEmitter.prototype=Object.create(THREE.Object3D.prototype);ParticleEmitter.prototype.initialize=function(){for(var b=0;b<this.children.length;b++)this.children[b].initialize();this.clock.start();this.add(this.group.mesh)};ParticleEmitter.prototype.update=function(){this.group.tick(this.clock.getDelta());for(var b=0;b<this.children.length;b++)this.children[b].update()};
ParticleEmitter.prototype.updateNodes=function(b){this.nodes=b};ParticleEmitter.prototype.dispose=function(){for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
ParticleEmitter.prototype.toJSON=function(b){var h=this.group.texture;b=THREE.Object3D.prototype.toJSON.call(this,b,function(l,e){h=h.toJSON(l)});b.object.group={};b.object.group.texture={};b.object.group.texture.value=h.uuid;b.object.group.textureFrames=this.group.textureFrames;b.object.group.textureFrameCount=this.group.textureFrameCount;b.object.group.textureLoop=this.group.textureLoop;b.object.group.hasPerspective=this.group.hasPerspective;b.object.group.colorize=this.group.colorize;b.object.group.maxParticleCount=
this.group.maxParticleCount;b.object.group.blending=this.group.blending;b.object.group.scale=this.group.scale;b.object.group.depthWrite=this.group.depthWrite;b.object.group.depthTest=this.group.depthTest;b.object.group.fog=this.group.fog;b.object.emitter={};b.object.emitter.uuid=this.emitter.uuid;b.object.emitter.direction=this.emitter.direction;b.object.emitter.particleCount=this.emitter.particleCount;b.object.emitter.duration=this.emitter.duration;b.object.emitter.type=this.emitter.type;b.object.emitter.maxAge=
{};b.object.emitter.maxAge.value=this.emitter.maxAge.value;b.object.emitter.maxAge.spread=this.emitter.maxAge.spread;b.object.emitter.position={};b.object.emitter.position.value=this.emitter.position.value;b.object.emitter.position.spread=this.emitter.position.spread;b.object.emitter.velocity={};b.object.emitter.velocity.value=this.emitter.velocity.value;b.object.emitter.velocity.spread=this.emitter.velocity.spread;b.object.emitter.acceleration={};b.object.emitter.acceleration.value=this.emitter.acceleration.value;
b.object.emitter.acceleration.spread=this.emitter.acceleration.spread;b.object.emitter.wiggle={};b.object.emitter.wiggle.value=this.emitter.wiggle.value;b.object.emitter.wiggle.spread=this.emitter.wiggle.spread;b.object.emitter.opacity={};b.object.emitter.opacity.value=this.emitter.opacity.value;b.object.emitter.opacity.spread=this.emitter.opacity.spread;b.object.emitter.size={};b.object.emitter.size.value=this.emitter.size.value;b.object.emitter.size.spread=this.emitter.size.spread;b.object.emitter.angle=
{};b.object.emitter.angle.value=this.emitter.angle.value;b.object.emitter.angle.spread=this.emitter.angle.spread;b.object.emitter.color={};b.object.emitter.color.value=this.emitter.color.value;b.object.emitter.color.spread=this.emitter.color.spread;b.object.nodes=this.nodes;return b};
function Program(b){THREE.Object3D.call(this);this.type="Program";this.matrixAutoUpdate=!1;this.name=void 0!==b?b:"program";this.author=this.description="";this.version="0";this.vr=this.lock_pointer=!1;this.vr_scale=1;this.antialiasing=!1;this.shadows=!0;this.shadows_type=THREE.PCFSoftShadowMap;this.images=[];this.videos=[];this.audio=[];this.fonts=[];this.materials=[];this.textures=[];this.geometries=[];this.asset_objects=[];this.folders=[];this.canvas=this.renderer=this.scene=this.default_camera=
this.default_scene=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ProgramComponent)}Program.prototype=Object.create(THREE.Object3D.prototype);Program.prototype.initialize=function(){this.canvas=this.renderer.domElement;if(null!==this.default_scene)for(var b=0;b<this.children.length;b++){if(this.children[b].uuid===this.default_scene){this.setScene(this.children[b]);break}}else 0<this.children.length&&this.setScene(this.children[0]);this.lock_pointer&&Mouse.setLock(!0)};
Program.prototype.update=function(){this.scene.update()};Program.prototype.render=function(b){var h=b.domElement.width,l=b.domElement.height;b.setScissorTest(!0);for(var e=0;e<this.scene.cameras.length;e++){var r=this.scene.cameras[e];r.clear_color&&b.clearColor();r.clear_depth&&b.clearDepth();b.setViewport(h*r.offset.x,l*r.offset.y,h*r.viewport.x,l*r.viewport.y);b.setScissor(h*r.offset.x,l*r.offset.y,h*r.viewport.x,l*r.viewport.y);b.render(this.scene,r)}b.setScissorTest(!1)};
Program.prototype.resize=function(b,h){for(var l=0;l<this.scene.cameras.length;l++)this.scene.cameras[l].aspect=b/h,this.scene.cameras[l].updateProjectionMatrix();this.traverse(e=>{e instanceof Script&&e.resize()})};Program.prototype.getMaterialByName=function(b){for(var h in this.materials.length)if(this.materials[h].name===b)return this.materials[h];return null};Program.prototype.addMaterial=function(b){b instanceof THREE.Material&&(this.materials[b.uuid]=b)};
Program.prototype.removeMaterial=function(b,h,l){void 0===h&&(h=new MeshBasicMaterial);void 0===l&&(l=new SpriteMaterial);b instanceof THREE.Material&&(delete this.materials[b.uuid],this.traverse(function(e){void 0!==e.material&&e.material.uuid===b.uuid&&(e.material=e instanceof THREE.Sprite?l:h)}))};Program.prototype.addTexture=function(b){this.textures[b.uuid]=b};
Program.prototype.getTextureByName=function(b){for(var h in this.textures.length)if(this.textures[h].name===b)return this.textures[h];return null};
Program.prototype.removeTexture=function(b,h){void 0===h&&(h=new THREE.Texture);b instanceof THREE.Texture&&(delete this.textures[b.uuid],this.traverse(l=>{void 0!==l.material?(l=l.material,null!=l.map&&l.map.uuid===b.uuid?(l.map=h,l.needsUpdate=!0):null!=l.bumpMap&&l.bumpMap.uuid===b.uuid?(l.bumpMap=h,l.needsUpdate=!0):null!=l.normalMap&&l.normalMap.uuid===b.uuid?(l.normalMap=h,l.needsUpdate=!0):null!=l.displacementMap&&l.displacementMap.uuid===b.uuid?(l.displacementMap=h,l.needsUpdate=!0):null!=
l.specularMap&&l.specularMap.uuid===b.uuid?(l.specularMap=h,l.needsUpdate=!0):null!=l.emissiveMap&&l.emissiveMap.uuid===b.uuid?(l.emissiveMap=h,l.needsUpdate=!0):null!=l.alphaMap&&l.alphaMap.uuid===b.uuid?(l.alphaMap=h,l.needsUpdate=!0):null!=l.roughnessMap&&l.roughnessMap===b.uuid?(l.roughnessMap=h,l.needsUpdate=!0):null!=l.metalnessMap&&l.metalnessMap&&(l.metalnessMap=h,l.needsUpdate=!0)):l instanceof ParticleEmitter&&l.group.texture.uuid===b.uuid&&(l.group.texture=h)}))};
Program.prototype.getFontByName=function(b){for(var h in this.fonts)if(this.fonts[h],b===b)return this.fonts[h];return null};Program.prototype.addFont=function(b){b instanceof Font&&(this.fonts[b.uuid]=b)};Program.prototype.removeFont=function(b,h){void 0===h&&(h=new Font);b instanceof Font&&(delete this.fonts[b.uuid],this.traverse(l=>{void 0!==l.font&&l.font.uuid===b.uuid&&l.setFont(h)}))};
Program.prototype.getAudioByName=function(b){for(var h in this.audio)if(this.audio[h].name===b)return this.audio[h];return null};Program.prototype.addAudio=function(b){b instanceof Audio&&(this.audio[b.uuid]=b)};Program.prototype.removeAudio=function(b,h){void 0===h&&(h=new Audio);b instanceof Audio&&(delete this.audio[b.uuid],this.traverse(l=>{}))};Program.prototype.addObject=function(b){this.asset_objects[b.uuid]=b};
Program.prototype.addFolder=function(b){b instanceof Folder&&(this.folders[b.uuid]=b)};
Program.prototype.removeFolder=function(b){if(b instanceof Folder){delete this.folders[b.uuid];b=b.path+b.name+"/";for(var h in this.materials)this.materials[h].path===b&&(this.materials[h].path="/");for(h in this.textures)this.textures[h].path===b&&(this.textures[h].path="/");for(h in this.fonts)this.fonts[h].path===b&&(this.fonts[h].path="/");for(h in this.asset_objects)this.asset_objects[h].path===b&&(this.asset_objects[h].path="/");for(h in this.audio)this.audio[h].path===b&&(this.audio[h].path=
"/")}};Program.prototype.getAssetObjectByname=function(b){for(var h in this.asset_objects.length)if(this.asset_objects[h].name===b)return this.asset_objects[h];return null};Program.prototype.removeObject=function(b){b instanceof THREE.Object3D&&delete this.asset_objects[b.uuid]};Program.prototype.setScene=function(b){b instanceof Scene?this.scene=b:"string"===typeof b&&(this.scene=this.getObjectByName(b));null!==this.scene&&(this.scene.initialize(),0===this.scene.cameras.length&&this.scene.cameras.push(this.default_camera))};
Program.prototype.remove=function(b){var h=this.children.indexOf(b);-1<h&&(this.children.splice(h,1),b.parent=null);0===this.children.length&&(this.scene=null)};Program.prototype.add=function(b){b instanceof Scene&&(this.children.push(b),b.parent=this,1===this.children.length&&(this.scene=this.children[0]))};Program.prototype.clone=function(){return(new ObjectLoader).parse(this.toJSON())};Program.prototype.setInitialScene=function(b){this.default_scene=b.uuid};
Program.prototype.addDefaultScene=function(b){void 0===b&&(b=new MeshStandardMaterial({roughness:.6,metalness:.2}),b.name="default");var h=new Scene,l=new Sky;l.auto_update=!1;h.add(l);l=new THREE.BoxBufferGeometry(1,1,1);var e=new Mesh(l,b);e.scale.set(4,4,4);e.position.set(0,1.5,0);e.receiveShadow=!0;e.castShadow=!0;e.name="box";h.add(e);e=new Mesh(l,b);e.scale.set(40,2,40);e.position.set(0,-1.5,0);e.receiveShadow=!0;e.castShadow=!0;e.name="ground";h.add(e);this.add(h)};
Program.prototype.dispose=function(){for(var b=0;b<this.materials.length;b++)this.materials[b].dispose();for(b=0;b<this.textures.length;b++)this.textures[b].dispose();for(b=0;b<this.children.length;b++)this.children[b].dispose()};
Program.prototype.toJSON=function(b,h){var l=this;b=THREE.Object3D.prototype.toJSON.call(this,b,function(r,q){if(!1!==h){q=l.textures;for(var k in q){var t=q[k];void 0===r.textures[t.uuid]&&(r.textures[t.uuid]=t.toJSON(r))}q=l.materials;for(k in q)t=q[k],void 0===r.materials[t.uuid]&&(r.materials[t.uuid]=t.toJSON(r));q=l.fonts;for(k in q)t=q[k],void 0===r.fonts[t.uuid]&&(r.fonts[t.uuid]=t.toJSON(r));t=l.asset_objects;for(k in t)q=t[k],void 0===r.asset_objects[q.uuid]&&(r.asset_objects[q.uuid]=q.toJSON(r));
q=l.audio;for(k in q)t=q[k],void 0===r.audio[t.uuid]&&(r.audio[t.uuid]=t.toJSON(r))}});b.object.author=this.author;b.object.description=this.description;b.object.version=this.version;b.object.lock_pointer=this.lock_pointer;b.object.folders=[];for(var e in this.folders)b.object.folders.push(this.folders[e].toJSON());b.object.vr=this.vr;b.object.vr_scale=this.vr_scale;null!==this.default_scene&&(b.object.default_scene=this.default_scene);return b};
function Scene(){THREE.Scene.call(this);this.name="scene";this.matrixAutoUpdate=!1;this.world=new CANNON.World;this.world.defaultContactMaterial.contactEquationStiffness=1E9;this.world.defaultContactMaterial.contactEquationRelaxation=4;this.world.quatNormalizeSkip=0;this.world.quatNormalizeFast=!1;this.world.gravity.set(0,-9.8,0);this.world.broadphase=new CANNON.NaiveBroadphase;this.world.solver=new CANNON.SplitSolver(new CANNON.GSSolver);this.world.solver.tolerance=.1;this.world.solver.iterations=
7;this.clock=new THREE.Clock;this.raycaster=new THREE.Raycaster;this.cameras=[];this.canvas=null;this.mouse=new Vector2(0,0);this.components=[];this.defaultComponents=[];this.defaultComponents.push(new SceneComponent)}Scene.prototype=Object.create(THREE.Scene.prototype);Scene.prototype.initialize=function(){this.canvas=this.parent.canvas;this.clock.start();for(var b=0;b<this.children.length;b++)this.children[b].initialize()};
Scene.prototype.update=function(){this.mouse.set(Mouse.position.x/this.canvas.width*2-1,-2*Mouse.position.y/this.canvas.height+1);0<this.cameras.length&&this.raycaster.setFromCamera(this.mouse,this.cameras[0]);var b=this.clock.getDelta();this.world.step(.05>b?b:.05);for(b=0;b<this.children.length;b++)this.children[b].update()};Scene.prototype.getCamera=function(b,h){void 0===h&&(h=this);if(b===h.uuid)return h;h=h.children;for(var l=0;l<h.length;l++){var e=this.getCamera(b,h[l]);if(null!==e)return e}return null};
Scene.prototype.addCamera=function(b){this.cameras.push(b)};Scene.prototype.removeCamera=function(b){b=this.cameras.indexOf(b);-1<b&&this.cameras.splice(b,1)};Scene.prototype.setFogMode=function(b){var h=null!==this.fog?this.fog.color.getHex():"#FFFFFF";b===THREE.Fog.LINEAR?this.fog=new THREE.Fog(h,5,20):b===THREE.Fog.EXPONENTIAL?this.fog=new THREE.FogExp2(h,.01):b===THREE.Fog.NONE&&(this.fog=null)};
Scene.prototype.toJSON=function(b){b=THREE.Scene.prototype.toJSON.call(this,b);null!==this.background&&(b.object.background=this.background);b.object.cameras=[];for(var h=0;h<this.cameras.length;h++)b.object.cameras.push(this.cameras[h].uuid);b.object.world={};b.object.world.gravity=this.world.gravity;b.object.world.quatNormalizeSkip=this.world.quatNormalizeSkip;b.object.world.quatNormalizeFast=this.world.quatNormalizeFast;b.object.world.solver={};b.object.world.solver.tolerance=this.world.solver.tolerance;
b.object.world.solver.iterations=this.world.solver.iterations;return b};function ObjectCaller(b,h){THREE.Object3D.call(this);this.name="caller";this.type="ObjectCaller";this.obj=null;this.obj_uuid=void 0===b?null:b;this.obj_type=void 0===h?null:h;this.program=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}ObjectCaller.prototype=Object.create(THREE.Object3D.prototype);
ObjectCaller.prototype.initialize=function(){this.program=void 0!==Editor.program_running&&null!==Editor.program_running?Editor.program_running:Main.program;null!==this.obj_uuid&&void 0!==this.program.asset_objects[this.obj_uuid]&&(this.obj=this.program.asset_objects[this.obj_uuid],this.obj.initialize());for(var b=0;b<this.children.length;b++)this.children[b].initialize()};ObjectCaller.prototype.update=function(){if(null!==this.obj){this.obj.update();for(var b=0;b<this.children.length;b++)this.children[b].update()}};
ObjectCaller.prototype.dispose=function(){if(null!==this.obj){this.obj.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()}};ObjectCaller.prototype.setObject=function(b){this.obj_uuid=b.uuid;this.name=b.name;this.obj_type=b.type};ObjectCaller.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.obj_uuid=this.obj_uuid;b.object.obj_type=this.obj_type;return b};function Base64Utils(){}
Base64Utils.removeHeader=function(b){return b.slice(b.search(";base64")+8)};
Base64Utils.fromArrayBuffer=function(b){var h="";b=new Uint8Array(b);for(var l=b.byteLength%3,e=b.byteLength-l,r,q,k,t,p=0;p<e;p+=3)t=b[p]<<16|b[p+1]<<8|b[p+2],r=(t&16515072)>>18,q=(t&258048)>>12,k=(t&4032)>>6,t&=63,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[r]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[k]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t];1===
l?(t=b[e],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&3)<<4]+"=="):2===l&&(t=b[e]<<8|b[e+1],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&15)<<2]+"=");return h};
Base64Utils.fromBinaryString=function(b){var h="",l=b.length%3,e=b.length-l,r;for(r=0;r<e;r+=3){var q=b.charCodeAt(r)&255;var k=b.charCodeAt(r+1);var t=b.charCodeAt(r+2);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>2);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((q&3)<<4|(k&240)>>4);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((k&15)<<2|(t&192)>>6);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t&
63)}1===l?(q=b.charCodeAt(r)&255,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>2),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((q&3)<<4),h+="=="):2===l&&(q=b.charCodeAt(r)&255,k=b.charCodeAt(r+1),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>2),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((q&3)<<4)|(k&&240)>>4,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((k&
15)<<2),h+="==");return h};function ArraybufferUtils(){}ArraybufferUtils.fromBinaryString=function(b){for(var h=b.length,l=new ArrayBuffer(h),e=new Uint8Array(l),r=0;r<h;r++)e[r]=b.charCodeAt();return l};
ArraybufferUtils.fromBase64=function(b){for(var h=b.length/4*3,l=new ArrayBuffer(h),e=new Uint8Array(l),r,q,k,t,p=0,y=0;p<h;p+=3)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),e[p]=
r<<2|q>>4,64!==k&&(e[p+1]=(q&15)<<4|k>>2),64!==t&&(e[p+2]=(k&3)<<6|t);return l};ArraybufferUtils.fromBuffer=function(b){for(var h=new ArrayBuffer(b.length),l=new Uint8Array(h),e=0;e<b.length;e++)l[e]=b[e];return h};function MathUtils(){}MathUtils.pi2=2*Math.PI;MathUtils.pid2=Math.PI/2;function ObjectUtils(){}ObjectUtils.getFonts=function(b,h){void 0===h&&(h=[]);b.traverse(l=>{l.font instanceof Font&&void 0===h[l.font.uuid]&&(h[l.font.uuid]=l.font)});return h};
ObjectUtils.getAudio=function(b,h){void 0===h&&(h=[]);b.traverse(l=>{l.audio instanceof Audio&&void 0===h[l.audio.uuid]&&(h[l.audio.uuid]=l.audio)});return h};
ObjectUtils.getMaterials=function(b,h){function l(e){void 0===h[e.uuid]&&(h[e.uuid]=e)}void 0===h&&(h=[]);b.traverse(e=>{if(!(void 0===e.material||e.hidden||e instanceof Sky||e instanceof SpineAnimation)){if(e.material instanceof THREE.Material)l(e.material);else if(e.material instanceof THREE.MultiMaterial)for(var r=e.material.materials,q=0;q<r.length;q++)l(r[q]);if(void 0!==e.materials)for(q=0;q<e.materials.length;i++)l(e.materials[q])}});return h};
ObjectUtils.getTextures=function(b,h){function l(r){e(r.map);e(r.bumpMap);e(r.normalMap);e(r.displacementMap);e(r.specularMap);e(r.emissiveMap);e(r.alphaMap);e(r.roughnessMap);e(r.metalnessMap)}function e(r){null!=r&&void 0===h[r.uuid]&&(h[r.uuid]=r)}void 0===h&&(h=[]);b.traverse(r=>{if(void 0!==r.material)if(r.material instanceof THREE.Material)l(r.material);else{if(r.material instanceof THREE.MultiMaterial){r=r.material.materials;for(var q=0;q<r.length;q++)l(r[q])}}else r instanceof ParticleEmitter&&
e(r.group.texture)});return h};ObjectUtils.getScene=function(b){for(;null!==b.parent;)if(b=b.parent,b instanceof Scene)return b;return null};ObjectUtils.getRoot=function(b){for(;null!==b.parent;)b=b.parent;return b};ObjectUtils.setMatrixAutoUpdate=function(b,h){b.traverse(l=>{l.matrixAutoUpdate=h})};ObjectUtils.setShadowReceiving=function(b,h){b.traverse(l=>{l.receiveShadow=h})};ObjectUtils.setShadowCasting=function(b,h){b.traverse(l=>{l.castShadow=h})};
ObjectUtils.isChildOf=function(b,h){for(var l=0;l<b.children.length;l++)if(b.children[l]===h||ObjectUtils.isChildOf(b.children[l],h))return!0;return!1};function BufferUtils(){}BufferUtils.fromArrayBuffer=function(b){var h=new Buffer(b.byteLength);b=new Uint8Array(b);for(var l=0;l<h.length;l++)h[l]=b[l];return h};function MeshBasicMaterial(b){THREE.MeshBasicMaterial.call(this,b);this.path="/"}MeshBasicMaterial.prototype=Object.create(THREE.MeshBasicMaterial.prototype);
MeshBasicMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshLambertMaterial(b){THREE.MeshLambertMaterial.call(this,b);this.path="/"}MeshLambertMaterial.prototype=Object.create(THREE.MeshLambertMaterial.prototype);MeshLambertMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};
function MeshNormalMaterial(b){THREE.MeshNormalMaterial.call(this,b);this.path="/"}MeshNormalMaterial.prototype=Object.create(THREE.MeshNormalMaterial.prototype);MeshNormalMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshPhongMaterial(b){THREE.MeshPhongMaterial.call(this,b);this.path="/"}MeshPhongMaterial.prototype=Object.create(THREE.MeshPhongMaterial.prototype);
MeshPhongMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshShaderMaterial(b){THREE.ShaderMaterial.call(this,b);this.path="/"}MeshShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);MeshShaderMaterial.prototype.toJSON=function(b){b=THREE.ShaderMaterial.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};
function MeshStandardMaterial(b){THREE.MeshStandardMaterial.call(this,b);this.path="/"}MeshStandardMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);MeshStandardMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshToonMaterial(b){THREE.MeshToonMaterial.call(this,b);this.path="/"}MeshToonMaterial.prototype=Object.create(THREE.MeshToonMaterial.prototype);
MeshToonMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function SpriteMaterial(b){THREE.SpriteMaterial.call(this,b);this.path="/"}SpriteMaterial.prototype=Object.create(THREE.SpriteMaterial.prototype);SpriteMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};
function Panel(b){this.parent=void 0!==b?b:document.body;Panel.id++;this.element=document.createElement("div");this.element.style.position="absolute";this.element.style.overflow="auto";this.element.style.cursor="default";this.element.style.backgroundColor=Editor.theme.panel_color;this.element.ondrop=function(h){h.preventDefault()};this.element.ondragover=function(h){h.preventDefault()};this.components=[];this.children_pos=new THREE.Vector2(5,10);this.fit_parent=!0;this.size=new THREE.Vector2(0,0);
this.position=new THREE.Vector2(0,0);this.visible=!0;this.obj=null;this.parent.appendChild(this.element)}Panel.id=0;Panel.prototype.updatePanel=function(){if(null!==this.obj)for(var b=0;b<this.components.length;b++)this.components[b].updateData&&this.components[b].updateData(this.obj)};
Panel.prototype.attachObject=function(b){if(b instanceof THREE.Object3D){this.obj=b;this.updateComponents();var h=this;this.add=new Button(this.element);this.add.setText("Add Component");this.add.setCallback(l=>{var e=new ContextMenu;e.size.set(130,20);var r=App.componentManager.length;e.position.set(l.clientX-5,event.clientY-10*r);for(l=0;l<r;l++){var q=App.componentManager[l];e.addOption(q.component_name,()=>{var k=!1;h.obj.components.includes(q)&&(k=!0);k||(h.obj.components.push(q),h.obj.components[h.obj.components.length-
1].onCreate(h.obj),h.updateComponents())})}});this.add.updateInterface();this.updateInterface();this.updatePanel()}};
Panel.prototype.updateComponents=function(){if(void 0!==this.obj.components&&void 0!==this.obj.defaultComponents){this.components=this.obj.defaultComponents.concat(this.obj.components);this.children_pos.equals(new THREE.Vector2(5,10))||this.children_pos.set(5,10);for(var b=0;b<this.components.length;b++)this.element.appendChild(this.components[b].initUI(this.children_pos,this.obj)),this.children_pos.y+=10;this.updatePanel();this.updateInterface()}};Panel.prototype.destroy=function(){try{this.parent.removeChild(this.element)}catch(b){}};
Panel.prototype.update=function(){};
Panel.prototype.updateInterface=function(){this.fit_parent&&(this.size.x=this.parent.offsetWidth,this.size.y=this.parent.offsetHeight);for(var b=0;b<this.components.length;b++)this.components[b].updateInterface();this.element.style.visiblility=this.visible?"visible":"hidden";void 0!==this.add&&(this.add.size.set(this.size.x-30,20),this.add.position.copy(this.children_pos),this.add.updateInterface());this.element.style.top=this.position.y+"px";this.element.style.left=this.position.x+"px";this.element.style.width=
this.size.x+"px";this.element.style.height=this.size.y+"px"};function Component(){this.values={};this.obj=null;this.element=document.createElement("div");this.className=this.component_name="";this.widgetsPos=new THREE.Vector2}Component.prototype.clearElement=function(){if(0<this.element.children.length){var b=new Range;b.selectNodeContents(this.element);b.deleteContents()}};
Component.prototype.addDeleteButton=function(){var b=this;this.delete=new Button(this.element);this.delete.setText("Delete Component");this.delete.size.set(120,20);this.delete.position.copy(this.widgetsPos);this.delete.updateInterface();this.delete.setCallback(()=>{b.onDelete()});this.widgetsPos.y+=this.delete.size.y};
Component.prototype.addResetButton=function(){var b=this;this.reset=new Button(this.element);this.reset.setText("Reset Defaults");this.reset.size.set(100,20);this.reset.position.copy(this.widgetsPos);this.reset.updateInterface();this.reset.setCallback(()=>{b.onReset()});this.widgetsPos.y+=this.reset.size.y};Component.prototype.onDelete=function(){};Component.prototype.onReset=function(){};Component.prototype.onCreate=function(){};Component.prototype.initialize=function(){};
Component.prototype.update=function(){};Component.prototype.updateInterface=function(){this.element.style.width=this.form.size.x+"px";this.form.updateInterface()};Component.prototype.toJSON=function(){var b={};b.name=this.component_name;b.className=this.className;b.values=this.values;return b};function AudioComponent(){Component.call(this);this.component_name="Audio";this.className="AudioComponent";this.values={autoplay:!0,loop:!0,playbackRate:1}}AudioComponent.prototype=Object.create(Component.prototype);
AudioComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.autoplay=new CheckBox(this.form.element);this.autoplay.setText("Autoplay");this.autoplay.size.set(150,15);this.autoplay.setOnChange(()=>{null!==l.obj&&(l.obj.autoplay=l.autoplay.getValue())});this.form.add(this.autoplay);this.form.nextRow();this.loop=new CheckBox(this.form.element);
this.loop.setText("Loop");this.loop.size.set(150,15);this.loop.setOnChange(()=>{null!==l.obj&&(l.obj.loop=l.loop.getValue())});this.form.add(this.loop);this.form.nextRow();this.form.addText("Playback Speed");this.playbackRate=new NumberBox(this.form.element);this.playbackRate.size.set(60,18);this.playbackRate.setStep(.01);this.playbackRate.setRange(0,Number.MAX_SAFE_INTEGER);this.playbackRate.setOnChange(()=>{null!==l.obj&&(l.obj.playbackRate=l.playbackRate.getValue())});this.form.add(this.playbackRate);
this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton(this.onReset);return this.element};AudioComponent.prototype.updateData=function(){this.autoplay.setValue(this.obj.autoplay);this.loop.setValue(this.obj.loop);this.playbackRate.setValue(this.obj.playbackRate)};
AudioComponent.prototype.onReset=function(){this.obj.autoplay=this.values.autoplay;this.obj.loop=this.values.loop;this.obj.playbackRate=this.values.playbackRate;Editor.updateObjectViews();this.updateData()};function ElementComponent(){Component.call(this);this.component_name="Element";this.className="ElementComponent";this.values={name:"object",position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0),scale:new THREE.Vector3(1,1,1)}}ElementComponent.prototype=Object.create(Component.prototype);
ElementComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==l.obj&&(l.obj.name=l.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();this.form.addText("UUID");this.uuid=
new TextBox(this.form.element);this.uuid.size.set(248,18);this.uuid.setDisabled(!0);this.form.add(this.uuid);this.form.nextRow();this.form.addText("Type");this.type=this.form.addText("null");this.form.nextRow();this.form.addText("Position");this.position=new CoordinatesBox(this.form.element);this.position.setStep(.01);this.position.setOnChange(()=>{if(null!==l.obj){var e=l.position.getValue();l.obj.position.set(e.x,e.y,e.z)}});this.form.add(this.position);this.form.nextRow();this.form.addText("Rotation");
this.rotation=new CoordinatesBox(this.form.element);this.rotation.setStep(.01);this.rotation.setOnChange(()=>{if(null!==l.obj){var e=l.rotation.getValue();l.obj.rotation.set(e.x,e.y,e.z)}});this.form.add(this.rotation);this.form.nextRow();this.form.addText("Scale");this.scale=new CoordinatesBox(this.form.element);this.scale.setStep(.01);this.scale.setOnChange(()=>{if(null!==l.obj){var e=l.scale.getValue();l.obj.scale.set(e.x,e.y,e.z);if(l.obj instanceof PhysicsObject)for(var r=l.obj.body.shapes,q=
0;q<r.length;q++){var k=r[q];k.type===CANNON.Shape.types.BOX?(k.halfExtents.x=e.x/2,k.halfExtents.y=e.y/2,k.halfExtents.z=e.z/2):k.type===CANNON.Shape.types.SPHERE&&(k.radius=e.x)}}});this.form.add(this.scale);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ElementComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.uuid.setText(this.obj.uuid);this.position.setValue(this.obj.position.x,this.obj.position.y,this.obj.position.z);this.rotation.setValue(this.obj.rotation.x,this.obj.rotation.y,this.obj.rotation.z);this.scale.setValue(this.obj.scale.x,this.obj.scale.y,this.obj.scale.z);this.type.setText(this.obj.type)};
ElementComponent.prototype.onReset=function(){this.obj.position.set(this.values.position.x,this.values.position.y,this.values.position.z);this.obj.rotation.set(this.values.rotation.x,this.values.rotation.y,this.values.rotation.z);this.obj.scale.set(this.values.scale.x,this.values.scale.y,this.values.scale.z);Editor.updateObjectViews();this.updateData()};
function ObjectComponent(){Component.call(this);this.component_name="Object 3D";this.className="ObjectComponent";this.values={visible:!0,static:!1,castShadow:!0,receiveShadow:!0}}ObjectComponent.prototype=Object.create(Component.prototype);
ObjectComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.visible=new CheckBox(this.form.element);this.visible.setText("Visible");this.visible.size.set(200,15);this.visible.setOnChange(()=>{null!==l.obj&&(l.obj.visible=l.visible.getValue())});this.form.add(this.visible);this.form.nextRow();this.static=new CheckBox(this.form.element);
this.static.setText("Static Object");this.static.size.set(200,15);this.static.setOnChange(()=>{null!==l.obj&&(l.obj.matrixAutoUpdate=!l.static.getValue())});this.form.add(this.static);this.form.nextRow();this.cast_shadow=new CheckBox(this.form.element);this.cast_shadow.setText("Cast Shadow");this.cast_shadow.size.set(200,15);this.cast_shadow.setOnChange(()=>{null!==l.obj&&(l.obj.castShadow=l.cast_shadow.getValue())});this.form.add(this.cast_shadow);this.form.nextRow();this.receive_shadow=new CheckBox(this.form.element);
this.receive_shadow.setText("Receive Shadow");this.receive_shadow.size.set(200,15);this.receive_shadow.setOnChange(()=>{null!==l.obj&&(l.obj.receiveShadow=l.receive_shadow.getValue())});this.form.add(this.receive_shadow);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ObjectComponent.prototype.updateData=function(){this.visible.setValue(this.obj.visible);this.static.setValue(!this.obj.matrixAutoUpdate);this.cast_shadow.setValue(this.obj.castShadow);this.receive_shadow.setValue(this.obj.receiveShadow)};ObjectComponent.prototype.onReset=function(){this.obj.visible=this.values.visible;this.obj.matrixAutoUpdate=!this.values.static;this.obj.castShadow=this.values.castShadow;this.obj.receiveShadow=this.values.receiveShadow;this.updateData()};
function PhysicsComponent(){Component.call(this);this.component_name="Physics";this.className="PhysicsComponent";this.values={type:1,mass:1,linearDamping:.01,angularDamping:.01,allowSleep:!0,sleepSpeedLimit:.1,sleepTimeLimit:1,fixedRotation:!1,collisionFilterGroup:1}}PhysicsComponent.prototype=Object.create(Component.prototype);
PhysicsComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Type");this.type=new DropdownList(this.form.element);this.type.size.set(100,20);this.type.addValue("Static",CANNON.Body.STATIC);this.type.addValue("Dynamic",CANNON.Body.DYNAMIC);this.type.addValue("Kinematic",CANNON.Body.KINEMATIC);this.type.setOnChange(()=>
{null!==l.obj&&(l.obj.body.type=l.type.getValue())});this.form.add(this.type);this.form.nextRow();this.form.addText("Mass");this.mass=new NumberBox(this.form.element);this.mass.size.set(80,18);this.mass.setStep(.1);this.mass.setOnChange(()=>{null!==l.obj&&(l.obj.body.mass=l.mass.getValue())});this.form.add(this.mass);this.form.nextRow();this.form.addText("Linear Damping");this.linearDamping=new NumberBox(this.form.element);this.linearDamping.size.set(80,18);this.linearDamping.setStep(.01);this.linearDamping.setRange(0,
1);this.linearDamping.setOnChange(()=>{null!==l.obj&&(l.obj.body.linearDamping=l.linearDamping.getValue())});this.form.add(this.linearDamping);this.form.nextRow();this.form.addText("Angular Damping");this.angularDamping=new NumberBox(this.form.element);this.angularDamping.size.set(80,18);this.angularDamping.setStep(.01);this.angularDamping.setRange(0,1);this.angularDamping.setOnChange(()=>{null!==l.obj&&(l.obj.body.angularDamping=l.angularDamping.getValue())});this.form.add(this.angularDamping);this.form.nextRow();
this.allowSleep=new CheckBox(this.form.element);this.allowSleep.setText("Allow Sleep");this.allowSleep.size.set(150,15);this.allowSleep.setOnChange(()=>{null!==l.obj&&(l.obj.body.allowSleep=l.allowSleep.getValue())});this.form.add(this.allowSleep);this.form.nextRow();this.form.addText("Sleep Speed Limit");this.sleepSpeedLimit=new NumberBox(this.form.element);this.sleepSpeedLimit.size.set(80,18);this.sleepSpeedLimit.setStep(.01);this.sleepSpeedLimit.setOnChange(()=>{null!==l.obj&&(l.obj.body.sleepSpeedLimit=
l.sleepSpeedLimit.getValue())});this.form.add(this.sleepSpeedLimit);this.form.nextRow();this.form.addText("Sleep Time Limit");this.sleepTimeLimit=new NumberBox(this.form.element);this.sleepTimeLimit.size.set(80,18);this.sleepTimeLimit.setStep(.01);this.sleepTimeLimit.setOnChange(()=>{null!==l.obj&&(l.obj.body.sleepTimeLimit=l.sleepTimeLimit.getValue())});this.form.add(this.sleepTimeLimit);this.form.nextRow();this.fixedRotation=new CheckBox(this.form.element);this.fixedRotation.setText("Fixed Rotation");
this.fixedRotation.size.set(150,15);this.fixedRotation.setOnChange(()=>{null!==l.obj&&(l.obj.body.fixedRotation=l.fixedRotation.getValue())});this.form.add(this.fixedRotation);this.form.nextRow();this.form.addText("Collision Group");this.collisionFilterGroup=new NumberBox(this.form.element);this.collisionFilterGroup.size.set(80,18);this.collisionFilterGroup.setStep(1);this.collisionFilterGroup.setOnChange(()=>{null!==l.obj&&(l.obj.body.collisionFilterGroup=l.collisionFilterGroup.getValue())});this.form.add(this.collisionFilterGroup);
this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
PhysicsComponent.prototype.updateData=function(){this.type.setValue(this.obj.body.type);this.mass.setValue(this.obj.body.mass);this.linearDamping.setValue(this.obj.body.linearDamping);this.angularDamping.setValue(this.obj.body.angularDamping);this.allowSleep.setValue(this.obj.body.allowSleep);this.sleepTimeLimit.setValue(this.obj.body.sleepTimeLimit);this.sleepSpeedLimit.setValue(this.obj.body.sleepSpeedLimit);this.fixedRotation.setValue(this.obj.body.fixedRotation);this.collisionFilterGroup.setValue(this.obj.body.collisionFilterGroup)};
PhysicsComponent.prototype.onReset=function(){this.obj.body.type=this.values.type;this.obj.body.mass=this.values.mass;this.obj.body.linearDamping=this.values.linearDamping;this.obj.body.angularDamping=this.values.angularDamping;this.obj.body.allowSleep=this.values.allowSleep;this.obj.body.sleepTimeLimit=this.values.sleepTimeLimit;this.obj.body.sleepSpeedLimit=this.values.sleepSpeedLimit;this.obj.body.fixedRotation=this.values.fixedRotation;this.obj.body.collisionFilterGroup=this.values.collisionFilterGroup;
Editor.updateObjectViews();this.updateData()};function ProgramComponent(){Component.call(this);this.component_name="Program";this.className="ProgramComponent";this.values={name:"program",author:"",version:"0",lock_pointer:!1,vr:!1,vr_scale:1}}ProgramComponent.prototype=Object.create(Component.prototype);
ProgramComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==l.obj&&(l.obj.name=l.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);
this.form.nextRow();this.form.addText("Author");this.author=new TextBox(this.form.element);this.author.position.set(50,35);this.author.size.set(200,18);this.author.updateInterface();this.author.setOnChange(()=>{null!==l.obj&&(l.obj.author=l.author.getText())});this.form.add(this.author);this.form.nextRow();this.form.addText("Version");this.version=new TextBox(this.form.element);this.version.size.set(100,18);this.version.setOnChange(()=>{null!==l.obj&&(l.obj.version=l.version.getText())});this.form.add(this.version);
this.form.nextRow();this.lock_pointer=new CheckBox(this.form.element);this.lock_pointer.setText("Lock Pointer");this.lock_pointer.size.set(50,15);this.lock_pointer.setOnChange(()=>{null!==l.obj&&(l.obj.lock_pointer=l.lock_pointer.getValue())});this.form.add(this.lock_pointer);this.form.nextRow();this.form.addText("Virtual Reality");this.form.nextRow();this.vr=new CheckBox(this.form.element);this.vr.setText("VR Enabled");this.vr.size.set(50,15);this.vr.setOnChange(()=>{null!==l.obj&&(l.obj.vr=l.vr.getValue())});
this.form.add(this.vr);this.form.nextRow();this.form.addText("VR Movement Scale");this.vr_scale=new NumberBox(this.form.element);this.vr_scale.size.set(50,18);this.vr_scale.setRange(0,1E3);this.vr_scale.setStep(.05);this.vr_scale.setOnChange(()=>{null!==l.obj&&(l.obj.vr_scale=l.vr_scale.getValue())});this.form.add(this.vr_scale);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ProgramComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.author.setText(this.obj.author);this.version.setText(this.obj.version);this.lock_pointer.setValue(this.obj.lock_pointer);this.vr.setValue(this.obj.vr);this.vr_scale.setValue(this.obj.vr_scale)};
ProgramComponent.prototype.onReset=function(){this.obj.name=this.values.name;this.obj.author=this.values.author;this.obj.version=this.values.version;this.obj.lock_pointer=this.values.lock_pointer;this.obj.vr=this.values.vr;this.obj.vr_scale=this.values.vr_scale;Editor.updateObjectViews();this.updateData()};function SceneComponent(){Component.call(this);this.component_name="Scene";this.className="SceneComponent";this.values={name:"scene",default:!1,background:[0,0,0],fog:THREE.Fog.NONE}}
SceneComponent.prototype=Object.create(Component.prototype);
SceneComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==l.obj&&(l.obj.name=l.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();this.default=new CheckBox(this.form.element);
this.default.setText("Default Scene");this.default.size.set(200,15);this.default.setOnChange(()=>{if(null!==l.obj){var e=l.obj.parent;l.default.getValue()?e.default_scene=l.obj.uuid:e.default_scene=null}});this.form.add(this.default);this.form.nextRow();this.form.addText("Background");this.background=new ColorChooser(this.form.element);this.background.size.set(80,18);this.background.setValue(0,0,0);this.background.setOnChange(()=>{null!==l.obj&&(null===l.obj.background&&(l.obj.background=new THREE.Color),
l.obj.background.setHex(l.background.getValueHex()))});this.form.add(this.background);this.form.nextRow();this.form.addText("Fog");this.fog=new DropdownList(this.form.element);this.fog.size.set(100,20);this.fog.addValue("None",THREE.Fog.NONE);this.fog.addValue("Linear",THREE.Fog.LINEAR);this.fog.addValue("Exponential",THREE.Fog.EXPONENTIAL);this.fog.setOnChange(()=>{null!==l.obj&&(l.obj.setFogMode(l.fog.getSelectedIndex()),l.updateData())});this.form.add(this.fog);this.form.nextRow();this.form.addText("Fog Settings");
this.form.nextRow();this.fog_linear_form=new Form(this.form.element);this.fog_linear_form.spacing.set(5,5);this.fog_linear_form.addText("Linear Fog");this.fog_linear_form.nextRow();this.fog_linear_form.addText("Colour");this.fog_linear_colour=new ColorChooser(this.fog_linear_form.element);this.fog_linear_colour.size.set(80,18);this.fog_linear_colour.setOnChange(()=>{if(null!==l.obj){var e=l.fog_linear_colour.getValueHex();l.obj.fog.color.setHex(e)}});this.fog_linear_form.add(this.fog_linear_colour);
this.fog_linear_form.nextRow();this.fog_linear_form.addText("Near");this.fog_near=new NumberBox(this.fog_linear_form.element);this.fog_near.size.set(60,18);this.fog_near.setOnChange(()=>{null!==l.obj&&(l.obj.fog.near=l.fog_near.getValue())});this.fog_linear_form.add(this.fog_near);this.fog_linear_form.nextRow();this.fog_linear_form.addText("Far");this.fog_far=new NumberBox(this.fog_linear_form.element);this.fog_far.size.set(60,18);this.fog_far.setOnChange(()=>{null!==l.obj&&(l.obj.fog.far=l.fog_far.getValue())});
this.fog_linear_form.add(this.fog_far);this.fog_linear_form.nextRow();this.fog_linear_form.updateInterface();this.form.add(this.fog_linear_form);this.form.nextRow();this.fog_exponential_form=new Form(this.form.element);this.fog_exponential_form.spacing.set(5,5);this.fog_exponential_form.addText("Exponential Fog");this.fog_exponential_form.nextRow();this.fog_exponential_form.addText("Density");this.fog_density=new NumberBox(this.fog_exponential_form.element);this.fog_density.size.set(100,18);this.fog_density.setStep(1E-4);
this.fog_density.setOnChange(()=>{null!==l.obj&&(l.obj.fog.density=l.fog_density.getValue())});this.fog_exponential_form.add(this.fog_density);this.fog_exponential_form.nextRow();this.fog_exponential_form.updateInterface();this.form.add(this.fog_exponential_form);this.form.nextRow();this.form.addText("Physics World");this.form.nextRow();this.form.addText("Gravity");this.gravity=new CoordinatesBox(this.form.element);this.gravity.setOnChange(()=>{if(null!==l.obj){var e=l.gravity.getValue();l.obj.world.gravity.set(e.x,
e.y,e.z)}});this.form.add(this.gravity);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};SceneComponent.prototype.updateForms=function(){};
SceneComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.default.setValue(this.obj.uuid===this.obj.parent.default_scene);this.obj.fog instanceof THREE.Fog?this.fog.setValue(THREE.Fog.LINEAR):this.obj.fog instanceof THREE.FogExp2?this.fog.setValue(THREE.Fog.EXPONENTIAL):this.fog.setValue(THREE.Fog.NONE);null!==this.obj.fog?(this.fog_linear_colour.setValueHex(this.obj.fog.color.getHex()),this.fog_near.setValue(void 0!==this.obj.fog.near?this.obj.fog.near:0),this.fog_far.setValue(void 0!==
this.obj.fog.far?this.obj.fog.far:0),this.fog_density.setValue(void 0!==this.obj.fog.density?this.obj.fog.density:0)):(this.fog_linear_colour.setValueHex(0),this.fog_near.setValue(0),this.fog_far.setValue(0),this.fog_density.setValue(0));null!==this.obj.background&&this.background.setValue(this.obj.background.r,this.obj.background.g,this.obj.background.b);this.gravity.setValue(this.obj.world.gravity.x,this.obj.world.gravity.y,this.obj.world.gravity.z);this.updateForms()};
SceneComponent.prototype.onReset=function(){this.obj.name=this.values.name;this.obj.default=this.values.default;this.obj.parent.default_scene=null;this.obj.setFogMode(this.values.fog);this.updateData();Editor.updateObjectViews()};function Text3DComponent(){Component.call(this);this.component_name="Text";this.className="Text3DComponent";this.values={text:"text",size:1,curveSegments:15,thickness:.5,bevel:!1,bevelThickness:10,bevelSize:8}}Text3DComponent.prototype=Object.create(Component.prototype);
Text3DComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Text");this.text=new TextBox(this.form.element);this.text.size.set(200,18);this.text.setOnChange(()=>{null!==l.obj&&l.obj.setText(l.text.getText())});this.form.add(this.text);this.form.nextRow();this.form.addText("Size");this.size=new NumberBox(this.form.element);
this.size.size.set(60,18);this.size.setRange(0,Number.MAX_SAFE_INTEGER);this.size.setStep(.1);this.size.setOnChange(()=>{null!==l.obj&&(l.obj.size=l.size.getValue(),l.obj.setText())});this.form.add(this.size);this.form.addText("Thickness");this.height=new NumberBox(this.form.element);this.height.size.set(60,18);this.height.setRange(0,Number.MAX_SAFE_INTEGER);this.height.setStep(.1);this.height.setOnChange(()=>{null!==l.obj&&(l.obj.height=l.height.getValue(),l.obj.setText())});this.form.add(this.height);
this.form.nextRow();this.form.addText("Curve Segments");this.curve_segments=new NumberBox(this.form.element);this.curve_segments.size.set(60,18);this.curve_segments.setRange(0,Number.MAX_SAFE_INTEGER);this.curve_segments.setStep(1);this.curve_segments.setOnChange(()=>{null!==l.obj&&(l.obj.curve_segments=l.curve_segments,l.obj.setText())});this.form.add(this.curve_segments);this.form.nextRow();this.bevel=new CheckBox(this.form.element);this.bevel.setText("Bevel");this.bevel.size.set(200,15);this.bevel.setOnChange(()=>
{null!==l.obj&&(l.obj.bevel=l.bevel.getValue(),l.obj.setText())});this.form.add(this.bevel);this.form.nextRow();this.form.addText("Bevel Thickness");this.bevel_thickness=new NumberBox(this.form.element);this.bevel_thickness.size.set(60,18);this.bevel_thickness.setRange(0,Number.MAX_SAFE_INTEGER);this.bevel_thickness.setStep(.1);this.bevel_thickness.setOnChange(()=>{null!==l.obj&&(l.obj.bevel_thickness=l.bevel_thickness.getValue(),l.obj.setText())});this.form.add(this.bevel_thickness);this.form.nextRow();
this.form.addText("Bevel Size");this.bevel_size=new NumberBox(this.form.element);this.bevel_size.size.set(60,18);this.bevel_size.setRange(0,Number.MAX_SAFE_INTEGER);this.bevel_size.setStep(.1);this.bevel_size.setOnChange(()=>{null!==l.obj&&(l.obj.bevel_size=l.bevel_size.getValue(),l.obj.setText())});this.form.add(this.bevel_size);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
Text3DComponent.prototype.updateData=function(){this.text.setText(this.obj.text);this.size.setValue(this.obj.size);this.height.setValue(this.obj.height);this.curve_segments.setValue(this.obj.curve_segments);this.bevel.setValue(this.obj.bevel);this.bevel_thickness.setValue(this.obj.bevel_thickness);this.bevel_size.setValue(this.obj.bevel_size)};
Text3DComponent.prototype.onReset=function(){this.obj.height=this.values.thickness;this.obj.size=this.values.size;this.obj.curve_segments=this.values.curveSegments;this.obj.bevel=this.values.bevel;this.obj.bevel_thickness=this.values.bevelThickness;this.obj.bevel_size=this.values.bevelSize;this.obj.setText(this.values.text);this.updateData();Editor.updateObjectViews()};
function ScriptComponent(){Component.call(this);this.component_name="Script";this.className="ScriptComponent";this.values={mode:Script.INIT}}ScriptComponent.prototype=Object.create(Component.prototype);
ScriptComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};ScriptComponent.prototype.onReset=function(){this.updateData();Editor.updateObjectViews()};
function KinectComponent(){Component.call(this);this.component_name="Kinect";this.className="KinectComponent";this.values={debugModel:!0}}KinectComponent.prototype=Object.create(Component.prototype);
KinectComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.debug_model=new CheckBox(this.form.element);this.debug_model.setText("Debug model");this.debug_model.size.set(200,15);this.debug_model.setOnChange(()=>{null!==l.obj&&(l.obj.debug_model=l.debug_model.getValue())});this.form.add(this.debug_model);this.form.position.copy(this.widgetsPos);
this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};KinectComponent.prototype.updateData=function(){this.debug_model.setValue(this.obj.debug_model)};KinectComponent.prototype.onReset=function(){this.obj.debug_model=this.values.debugModel;Editor.updateObjectViews();this.updateData()};
function LeapComponent(){Component.call(this);this.component_name="Leap";this.className="LeapComponent";this.values={mode:0,debug_model:!0,gestures_enabled:!0,poses_enabled:!0}}LeapComponent.prototype=Object.create(Component.prototype);
LeapComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Mode");this.mode=new DropdownList(this.form.element);this.mode.size.set(80,18);this.mode.addValue("Desk",Script.INIT);this.mode.addValue("HMD",Script.LOOP);this.mode.setOnChange(()=>{null!==l.obj&&(l.obj.mode=l.mode.getSelectedIndex())});this.form.add(this.mode);
this.form.nextRow();this.debug_model=new CheckBox(this.form.element);this.debug_model.setText("Debug Model");this.debug_model.size.set(200,15);this.debug_model.setOnChange(()=>{null!==l.obj&&(l.obj.debug_model=l.debug_model.getValue())});this.form.add(this.debug_model);this.form.nextRow();this.gestures_enabled=new CheckBox(this.form.element);this.gestures_enabled.setText("Gestures Enabled");this.gestures_enabled.size.set(200,15);this.gestures_enabled.setOnChange(()=>{null!==l.obj&&(l.obj.gestures_enabled=
l.gestures_enabled.getValue())});this.form.add(this.gestures_enabled);this.form.nextRow();this.poses_enabled=new CheckBox(this.form.element);this.poses_enabled.setText("Poses Enabled");this.poses_enabled.size.set(200,15);this.poses_enabled.setOnChange(()=>{null!==l.obj&&(l.obj.poses_enabled=l.poses_enabled.getValue())});this.form.add(this.poses_enabled);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();
return this.element};LeapComponent.prototype.updateData=function(){this.mode.setSelectedIndex(this.obj.mode);this.debug_model.setValue(this.obj.debug_model);this.gestures_enabled.setValue(this.obj.gestures_enabled);this.poses_enabled.setValue(this.obj.poses_enabled)};
LeapComponent.prototype.onReset=function(){this.obj.mode=this.values.mode;this.obj.debug_model=this.values.debug_model;this.obj.gestures_enabled=this.values.gestures_enabled;this.obj.poses_enabled=this.values.poses_enabled;Editor.updateObjectViews();this.updateData()};function CameraComponent(){Component.call(this);this.component_name="Camera";this.className="CameraComponent";this.values={fov:60,default:!1,near:.1,far:1E5,size:3,mode:0,start:[0,0],camSize:[1,1],clearColor:!1,clearDepth:!1}}
CameraComponent.prototype=Object.create(Component.prototype);
CameraComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.obj instanceof PerspectiveCamera?(this.form.addText("FOV"),this.fov=new Slider(this.form.element),this.fov.size.set(160,18),this.fov.setRange(30,160),this.fov.setOnChange(()=>{null!==l.obj&&(l.obj.fov=l.fov.getValue(),l.obj.updateProjectionMatrix())}),this.form.add(this.fov),
this.form.nextRow()):this.obj instanceof OrthographicCamera&&(this.form.addText("Size"),this.size=new NumberBox(this.form.element),this.size.size.set(80,18),this.size.setOnChange(()=>{null!==l.obj&&(l.obj.size=l.size.getValue(),l.obj.updateProjectionMatrix())}),this.form.add(this.size),this.form.nextRow(),this.form.addText("Resize Mode"),this.mode=new DropdownList(this.form.element),this.mode.size.set(130,18),this.mode.addValue("Horizontal",OrthographicCamera.RESIZE_HORIZONTAL),this.mode.addValue("Vertical",
OrthographicCamera.RESIZE_VERTICAL),this.mode.setOnChange(()=>{null!==l.obj&&(l.obj.mode=l.mode.getSelectedIndex())}),this.form.add(this.mode),this.form.nextRow());this.form.addText("Clipping Planes");this.form.nextRow();this.form.addText("Near");this.near=new NumberBox(this.form.element);this.near.size.set(60,18);this.near.setStep(.1);this.near.setRange(0,Number.MAX_SAFE_INTEGER);this.near.setOnChange(()=>{null!==l.obj&&(l.obj.near=l.near.getValue())});this.form.add(this.near);this.form.nextRow();
this.form.addText("Far");this.far=new NumberBox(this.form.element);this.far.size.set(80,18);this.far.setRange(0,Number.MAX_SAFE_INTEGER);this.far.setOnChange(()=>{null!==l.obj&&(l.obj.far=l.far.getValue())});this.form.add(this.far);this.form.nextRow();this.form.addText("Viewport");this.form.nextRow();this.form.addText("Position");this.offset=new CoordinatesBox(this.form.element);this.offset.setMode(CoordinatesBox.VECTOR2);this.offset.setStep(.05);this.offset.size.set(160,20);this.offset.setOnChange(()=>
{null!==l.obj&&l.obj.offset.copy(l.offset.getValue())});this.form.add(this.offset);this.form.nextRow();this.form.addText("Size");this.viewport=new CoordinatesBox(this.form.element);this.viewport.setMode(CoordinatesBox.VECTOR2);this.viewport.setRange(.05);this.viewport.size.set(160,20);this.viewport.setOnChange(()=>{null!==l.obj&&l.obj.viewport.copy(l.viewport.getValue())});this.form.add(this.viewport);this.form.nextRow();this.clear_color=new CheckBox(this.form.element);this.clear_color.setText("Clear colour");
this.clear_color.size.set(200,15);this.clear_color.setOnChange(()=>{null!==l.obj&&(l.obj.clear_color=l.clear_color.getValue())});this.form.add(this.clear_color);this.form.nextRow();this.clear_depth=new CheckBox(this.form.element);this.clear_depth.setText("Clear depth");this.clear_depth.size.set(200,15);this.clear_depth.setOnChange(()=>{null!==l.obj&&(l.obj.clear_depth=l.clear_depth.getValue())});this.form.add(this.clear_depth);this.form.nextRow();this.default=new CheckBox(this.form.element);this.default.setText("Use camera");
this.default.size.set(200,15);this.default.setOnChange(()=>{if(null!==l.obj){var e=ObjectUtils.getScene(l.obj);null!==e&&(l.default.getValue()?e.addCamera(l.obj):e.removeCamera(l.obj))}});this.form.add(this.default);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
CameraComponent.prototype.updateData=function(){this.obj instanceof PerspectiveCamera?this.fov.setValue(this.obj.fov):this.obj instanceof OrthographicCamera&&(this.size.setValue(this.obj.size),this.mode.setSelectedIndex(this.obj.mode));this.near.setValue(this.obj.near);this.far.setValue(this.obj.far);this.offset.setValue(this.obj.offset);this.viewport.setValue(this.obj.viewport);this.clear_color.setValue(this.obj.clear_color);this.clear_depth.setValue(this.obj.clear_depth);this.default.setValue(-1!==
ObjectUtils.getScene(this.obj).cameras.indexOf(this.obj))};
CameraComponent.prototype.onReset=function(){this.obj instanceof PerspectiveCamera?this.obj.fov=this.values.fov:this.obj instanceof OrthographicCamera&&(this.obj.size=this.values.camSize,this.obj.mode=this.values.mode);this.obj.near=this.values.near;this.obj.far=this.values.far;this.obj.offset=new THREE.Vector2(this.values.offset[0],this.values.offset[1]);this.obj.viewport=new THREE.Vector2(this.values.viewport[0],this.values.viewport[1]);this.obj.clear_color=this.values.clearColor;this.obj.clear_depth=
this.values.clearDepth;var b=ObjectUtils.getScene(this.obj);if(null!==b){var h=b.cameras.indexOf(this.obj);-1<h&&b.cameras.splice(h,1)}Editor.updateObjectViews();this.updateData()};function LightComponent(){Component.call(this);this.component_name="Light";this.className="LightComponent";this.values={colour:[.265,.265,.265],castShadow:!0,groundCol:[1,1,1],distance:0,intensity:1,shadow_width:512,shadow_height:512,shadow_near:.01,shadow_far:1E6,angle:1,penumbra:0}}LightComponent.prototype=Object.create(Component.prototype);
LightComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.form.addText("Colour");this.colour=new ColorChooser(this.form.element);this.colour.size.set(80,18);this.colour.setOnChange(()=>{if(null!==l.obj){var e=l.colour.getValue();l.obj.color.setRGB(e.r,e.g,e.b)}});this.form.add(this.colour);this.form.nextRow();this.obj instanceof
HemisphereLight&&(this.form.addText("Ground Colour"),this.groundCol=new ColorChooser(this.form.element),this.groundCol.size.set(80,18),this.groundCol.setOnChange(()=>{if(null!==l.obj){var e=l.groundCol.getValue();l.obj.groundColor.setRGB(e.r,e.g,e.b)}}),this.form.add(this.groundCol),this.form.nextRow());this.obj instanceof PointLight&&(this.form.addText("Distance"),this.distance=new NumberBox(this.form.element),this.distance.size.set(60,18),this.distance.setStep(.1),this.distance.setOnChange(()=>
{null!==l.obj&&(l.obj.distance=l.distance.getValue())}),this.form.add(this.distance),this.form.nextRow(),this.form.addText("Intensity"),this.intensity=new Slider(this.form.element),this.intensity.size.set(160,18),this.intensity.setStep(.1),this.intensity.setRange(0,10),this.intensity.setOnChange(()=>{null!==l.obj&&(l.obj.intensity=l.intensity.getValue())}),this.form.add(this.intensity),this.form.nextRow());this.obj instanceof SpotLight&&(this.form.addText("Penumbra"),this.penumbra=new Slider(this.form.element),
this.penumbra.size.set(160,18),this.penumbra.position.set(65,110),this.penumbra.setRange(0,1),this.penumbra.setStep(.01),this.penumbra.updateInterface(),this.penumbra.setOnChange(()=>{null!==l.obj&&(l.obj.penumbra=l.penumbra.getValue())}),this.form.add(this.penumbra),this.form.nextRow(),this.form.addText("Angle"),this.angle=new Slider(this.form.element),this.angle.size.set(160,18),this.angle.setRange(0,1.57),this.angle.setStep(.01),this.angle.setOnChange(()=>{null!==l.obj&&(l.obj.angle=l.angle.getValue())}),
this.form.add(this.angle),this.form.nextRow());if(this.obj instanceof DirectionalLight||this.obj instanceof PointLight||this.obj instanceof SpotLight){this.form.addText("Shadows");this.form.nextRow();this.cast_shadow=new CheckBox(this.form.element);this.cast_shadow.setText("Cast Shadow");this.cast_shadow.size.set(200,15);this.cast_shadow.position.set(5,85);this.cast_shadow.updateInterface();this.cast_shadow.setOnChange(()=>{null!==l.obj&&(l.obj.castShadow=l.cast_shadow.getValue())});this.form.add(this.cast_shadow);
this.form.nextRow();this.form.addText("Map");this.form.nextRow();this.form.addText("Resolution");this.shadow_width=new DropdownList(this.form.element);this.shadow_width.size.set(60,18);this.shadow_width.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.mapSize.width=l.shadow_width.getValue(),l.obj.updateShadowMap())});this.form.add(this.shadow_width);this.form.addText("x");this.shadow_height=new DropdownList(this.form.element);this.shadow_height.size.set(60,18);this.shadow_height.setOnChange(()=>{null!==
l.obj&&(l.obj.shadow.mapSize.height=l.shadow_height.getValue(),l.obj.updateShadowMap())});this.form.add(this.shadow_height);this.form.nextRow();for(b=0;13>b;b++)h=Math.pow(2,b),this.shadow_width.addValue(h.toString(),h),this.shadow_height.addValue(h.toString(),h);this.form.addText("Near");this.shadow_near=new NumberBox(this.form.element);this.shadow_near.size.set(60,18);this.shadow_near.setStep(.1);this.shadow_near.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.camera.near=l.shadow_near.getValue(),
l.obj.updateShadowMap())});this.form.add(this.shadow_near);this.form.addText("Far");this.shadow_far=new NumberBox(this.form.element);this.shadow_far.size.set(60,18);this.shadow_far.setStep(.1);this.shadow_far.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.camera.far=l.shadow_far.getValue(),l.obj.updateShadowMap())});this.form.add(this.shadow_far);this.form.nextRow();this.obj instanceof DirectionalLight&&(this.form.addText("Left"),this.shadow_left=new NumberBox(this.form.element),this.shadow_left.size.set(60,
18),this.shadow_left.setStep(.1),this.shadow_left.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.camera.left=l.shadow_left.getValue(),l.obj.updateShadowMap())}),this.form.add(this.shadow_left),this.form.addText("Right"),this.shadow_right=new NumberBox(this.form.element),this.shadow_right.size.set(60,18),this.shadow_right.setStep(.1),this.shadow_right.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.camera.right=l.shadow_right.getValue(),l.obj.updateShadowMap())}),this.form.add(this.shadow_right),this.form.nextRow(),
this.form.addText("Top"),this.shadow_top=new NumberBox(this.form.element),this.shadow_top.size.set(60,18),this.shadow_top.setStep(.1),this.shadow_top.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.camera.top=l.shadow_top.getValue(),l.obj.updateShadowMap())}),this.form.add(this.shadow_top),this.form.addText("Bottom"),this.shadow_bottom=new NumberBox(this.form.element),this.shadow_bottom.size.set(60,18),this.shadow_bottom.setStep(.1),this.shadow_bottom.setOnChange(()=>{null!==l.obj&&(l.obj.shadow.camera.bottom=
l.shadow_bottom.getValue(),l.obj.updateShadowMap())}),this.form.add(this.shadow_bottom),this.form.nextRow())}this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
LightComponent.prototype.updateData=function(){this.colour.setValue(this.obj.color.r,this.obj.color.g,this.obj.color.b);this.obj instanceof HemisphereLight&&this.groundCol.setValue(this.obj.groundColor.r,this.obj.groundColor.g,this.obj.groundColor.b);this.obj instanceof PointLight&&(this.distance.setValue(this.obj.distance),this.intensity.setValue(this.obj.intensity));this.obj instanceof SpotLight&&(this.angle.setValue(this.obj.angle),this.penumbra.setValue(this.obj.penumbra));if(this.obj instanceof
DirectionalLight||this.obj instanceof PointLight||this.obj instanceof SpotLight)this.cast_shadow.setValue(this.obj.castShadow),this.shadow_width.setValue(this.obj.shadow.mapSize.width),this.shadow_height.setValue(this.obj.shadow.mapSize.height),this.shadow_near.setValue(this.obj.shadow.camera.near),this.shadow_far.setValue(this.obj.shadow.camera.far);this.obj instanceof DirectionalLight&&(this.shadow_left.setValue(this.obj.shadow.camera.left),this.shadow_right.setValue(this.obj.shadow.camera.right),
this.shadow_top.setValue(this.obj.shadow.camera.top),this.shadow_bottom.setValue(this.obj.shadow.camera.bottom))};
LightComponent.prototype.onReset=function(){this.obj.color.setRGB(this.values.colour[0],this.values.colour[1],this.values.colour[2]);if(this.obj instanceof DirectionalLight||this.obj instanceof PointLight)this.obj.castShadow=this.values.castShadow;this.obj instanceof HemisphereLight&&this.obj.groundColor.setRGB(this.values.groundCol[0],this.values.groundCol[1],this.values.groundCol[2]);this.obj instanceof PointLight&&(this.obj.distance=this.values.distance,this.obj.intensity=this.values.intensity,
this.obj.shadow.mapSize.width=this.values.shadow_width,this.obj.shadow.mapSize.height=this.values.shadow_height,this.obj.shadow.camera.near=this.values.shadow_near,this.obj.shadow.camera.far=this.values.shadow_far,this.obj.updateShadowMap());this.obj instanceof SpotLight&&(this.obj.penumbra=this.values.penumbra,this.obj.angle=this.values.angle);Editor.updateObjectViews();this.updateData()};
function SkyComponent(){Component.call(this);this.component_name="Sky";this.className="SkyComponent";this.values={auto_update:!1,duration:240,time:150,distance:500,shadows:!0,width:512,height:512,near:.5,far:1E4,left:-10,right:10,top:10,bottom:-10}}SkyComponent.prototype=Object.create(Component.prototype);
SkyComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var l=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.component_name);this.form.nextRow();this.auto_update=new CheckBox(this.form.element);this.auto_update.setText("Auto Update");this.auto_update.size.set(200,15);this.auto_update.setOnChange(()=>{null!==l.obj&&(l.obj.auto_update=l.auto_update.getValue())});this.form.add(this.auto_update);this.form.nextRow();this.form.addText("Day duration");
this.day_time=new NumberBox(this.form.element);this.day_time.size.set(60,18);this.day_time.setStep(.1);this.day_time.setOnChange(()=>{if(null!==l.obj){var e=l.day_time.getValue();0>e&&(e=0,l.day_time.setValue(e));l.obj.day_time=e;l.obj.day_time>e&&(l.obj.time=e,l.time.setValue(e));l.time.setRange(0,e);l.obj.updateSky()}});this.form.add(this.day_time);this.form.addText("s");this.form.nextRow();this.form.addText("Time");this.time=new NumberBox(this.form.element);this.time.size.set(100,18);this.time.setStep(.1);
this.time.setOnChange(()=>{if(null!==l.obj){var e=l.time.getValue();0>e?(e=0,l.time.setValue(e)):e>l.obj.day_time&&(e=l.obj.day_time,l.time.setValue(e));l.obj.time=e;l.obj.updateSky()}});this.form.add(this.time);this.form.addText("s");this.form.nextRow();this.form.addText("Sun distance");this.sun_distance=new NumberBox(this.form.element);this.sun_distance.size.set(80,18);this.sun_distance.setStep(10);this.sun_distance.setOnChange(()=>{null!==l.obj&&(l.obj.sun_distance=l.sun_distance.getValue(),l.obj.updateSky())});
this.form.add(this.sun_distance);this.form.nextRow();this.form.addText("Shadows");this.form.nextRow();this.cast_shadow=new CheckBox(this.form.element);this.cast_shadow.setText("Cast shadows");this.cast_shadow.size.set(200,15);this.cast_shadow.position.set(5,85);this.cast_shadow.updateInterface();this.cast_shadow.setOnChange(()=>{null!==l.obj&&(l.obj.sun.castShadow=l.cast_shadow.getValue())});this.form.add(this.cast_shadow);this.form.nextRow();this.form.addText("Resolution");this.shadow_width=new DropdownList(this.form.element);
this.shadow_width.size.set(60,18);this.shadow_width.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.mapSize.width=l.shadow_width.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_width);this.form.addText("x");this.shadow_height=new DropdownList(this.form.element);this.shadow_height.size.set(60,18);this.shadow_height.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.mapSize.height=l.shadow_height.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_height);this.form.nextRow();
for(b=0;13>b;b++)h=Math.pow(2,b),this.shadow_width.addValue(h.toString(),h),this.shadow_height.addValue(h.toString(),h);this.form.addText("Near");this.shadow_near=new NumberBox(this.form.element);this.shadow_near.size.set(60,18);this.shadow_near.setStep(.1);this.shadow_near.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.camera.near=l.shadow_near.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_near);this.form.addText("Far");this.shadow_far=new NumberBox(this.form.element);this.shadow_far.size.set(60,
18);this.shadow_far.setStep(.1);this.shadow_far.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.camera.far=l.shadow_far.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_far);this.form.nextRow();this.form.addText("Left");this.shadow_left=new NumberBox(this.form.element);this.shadow_left.size.set(60,18);this.shadow_left.setStep(.1);this.shadow_left.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.camera.left=l.shadow_left.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_left);
this.form.addText("Right");this.shadow_right=new NumberBox(this.form.element);this.shadow_right.size.set(60,18);this.shadow_right.setStep(.1);this.shadow_right.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.camera.right=l.shadow_right.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_right);this.form.nextRow();this.form.addText("Top");this.shadow_top=new NumberBox(this.form.element);this.shadow_top.size.set(60,18);this.shadow_top.setStep(.1);this.shadow_top.setOnChange(()=>{null!==
l.obj&&(l.obj.sun.shadow.camera.top=l.shadow_top.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_top);this.form.addText("Bottom");this.shadow_bottom=new NumberBox(this.form.element);this.shadow_bottom.size.set(60,18);this.shadow_bottom.setStep(.1);this.shadow_bottom.setOnChange(()=>{null!==l.obj&&(l.obj.sun.shadow.camera.bottom=l.shadow_bottom.getValue(),l.obj.sun.updateShadowMap())});this.form.add(this.shadow_bottom);this.form.nextRow();this.form.position.copy(this.widgetsPos);
this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
SkyComponent.prototype.updateData=function(){this.auto_update.setValue(this.obj.auto_update);this.day_time.setValue(this.obj.day_time);this.time.setValue(this.obj.time);this.sun_distance.setValue(this.obj.sun_distance);this.cast_shadow.setValue(this.obj.sun.castShadow);this.shadow_width.setValue(this.obj.sun.shadow.mapSize.width);this.shadow_height.setValue(this.obj.sun.shadow.mapSize.height);this.shadow_near.setValue(this.obj.sun.shadow.camera.near);this.shadow_far.setValue(this.obj.sun.shadow.camera.far);
this.shadow_left.setValue(this.obj.sun.shadow.camera.left);this.shadow_right.setValue(this.obj.sun.shadow.camera.right);this.shadow_top.setValue(this.obj.sun.shadow.camera.top);this.shadow_bottom.setValue(this.obj.sun.shadow.camera.bottom)};
SkyComponent.prototype.onReset=function(){this.obj.auto_update=this.values.auto_update;this.obj.day_time=this.values.duration;this.obj.time=this.values.time;this.obj.sun_distance=this.values.distance;this.obj.sun.castShadow=this.values.shadows;this.obj.sun.shadow.mapSize.width=this.values.width;this.obj.sun.shadow.mapSize.height=this.values.height;this.obj.sun.shadow.camera.near=this.values.near;this.obj.sun.shadow.camera.far=this.values.far;this.obj.sun.shadow.camera.left=this.values.left;this.obj.sun.shadow.camera.right=
this.values.right;this.obj.sun.shadow.camera.top=this.values.top;this.obj.sun.shadow.camera.bottom=this.values.bottom;this.updateData();this.obj.updateSky();Editor.updateObjectViews()};function Register(){}Register.registerBlocksNodes=function(){registerBase();registerEvents();registerArray();registerWidgets();registerColour();registerVectorNode();registerObjects();registerHierarchy();registerKeyboardNodes()};
Register.registerMaterialNodes=function(){registerArray();registerWidgets();registerColour();registerMaterialNodes()};Register.registerParticlesNodes=function(){registerArray();registerWidgets();registerColour();registerParticlesNodes()};Register.registerTextureNodes=function(){};Register.unregisterAll=function(){LiteGraph.registered_node_types={};LiteGraph.Nodes={}};Register.registerAll=function(){Register.registerBlocksNodes();Register.registerMaterialNodes();Register.registerParticlesNodes()};
function NodesHelper(){}NodesHelper.sizes={};NodesHelper.sizes.small=[120,26];NodesHelper.sizes.medium=[180,46];NodesHelper.sizes.big=[220,66];NodesHelper.sizes.large=[280,86];NodesHelper.titles={};NodesHelper.titles.event="#FF0000";NodesHelper.titles.hierarchy="#556B2f";NodesHelper.titles.input="#0080FF";NodesHelper.titles.object="#DEB887";NodesHelper.titles.base="#5F9EA0";NodesHelper.titles.material="#032138";NodesHelper.titles.texture="#1d5e4a";NodesHelper.titles.particles="#bf7f3b";
NodesHelper.titles.array=NodesHelper.titles.event;NodesHelper.titles.widget="#7E0480";NodesHelper.titles.color="#380333";NodesHelper.titles.vector="#f4042c";NodesHelper.slots={};NodesHelper.slots.position={};NodesHelper.slots.position.x=20;NodesHelper.slots.position.y=12;NodesHelper.slots.position.y_second=30;NodesHelper.slots.position.y_third=48;NodesHelper.slots.position.y_fourth=66;NodesHelper.slots.position.y_fifth=84;NodesHelper.slots.position.y_sixth=104;
NodesHelper.slots.position.y_seventh=122;NodesHelper.slots.position.y_eighth=140;NodesHelper.slots.position.y_ninth=158;NodesHelper.slots.position.x1=105;NodesHelper.slots.position.y1=12;NodesHelper.slots.colours={};NodesHelper.slots.colours.event="#FFFFFF";NodesHelper.slots.colours.passer="#FFC0CB";NodesHelper.slots.colours.element="#00BFFF";NodesHelper.slots.colours.array="#9400D3";NodesHelper.slots.colours.string="#FF1493";NodesHelper.slots.colours.number="#7ef48f";
NodesHelper.slots.colours.input="#87ceeb";NodesHelper.slots.colours.bool="#800000";NodesHelper.slots.colours.vector="#D2691E";NodesHelper.slots.colours.variable="#A52A2A";NodesHelper.slots.colours.euler="#8bd613";NodesHelper.slots.colours.color="#380333";NodesHelper.slots.colours.texture="#1d5e4a";NodesHelper.slots.colours.json="#1d395e";NodesHelper.slots.event={color_on:NodesHelper.slots.colours.event,color_off:NodesHelper.slots.colours.event,shape:LiteGraph.ARROW_SHAPE};
NodesHelper.slots.passer={color_on:NodesHelper.slots.colours.passer,color_off:NodesHelper.slots.colours.passer,shape:LiteGraph.BOX_SHAPE};NodesHelper.slots.object={color_on:NodesHelper.slots.colours.element,color_off:NodesHelper.slots.colours.element};NodesHelper.slots.array={color_on:NodesHelper.slots.colours.array,color_off:NodesHelper.slots.colours.array};NodesHelper.slots.string={color_on:NodesHelper.slots.colours.string,color_off:NodesHelper.slots.colours.string};
NodesHelper.slots.number={color_on:NodesHelper.slots.colours.number,color_off:NodesHelper.slots.colours.number};NodesHelper.slots.keyinput={color_on:NodesHelper.slots.colours.input,color_off:NodesHelper.slots.colours.input};NodesHelper.slots.bool={color_on:NodesHelper.slots.colours.bool,color_off:NodesHelper.slots.colours.bool};NodesHelper.slots.vector={color_on:NodesHelper.slots.colours.vector,color_off:NodesHelper.slots.colours.vector};
NodesHelper.slots.variable={color_on:NodesHelper.slots.colours.variable,color_off:NodesHelper.slots.colours.variable};NodesHelper.slots.euler={color_on:NodesHelper.slots.colours.euler,color_off:NodesHelper.slots.colours.euler};NodesHelper.slots.color={color_on:NodesHelper.slots.colours.color,color_off:NodesHelper.slots.colours.color};NodesHelper.slots.texture={color_on:NodesHelper.slots.colours.texture,color_off:NodesHelper.slots.colours.texture};
NodesHelper.slots.json={color_on:NodesHelper.slots.colours.json,color_off:NodesHelper.slots.colours.json};NodesHelper.slots.input={};NodesHelper.slots.input.position={pos:[NodesHelper.slots.position.x,12]};NodesHelper.slots.input.event=Object.assign({},NodesHelper.slots.event,NodesHelper.slots.input.position);NodesHelper.slots.output={};NodesHelper.slots.output.position={pos:[NodesHelper.slots.position.x1,12]};NodesHelper.slots.output.title_pos={pos:[NodesHelper.slots.position.x1,-10]};
NodesHelper.slots.output.event=Object.assign({},NodesHelper.slots.event,NodesHelper.slots.output.position);NodesHelper.slots.output.passer=Object.assign({},NodesHelper.slots.passer,{shape:LiteGraph.BOX_SHAPE},NodesHelper.slots.output.title_pos);
NodesHelper.getSlotMenuOptions=function(b,h,l){void 0!==b.output&&new LiteGraph.ContextMenu([{title:"Convert to Variable",callback:()=>{var e=LGraphCanvas.active_canvas.graph,r=LiteGraph.createNode("Base/Variable");r.pos=[h.pos[0]+150,h.pos[1]];e.add(r);h.connect(0,r,0);h.connect(b.slot,r,1)}}],{title:b.output.name,event:l})};
function VariableNode(){this.properties={name:"myname",container:VariableNode.LITEGRAPH};this.addInput("",LiteGraph.EVENT,NodesHelper.slots.input.event);this.addInput("In","",Object.assign({},NodesHelper.slots.variable,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.name_widget=this.addWidget("string","",this.properties.name,"name");this.name_widget.width=100;this.addOutput("Value","",Object.assign({},NodesHelper.slots.variable,{pos:[NodesHelper.slots.position.x1+10,
NodesHelper.slots.position.y]}));this.size[0]=130}VariableNode.title="Variable";VariableNode.title_color=NodesHelper.titles.base;VariableNode.collapsable=!0;VariableNode.blocks="Blocks";VariableNode.prototype.resizable=!1;VariableNode.LITEGRAPH=0;VariableNode.GRAPH=1;VariableNode.GLOBALSCOPE=2;VariableNode["@container"]={type:"enum",values:{litegraph:VariableNode.LITEGRAPH,graph:VariableNode.GRAPH,global:VariableNode.GLOBALSCOPE}};
VariableNode.prototype.getContainer=function(){switch(this.properties.container){case VariableNode.GRAPH:return this.graph?this.graph.vars:{};case VariableNode.GLOBALSCOPE:return global;default:return LiteGraph.Globals}};VariableNode.prototype.onAction=function(b,h){b=this.getContainer();this.isInputConnected(1)?(this.value=this.getInputData(1),b[this.properties.name]=this.value,this.setOutputData(0,this.value)):this.setOutputData(0,b[this.properties.name])};VariableNode.prototype.getTitle=function(){return this.properties.name};
function registerBase(){LiteGraph.registerNodeType("Base/Variable",VariableNode)}function BeginPlayNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position))}BeginPlayNode.title="Begin Play";BeginPlayNode.title_color=NodesHelper.titles.event;BeginPlayNode.skip_list=!0;BeginPlayNode.collapsable=!1;BeginPlayNode.blocks="Blocks";BeginPlayNode.prototype.resizable=!1;
BeginPlayNode.prototype.ignore_remove=!0;BeginPlayNode.prototype.clonable=!1;BeginPlayNode.prototype.getMenuOptions=()=>[];BeginPlayNode.prototype.onStart=function(){this.triggerSlot(0,"BeginPlay");this.triggerSlot(1)};function EventTickNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.passer);this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position))}EventTickNode.title="Event Tick";EventTickNode.title_color=NodesHelper.titles.event;
EventTickNode.skip_list=!0;EventTickNode.collapsable=!1;EventTickNode.blocks="Blocks";EventTickNode.prototype.resizable=!1;EventTickNode.prototype.ignore_remove=!0;EventTickNode.prototype.clonable=!1;EventTickNode.prototype.getMenuOptions=()=>[];EventTickNode.prototype.onStart=function(){this.triggerSlot(1,"EventTickStarted")};EventTickNode.prototype.onExecute=function(){this.triggerSlot(0,"Tick")};
function OnGameStartNode(){this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]]}OnGameStartNode.title="On Game Start";OnGameStartNode.title_color=NodesHelper.titles.event;OnGameStartNode.collapsable=!1;
OnGameStartNode.blocks="Blocks";OnGameStartNode.prototype.reiszable=!1;OnGameStartNode.prototype.onStart=function(){this.triggerSlot(0,"GameStart");this.triggerSlot(1)};
function EventDestroyedNode(){this.addInput("Target","object",Object.assign({},NodesHelper.slots.object));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]]}EventDestroyedNode.title="On Destroyed";
EventDestroyedNode.title_color=NodesHelper.titles.event;EventDestroyedNode.collapsable=!1;EventDestroyedNode.blocks="Blocks";EventDestroyedNode.prototype.resizable=!1;EventDestroyedNode.prototype.onStart=function(){var b=this.getInputData(0);void 0===b&&(b=this.graph.config.self);var h=this;b.addEventListener("removed",l=>{h.triggerSlot(0,b.uuid);h.triggerSlot(1)})};
function EventDisposeNode(){this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,NodesHelper.slots.output.position));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]]}EventDisposeNode.title="On Dispose";EventDisposeNode.title_color=NodesHelper.titles.event;EventDisposeNode.collapsable=!1;EventDisposeNode.blocks="Blocks";EventDisposeNode.prototype.resizable=!1;EventDisposeNode.prototype.onDispose=function(){this.triggerSlot(0)};
function EventListenerNode(){this.addProperty("event","event");this.addInput("",LiteGraph.ACTION,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Object","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.input.position.pos[1]+18]}));this.addInput("Data","",{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.input.position.pos[1]+36]});this.addInput("Event",
"string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.input.position.pos[1]+54]}));this.event_widget=this.addWidget("text","",this.properties.event,"event");this.event_widget.width=110;this.addOutput("On Fired",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.output.position.pos[0]+60,NodesHelper.slots.output.position.pos[1]]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+56]}
EventListenerNode.title="Event Listener";EventListenerNode.title_color=NodesHelper.titles.event;EventListenerNode.collapsable=!1;EventListenerNode.blocks="Blocks";EventListenerNode.prototype.resizable=!1;EventListenerNode.prototype.onStart=function(){null===this.inputs[0].link&&this.addListener()};EventListenerNode.prototype.onAction=function(b,h){this.addListener()};
EventListenerNode.prototype.addListener=function(){this.object=this.getInputData(1);this.data=this.getInputData(2);this.event=this.getInputData(3);void 0===this.object&&(this.object=this.graph.config.self);void 0===this.data&&(this.data={});void 0===this.event&&(this.event=this.properties.event);if(""!==this.event){var b=this;this.object.addEventListener(this.event,()=>{b.listen()})}};EventListenerNode.prototype.listen=function(){this.triggerSlot(0,this.data)};
EventListenerNode.prototype.onDispose=function(){void 0!==this.object&&this.object.removeEventListener(this.event,this.listen)};
function FireEventNode(){this.addProperty("event","event");this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Object","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.position.y_second]}));this.addInput("Event","string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.position.y_third]}));this.event_widget=this.addWidget("text","",this.properties.event,
"event");this.event_widget.width=110;this.size=[NodesHelper.sizes.medium[0]-40,NodesHelper.sizes.medium[1]+40]}FireEventNode.title="Fire Event";FireEventNode.title_color=NodesHelper.titles.event;FireEventNode.collapsable=!1;FireEventNode.blocks="Blocks";FireEventNode.prototype.resizable=!1;
FireEventNode.prototype.onAction=function(b,h){this.object=this.getInputData(1);this.event=this.getInputData(2);void 0===this.object&&(this.object=this.graph.config.self);void 0===this.event&&(this.event=this.properties.event);""!==this.event&&this.object.dispatchEvent({type:this.event})};
function TimeOutEvent(){this.addProperty("time","100");this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Time","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.input.position.pos[0],NodesHelper.slots.position.y_second]}));this.addWidget("text","Time",this.properties.time,"time").width=140;this.addOutput("On TimeOut",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.output.position.pos[0]+20,NodesHelper.slots.output.position.pos[1]]}));
this.size=[NodesHelper.sizes.medium[0]-40,NodesHelper.sizes.medium[1]+18]}TimeOutEvent.title="Time Out";TimeOutEvent.title_color=NodesHelper.titles.event;TimeOutEvent.collapsable=!1;TimeOutEvent.blocks="Blocks";TimeOutEvent.prototype.resizable=!1;TimeOutEvent.prototype.onStart=function(){null===this.inputs[0].link&&this.addTimeout()};TimeOutEvent.prototype.onAction=function(b,h){this.addTimeout()};
TimeOutEvent.prototype.addTimeout=function(){var b=this.getInputData(1);void 0===b&&(b=this.properties.time);var h=this;setTimeout(()=>{h.triggerSlot(0)},parseInt(b))};function TestEvent(){this.addInput("Event",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Input")}TestEvent.title="Test";TestEvent.blocks="Blocks";TestEvent.prototype.onAction=function(b,h){console.log(b,h);console.log(this.getInputData(1))};
function registerEvents(){LiteGraph.registerNodeType("Events/BeginPlay",BeginPlayNode);LiteGraph.registerNodeType("Events/EventTick",EventTickNode);LiteGraph.registerNodeType("Events/OnGameStart",OnGameStartNode);LiteGraph.registerNodeType("Events/EventDestroyed",EventDestroyedNode);LiteGraph.registerNodeType("Events/EventDispose",EventDisposeNode);LiteGraph.registerNodeType("Events/EventListener",EventListenerNode);LiteGraph.registerNodeType("Events/FireEvent",FireEventNode);LiteGraph.registerNodeType("Events/TimeOut",
TimeOutEvent);LiteGraph.registerNodeType("Events/TestEvent",TestEvent)}
function ArrayNode(){this.addInput("",LiteGraph.EVENT,NodesHelper.slots.event);this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event));this.addOutput("Array","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x1,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]+16]}ArrayNode.title="Array";
ArrayNode.title_color=NodesHelper.titles.array;ArrayNode.collapsable=!1;ArrayNode.prototype.resizable=!1;ArrayNode.prototype.onGetInputs=function(){return[["Item",null,Object.assign({},NodesHelper.slots.array)]]};ArrayNode.prototype.onInputAdded=function(){this.size[0]=NodesHelper.sizes.small[0]};ArrayNode.prototype.onInputRemoved=function(){this.size[0]=NodesHelper.sizes.small[0]};ArrayNode.prototype.onOutputRemoved=function(){this.size[0]=NodesHelper.sizes.small[0]};
ArrayNode.prototype.onExecute=function(){this.isInputConnected(0)||this.setOutputData(2,this.createArray())};ArrayNode.prototype.onAction=function(){var b=this.createArray();this.setOutputData(2,b);this.triggerSlot(0,b);this.triggerSlot(1)};ArrayNode.prototype.createArray=function(){var b=[];if(this.inputs)for(var h=0;h<this.inputs.length;h++){var l=this.getInputData(h);void 0!==l&&b.push(l)}return b};
function ArrayPushNode(){this.addInput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Array","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Element","",{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]});this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1,
NodesHelper.slots.position.y]}));this.size=[NodesHelper.sizes.small[0],NodesHelper.sizes.small[1]+36]}ArrayPushNode.title="Push";ArrayPushNode.title_color=NodesHelper.titles.array;ArrayPushNode.collapsable=!1;ArrayPushNode.prototype.resizable=!1;ArrayPushNode.prototype.onAction=function(){void 0!==this.getInputData(2)&&(this.getInputData(1).push(this.getInputData(2)),this.triggerSlot(0))};
function registerArray(){LiteGraph.registerNodeType("Lists/Arrays/Array",ArrayNode);LiteGraph.registerNodeType("Lists/Arrays/Push",ArrayPushNode)}function WidgetFloatNode(){this.properties={value:1};this.addOutput("Value","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x1+50,NodesHelper.slots.position.y]}));this.addWidget("number","Value",this.properties.value,"value");this.size=[NodesHelper.sizes.small[0]+50,NodesHelper.sizes.small[1]+26]}
WidgetFloatNode.title="Float";WidgetFloatNode.title_color=NodesHelper.titles.widget;WidgetFloatNode.collapsable=!1;WidgetFloatNode.prototype.resizable=!1;WidgetFloatNode.prototype.onStart=function(){void 0!==this.properties.value&&this.setOutputData(0,this.properties.value)};WidgetFloatNode.prototype.onPropertyChanged=function(){this.setOutputData(0,this.properties.value);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerWidgets(){LiteGraph.registerNodeType("Base/Widgets/Float",WidgetFloatNode)}
function ThisNode(){this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1-20,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1-20,NodesHelper.slots.position.y]}));this.addOutput("This","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x1-20,NodesHelper.slots.position.y_second]}));this.size=
[NodesHelper.sizes.small[0]-20,NodesHelper.sizes.small[1]+20]}ThisNode.title="This";ThisNode.title_color=NodesHelper.titles.object;ThisNode.collapsable=!0;ThisNode.blocks="Blocks";ThisNode.prototype.resizable=!1;ThisNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ThisNode.prototype.onStart=function(){this.setOutputData(2,this.graph.config.self);this.triggerSlot(0,this.graph.config.self);this.triggerSlot(1)};
function GetPositionNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Position","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetPositionNode.title="Get Position";GetPositionNode.title_color=NodesHelper.titles.object;GetPositionNode.collapsable=!0;GetPositionNode.blocks="Blocks";GetPositionNode.prototype.resizable=!1;GetPositionNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetPositionNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.position;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetRotationNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Rotation","euler",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetRotationNode.title="Get Rotation";GetRotationNode.title_color=NodesHelper.titles.object;GetRotationNode.collapsable=!0;GetRotationNode.blocks="Blocks";GetRotationNode.prototype.resizable=!1;GetRotationNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetRotationNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.rotation;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetScaleNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Scale","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetScaleNode.title="Get Scale";GetScaleNode.title_color=NodesHelper.titles.object;GetScaleNode.collapsable=!0;GetScaleNode.blocks="Blocks";GetScaleNode.prototype.resizable=!1;GetScaleNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetScaleNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.scale;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function SetPositionNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Position","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("New Position","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+18]}SetPositionNode.title="Set Position";SetPositionNode.title_color=NodesHelper.titles.object;
SetPositionNode.collapsable=!0;SetPositionNode.blocks="Blocks";SetPositionNode.prototype.resizable=!1;SetPositionNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetPositionNode.prototype.onAction=function(b,h){b=this.getInputData(1);var l=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);void 0===l&&void 0!==h&&h instanceof THREE.Vector3&&(l=h);void 0===l&&(l=new THREE.Vector3(0,0,0));b.position.copy(l);this.setOutputData(2,l);this.triggerSlot(0,l);this.triggerSlot(1)};
function SetRotationNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Rotation","euler",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("New Rotation","euler",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}))}SetRotationNode.title="Set Rotation";SetRotationNode.title_color=NodesHelper.titles.object;SetRotationNode.collapsable=!0;
SetRotationNode.blocks="Blocks";SetRotationNode.prototype.resizable=!1;SetRotationNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetRotationNode.prototype.onAction=function(b,h){b=this.getInputData(1);var l=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);void 0===l&&void 0!==h&&h instanceof THREE.Euler&&(l=h);void 0===l&&(l=new THREE.Euler(0,0,0,"XYZ"));b.rotation.copy(l);this.setOutputData(2,l);this.triggerSlot(0,l);this.triggerSlot(1)};
function SetScaleNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Scale","vector",Object.assign({},NodesHelper.slots.euler,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("New Scale","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+18]}SetScaleNode.title="Set Scale";SetScaleNode.title_color=NodesHelper.titles.object;
SetScaleNode.collapsable=!0;SetScaleNode.blocks="Blocks";SetScaleNode.prototype.resizable=!1;SetScaleNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetScaleNode.prototype.onAction=function(b,h){b=this.getInputData(1);var l=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);void 0===l&&void 0!==h&&h instanceof THREE.Vector3&&(l=h);void 0===l&&(l=new THREE.Vector3(1,1,1));b.scale.copy(l);this.setOutputData(2,l);this.triggerSlot(0,l);this.triggerSlot(1)};
function registerObjects(){LiteGraph.registerNodeType("Objects/This",ThisNode);LiteGraph.registerNodeType("Objects/GetPosition",GetPositionNode);LiteGraph.registerNodeType("Objects/GetRotation",GetRotationNode);LiteGraph.registerNodeType("Objects/GetScale",GetScaleNode);LiteGraph.registerNodeType("Objects/SetPosition",SetPositionNode);LiteGraph.registerNodeType("Objects/SetRotation",SetRotationNode);LiteGraph.registerNodeType("Objects/SetScale",SetScaleNode)}
function GetAllChildrenNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Children","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.output.position.pos[0]+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetAllChildrenNode.title="Get All Children";GetAllChildrenNode.title_color=NodesHelper.titles.hierarchy;GetAllChildrenNode.collapsable=!1;GetAllChildrenNode.blocks="Blocks";GetAllChildrenNode.prototype.resizable=!1;
GetAllChildrenNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GetAllChildrenNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.children;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetChildByNameNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Name","string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("Child","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.output.position.pos[0]+60,NodesHelper.slots.position.y_second]}));this.addProperty("name","");this.name_widget=this.addWidget("text","","","name");this.name_widget.width=120;this.size=[NodesHelper.sizes.medium[0],
NodesHelper.sizes.medium[1]+40]}GetChildByNameNode.title="Get Child By Name";GetChildByNameNode.title_color=NodesHelper.titles.hierarchy;GetChildByNameNode.collapsable=!1;GetChildByNameNode.blocks="Blocks";GetChildByNameNode.prototype.resizable=!1;GetChildByNameNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetChildByNameNode.prototype.onAction=function(b,h){b=this.getInputData(1);var l=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===l&&void 0!==h&&h instanceof String&&(l=h);void 0===b&&(b=this.graph.config.self);void 0===l&&(l=this.properties.name);h=b.getObjectByName(l);this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetParentNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Parent","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}GetParentNode.title="Get Parent";GetParentNode.title_color=NodesHelper.titles.hierarchy;GetParentNode.collapsable=!1;GetParentNode.blocks="Blocks";GetParentNode.resizable=!1;GetParentNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetParentNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.parent;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function IsChildNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Target","object",Object.assign({},NodesHelper.slots.object,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Is Child?","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}IsChildNode.title="Is Child";IsChildNode.title_color=NodesHelper.titles.hierarchy;IsChildNode.collapsable=!1;IsChildNode.blocks="Blocks";IsChildNode.resizable=!1;IsChildNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
IsChildNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.parent instanceof THREE.Scene?!1:!0;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function registerHierarchy(){LiteGraph.registerNodeType("Hierarchy/GetAllChildNode",GetAllChildrenNode);LiteGraph.registerNodeType("Hierarchy/GetChildByName",GetChildByNameNode);LiteGraph.registerNodeType("Hierarchy/GetParent",GetParentNode);LiteGraph.registerNodeType("Hierarchy/IsChild",IsChildNode)}
function ColourNode(){this.properties={r:0,g:0,b:0};this.addWidget("number","R",this.properties.r,"r");this.addWidget("number","G",this.properties.g,"g");this.addWidget("number","B",this.properties.b,"b");this.addOutput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+52]}ColourNode.title="Colour";ColourNode.title_color=NodesHelper.titles.color;
ColourNode.collapsable=!1;ColourNode.prototype.resizable=!1;ColourNode.prototype.onStart=function(){this.setOutputData(0,new THREE.Color(this.properties.r,this.properties.g,this.properties.b))};ColourNode.prototype.onPropertyChanged=function(){this.setOutputData(0,new THREE.Color(this.properties.r,this.properties.g,this.properties.b));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerColour(){LiteGraph.registerNodeType("Math/Colour/Colour",ColourNode)}
function VectorNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("X","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Y","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addInput("Z","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fourth]}));
this.properties={x:0,y:0,z:0};this.addWidget("number","X",this.properties.x,"x");this.addWidget("number","Y",this.properties.y,"y");this.addWidget("number","Z",this.properties.z,"z");this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("Vector",
"vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+106]}VectorNode.title="Vector";VectorNode.title_color=NodesHelper.titles.vector;VectorNode.collapsable=!0;VectorNode.prototype.resizable=!1;VectorNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VectorNode.prototype.onAction=function(){this.createVector()};
VectorNode.prototype.onStart=function(){this.isInputConnected(0)||this.createVector()};VectorNode.prototype.createVector=function(){var b=this.getInputData(1),h=this.getInputData(2),l=this.getInputData(3);void 0===b&&(b=this.properties.x);void 0===h&&(h=this.properties.y);void 0===l&&(l=this.properties.z);b=new THREE.Vector3(b,h,l);this.setOutputData(2,b);this.triggerSlot(0,b);this.triggerSlot(1)};
function VectorThreeToTwoNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Vector","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.position.y]}));this.addOutput("Vector","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]]}VectorThreeToTwoNode.title="Vector3 To Vector2";VectorThreeToTwoNode.title_color=NodesHelper.titles.vector;VectorThreeToTwoNode.collapsable=!0;VectorThreeToTwoNode.prototype.resizable=!1;VectorThreeToTwoNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
VectorThreeToTwoNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Vector3&&(b=h);h=new THREE.Vector2(b.x,b.y);this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function VectorAddNode(){this.addInput("",LiteGraph.ACTION,NodesHelper.slots.input.event);this.addInput("Vector 1","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Vector 2","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.output.passer,{pos:[NodesHelper.slots.position.x1+
60,NodesHelper.slots.output.title_pos.pos[1]]}));this.addOutput("",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y]}));this.addOutput("Out","vector",Object.assign({},NodesHelper.slots.vector,{pos:[NodesHelper.slots.position.x1+60,NodesHelper.slots.position.y_second]}));this.size=[NodesHelper.sizes.medium[0],NodesHelper.sizes.medium[1]+18]}VectorAddNode.title="Add";VectorAddNode.title_color=NodesHelper.titles.vector;
VectorAddNode.collapsable=!0;VectorAddNode.prototype.resizable=!1;VectorAddNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VectorAddNode.prototype.onAction=function(b,h){b=this.getInputData(1);h=this.getInputData(2);void 0===b||void 0===h?console.log("An undefined parameter: ",b,h):(b=b.add(h),this.setOutputData(2,b),this.triggerSlot(0,b),this.triggerSlot(1))};
function registerVectorNode(){LiteGraph.registerNodeType("Math/Vector/Vector",VectorNode);LiteGraph.registerNodeType("Math/Vector/VectorThreeToTwo",VectorThreeToTwoNode);LiteGraph.registerNodeType("Math/Vector/VectorAdd",VectorAddNode)}function registerEulerNodes(){}
function ANode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ANode.title="A";ANode.title_color=NodesHelper.titles.input;ANode.collapsable=!0;ANode.blocks="Blocks";ANode.prototype.resizable=!1;ANode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ANode.prototype.onStart=function(){this.setOutputData(3,Keyboard.A)};
ANode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.A)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.A)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.A)&&this.triggerSlot(2,"Released")};
function AltNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}AltNode.title="Alt";AltNode.title_color=NodesHelper.titles.input;AltNode.collapsable=!0;AltNode.blocks="Blocks";AltNode.prototype.resizable=!1;AltNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;AltNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ALT)};
AltNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.ALT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.ALT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.ALT)&&this.triggerSlot(2,"Released")};
function BNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}BNode.title="B";BNode.title_color=NodesHelper.titles.input;BNode.collapsable=!0;BNode.blocks="Blocks";BNode.prototype.resizable=!1;BNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;BNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.B)};
BNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.B)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.B)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.B)&&this.triggerSlot(2,"Released")};
function BackspaceNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}BackspaceNode.title="Backspace";BackspaceNode.title_color=NodesHelper.titles.input;BackspaceNode.collapsable=!0;BackspaceNode.blocks="Blocks";BackspaceNode.prototype.resizable=!1;BackspaceNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
BackspaceNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.BACKSPACE)};BackspaceNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.BACKSPACE)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.BACKSPACE)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.BACKSPACE)&&this.triggerSlot(2,"Released")};
function CNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}CNode.title="C";CNode.title_color=NodesHelper.titles.input;CNode.collapsable=!0;CNode.blocks="Blocks";CNode.prototype.resizable=!1;CNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.C)};
CNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.C)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.C)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.C)&&this.triggerSlot(2,"Released")};
function CapsLockNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}CapsLockNode.title="CapsLock";CapsLockNode.title_color=NodesHelper.titles.input;CapsLockNode.collapsable=!0;CapsLockNode.blocks="Blocks";CapsLockNode.prototype.resizable=!1;CapsLockNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
CapsLockNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.CAPS_LOCK)};CapsLockNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.CAPS_LOCK)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.CAPS_LOCK)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.CAPS_LOCK)&&this.triggerSlot(2,"Released")};
function CtrlNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}CtrlNode.title="Ctrl";CtrlNode.title_color=NodesHelper.titles.input;CtrlNode.collapsable=!0;CtrlNode.blocks="Blocks";CtrlNode.prototype.resizable=!1;CtrlNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CtrlNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.CTRL)};
CtrlNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.CTRL)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.CTRL)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.CTRL)&&this.triggerSlot(2,"Released")};
function DNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}DNode.title="D";DNode.title_color=NodesHelper.titles.input;DNode.collapsable=!0;DNode.blocks="Blocks";DNode.prototype.resizable=!1;DNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.D)};
DNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.D)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.D)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.D)&&this.triggerSlot(2,"Released")};
function DelNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}DelNode.title="Del";DelNode.title_color=NodesHelper.titles.input;DelNode.collapsable=!0;DelNode.blocks="Blocks";DelNode.prototype.resizable=!1;DelNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DelNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.DEL)};
DelNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.DEL)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.DEL)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.DEL)&&this.triggerSlot(2,"Released")};
function DownNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}DownNode.title="Down";DownNode.title_color=NodesHelper.titles.input;DownNode.collapsable=!0;DownNode.blocks="Blocks";DownNode.prototype.resizable=!1;DownNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DownNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.DOWN)};
DownNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.DOWN)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.DOWN)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.DOWN)&&this.triggerSlot(2,"Released")};
function ENode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ENode.title="E";ENode.title_color=NodesHelper.titles.input;ENode.collapsable=!0;ENode.blocks="Blocks";ENode.prototype.resizable=!1;ENode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ENode.prototype.onStart=function(){this.setOutputData(3,Keyboard.E)};
ENode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.E)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.E)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.E)&&this.triggerSlot(2,"Released")};
function EndNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}EndNode.title="End";EndNode.title_color=NodesHelper.titles.input;EndNode.collapsable=!0;EndNode.blocks="Blocks";EndNode.prototype.resizable=!1;EndNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EndNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.END)};
EndNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.END)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.END)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.END)&&this.triggerSlot(2,"Released")};
function EnterNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}EnterNode.title="Enter";EnterNode.title_color=NodesHelper.titles.input;EnterNode.collapsable=!0;EnterNode.blocks="Blocks";EnterNode.prototype.resizable=!1;EnterNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EnterNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ENTER)};
EnterNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.ENTER)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.ENTER)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.ENTER)&&this.triggerSlot(2,"Released")};
function EscNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}EscNode.title="Esc";EscNode.title_color=NodesHelper.titles.input;EscNode.collapsable=!0;EscNode.blocks="Blocks";EscNode.prototype.resizable=!1;EscNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EscNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ESC)};
EscNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.ESC)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.ESC)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.ESC)&&this.triggerSlot(2,"Released")};
function FNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}FNode.title="F";FNode.title_color=NodesHelper.titles.input;FNode.collapsable=!0;FNode.blocks="Blocks";FNode.prototype.resizable=!1;FNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;FNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.F)};
FNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F)&&this.triggerSlot(2,"Released")};
function F1Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F1Node.title="F1";F1Node.title_color=NodesHelper.titles.input;F1Node.collapsable=!0;F1Node.blocks="Blocks";F1Node.prototype.resizable=!1;F1Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F1Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F1)};
F1Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F1)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F1)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F1)&&this.triggerSlot(2,"Released")};
function F2Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F2Node.title="F2";F2Node.title_color=NodesHelper.titles.input;F2Node.collapsable=!0;F2Node.blocks="Blocks";F2Node.prototype.resizable=!1;F2Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F2Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F2)};
F2Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F2)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F2)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F2)&&this.triggerSlot(2,"Released")};
function F3Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F3Node.title="F3";F3Node.title_color=NodesHelper.titles.input;F3Node.collapsable=!0;F3Node.blocks="Blocks";F3Node.prototype.resizable=!1;F3Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F3Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F3)};
F3Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F3)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F3)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F3)&&this.triggerSlot(2,"Released")};
function F4Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F4Node.title="F4";F4Node.title_color=NodesHelper.titles.input;F4Node.collapsable=!0;F4Node.blocks="Blocks";F4Node.prototype.resizable=!1;F4Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F4Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F4)};
F4Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F4)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F4)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F4)&&this.triggerSlot(2,"Released")};
function F5Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F5Node.title="F5";F5Node.title_color=NodesHelper.titles.input;F5Node.collapsable=!0;F5Node.blocks="Blocks";F5Node.prototype.resizable=!1;F5Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F5Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F5)};
F5Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F5)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F5)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F5)&&this.triggerSlot(2,"Released")};
function F6Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F6Node.title="F6";F6Node.title_color=NodesHelper.titles.input;F6Node.collapsable=!0;F6Node.blocks="Blocks";F6Node.prototype.resizable=!1;F6Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F6Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F6)};
F6Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F6)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F6)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F6)&&this.triggerSlot(2,"Released")};
function F7Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F7Node.title="F7";F7Node.title_color=NodesHelper.titles.input;F7Node.collapsable=!0;F7Node.blocks="Blocks";F7Node.prototype.resizable=!1;F7Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F7Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F7)};
F7Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F7)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F7)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F7)&&this.triggerSlot(2,"Released")};
function F8Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F8Node.title="F8";F8Node.title_color=NodesHelper.titles.input;F8Node.collapsable=!0;F8Node.blocks="Blocks";F8Node.prototype.resizable=!1;F8Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F8Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F8)};
F8Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F8)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F8)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F8)&&this.triggerSlot(2,"Released")};
function F9Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F9Node.title="F9";F9Node.title_color=NodesHelper.titles.input;F9Node.collapsable=!0;F9Node.blocks="Blocks";F9Node.prototype.resizable=!1;F9Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F9Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F9)};
F9Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F9)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F9)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F9)&&this.triggerSlot(2,"Released")};
function F10Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F10Node.title="F10";F10Node.title_color=NodesHelper.titles.input;F10Node.collapsable=!0;F10Node.blocks="Blocks";F10Node.prototype.resizable=!1;F10Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F10Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F10)};
F10Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F10)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F10)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F10)&&this.triggerSlot(2,"Released")};
function F11Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F11Node.title="F11";F11Node.title_color=NodesHelper.titles.input;F11Node.collapsable=!0;F11Node.blocks="Blocks";F11Node.prototype.resizable=!1;F11Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F11Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F11)};
F11Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F11)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F11)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F11)&&this.triggerSlot(2,"Released")};
function F12Node(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}F12Node.title="F12";F12Node.title_color=NodesHelper.titles.input;F12Node.collapsable=!0;F12Node.blocks="Blocks";F12Node.prototype.resizable=!1;F12Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F12Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F12)};
F12Node.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.F12)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.F12)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.F12)&&this.triggerSlot(2,"Released")};
function GNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}GNode.title="G";GNode.title_color=NodesHelper.titles.input;GNode.collapsable=!0;GNode.blocks="Blocks";GNode.prototype.resizable=!1;GNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.G)};
GNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.G)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.G)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.G)&&this.triggerSlot(2,"Released")};
function HNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}HNode.title="H";HNode.title_color=NodesHelper.titles.input;HNode.collapsable=!0;HNode.blocks="Blocks";HNode.prototype.resizable=!1;HNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;HNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.H)};
HNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.H)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.H)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.H)&&this.triggerSlot(2,"Released")};
function HomeNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}HomeNode.title="Home";HomeNode.title_color=NodesHelper.titles.input;HomeNode.collapsable=!0;HomeNode.blocks="Blocks";HomeNode.prototype.resizable=!1;HomeNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;HomeNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.HOME)};
HomeNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.HOME)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.HOME)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.HOME)&&this.triggerSlot(2,"Released")};
function INode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}INode.title="I";INode.title_color=NodesHelper.titles.input;INode.collapsable=!0;INode.blocks="Blocks";INode.prototype.resizable=!1;INode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;INode.prototype.onStart=function(){this.setOutputData(3,Keyboard.I)};
INode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.I)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.I)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.I)&&this.triggerSlot(2,"Released")};
function InsertNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}InsertNode.title="Insert";InsertNode.title_color=NodesHelper.titles.input;InsertNode.collapsable=!0;InsertNode.blocks="Blocks";InsertNode.prototype.resizable=!1;InsertNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;InsertNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.INSERT)};
InsertNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.INSERT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.INSERT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.INSERT)&&this.triggerSlot(2,"Released")};
function JNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}JNode.title="J";JNode.title_color=NodesHelper.titles.input;JNode.collapsable=!0;JNode.blocks="Blocks";JNode.prototype.resizable=!1;JNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;JNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.J)};
JNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.J)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.J)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.J)&&this.triggerSlot(2,"Released")};
function KNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}KNode.title="K";KNode.title_color=NodesHelper.titles.input;KNode.collapsable=!0;KNode.blocks="Blocks";KNode.prototype.resizable=!1;KNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;KNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.K)};
KNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.K)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.K)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.K)&&this.triggerSlot(2,"Released")};
function LNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}LNode.title="L";LNode.title_color=NodesHelper.titles.input;LNode.collapsable=!0;LNode.blocks="Blocks";LNode.prototype.resizable=!1;LNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;LNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.L)};
LNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.L)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.L)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.L)&&this.triggerSlot(2,"Released")};
function LeftNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}LeftNode.title="Left";LeftNode.title_color=NodesHelper.titles.input;LeftNode.collapsable=!0;LeftNode.blocks="Blocks";LeftNode.prototype.resizable=!1;LeftNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;LeftNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.LEFT)};
LeftNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.LEFT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.LEFT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.LEFT)&&this.triggerSlot(2,"Released")};
function MNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}MNode.title="M";MNode.title_color=NodesHelper.titles.input;MNode.collapsable=!0;MNode.blocks="Blocks";MNode.prototype.resizable=!1;MNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;MNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.M)};
MNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.M)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.M)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.M)&&this.triggerSlot(2,"Released")};
function NNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}NNode.title="N";NNode.title_color=NodesHelper.titles.input;NNode.collapsable=!0;NNode.blocks="Blocks";NNode.prototype.resizable=!1;NNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;NNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.N)};
NNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.N)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.N)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.N)&&this.triggerSlot(2,"Released")};
function ONode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ONode.title="O";ONode.title_color=NodesHelper.titles.input;ONode.collapsable=!0;ONode.blocks="Blocks";ONode.prototype.resizable=!1;ONode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ONode.prototype.onStart=function(){this.setOutputData(3,Keyboard.O)};
ONode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.O)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.O)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.O)&&this.triggerSlot(2,"Released")};
function PNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}PNode.title="P";PNode.title_color=NodesHelper.titles.input;PNode.collapsable=!0;PNode.blocks="Blocks";PNode.prototype.resizable=!1;PNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.P)};
PNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.P)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.P)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.P)&&this.triggerSlot(2,"Released")};
function PageUpNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}PageUpNode.title="PageUp";PageUpNode.title_color=NodesHelper.titles.input;PageUpNode.collapsable=!0;PageUpNode.blocks="Blocks";PageUpNode.prototype.resizable=!1;PageUpNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PageUpNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.PAGE_UP)};
PageUpNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.PAGE_UP)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.PAGE_UP)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.PAGE_UP)&&this.triggerSlot(2,"Released")};
function PageDownNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}PageDownNode.title="PageDown";PageDownNode.title_color=NodesHelper.titles.input;PageDownNode.collapsable=!0;PageDownNode.blocks="Blocks";PageDownNode.prototype.resizable=!1;PageDownNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
PageDownNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.PAGE_DOWN)};PageDownNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.PAGE_DOWN)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.PAGE_DOWN)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.PAGE_DOWN)&&this.triggerSlot(2,"Released")};
function QNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}QNode.title="Q";QNode.title_color=NodesHelper.titles.input;QNode.collapsable=!0;QNode.blocks="Blocks";QNode.prototype.resizable=!1;QNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;QNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Q)};
QNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.Q)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.Q)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.Q)&&this.triggerSlot(2,"Released")};
function RNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}RNode.title="R";RNode.title_color=NodesHelper.titles.input;RNode.collapsable=!0;RNode.blocks="Blocks";RNode.prototype.resizable=!1;RNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;RNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.R)};
RNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.R)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.R)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.R)&&this.triggerSlot(2,"Released")};
function RightNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}RightNode.title="Right";RightNode.title_color=NodesHelper.titles.input;RightNode.collapsable=!0;RightNode.blocks="Blocks";RightNode.prototype.resizable=!1;RightNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;RightNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.RIGHT)};
RightNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.RIGHT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.RIGHT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.RIGHT)&&this.triggerSlot(2,"Released")};
function SNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}SNode.title="S";SNode.title_color=NodesHelper.titles.input;SNode.collapsable=!0;SNode.blocks="Blocks";SNode.prototype.resizable=!1;SNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;SNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.S)};
SNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.S)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.S)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.S)&&this.triggerSlot(2,"Released")};
function ShiftNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ShiftNode.title="Shift";ShiftNode.title_color=NodesHelper.titles.input;ShiftNode.collapsable=!0;ShiftNode.blocks="Blocks";ShiftNode.prototype.resizable=!1;ShiftNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ShiftNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.SHIFT)};
ShiftNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.SHIFT)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.SHIFT)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.SHIFT)&&this.triggerSlot(2,"Released")};
function SpacebarNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}SpacebarNode.title="Spacebar";SpacebarNode.title_color=NodesHelper.titles.input;SpacebarNode.collapsable=!0;SpacebarNode.blocks="Blocks";SpacebarNode.prototype.resizable=!1;SpacebarNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SpacebarNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.SPACEBAR)};SpacebarNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.SPACEBAR)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.SPACEBAR)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.SPACEBAR)&&this.triggerSlot(2,"Released")};
function TNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}TNode.title="T";TNode.title_color=NodesHelper.titles.input;TNode.collapsable=!0;TNode.blocks="Blocks";TNode.prototype.resizable=!1;TNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;TNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.T)};
TNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.T)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.T)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.T)&&this.triggerSlot(2,"Released")};
function TabNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));
this.addOutput("Key","key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}TabNode.title="Tab";TabNode.title_color=NodesHelper.titles.input;TabNode.collapsable=!0;TabNode.blocks="Blocks";TabNode.prototype.resizable=!1;TabNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;TabNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.TAB)};
TabNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.TAB)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.TAB)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.TAB)&&this.triggerSlot(2,"Released")};
function UNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}UNode.title="U";UNode.title_color=NodesHelper.titles.input;UNode.collapsable=!0;UNode.blocks="Blocks";UNode.prototype.resizable=!1;UNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;UNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.U)};
UNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.U)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.U)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.U)&&this.triggerSlot(2,"Released")};
function UpNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}UpNode.title="Up";UpNode.title_color=NodesHelper.titles.input;UpNode.collapsable=!0;UpNode.blocks="Blocks";UpNode.prototype.resizable=!1;UpNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;UpNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.UP)};
UpNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.UP)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.UP)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.UP)&&this.triggerSlot(2,"Released")};
function VNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}VNode.title="V";VNode.title_color=NodesHelper.titles.input;VNode.collapsable=!0;VNode.blocks="Blocks";VNode.prototype.resizable=!1;VNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.V)};
VNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.V)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.V)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.V)&&this.triggerSlot(2,"Released")};
function WNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}WNode.title="W";WNode.title_color=NodesHelper.titles.input;WNode.collapsable=!0;WNode.blocks="Blocks";WNode.prototype.resizable=!1;WNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;WNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.W)};
WNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.W)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.W)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.W)&&this.triggerSlot(2,"Released")};
function XNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}XNode.title="X";XNode.title_color=NodesHelper.titles.input;XNode.collapsable=!0;XNode.blocks="Blocks";XNode.prototype.resizable=!1;XNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;XNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.X)};
XNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.X)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.X)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.X)&&this.triggerSlot(2,"Released")};
function YNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}YNode.title="Y";YNode.title_color=NodesHelper.titles.input;YNode.collapsable=!0;YNode.blocks="Blocks";YNode.prototype.resizable=!1;YNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;YNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Y)};
YNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.Y)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.Y)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.Y)&&this.triggerSlot(2,"Released")};
function ZNode(){this.addOutput("Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y1]}));this.addOutput("Just Pressed",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_second]}));this.addOutput("Released",LiteGraph.EVENT,Object.assign({},NodesHelper.slots.event,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_third]}));this.addOutput("Key",
"key",Object.assign({},NodesHelper.slots.keyinput,{pos:[NodesHelper.slots.position.x1-10,NodesHelper.slots.position.y_fourth]}));this.size[0]=NodesHelper.sizes.small[0]-10}ZNode.title="Z";ZNode.title_color=NodesHelper.titles.input;ZNode.collapsable=!0;ZNode.blocks="Blocks";ZNode.prototype.resizable=!1;ZNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ZNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Z)};
ZNode.prototype.onExecute=function(){Keyboard.keyPressed(Keyboard.Z)&&this.triggerSlot(0,"Pressed");Keyboard.keyJustPressed(Keyboard.Z)&&this.triggerSlot(1,"JustPressed");Keyboard.keyJustReleased(Keyboard.Z)&&this.triggerSlot(2,"Released")};
function registerKeyboardNodes(){LiteGraph.registerNodeType("Input/Keyboard/A",ANode);LiteGraph.registerNodeType("Input/Keyboard/Alt",AltNode);LiteGraph.registerNodeType("Input/Keyboard/B",BNode);LiteGraph.registerNodeType("Input/Keyboard/Backspace",BackspaceNode);LiteGraph.registerNodeType("Input/Keyboard/C",CNode);LiteGraph.registerNodeType("Input/Keyboard/CapsLock",CapsLockNode);LiteGraph.registerNodeType("Input/Keyboard/Ctrl",CtrlNode);LiteGraph.registerNodeType("Input/Keyboard/D",DNode);LiteGraph.registerNodeType("Input/Keyboard/Del",
DelNode);LiteGraph.registerNodeType("Input/Keyboard/Down",DownNode);LiteGraph.registerNodeType("Input/Keyboard/E",ENode);LiteGraph.registerNodeType("Input/Keyboard/End",EndNode);LiteGraph.registerNodeType("Input/Keyboard/Enter",EnterNode);LiteGraph.registerNodeType("Input/Keyboard/Esc",EscNode);LiteGraph.registerNodeType("Input/Keyboard/F",FNode);LiteGraph.registerNodeType("Input/Keyboard/F1",F1Node);LiteGraph.registerNodeType("Input/Keyboard/F2",F2Node);LiteGraph.registerNodeType("Input/Keyboard/F3",
F3Node);LiteGraph.registerNodeType("Input/Keyboard/F4",F4Node);LiteGraph.registerNodeType("Input/Keyboard/F5",F5Node);LiteGraph.registerNodeType("Input/Keyboard/F6",F6Node);LiteGraph.registerNodeType("Input/Keyboard/F7",F7Node);LiteGraph.registerNodeType("Input/Keyboard/F8",F8Node);LiteGraph.registerNodeType("Input/Keyboard/F9",F9Node);LiteGraph.registerNodeType("Input/Keyboard/F10",F10Node);LiteGraph.registerNodeType("Input/Keyboard/F11",F11Node);LiteGraph.registerNodeType("Input/Keyboard/F12",F12Node);
LiteGraph.registerNodeType("Input/Keyboard/G",GNode);LiteGraph.registerNodeType("Input/Keyboard/H",HNode);LiteGraph.registerNodeType("Input/Keyboard/Home",HomeNode);LiteGraph.registerNodeType("Input/Keyboard/I",INode);LiteGraph.registerNodeType("Input/Keyboard/Insert",InsertNode);LiteGraph.registerNodeType("Input/Keyboard/J",JNode);LiteGraph.registerNodeType("Input/Keyboard/K",KNode);LiteGraph.registerNodeType("Input/Keyboard/L",LNode);LiteGraph.registerNodeType("Input/Keyboard/Left",LeftNode);LiteGraph.registerNodeType("Input/Keyboard/M",
MNode);LiteGraph.registerNodeType("Input/Keyboard/N",NNode);LiteGraph.registerNodeType("Input/Keyboard/O",ONode);LiteGraph.registerNodeType("Input/Keyboard/P",PNode);LiteGraph.registerNodeType("Input/Keyboard/PageUp",PageUpNode);LiteGraph.registerNodeType("Input/Keyboard/PageDown",PageDownNode);LiteGraph.registerNodeType("Input/Keyboard/Q",QNode);LiteGraph.registerNodeType("Input/Keyboard/R",RNode);LiteGraph.registerNodeType("Input/Keyboard/Right",RightNode);LiteGraph.registerNodeType("Input/Keyboard/S",
SNode);LiteGraph.registerNodeType("Input/Keyboard/Shift",ShiftNode);LiteGraph.registerNodeType("Input/Keyboard/Spacebar",SpacebarNode);LiteGraph.registerNodeType("Input/Keyboard/T",TNode);LiteGraph.registerNodeType("Input/Keyboard/Tab",TabNode);LiteGraph.registerNodeType("Input/Keyboard/U",UNode);LiteGraph.registerNodeType("Input/Keyboard/Up",UpNode);LiteGraph.registerNodeType("Input/Keyboard/V",VNode);LiteGraph.registerNodeType("Input/Keyboard/W",WNode);LiteGraph.registerNodeType("Input/Keyboard/X",
XNode);LiteGraph.registerNodeType("Input/Keyboard/Y",YNode);LiteGraph.registerNodeType("Input/Keyboard/Z",ZNode)}
function MaterialNode(){this.addInput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Emissive","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Reflectivity","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addInput("Shininess","number",
Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fourth]}));this.addInput("Specular","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fifth]}));this.addInput("Wireframe","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_sixth]}));this.addInput("Transparent","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x,
NodesHelper.slots.position.y_seventh]}));this.addInput("Opacity","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_eighth]}));this.addInput("Affected By Fog","bool",Object.assign({},NodesHelper.slots.bool,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_ninth]}));this.serialize_widgets=!0;this.properties={reflectivity:1,shininess:30,wireframe:!1,depthwrite:!1,transparent:!1,opacity:1,abf:!0};var b=this;this.widget1=this.addWidget("slider",
"Reflectivity",this.properties.reflectivity,h=>{b.properties.reflectivity=h},{value:this.properties.reflectivity,min:0,max:1,text:"R"});this.widget2=this.addWidget("slider","Shininess",this.properties.shininess,h=>{b.properties.shininess=h},{value:this.properties.shininess,min:0,max:100,text:"S"});this.addWidget("toggle","Wireframe",this.properties.wireframe,"wireframe");this.addWidget("toggle","Depth Write",this.properties.depthwrite,"depthwrite");this.addWidget("toggle","Transparent",this.properties.transparent,
"transparent");this.widget3=this.addWidget("slider","Opacity",this.properties.opacity,h=>{b.properties.opacity=h},{value:this.properties.opacity,min:0,max:1});this.addWidget("toggle","Affected By Fog",this.properties.abf,"abf")}MaterialNode.title="Material";MaterialNode.title_color=NodesHelper.titles.material;MaterialNode.collapsable=!1;MaterialNode.skip_list=!0;MaterialNode.prototype.resizable=!1;
MaterialNode.prototype.onPropertyChanged=function(b,h){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange();"reflectivity"===b?void 0!==this.widget1&&(this.widget1.value=h):"shininess"===b?void 0!==this.widget2&&(this.widget2.value=h):"opacity"===b&&void 0!==this.widget3&&(this.widget3.value=h)};
MaterialNode.prototype.onExecute=function(){if(void 0!==this.graph.extra){var b=this.graph.extra.material;b.nodes}if(void 0!==b){var h=this.getInputData(0),l=this.getInputData(1),e=this.getInputData(2),r=this.getInputData(3),q=this.getInputData(4),k=this.getInputData(5),t=this.getInputData(6),p=this.getInputData(7),y=this.getInputData(8),A=this.getInputData(9);void 0!==h&&(b.color=h);void 0!==l&&(b.emissive=l);b.reflectivity=void 0!==e?e:this.properties.reflectivity;b.shininess=void 0!==r?r:this.properties.shininess;
void 0!==q&&(b.specular=q);b.wireframe=void 0!==k?k:this.properties.wireframe;b.depthWrite=void 0!==t?t:this.properties.depthwrite;b.transparent=void 0!==p?p:this.properties.transparent;b.opacity=void 0!==y?y:this.properties.opacity;b.fog=void 0!==A?A:this.properties.abf}};function MaterialSideNode(){this.serialize_widgets=!0;this.properties={side:THREE.FontSide,sides:"Front;Back;Double",sideStr:""};this.side="";this.sides=this.properties.sides.split(";")}MaterialSideNode.title="Side";
MaterialSideNode.title_color=NodesHelper.titles.material;MaterialSideNode.collapsable=!0;MaterialSideNode.prototype.resizable=!1;
MaterialSideNode.prototype.onAdded=function(){var b=this;this.properties.side=this.graph.extra.material.side;this.properties.side===THREE.FrontSide?this.side="Front":this.properties.side===THREE.BackSide?this.side="Back":this.properties.side===THREE.DoubleSide&&(this.side="Double");this.combo=this.addWidget("combo","Side",this.side,h=>{b.properties.sideStr=h},{values:this.sides,property:"sideStr"});this.combo.width=160;this.size=[160,30]};
MaterialSideNode.prototype.onPropertyChanged=function(b,h){var l=this.graph.extra.material;"sideStr"===b&&("Front"===h?l.side=THREE.FrontSide:"Back"===h?l.side=THREE.BackSide:"Double"===h&&(l.side=THREE.DoubleSide));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialDepthTestNode(){this.serialize_widgets=!0;this.properties={test:!1}}MaterialDepthTestNode.title="Depth Test";MaterialDepthTestNode.title_color=NodesHelper.titles.material;
MaterialDepthTestNode.collapsable=!0;MaterialDepthTestNode.prototype.resizable=!1;MaterialDepthTestNode.prototype.onAdded=function(){this.properties.test=this.graph.extra.material.depthTest;this.addWidget("toggle","Depth Test",this.properties.test,"test").width=160;this.size=[160,30]};MaterialDepthTestNode.prototype.onPropertyChanged=function(b,h){this.graph.extra.material.depthTest=h;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialAlphaTestNode(){this.serialize_widgets=!0;this.properties={test:!1}}MaterialAlphaTestNode.title="Alpha Test";MaterialAlphaTestNode.title_color=NodesHelper.titles.material;MaterialAlphaTestNode.collapsable=!0;MaterialAlphaTestNode.prototype.resizable=!1;MaterialAlphaTestNode.prototype.onAdded=function(){this.properties.test=this.graph.extra.material.alphaTest;this.addWidget("toggle","Alpha Test",this.properties.test,"test").width=160;this.size=[160,30]};
MaterialAlphaTestNode.prototype.onPropertyChanged=function(b,h){this.graph.extra.material.alphaTest=h;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialBlendingModeNode(){this.serialize_widgets=!0;this.properties={blending:THREE.NoBlending,modes:"None;Normal;Additive;Subtractive;Multiply",blendingStr:""};this.blending="";this.modes=this.properties.modes.split(";")}MaterialBlendingModeNode.title="Blending Mode";
MaterialBlendingModeNode.title_color=NodesHelper.titles.material;MaterialBlendingModeNode.collapsable=!0;MaterialBlendingModeNode.prototype.resizable=!1;
MaterialBlendingModeNode.prototype.onAdded=function(){var b=this;this.properties.blending=this.graph.extra.material.blending;this.properties.blending===THREE.NoBlending?this.blending="None":this.properties.blending===THREE.NormalBlending?this.blending="Normal":this.properties.blending===THREE.AdditiveBlending?this.blending="Additive":this.properties.blending===THREE.SubtractiveBlending?this.blending="Subtractive":this.properties.blending===THREE.MultiplyBlending&&(this.blending="Multiply");this.combo=
this.addWidget("combo","Blending",this.blending,h=>{b.properties.blendingStr=h},{values:this.modes,property:"blendingStr"});this.combo.width=200;this.size=[200,30]};
MaterialBlendingModeNode.prototype.onPropertyChanged=function(b,h){var l=this.graph.extra.material;"blendingStr"===b&&("None"===h?l.blending=THREE.NoBlending:"Normal"===h?l.blending=THREE.NormalBlending:"Additive"===h?l.blending=THREE.AdditiveBlending:"Subtractive"===h?l.blending=THREE.SubtractiveBlending:"Multiply"===h&&(l.blending=THREE.MultiplyBlending));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialSkinningNode(){this.serialize_widgets=!0;this.properties={skinning:!1}}MaterialSkinningNode.title="Skinning";MaterialSkinningNode.title_color=NodesHelper.titles.material;MaterialSkinningNode.collapsable=!0;MaterialSkinningNode.prototype.resizable=!1;MaterialSkinningNode.prototype.onAdded=function(){this.properties.skinning=this.graph.extra.material.skinning;this.addWidget("toggle","Skinning",this.properties.skinning,"skinning").width=160;this.size=[160,30]};
MaterialSkinningNode.prototype.onPropertyChanged=function(){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialMorphTargetsNode(){this.serialize_widgets=!0;this.properties={morphTargets:!1}}MaterialMorphTargetsNode.title="Morph Targets";MaterialMorphTargetsNode.title_color=NodesHelper.titles.material;MaterialMorphTargetsNode.collapsable=!0;MaterialMorphTargetsNode.prototype.resizable=!1;
MaterialMorphTargetsNode.prototype.onAdded=function(){this.properties.morphTargets=this.graph.extra.material.morphTargets;this.addWidget("toggle","Morph Targets",this.properties.morphTargets,"morphTargets").width=180;this.size=[180,30]};MaterialMorphTargetsNode.prototype.onPropertyChanged=function(){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialColourNode(){this.addInput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}MaterialColourNode.title="Colour";MaterialColourNode.title_color=NodesHelper.titles.material;MaterialColourNode.collapsable=!0;MaterialColourNode.prototype.resizable=!1;MaterialColourNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};
MaterialColourNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.mat.color=b)};function MaterialMapNode(){this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}MaterialMapNode.title="Map";MaterialMapNode.title_color=NodesHelper.titles.material;MaterialMapNode.collapsable=!0;MaterialMapNode.prototype.resizable=!1;
MaterialMapNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};MaterialMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.mat.map=b)};function MaterialAlphaMapNode(){this.addInput("Alpha","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}MaterialAlphaMapNode.title="Alpha Map";MaterialAlphaMapNode.title_color=NodesHelper.titles.material;
MaterialAlphaMapNode.collapsable=!0;MaterialAlphaMapNode.prototype.resizable=!1;MaterialAlphaMapNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};MaterialAlphaMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.mat.alphaMap=b)};
function MaterialShadingNode(){this.serialize_widgets=!0;this.properties={shading:THREE.SmoothShading,shadings:"Smooth;Flat",shadingStr:""};this.shading="";this.shadings=this.properties.shadings.split(";");this.serialize_widgets=!0}MaterialShadingNode.title="Shading";MaterialShadingNode.title_color=NodesHelper.titles.material;MaterialShadingNode.collapsable=!0;MaterialShadingNode.prototype.resizable=!1;
MaterialShadingNode.prototype.onAdded=function(){var b=this;this.properties.shading=this.graph.extra.material.shading;this.properties.shading===THREE.SmoothShading?this.shading="Smooth":this.properties.shading===THREE.FlatShading&&(this.shading="Flat");this.combo=this.addWidget("combo","Shading",this.shading,h=>{b.properties.shadingStr=h},{values:this.shadings,property:"shadingStr"});this.combo.width=180;this.size=[180,30]};
MaterialShadingNode.prototype.onPropertyChanged=function(b,h){var l=this.graph.extra.material;"shadingStr"===b&&("Smooth"===h?l.shading=THREE.SmoothShading:"Flat"===h&&(l.shading=THREE.FlatShading));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialBumpMapNode(){this.properties={scale:0};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.serialize_widgets=!0}MaterialBumpMapNode.title="Bump";MaterialBumpMapNode.title_color=NodesHelper.titles.material;MaterialBumpMapNode.collapsable=!0;MaterialBumpMapNode.prototype.resizable=!1;
MaterialBumpMapNode.prototype.onAdded=function(){var b=this;this.material=this.graph.extra.material;this.properties.scale=void 0!==this.material.bumpScale?this.material.bumpScale:0;this.addWidget("slider","Scale",this.properties.scale,h=>{b.properties.scale=h},{min:0,max:1,property:"scale"})};MaterialBumpMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.bumpMap=b)};
MaterialBumpMapNode.prototype.onPropertyChanged=function(){this.material.bumpScale=this.properties.scale;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialNormalNode(){this.properties={scalex:1,scaley:1};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.serialize_widgets=!0}MaterialNormalNode.title="Normal";MaterialNormalNode.title_color=NodesHelper.titles.material;
MaterialNormalNode.collapsable=!0;MaterialNormalNode.prototype.resizable=!1;MaterialNormalNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.scalex=this.material.normalScale.x;this.properties.scaley=this.material.normalScale.y;this.addWidget("number","Scale X",this.properties.scalex,"scalex");this.addWidget("number","Scale Y",this.properties.scaley,"scaley")};
MaterialNormalNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.normalMap=b)};MaterialNormalNode.prototype.onPropertyChanged=function(){this.material.normalScale=new THREE.Vector2(this.properties.scalex,this.properties.scaley);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialDisplacementMapNode(){this.properties={scalex:0,bias:0};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.serialize_widgets=!0}MaterialDisplacementMapNode.title="Displacement";MaterialDisplacementMapNode.title_color=NodesHelper.titles.material;MaterialDisplacementMapNode.collapsable=!0;MaterialDisplacementMapNode.prototype.resizable=!1;
MaterialDisplacementMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.scale=void 0!==this.material.displacementScale?this.material.displacementScale:0;this.properties.bias=void 0!==this.material.displacementBias?this.material.displacementBias:0;this.addWidget("number","Scale",this.properties.scale,"scale");this.addWidget("number","Bias",this.properties.bias,"bias")};
MaterialDisplacementMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.displacementMap=b)};MaterialDisplacementMapNode.prototype.onPropertyChanged=function(b,h){"scale"===b?this.material.displacementScale=new this.properties.scale:"bias"===b&&(this.material.displacementBias=this.properties.bias)};
function MaterialSpecularMapNode(){this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}))}MaterialSpecularMapNode.title="Specular";MaterialSpecularMapNode.title_color=NodesHelper.titles.material;MaterialSpecularMapNode.collapsable=!0;MaterialSpecularMapNode.prototype.resizable=!1;MaterialSpecularMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material};
MaterialSpecularMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.specularMap=b)};
function MaterialEmissiveMapNode(){this.properties={intensity:0};this.addInput("Map","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Colour","color",Object.assign({},NodesHelper.slots.color,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.serialize_widgets=!0}MaterialEmissiveMapNode.title="Emissive";MaterialEmissiveMapNode.title_color=NodesHelper.titles.material;
MaterialEmissiveMapNode.collapsable=!0;MaterialEmissiveMapNode.prototype.resizable=!1;MaterialEmissiveMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.intensity=void 0!==this.material.emissiveIntensity?this.material.emissiveIntensity:0;this.addWidget("number","Intensity",this.properties.intensity,"intensity")};
MaterialEmissiveMapNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0!==b&&(this.material.emissiveMap=b);void 0!==h&&this.material.emissive.copy(h)};MaterialEmissiveMapNode.prototype.onPropertyChanged=function(b,h){"intensity"===b&&(this.material.emissiveIntensity=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialShaderNode(){this.properties={mat:null};this.addInput("Uniforms","json",Object.assign({},NodesHelper.slots.json,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}))}MaterialShaderNode.title="Shader";MaterialShaderNode.title_color=NodesHelper.titles.material;MaterialShaderNode.collapsable=!0;MaterialShaderNode.skip_list=!0;MaterialShaderNode.prototype.resizable=!1;
MaterialShaderNode.prototype.onDblClick=function(){var b=this.graph.extra.material,h=this.graph.extra.file;if(b instanceof THREE.ShaderMaterial){for(var l=!1,e=0;e<Interface.tab.options.length;e++)if(Interface.tab.options[e].component instanceof ShaderMaterialEditor&&Interface.tab.options[e].component.material===b){l=!0;Interface.tab.selectTab(e);break}l||(l=Interface.tab.addTab(b.name,Interface.file_dir+"Icons/Misc/material.png",!0),e=new ShaderMaterialEditor,e.attachMaterial(b,h),l.attachComponent(e),
l.select())}};
function registerMaterialNodes(){LiteGraph.registerNodeType("Material/Material",MaterialNode);LiteGraph.registerNodeType("Material/Shader",MaterialShaderNode);LiteGraph.registerNodeType("Material/Side",MaterialSideNode);LiteGraph.registerNodeType("Material/DepthTest",MaterialDepthTestNode);LiteGraph.registerNodeType("Material/AlphaTest",MaterialAlphaTestNode);LiteGraph.registerNodeType("Material/BlendingMode",MaterialBlendingModeNode);LiteGraph.registerNodeType("Material/Skinning",MaterialSkinningNode);LiteGraph.registerNodeType("Material/MorphTargets",
MaterialMorphTargetsNode);LiteGraph.registerNodeType("Material/Colour",MaterialColourNode);LiteGraph.registerNodeType("Material/Map",MaterialMapNode);LiteGraph.registerNodeType("Material/AlphaMap",MaterialAlphaMapNode);LiteGraph.registerNodeType("Material/Shading",MaterialShadingNode);LiteGraph.registerNodeType("Material/BumpMap",MaterialBumpMapNode);LiteGraph.registerNodeType("Material/NormalMap",MaterialNormalNode);LiteGraph.registerNodeType("Material/DisplacementMap",MaterialDisplacementMapNode);
LiteGraph.registerNodeType("Material/SpecularMap",MaterialSpecularMapNode);LiteGraph.registerNodeType("Material/EmissiveMap",MaterialEmissiveMapNode)}
function ParticlesNode(){this.addInput("Direction","string",Object.assign({},NodesHelper.slots.string,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Count","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}));this.addInput("Rate","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_third]}));this.addInput("Duration","number",Object.assign({},
NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fourth]}));this.addInput("Wiggle","number",Object.assign({},NodesHelper.slots.number,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_fifth]}));this.serialize_widgets=!0;this.properties={direction:"Forward",directions:"Forward;Backward",count:2E3,rate:2E3,duration:0,wiggle:0}}ParticlesNode.title="Particles";ParticlesNode.title_color=NodesHelper.titles.particles;ParticlesNode.skip_list=!0;
ParticlesNode.collapsable=!1;ParticlesNode.prototype.resizable=!1;
ParticlesNode.prototype.onAdded=function(){var b=this,h=this.graph.extra.particles.emitter,l=this.graph.extra.particles.group;this.emitter=h;this.group=l;this.properties.direction=1===h.direction?"Forward":"Backward";this.properties.count=l.maxParticleCount;this.properties.rate=h.particleCount;this.properties.duration=h.duration;this.properties.wiggle=h.wiggle.value;this.dir=this.addWidget("combo","Direction",this.properties.direction,e=>{b.properties.direction=e},{property:"direction",values:this.properties.directions.split(";")});
this.count=this.addWidget("number","Max Count",this.properties.count,"count");this.rate=this.addWidget("slider","Rate",this.properties.rate,e=>{b.properties.rate=e},{value:this.properties.rate,min:0,max:this.properties.count,property:"rate"});this.duration=this.addWidget("number","Duration",this.properties.duration,"duration");this.wiggle=this.addWidget("number","Wiggle",this.properties.wiggle,"wiggle")};
ParticlesNode.prototype.onPropertyChanged=function(b,h){"direction"===b&&("Forward"===h?this.emitter.direction=1:"Backward"===h&&(this.emitter.direction=-1));"count"===b&&(this.group.maxParticleCount=parseInt(h),this.rate.options.max=parseInt(h),this.rate.value>parseInt(h)&&(this.emitter.particleCount=parseInt(h),this.rate.value=parseInt(h)));"rate"===b&&(this.emitter.particleCount=parseInt(h));"duration"===b&&(this.emitter.duration=.01>h?null:h);"wiggle"===b&&(this.emitter.wiggle.value=parseInt(h));
if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesTextureNode(){this.serialize_widgets=!0;this.addInput("Texture","texture",Object.assign({},NodesHelper.slots.texture,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.size=[120,26]}ParticlesTextureNode.title="Texture";ParticlesTextureNode.title_color=NodesHelper.titles.particles;ParticlesTextureNode.collapsable=!0;ParticlesTextureNode.prototype.resizable=!1;
ParticlesTextureNode.prototype.onAdded=function(){this.group=this.graph.extra.particles.group};ParticlesTextureNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.group.texture=b)};function ParticlesBlendingModeNode(){this.serialize_widgets=!0;this.properties={blending:"NaN",modes:"None;Normal;Additive;Subtractive;Multiply"}}ParticlesBlendingModeNode.title="Blending";ParticlesBlendingModeNode.title_color=NodesHelper.titles.particles;
ParticlesBlendingModeNode.collapsable=!0;ParticlesBlendingModeNode.prototype.resizable=!1;
ParticlesBlendingModeNode.prototype.onAdded=function(){this.group=this.graph.extra.particles.group;this.blending=this.group.blending;var b="",h=this;this.blending===THREE.NoBlending?b="None":this.blending===THREE.NormalBlending?b="Normal":this.blending===THREE.AdditiveBlending?b="Additive":this.blending===THREE.SubtractiveBlending?b="Subtractive":this.blending===THREE.MultiplyBlending&&(b="Multiply");this.properties.blending=b;this.addWidget("combo","Blending",b,l=>{h.properties.blending=l},{property:"blending",
values:this.properties.modes.split(";"),width:200});this.size=[200,26]};ParticlesBlendingModeNode.prototype.onPropertyChanged=function(b,h){"blending"===b&&(console.log(h),"None"===h?this.group.blending=THREE.NoBlending:"Normal"===h?this.group.blending=THREE.NormalBlending:"Additive"===h?this.group.blending=THREE.AdditiveBlending:"Subtractive"===h?this.group.blending=THREE.SubtractiveBlending:"Multiply"===h&&(this.group.blending=THREE.MultiplyBlending));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesEmitterTypeNode(){this.serialize_widgets=!0;this.properties={type:"NaN",types:"Box;Sphere;Disc"}}ParticlesEmitterTypeNode.title="Emitter Type";ParticlesEmitterTypeNode.title_color=NodesHelper.titles.particles;ParticlesEmitterTypeNode.collapsable=!0;ParticlesEmitterTypeNode.prototype.resizable=!1;
ParticlesEmitterTypeNode.prototype.onAdded=function(){this.emitter=this.graph.extra.particles.emitter;var b="",h=this;this.emitter.type===SPE.distributions.BOX?b="Box":this.emitter.type===SPE.distributions.SPHERE?b="Sphere":this.emitter.type===SPE.distributions.DISC&&(b="Disc");this.properties.type=b;this.addWidget("combo","Type",b,l=>{h.properties.type=l},{property:"type",values:this.properties.types.split(";"),width:180});this.size=[180,26]};
ParticlesEmitterTypeNode.prototype.onPropertyChanged=function(b,h){"type"===b&&("Box"===h?this.emitter.type=SPE.distributions.BOX:"Sphere"===h?this.emitter.type=SPE.distributions.SPHERE:"Disc"===h&&(this.emitter.type=SPE.distributions.DISC));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesMaxAgeNode(){this.serialize_widgets=!0;this.properties={value:0,spread:0}}ParticlesMaxAgeNode.title="Max Age";ParticlesMaxAgeNode.title_color=NodesHelper.titles.particles;
ParticlesMaxAgeNode.collapsable=!0;ParticlesMaxAgeNode.prototype.resizable=!1;ParticlesMaxAgeNode.prototype.onAdded=function(){this.maxAge=this.graph.extra.particles.emitter.maxAge;this.value=this.maxAge.value;this.spread=this.maxAge.spread;this.properties.value=this.value;this.properties.spread=this.spread;this.addWidget("number","Value",this.properties.value,"value");this.addWidget("number","Spread",this.properties.spread,"spread");this.size=[160,52]};
ParticlesMaxAgeNode.prototype.onPropertyChanged=function(b,h){"value"===b?this.value=h:"spread"===b&&(this.spread=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesPositionNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesPositionNode.title="Position";ParticlesPositionNode.title_color=NodesHelper.titles.particles;ParticlesPositionNode.collapsable=!0;
ParticlesPositionNode.prototype.resizable=!1;
ParticlesPositionNode.prototype.onAdded=function(){this.position=this.graph.extra.particles.emitter.position;this.value=this.position.value;this.spread=this.position.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,"spreadz");
this.size=[180,150]};ParticlesPositionNode.prototype.onPropertyChanged=function(b,h){if("x"===b||"y"===b||"z"===b)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===b||"spready"===b||"spreadz"===b)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesVelocityNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesVelocityNode.title="Velocity";ParticlesVelocityNode.title_color=NodesHelper.titles.particles;ParticlesVelocityNode.collapsable=!0;ParticlesVelocityNode.prototype.resizable=!1;
ParticlesVelocityNode.prototype.onAdded=function(){this.velocity=this.graph.extra.particles.emitter.velocity;this.value=this.velocity.value;this.spread=this.velocity.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,"spreadz");
this.size=[180,150]};ParticlesVelocityNode.prototype.onPropertyChanged=function(b,h){if("x"===b||"y"===b||"z"===b)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===b||"spready"===b||"spreadz"===b)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesAccelerationNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesAccelerationNode.title="Acceleration";ParticlesAccelerationNode.title_color=NodesHelper.titles.particles;ParticlesAccelerationNode.collapsable=!0;ParticlesAccelerationNode.prototype.resizable=!1;
ParticlesAccelerationNode.prototype.onAdded=function(){this.acceleration=this.graph.extra.particles.emitter.velocity;this.value=this.acceleration.value;this.spread=this.acceleration.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,
"spreadz");this.size=[180,150]};ParticlesAccelerationNode.prototype.onPropertyChanged=function(b,h){if("x"===b||"y"===b||"z"===b)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===b||"spready"===b||"spreadz"===b)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesWiggleNode(){this.serialize_widgets=!0;this.properties={wiggle:0,spread:0}}ParticlesWiggleNode.title="Wiggle";ParticlesWiggleNode.title_color=NodesHelper.titles.particles;ParticlesWiggleNode.collapsable=!0;ParticlesWiggleNode.prototype.resizable=!1;
ParticlesWiggleNode.prototype.onAdded=function(){this.wiggle=this.graph.extra.particles.emitter.wiggle;this.value=this.wiggle.value;this.spread=this.wiggle.spread;this.addWidget("number","Value",this.value,"wiggle");this.addWidget("number","Spread",this.spread,"spread")};ParticlesWiggleNode.prototype.onPropertyChanged=function(b,h){"wiggle"===b?this.value=h:"spread"===b&&(this.spread=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesOpacityNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesOpacityNode.title="Opacity";ParticlesOpacityNode.title_color=NodesHelper.titles.particles;ParticlesOpacityNode.collapsable=!0;ParticlesOpacityNode.prototype.resizable=!1;
ParticlesOpacityNode.prototype.onAdded=function(){this.opacity=this.graph.extra.particles.emitter.opacity};ParticlesOpacityNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.opacity.spread=h),this.opacity.value=b)};
function ParticlesScaleNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesScaleNode.title="Scale";ParticlesScaleNode.title_color=NodesHelper.titles.particles;ParticlesScaleNode.collapsable=!0;ParticlesScaleNode.prototype.resizable=!1;
ParticlesScaleNode.prototype.onAdded=function(){this.scale=this.graph.extra.particles.emitter.size};ParticlesScaleNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.scale.spread=h),this.scale.value=b)};
function ParticlesRotationNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesRotationNode.title="Rotation";ParticlesRotationNode.title_color=NodesHelper.titles.particles;ParticlesRotationNode.collapsable=!0;ParticlesRotationNode.prototype.resizable=!1;
ParticlesRotationNode.prototype.onAdded=function(){this.rotation=this.graph.extra.particles.emitter.angle};ParticlesRotationNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.rotation.spread=h),this.rotation.value=b)};
function ParticlesColourNode(){this.addInput("Value","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y]}));this.addInput("Spread","array",Object.assign({},NodesHelper.slots.array,{pos:[NodesHelper.slots.position.x,NodesHelper.slots.position.y_second]}))}ParticlesColourNode.title="Colour";ParticlesColourNode.title_color=NodesHelper.titles.particles;ParticlesColourNode.collapsable=!0;ParticlesColourNode.prototype.resizable=!1;
ParticlesColourNode.prototype.onAdded=function(){this.colour=this.graph.extra.particles.emitter.color};ParticlesColourNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.colour.spread=h),this.colour.value=b)};
function registerParticlesNodes(){LiteGraph.registerNodeType("Particles/Particles",ParticlesNode);LiteGraph.registerNodeType("Particles/ParticlesTexture",ParticlesTextureNode);LiteGraph.registerNodeType("Particles/ParticlesBlending",ParticlesBlendingModeNode);LiteGraph.registerNodeType("Particles/ParticlesEmitterType",ParticlesEmitterTypeNode);LiteGraph.registerNodeType("Particles/ParticlesMaxAge",ParticlesMaxAgeNode);LiteGraph.registerNodeType("Particles/ParticlesPosition",ParticlesPositionNode);
LiteGraph.registerNodeType("Particles/ParticlesVelocity",ParticlesVelocityNode);LiteGraph.registerNodeType("Particles/ParticlesAcceleration",ParticlesAccelerationNode);LiteGraph.registerNodeType("Particles/ParticlesWiggle",ParticlesWiggleNode);LiteGraph.registerNodeType("Particles/ParticlesOpacity",ParticlesOpacityNode);LiteGraph.registerNodeType("Particles/ParticlesScale",ParticlesScaleNode);LiteGraph.registerNodeType("Particles/ParticlesRotation",ParticlesRotationNode);LiteGraph.registerNodeType("Particles/ParticlesColour",
ParticlesColourNode)}
function Runtime(b){this.program=null;void 0===b?(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px",this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,document.body.appendChild(this.canvas),this.canvas_resize=!0):(this.canvas=b,this.canvas_resize=!1);this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});
this.renderer.autoClear=!1;this.renderer.shadowMap.enabled=!0;this.renderer.shadowMap.type=THREE.PCFShadowMap;this.renderer.setPixelRatio(window.devicePixelRatio||1);this.renderer.setSize(this.canvas.width,this.canvas.height)}Runtime.fullscreen=!1;Runtime.prototype.loadProgram=function(b){var h=new ObjectLoader;b=JSON.parse(FileSystem.readFile(b));this.program=h.parse(b)};
Runtime.prototype.run=function(){if(null===this.program)console.warn("Runtime: No program is loaded");else{Keyboard.initialize();Mouse.initialize();Mouse.setCanvas(this.canvas);this.program.vr&&(this.vr_controls=new VRControls,this.vr_effect=new THREE.VREffect(this.renderer));this.program.default_camera=new PerspectiveCamera(60,this.canvas.width/this.canvas.height,.1,1E6);this.program.default_camera.position.set(0,10,30);this.program.renderer=this.renderer;this.program.initialize();this.program.resize(this.canvas.width,
this.canvas.height);var b=this,h=function(){null!==b.program&&(requestAnimationFrame(h),b.update())};h()}};Runtime.prototype.update=function(){Mouse.update();Keyboard.update();this.program.update();this.program.render(this.renderer)};Runtime.prototype.exit=function(){null!==this.program&&(this.program.dispose(),this.program=null);Mouse.dispose();Keyboard.dispose();if(void 0!==this.onExit)this.onExit();void 0!==Runtime.gui&&(Runtime.gui.App.closeAllWindows(),Runtime.gui.App.quit())};
Runtime.prototype.resize=function(){null!==this.canvas&&this.canvas_resize&&(this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight);null!==this.renderer&&void 0!==this.renderer&&(this.renderer.setSize(this.canvas.width,this.canvas.height),this.program.resize(this.canvas.width,this.canvas.height))};Runtime.prototype.setOnExit=function(b){this.onExit=b};
Runtime.setFullscreen=function(b,h){(Runtime.fullscreen=b)?(void 0===h&&(h=document.body),h.requestFullscreen=h.requestFullscreen||h.mozRequestFullScreen||h.webkitRequestFullscreen||h.msRequestFullscreen,h.requestFullscreen&&h.requestFullscreen()):(document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen())};Runtime.webvravailable=function(){return void 0!==navigator.getVRDisplays};
