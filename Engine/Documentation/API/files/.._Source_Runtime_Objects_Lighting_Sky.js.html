<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../Source/Runtime/Objects/Lighting/Sky.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/ArraybufferUtils.html">ArraybufferUtils</a></li>
                                <li><a href="../classes/Audio.html">Audio</a></li>
                                <li><a href="../classes/AudioEmitter.html">AudioEmitter</a></li>
                                <li><a href="../classes/Base64Utils.html">Base64Utils</a></li>
                                <li><a href="../classes/BlockScript.html">BlockScript</a></li>
                                <li><a href="../classes/BufferUtils.html">BufferUtils</a></li>
                                <li><a href="../classes/CanvasTexture.html">CanvasTexture</a></li>
                                <li><a href="../classes/Container.html">Container</a></li>
                                <li><a href="../classes/DirectionalLight.html">DirectionalLight</a></li>
                                <li><a href="../classes/FileSystem.html">FileSystem</a></li>
                                <li><a href="../classes/Folder.html">Folder</a></li>
                                <li><a href="../classes/Font.html">Font</a></li>
                                <li><a href="../classes/GORLOT.html">GORLOT</a></li>
                                <li><a href="../classes/GORLOT.Image.html">GORLOT.Image</a></li>
                                <li><a href="../classes/HemisphereLight.html">HemisphereLight</a></li>
                                <li><a href="../classes/Key.html">Key</a></li>
                                <li><a href="../classes/Keyboard.html">Keyboard</a></li>
                                <li><a href="../classes/KinectDevice.html">KinectDevice</a></li>
                                <li><a href="../classes/LeapMotion.html">LeapMotion</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/Mesh.html">Mesh</a></li>
                                <li><a href="../classes/Mesh2shape.html">Mesh2shape</a></li>
                                <li><a href="../classes/Mouse.html">Mouse</a></li>
                                <li><a href="../classes/MultiMaterial.html">MultiMaterial</a></li>
                                <li><a href="../classes/ObjectUtils.html">ObjectUtils</a></li>
                                <li><a href="../classes/OrthographicCamera.html">OrthographicCamera</a></li>
                                <li><a href="../classes/ParticleEmitter.html">ParticleEmitter</a></li>
                                <li><a href="../classes/PerspectiveCamera.html">PerspectiveCamera</a></li>
                                <li><a href="../classes/PhysicsObject.html">PhysicsObject</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/PositionalAudio.html">PositionalAudio</a></li>
                                <li><a href="../classes/RectAreaLight.html">RectAreaLight</a></li>
                                <li><a href="../classes/Resource.html">Resource</a></li>
                                <li><a href="../classes/ResourceManager.html">ResourceManager</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/Script.html">Script</a></li>
                                <li><a href="../classes/SkinnedMesh.html">SkinnedMesh</a></li>
                                <li><a href="../classes/Sky.html">Sky</a></li>
                                <li><a href="../classes/SpineAnimation.html">SpineAnimation</a></li>
                                <li><a href="../classes/SpineTexture.html">SpineTexture</a></li>
                                <li><a href="../classes/SpotLight.html">SpotLight</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/Text3D.html">Text3D</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/THREE.Fog.html">THREE.Fog</a></li>
                                <li><a href="../classes/THREE.Object3D.html">THREE.Object3D</a></li>
                                <li><a href="../classes/Video.html">Video</a></li>
                                <li><a href="../classes/VideoTexture.html">VideoTexture</a></li>
                                <li><a href="../classes/WebcamTexture.html">WebcamTexture</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Animations.html">Animations</a></li>
                                <li><a href="../modules/Audio.html">Audio</a></li>
                                <li><a href="../modules/BinaryData.html">BinaryData</a></li>
                                <li><a href="../modules/Cameras.html">Cameras</a></li>
                                <li><a href="../modules/Core.html">Core</a></li>
                                <li><a href="../modules/Devices.html">Devices</a></li>
                                <li><a href="../modules/Input.html">Input</a></li>
                                <li><a href="../modules/Lights.html">Lights</a></li>
                                <li><a href="../modules/Meshes.html">Meshes</a></li>
                                <li><a href="../modules/Misc.html">Misc</a></li>
                                <li><a href="../modules/Particles.html">Particles</a></li>
                                <li><a href="../modules/Physics.html">Physics</a></li>
                                <li><a href="../modules/Resources.html">Resources</a></li>
                                <li><a href="../modules/Runtime.html">Runtime</a></li>
                                <li><a href="../modules/Script.html">Script</a></li>
                                <li><a href="../modules/Sprite.html">Sprite</a></li>
                                <li><a href="../modules/Textures.html">Textures</a></li>
                                <li><a href="../modules/THREE.html">THREE</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../Source/Runtime/Objects/Lighting/Sky.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;

/**
 * Sky class is composed of a Hemisphere Light, Directional Light and a dynamic generated Sky sphere geometry
 * This object is composed by 3 internal hidden children
 *  - Hemisphere Light
 *  - Directional Light
 *  - Mesh
 *
 * @param {Boolean} autoUpdate If true, sky auto updates its state
 * @param {Number} dayTime Day duration (in seconds)
 * @param {Number} sunDistance Distance of the sun
 * @param {Number} time Starting time
 *
 * @class Sky
 * @extends {Object3D}
 * @module Lights
 * @constructor
 */
function Sky(autoUpdate, dayTime, sunDistance, time)
{	
	THREE.Object3D.call(this)

	this.name = &quot;sky&quot;
	this.type = &quot;Sky&quot;

    /**
     * Clock used to control day time
     * @property clock
     * @type {Clock}
     */
	this.clock = new THREE.Clock()

    /**
     * Array with top sky colours
     * @property colorTop
     * @type {Array}
     */
    this.colorTop = [new THREE.Color(0x77b3fb), new THREE.Color(0x0076ff), new THREE.Color(0x035bb6), new THREE.Color(0x002439)]

    /**
     * Array with bottom sky colours
     * @property colorBottom
     * @type {Array}
     */
	this.colorBottom = [new THREE.Color(0xebece6), new THREE.Color(0xffffff), new THREE.Color(0xfee7d7), new THREE.Color(0x0065a7)]

    /**
     * Sun colour in hex RGB
     * @property sunColor
     * @type {Number}
     * @default {0xFFFFAA}
     */
	this.sunColor = 0xFFFFAA

    /**
     * Moon colour in hex RGB
     * @property moonColor
     * @type {Number}
     * @default 0x5555bb
     */
	this.moonColor = 0x5555bb

    /**
     * Hemisphere light used to match ambient light with sky colour
     * @property hemisphere
     * @type {HemisphereLight}
     */
	this.hemisphere = new THREE.HemisphereLight(0, 0, 0.6)
	this.hemisphere.color.setHSL(0.6, 1, 0.6)
	this.hemisphere.groundColor.setHSL(0.1, 1, 0.75)
	this.hemisphere.hidden = true
	this.hemisphere.rotationAutoUpdate = false
	this.hemisphere.matrixAutoUpdate = false
	this.add(this.hemisphere)

    /**
     * Directional light to simulate light and cast shadows
     * @property sun
     * @type {DirectionalLight}
     */
	this.sun = new THREE.DirectionalLight(this.sunColor, 0.5)
	this.sun.castShadow = true
	this.sun.hidden = true
	this.add(this.sun)

	// Vertex Shader
	var vertex = &quot;varying vec3 vWorldPosition; \
	void main() \
	{ \
		vec4 worldPosition = modelMatrix * vec4(position, 1.0); \
		vWorldPosition = worldPosition.xyz; \
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \
	}&quot;

	// Pixel shader
	var fragment = &quot;uniform vec3 topColor; \
	uniform vec3 bottomColor; \
	uniform float offset; \
	uniform float exponent; \
	varying vec3 vWorldPosition; \
	void main() \
	{ \
		float h = normalize(vWorldPosition + offset).y; \
		gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h , 0.0), exponent), 0.0)), 1.0); \
	}&quot;

	// Uniforms
	var uniforms =
	{
		topColor: {type: &quot;c&quot;, value: new THREE.Color(0.0, 0.46, 1.0)},
		bottomColor: {type: &quot;c&quot;, value: new THREE.Color(1.0, 1.0, 1.0)},
		offset:	{type: &quot;f&quot;, value: 20},
		exponent: {type: &quot;f&quot;, value: 0.4}
	}
	uniforms.topColor.value.copy(this.hemisphere.color)

	// Sky
	var geometry = new THREE.SphereBufferGeometry(1000, 16, 16)
	var material = new THREE.ShaderMaterial({vertexShader: vertex, fragmentShader: fragment, uniforms: uniforms, side: THREE.BackSide})

    /**
     * Sky mesh with material shader to calculate dinamically sky colour
     * @property sky
     * @type {Mesh}
     */
	this.sky = new THREE.Mesh(geometry, material)
	this.sky.hidden = true
	this.sky.rotationAutoUpdate = false
	this.sky.matrixAutoUpdate = false
	this.add(this.sky)

	// Override sky raycast function
	this.sky.raycast = function() {
		return null;
	}

    /**
     * If set to true, the sky auto updates its time
     * @property autoUpdate
     * @default true
     * @type {Boolean}
     */
	this.autoUpdate = (autoUpdate !== undefined) ? autoUpdate : true

    /**
     * Sun distance
     * @property sunDistance
     * @type {Number}
     */
	this.sunDistance = (sunDistance !== undefined) ? sunDistance : 100

    /**
     * Day time (in seconds)
     * @property dayTime
     * @type {number}
     */
	this.dayTime = (dayTime !== undefined) ? dayTime : 120

    /**
     * Current day time (in seconds)
     * @property time
     * @type {Number}
     */
	this.time = (time !== undefined) ? time : 75

	this.updateSky()

	this.components = []
	this.defaultComponents = []

	this.defaultComponents.push(new ElementComponent())
	this.defaultComponents.push(new ObjectComponent())
    this.defaultComponents.push(new SkyComponent())
}

Sky.prototype = Object.create(THREE.Object3D.prototype)

/**
 * Initialize sky object
 * Called automatically by the runtime handler (Editor / App)
 * @method initialize
 */
Sky.prototype.initialize = function()
{
	this.updateSky()
	
	for(var i = 0; i &lt; this.children.length; i++)
	{
		this.children[i].initialize()
	}
}

/**
 * Update sky state
 * Called automatically by the runtime handler (Editor / App)
 * @method update
 */
Sky.prototype.update = function()
{
	//Update time
	if(this.autoUpdate)
	{
		this.time += this.clock.getDelta()

		if(this.time &gt; this.dayTime)
		{
			this.time -= this.dayTime
		}

		this.updateSky()
	}

	//Update children
	for(var i = 0; i &lt; this.children.length; i++)
	{
		this.children[i].update()
	}
}


/**
 * Update sky state
 * Called automatically by the runtime handler (Editor / App)
 * @method updateSky
 */
Sky.prototype.updateSky = function()
{
	//Time in % of day
	var time = (this.time / this.dayTime)

	//0H - 6H (night)
	if(time &lt; 0.25)
	{
		this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r, this.colorTop[3].g, this.colorTop[3].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r, this.colorBottom[3].g, this.colorBottom[3].b)
	}
	//6H - 7H (night to morning)
	else if(time &lt; 0.292)
	{
		var t = (time-0.25) * 23.81
		var f = 1 - t

		this.sky.material.uniforms.topColor.value.setRGB(f*this.colorTop[3].r + t*this.colorTop[0].r, f*this.colorTop[3].g + t*this.colorTop[0].g, f*this.colorTop[3].b + t*this.colorTop[0].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(f*this.colorBottom[3].r + t*this.colorBottom[0].r, f*this.colorBottom[3].g + t*this.colorBottom[0].g, f*this.colorBottom[3].b + t*this.colorBottom[0].b)
	}
	//7H - 10H (morning)
	else if(time &lt; 0.4167)
	{
		this.sky.material.uniforms.topColor.value.setRGB(this.colorCop[0].r, this.colorCop[0].g, this.colorCop[0].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[0].r, this.colorBottom[0].g, this.colorBottom[0].b)
	}
	//10H - 12H (morning to noon)
	else if(time &lt; 0.5)
	{
		var t = (time-0.4167) * 12
		var f = 1 - t

		this.sky.material.uniforms.topColor.value.setRGB(f*this.colorTop[0].r + t*this.colorTop[1].r, f*this.colorTop[0].g + t*this.colorTop[1].g, f*this.colorTop[0].b + t*this.colorTop[1].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(f*this.colorBottom[0].r + t*this.colorBottom[1].r, f*this.colorBottom[0].g + t*this.colorBottom[1].g, f*this.colorBottom[0].b + t*this.colorBottom[1].b)
	}
	//12H - 17H (noon)
	else if(time &lt; 0.708)
	{
		this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[1].r, this.colorTop[1].g, this.colorTop[1].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[1].r, this.colorBottom[1].g, this.colorBottom[1].b)
	}
	//17H -&gt; 18h (noon to afternoon)
	else if(time &lt; 0.75)
	{
		var t = (time-0.708) * 23.81
		var f = 1 - t

		this.sky.material.uniforms.topColor.value.setRGB(f*this.colorTop[1].r + t*this.colorTop[2].r, f*this.colorTop[1].g + t*this.colorTop[2].g, f*this.colorTop[1].b + t*this.colorTop[2].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(f*this.colorBottom[1].r + t*this.colorBottom[2].r, f*this.colorBottom[1].g + t*this.colorBottom[2].g, f*this.colorBottom[1].b + t*this.colorBottom[2].b)
	}
	//18H -&gt; 20H (afternoon to night)
	else if(time &lt; 0.8333)
	{
		var t = (time-0.75) * 12.048
		var f = 1 - t

		this.sky.material.uniforms.topColor.value.setRGB(f*this.colorTop[2].r + t*this.colorTop[3].r, f*this.colorTop[2].g + t*this.colorTop[3].g, f*this.colorTop[2].b + t*this.colorTop[3].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(f*this.colorBottom[2].r + t*this.colorBottom[3].r, f*this.colorBottom[2].g + t*this.colorBottom[3].g, f*this.colorBottom[2].b + t*this.colorBottom[3].b)
	}
	//20H -&gt; 24H (night)
	else
	{
		this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r, this.colorTop[3].g, this.colorTop[3].b)
		this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r, this.colorBottom[3].g, this.colorBottom[3].b)
	}

	//Sun / moon color
	if(time &lt; 0.20)
	{
		this.sun.color.setHex(this.moonColor)
	}
	else if(time &lt; 0.30)
	{
		var t = (time-0.20) * 10
		var f = 1 - t

		if(t &lt; 0.5)
		{
			var f = 2 - t*2
			this.sun.intensity = f * 0.3
			this.sun.color.setHex(this.moonColor)
		}
		else
		{
			t = t*2
			this.sun.intensity = t * 0.3
			this.sun.color.setHex(Sky.sunColor)
		}
	}
	else if(time &lt; 0.70)
	{
		this.sun.color.setHex(Sky.sunColor)
	}
	else if(time &lt; 0.80)
	{
		var t = (time - 0.70) * 10
		
		if(t &lt; 0.5)
		{
			var f = 2 - t*2
			this.sun.intensity = f * 0.3
			this.sun.color.setHex(Sky.sunColor)
		}
		else
		{
			t = t*2
			this.sun.intensity = t * 0.3
			this.sun.color.setHex(this.moonColor)
		}
	}
	else
	{
		this.sun.color.setHex(this.moonColor)
	}

	//Update sun position
	var rotation = (MathUtils.pi2 * time) - MathUtils.pid2
	if(time &gt; 0.25 &amp;&amp; time &lt; 0.75)
	{
		this.sun.position.x = this.sunDistance * Math.cos(rotation)
		this.sun.position.y = this.sunDistance * Math.sin(rotation)
	}
	else
	{
		this.sun.position.x = this.sunDistance * Math.cos(rotation + Math.PI)
		this.sun.position.y = this.sunDistance * Math.sin(rotation + Math.PI);
	}
}

/**
 * Create JSON for object
 * @param {Object} meta
 * @method toJSON
 * @return {Object} json
 */
Sky.prototype.toJSON = function(meta)
{
	var data = THREE.Object3D.prototype.toJSON.call(this, meta)
	
	data.object.autoUpdate = this.autoUpdate
	data.object.sunDistance = this.sunDistance
	data.object.dayTime = this.dayTime
	data.object.time = this.time

	data.object.sun = {}
	data.object.sun.shadow = this.sun.shadow.toJSON()

	return data
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
