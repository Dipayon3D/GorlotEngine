<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>../Source/Runtime/Resources/Font.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AmbientLight.html">AmbientLight</a></li>
                                <li><a href="../classes/ArraybufferUtils.html">ArraybufferUtils</a></li>
                                <li><a href="../classes/Audio.html">Audio</a></li>
                                <li><a href="../classes/AudioEmitter.html">AudioEmitter</a></li>
                                <li><a href="../classes/Base64Utils.html">Base64Utils</a></li>
                                <li><a href="../classes/BlockScript.html">BlockScript</a></li>
                                <li><a href="../classes/BufferUtils.html">BufferUtils</a></li>
                                <li><a href="../classes/CanvasTexture.html">CanvasTexture</a></li>
                                <li><a href="../classes/Container.html">Container</a></li>
                                <li><a href="../classes/CubeTexture.html">CubeTexture</a></li>
                                <li><a href="../classes/DirectionalLight.html">DirectionalLight</a></li>
                                <li><a href="../classes/FileSystem.html">FileSystem</a></li>
                                <li><a href="../classes/Folder.html">Folder</a></li>
                                <li><a href="../classes/Font.html">Font</a></li>
                                <li><a href="../classes/GORLOT.html">GORLOT</a></li>
                                <li><a href="../classes/GORLOT.Image.html">GORLOT.Image</a></li>
                                <li><a href="../classes/HemisphereLight.html">HemisphereLight</a></li>
                                <li><a href="../classes/Key.html">Key</a></li>
                                <li><a href="../classes/Keyboard.html">Keyboard</a></li>
                                <li><a href="../classes/KinectDevice.html">KinectDevice</a></li>
                                <li><a href="../classes/LeapMotion.html">LeapMotion</a></li>
                                <li><a href="../classes/Material.html">Material</a></li>
                                <li><a href="../classes/Mesh.html">Mesh</a></li>
                                <li><a href="../classes/Mesh2shape.html">Mesh2shape</a></li>
                                <li><a href="../classes/Mouse.html">Mouse</a></li>
                                <li><a href="../classes/MultiMaterial.html">MultiMaterial</a></li>
                                <li><a href="../classes/ObjectUtils.html">ObjectUtils</a></li>
                                <li><a href="../classes/OrthographicCamera.html">OrthographicCamera</a></li>
                                <li><a href="../classes/ParticleEmitter.html">ParticleEmitter</a></li>
                                <li><a href="../classes/PerspectiveCamera.html">PerspectiveCamera</a></li>
                                <li><a href="../classes/PhysicsObject.html">PhysicsObject</a></li>
                                <li><a href="../classes/PointLight.html">PointLight</a></li>
                                <li><a href="../classes/PositionalAudio.html">PositionalAudio</a></li>
                                <li><a href="../classes/RectAreaLight.html">RectAreaLight</a></li>
                                <li><a href="../classes/Resource.html">Resource</a></li>
                                <li><a href="../classes/ResourceManager.html">ResourceManager</a></li>
                                <li><a href="../classes/Scene.html">Scene</a></li>
                                <li><a href="../classes/Script.html">Script</a></li>
                                <li><a href="../classes/SkinnedMesh.html">SkinnedMesh</a></li>
                                <li><a href="../classes/Sky.html">Sky</a></li>
                                <li><a href="../classes/SpineAnimation.html">SpineAnimation</a></li>
                                <li><a href="../classes/SpineTexture.html">SpineTexture</a></li>
                                <li><a href="../classes/SpotLight.html">SpotLight</a></li>
                                <li><a href="../classes/Sprite.html">Sprite</a></li>
                                <li><a href="../classes/Text3D.html">Text3D</a></li>
                                <li><a href="../classes/Texture.html">Texture</a></li>
                                <li><a href="../classes/THREE.Fog.html">THREE.Fog</a></li>
                                <li><a href="../classes/THREE.Object3D.html">THREE.Object3D</a></li>
                                <li><a href="../classes/Video.html">Video</a></li>
                                <li><a href="../classes/VideoTexture.html">VideoTexture</a></li>
                                <li><a href="../classes/WebcamTexture.html">WebcamTexture</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/Animations.html">Animations</a></li>
                                <li><a href="../modules/Audio.html">Audio</a></li>
                                <li><a href="../modules/BinaryData.html">BinaryData</a></li>
                                <li><a href="../modules/Cameras.html">Cameras</a></li>
                                <li><a href="../modules/Core.html">Core</a></li>
                                <li><a href="../modules/Devices.html">Devices</a></li>
                                <li><a href="../modules/Input.html">Input</a></li>
                                <li><a href="../modules/Lights.html">Lights</a></li>
                                <li><a href="../modules/Meshes.html">Meshes</a></li>
                                <li><a href="../modules/Misc.html">Misc</a></li>
                                <li><a href="../modules/Particles.html">Particles</a></li>
                                <li><a href="../modules/Physics.html">Physics</a></li>
                                <li><a href="../modules/Resources.html">Resources</a></li>
                                <li><a href="../modules/Runtime.html">Runtime</a></li>
                                <li><a href="../modules/Script.html">Script</a></li>
                                <li><a href="../modules/Sprite.html">Sprite</a></li>
                                <li><a href="../modules/Textures.html">Textures</a></li>
                                <li><a href="../modules/THREE.html">THREE</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ../Source/Runtime/Resources/Font.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&quot;use strict&quot;

/**
 * Font class stores font data, font data can be stored as an opentype json or as a TTF file (stored in Base64)
 *
 * Font objects are used for both 2D and 3D text
 *
 * @class Font
 * @constructor
 * @extends {Resource}
 * @module Resources
 * @param {String} url URL to font file
 */
function Font(url) {
	this.name = &quot;font&quot;
	this.uuid = THREE.Math.generateUUID()
	this.type = &quot;Font&quot;

	this.path = &quot;/&quot;

    this.format = &quot;&quot;
    this.encoding = &quot;&quot;
    this.data = null

    this.font = null

	if (url !== undefined) {
		if (typeof url === &quot;object&quot;) {
			this.data = url
            this.font = url
			this.name = url.original_font_information.fullName
			this.format = &quot;json&quot;
			this.encoding = &quot;json&quot;
		} else {
			this.encoding = url.split(&quot;.&quot;).pop().toLowerCase()

			if (this.encoding === &quot;json&quot;) {
				this.data = JSON.parse(FileSystem.readFile(url))
                this.font = this.data
				this.name = this.data.original_font_information.fullName
				this.format = &quot;json&quot;
			} else if (this.encoding === &quot;ttf&quot; || this.encoding === &quot;otf&quot; || this.encoding === &quot;ttc&quot; || this.encoding === &quot;otc&quot;) {
				this.data = FileSystem.readFileArrayBuffer(url)
				this.font = new TTFLoader().parse(this.data)
				this.name = FileSystem.getFileName(url)
				this.format = &quot;arraybuffer&quot;
			}
		}
	}
}

Font.prototype.isFont = true

/**
 * Sets the path of the font
 * @param {String} path
 * @method setPath
 */
Font.prototype.setPath = function(path) {
	if (path !== undefined) {
		this.path = path
	}
}

Font.prototype.getOpentypeFont = function() {
	if (this.encoding === &quot;json&quot;) {
		var options = {
			familyName: this.data.original_font_information.fontFamily || &quot; &quot;,
			styleName: this.data.original_font_information.fontSubfamily || this.data.styleName || &quot; &quot;,
			unitsPerEm: this.data.unitsPerEm || 2048,
			ascender: this.data.ascender,
			descender: this.data.descender
		}

		var font = new opentype.Font(options)

		var glyphs = this.data.glyphs
		for(var i in glyphs) {
			// TODO: This
		}

		return font
	}

	return null
}

/**
 * Generate font shapes used to create 3D geometries
 * @param {String} text
 * @param {Number} size
 * @param {Number} divisions
 * @return {Array} paths
 * @method generateShapes
 */
Font.prototype.generateShapes = function(text, size, divisions)
{
	if(size === undefined)
	{
		size = 100
	}

    if(divisions === undefined)
	{
		divisions = 10
	}

	var data = this.font
	var paths = createPaths(text)
	var shapes = []

	for(var p = 0; p &lt; paths.length; p++)
	{
		Array.prototype.push.apply(shapes, paths[p].toShapes())
	}

	return shapes

	//Create paths for text
	function createPaths(text)
	{
		var chars = String(text).split(&quot;&quot;)
		var scale = size / data.resolution
        var lineHeight = (data.boundingBox.yMax - data.boundingBox.yMin) * scale

        var offsetX = 0, offsetY = 0
		var paths = []

		for(var i = 0; i &lt; chars.length; i++)
		{
            var char = chars[i]

            if(char === &quot;\n&quot;) {
                offsetY -= lineHeight
                offsetX = 0
            } else {
                var ret = createPath(char, scale, offsetX, offsetY)
                offsetX += ret.width
                paths.push(ret.path)
            }
		}

		return paths
	}

	//Create path for a character
	function createPath(c, scale, offsetX, offsetY)
	{
		var glyph = data.glyphs[c] || data.glyphs[&quot;?&quot;]

		if(!glyph)
		{
			return
		}

		var path = new THREE.ShapePath()

        // Temporary variables
		var pts = [], b2 = THREE.ShapeUtils.b2, b3 = THREE.ShapeUtils.b3
		var x, y, cpx, cpy, cpx0, cpy0, cpx1, cpy1, cpx2, cpy2, laste

		if(glyph.o)
		{
			var outline = glyph._cachedOutline || (glyph._cachedOutline = glyph.o.split(&quot; &quot;))

			for(var i = 0, l = outline.length; i &lt; l;)
			{
				var action = outline[i++]

				//Move to
				if(action === &quot;m&quot;)
				{
					x = outline[i++] * scale + offsetX 
					y = outline[i++] * scale + offsetY

					path.moveTo(x, y)
				}
				//Line to
				if(action === &quot;l&quot;)
				{
					x = outline[i++] * scale + offsetX
					y = outline[i++] * scale + offsetY
					path.lineTo(x, y)
				}
				//Quadratic curve to
				else if(action === &quot;q&quot;)
				{
					cpx = outline[i++] * scale + offsetX
					cpy = outline[i++] * scale + offsetY
					cpx1 = outline[i++] * scale + offsetX
					cpy1 = outline[i++] * scale + offsetY

					path.quadraticCurveTo(cpx1, cpy1, cpx, cpy)
					laste = pts[pts.length - 1]

					if(laste)
					{
						cpx0 = laste.x
						cpy0 = laste.y

						for(var i2 = 1; i2 &lt;= divisions; i2++)
						{
							var t = i2 / divisions
							b2(t, cpx0, cpx1, cpx)
							b2(t, cpy0, cpy1, cpy)
						}
					}
				}
				//Bezier curve to
				else if(action === &quot;b&quot;)
				{
					cpx = outline[i++] * scale + offsetX
					cpy = outline[i++] * scale + offsetY
					cpx1 = outline[i++] * scale + offsetX
					cpy1 = outline[i++] * scale + offsetY
					cpx2 = outline[i++] * scale + offsetX
					cpy2 = outline[i++] * scale + offsetY

					path.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, cpx, cpy)
					laste = pts[pts.length - 1]

					if(laste)
					{
						cpx0 = laste.x
						cpy0 = laste.y

						for(var i2 = 1; i2 &lt;= divisions; i2++)
						{
							var t = i2 / divisions
							b3(t, cpx0, cpx1, cpx2, cpx)
							b3(t, cpy0, cpy1, cpy2, cpy)
						}
					}
				}
			}
		}

		return {width: glyph.ha * scale, path: path}
	}
}

/**
 * Serialise resource to JSON
 * @param {Object} meta
 * @return {Object} json
 * @method toJSON
 */
Font.prototype.toJSON = function(meta) {

	if (meta.fonts[this.uuid] !== undefined) {
		return meta.fonts[this.uuid]
	}

	var data = {}

	data.name = this.name
	data.uuid = this.uuid
	data.encoding = this.encoding
	data.type = this.type
	data.format = this.format
	data.data = this.data
	data.path = this.path

	meta.fonts[this.uuid] = data

	return data
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
