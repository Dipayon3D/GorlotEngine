/*
 LeapJS v0.6.4                                                  
 http://github.com/leapmotion/leapjs/                                        

 Copyright 2013 LeapMotion, Inc. and other contributors                      
 Released under the Apache-2.0 license                                     
 http://github.com/leapmotion/leapjs/blob/master/LICENSE.txt                 
*/
'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var h=0;return function(){return h<b.length?{done:!1,value:b[h++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,h,k){if(b==Array.prototype||b==Object.prototype)return b;b[h]=k.value;return b};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,b,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var h=0;h<b.length;++h){var k=b[h];if(k&&k.Math==Math)return k}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(b,h){var k=$jscomp.propertyToPolyfillSymbol[h];if(null==k)return b[h];k=b[k];return void 0!==k?k:b[h]};
$jscomp.polyfill=function(b,h,k,e){h&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(b,h,k,e):$jscomp.polyfillUnisolated(b,h,k,e))};$jscomp.polyfillUnisolated=function(b,h,k,e){k=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var p=b[e];if(!(p in k))return;k=k[p]}b=b[b.length-1];e=k[b];h=h(e);h!=e&&null!=h&&$jscomp.defineProperty(k,b,{configurable:!0,writable:!0,value:h})};
$jscomp.polyfillIsolated=function(b,h,k,e){var p=b.split(".");b=1===p.length;e=p[0];e=!b&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var q=0;q<p.length-1;q++){var l=p[q];if(!(l in e))return;e=e[l]}p=p[p.length-1];k=$jscomp.IS_SYMBOL_NATIVE&&"es6"===k?e[p]:null;h=h(k);null!=h&&(b?$jscomp.defineProperty($jscomp.polyfills,p,{configurable:!0,writable:!0,value:h}):h!==k&&($jscomp.propertyToPolyfillSymbol[p]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(p):$jscomp.POLYFILL_PREFIX+p,p=
$jscomp.propertyToPolyfillSymbol[p],$jscomp.defineProperty(e,p,{configurable:!0,writable:!0,value:h})))};$jscomp.initSymbol=function(){};$jscomp.initSymbolIterator=function(){};$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(b){b={next:b};b[Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,h){b instanceof String&&(b+="");var k=0,e={next:function(){if(k<b.length){var p=k++;return{value:h(p,b[p]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(h,k){return k})}},"es8","es3");$jscomp.owns=function(b,h){return Object.prototype.hasOwnProperty.call(b,h)};
$jscomp.polyfill("Object.values",function(b){return b?b:function(h){var k=[],e;for(e in h)$jscomp.owns(h,e)&&k.push(h[e]);return k}},"es8","es3");$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(h,k){var e=this;e instanceof String&&(e=String(e));var p=e.length;k=k||0;for(0>k&&(k=Math.max(k+p,0));k<p;k++){var q=e[k];if(q===h||Object.is(q,h))return!0}return!1}},"es7","es3");function GORLOT(){}GORLOT.NAME="Gorlot";GORLOT.VERSION="0.0.1-alpha";GORLOT.TIMESTAMP="Wed Aug 19, 22:06 PM";
GORLOT.WebVRAvailable=function(){return void 0!==navigator.getVRDisplays}(function(b,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(b.THREE=b.THREE||{})}(this,function(b){function h(){}function k(a,c){this.x=a||0;this.y=c||0}function e(a,c,d,g,u,x,A,H,K,M){Object.defineProperty(this,"id",{value:Pg++});this.uuid=xb.generateUUID();this.name="";this.image=void 0!==a?a:e.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==
c?c:e.DEFAULT_MAPPING;this.wrapS=void 0!==d?d:1001;this.wrapT=void 0!==g?g:1001;this.magFilter=void 0!==u?u:1006;this.minFilter=void 0!==x?x:1008;this.anisotropy=void 0!==K?K:1;this.format=void 0!==A?A:1023;this.type=void 0!==H?H:1009;this.offset=new k(0,0);this.repeat=new k(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==M?M:3E3;this.version=0;this.onUpdate=null}function p(a,c,d,g){this.x=a||0;this.y=c||0;this.z=d||0;this.w=void 0!==
g?g:1}function q(a,c,d){this.uuid=xb.generateUUID();this.width=a;this.height=c;this.scissor=new p(0,0,a,c);this.scissorTest=!1;this.viewport=new p(0,0,a,c);d=d||{};void 0===d.minFilter&&(d.minFilter=1006);this.texture=new e(void 0,void 0,d.wrapS,d.wrapT,d.magFilter,d.minFilter,d.format,d.type,d.anisotropy,d.encoding);this.depthBuffer=void 0!==d.depthBuffer?d.depthBuffer:!0;this.stencilBuffer=void 0!==d.stencilBuffer?d.stencilBuffer:!0;this.depthTexture=void 0!==d.depthTexture?d.depthTexture:null}
function l(a,c,d){q.call(this,a,c,d);this.activeMipMapLevel=this.activeCubeFace=0}function t(a,c,d,g){this._x=a||0;this._y=c||0;this._z=d||0;this._w=void 0!==g?g:1}function r(a,c,d){this.x=a||0;this.y=c||0;this.z=d||0}function y(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function z(a,c,d,g,u,x,A,H,K,M){a=void 0!==a?a:[];e.call(this,a,void 0!==c?c:301,d,g,u,x,A,H,K,M);this.flipY=
!1}function E(a,c,d){var g=a[0];if(0>=g||0<g)return a;var u=c*d,x=sg[u];void 0===x&&(x=new Float32Array(u),sg[u]=x);if(0!==c)for(g.toArray(x,0),g=1,u=0;g!==c;++g)u+=d,a[g].toArray(x,u);return x}function B(a,c){var d=tg[c];void 0===d&&(d=new Int32Array(c),tg[c]=d);for(var g=0;g!==c;++g)d[g]=a.allocTextureUnit();return d}function F(a,c){a.uniform1f(this.addr,c)}function I(a,c){a.uniform1i(this.addr,c)}function L(a,c){void 0===c.x?a.uniform2fv(this.addr,c):a.uniform2f(this.addr,c.x,c.y)}function U(a,
c){void 0!==c.x?a.uniform3f(this.addr,c.x,c.y,c.z):void 0!==c.r?a.uniform3f(this.addr,c.r,c.g,c.b):a.uniform3fv(this.addr,c)}function n(a,c){void 0===c.x?a.uniform4fv(this.addr,c):a.uniform4f(this.addr,c.x,c.y,c.z,c.w)}function w(a,c){a.uniformMatrix2fv(this.addr,!1,c.elements||c)}function G(a,c){a.uniformMatrix3fv(this.addr,!1,c.elements||c)}function f(a,c){void 0===c.elements?a.uniformMatrix4fv(this.addr,!1,c):(ug.set(c.elements),a.uniformMatrix4fv(this.addr,!1,ug))}function m(a,c,d){var g=d.allocTextureUnit();
a.uniform1i(this.addr,g);d.setTexture2D(c||vg,g)}function v(a,c,d){var g=d.allocTextureUnit();a.uniform1i(this.addr,g);d.setTextureCube(c||wg,g)}function D(a,c){a.uniform2iv(this.addr,c)}function C(a,c){a.uniform3iv(this.addr,c)}function J(a,c){a.uniform4iv(this.addr,c)}function N(a){switch(a){case 5126:return F;case 35664:return L;case 35665:return U;case 35666:return n;case 35674:return w;case 35675:return G;case 35676:return f;case 35678:return m;case 35680:return v;case 5124:case 35670:return I;
case 35667:case 35671:return D;case 35668:case 35672:return C;case 35669:case 35673:return J}}function S(a,c){a.uniform1fv(this.addr,c)}function T(a,c){a.uniform1iv(this.addr,c)}function W(a,c){a.uniform2fv(this.addr,E(c,this.size,2))}function Y(a,c){a.uniform3fv(this.addr,E(c,this.size,3))}function V(a,c){a.uniform4fv(this.addr,E(c,this.size,4))}function ma(a,c){a.uniformMatrix2fv(this.addr,!1,E(c,this.size,4))}function ha(a,c){a.uniformMatrix3fv(this.addr,!1,E(c,this.size,9))}function ia(a,c){a.uniformMatrix4fv(this.addr,
!1,E(c,this.size,16))}function aa(a,c,d){var g=c.length,u=B(d,g);a.uniform1iv(this.addr,u);for(a=0;a!==g;++a)d.setTexture2D(c[a]||vg,u[a])}function ea(a,c,d){var g=c.length,u=B(d,g);a.uniform1iv(this.addr,u);for(a=0;a!==g;++a)d.setTextureCube(c[a]||wg,u[a])}function ja(a){switch(a){case 5126:return S;case 35664:return W;case 35665:return Y;case 35666:return V;case 35674:return ma;case 35675:return ha;case 35676:return ia;case 35678:return aa;case 35680:return ea;case 5124:case 35670:return T;case 35667:case 35671:return D;
case 35668:case 35672:return C;case 35669:case 35673:return J}}function Q(a,c,d){this.id=a;this.addr=d;this.setValue=N(c.type)}function X(a,c,d){this.id=a;this.addr=d;this.size=c.size;this.setValue=ja(c.type)}function ca(a){this.id=a;this.seq=[];this.map={}}function pa(a,c,d){this.seq=[];this.map={};this.renderer=d;d=a.getProgramParameter(c,a.ACTIVE_UNIFORMS);for(var g=0;g<d;++g){var u=a.getActiveUniform(c,g),x=a.getUniformLocation(c,u.name),A=this,H=u.name,K=H.length;for(Pf.lastIndex=0;;){var M=
Pf.exec(H),R=Pf.lastIndex,O=M[1],P=M[3];"]"===M[2]&&(O|=0);if(void 0===P||"["===P&&R+2===K){H=A;u=void 0===P?new Q(O,u,x):new X(O,u,x);H.seq.push(u);H.map[u.id]=u;break}else P=A.map[O],void 0===P&&(P=new ca(O),O=A,A=P,O.seq.push(A),O.map[A.id]=A),A=P}}}function ka(a,c,d){return void 0===c&&void 0===d?this.set(a):this.setRGB(a,c,d)}function va(a,c,d,g,u,x,A,H,K,M,R,O){e.call(this,null,x,A,H,K,M,g,u,R,O);this.image={data:a,width:c,height:d};this.magFilter=void 0!==K?K:1003;this.minFilter=void 0!==M?
M:1003;this.flipY=this.generateMipmaps=!1;this.unpackAlignment=1}function Aa(a,c){this.min=void 0!==a?a:new k(Infinity,Infinity);this.max=void 0!==c?c:new k(-Infinity,-Infinity)}function xa(a,c){var d,g,u,x,A,H,K,M,R,O,P=a.context,Z=a.state,da,na,qa,sa,ba,oa;this.render=function(la,wa,ya){if(0!==c.length){la=new r;var Ca=ya.w/ya.z,Ja=.5*ya.z,Pa=.5*ya.w,Na=16/ya.w,Ta=new k(Na*Ca,Na),Qa=new r(1,1,0),Xa=new k(1,1),hb=new Aa;hb.min.set(ya.x,ya.y);hb.max.set(ya.x+(ya.z-16),ya.y+(ya.w-16));if(void 0===
sa){Na=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var Ua=new Uint16Array([0,1,2,0,2,3]);da=P.createBuffer();na=P.createBuffer();P.bindBuffer(P.ARRAY_BUFFER,da);P.bufferData(P.ARRAY_BUFFER,Na,P.STATIC_DRAW);P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,na);P.bufferData(P.ELEMENT_ARRAY_BUFFER,Ua,P.STATIC_DRAW);ba=P.createTexture();oa=P.createTexture();Z.bindTexture(P.TEXTURE_2D,ba);P.texImage2D(P.TEXTURE_2D,0,P.RGB,16,16,0,P.RGB,P.UNSIGNED_BYTE,null);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,
P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.NEAREST);Z.bindTexture(P.TEXTURE_2D,oa);P.texImage2D(P.TEXTURE_2D,0,P.RGBA,16,16,0,P.RGBA,P.UNSIGNED_BYTE,null);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE);P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST);P.texParameteri(P.TEXTURE_2D,
P.TEXTURE_MIN_FILTER,P.NEAREST);Na=qa={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"};Ua=P.createProgram();var Ma=P.createShader(P.FRAGMENT_SHADER),
Sa=P.createShader(P.VERTEX_SHADER),Ga="precision "+a.getPrecision()+" float;\n";P.shaderSource(Ma,Ga+Na.fragmentShader);P.shaderSource(Sa,Ga+Na.vertexShader);P.compileShader(Ma);P.compileShader(Sa);P.attachShader(Ua,Ma);P.attachShader(Ua,Sa);P.linkProgram(Ua);sa=Ua;R=P.getAttribLocation(sa,"position");O=P.getAttribLocation(sa,"uv");d=P.getUniformLocation(sa,"renderType");g=P.getUniformLocation(sa,"map");u=P.getUniformLocation(sa,"occlusionMap");x=P.getUniformLocation(sa,"opacity");A=P.getUniformLocation(sa,
"color");H=P.getUniformLocation(sa,"scale");K=P.getUniformLocation(sa,"rotation");M=P.getUniformLocation(sa,"screenPosition")}P.useProgram(sa);Z.initAttributes();Z.enableAttribute(R);Z.enableAttribute(O);Z.disableUnusedAttributes();P.uniform1i(u,0);P.uniform1i(g,1);P.bindBuffer(P.ARRAY_BUFFER,da);P.vertexAttribPointer(R,2,P.FLOAT,!1,16,0);P.vertexAttribPointer(O,2,P.FLOAT,!1,16,8);P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,na);Z.disable(P.CULL_FACE);Z.setDepthWrite(!1);Ua=0;for(Ma=c.length;Ua<Ma;Ua++)if(Na=
16/ya.w,Ta.set(Na*Ca,Na),Sa=c[Ua],la.set(Sa.matrixWorld.elements[12],Sa.matrixWorld.elements[13],Sa.matrixWorld.elements[14]),la.applyMatrix4(wa.matrixWorldInverse),la.applyMatrix4(wa.projectionMatrix),Qa.copy(la),Xa.x=ya.x+Qa.x*Ja+Ja-8,Xa.y=ya.y+Qa.y*Pa+Pa-8,!0===hb.containsPoint(Xa)){Z.activeTexture(P.TEXTURE0);Z.bindTexture(P.TEXTURE_2D,null);Z.activeTexture(P.TEXTURE1);Z.bindTexture(P.TEXTURE_2D,ba);P.copyTexImage2D(P.TEXTURE_2D,0,P.RGB,Xa.x,Xa.y,16,16,0);P.uniform1i(d,0);P.uniform2f(H,Ta.x,Ta.y);
P.uniform3f(M,Qa.x,Qa.y,Qa.z);Z.disable(P.BLEND);Z.enable(P.DEPTH_TEST);P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0);Z.activeTexture(P.TEXTURE0);Z.bindTexture(P.TEXTURE_2D,oa);P.copyTexImage2D(P.TEXTURE_2D,0,P.RGBA,Xa.x,Xa.y,16,16,0);P.uniform1i(d,1);Z.disable(P.DEPTH_TEST);Z.activeTexture(P.TEXTURE1);Z.bindTexture(P.TEXTURE_2D,ba);P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,0);Sa.positionScreen.copy(Qa);Sa.customUpdateCallback?Sa.customUpdateCallback(Sa):Sa.updateLensFlares();P.uniform1i(d,
2);Z.enable(P.BLEND);Ga=0;for(var db=Sa.lensFlares.length;Ga<db;Ga++){var Ya=Sa.lensFlares[Ga];.001<Ya.opacity&&.001<Ya.scale&&(Qa.x=Ya.x,Qa.y=Ya.y,Qa.z=Ya.z,Na=Ya.size*Ya.scale/ya.w,Ta.x=Na*Ca,Ta.y=Na,P.uniform3f(M,Qa.x,Qa.y,Qa.z),P.uniform2f(H,Ta.x,Ta.y),P.uniform1f(K,Ya.rotation),P.uniform1f(x,Ya.opacity),P.uniform3f(A,Ya.color.r,Ya.color.g,Ya.color.b),Z.setBlending(Ya.blending,Ya.blendEquation,Ya.blendSrc,Ya.blendDst),a.setTexture2D(Ya.texture,1),P.drawElements(P.TRIANGLES,6,P.UNSIGNED_SHORT,
0))}}Z.enable(P.CULL_FACE);Z.enable(P.DEPTH_TEST);Z.setDepthWrite(!0);a.resetGLState()}}}function Ia(a,c){var d,g,u,x,A,H,K,M,R,O,P,Z,da,na,qa,sa,ba;function oa(Xa,hb){return Xa.renderOrder!==hb.renderOrder?Xa.renderOrder-hb.renderOrder:Xa.z!==hb.z?hb.z-Xa.z:hb.id-Xa.id}var la=a.context,wa=a.state,ya,Ca,Ja,Pa,Na=new r,Ta=new t,Qa=new r;this.render=function(Xa,hb){if(0!==c.length){if(void 0===Ja){var Ua=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),Ma=new Uint16Array([0,1,2,0,2,3]);
ya=la.createBuffer();Ca=la.createBuffer();la.bindBuffer(la.ARRAY_BUFFER,ya);la.bufferData(la.ARRAY_BUFFER,Ua,la.STATIC_DRAW);la.bindBuffer(la.ELEMENT_ARRAY_BUFFER,Ca);la.bufferData(la.ELEMENT_ARRAY_BUFFER,Ma,la.STATIC_DRAW);Ua=la.createProgram();Ma=la.createShader(la.VERTEX_SHADER);var Sa=la.createShader(la.FRAGMENT_SHADER);la.shaderSource(Ma,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
la.shaderSource(Sa,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
la.compileShader(Ma);la.compileShader(Sa);la.attachShader(Ua,Ma);la.attachShader(Ua,Sa);la.linkProgram(Ua);Ja=Ua;sa=la.getAttribLocation(Ja,"position");ba=la.getAttribLocation(Ja,"uv");d=la.getUniformLocation(Ja,"uvOffset");g=la.getUniformLocation(Ja,"uvScale");u=la.getUniformLocation(Ja,"rotation");x=la.getUniformLocation(Ja,"scale");A=la.getUniformLocation(Ja,"color");H=la.getUniformLocation(Ja,"map");K=la.getUniformLocation(Ja,"opacity");M=la.getUniformLocation(Ja,"modelViewMatrix");R=la.getUniformLocation(Ja,
"projectionMatrix");O=la.getUniformLocation(Ja,"fogType");P=la.getUniformLocation(Ja,"fogDensity");Z=la.getUniformLocation(Ja,"fogNear");da=la.getUniformLocation(Ja,"fogFar");na=la.getUniformLocation(Ja,"fogColor");qa=la.getUniformLocation(Ja,"alphaTest");Ua=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");Ua.width=8;Ua.height=8;Ma=Ua.getContext("2d");Ma.fillStyle="white";Ma.fillRect(0,0,8,8);Pa=new e(Ua);Pa.needsUpdate=!0}la.useProgram(Ja);wa.initAttributes();wa.enableAttribute(sa);
wa.enableAttribute(ba);wa.disableUnusedAttributes();wa.disable(la.CULL_FACE);wa.enable(la.BLEND);la.bindBuffer(la.ARRAY_BUFFER,ya);la.vertexAttribPointer(sa,2,la.FLOAT,!1,16,0);la.vertexAttribPointer(ba,2,la.FLOAT,!1,16,8);la.bindBuffer(la.ELEMENT_ARRAY_BUFFER,Ca);la.uniformMatrix4fv(R,!1,hb.projectionMatrix.elements);wa.activeTexture(la.TEXTURE0);la.uniform1i(H,0);Ma=Ua=0;(Sa=Xa.fog)?(la.uniform3f(na,Sa.color.r,Sa.color.g,Sa.color.b),Sa.isFog?(la.uniform1f(Z,Sa.near),la.uniform1f(da,Sa.far),la.uniform1i(O,
1),Ma=Ua=1):Sa.isFogExp2&&(la.uniform1f(P,Sa.density),la.uniform1i(O,2),Ma=Ua=2)):(la.uniform1i(O,0),Ma=Ua=0);Sa=0;for(var Ga=c.length;Sa<Ga;Sa++){var db=c[Sa];db.modelViewMatrix.multiplyMatrices(hb.matrixWorldInverse,db.matrixWorld);db.z=-db.modelViewMatrix.elements[14]}c.sort(oa);hb=[];Sa=0;for(Ga=c.length;Sa<Ga;Sa++){db=c[Sa];var Ya=db.material;!1!==Ya.visible&&(la.uniform1f(qa,Ya.alphaTest),la.uniformMatrix4fv(M,!1,db.modelViewMatrix.elements),db.matrixWorld.decompose(Na,Ta,Qa),hb[0]=Qa.x,hb[1]=
Qa.y,db=0,Xa.fog&&Ya.fog&&(db=Ma),Ua!==db&&(la.uniform1i(O,db),Ua=db),null!==Ya.map?(la.uniform2f(d,Ya.map.offset.x,Ya.map.offset.y),la.uniform2f(g,Ya.map.repeat.x,Ya.map.repeat.y)):(la.uniform2f(d,0,0),la.uniform2f(g,1,1)),la.uniform1f(K,Ya.opacity),la.uniform3f(A,Ya.color.r,Ya.color.g,Ya.color.b),la.uniform1f(u,Ya.rotation),la.uniform2fv(x,hb),wa.setBlending(Ya.blending,Ya.blendEquation,Ya.blendSrc,Ya.blendDst),wa.setDepthTest(Ya.depthTest),wa.setDepthWrite(Ya.depthWrite),Ya.map?a.setTexture2D(Ya.map,
0):a.setTexture2D(Pa,0),la.drawElements(la.TRIANGLES,6,la.UNSIGNED_SHORT,0))}wa.enable(la.CULL_FACE);a.resetGLState()}}}function Za(){Object.defineProperty(this,"id",{value:Qg++});this.uuid=xb.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=
3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function kb(a){Za.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";
this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),
this.setValues(a))}function Hb(a){Za.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function vb(a,c){this.min=void 0!==a?a:new r(Infinity,Infinity,Infinity);this.max=void 0!==c?c:new r(-Infinity,-Infinity,-Infinity)}function Nb(a,c){this.center=void 0!==a?a:new r;this.radius=
void 0!==c?c:0}function Pb(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function Sb(a,c){this.normal=void 0!==a?a:new r(1,0,0);this.constant=void 0!==c?c:0}function bd(a,c,d,g,u,x){this.planes=[void 0!==a?a:new Sb,void 0!==c?c:new Sb,void 0!==d?d:new Sb,void 0!==g?g:new Sb,void 0!==u?u:new Sb,void 0!==x?x:new Sb]}function cd(a,c,d,g){function u(Qa,Xa,hb,Ua){var Ma=Qa.geometry;
var Sa=qa;var Ga=Qa.customDepthMaterial;hb&&(Sa=sa,Ga=Qa.customDistanceMaterial);Ga?Sa=Ga:(Ga=!1,Xa.morphTargets&&(Ma&&Ma.isBufferGeometry?Ga=Ma.morphAttributes&&Ma.morphAttributes.position&&0<Ma.morphAttributes.position.length:Ma&&Ma.isGeometry&&(Ga=Ma.morphTargets&&0<Ma.morphTargets.length)),Qa=Qa.isSkinnedMesh&&Xa.skinning,Ma=0,Ga&&(Ma|=1),Qa&&(Ma|=2),Sa=Sa[Ma]);a.localClippingEnabled&&!0===Xa.clipShadows&&0!==Xa.clippingPlanes.length&&(Ma=Sa.uuid,Ga=Xa.uuid,Qa=ba[Ma],void 0===Qa&&(Qa={},ba[Ma]=
Qa),Ma=Qa[Ga],void 0===Ma&&(Ma=Sa.clone(),Qa[Ga]=Ma),Sa=Ma);Sa.visible=Xa.visible;Sa.wireframe=Xa.wireframe;Ga=Xa.side;Ta.renderSingleSided&&2==Ga&&(Ga=0);Ta.renderReverseSided&&(0===Ga?Ga=1:1===Ga&&(Ga=0));Sa.side=Ga;Sa.clipShadows=Xa.clipShadows;Sa.clippingPlanes=Xa.clippingPlanes;Sa.wireframeLinewidth=Xa.wireframeLinewidth;Sa.linewidth=Xa.linewidth;hb&&void 0!==Sa.uniforms.lightPos&&Sa.uniforms.lightPos.value.copy(Ua);return Sa}function x(Qa,Xa,hb){if(!1!==Qa.visible){0!==(Qa.layers.mask&Xa.layers.mask)&&
(Qa.isMesh||Qa.isLine||Qa.isPoints)&&Qa.castShadow&&(!1===Qa.frustumCulled||!0===K.intersectsObject(Qa))&&!0===Qa.material.visible&&(Qa.modelViewMatrix.multiplyMatrices(hb.matrixWorldInverse,Qa.matrixWorld),na.push(Qa));Qa=Qa.children;for(var Ua=0,Ma=Qa.length;Ua<Ma;Ua++)x(Qa[Ua],Xa,hb)}}var A=a.context,H=a.state,K=new bd,M=new y,R=c.shadows,O=new k,P=new k(g.maxTextureSize,g.maxTextureSize),Z=new r,da=new r,na=[],qa=Array(4),sa=Array(4),ba={},oa=[new r(1,0,0),new r(-1,0,0),new r(0,0,1),new r(0,0,
-1),new r(0,1,0),new r(0,-1,0)],la=[new r(0,1,0),new r(0,1,0),new r(0,1,0),new r(0,1,0),new r(0,0,1),new r(0,0,-1)],wa=[new p,new p,new p,new p,new p,new p];c=new Hb;c.depthPacking=3201;c.clipping=!0;g=dd.distanceRGBA;for(var ya=nc.clone(g.uniforms),Ca=0;4!==Ca;++Ca){var Ja=0!==(Ca&1),Pa=0!==(Ca&2),Na=c.clone();Na.morphTargets=Ja;Na.skinning=Pa;qa[Ca]=Na;Ja=new kb({defines:{USE_SHADOWMAP:""},uniforms:ya,vertexShader:g.vertexShader,fragmentShader:g.fragmentShader,morphTargets:Ja,skinning:Pa,clipping:!0});
sa[Ca]=Ja}var Ta=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(Qa,Xa){if(!1!==Ta.enabled&&(!1!==Ta.autoUpdate||!1!==Ta.needsUpdate)&&0!==R.length){H.buffers.color.setClear(1,1,1,1);H.disable(A.BLEND);H.setDepthTest(!0);H.setScissorTest(!1);for(var hb,Ua,Ma=0,Sa=R.length;Ma<Sa;Ma++){var Ga=R[Ma],db=Ga.shadow;if(void 0===db)console.warn("THREE.WebGLShadowMap:",Ga,"has no shadow.");else{var Ya=db.camera;
O.copy(db.mapSize);O.min(P);if(Ga&&Ga.isPointLight){hb=6;Ua=!0;var Cb=O.x,Jb=O.y;wa[0].set(2*Cb,Jb,Cb,Jb);wa[1].set(0,Jb,Cb,Jb);wa[2].set(3*Cb,Jb,Cb,Jb);wa[3].set(Cb,Jb,Cb,Jb);wa[4].set(3*Cb,0,Cb,Jb);wa[5].set(Cb,0,Cb,Jb);O.x*=4;O.y*=2}else hb=1,Ua=!1;null===db.map&&(db.map=new q(O.x,O.y,{minFilter:1003,magFilter:1003,format:1023}),db.map.texture.name=Ga.name+".shadowMap",Ya.updateProjectionMatrix());db.isSpotLightShadow&&db.update(Ga);db&&db.isRectAreaLightShadow&&db.update(Ga);Cb=db.map;db=db.matrix;
da.setFromMatrixPosition(Ga.matrixWorld);Ya.position.copy(da);a.setRenderTarget(Cb);a.clear();for(Cb=0;Cb<hb;Cb++){Ua?(Z.copy(Ya.position),Z.add(oa[Cb]),Ya.up.copy(la[Cb]),Ya.lookAt(Z),H.viewport(wa[Cb])):(Z.setFromMatrixPosition(Ga.target.matrixWorld),Ya.lookAt(Z));Ya.updateMatrixWorld();Ya.matrixWorldInverse.getInverse(Ya.matrixWorld);db.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);db.multiply(Ya.projectionMatrix);db.multiply(Ya.matrixWorldInverse);M.multiplyMatrices(Ya.projectionMatrix,Ya.matrixWorldInverse);
K.setFromMatrix(M);na.length=0;x(Qa,Xa,Ya);Jb=0;for(var Kb=na.length;Jb<Kb;Jb++){var pb=na[Jb],Ba=d.update(pb),mb=pb.material;if(mb&&mb.isMultiMaterial){var nb=Ba.groups;mb=mb.materials;for(var tb=0,eb=nb.length;tb<eb;tb++){var yb=nb[tb],Eb=mb[yb.materialIndex];!0===Eb.visible&&(Eb=u(pb,Eb,Ua,da),a.renderBufferDirect(Ya,null,Ba,Eb,pb,yb))}}else Eb=u(pb,mb,Ua,da),a.renderBufferDirect(Ya,null,Ba,Eb,pb,null)}}}}Qa=a.getClearColor();Xa=a.getClearAlpha();a.setClearColor(Qa,Xa);Ta.needsUpdate=!1}}}function sc(a,
c){this.origin=void 0!==a?a:new r;this.direction=void 0!==c?c:new r}function tc(a,c,d,g){this._x=a||0;this._y=c||0;this._z=d||0;this._order=g||tc.DefaultOrder}function te(){this.mask=1}function lb(){Object.defineProperty(this,"id",{value:Rg++});this.uuid=xb.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=lb.DefaultUp.clone();var a=new r,c=new tc,d=new t,g=new r(1,1,1);c.onChange(function(){d.setFromEuler(c,!1)});d.onChange(function(){c.setFromQuaternion(d,
void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:c},quaternion:{enumerable:!0,value:d},scale:{enumerable:!0,value:g},modelViewMatrix:{value:new y},normalMatrix:{value:new Pb}});this.matrix=new y;this.matrixWorld=new y;this.matrixAutoUpdate=lb.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new te;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=
function(){};this.onAfterRender=function(){}}function ed(a,c){this.start=void 0!==a?a:new r;this.end=void 0!==c?c:new r}function gc(a,c,d){this.a=void 0!==a?a:new r;this.b=void 0!==c?c:new r;this.c=void 0!==d?d:new r}function bc(a,c,d,g,u,x){this.a=a;this.b=c;this.c=d;this.normal=g&&g.isVector3?g:new r;this.vertexNormals=Array.isArray(g)?g:[];this.color=u&&u.isColor?u:new ka;this.vertexColors=Array.isArray(u)?u:[];this.materialIndex=void 0!==x?x:0}function hc(a){Za.call(this);this.type="MeshBasicMaterial";
this.color=new ka(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function zb(a,c,d){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
this.uuid=xb.generateUUID();this.array=a;this.itemSize=c;this.count=void 0!==a?a.length/c:0;this.normalized=!0===d;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function Yc(a,c){zb.call(this,new Int8Array(a),c)}function Pc(a,c){zb.call(this,new Uint8Array(a),c)}function uc(a,c){zb.call(this,new Uint8ClampedArray(a),c)}function fd(a,c){zb.call(this,new Int16Array(a),c)}function Bc(a,c){zb.call(this,new Uint16Array(a),c)}function Cc(a,c){zb.call(this,
new Int32Array(a),c)}function Qc(a,c){zb.call(this,new Uint32Array(a),c)}function ib(a,c){zb.call(this,new Float32Array(a),c)}function Zc(a,c){zb.call(this,new Float64Array(a),c)}function ue(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=
!1}function Rc(a){for(var c=a.length,d=-Infinity;c--;)a[c]>d&&(d=a[c]);return d}function sb(){Object.defineProperty(this,"id",{value:Qf++});this.uuid=xb.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=
this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function ob(){Object.defineProperty(this,"id",{value:Qf++});this.uuid=xb.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Zb(a,c){lb.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new ob;this.material=void 0!==c?c:new hc({color:16777215*Math.random()});
this.drawMode=0;this.updateMorphTargets()}function oc(a,c,d,g,u,x){sb.call(this);this.type="BoxGeometry";this.parameters={width:a,height:c,depth:d,widthSegments:g,heightSegments:u,depthSegments:x};this.fromBufferGeometry(new pc(a,c,d,g,u,x));this.mergeVertices()}function pc(a,c,d,g,u,x){function A(da,na,qa,sa,ba,oa,la,wa,ya,Ca,Ja){var Pa=oa/ya,Na=la/Ca,Ta=oa/2,Qa=la/2,Xa=wa/2;la=ya+1;var hb=Ca+1,Ua=oa=0,Ma,Sa,Ga=new r;for(Sa=0;Sa<hb;Sa++){var db=Sa*Na-Qa;for(Ma=0;Ma<la;Ma++)Ga[da]=(Ma*Pa-Ta)*sa,Ga[na]=
db*ba,Ga[qa]=Xa,M.push(Ga.x,Ga.y,Ga.z),Ga[da]=0,Ga[na]=0,Ga[qa]=0<wa?1:-1,R.push(Ga.x,Ga.y,Ga.z),O.push(Ma/ya),O.push(1-Sa/Ca),oa+=1}for(Sa=0;Sa<Ca;Sa++)for(Ma=0;Ma<ya;Ma++)da=P+Ma+la*(Sa+1),na=P+(Ma+1)+la*(Sa+1),qa=P+(Ma+1)+la*Sa,K.push(P+Ma+la*Sa,da,qa),K.push(da,na,qa),Ua+=6;H.addGroup(Z,Ua,Ja);Z+=Ua;P+=oa}ob.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:c,depth:d,widthSegments:g,heightSegments:u,depthSegments:x};var H=this;g=Math.floor(g)||1;u=Math.floor(u)||1;x=Math.floor(x)||
1;var K=[],M=[],R=[],O=[],P=0,Z=0;A("z","y","x",-1,-1,d,c,a,x,u,0);A("z","y","x",1,-1,d,c,-a,x,u,1);A("x","z","y",1,1,a,d,c,g,x,2);A("x","z","y",1,-1,a,d,-c,g,x,3);A("x","y","z",1,-1,a,c,d,g,u,4);A("x","y","z",-1,-1,a,c,-d,g,u,5);this.setIndex(K);this.addAttribute("position",new ib(M,3));this.addAttribute("normal",new ib(R,3));this.addAttribute("uv",new ib(O,2))}function ua(a,c,d,g){sb.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:c,widthSegments:d,heightSegments:g};this.fromBufferGeometry(new Da(a,
c,d,g))}function Da(a,c,d,g){ob.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:c,widthSegments:d,heightSegments:g};var u=a/2,x=c/2;d=Math.floor(d)||1;g=Math.floor(g)||1;var A=d+1,H=g+1,K=a/d,M=c/g,R=[],O=[],P=[],Z=[];for(a=0;a<H;a++){var da=a*M-x;for(c=0;c<A;c++)O.push(c*K-u,-da,0),P.push(0,0,1),Z.push(c/d),Z.push(1-a/g)}for(a=0;a<g;a++)for(c=0;c<d;c++)u=c+A*(a+1),x=c+1+A*(a+1),H=c+1+A*a,R.push(c+A*a,u,H),R.push(u,x,H);this.setIndex(R);this.addAttribute("position",new ib(O,
3));this.addAttribute("normal",new ib(P,3));this.addAttribute("uv",new ib(Z,2))}function Ka(){lb.call(this);this.type="Camera";this.matrixWorldInverse=new y;this.projectionMatrix=new y}function Oa(a,c,d,g){Ka.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==d?d:.1;this.far=void 0!==g?g:2E3;this.focus=10;this.aspect=void 0!==c?c:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Ha(a,c,d,g,u,x){Ka.call(this);this.type=
"OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=c;this.top=d;this.bottom=g;this.near=void 0!==u?u:.1;this.far=void 0!==x?x:2E3;this.updateProjectionMatrix()}function La(a,c,d){var g,u,x;return{setMode:function(A){g=A},setIndex:function(A){A.array instanceof Uint32Array&&c.get("OES_element_index_uint")?(u=a.UNSIGNED_INT,x=4):A.array instanceof Uint16Array?(u=a.UNSIGNED_SHORT,x=2):(u=a.UNSIGNED_BYTE,x=1)},render:function(A,H){a.drawElements(g,H,u,A*x);d.calls++;d.vertices+=H;
g===a.TRIANGLES&&(d.faces+=H/3)},renderInstances:function(A,H,K){var M=c.get("ANGLE_instanced_arrays");null===M?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(M.drawElementsInstancedANGLE(g,K,u,H*x,A.maxInstancedCount),d.calls++,d.vertices+=K*A.maxInstancedCount,g===a.TRIANGLES&&(d.faces+=A.maxInstancedCount*K/3))}}}function Va(a,c,d){var g;return{setMode:function(u){g=u},render:function(u,x){a.drawArrays(g,
u,x);d.calls++;d.vertices+=x;g===a.TRIANGLES&&(d.faces+=x/3)},renderInstances:function(u){var x=c.get("ANGLE_instanced_arrays");if(null===x)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var A=u.attributes.position;A=A.isInterleavedBufferAttribute?A.data.count:A.count;x.drawArraysInstancedANGLE(g,0,A,u.maxInstancedCount);d.calls++;d.vertices+=A*u.maxInstancedCount;g===a.TRIANGLES&&(d.faces+=u.maxInstancedCount*
A/3)}}}}function cb(){var a={};return{get:function(c){if(void 0!==a[c.id])return a[c.id];switch(c.type){case "DirectionalLight":var d={direction:new r,color:new ka,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new k};break;case "SpotLight":d={position:new r,direction:new r,color:new ka,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new k};break;case "PointLight":d={position:new r,color:new ka,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,
shadowMapSize:new k};break;case "HemisphereLight":d={direction:new r,skyColor:new ka,groundColor:new ka};break;case "RectAreaLight":d={color:new ka,position:new r,halfWidth:new r,halfHeight:new r}}return a[c.id]=d}}}function $a(a){a=a.split("\n");for(var c=0;c<a.length;c++)a[c]=c+1+": "+a[c];return a.join("\n")}function Ra(a,c,d){var g=a.createShader(c);a.shaderSource(g,d);a.compileShader(g);!1===a.getShaderParameter(g,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");
""!==a.getShaderInfoLog(g)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(g),$a(d));return g}function Ea(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+
a);}}function fb(a,c){c=Ea(c);return"vec4 "+a+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function ab(a,c){c=Ea(c);return"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function Bb(a,c){switch(c){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="Uncharted2";break;case 4:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+c);}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function Fb(a,c,d){a=a||{};return[a.derivatives||
c.envMapCubeUV||c.bumpMap||c.normalMap||c.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||c.logarithmicDepthBuffer)&&d.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&d.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||c.envMap)&&d.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Ob).join("\n")}function Qb(a){var c=[],d;for(d in a){var g=a[d];!1!==g&&c.push("#define "+
d+" "+g)}return c.join("\n")}function Ob(a){return""!==a}function Rb(a,c){return a.replace(/NUM_DIR_LIGHTS/g,c.numDirLights).replace(/NUM_SPOT_LIGHTS/g,c.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,c.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,c.numPointLights).replace(/NUM_HEMI_LIGHTS/g,c.numHemiLights)}function jb(a){return a.replace(/#include +<([\w\d.]+)>/g,function(c,d){c=Mb[d];if(void 0===c)throw Error("Can not resolve #include <"+d+">");return jb(c)})}function Wb(a){return a.replace(/for \( int i = (\d+); i < (\d+); i \+\+ \) \{([\s\S]+?)(?=\})\}/g,
function(c,d,g,u){c="";for(d=parseInt(d);d<parseInt(g);d++)c+=u.replace(/\[ i \]/g,"[ "+d+" ]");return c})}function cc(a,c,d,g){var u=a.context,x=d.extensions,A=d.defines,H=d.__webglShader.vertexShader,K=d.__webglShader.fragmentShader,M="SHADOWMAP_TYPE_BASIC";1===g.shadowMapType?M="SHADOWMAP_TYPE_PCF":2===g.shadowMapType&&(M="SHADOWMAP_TYPE_PCF_SOFT");var R="ENVMAP_TYPE_CUBE",O="ENVMAP_MODE_REFLECTION",P="ENVMAP_BLENDING_MULTIPLY";if(g.envMap){switch(d.envMap.mapping){case 301:case 302:R="ENVMAP_TYPE_CUBE";
break;case 306:case 307:R="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:R="ENVMAP_TYPE_EQUIREC";break;case 305:R="ENVMAP_TYPE_SPHERE"}switch(d.envMap.mapping){case 302:case 304:O="ENVMAP_MODE_REFRACTION"}switch(d.combine){case 0:P="ENVMAP_BLENDING_MULTIPLY";break;case 1:P="ENVMAP_BLENDING_MIX";break;case 2:P="ENVMAP_BLENDING_ADD"}}var Z=0<a.gammaFactor?a.gammaFactor:1;x=Fb(x,g,a.extensions);var da=Qb(A),na=u.createProgram();d.isRawShaderMaterial?(A=[da,"\n"].filter(Ob).join("\n"),M=[x,da,"\n"].filter(Ob).join("\n")):
(A=["precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+d.__webglShader.name,da,g.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+Z,"#define MAX_BONES "+g.maxBones,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+O:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":
"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.useVertexTexture?"#define BONE_TEXTURE":"",g.morphTargets?"#define USE_MORPHTARGETS":
"",g.morphNormals&&!1===g.flatShading?"#define USE_MORPHNORMALS":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+M:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;",
"uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;",
"\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Ob).join("\n"),M=[x,"precision "+g.precision+" float;","precision "+g.precision+" int;","#define SHADER_NAME "+d.__webglShader.name,da,g.alphaTest?"#define ALPHATEST "+
g.alphaTest:"","#define GAMMA_FACTOR "+Z,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+R:"",g.envMap?"#define "+O:"",g.envMap?"#define "+P:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":
"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.vertexColors?"#define USE_COLOR":"",g.gradientMap?"#define USE_GRADIENTMAP":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+g.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(g.numClippingPlanes-g.numClipIntersection),g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+M:"",g.premultipliedAlpha?
"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",g.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==g.toneMapping?"#define TONE_MAPPING":"",0!==g.toneMapping?Mb.tonemapping_pars_fragment:"",0!==g.toneMapping?Bb("toneMapping",
g.toneMapping):"",g.outputEncoding||g.mapEncoding||g.envMapEncoding||g.emissiveMapEncoding?Mb.encodings_pars_fragment:"",g.mapEncoding?fb("mapTexelToLinear",g.mapEncoding):"",g.envMapEncoding?fb("envMapTexelToLinear",g.envMapEncoding):"",g.emissiveMapEncoding?fb("emissiveMapTexelToLinear",g.emissiveMapEncoding):"",g.outputEncoding?ab("linearToOutputTexel",g.outputEncoding):"",g.depthPacking?"#define DEPTH_PACKING "+d.depthPacking:"","\n"].filter(Ob).join("\n"));H=jb(H,g);H=Rb(H,g);K=jb(K,g);K=Rb(K,
g);d.isShaderMaterial||(H=Wb(H),K=Wb(K));K=M+K;H=Ra(u,u.VERTEX_SHADER,A+H);K=Ra(u,u.FRAGMENT_SHADER,K);u.attachShader(na,H);u.attachShader(na,K);void 0!==d.index0AttributeName?u.bindAttribLocation(na,0,d.index0AttributeName):!0===g.morphTargets&&u.bindAttribLocation(na,0,"position");u.linkProgram(na);g=u.getProgramInfoLog(na);R=u.getShaderInfoLog(H);O=u.getShaderInfoLog(K);Z=P=!0;if(!1===u.getProgramParameter(na,u.LINK_STATUS))P=!1,console.error("THREE.WebGLProgram: shader error: ",u.getError(),"gl.VALIDATE_STATUS",
u.getProgramParameter(na,u.VALIDATE_STATUS),"gl.getProgramInfoLog",g,R,O);else if(""!==g)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",g);else if(""===R||""===O)Z=!1;Z&&(this.diagnostics={runnable:P,material:d,programLog:g,vertexShader:{log:R,prefix:A},fragmentShader:{log:O,prefix:M}});u.deleteShader(H);u.deleteShader(K);var qa;this.getUniforms=function(){void 0===qa&&(qa=new pa(u,na,a));return qa};var sa;this.getAttributes=function(){if(void 0===sa){for(var ba={},oa=u.getProgramParameter(na,
u.ACTIVE_ATTRIBUTES),la=0;la<oa;la++){var wa=u.getActiveAttrib(na,la).name;ba[wa]=u.getAttribLocation(na,wa)}sa=ba}return sa};this.destroy=function(){u.deleteProgram(na);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=Sg++;this.code=c;this.usedTimes=
1;this.program=na;this.vertexShader=H;this.fragmentShader=K;return this}function dc(a,c){function d(A,H){if(A)A.isTexture?K=A.encoding:A.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),K=A.texture.encoding);else var K=3E3;3E3===K&&H&&(K=3007);return K}var g=[],u={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",
MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},x="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking".split(" ");
this.getParameters=function(A,H,K,M,R,O){var P=u[A.type];if(c.floatVertexTextures&&O&&O.skeleton&&O.skeleton.useVertexTexture)var Z=1024;else Z=Math.floor((c.maxVertexUniforms-20)/4),void 0!==O&&O&&O.isSkinnedMesh&&(Z=Math.min(O.skeleton.bones.length,Z),Z<O.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+O.skeleton.bones.length+", this GPU supports just "+Z+" (try OpenGL instead of ANGLE)"));var da=a.getPrecision();null!==A.precision&&(da=c.getMaxPrecision(A.precision),da!==
A.precision&&console.warn("THREE.WebGLProgram.getParameters:",A.precision,"not supported, using",da,"instead."));var na=a.getCurrentRenderTarget();return{shaderID:P,precision:da,supportsVertexTextures:c.vertexTextures,outputEncoding:d(na?na.texture:null,a.gammaOutput),map:!!A.map,mapEncoding:d(A.map,a.gammaInput),envMap:!!A.envMap,envMapMode:A.envMap&&A.envMap.mapping,envMapEncoding:d(A.envMap,a.gammaInput),envMapCubeUV:!!A.envMap&&(306===A.envMap.mapping||307===A.envMap.mapping),lightMap:!!A.lightMap,
aoMap:!!A.aoMap,emissiveMap:!!A.emissiveMap,emissiveMapEncoding:d(A.emissiveMap,a.gammaInput),bumpMap:!!A.bumpMap,normalMap:!!A.normalMap,displacementMap:!!A.displacementMap,roughnessMap:!!A.roughnessMap,metalnessMap:!!A.metalnessMap,specularMap:!!A.specularMap,alphaMap:!!A.alphaMap,gradientMap:!!A.gradientMap,combine:A.combine,vertexColors:A.vertexColors,fog:!!K,useFog:A.fog,fogExp:K&&K.isFogExp2,flatShading:1===A.shading,sizeAttenuation:A.sizeAttenuation,logarithmicDepthBuffer:c.logarithmicDepthBuffer,
skinning:A.skinning,maxBones:Z,useVertexTexture:c.floatVertexTextures&&O&&O.skeleton&&O.skeleton.useVertexTexture,morphTargets:A.morphTargets,morphNormals:A.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:H.directional.length,numPointLights:H.point.length,numSpotLights:H.spot.length,numRectAreaLights:H.rectArea.length,numHemiLights:H.hemi.length,numClippingPlanes:M,numClipIntersection:R,shadowMapEnabled:a.shadowMap.enabled&&O.receiveShadow&&0<H.shadows.length,
shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:A.premultipliedAlpha,alphaTest:A.alphaTest,doubleSided:2===A.side,flipSided:1===A.side,depthPacking:void 0!==A.depthPacking?A.depthPacking:!1}};this.getProgramCode=function(A,H){var K=[];H.shaderID?K.push(H.shaderID):(K.push(A.fragmentShader),K.push(A.vertexShader));if(void 0!==A.defines)for(var M in A.defines)K.push(M),K.push(A.defines[M]);for(A=0;A<x.length;A++)K.push(H[x[A]]);
return K.join()};this.acquireProgram=function(A,H,K){for(var M,R=0,O=g.length;R<O;R++){var P=g[R];if(P.code===K){M=P;++M.usedTimes;break}}void 0===M&&(M=new cc(a,K,A,H),g.push(M));return M};this.releaseProgram=function(A){if(0===--A.usedTimes){var H=g.indexOf(A);g[H]=g[g.length-1];g.pop();A.destroy()}};this.programs=g}function Hc(a,c,d){function g(A){var H=A.target;A=x[H.id];null!==A.index&&u(A.index);var K=A.attributes;for(M in K)u(K[M]);H.removeEventListener("dispose",g);delete x[H.id];var M=c.get(H);
M.wireframe&&u(M.wireframe);c.delete(H);H=c.get(A);H.wireframe&&u(H.wireframe);c.delete(A);d.memory.geometries--}function u(A){var H=A.isInterleavedBufferAttribute?c.get(A.data).__webglBuffer:c.get(A).__webglBuffer;void 0!==H&&(a.deleteBuffer(H),A.isInterleavedBufferAttribute?c.delete(A.data):c.delete(A))}var x={};return{get:function(A){var H=A.geometry;if(void 0!==x[H.id])return x[H.id];H.addEventListener("dispose",g);if(H.isBufferGeometry)var K=H;else H.isGeometry&&(void 0===H._bufferGeometry&&
(H._bufferGeometry=(new ob).setFromObject(A)),K=H._bufferGeometry);x[H.id]=K;d.memory.geometries++;return K}}}function mc(a,c,d){function g(x,A){x=x.isInterleavedBufferAttribute?x.data:x;var H=c.get(x);if(void 0===H.__webglBuffer){H.__webglBuffer=a.createBuffer();a.bindBuffer(A,H.__webglBuffer);a.bufferData(A,x.array,x.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW);A=a.FLOAT;var K=x.array;K instanceof Float32Array?A=a.FLOAT:K instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):
K instanceof Uint16Array?A=a.UNSIGNED_SHORT:K instanceof Int16Array?A=a.SHORT:K instanceof Uint32Array?A=a.UNSIGNED_INT:K instanceof Int32Array?A=a.INT:K instanceof Int8Array?A=a.BYTE:K instanceof Uint8Array&&(A=a.UNSIGNED_BYTE);H.bytesPerElement=K.BYTES_PER_ELEMENT;H.type=A;H.version=x.version;x.onUploadCallback()}else H.version!==x.version&&(a.bindBuffer(A,H.__webglBuffer),!1===x.dynamic?a.bufferData(A,x.array,a.STATIC_DRAW):-1===x.updateRange.count?a.bufferSubData(A,0,x.array):0===x.updateRange.count?
console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(A,x.updateRange.offset*x.array.BYTES_PER_ELEMENT,x.array.subarray(x.updateRange.offset,x.updateRange.offset+x.updateRange.count)),x.updateRange.count=0),H.version=x.version)}var u=new Hc(a,c,d);return{getAttributeBuffer:function(x){return x.isInterleavedBufferAttribute?c.get(x.data).__webglBuffer:c.get(x).__webglBuffer},
getAttributeProperties:function(x){return x.isInterleavedBufferAttribute?c.get(x.data):c.get(x)},getWireframeAttribute:function(x){var A=c.get(x);if(void 0!==A.wireframe)return A.wireframe;var H=[],K=x.index;x=x.attributes;if(null!==K){K=K.array;x=0;for(var M=K.length;x<M;x+=3){var R=K[x+0],O=K[x+1],P=K[x+2];H.push(R,O,O,P,P,R)}}else for(K=x.position.array,x=0,M=K.length/3-1;x<M;x+=3)R=x+0,O=x+1,P=x+2,H.push(R,O,O,P,P,R);H=new (65535<Rc(H)?Qc:Bc)(H,1);g(H,a.ELEMENT_ARRAY_BUFFER);return A.wireframe=
H},update:function(x){var A=u.get(x);x.geometry.isGeometry&&A.updateFromObject(x);x=A.index;var H=A.attributes;null!==x&&g(x,a.ELEMENT_ARRAY_BUFFER);for(var K in H)g(H[K],a.ARRAY_BUFFER);x=A.morphAttributes;for(K in x){H=x[K];for(var M=0,R=H.length;M<R;M++)g(H[M],a.ARRAY_BUFFER)}return A}}}function Dc(a,c,d,g,u,x,A){function H(ba,oa){if(ba.width>oa||ba.height>oa){oa/=Math.max(ba.width,ba.height);var la=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");la.width=Math.floor(ba.width*
oa);la.height=Math.floor(ba.height*oa);la.getContext("2d").drawImage(ba,0,0,ba.width,ba.height,0,0,la.width,la.height);console.warn("THREE.WebGLRenderer: image is too big ("+ba.width+"x"+ba.height+"). Resized to "+la.width+"x"+la.height,ba);return la}return ba}function K(ba){return xb.isPowerOfTwo(ba.width)&&xb.isPowerOfTwo(ba.height)}function M(ba){return 1003===ba||1004===ba||1005===ba?a.NEAREST:a.LINEAR}function R(ba){ba=ba.target;ba.removeEventListener("dispose",R);a:{var oa=g.get(ba);if(ba.image&&
oa.__image__webglTextureCube)a.deleteTexture(oa.__image__webglTextureCube);else{if(void 0===oa.__webglInit)break a;a.deleteTexture(oa.__webglTexture)}g.delete(ba)}qa.textures--}function O(ba){ba=ba.target;ba.removeEventListener("dispose",O);var oa=g.get(ba),la=g.get(ba.texture);if(ba){void 0!==la.__webglTexture&&a.deleteTexture(la.__webglTexture);ba.depthTexture&&ba.depthTexture.dispose();if(ba.isWebGLRenderTargetCube)for(la=0;6>la;la++)a.deleteFramebuffer(oa.__webglFramebuffer[la]),oa.__webglDepthbuffer&&
a.deleteRenderbuffer(oa.__webglDepthbuffer[la]);else a.deleteFramebuffer(oa.__webglFramebuffer),oa.__webglDepthbuffer&&a.deleteRenderbuffer(oa.__webglDepthbuffer);g.delete(ba.texture);g.delete(ba)}qa.textures--}function P(ba,oa){var la=g.get(ba);if(0<ba.version&&la.__version!==ba.version){var wa=ba.image;if(void 0===wa)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",ba);else if(!1===wa.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",
ba);else{void 0===la.__webglInit&&(la.__webglInit=!0,ba.addEventListener("dispose",R),la.__webglTexture=a.createTexture(),qa.textures++);d.activeTexture(a.TEXTURE0+oa);d.bindTexture(a.TEXTURE_2D,la.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,ba.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ba.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,ba.unpackAlignment);var ya=H(ba.image,u.maxTextureSize);(1001!==ba.wrapS||1001!==ba.wrapT||1003!==ba.minFilter&&1006!==ba.minFilter)&&!1===K(ya)&&
(oa=ya,oa instanceof HTMLImageElement||oa instanceof HTMLCanvasElement?(wa=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),wa.width=xb.nearestPowerOfTwo(oa.width),wa.height=xb.nearestPowerOfTwo(oa.height),wa.getContext("2d").drawImage(oa,0,0,wa.width,wa.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+oa.width+"x"+oa.height+"). Resized to "+wa.width+"x"+wa.height,oa),ya=wa):ya=oa);oa=K(ya);wa=x(ba.format);var Ca=x(ba.type);Z(a.TEXTURE_2D,ba,oa);var Ja=ba.mipmaps;
if(ba.isDepthTexture){Ja=a.DEPTH_COMPONENT;if(1015===ba.type){if(!sa)throw Error("Float Depth Texture only supported in WebGL2.0");Ja=a.DEPTH_COMPONENT32F}else sa&&(Ja=a.DEPTH_COMPONENT16);1026===ba.format&&Ja===a.DEPTH_COMPONENT&&1012!==ba.type&&1014!==ba.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),ba.type=1012,Ca=x(ba.type));1027===ba.format&&(Ja=a.DEPTH_STENCIL,1020!==ba.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),
ba.type=1020,Ca=x(ba.type)));d.texImage2D(a.TEXTURE_2D,0,Ja,ya.width,ya.height,0,wa,Ca,null)}else if(ba.isDataTexture)if(0<Ja.length&&oa){for(var Pa=0,Na=Ja.length;Pa<Na;Pa++)ya=Ja[Pa],d.texImage2D(a.TEXTURE_2D,Pa,wa,ya.width,ya.height,0,wa,Ca,ya.data);ba.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,wa,ya.width,ya.height,0,wa,Ca,ya.data);else if(ba.isCompressedTexture)for(Pa=0,Na=Ja.length;Pa<Na;Pa++)ya=Ja[Pa],1023!==ba.format&&1022!==ba.format?-1<d.getCompressedTextureFormats().indexOf(wa)?
d.compressedTexImage2D(a.TEXTURE_2D,Pa,wa,ya.width,ya.height,0,ya.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):d.texImage2D(a.TEXTURE_2D,Pa,wa,ya.width,ya.height,0,wa,Ca,ya.data);else if(0<Ja.length&&oa){Pa=0;for(Na=Ja.length;Pa<Na;Pa++)ya=Ja[Pa],d.texImage2D(a.TEXTURE_2D,Pa,wa,wa,Ca,ya);ba.generateMipmaps=!1}else d.texImage2D(a.TEXTURE_2D,0,wa,wa,Ca,ya);ba.generateMipmaps&&oa&&a.generateMipmap(a.TEXTURE_2D);la.__version=ba.version;
if(ba.onUpdate)ba.onUpdate(ba);return}}d.activeTexture(a.TEXTURE0+oa);d.bindTexture(a.TEXTURE_2D,la.__webglTexture)}function Z(ba,oa,la){la?(a.texParameteri(ba,a.TEXTURE_WRAP_S,x(oa.wrapS)),a.texParameteri(ba,a.TEXTURE_WRAP_T,x(oa.wrapT)),a.texParameteri(ba,a.TEXTURE_MAG_FILTER,x(oa.magFilter)),a.texParameteri(ba,a.TEXTURE_MIN_FILTER,x(oa.minFilter))):(a.texParameteri(ba,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(ba,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===oa.wrapS&&1001===oa.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",
oa),a.texParameteri(ba,a.TEXTURE_MAG_FILTER,M(oa.magFilter)),a.texParameteri(ba,a.TEXTURE_MIN_FILTER,M(oa.minFilter)),1003!==oa.minFilter&&1006!==oa.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",oa));!(la=c.get("EXT_texture_filter_anisotropic"))||1015===oa.type&&null===c.get("OES_texture_float_linear")||1016===oa.type&&null===c.get("OES_texture_half_float_linear")||!(1<oa.anisotropy||g.get(oa).__currentAnisotropy)||
(a.texParameterf(ba,la.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(oa.anisotropy,u.getMaxAnisotropy())),g.get(oa).__currentAnisotropy=oa.anisotropy)}function da(ba,oa,la,wa){var ya=x(oa.texture.format),Ca=x(oa.texture.type);d.texImage2D(wa,0,ya,oa.width,oa.height,0,ya,Ca,null);a.bindFramebuffer(a.FRAMEBUFFER,ba);a.framebufferTexture2D(a.FRAMEBUFFER,la,wa,g.get(oa.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function na(ba,oa){a.bindRenderbuffer(a.RENDERBUFFER,ba);oa.depthBuffer&&!oa.stencilBuffer?
(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,oa.width,oa.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,ba)):oa.depthBuffer&&oa.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,oa.width,oa.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,ba)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,oa.width,oa.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var qa=A.memory,sa="undefined"!==typeof WebGL2RenderingContext&&
a instanceof WebGL2RenderingContext;this.setTexture2D=P;this.setTextureCube=function(ba,oa){var la=g.get(ba);if(6===ba.image.length)if(0<ba.version&&la.__version!==ba.version){la.__image__webglTextureCube||(ba.addEventListener("dispose",R),la.__image__webglTextureCube=a.createTexture(),qa.textures++);d.activeTexture(a.TEXTURE0+oa);d.bindTexture(a.TEXTURE_CUBE_MAP,la.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,ba.flipY);oa=ba&&ba.isCompressedTexture;for(var wa=ba.image[0]&&ba.image[0].isDataTexture,
ya=[],Ca=0;6>Ca;Ca++)ya[Ca]=oa||wa?wa?ba.image[Ca].image:ba.image[Ca]:H(ba.image[Ca],u.maxCubemapSize);var Ja=K(ya[0]),Pa=x(ba.format),Na=x(ba.type);Z(a.TEXTURE_CUBE_MAP,ba,Ja);for(Ca=0;6>Ca;Ca++)if(oa)for(var Ta,Qa=ya[Ca].mipmaps,Xa=0,hb=Qa.length;Xa<hb;Xa++)Ta=Qa[Xa],1023!==ba.format&&1022!==ba.format?-1<d.getCompressedTextureFormats().indexOf(Pa)?d.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,Xa,Pa,Ta.width,Ta.height,0,Ta.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):
d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,Xa,Pa,Ta.width,Ta.height,0,Pa,Na,Ta.data);else wa?d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,0,Pa,ya[Ca].width,ya[Ca].height,0,Pa,Na,ya[Ca].data):d.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+Ca,0,Pa,Pa,Na,ya[Ca]);ba.generateMipmaps&&Ja&&a.generateMipmap(a.TEXTURE_CUBE_MAP);la.__version=ba.version;if(ba.onUpdate)ba.onUpdate(ba)}else d.activeTexture(a.TEXTURE0+oa),d.bindTexture(a.TEXTURE_CUBE_MAP,la.__image__webglTextureCube)};this.setTextureCubeDynamic=
function(ba,oa){d.activeTexture(a.TEXTURE0+oa);d.bindTexture(a.TEXTURE_CUBE_MAP,g.get(ba).__webglTexture)};this.setupRenderTarget=function(ba){var oa=g.get(ba),la=g.get(ba.texture);ba.addEventListener("dispose",O);la.__webglTexture=a.createTexture();qa.textures++;var wa=!0===ba.isWebGLRenderTargetCube,ya=K(ba);if(wa){oa.__webglFramebuffer=[];for(var Ca=0;6>Ca;Ca++)oa.__webglFramebuffer[Ca]=a.createFramebuffer()}else oa.__webglFramebuffer=a.createFramebuffer();if(wa){d.bindTexture(a.TEXTURE_CUBE_MAP,
la.__webglTexture);Z(a.TEXTURE_CUBE_MAP,ba.texture,ya);for(Ca=0;6>Ca;Ca++)da(oa.__webglFramebuffer[Ca],ba,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+Ca);ba.texture.generateMipmaps&&ya&&a.generateMipmap(a.TEXTURE_CUBE_MAP);d.bindTexture(a.TEXTURE_CUBE_MAP,null)}else d.bindTexture(a.TEXTURE_2D,la.__webglTexture),Z(a.TEXTURE_2D,ba.texture,ya),da(oa.__webglFramebuffer,ba,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),ba.texture.generateMipmaps&&ya&&a.generateMipmap(a.TEXTURE_2D),d.bindTexture(a.TEXTURE_2D,
null);if(ba.depthBuffer){oa=g.get(ba);la=!0===ba.isWebGLRenderTargetCube;if(ba.depthTexture){if(la)throw Error("target.depthTexture not supported in Cube render targets");if(ba&&ba.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,oa.__webglFramebuffer);if(!ba.depthTexture||!ba.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");g.get(ba.depthTexture).__webglTexture&&
ba.depthTexture.image.width===ba.width&&ba.depthTexture.image.height===ba.height||(ba.depthTexture.image.width=ba.width,ba.depthTexture.image.height=ba.height,ba.depthTexture.needsUpdate=!0);P(ba.depthTexture,0);oa=g.get(ba.depthTexture).__webglTexture;if(1026===ba.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,oa,0);else if(1027===ba.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,oa,0);else throw Error("Unknown depthTexture format");
}else if(la)for(oa.__webglDepthbuffer=[],la=0;6>la;la++)a.bindFramebuffer(a.FRAMEBUFFER,oa.__webglFramebuffer[la]),oa.__webglDepthbuffer[la]=a.createRenderbuffer(),na(oa.__webglDepthbuffer[la],ba);else a.bindFramebuffer(a.FRAMEBUFFER,oa.__webglFramebuffer),oa.__webglDepthbuffer=a.createRenderbuffer(),na(oa.__webglDepthbuffer,ba);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(ba){var oa=ba.texture;oa.generateMipmaps&&K(ba)&&1003!==oa.minFilter&&1006!==oa.minFilter&&
(ba=ba&&ba.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,oa=g.get(oa).__webglTexture,d.bindTexture(ba,oa),a.generateMipmap(ba),d.bindTexture(ba,null))}}function kd(){var a={};return{get:function(c){c=c.uuid;var d=a[c];void 0===d&&(d={},a[c]=d);return d},delete:function(c){delete a[c.uuid]},clear:function(){a={}}}}function ef(a,c,d){function g(Ba,mb,nb){var tb=new Uint8Array(4),eb=a.createTexture();a.bindTexture(Ba,eb);a.texParameteri(Ba,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(Ba,
a.TEXTURE_MAG_FILTER,a.NEAREST);for(Ba=0;Ba<nb;Ba++)a.texImage2D(mb+Ba,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,tb);return eb}function u(Ba){!0!==ba[Ba]&&(a.enable(Ba),ba[Ba]=!0)}function x(Ba){!1!==ba[Ba]&&(a.disable(Ba),ba[Ba]=!1)}function A(Ba,mb,nb,tb,eb,yb,Eb,Ib){0!==Ba?u(a.BLEND):x(a.BLEND);if(Ba!==la||Ib!==Ta)2===Ba?Ib?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===Ba?Ib?(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===Ba?Ib?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):Ib?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,
a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),la=Ba,Ta=Ib;if(5===Ba){eb=eb||mb;yb=yb||nb;Eb=Eb||tb;if(mb!==wa||eb!==Ja)a.blendEquationSeparate(d(mb),d(eb)),wa=mb,Ja=eb;if(nb!==ya||tb!==Ca||yb!==Pa||Eb!==Na)a.blendFuncSeparate(d(nb),d(tb),d(yb),d(Eb)),ya=nb,Ca=tb,Pa=yb,Na=Eb}else Na=Pa=Ja=Ca=ya=wa=null}function H(Ba){P.setFunc(Ba)}function K(Ba){Qa!==Ba&&(Ba?a.frontFace(a.CW):a.frontFace(a.CCW),Qa=Ba)}function M(Ba){0!==Ba?(u(a.CULL_FACE),Ba!==Xa&&
(1===Ba?a.cullFace(a.BACK):2===Ba?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):x(a.CULL_FACE);Xa=Ba}function R(Ba){void 0===Ba&&(Ba=a.TEXTURE0+Ga-1);Ya!==Ba&&(a.activeTexture(Ba),Ya=Ba)}var O=new function(){var Ba=!1,mb=new p,nb=null,tb=new p;return{setMask:function(eb){nb===eb||Ba||(a.colorMask(eb,eb,eb,eb),nb=eb)},setLocked:function(eb){Ba=eb},setClear:function(eb,yb,Eb,Ib,Ub){!0===Ub&&(eb*=Ib,yb*=Ib,Eb*=Ib);mb.set(eb,yb,Eb,Ib);!1===tb.equals(mb)&&(a.clearColor(eb,yb,Eb,Ib),tb.copy(mb))},
reset:function(){Ba=!1;nb=null;tb.set(0,0,0,1)}}},P=new function(){var Ba=!1,mb=null,nb=null,tb=null;return{setTest:function(eb){eb?u(a.DEPTH_TEST):x(a.DEPTH_TEST)},setMask:function(eb){mb===eb||Ba||(a.depthMask(eb),mb=eb)},setFunc:function(eb){if(nb!==eb){if(eb)switch(eb){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);
break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);nb=eb}},setLocked:function(eb){Ba=eb},setClear:function(eb){tb!==eb&&(a.clearDepth(eb),tb=eb)},reset:function(){Ba=!1;tb=nb=mb=null}}},Z=new function(){var Ba=!1,mb=null,nb=null,tb=null,eb=null,yb=null,Eb=null,Ib=null,Ub=null;return{setTest:function(Xb){Xb?u(a.STENCIL_TEST):x(a.STENCIL_TEST)},setMask:function(Xb){mb===Xb||Ba||(a.stencilMask(Xb),mb=Xb)},setFunc:function(Xb,Sc,vc){if(nb!==Xb||tb!==Sc||
eb!==vc)a.stencilFunc(Xb,Sc,vc),nb=Xb,tb=Sc,eb=vc},setOp:function(Xb,Sc,vc){if(yb!==Xb||Eb!==Sc||Ib!==vc)a.stencilOp(Xb,Sc,vc),yb=Xb,Eb=Sc,Ib=vc},setLocked:function(Xb){Ba=Xb},setClear:function(Xb){Ub!==Xb&&(a.clearStencil(Xb),Ub=Xb)},reset:function(){Ba=!1;Ub=Ib=Eb=yb=eb=tb=nb=mb=null}}},da=a.getParameter(a.MAX_VERTEX_ATTRIBS),na=new Uint8Array(da),qa=new Uint8Array(da),sa=new Uint8Array(da),ba={},oa=null,la=null,wa=null,ya=null,Ca=null,Ja=null,Pa=null,Na=null,Ta=!1,Qa=null,Xa=null,hb=null,Ua=null,
Ma=null,Sa=null,Ga=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);da=parseFloat(/^WebGL ([0-9])/.exec(a.getParameter(a.VERSION))[1]);var db=1<=parseFloat(da),Ya=null,Cb={},Jb=new p,Kb=new p,pb={};pb[a.TEXTURE_2D]=g(a.TEXTURE_2D,a.TEXTURE_2D,1);pb[a.TEXTURE_CUBE_MAP]=g(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:O,depth:P,stencil:Z},init:function(){O.setClear(0,0,0,1);P.setClear(1);Z.setClear(0);u(a.DEPTH_TEST);H(3);K(!1);M(1);u(a.CULL_FACE);u(a.BLEND);A(1)},initAttributes:function(){for(var Ba=
0,mb=na.length;Ba<mb;Ba++)na[Ba]=0},enableAttribute:function(Ba){na[Ba]=1;0===qa[Ba]&&(a.enableVertexAttribArray(Ba),qa[Ba]=1);0!==sa[Ba]&&(c.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(Ba,0),sa[Ba]=0)},enableAttributeAndDivisor:function(Ba,mb,nb){na[Ba]=1;0===qa[Ba]&&(a.enableVertexAttribArray(Ba),qa[Ba]=1);sa[Ba]!==mb&&(nb.vertexAttribDivisorANGLE(Ba,mb),sa[Ba]=mb)},disableUnusedAttributes:function(){for(var Ba=0,mb=qa.length;Ba!==mb;++Ba)qa[Ba]!==na[Ba]&&(a.disableVertexAttribArray(Ba),
qa[Ba]=0)},enable:u,disable:x,getCompressedTextureFormats:function(){if(null===oa&&(oa=[],c.get("WEBGL_compressed_texture_pvrtc")||c.get("WEBGL_compressed_texture_s3tc")||c.get("WEBGL_compressed_texture_etc1")))for(var Ba=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),mb=0;mb<Ba.length;mb++)oa.push(Ba[mb]);return oa},setBlending:A,setColorWrite:function(Ba){O.setMask(Ba)},setDepthTest:function(Ba){P.setTest(Ba)},setDepthWrite:function(Ba){P.setMask(Ba)},setDepthFunc:H,setStencilTest:function(Ba){Z.setTest(Ba)},
setStencilWrite:function(Ba){Z.setMask(Ba)},setStencilFunc:function(Ba,mb,nb){Z.setFunc(Ba,mb,nb)},setStencilOp:function(Ba,mb,nb){Z.setOp(Ba,mb,nb)},setFlipSided:K,setCullFace:M,setLineWidth:function(Ba){Ba!==hb&&(db&&a.lineWidth(Ba),hb=Ba)},setPolygonOffset:function(Ba,mb,nb){if(Ba){if(u(a.POLYGON_OFFSET_FILL),Ua!==mb||Ma!==nb)a.polygonOffset(mb,nb),Ua=mb,Ma=nb}else x(a.POLYGON_OFFSET_FILL)},getScissorTest:function(){return Sa},setScissorTest:function(Ba){(Sa=Ba)?u(a.SCISSOR_TEST):x(a.SCISSOR_TEST)},
activeTexture:R,bindTexture:function(Ba,mb){null===Ya&&R();var nb=Cb[Ya];void 0===nb&&(nb={type:void 0,texture:void 0},Cb[Ya]=nb);if(nb.type!==Ba||nb.texture!==mb)a.bindTexture(Ba,mb||pb[Ba]),nb.type=Ba,nb.texture=mb},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(Ba){console.error(Ba)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(Ba){console.error(Ba)}},scissor:function(Ba){!1===Jb.equals(Ba)&&(a.scissor(Ba.x,Ba.y,Ba.z,Ba.w),Jb.copy(Ba))},
viewport:function(Ba){!1===Kb.equals(Ba)&&(a.viewport(Ba.x,Ba.y,Ba.z,Ba.w),Kb.copy(Ba))},reset:function(){for(var Ba=0;Ba<qa.length;Ba++)1===qa[Ba]&&(a.disableVertexAttribArray(Ba),qa[Ba]=0);ba={};Ya=oa=null;Cb={};Xa=Qa=la=null;O.reset();P.reset();Z.reset()}}}function Tg(a,c,d){function g(qa){if("highp"===qa){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";qa="mediump"}return"mediump"===qa&&
0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var u,x=void 0!==d.precision?d.precision:"highp",A=g(x);A!==x&&(console.warn("THREE.WebGLRenderer:",x,"not supported, using",A,"instead."),x=A);d=!0===d.logarithmicDepthBuffer&&!!c.get("EXT_frag_depth");A=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);var H=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),K=a.getParameter(a.MAX_TEXTURE_SIZE),
M=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),R=a.getParameter(a.MAX_VERTEX_ATTRIBS),O=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),P=a.getParameter(a.MAX_VARYING_VECTORS),Z=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),da=0<H,na=!!c.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==u)return u;var qa=c.get("EXT_texture_filter_anisotropic");return u=null!==qa?a.getParameter(qa.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:g,precision:x,logarithmicDepthBuffer:d,maxTextures:A,
maxVertexTextures:H,maxTextureSize:K,maxCubemapSize:M,maxAttributes:R,maxVertexUniforms:O,maxVaryings:P,maxFragmentUniforms:Z,vertexTextures:da,floatFragmentTextures:na,floatVertexTextures:da&&na}}function Ug(a){var c={};return{get:function(d){if(void 0!==c[d])return c[d];switch(d){case "WEBGL_depth_texture":var g=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":g=a.getExtension("EXT_texture_filter_anisotropic")||
a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":g=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":g=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":g=
a.getExtension("WEBGL_compressed_texture_etc1");break;default:g=a.getExtension(d)}null===g&&console.warn("THREE.WebGLRenderer: "+d+" extension not supported.");return c[d]=g}}}function Vg(){function a(){M.value!==g&&(M.value=g,M.needsUpdate=0<u);d.numPlanes=u;d.numIntersection=0}function c(R,O,P,Z){var da=null!==R?R.length:0,na=null;if(0!==da){na=M.value;if(!0!==Z||null===na){Z=P+4*da;O=O.matrixWorldInverse;K.getNormalMatrix(O);if(null===na||na.length<Z)na=new Float32Array(Z);for(Z=0;Z!==da;++Z,P+=
4)H.copy(R[Z]).applyMatrix4(O,K),H.normal.toArray(na,P),na[P+3]=H.constant}M.value=na;M.needsUpdate=!0}d.numPlanes=da;return na}var d=this,g=null,u=0,x=!1,A=!1,H=new Sb,K=new Pb,M={value:null,needsUpdate:!1};this.uniform=M;this.numIntersection=this.numPlanes=0;this.init=function(R,O,P){var Z=0!==R.length||O||0!==u||x;x=O;g=c(R,P,0);u=R.length;return Z};this.beginShadows=function(){A=!0;c(null)};this.endShadows=function(){A=!1;a()};this.setState=function(R,O,P,Z,da,na){if(!x||null===R||0===R.length||
A&&!P)A?c(null):a();else{P=A?0:u;var qa=4*P,sa=da.clippingState||null;M.value=sa;sa=c(R,Z,qa,na);for(R=0;R!==qa;++R)sa[R]=g[R];da.clippingState=sa;this.numIntersection=O?this.numPlanes:0;this.numPlanes+=P}}}function Rf(a){function c(){wb.init();wb.scissor(Ba.copy(Xb).multiplyScalar(Ub));wb.viewport(nb.copy(vc).multiplyScalar(Ub));wb.buffers.color.setClear(eb.r,eb.g,eb.b,yb,Ja)}function d(){pb=db=null;Kb="";Jb=-1;wb.reset()}function g(fa){fa.preventDefault();d();c();wc.clear()}function u(fa){fa=fa.target;
fa.removeEventListener("dispose",u);x(fa);wc.delete(fa)}function x(fa){var ta=wc.get(fa).program;fa.program=void 0;void 0!==ta&&ve.releaseProgram(ta)}function A(fa,ta){return Math.abs(ta[0])-Math.abs(fa[0])}function H(fa,ta){return fa.object.renderOrder!==ta.object.renderOrder?fa.object.renderOrder-ta.object.renderOrder:fa.material.program&&ta.material.program&&fa.material.program!==ta.material.program?fa.material.program.id-ta.material.program.id:fa.material.id!==ta.material.id?fa.material.id-ta.material.id:
fa.z!==ta.z?fa.z-ta.z:fa.id-ta.id}function K(fa,ta){return fa.object.renderOrder!==ta.object.renderOrder?fa.object.renderOrder-ta.object.renderOrder:fa.z!==ta.z?ta.z-fa.z:fa.id-ta.id}function M(fa,ta,ra,bb,gb){if(ra.transparent){bb=Xa;var qb=++hb}else bb=Ta,qb=++Qa;qb=bb[qb];void 0!==qb?(qb.id=fa.id,qb.object=fa,qb.geometry=ta,qb.material=ra,qb.z=jc.z,qb.group=gb):(qb={id:fa.id,object:fa,geometry:ta,material:ra,z:jc.z,group:gb},bb.push(qb))}function R(fa){if(!xg.intersectsSphere(fa))return!1;var ta=
Ec.numPlanes;if(0===ta)return!0;var ra=Ga.clippingPlanes,bb=fa.center;fa=-fa.radius;var gb=0;do if(ra[gb].distanceToPoint(bb)<fa)return!1;while(++gb!==ta);return!0}function O(fa,ta){if(!1!==fa.visible){if(0!==(fa.layers.mask&ta.layers.mask))if(fa.isLight)Na.push(fa);else if(fa.isSprite){var ra;(ra=!1===fa.frustumCulled)||(Hd.center.set(0,0,0),Hd.radius=.7071067811865476,Hd.applyMatrix4(fa.matrixWorld),ra=!0===R(Hd));ra&&Ma.push(fa)}else if(fa.isLensFlare)Sa.push(fa);else if(fa.isImmediateRenderObject)!0===
Ga.sortObjects&&(jc.setFromMatrixPosition(fa.matrixWorld),jc.applyMatrix4(ff)),M(fa,null,fa.material,jc.z,null);else if(fa.isMesh||fa.isLine||fa.isPoints)if(fa.isSkinnedMesh&&fa.skeleton.update(),(ra=!1===fa.frustumCulled)||(ra=fa.geometry,null===ra.boundingSphere&&ra.computeBoundingSphere(),Hd.copy(ra.boundingSphere).applyMatrix4(fa.matrixWorld),ra=!0===R(Hd)),ra){var bb=fa.material;if(!0===bb.visible)if(!0===Ga.sortObjects&&(jc.setFromMatrixPosition(fa.matrixWorld),jc.applyMatrix4(ff)),ra=ld.update(fa),
bb.isMultiMaterial){var gb=ra.groups,qb=bb.materials;if(0<gb.length){bb=0;for(var Wa=gb.length;bb<Wa;bb++){var za=gb[bb],ub=qb[za.materialIndex];void 0===ub?console.warn("THREE.WebGLRenderer: MultiMaterial has insufficient amount of materials for geometry. %i material(s) expected but only %i provided.",gb.length,qb.length):!0===ub.visible&&M(fa,ra,ub,jc.z,za)}}else console.warn("THREE.WebGLRenderer: MultiMaterial can not be used without groups.")}else M(fa,ra,bb,jc.z,null)}fa=fa.children;bb=0;for(Wa=
fa.length;bb<Wa;bb++)O(fa[bb],ta)}}function P(fa,ta,ra,bb){for(var gb=0,qb=fa.length;gb<qb;gb++){var Wa=fa[gb],za=Wa.object,ub=Wa.geometry,Lb=void 0===bb?Wa.material:bb;Wa=Wa.group;za.modelViewMatrix.multiplyMatrices(ra.matrixWorldInverse,za.matrixWorld);za.normalMatrix.getNormalMatrix(za.modelViewMatrix);za.onBeforeRender(Ga,ta,ra,ub,Lb,Wa);if(za.isImmediateRenderObject){Z(Lb);var Yb=da(ra,ta.fog,Lb,za);Kb="";za.render(function(Gb){Ga.renderBufferImmediate(Gb,Yb,Lb)})}else Ga.renderBufferDirect(ra,
ta.fog,ub,Lb,za,Wa);za.onAfterRender(Ga,ta,ra,ub,Lb,Wa)}}function Z(fa){2===fa.side?wb.disable(Fa.CULL_FACE):wb.enable(Fa.CULL_FACE);wb.setFlipSided(1===fa.side);!0===fa.transparent?wb.setBlending(fa.blending,fa.blendEquation,fa.blendSrc,fa.blendDst,fa.blendEquationAlpha,fa.blendSrcAlpha,fa.blendDstAlpha,fa.premultipliedAlpha):wb.setBlending(0);wb.setDepthFunc(fa.depthFunc);wb.setDepthTest(fa.depthTest);wb.setDepthWrite(fa.depthWrite);wb.setColorWrite(fa.colorWrite);wb.setPolygonOffset(fa.polygonOffset,
fa.polygonOffsetFactor,fa.polygonOffsetUnits)}function da(fa,ta,ra,bb){tb=0;var gb=wc.get(ra);gf&&(Sf||fa!==pb)&&Ec.setState(ra.clippingPlanes,ra.clipIntersection,ra.clipShadows,fa,gb,fa===pb&&ra.id===Jb);!1===ra.needsUpdate&&(void 0===gb.program?ra.needsUpdate=!0:ra.fog&&gb.fog!==ta?ra.needsUpdate=!0:ra.lights&&gb.lightsHash!==Db.hash?ra.needsUpdate=!0:void 0===gb.numClippingPlanes||gb.numClippingPlanes===Ec.numPlanes&&gb.numIntersection===Ec.numIntersection||(ra.needsUpdate=!0));if(ra.needsUpdate){a:{var qb=
wc.get(ra),Wa=ve.getParameters(ra,Db,ta,Ec.numPlanes,Ec.numIntersection,bb),za=ve.getProgramCode(ra,Wa),ub=qb.program,Lb=!0;if(void 0===ub)ra.addEventListener("dispose",u);else if(ub.code!==za)x(ra);else if(void 0!==Wa.shaderID)break a;else Lb=!1;Lb&&(Wa.shaderID?(ub=dd[Wa.shaderID],qb.__webglShader={name:ra.type,uniforms:nc.clone(ub.uniforms),vertexShader:ub.vertexShader,fragmentShader:ub.fragmentShader}):qb.__webglShader={name:ra.type,uniforms:ra.uniforms,vertexShader:ra.vertexShader,fragmentShader:ra.fragmentShader},
ra.__webglShader=qb.__webglShader,ub=ve.acquireProgram(ra,Wa,za),qb.program=ub,ra.program=ub);Wa=ub.getAttributes();if(ra.morphTargets)for(za=ra.numSupportedMorphTargets=0;za<Ga.maxMorphTargets;za++)0<=Wa["morphTarget"+za]&&ra.numSupportedMorphTargets++;if(ra.morphNormals)for(za=ra.numSupportedMorphNormals=0;za<Ga.maxMorphNormals;za++)0<=Wa["morphNormal"+za]&&ra.numSupportedMorphNormals++;Wa=qb.__webglShader.uniforms;if(!ra.isShaderMaterial&&!ra.isRawShaderMaterial||!0===ra.clipping)qb.numClippingPlanes=
Ec.numPlanes,qb.numIntersection=Ec.numIntersection,Wa.clippingPlanes=Ec.uniform;qb.fog=ta;qb.lightsHash=Db.hash;ra.lights&&(Wa.ambientLightColor.value=Db.ambient,Wa.directionalLights.value=Db.directional,Wa.spotLights.value=Db.spot,Wa.rectAreaLights.value=Db.rectArea,Wa.pointLights.value=Db.point,Wa.hemisphereLights.value=Db.hemi,Wa.directionalShadowMap.value=Db.directionalShadowMap,Wa.directionalShadowMatrix.value=Db.directionalShadowMatrix,Wa.spotShadowMap.value=Db.spotShadowMap,Wa.spotShadowMatrix.value=
Db.spotShadowMatrix,Wa.pointShadowMap.value=Db.pointShadowMap,Wa.pointShadowMatrix.value=Db.pointShadowMatrix);za=qb.program.getUniforms();Wa=pa.seqWithValue(za.seq,Wa);qb.uniformsList=Wa}ra.needsUpdate=!1}var Yb=!1;Lb=ub=!1;qb=gb.program;Wa=qb.getUniforms();za=gb.__webglShader.uniforms;qb.id!==db&&(Fa.useProgram(qb.program),db=qb.id,Lb=ub=Yb=!0);ra.id!==Jb&&(Jb=ra.id,ub=!0);if(Yb||fa!==pb){Wa.set(Fa,fa,"projectionMatrix");Tc.logarithmicDepthBuffer&&Wa.setValue(Fa,"logDepthBufFC",2/(Math.log(fa.far+
1)/Math.LN2));fa!==pb&&(pb=fa,Lb=ub=!0);if(ra.isShaderMaterial||ra.isMeshPhongMaterial||ra.isMeshStandardMaterial||ra.envMap)Yb=Wa.map.cameraPosition,void 0!==Yb&&Yb.setValue(Fa,jc.setFromMatrixPosition(fa.matrixWorld));(ra.isMeshPhongMaterial||ra.isMeshLambertMaterial||ra.isMeshBasicMaterial||ra.isMeshStandardMaterial||ra.isShaderMaterial||ra.skinning)&&Wa.setValue(Fa,"viewMatrix",fa.matrixWorldInverse);Wa.set(Fa,Ga,"toneMappingExposure");Wa.set(Fa,Ga,"toneMappingWhitePoint")}ra.skinning&&(Wa.setOptional(Fa,
bb,"bindMatrix"),Wa.setOptional(Fa,bb,"bindMatrixInverse"),fa=bb.skeleton)&&(Tc.floatVertexTextures&&fa.useVertexTexture?(Wa.set(Fa,fa,"boneTexture"),Wa.set(Fa,fa,"boneTextureWidth"),Wa.set(Fa,fa,"boneTextureHeight")):Wa.setOptional(Fa,fa,"boneMatrices"));if(ub){ra.lights&&(fa=Lb,za.ambientLightColor.needsUpdate=fa,za.directionalLights.needsUpdate=fa,za.pointLights.needsUpdate=fa,za.spotLights.needsUpdate=fa,za.rectAreaLights.needsUpdate=fa,za.hemisphereLights.needsUpdate=fa);ta&&ra.fog&&(za.fogColor.value=
ta.color,ta.isFog?(za.fogNear.value=ta.near,za.fogFar.value=ta.far):ta.isFogExp2&&(za.fogDensity.value=ta.density));if(ra.isMeshBasicMaterial||ra.isMeshLambertMaterial||ra.isMeshPhongMaterial||ra.isMeshStandardMaterial||ra.isMeshNormalMaterial||ra.isMeshDepthMaterial){za.opacity.value=ra.opacity;za.diffuse.value=ra.color;ra.emissive&&za.emissive.value.copy(ra.emissive).multiplyScalar(ra.emissiveIntensity);za.map.value=ra.map;za.specularMap.value=ra.specularMap;za.alphaMap.value=ra.alphaMap;ra.lightMap&&
(za.lightMap.value=ra.lightMap,za.lightMapIntensity.value=ra.lightMapIntensity);ra.aoMap&&(za.aoMap.value=ra.aoMap,za.aoMapIntensity.value=ra.aoMapIntensity);if(ra.map)var Gb=ra.map;else ra.specularMap?Gb=ra.specularMap:ra.displacementMap?Gb=ra.displacementMap:ra.normalMap?Gb=ra.normalMap:ra.bumpMap?Gb=ra.bumpMap:ra.roughnessMap?Gb=ra.roughnessMap:ra.metalnessMap?Gb=ra.metalnessMap:ra.alphaMap?Gb=ra.alphaMap:ra.emissiveMap&&(Gb=ra.emissiveMap);void 0!==Gb&&(Gb.isWebGLRenderTarget&&(Gb=Gb.texture),
ta=Gb.offset,Gb=Gb.repeat,za.offsetRepeat.value.set(ta.x,ta.y,Gb.x,Gb.y));za.envMap.value=ra.envMap;za.flipEnvMap.value=ra.envMap&&ra.envMap.isCubeTexture?-1:1;za.reflectivity.value=ra.reflectivity;za.refractionRatio.value=ra.refractionRatio}ra.isLineBasicMaterial?(za.diffuse.value=ra.color,za.opacity.value=ra.opacity):ra.isLineDashedMaterial?(za.diffuse.value=ra.color,za.opacity.value=ra.opacity,za.dashSize.value=ra.dashSize,za.totalSize.value=ra.dashSize+ra.gapSize,za.scale.value=ra.scale):ra.isPointsMaterial?
(za.diffuse.value=ra.color,za.opacity.value=ra.opacity,za.size.value=ra.size*Ub,za.scale.value=.5*Ib,za.map.value=ra.map,null!==ra.map&&(Gb=ra.map.offset,ra=ra.map.repeat,za.offsetRepeat.value.set(Gb.x,Gb.y,ra.x,ra.y))):ra.isMeshLambertMaterial?ra.emissiveMap&&(za.emissiveMap.value=ra.emissiveMap):ra.isMeshToonMaterial?(na(za,ra),ra.gradientMap&&(za.gradientMap.value=ra.gradientMap)):ra.isMeshPhongMaterial?na(za,ra):ra.isMeshPhysicalMaterial?(za.clearCoat.value=ra.clearCoat,za.clearCoatRoughness.value=
ra.clearCoatRoughness,qa(za,ra)):ra.isMeshStandardMaterial?qa(za,ra):ra.isMeshDepthMaterial?ra.displacementMap&&(za.displacementMap.value=ra.displacementMap,za.displacementScale.value=ra.displacementScale,za.displacementBias.value=ra.displacementBias):ra.isMeshNormalMaterial&&(ra.bumpMap&&(za.bumpMap.value=ra.bumpMap,za.bumpScale.value=ra.bumpScale),ra.normalMap&&(za.normalMap.value=ra.normalMap,za.normalScale.value.copy(ra.normalScale)),ra.displacementMap&&(za.displacementMap.value=ra.displacementMap,
za.displacementScale.value=ra.displacementScale,za.displacementBias.value=ra.displacementBias));void 0!==za.ltcMat&&(za.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE);void 0!==za.ltcMag&&(za.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE);pa.upload(Fa,gb.uniformsList,za,Ga)}Wa.set(Fa,bb,"modelViewMatrix");Wa.set(Fa,bb,"normalMatrix");Wa.setValue(Fa,"modelMatrix",bb.matrixWorld);return qb}function na(fa,ta){fa.specular.value=ta.specular;fa.shininess.value=Math.max(ta.shininess,1E-4);ta.emissiveMap&&
(fa.emissiveMap.value=ta.emissiveMap);ta.bumpMap&&(fa.bumpMap.value=ta.bumpMap,fa.bumpScale.value=ta.bumpScale);ta.normalMap&&(fa.normalMap.value=ta.normalMap,fa.normalScale.value.copy(ta.normalScale));ta.displacementMap&&(fa.displacementMap.value=ta.displacementMap,fa.displacementScale.value=ta.displacementScale,fa.displacementBias.value=ta.displacementBias)}function qa(fa,ta){fa.roughness.value=ta.roughness;fa.metalness.value=ta.metalness;ta.roughnessMap&&(fa.roughnessMap.value=ta.roughnessMap);
ta.metalnessMap&&(fa.metalnessMap.value=ta.metalnessMap);ta.emissiveMap&&(fa.emissiveMap.value=ta.emissiveMap);ta.bumpMap&&(fa.bumpMap.value=ta.bumpMap,fa.bumpScale.value=ta.bumpScale);ta.normalMap&&(fa.normalMap.value=ta.normalMap,fa.normalScale.value.copy(ta.normalScale));ta.displacementMap&&(fa.displacementMap.value=ta.displacementMap,fa.displacementScale.value=ta.displacementScale,fa.displacementBias.value=ta.displacementBias);ta.envMap&&(fa.envMapIntensity.value=ta.envMapIntensity)}function sa(fa){if(1E3===
fa)return Fa.REPEAT;if(1001===fa)return Fa.CLAMP_TO_EDGE;if(1002===fa)return Fa.MIRRORED_REPEAT;if(1003===fa)return Fa.NEAREST;if(1004===fa)return Fa.NEAREST_MIPMAP_NEAREST;if(1005===fa)return Fa.NEAREST_MIPMAP_LINEAR;if(1006===fa)return Fa.LINEAR;if(1007===fa)return Fa.LINEAR_MIPMAP_NEAREST;if(1008===fa)return Fa.LINEAR_MIPMAP_LINEAR;if(1009===fa)return Fa.UNSIGNED_BYTE;if(1017===fa)return Fa.UNSIGNED_SHORT_4_4_4_4;if(1018===fa)return Fa.UNSIGNED_SHORT_5_5_5_1;if(1019===fa)return Fa.UNSIGNED_SHORT_5_6_5;
if(1010===fa)return Fa.BYTE;if(1011===fa)return Fa.SHORT;if(1012===fa)return Fa.UNSIGNED_SHORT;if(1013===fa)return Fa.INT;if(1014===fa)return Fa.UNSIGNED_INT;if(1015===fa)return Fa.FLOAT;if(1016===fa){var ta=Tb.get("OES_texture_half_float");if(null!==ta)return ta.HALF_FLOAT_OES}if(1021===fa)return Fa.ALPHA;if(1022===fa)return Fa.RGB;if(1023===fa)return Fa.RGBA;if(1024===fa)return Fa.LUMINANCE;if(1025===fa)return Fa.LUMINANCE_ALPHA;if(1026===fa)return Fa.DEPTH_COMPONENT;if(1027===fa)return Fa.DEPTH_STENCIL;
if(100===fa)return Fa.FUNC_ADD;if(101===fa)return Fa.FUNC_SUBTRACT;if(102===fa)return Fa.FUNC_REVERSE_SUBTRACT;if(200===fa)return Fa.ZERO;if(201===fa)return Fa.ONE;if(202===fa)return Fa.SRC_COLOR;if(203===fa)return Fa.ONE_MINUS_SRC_COLOR;if(204===fa)return Fa.SRC_ALPHA;if(205===fa)return Fa.ONE_MINUS_SRC_ALPHA;if(206===fa)return Fa.DST_ALPHA;if(207===fa)return Fa.ONE_MINUS_DST_ALPHA;if(208===fa)return Fa.DST_COLOR;if(209===fa)return Fa.ONE_MINUS_DST_COLOR;if(210===fa)return Fa.SRC_ALPHA_SATURATE;
if(2001===fa||2002===fa||2003===fa||2004===fa)if(ta=Tb.get("WEBGL_compressed_texture_s3tc"),null!==ta){if(2001===fa)return ta.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===fa)return ta.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===fa)return ta.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===fa)return ta.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(2100===fa||2101===fa||2102===fa||2103===fa)if(ta=Tb.get("WEBGL_compressed_texture_pvrtc"),null!==ta){if(2100===fa)return ta.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===fa)return ta.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;
if(2102===fa)return ta.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===fa)return ta.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===fa&&(ta=Tb.get("WEBGL_compressed_texture_etc1"),null!==ta))return ta.COMPRESSED_RGB_ETC1_WEBGL;if(103===fa||104===fa)if(ta=Tb.get("EXT_blend_minmax"),null!==ta){if(103===fa)return ta.MIN_EXT;if(104===fa)return ta.MAX_EXT}return 1020===fa&&(ta=Tb.get("WEBGL_depth_texture"),null!==ta)?ta.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","85dev");a=a||{};var ba=void 0!==
a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),oa=void 0!==a.context?a.context:null,la=void 0!==a.alpha?a.alpha:!1,wa=void 0!==a.depth?a.depth:!0,ya=void 0!==a.stencil?a.stencil:!0,Ca=void 0!==a.antialias?a.antialias:!1,Ja=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,Pa=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,Na=[],Ta=[],Qa=-1,Xa=[],hb=-1,Ua=new Float32Array(8),Ma=[],Sa=[];this.domElement=ba;this.context=null;this.sortObjects=this.autoClearStencil=
this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var Ga=this,db=null,Ya=null,Cb=null,Jb=-1,Kb="",pb=null,Ba=new p,mb=null,nb=new p,tb=0,eb=new ka(0),yb=0,Eb=ba.width,Ib=ba.height,Ub=1,Xb=new p(0,0,Eb,Ib),Sc=!1,vc=new p(0,0,Eb,Ib),xg=new bd,
Ec=new Vg,gf=!1,Sf=!1,Hd=new Nb,ff=new y,jc=new r,Tf=new y,hf=new y,Db={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},md={calls:0,vertices:0,faces:0,points:0};this.info={render:md,memory:{geometries:0,textures:0},programs:null};try{la={alpha:la,depth:wa,stencil:ya,antialias:Ca,premultipliedAlpha:Ja,preserveDrawingBuffer:Pa};var Fa=
oa||ba.getContext("webgl",la)||ba.getContext("experimental-webgl",la);if(null===Fa){if(null!==ba.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===Fa.getShaderPrecisionFormat&&(Fa.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});ba.addEventListener("webglcontextlost",g,!1)}catch(fa){console.error("THREE.WebGLRenderer: "+fa)}var Tb=new Ug(Fa);Tb.get("WEBGL_depth_texture");Tb.get("OES_texture_float");
Tb.get("OES_texture_float_linear");Tb.get("OES_texture_half_float");Tb.get("OES_texture_half_float_linear");Tb.get("OES_standard_derivatives");Tb.get("ANGLE_instanced_arrays");Tb.get("OES_element_index_uint")&&(ob.MaxIndex=4294967296);var Tc=new Tg(Fa,Tb,a),wb=new ef(Fa,Tb,sa),wc=new kd,Id=new Dc(Fa,Tb,wb,wc,Tc,sa,this.info),ld=new mc(Fa,wc,this.info),ve=new dc(this,Tc),we=new cb;this.info.programs=ve.programs;var Wg=new Va(Fa,Tb,md),Xg=new La(Fa,Tb,md),Uf,Jd,gd,hd;c();this.context=Fa;this.capabilities=
Tc;this.extensions=Tb;this.properties=wc;this.state=wb;var yg=new cd(this,Db,ld,Tc);this.shadowMap=yg;var Yg=new Ia(this,Ma),Zg=new xa(this,Sa);this.getContext=function(){return Fa};this.getContextAttributes=function(){return Fa.getContextAttributes()};this.forceContextLoss=function(){Tb.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return Tc.getMaxAnisotropy()};this.getPrecision=function(){return Tc.precision};this.getPixelRatio=function(){return Ub};this.setPixelRatio=
function(fa){void 0!==fa&&(Ub=fa,this.setSize(vc.z,vc.w,!1))};this.getSize=function(){return{width:Eb,height:Ib}};this.setSize=function(fa,ta,ra){Eb=fa;Ib=ta;ba.width=fa*Ub;ba.height=ta*Ub;!1!==ra&&(ba.style.width=fa+"px",ba.style.height=ta+"px");this.setViewport(0,0,fa,ta)};this.setViewport=function(fa,ta,ra,bb){wb.viewport(vc.set(fa,ta,ra,bb))};this.setScissor=function(fa,ta,ra,bb){wb.scissor(Xb.set(fa,ta,ra,bb))};this.setScissorTest=function(fa){wb.setScissorTest(Sc=fa)};this.getClearColor=function(){return eb};
this.setClearColor=function(fa,ta){eb.set(fa);yb=void 0!==ta?ta:1;wb.buffers.color.setClear(eb.r,eb.g,eb.b,yb,Ja)};this.getClearAlpha=function(){return yb};this.setClearAlpha=function(fa){yb=fa;wb.buffers.color.setClear(eb.r,eb.g,eb.b,yb,Ja)};this.clear=function(fa,ta,ra){var bb=0;if(void 0===fa||fa)bb|=Fa.COLOR_BUFFER_BIT;if(void 0===ta||ta)bb|=Fa.DEPTH_BUFFER_BIT;if(void 0===ra||ra)bb|=Fa.STENCIL_BUFFER_BIT;Fa.clear(bb)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,
!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(fa,ta,ra,bb){this.setRenderTarget(fa);this.clear(ta,ra,bb)};this.resetGLState=d;this.dispose=function(){Xa=[];hb=-1;Ta=[];Qa=-1;ba.removeEventListener("webglcontextlost",g,!1)};this.renderBufferImmediate=function(fa,ta,ra){wb.initAttributes();var bb=wc.get(fa);fa.hasPositions&&!bb.position&&(bb.position=Fa.createBuffer());fa.hasNormals&&!bb.normal&&(bb.normal=Fa.createBuffer());fa.hasUvs&&!bb.uv&&(bb.uv=Fa.createBuffer());
fa.hasColors&&!bb.color&&(bb.color=Fa.createBuffer());ta=ta.getAttributes();fa.hasPositions&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,bb.position),Fa.bufferData(Fa.ARRAY_BUFFER,fa.positionArray,Fa.DYNAMIC_DRAW),wb.enableAttribute(ta.position),Fa.vertexAttribPointer(ta.position,3,Fa.FLOAT,!1,0,0));if(fa.hasNormals){Fa.bindBuffer(Fa.ARRAY_BUFFER,bb.normal);if(!ra.isMeshPhongMaterial&&!ra.isMeshStandardMaterial&&!ra.isMeshNormalMaterial&&1===ra.shading)for(var gb=0,qb=3*fa.count;gb<qb;gb+=9){var Wa=fa.normalArray,
za=(Wa[gb+0]+Wa[gb+3]+Wa[gb+6])/3,ub=(Wa[gb+1]+Wa[gb+4]+Wa[gb+7])/3,Lb=(Wa[gb+2]+Wa[gb+5]+Wa[gb+8])/3;Wa[gb+0]=za;Wa[gb+1]=ub;Wa[gb+2]=Lb;Wa[gb+3]=za;Wa[gb+4]=ub;Wa[gb+5]=Lb;Wa[gb+6]=za;Wa[gb+7]=ub;Wa[gb+8]=Lb}Fa.bufferData(Fa.ARRAY_BUFFER,fa.normalArray,Fa.DYNAMIC_DRAW);wb.enableAttribute(ta.normal);Fa.vertexAttribPointer(ta.normal,3,Fa.FLOAT,!1,0,0)}fa.hasUvs&&ra.map&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,bb.uv),Fa.bufferData(Fa.ARRAY_BUFFER,fa.uvArray,Fa.DYNAMIC_DRAW),wb.enableAttribute(ta.uv),Fa.vertexAttribPointer(ta.uv,
2,Fa.FLOAT,!1,0,0));fa.hasColors&&0!==ra.vertexColors&&(Fa.bindBuffer(Fa.ARRAY_BUFFER,bb.color),Fa.bufferData(Fa.ARRAY_BUFFER,fa.colorArray,Fa.DYNAMIC_DRAW),wb.enableAttribute(ta.color),Fa.vertexAttribPointer(ta.color,3,Fa.FLOAT,!1,0,0));wb.disableUnusedAttributes();Fa.drawArrays(Fa.TRIANGLES,0,fa.count);fa.count=0};this.renderBufferDirect=function(fa,ta,ra,bb,gb,qb){Z(bb);var Wa=da(fa,ta,bb,gb),za=!1;fa=ra.id+"_"+Wa.id+"_"+bb.wireframe;fa!==Kb&&(Kb=fa,za=!0);ta=gb.morphTargetInfluences;if(void 0!==
ta){var ub=[];fa=0;for(var Lb=ta.length;fa<Lb;fa++)za=ta[fa],ub.push([za,fa]);ub.sort(A);8<ub.length&&(ub.length=8);var Yb=ra.morphAttributes;fa=0;for(Lb=ub.length;fa<Lb;fa++)za=ub[fa],Ua[fa]=za[0],0!==za[0]?(ta=za[1],!0===bb.morphTargets&&Yb.position&&ra.addAttribute("morphTarget"+fa,Yb.position[ta]),!0===bb.morphNormals&&Yb.normal&&ra.addAttribute("morphNormal"+fa,Yb.normal[ta])):(!0===bb.morphTargets&&ra.removeAttribute("morphTarget"+fa),!0===bb.morphNormals&&ra.removeAttribute("morphNormal"+fa));
fa=ub.length;for(ta=Ua.length;fa<ta;fa++)Ua[fa]=0;Wa.getUniforms().setValue(Fa,"morphTargetInfluences",Ua);za=!0}ta=ra.index;Lb=ra.attributes.position;ub=1;!0===bb.wireframe&&(ta=ld.getWireframeAttribute(ra),ub=2);null!==ta?(fa=Xg,fa.setIndex(ta)):fa=Wg;if(za){a:{za=void 0;if(ra&&ra.isInstancedBufferGeometry){var Gb=Tb.get("ANGLE_instanced_arrays");if(null===Gb){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
break a}}void 0===za&&(za=0);wb.initAttributes();Yb=ra.attributes;Wa=Wa.getAttributes();var id=bb.defaultAttributeValues;for(nd in Wa){var ec=Wa[nd];if(0<=ec){var fc=Yb[nd];if(void 0!==fc){var xc=fc.normalized,od=fc.itemSize,yc=ld.getAttributeProperties(fc),Uc=yc.__webglBuffer,jf=yc.type;yc=yc.bytesPerElement;if(fc.isInterleavedBufferAttribute){var Vc=fc.data,rb=Vc.stride;fc=fc.offset;Vc&&Vc.isInstancedInterleavedBuffer?(wb.enableAttributeAndDivisor(ec,Vc.meshPerAttribute,Gb),void 0===ra.maxInstancedCount&&
(ra.maxInstancedCount=Vc.meshPerAttribute*Vc.count)):wb.enableAttribute(ec);Fa.bindBuffer(Fa.ARRAY_BUFFER,Uc);Fa.vertexAttribPointer(ec,od,jf,xc,rb*yc,(za*rb+fc)*yc)}else fc.isInstancedBufferAttribute?(wb.enableAttributeAndDivisor(ec,fc.meshPerAttribute,Gb),void 0===ra.maxInstancedCount&&(ra.maxInstancedCount=fc.meshPerAttribute*fc.count)):wb.enableAttribute(ec),Fa.bindBuffer(Fa.ARRAY_BUFFER,Uc),Fa.vertexAttribPointer(ec,od,jf,xc,0,za*od*yc)}else if(void 0!==id&&(xc=id[nd],void 0!==xc))switch(xc.length){case 2:Fa.vertexAttrib2fv(ec,
xc);break;case 3:Fa.vertexAttrib3fv(ec,xc);break;case 4:Fa.vertexAttrib4fv(ec,xc);break;default:Fa.vertexAttrib1fv(ec,xc)}}}wb.disableUnusedAttributes()}null!==ta&&Fa.bindBuffer(Fa.ELEMENT_ARRAY_BUFFER,ld.getAttributeBuffer(ta))}Gb=0;null!==ta?Gb=ta.count:void 0!==Lb&&(Gb=Lb.count);ta=ra.drawRange.start*ub;Lb=null!==qb?qb.start*ub:0;var nd=Math.max(ta,Lb);qb=Math.max(0,Math.min(Gb,ta+ra.drawRange.count*ub,Lb+(null!==qb?qb.count*ub:Infinity))-1-nd+1);if(0!==qb){if(gb.isMesh)if(!0===bb.wireframe)wb.setLineWidth(bb.wireframeLinewidth*
(null===Ya?Ub:1)),fa.setMode(Fa.LINES);else switch(gb.drawMode){case 0:fa.setMode(Fa.TRIANGLES);break;case 1:fa.setMode(Fa.TRIANGLE_STRIP);break;case 2:fa.setMode(Fa.TRIANGLE_FAN)}else gb.isLine?(bb=bb.linewidth,void 0===bb&&(bb=1),wb.setLineWidth(bb*(null===Ya?Ub:1)),gb.isLineSegments?fa.setMode(Fa.LINES):gb.isLineLoop?fa.setMode(Fa.LINE_LOOP):fa.setMode(Fa.LINE_STRIP)):gb.isPoints&&fa.setMode(Fa.POINTS);ra&&ra.isInstancedBufferGeometry?0<ra.maxInstancedCount&&fa.renderInstances(ra,nd,qb):fa.render(nd,
qb)}};this.render=function(fa,ta,ra,bb){if(void 0!==ta&&!0!==ta.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{Kb="";Jb=-1;pb=null;!0===fa.autoUpdate&&fa.updateMatrixWorld();null===ta.parent&&ta.updateMatrixWorld();ta.matrixWorldInverse.getInverse(ta.matrixWorld);ff.multiplyMatrices(ta.projectionMatrix,ta.matrixWorldInverse);xg.setFromMatrix(ff);Na.length=0;hb=Qa=-1;Ma.length=0;Sa.length=0;Sf=this.localClippingEnabled;gf=Ec.init(this.clippingPlanes,
Sf,ta);O(fa,ta);Ta.length=Qa+1;Xa.length=hb+1;!0===Ga.sortObjects&&(Ta.sort(H),Xa.sort(K));gf&&Ec.beginShadows();for(var gb=Na,qb=0,Wa=0,za=gb.length;Wa<za;Wa++){var ub=gb[Wa];ub.castShadow&&(Db.shadows[qb++]=ub)}Db.shadows.length=qb;yg.render(fa,ta);gb=Na;var Lb=ub=0,Yb=0,Gb=ta.matrixWorldInverse,id=0,ec=0,fc=0,xc=0,od=0;qb=0;for(Wa=gb.length;qb<Wa;qb++){za=gb[qb];var yc=za.color;var Uc=za.intensity;var jf=za.distance;var Vc=za.shadow&&za.shadow.map?za.shadow.map.texture:null;if(za.isAmbientLight)ub+=
yc.r*Uc,Lb+=yc.g*Uc,Yb+=yc.b*Uc;else if(za.isDirectionalLight){var rb=we.get(za);rb.color.copy(za.color).multiplyScalar(za.intensity);rb.direction.setFromMatrixPosition(za.matrixWorld);jc.setFromMatrixPosition(za.target.matrixWorld);rb.direction.sub(jc);rb.direction.transformDirection(Gb);if(rb.shadow=za.castShadow)rb.shadowBias=za.shadow.bias,rb.shadowRadius=za.shadow.radius,rb.shadowMapSize=za.shadow.mapSize;Db.directionalShadowMap[id]=Vc;Db.directionalShadowMatrix[id]=za.shadow.matrix;Db.directional[id++]=
rb}else if(za.isSpotLight){rb=we.get(za);rb.position.setFromMatrixPosition(za.matrixWorld);rb.position.applyMatrix4(Gb);rb.color.copy(yc).multiplyScalar(Uc);rb.distance=jf;rb.direction.setFromMatrixPosition(za.matrixWorld);jc.setFromMatrixPosition(za.target.matrixWorld);rb.direction.sub(jc);rb.direction.transformDirection(Gb);rb.coneCos=Math.cos(za.angle);rb.penumbraCos=Math.cos(za.angle*(1-za.penumbra));rb.decay=0===za.distance?0:za.decay;if(rb.shadow=za.castShadow)rb.shadowBias=za.shadow.bias,rb.shadowRadius=
za.shadow.radius,rb.shadowMapSize=za.shadow.mapSize;Db.spotShadowMap[fc]=Vc;Db.spotShadowMatrix[fc]=za.shadow.matrix;Db.spot[fc++]=rb}else if(za.isRectAreaLight)rb=we.get(za),rb.color.copy(yc).multiplyScalar(Uc/(za.width*za.height)),rb.position.setFromMatrixPosition(za.matrixWorld),rb.position.applyMatrix4(Gb),hf.identity(),Tf.copy(za.matrixWorld),Tf.premultiply(Gb),hf.extractRotation(Tf),rb.halfWidth.set(.5*za.width,0,0),rb.halfHeight.set(0,.5*za.height,0),rb.halfWidth.applyMatrix4(hf),rb.halfHeight.applyMatrix4(hf),
Db.rectArea[xc++]=rb;else if(za.isPointLight){rb=we.get(za);rb.position.setFromMatrixPosition(za.matrixWorld);rb.position.applyMatrix4(Gb);rb.color.copy(za.color).multiplyScalar(za.intensity);rb.distance=za.distance;rb.decay=0===za.distance?0:za.decay;if(rb.shadow=za.castShadow)rb.shadowBias=za.shadow.bias,rb.shadowRadius=za.shadow.radius,rb.shadowMapSize=za.shadow.mapSize;Db.pointShadowMap[ec]=Vc;void 0===Db.pointShadowMatrix[ec]&&(Db.pointShadowMatrix[ec]=new y);jc.setFromMatrixPosition(za.matrixWorld).negate();
Db.pointShadowMatrix[ec].identity().setPosition(jc);Db.point[ec++]=rb}else za.isHemisphereLight&&(rb=we.get(za),rb.direction.setFromMatrixPosition(za.matrixWorld),rb.direction.transformDirection(Gb),rb.direction.normalize(),rb.skyColor.copy(za.color).multiplyScalar(Uc),rb.groundColor.copy(za.groundColor).multiplyScalar(Uc),Db.hemi[od++]=rb)}Db.ambient[0]=ub;Db.ambient[1]=Lb;Db.ambient[2]=Yb;Db.directional.length=id;Db.spot.length=fc;Db.rectArea.length=xc;Db.point.length=ec;Db.hemi.length=od;Db.hash=
id+","+ec+","+fc+","+xc+","+od+","+Db.shadows.length;gf&&Ec.endShadows();md.calls=0;md.vertices=0;md.faces=0;md.points=0;void 0===ra&&(ra=null);this.setRenderTarget(ra);gb=fa.background;null===gb?wb.buffers.color.setClear(eb.r,eb.g,eb.b,yb,Ja):gb&&gb.isColor&&(wb.buffers.color.setClear(gb.r,gb.g,gb.b,1,Ja),bb=!0);(this.autoClear||bb)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);gb&&gb.isCubeTexture?(void 0===gd&&(gd=new Oa,hd=new Zb(new pc(5,5,5),new kb({uniforms:dd.cube.uniforms,
vertexShader:dd.cube.vertexShader,fragmentShader:dd.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))),gd.projectionMatrix.copy(ta.projectionMatrix),gd.matrixWorld.extractRotation(ta.matrixWorld),gd.matrixWorldInverse.getInverse(gd.matrixWorld),hd.material.uniforms.tCube.value=gb,hd.modelViewMatrix.multiplyMatrices(gd.matrixWorldInverse,hd.matrixWorld),ld.update(hd),Ga.renderBufferDirect(gd,null,hd.geometry,hd.material,hd,null)):gb&&gb.isTexture&&(void 0===Uf&&(Uf=new Ha(-1,1,1,-1,0,
1),Jd=new Zb(new Da(2,2),new hc({depthTest:!1,depthWrite:!1,fog:!1}))),Jd.material.map=gb,ld.update(Jd),Ga.renderBufferDirect(Uf,null,Jd.geometry,Jd.material,Jd,null));fa.overrideMaterial?(bb=fa.overrideMaterial,P(Ta,fa,ta,bb),P(Xa,fa,ta,bb)):(wb.setBlending(0),P(Ta,fa,ta),P(Xa,fa,ta));Yg.render(fa,ta);Zg.render(fa,ta,nb);ra&&Id.updateRenderTargetMipmap(ra);wb.setDepthTest(!0);wb.setDepthWrite(!0);wb.setColorWrite(!0)}};this.setFaceCulling=function(fa,ta){wb.setCullFace(fa);wb.setFlipSided(0===ta)};
this.allocTextureUnit=function(){var fa=tb;fa>=Tc.maxTextures&&console.warn("WebGLRenderer: trying to use "+fa+" texture units while this GPU supports only "+Tc.maxTextures);tb+=1;return fa};this.setTexture2D=function(){var fa=!1;return function(ta,ra){ta&&ta.isWebGLRenderTarget&&(fa||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),fa=!0),ta=ta.texture);Id.setTexture2D(ta,ra)}}();this.setTexture=function(){var fa=!1;return function(ta,
ra){fa||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),fa=!0);Id.setTexture2D(ta,ra)}}();this.setTextureCube=function(){var fa=!1;return function(ta,ra){ta&&ta.isWebGLRenderTargetCube&&(fa||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),fa=!0),ta=ta.texture);ta&&ta.isCubeTexture||Array.isArray(ta.image)&&6===ta.image.length?Id.setTextureCube(ta,ra):Id.setTextureCubeDynamic(ta,
ra)}}();this.getCurrentRenderTarget=function(){return Ya};this.setRenderTarget=function(fa){(Ya=fa)&&void 0===wc.get(fa).__webglFramebuffer&&Id.setupRenderTarget(fa);var ta=fa&&fa.isWebGLRenderTargetCube;if(fa){var ra=wc.get(fa);ra=ta?ra.__webglFramebuffer[fa.activeCubeFace]:ra.__webglFramebuffer;Ba.copy(fa.scissor);mb=fa.scissorTest;nb.copy(fa.viewport)}else ra=null,Ba.copy(Xb).multiplyScalar(Ub),mb=Sc,nb.copy(vc).multiplyScalar(Ub);Cb!==ra&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,ra),Cb=ra);wb.scissor(Ba);
wb.setScissorTest(mb);wb.viewport(nb);ta&&(ta=wc.get(fa.texture),Fa.framebufferTexture2D(Fa.FRAMEBUFFER,Fa.COLOR_ATTACHMENT0,Fa.TEXTURE_CUBE_MAP_POSITIVE_X+fa.activeCubeFace,ta.__webglTexture,fa.activeMipMapLevel))};this.readRenderTargetPixels=function(fa,ta,ra,bb,gb,qb){if(!1===(fa&&fa.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var Wa=wc.get(fa).__webglFramebuffer;if(Wa){var za=!1;Wa!==Cb&&(Fa.bindFramebuffer(Fa.FRAMEBUFFER,
Wa),za=!0);try{var ub=fa.texture,Lb=ub.format,Yb=ub.type;1023!==Lb&&sa(Lb)!==Fa.getParameter(Fa.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===Yb||sa(Yb)===Fa.getParameter(Fa.IMPLEMENTATION_COLOR_READ_TYPE)||1015===Yb&&(Tb.get("OES_texture_float")||Tb.get("WEBGL_color_buffer_float"))||1016===Yb&&Tb.get("EXT_color_buffer_half_float")?Fa.checkFramebufferStatus(Fa.FRAMEBUFFER)===Fa.FRAMEBUFFER_COMPLETE?
0<=ta&&ta<=fa.width-bb&&0<=ra&&ra<=fa.height-gb&&Fa.readPixels(ta,ra,bb,gb,sa(Lb),sa(Yb),qb):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{za&&Fa.bindFramebuffer(Fa.FRAMEBUFFER,Cb)}}}}}function Kd(a,c){this.name="";this.color=new ka(a);this.density=void 0!==c?c:2.5E-4}function Ld(a,
c,d){this.name="";this.color=new ka(a);this.near=void 0!==c?c:1;this.far=void 0!==d?d:1E3}function kf(){lb.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function Vf(a,c,d,g,u){lb.call(this);this.lensFlares=[];this.positionScreen=new r;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,c,d,g,u)}function pd(a){Za.call(this);this.type="SpriteMaterial";this.color=new ka(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)}
function xe(a){lb.call(this);this.type="Sprite";this.material=void 0!==a?a:new pd}function ye(){lb.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function lf(a,c,d){this.useVertexTexture=void 0!==d?d:!0;this.identityMatrix=new y;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=xb.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*
this.boneTextureHeight*4),this.boneTexture=new va(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===c)this.calculateInverses();else if(this.bones.length===c.length)this.boneInverses=c.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],c=0,a=this.bones.length;c<a;c++)this.boneInverses.push(new y)}function mf(){lb.call(this);this.type="Bone"}function nf(a,
c,d){Zb.call(this,a,c);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new y;this.bindMatrixInverse=new y;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var g,u=0,x=this.geometry.bones.length;u<x;++u)g=this.geometry.bones[u],c=new mf,a.push(c),c.name=g.name,c.position.fromArray(g.pos),c.quaternion.fromArray(g.rotq),void 0!==g.scl&&c.scale.fromArray(g.scl);u=0;for(x=this.geometry.bones.length;u<x;++u)g=this.geometry.bones[u],-1!==g.parent&&null!==g.parent&&void 0!==a[g.parent]?
a[g.parent].add(a[u]):this.add(a[u])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new lf(a,void 0,d),this.matrixWorld)}function $b(a){Za.call(this);this.type="LineBasicMaterial";this.color=new ka(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)}function Ic(a,c,d){if(1===d)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Vb(a,c);lb.call(this);this.type="Line";
this.geometry=void 0!==a?a:new ob;this.material=void 0!==c?c:new $b({color:16777215*Math.random()})}function Vb(a,c){Ic.call(this,a,c);this.type="LineSegments"}function of(a,c){Ic.call(this,a,c);this.type="LineLoop"}function Jc(a){Za.call(this);this.type="PointsMaterial";this.color=new ka(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)}function Md(a,c){lb.call(this);this.type="Points";this.geometry=void 0!==a?a:new ob;this.material=void 0!==c?c:new Jc({color:16777215*
Math.random()})}function ze(){lb.call(this);this.type="Group"}function pf(a,c,d,g,u,x,A,H,K){function M(){requestAnimationFrame(M);a.readyState>=a.HAVE_CURRENT_DATA&&(R.needsUpdate=!0)}e.call(this,a,c,d,g,u,x,A,H,K);this.generateMipmaps=!1;var R=this;M()}function Nd(a,c,d,g,u,x,A,H,K,M,R,O){e.call(this,null,x,A,H,K,M,g,u,R,O);this.image={width:c,height:d};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function qf(a,c,d,g,u,x,A,H,K){e.call(this,a,c,d,g,u,x,A,H,K);this.needsUpdate=!0}function Ae(a,
c,d,g,u,x,A,H,K,M){M=void 0!==M?M:1026;if(1026!==M&&1027!==M)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===d&&1026===M&&(d=1012);void 0===d&&1027===M&&(d=1020);e.call(this,null,g,u,x,A,H,M,d,K);this.image={width:a,height:c};this.magFilter=void 0!==A?A:1003;this.minFilter=void 0!==H?H:1003;this.generateMipmaps=this.flipY=!1}function Od(a){function c(da,na){return da-na}ob.call(this);this.type="WireframeGeometry";var d=[],g,u,x,A=[0,0],H={},
K=["a","b","c"];if(a&&a.isGeometry){var M=a.faces;var R=0;for(u=M.length;R<u;R++){var O=M[R];for(g=0;3>g;g++){A[0]=O[K[g]];A[1]=O[K[(g+1)%3]];A.sort(c);var P=A.toString();void 0===H[P]&&(H[P]={index1:A[0],index2:A[1]})}}for(P in H)R=H[P],K=a.vertices[R.index1],d.push(K.x,K.y,K.z),K=a.vertices[R.index2],d.push(K.x,K.y,K.z)}else if(a&&a.isBufferGeometry)if(K=new r,null!==a.index){M=a.attributes.position;O=a.index;var Z=a.groups;0===Z.length&&(Z=[{start:0,count:O.count,materialIndex:0}]);a=0;for(x=Z.length;a<
x;++a)for(R=Z[a],g=R.start,u=R.count,R=g,u=g+u;R<u;R+=3)for(g=0;3>g;g++)A[0]=O.getX(R+g),A[1]=O.getX(R+(g+1)%3),A.sort(c),P=A.toString(),void 0===H[P]&&(H[P]={index1:A[0],index2:A[1]});for(P in H)R=H[P],K.fromBufferAttribute(M,R.index1),d.push(K.x,K.y,K.z),K.fromBufferAttribute(M,R.index2),d.push(K.x,K.y,K.z)}else for(M=a.attributes.position,R=0,u=M.count/3;R<u;R++)for(g=0;3>g;g++)H=3*R+g,K.fromBufferAttribute(M,H),d.push(K.x,K.y,K.z),H=3*R+(g+1)%3,K.fromBufferAttribute(M,H),d.push(K.x,K.y,K.z);this.addAttribute("position",
new ib(d,3))}function Be(a,c,d){sb.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:c,stacks:d};this.fromBufferGeometry(new Pd(a,c,d));this.mergeVertices()}function Pd(a,c,d){ob.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:c,stacks:d};var g=[],u=[],x=[],A,H,K=c+1;for(A=0;A<=d;A++){var M=A/d;for(H=0;H<=c;H++){var R=H/c,O=a(R,M);u.push(O.x,O.y,O.z);x.push(R,M)}}for(A=0;A<d;A++)for(H=0;H<c;H++)a=A*K+H+1,M=(A+1)*K+H+1,R=(A+1)*K+H,g.push(A*K+H,
a,R),g.push(a,M,R);this.setIndex(g);this.addAttribute("position",new ib(u,3));this.addAttribute("uv",new ib(x,2));this.computeVertexNormals()}function Ce(a,c,d,g){sb.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:c,radius:d,detail:g};this.fromBufferGeometry(new qc(a,c,d,g));this.mergeVertices()}function qc(a,c,d,g){function u(M){H.push(M.x,M.y,M.z)}function x(M,R){M*=3;R.x=a[M+0];R.y=a[M+1];R.z=a[M+2]}function A(M,R,O,P){0>P&&1===M.x&&(K[R]=M.x-1);0===O.x&&0===O.z&&
(K[R]=P/2/Math.PI+.5)}ob.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:a,indices:c,radius:d,detail:g};d=d||1;var H=[],K=[];(function(M){for(var R=new r,O=new r,P=new r,Z=0;Z<c.length;Z+=3){x(c[Z+0],R);x(c[Z+1],O);x(c[Z+2],P);var da,na,qa=R,sa=O,ba=P,oa=Math.pow(2,M),la=[];for(na=0;na<=oa;na++){la[na]=[];var wa=qa.clone().lerp(ba,na/oa),ya=sa.clone().lerp(ba,na/oa),Ca=oa-na;for(da=0;da<=Ca;da++)la[na][da]=0===da&&na===oa?wa:wa.clone().lerp(ya,da/Ca)}for(na=0;na<oa;na++)for(da=
0;da<2*(oa-na)-1;da++)qa=Math.floor(da/2),0===da%2?(u(la[na][qa+1]),u(la[na+1][qa]),u(la[na][qa])):(u(la[na][qa+1]),u(la[na+1][qa+1]),u(la[na+1][qa]))}})(g||0);(function(M){for(var R=new r,O=0;O<H.length;O+=3)R.x=H[O+0],R.y=H[O+1],R.z=H[O+2],R.normalize().multiplyScalar(M),H[O+0]=R.x,H[O+1]=R.y,H[O+2]=R.z})(d);(function(){for(var M=new r,R=0;R<H.length;R+=3)M.x=H[R+0],M.y=H[R+1],M.z=H[R+2],K.push(Math.atan2(M.z,-M.x)/2/Math.PI+.5,1-(Math.atan2(-M.y,Math.sqrt(M.x*M.x+M.z*M.z))/Math.PI+.5));M=new r;
R=new r;for(var O=new r,P=new r,Z=new k,da=new k,na=new k,qa=0,sa=0;qa<H.length;qa+=9,sa+=6){M.set(H[qa+0],H[qa+1],H[qa+2]);R.set(H[qa+3],H[qa+4],H[qa+5]);O.set(H[qa+6],H[qa+7],H[qa+8]);Z.set(K[sa+0],K[sa+1]);da.set(K[sa+2],K[sa+3]);na.set(K[sa+4],K[sa+5]);P.copy(M).add(R).add(O).divideScalar(3);var ba=Math.atan2(P.z,-P.x);A(Z,sa+0,M,ba);A(da,sa+2,R,ba);A(na,sa+4,O,ba)}for(M=0;M<K.length;M+=6)R=K[M+0],O=K[M+2],P=K[M+4],Z=Math.min(R,O,P),.9<Math.max(R,O,P)&&.1>Z&&(.2>R&&(K[M+0]+=1),.2>O&&(K[M+2]+=
1),.2>P&&(K[M+4]+=1))})();this.addAttribute("position",new ib(H,3));this.addAttribute("normal",new ib(H.slice(),3));this.addAttribute("uv",new ib(K,2));this.normalizeNormals()}function De(a,c){sb.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new Qd(a,c));this.mergeVertices()}function Qd(a,c){qc.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,c);this.type="TetrahedronBufferGeometry";this.parameters={radius:a,detail:c}}function Ee(a,
c){sb.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new qd(a,c));this.mergeVertices()}function qd(a,c){qc.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,c);this.type="OctahedronBufferGeometry";this.parameters={radius:a,detail:c}}function Fe(a,c){sb.call(this);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new Rd(a,c));this.mergeVertices()}function Rd(a,
c){var d=(1+Math.sqrt(5))/2;qc.call(this,[-1,d,0,1,d,0,-1,-d,0,1,-d,0,0,-1,d,0,1,d,0,-1,-d,0,1,-d,d,0,-1,d,0,1,-d,0,-1,-d,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,c);this.type="IcosahedronBufferGeometry";this.parameters={radius:a,detail:c}}function Ge(a,c){sb.call(this);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:c};this.fromBufferGeometry(new Sd(a,c));this.mergeVertices()}function Sd(a,
c){var d=(1+Math.sqrt(5))/2,g=1/d;qc.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-g,-d,0,-g,d,0,g,-d,0,g,d,-g,-d,0,-g,d,0,g,-d,0,g,d,0,-d,0,-g,d,0,-g,-d,0,g,d,0,g],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,c);this.type="DodecahedronBufferGeometry";
this.parameters={radius:a,detail:c}}function He(a,c,d,g,u,x){sb.call(this);this.type="TubeGeometry";this.parameters={path:a,tubularSegments:c,radius:d,radialSegments:g,closed:u};void 0!==x&&console.warn("THREE.TubeGeometry: taper has been removed.");a=new Td(a,c,d,g,u);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;this.fromBufferGeometry(a);this.mergeVertices()}function Td(a,c,d,g,u){function x(qa){var sa=a.getPointAt(qa/c),ba=A.normals[qa];qa=A.binormals[qa];for(O=0;O<=
g;O++){var oa=O/g*Math.PI*2,la=Math.sin(oa);oa=-Math.cos(oa);K.x=oa*ba.x+la*qa.x;K.y=oa*ba.y+la*qa.y;K.z=oa*ba.z+la*qa.z;K.normalize();Z.push(K.x,K.y,K.z);H.x=sa.x+d*K.x;H.y=sa.y+d*K.y;H.z=sa.z+d*K.z;P.push(H.x,H.y,H.z)}}ob.call(this);this.type="TubeBufferGeometry";this.parameters={path:a,tubularSegments:c,radius:d,radialSegments:g,closed:u};c=c||64;d=d||1;g=g||8;u=u||!1;var A=a.computeFrenetFrames(c,u);this.tangents=A.tangents;this.normals=A.normals;this.binormals=A.binormals;var H=new r,K=new r,
M=new k,R,O,P=[],Z=[],da=[],na=[];for(R=0;R<c;R++)x(R);x(!1===u?c:0);for(R=0;R<=c;R++)for(O=0;O<=g;O++)M.x=R/c,M.y=O/g,da.push(M.x,M.y);(function(){for(O=1;O<=c;O++)for(R=1;R<=g;R++){var qa=(g+1)*O+(R-1),sa=(g+1)*O+R,ba=(g+1)*(O-1)+R;na.push((g+1)*(O-1)+(R-1),qa,ba);na.push(qa,sa,ba)}})();this.setIndex(na);this.addAttribute("position",new ib(P,3));this.addAttribute("normal",new ib(Z,3));this.addAttribute("uv",new ib(da,2))}function Ie(a,c,d,g,u,x,A){sb.call(this);this.type="TorusKnotGeometry";this.parameters=
{radius:a,tube:c,tubularSegments:d,radialSegments:g,p:u,q:x};void 0!==A&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new Ud(a,c,d,g,u,x));this.mergeVertices()}function Ud(a,c,d,g,u,x){function A(ya,Ca,Ja,Pa,Na){var Ta=Math.sin(ya);Ca=Ja/Ca*ya;Ja=Math.cos(Ca);Na.x=Pa*(2+Ja)*.5*Math.cos(ya);Na.y=Pa*(2+Ja)*Ta*.5;Na.z=Pa*Math.sin(Ca)*.5}ob.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:c,
tubularSegments:d,radialSegments:g,p:u,q:x};a=a||100;c=c||40;d=Math.floor(d)||64;g=Math.floor(g)||8;u=u||2;x=x||3;var H=[],K=[],M=[],R=[],O,P=new r,Z=new r;new k;var da=new r,na=new r,qa=new r,sa=new r,ba=new r;for(O=0;O<=d;++O){var oa=O/d*u*Math.PI*2;A(oa,u,x,a,da);A(oa+.01,u,x,a,na);sa.subVectors(na,da);ba.addVectors(na,da);qa.crossVectors(sa,ba);ba.crossVectors(qa,sa);qa.normalize();ba.normalize();for(oa=0;oa<=g;++oa){var la=oa/g*Math.PI*2,wa=-c*Math.cos(la);la=c*Math.sin(la);P.x=da.x+(wa*ba.x+
la*qa.x);P.y=da.y+(wa*ba.y+la*qa.y);P.z=da.z+(wa*ba.z+la*qa.z);K.push(P.x,P.y,P.z);Z.subVectors(P,da).normalize();M.push(Z.x,Z.y,Z.z);R.push(O/d);R.push(oa/g)}}for(oa=1;oa<=d;oa++)for(O=1;O<=g;O++)a=(g+1)*oa+(O-1),c=(g+1)*oa+O,u=(g+1)*(oa-1)+O,H.push((g+1)*(oa-1)+(O-1),a,u),H.push(a,c,u);this.setIndex(H);this.addAttribute("position",new ib(K,3));this.addAttribute("normal",new ib(M,3));this.addAttribute("uv",new ib(R,2))}function Je(a,c,d,g,u){sb.call(this);this.type="TorusGeometry";this.parameters=
{radius:a,tube:c,radialSegments:d,tubularSegments:g,arc:u};this.fromBufferGeometry(new Vd(a,c,d,g,u))}function Vd(a,c,d,g,u){ob.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:c,radialSegments:d,tubularSegments:g,arc:u};a=a||100;c=c||40;d=Math.floor(d)||8;g=Math.floor(g)||6;u=u||2*Math.PI;var x=[],A=[],H=[],K=[],M=new r,R=new r,O=new r,P,Z;for(P=0;P<=d;P++)for(Z=0;Z<=g;Z++){var da=Z/g*u,na=P/d*Math.PI*2;R.x=(a+c*Math.cos(na))*Math.cos(da);R.y=(a+c*Math.cos(na))*Math.sin(da);
R.z=c*Math.sin(na);A.push(R.x,R.y,R.z);M.x=a*Math.cos(da);M.y=a*Math.sin(da);O.subVectors(R,M).normalize();H.push(O.x,O.y,O.z);K.push(Z/g);K.push(P/d)}for(P=1;P<=d;P++)for(Z=1;Z<=g;Z++)a=(g+1)*(P-1)+Z-1,c=(g+1)*(P-1)+Z,u=(g+1)*P+Z,x.push((g+1)*P+Z-1,a,u),x.push(a,c,u);this.setIndex(x);this.addAttribute("position",new ib(A,3));this.addAttribute("normal",new ib(H,3));this.addAttribute("uv",new ib(K,2))}function Fc(a,c){"undefined"!==typeof a&&(sb.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?
a:[a],this.addShapeList(a,c),this.computeFaceNormals())}function Ke(a,c){c=c||{};var d=c.font;if(!1===(d&&d.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new sb;a=d.generateShapes(a,c.size,c.curveSegments);c.amount=void 0!==c.height?c.height:50;void 0===c.bevelThickness&&(c.bevelThickness=10);void 0===c.bevelSize&&(c.bevelSize=8);void 0===c.bevelEnabled&&(c.bevelEnabled=!1);Fc.call(this,a,c);this.type="TextGeometry"}function Le(a,c,d,g,u,x,A){sb.call(this);
this.type="SphereGeometry";this.parameters={radius:a,widthSegments:c,heightSegments:d,phiStart:g,phiLength:u,thetaStart:x,thetaLength:A};this.fromBufferGeometry(new rd(a,c,d,g,u,x,A))}function rd(a,c,d,g,u,x,A){ob.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:c,heightSegments:d,phiStart:g,phiLength:u,thetaStart:x,thetaLength:A};a=a||50;c=Math.max(3,Math.floor(c)||8);d=Math.max(2,Math.floor(d)||6);g=void 0!==g?g:0;u=void 0!==u?u:2*Math.PI;x=void 0!==x?x:0;A=void 0!==
A?A:Math.PI;var H=x+A,K,M,R=0,O=[],P=new r,Z=new r,da=[],na=[],qa=[],sa=[];for(M=0;M<=d;M++){var ba=[],oa=M/d;for(K=0;K<=c;K++){var la=K/c;P.x=-a*Math.cos(g+la*u)*Math.sin(x+oa*A);P.y=a*Math.cos(x+oa*A);P.z=a*Math.sin(g+la*u)*Math.sin(x+oa*A);na.push(P.x,P.y,P.z);Z.set(P.x,P.y,P.z).normalize();qa.push(Z.x,Z.y,Z.z);sa.push(la,1-oa);ba.push(R++)}O.push(ba)}for(M=0;M<d;M++)for(K=0;K<c;K++)a=O[M][K+1],g=O[M][K],u=O[M+1][K],A=O[M+1][K+1],(0!==M||0<x)&&da.push(a,g,A),(M!==d-1||H<Math.PI)&&da.push(g,u,A);
this.setIndex(da);this.addAttribute("position",new ib(na,3));this.addAttribute("normal",new ib(qa,3));this.addAttribute("uv",new ib(sa,2))}function Me(a,c,d,g,u,x){sb.call(this);this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:c,thetaSegments:d,phiSegments:g,thetaStart:u,thetaLength:x};this.fromBufferGeometry(new Wd(a,c,d,g,u,x))}function Wd(a,c,d,g,u,x){ob.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:c,thetaSegments:d,phiSegments:g,thetaStart:u,
thetaLength:x};a=a||20;c=c||50;u=void 0!==u?u:0;x=void 0!==x?x:2*Math.PI;d=void 0!==d?Math.max(3,d):8;g=void 0!==g?Math.max(1,g):1;var A=[],H=[],K=[],M=[],R=a,O=(c-a)/g,P=new r,Z=new k,da,na;for(da=0;da<=g;da++){for(na=0;na<=d;na++)a=u+na/d*x,P.x=R*Math.cos(a),P.y=R*Math.sin(a),H.push(P.x,P.y,P.z),K.push(0,0,1),Z.x=(P.x/c+1)/2,Z.y=(P.y/c+1)/2,M.push(Z.x,Z.y);R+=O}for(da=0;da<g;da++)for(c=da*(d+1),na=0;na<d;na++)a=na+c,u=a+d+1,x=a+d+2,R=a+1,A.push(a,u,R),A.push(u,x,R);this.setIndex(A);this.addAttribute("position",
new ib(H,3));this.addAttribute("normal",new ib(K,3));this.addAttribute("uv",new ib(M,2))}function Ne(a,c,d,g){sb.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:c,phiStart:d,phiLength:g};this.fromBufferGeometry(new Xd(a,c,d,g));this.mergeVertices()}function Xd(a,c,d,g){ob.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:c,phiStart:d,phiLength:g};c=Math.floor(c)||12;d=d||0;g=g||2*Math.PI;g=xb.clamp(g,0,2*Math.PI);var u=[],x=[],A=[],H=1/c,K=new r,
M=new k,R;for(R=0;R<=c;R++){var O=d+R*H*g;var P=Math.sin(O),Z=Math.cos(O);for(O=0;O<=a.length-1;O++)K.x=a[O].x*P,K.y=a[O].y,K.z=a[O].x*Z,x.push(K.x,K.y,K.z),M.x=R/c,M.y=O/(a.length-1),A.push(M.x,M.y)}for(R=0;R<c;R++)for(O=0;O<a.length-1;O++)d=O+R*a.length,H=d+a.length,K=d+a.length+1,M=d+1,u.push(d,H,M),u.push(H,K,M);this.setIndex(u);this.addAttribute("position",new ib(x,3));this.addAttribute("uv",new ib(A,2));this.computeVertexNormals();if(g===2*Math.PI)for(g=this.attributes.normal.array,u=new r,
x=new r,A=new r,d=c*a.length*3,O=R=0;R<a.length;R++,O+=3)u.x=g[O+0],u.y=g[O+1],u.z=g[O+2],x.x=g[d+O+0],x.y=g[d+O+1],x.z=g[d+O+2],A.addVectors(u,x).normalize(),g[O+0]=g[d+O+0]=A.x,g[O+1]=g[d+O+1]=A.y,g[O+2]=g[d+O+2]=A.z}function Yd(a,c){sb.call(this);this.type="ShapeGeometry";"object"===typeof c&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),c=c.curveSegments);this.parameters={shapes:a,curveSegments:c};this.fromBufferGeometry(new Zd(a,c));this.mergeVertices()}function Zd(a,
c){function d(R){var O,P=u.length/3;R=R.extractPoints(c);var Z=R.shape,da=R.holes;if(!1===Kc.isClockWise(Z))for(Z=Z.reverse(),R=0,O=da.length;R<O;R++){var na=da[R];!0===Kc.isClockWise(na)&&(da[R]=na.reverse())}var qa=Kc.triangulateShape(Z,da);R=0;for(O=da.length;R<O;R++)na=da[R],Z=Z.concat(na);R=0;for(O=Z.length;R<O;R++)na=Z[R],u.push(na.x,na.y,0),x.push(0,0,1),A.push(na.x,na.y);R=0;for(O=qa.length;R<O;R++)Z=qa[R],g.push(Z[0]+P,Z[1]+P,Z[2]+P),K+=3}ob.call(this);this.type="ShapeBufferGeometry";this.parameters=
{shapes:a,curveSegments:c};c=c||12;var g=[],u=[],x=[],A=[],H=0,K=0;if(!1===Array.isArray(a))d(a);else for(var M=0;M<a.length;M++)d(a[M]),this.addGroup(H,K,M),H+=K,K=0;this.setIndex(g);this.addAttribute("position",new ib(u,3));this.addAttribute("normal",new ib(x,3));this.addAttribute("uv",new ib(A,2))}function $d(a,c){function d(Z,da){return Z-da}ob.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:c};var g=[];c=Math.cos(xb.DEG2RAD*(void 0!==c?c:1));var u=[0,0],x={},A=["a","b","c"];
if(a.isBufferGeometry){var H=new sb;H.fromBufferGeometry(a)}else H=a.clone();H.mergeVertices();H.computeFaceNormals();a=H.vertices;H=H.faces;for(var K=0,M=H.length;K<M;K++)for(var R=H[K],O=0;3>O;O++){u[0]=R[A[O]];u[1]=R[A[(O+1)%3]];u.sort(d);var P=u.toString();void 0===x[P]?x[P]={index1:u[0],index2:u[1],face1:K,face2:void 0}:x[P].face2=K}for(P in x)if(u=x[P],void 0===u.face2||H[u.face1].normal.dot(H[u.face2].normal)<=c)A=a[u.index1],g.push(A.x,A.y,A.z),A=a[u.index2],g.push(A.x,A.y,A.z);this.addAttribute("position",
new ib(g,3))}function sd(a,c,d,g,u,x,A,H){sb.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:c,height:d,radialSegments:g,heightSegments:u,openEnded:x,thetaStart:A,thetaLength:H};this.fromBufferGeometry(new $c(a,c,d,g,u,x,A,H));this.mergeVertices()}function $c(a,c,d,g,u,x,A,H){function K(ba){var oa,la=new k,wa=new r,ya=0,Ca=!0===ba?a:c,Ja=!0===ba?1:-1;var Pa=da;for(oa=1;oa<=g;oa++)O.push(0,qa*Ja,0),P.push(0,Ja,0),Z.push(.5,.5),da++;var Na=da;for(oa=0;oa<=g;oa++){var Ta=
oa/g*H+A,Qa=Math.cos(Ta);Ta=Math.sin(Ta);wa.x=Ca*Ta;wa.y=qa*Ja;wa.z=Ca*Qa;O.push(wa.x,wa.y,wa.z);P.push(0,Ja,0);la.x=.5*Qa+.5;la.y=.5*Ta*Ja+.5;Z.push(la.x,la.y);da++}for(oa=0;oa<g;oa++)la=Pa+oa,wa=Na+oa,!0===ba?R.push(wa,wa+1,la):R.push(wa+1,wa,la),ya+=3;M.addGroup(sa,ya,!0===ba?1:2);sa+=ya}ob.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:c,height:d,radialSegments:g,heightSegments:u,openEnded:x,thetaStart:A,thetaLength:H};var M=this;a=void 0!==a?a:20;c=void 0!==
c?c:20;d=void 0!==d?d:100;g=Math.floor(g)||8;u=Math.floor(u)||1;x=void 0!==x?x:!1;A=void 0!==A?A:0;H=void 0!==H?H:2*Math.PI;var R=[],O=[],P=[],Z=[],da=0,na=[],qa=d/2,sa=0;(function(){var ba,oa,la=new r,wa=new r,ya=0,Ca=(c-a)/d;for(oa=0;oa<=u;oa++){var Ja=[],Pa=oa/u,Na=Pa*(c-a)+a;for(ba=0;ba<=g;ba++){var Ta=ba/g,Qa=Ta*H+A,Xa=Math.sin(Qa);Qa=Math.cos(Qa);wa.x=Na*Xa;wa.y=-Pa*d+qa;wa.z=Na*Qa;O.push(wa.x,wa.y,wa.z);la.set(Xa,Ca,Qa).normalize();P.push(la.x,la.y,la.z);Z.push(Ta,1-Pa);Ja.push(da++)}na.push(Ja)}for(ba=
0;ba<g;ba++)for(oa=0;oa<u;oa++)la=na[oa+1][ba],wa=na[oa+1][ba+1],Ca=na[oa][ba+1],R.push(na[oa][ba],la,Ca),R.push(la,wa,Ca),ya+=6;M.addGroup(sa,ya,0);sa+=ya})();!1===x&&(0<a&&K(!0),0<c&&K(!1));this.setIndex(R);this.addAttribute("position",new ib(O,3));this.addAttribute("normal",new ib(P,3));this.addAttribute("uv",new ib(Z,2))}function Oe(a,c,d,g,u,x,A){sd.call(this,0,a,c,d,g,u,x,A);this.type="ConeGeometry";this.parameters={radius:a,height:c,radialSegments:d,heightSegments:g,openEnded:u,thetaStart:x,
thetaLength:A}}function Pe(a,c,d,g,u,x,A){$c.call(this,0,a,c,d,g,u,x,A);this.type="ConeBufferGeometry";this.parameters={radius:a,height:c,radialSegments:d,heightSegments:g,openEnded:u,thetaStart:x,thetaLength:A}}function Qe(a,c,d,g){sb.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:c,thetaStart:d,thetaLength:g};this.fromBufferGeometry(new ae(a,c,d,g))}function ae(a,c,d,g){ob.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:c,thetaStart:d,thetaLength:g};
a=a||50;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?d:0;g=void 0!==g?g:2*Math.PI;var u=[],x=[],A=[],H=[],K,M=new r,R=new k;x.push(0,0,0);A.push(0,0,1);H.push(.5,.5);var O=0;for(K=3;O<=c;O++,K+=3){var P=d+O/c*g;M.x=a*Math.cos(P);M.y=a*Math.sin(P);x.push(M.x,M.y,M.z);A.push(0,0,1);R.x=(x[K]/a+1)/2;R.y=(x[K+1]/a+1)/2;H.push(R.x,R.y)}for(K=1;K<=c;K++)u.push(K,K+1,0);this.setIndex(u);this.addAttribute("position",new ib(x,3));this.addAttribute("normal",new ib(A,3));this.addAttribute("uv",new ib(H,2))}function be(){kb.call(this,
{uniforms:nc.merge([Ab.lights,{opacity:{value:1}}]),vertexShader:Mb.shadow_vert,fragmentShader:Mb.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})}function ce(a){kb.call(this,a);this.type="RawShaderMaterial"}function rf(a){this.uuid=xb.generateUUID();this.type="MultiMaterial";this.materials=Array.isArray(a)?a:[];this.visible=!0}function Wc(a){Za.call(this);
this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new ka(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new ka(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new k(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;
this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function td(a){Wc.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function Lc(a){Za.call(this);this.type="MeshPhongMaterial";this.color=new ka(16777215);this.specular=new ka(1118481);
this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new ka(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new k(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=
this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function ud(a){Lc.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(a)}function vd(a){Za.call(this,a);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new k(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=
this.morphTargets=this.skinning=this.lights=this.fog=!1;this.setValues(a)}function wd(a){Za.call(this);this.type="MeshLambertMaterial";this.color=new ka(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new ka(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap=
"round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function xd(a){Za.call(this);this.type="LineDashedMaterial";this.color=new ka(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)}function Wf(a,c,d){var g=this,u=!1,x=0,A=0;this.onStart=void 0;this.onLoad=a;this.onProgress=c;this.onError=d;this.itemStart=function(H){A++;if(!1===u&&void 0!==g.onStart)g.onStart(H,x,A);u=!0};this.itemEnd=function(H){x++;if(void 0!==g.onProgress)g.onProgress(H,
x,A);if(x===A&&(u=!1,void 0!==g.onLoad))g.onLoad()};this.itemError=function(H){if(void 0!==g.onError)g.onError(H)}}function Mc(a){this.manager=void 0!==a?a:zc}function zg(a){this.manager=void 0!==a?a:zc;this._parser=null}function Xf(a){this.manager=void 0!==a?a:zc;this._parser=null}function Re(a){this.manager=void 0!==a?a:zc}function Yf(a){this.manager=void 0!==a?a:zc}function sf(a){this.manager=void 0!==a?a:zc}function ac(a,c){lb.call(this);this.type="Light";this.color=new ka(a);this.intensity=void 0!==
c?c:1;this.receiveShadow=void 0}function tf(a,c,d){ac.call(this,a,d);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(lb.DefaultUp);this.updateMatrix();this.groundColor=new ka(c)}function yd(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new k(512,512);this.map=null;this.matrix=new y}function uf(){yd.call(this,new Oa(50,1,.5,500))}function vf(a,c,d,g,u,x){ac.call(this,a,c);this.type="SpotLight";this.position.copy(lb.DefaultUp);this.updateMatrix();this.target=new lb;Object.defineProperty(this,
"power",{get:function(){return this.intensity*Math.PI},set:function(A){this.intensity=A/Math.PI}});this.distance=void 0!==d?d:0;this.angle=void 0!==g?g:Math.PI/3;this.penumbra=void 0!==u?u:0;this.decay=void 0!==x?x:1;this.shadow=new uf}function wf(a,c,d,g){ac.call(this,a,c);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(u){this.intensity=u/(4*Math.PI)}});this.distance=void 0!==d?d:0;this.decay=void 0!==g?g:1;this.shadow=new yd(new Oa(90,
1,.5,500))}function xf(){yd.call(this,new Ha(-5,5,5,-5,.5,500))}function yf(a,c){ac.call(this,a,c);this.type="DirectionalLight";this.position.copy(lb.DefaultUp);this.updateMatrix();this.target=new lb;this.shadow=new xf}function zf(a,c){ac.call(this,a,c);this.type="AmbientLight";this.castShadow=void 0}function Ac(a,c,d,g){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==g?g:new c.constructor(d);this.sampleValues=c;this.valueSize=d}function Af(a,c,d,g){Ac.call(this,a,c,d,g);
this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function Se(a,c,d,g){Ac.call(this,a,c,d,g)}function Bf(a,c,d,g){Ac.call(this,a,c,d,g)}function zd(a,c,d,g){if(void 0===a)throw Error("track name is undefined");if(void 0===c||0===c.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=kc.convertArray(c,this.TimeBufferType);this.values=kc.convertArray(d,this.ValueBufferType);this.setInterpolation(g||this.DefaultInterpolation);this.validate();this.optimize()}
function de(a,c,d,g){zd.call(this,a,c,d,g)}function Cf(a,c,d,g){Ac.call(this,a,c,d,g)}function Te(a,c,d,g){zd.call(this,a,c,d,g)}function ee(a,c,d,g){zd.call(this,a,c,d,g)}function Df(a,c,d,g){zd.call(this,a,c,d,g)}function Ef(a,c,d){zd.call(this,a,c,d)}function Ff(a,c,d,g){zd.call(this,a,c,d,g)}function Ad(a,c,d,g){zd.apply(this,arguments)}function Gc(a,c,d){this.name=a;this.tracks=d;this.duration=void 0!==c?c:-1;this.uuid=xb.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function Gf(a){this.manager=
void 0!==a?a:zc;this.textures={}}function Zf(a){this.manager=void 0!==a?a:zc}function fe(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function $f(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:zc;this.withCredentials=!1}function Ag(a){this.manager=void 0!==a?a:zc;this.texturePath=""}function Bg(a,c,d,g,u){c=.5*(g-c);u=.5*(u-d);var x=a*a;return(2*
d-2*g+c+u)*a*x+(-3*d+3*g-2*c-u)*x+c*a+d}function Bd(a,c,d,g){var u=1-a;return u*u*c+2*(1-a)*a*d+a*a*g}function Cd(a,c,d,g,u){var x=1-a,A=1-a;return x*x*x*c+3*A*A*a*d+3*(1-a)*a*a*g+a*a*a*u}function rc(){}function Xc(a,c){this.v1=a;this.v2=c}function Ue(){this.curves=[];this.autoClose=!1}function ad(a,c,d,g,u,x,A,H){this.aX=a;this.aY=c;this.xRadius=d;this.yRadius=g;this.aStartAngle=u;this.aEndAngle=x;this.aClockwise=A;this.aRotation=H||0}function Dd(a){this.points=void 0===a?[]:a}function ge(a,c,d,
g){this.v0=a;this.v1=c;this.v2=d;this.v3=g}function he(a,c,d){this.v0=a;this.v1=c;this.v2=d}function Ve(a){Ue.call(this);this.currentPoint=new k;a&&this.fromPoints(a)}function Ed(){Ve.apply(this,arguments);this.holes=[]}function ag(){this.subPaths=[];this.currentPath=null}function bg(a){this.data=a}function Cg(a){this.manager=void 0!==a?a:zc}function cg(a){this.manager=void 0!==a?a:zc}function dg(a,c,d,g){ac.call(this,a,c);this.type="RectAreaLight";this.position.set(0,1,0);this.updateMatrix();this.width=
void 0!==d?d:10;this.height=void 0!==g?g:10}function Dg(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Oa;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Oa;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}function Hf(a,c,d){lb.call(this);this.type="CubeCamera";var g=new Oa(90,1,a,c);g.up.set(0,-1,0);g.lookAt(new r(1,0,0));this.add(g);var u=new Oa(90,1,a,c);u.up.set(0,-1,0);u.lookAt(new r(-1,0,0));this.add(u);var x=new Oa(90,
1,a,c);x.up.set(0,0,1);x.lookAt(new r(0,1,0));this.add(x);var A=new Oa(90,1,a,c);A.up.set(0,0,-1);A.lookAt(new r(0,-1,0));this.add(A);var H=new Oa(90,1,a,c);H.up.set(0,-1,0);H.lookAt(new r(0,0,1));this.add(H);var K=new Oa(90,1,a,c);K.up.set(0,-1,0);K.lookAt(new r(0,0,-1));this.add(K);this.renderTarget=new l(d,d,{format:1022,magFilter:1006,minFilter:1006});this.renderTarget.texture.name="CubeCamera";this.updateCubeMap=function(M,R){null===this.parent&&this.updateMatrixWorld();var O=this.renderTarget,
P=O.texture.generateMipmaps;O.texture.generateMipmaps=!1;O.activeCubeFace=0;M.render(R,g,O);O.activeCubeFace=1;M.render(R,u,O);O.activeCubeFace=2;M.render(R,x,O);O.activeCubeFace=3;M.render(R,A,O);O.activeCubeFace=4;M.render(R,H,O);O.texture.generateMipmaps=P;O.activeCubeFace=5;M.render(R,K,O);M.setRenderTarget(null)}}function eg(){lb.call(this);this.type="AudioListener";this.context=fg.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function ie(a){lb.call(this);
this.type="Audio";this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function gg(a){ie.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function hg(a,c){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==c?c:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);
a.getOutput().connect(this.analyser)}function ig(a,c,d){this.binding=a;this.valueSize=d;a=Float64Array;switch(c){case "quaternion":c=this._slerp;break;case "string":case "bool":a=Array;c=this._select;break;default:c=this._lerp}this.buffer=new a(4*d);this._mixBufferRegion=c;this.referenceCount=this.useCount=this.cumulativeWeight=0}function Eg(a,c,d){d=d||lc.parseTrackName(c);this._targetGroup=a;this._bindings=a.subscribe_(c,d)}function lc(a,c,d){this.path=c;this.parsedPath=d||lc.parseTrackName(c);
this.node=lc.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function Fg(a){this.uuid=xb.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var c={};this._indicesByUUID=c;for(var d=0,g=arguments.length;d!==g;++d)c[arguments[d].uuid]=d;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var u=this;this.stats={objects:{get total(){return u._objects.length},get inUse(){return this.total-u.nCachedObjects_}},get bindingsPerObject(){return u._bindings.length}}}
function Gg(a,c,d){this._mixer=a;this._clip=c;this._localRoot=d||null;a=c.tracks;c=a.length;d=Array(c);for(var g={endingStart:2400,endingEnd:2400},u=0;u!==c;++u){var x=a[u].createInterpolant(null);d[u]=x;x.settings=g}this._interpolantSettings=g;this._interpolants=d;this._propertyBindings=Array(c);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=
this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function Hg(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function If(a,c){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=c);this.value=a}function Fd(){ob.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function jg(a,c,d,g){this.uuid=xb.generateUUID();
this.data=a;this.itemSize=c;this.offset=d;this.normalized=!0===g}function je(a,c){this.uuid=xb.generateUUID();this.array=a;this.stride=c;this.count=void 0!==a?a.length/c:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function ke(a,c,d){je.call(this,a,c);this.meshPerAttribute=d||1}function le(a,c,d){zb.call(this,a,c);this.meshPerAttribute=d||1}function Ig(a,c,d,g){this.ray=new sc(a,c);this.near=d||0;this.far=g||Infinity;this.params={Mesh:{},
Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function Jg(a,c){return a.distance-c.distance}function kg(a,c,d,g){if(!1!==a.visible&&(a.raycast(c,d),!0===g)){a=a.children;g=0;for(var u=a.length;g<u;g++)kg(a[g],c,d,!0)}}function Kg(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}
function Lg(a,c,d){this.radius=void 0!==a?a:1;this.phi=void 0!==c?c:0;this.theta=void 0!==d?d:0;return this}function Mg(a,c,d){this.radius=void 0!==a?a:1;this.theta=void 0!==c?c:0;this.y=void 0!==d?d:0;return this}function ic(a,c){Zb.call(this,a,c);this.animationsMap={};this.animationsList=[];a=this.geometry.morphTargets.length;this.createAnimation("__default",0,a-1,a/1);this.setAnimationWeight("__default",1)}function We(a){lb.call(this);this.material=a;this.render=function(c){}}function Xe(a,c,d,
g){this.object=a;this.size=void 0!==c?c:1;a=void 0!==d?d:16711680;g=void 0!==g?g:1;c=0;(d=this.object.geometry)&&d.isGeometry?c=3*d.faces.length:d&&d.isBufferGeometry&&(c=d.attributes.normal.count);d=new ob;c=new ib(6*c,3);d.addAttribute("position",c);Vb.call(this,d,new $b({color:a,linewidth:g}));this.matrixAutoUpdate=!1;this.update()}function me(a){lb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new ob;for(var c=[0,0,0,0,0,1,0,0,0,1,
0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],d=0,g=1;32>d;d++,g++){var u=d/32*Math.PI*2,x=g/32*Math.PI*2;c.push(Math.cos(u),Math.sin(u),1,Math.cos(x),Math.sin(x),1)}a.addAttribute("position",new ib(c,3));c=new $b({fog:!1});this.cone=new Vb(a,c);this.add(this.cone);this.update()}function ne(a){this.bones=this.getBoneList(a);for(var c=new ob,d=[],g=[],u=new ka(0,0,1),x=new ka(0,1,0),A=0;A<this.bones.length;A++){var H=this.bones[A];H.parent&&H.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),g.push(u.r,u.g,
u.b),g.push(x.r,x.g,x.b))}c.addAttribute("position",new ib(d,3));c.addAttribute("color",new ib(g,3));d=new $b({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});Vb.call(this,c,d);this.root=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function oe(a,c){this.light=a;this.light.updateMatrixWorld();a=new rd(c,4,2);c=new hc({wireframe:!0,fog:!1});c.color.copy(this.light.color).multiplyScalar(this.light.intensity);Zb.call(this,a,c);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=
!1}function pe(a){lb.call(this);this.light=a;this.light.updateMatrixWorld();var c=new hc({color:a.color,fog:!1});a=new hc({color:a.color,fog:!1,wireframe:!0});var d=new ob;d.addAttribute("position",new zb(new Float32Array(18),3));this.add(new Zb(d,c));this.add(new Zb(d,a));this.update()}function qe(a,c){lb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new qd(c);a.rotateY(.5*Math.PI);c=new hc({vertexColors:2,wireframe:!0});var d=a.getAttribute("position");
d=new Float32Array(3*d.count);a.addAttribute("color",new zb(d,3));this.add(new Zb(a,c));this.update()}function Ye(a,c,d,g){a=a||10;c=c||10;d=new ka(void 0!==d?d:4473924);g=new ka(void 0!==g?g:8947848);var u=c/2,x=a/c,A=a/2;a=[];for(var H=[],K=0,M=0,R=-A;K<=c;K++,R+=x){a.push(-A,0,R,A,0,R);a.push(R,0,-A,R,0,A);var O=K===u?d:g;O.toArray(H,M);M+=3;O.toArray(H,M);M+=3;O.toArray(H,M);M+=3;O.toArray(H,M);M+=3}c=new ob;c.addAttribute("position",new ib(a,3));c.addAttribute("color",new ib(H,3));d=new $b({vertexColors:2});
Vb.call(this,c,d)}function Jf(a,c,d,g,u,x){a=a||10;c=c||16;d=d||8;g=g||64;u=new ka(void 0!==u?u:4473924);x=new ka(void 0!==x?x:8947848);var A=[],H=[],K;for(K=0;K<=c;K++){var M=K/c*2*Math.PI;var R=Math.sin(M)*a;M=Math.cos(M)*a;A.push(0,0,0);A.push(R,0,M);var O=K&1?u:x;H.push(O.r,O.g,O.b);H.push(O.r,O.g,O.b)}for(K=0;K<=d;K++){O=K&1?u:x;var P=a-a/d*K;for(c=0;c<g;c++)M=c/g*2*Math.PI,R=Math.sin(M)*P,M=Math.cos(M)*P,A.push(R,0,M),H.push(O.r,O.g,O.b),M=(c+1)/g*2*Math.PI,R=Math.sin(M)*P,M=Math.cos(M)*P,A.push(R,
0,M),H.push(O.r,O.g,O.b)}a=new ob;a.addAttribute("position",new ib(A,3));a.addAttribute("color",new ib(H,3));A=new $b({vertexColors:2});Vb.call(this,a,A)}function Ze(a,c,d,g){this.object=a;this.size=void 0!==c?c:1;a=void 0!==d?d:16776960;g=void 0!==g?g:1;c=0;(d=this.object.geometry)&&d.isGeometry?c=d.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");d=new ob;c=new ib(6*c,3);d.addAttribute("position",c);Vb.call(this,d,new $b({color:a,
linewidth:g}));this.matrixAutoUpdate=!1;this.update()}function re(a,c){lb.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===c&&(c=1);a=new ob;a.addAttribute("position",new ib([-c,c,0,c,c,0,c,-c,0,-c,-c,0,-c,c,0],3));c=new $b({fog:!1});this.add(new Ic(a,c));a=new ob;a.addAttribute("position",new ib([0,0,0,0,0,1],3));this.add(new Ic(a,c));this.update()}function $e(a){function c(Z,da,na){d(Z,na);d(da,na)}function d(Z,da){x.push(0,0,0);
A.push(da.r,da.g,da.b);void 0===H[Z]&&(H[Z]=[]);H[Z].push(x.length/3-1)}var g=new ob,u=new $b({color:16777215,vertexColors:1}),x=[],A=[],H={},K=new ka(16755200),M=new ka(16711680),R=new ka(43775),O=new ka(16777215),P=new ka(3355443);c("n1","n2",K);c("n2","n4",K);c("n4","n3",K);c("n3","n1",K);c("f1","f2",K);c("f2","f4",K);c("f4","f3",K);c("f3","f1",K);c("n1","f1",K);c("n2","f2",K);c("n3","f3",K);c("n4","f4",K);c("p","n1",M);c("p","n2",M);c("p","n3",M);c("p","n4",M);c("u1","u2",R);c("u2","u3",R);c("u3",
"u1",R);c("c","t",O);c("p","c",P);c("cn1","cn2",P);c("cn3","cn4",P);c("cf1","cf2",P);c("cf3","cf4",P);g.addAttribute("position",new ib(x,3));g.addAttribute("color",new ib(A,3));Vb.call(this,g,u);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=H;this.update()}function se(a,c){void 0===c&&(c=16776960);var d=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),g=new Float32Array(24),
u=new ob;u.setIndex(new zb(d,1));u.addAttribute("position",new zb(g,3));Vb.call(this,u,new $b({color:c}));void 0!==a&&this.update(a)}function Gd(a,c,d,g,u,x){lb.call(this);void 0===g&&(g=16776960);void 0===d&&(d=1);void 0===u&&(u=.2*d);void 0===x&&(x=.2*u);void 0===Kf&&(Kf=new ob,Kf.addAttribute("position",new ib([0,0,0,0,1,0],3)),lg=new $c(0,.5,1,5,1),lg.translate(0,-.5,0));this.position.copy(c);this.line=new Ic(Kf,new $b({color:g}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Zb(lg,
new hc({color:g}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(d,u,x)}function Lf(a){a=a||1;var c=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new ob;a.addAttribute("position",new ib(c,3));a.addAttribute("color",new ib([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));c=new $b({vertexColors:2});Vb.call(this,a,c)}function mg(){var a=0,c=0,d=0,g=0;return{initCatmullRom:function(u,x,A,H,K){u=K*(A-u);H=K*(H-x);a=x;c=u;d=-3*x+3*A-2*u-H;g=2*x-2*A+u+H},initNonuniformCatmullRom:function(u,
x,A,H,K,M,R){u=((x-u)/K-(A-u)/(K+M)+(A-x)/M)*M;H=((A-x)/M-(H-x)/(M+R)+(H-A)/R)*M;a=x;c=u;d=-3*x+3*A-2*u-H;g=2*x-2*A+u+H},calc:function(u){var x=u*u;return a+c*u+d*x+g*x*u}}}function Nc(a){this.points=a||[];this.closed=!1}function af(a,c,d,g){this.v0=a;this.v1=c;this.v2=d;this.v3=g}function bf(a,c,d){this.v0=a;this.v1=c;this.v2=d}function cf(a,c){this.v1=a;this.v2=c}function Mf(a,c,d,g,u,x){ad.call(this,a,c,d,d,g,u,x)}function Ng(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");
Nc.call(this,a);this.type="catmullrom";this.closed=!0}function Og(a){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");Nc.call(this,a);this.type="catmullrom"}function ng(a){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");Nc.call(this,a);this.type="catmullrom"}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,
"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var c=Object(a),d=1;d<arguments.length;d++){var g=arguments[d];if(void 0!==g&&null!==g)for(var u in g)Object.prototype.hasOwnProperty.call(g,u)&&(c[u]=g[u])}return c}}();Object.assign(h.prototype,{addEventListener:function(a,c){void 0===this._listeners&&(this._listeners=
{});var d=this._listeners;void 0===d[a]&&(d[a]=[]);-1===d[a].indexOf(c)&&d[a].push(c)},hasEventListener:function(a,c){if(void 0===this._listeners)return!1;var d=this._listeners;return void 0!==d[a]&&-1!==d[a].indexOf(c)},removeEventListener:function(a,c){void 0!==this._listeners&&(a=this._listeners[a],void 0!==a&&(c=a.indexOf(c),-1!==c&&a.splice(c,1)))},dispatchEvent:function(a){if(void 0!==this._listeners){var c=this._listeners[a.type];if(void 0!==c){a.target=this;var d=[],g,u=c.length;for(g=0;g<
u;g++)d[g]=c[g];for(g=0;g<u;g++)d[g].call(this,a)}}}});var xb={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=Array(36),d=0,g;return function(){for(var u=0;36>u;u++)8===u||13===u||18===u||23===u?c[u]="-":14===u?c[u]="4":(2>=d&&(d=33554432+16777216*Math.random()|0),g=d&15,d>>=4,c[u]=a[19===u?g&3|8:g]);return c.join("")}}(),clamp:function(a,c,d){return Math.max(c,Math.min(d,a))},euclideanModulo:function(a,
c){return(a%c+c)%c},mapLinear:function(a,c,d,g,u){return g+(a-c)*(u-g)/(d-c)},lerp:function(a,c,d){return(1-d)*a+d*c},smoothstep:function(a,c,d){if(a<=c)return 0;if(a>=d)return 1;a=(a-c)/(d-c);return a*a*(3-2*a)},smootherstep:function(a,c,d){if(a<=c)return 0;if(a>=d)return 1;a=(a-c)/(d-c);return a*a*a*(a*(6*a-15)+10)},randInt:function(a,c){return a+Math.floor(Math.random()*(c-a+1))},randFloat:function(a,c){return a+Math.random()*(c-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*
xb.DEG2RAD},radToDeg:function(a){return a*xb.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};Object.defineProperties(k.prototype,{width:{get:function(){return this.x},set:function(a){this.x=a}},height:{get:function(){return this.y},set:function(a){this.y=a}}});Object.assign(k.prototype,{isVector2:!0,set:function(a,c){this.x=
a;this.y=c;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,c){switch(a){case 0:this.x=c;break;case 1:this.y=c;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=
a.x;this.y=a.y;return this},add:function(a,c){if(void 0!==c)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,c);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;return this},addScaledVector:function(a,c){this.x+=a.x*c;this.y+=a.y*c;return this},sub:function(a,c){if(void 0!==c)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),
this.subVectors(a,c);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,c){this.x=Math.max(a.x,Math.min(c.x,this.x));this.y=Math.max(a.y,Math.min(c.y,this.y));return this},clampScalar:function(){var a=new k,c=new k;return function(d,g){a.set(d,d);c.set(g,g);return this.clamp(a,c)}}(),clampLength:function(a,c){var d=this.length();return this.multiplyScalar(Math.max(a,Math.min(c,d))/d)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);
return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var c=this.x-a.x;a=this.y-a.y;return c*c+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/
this.length())},lerp:function(a,c){this.x+=(a.x-this.x)*c;this.y+=(a.y-this.y)*c;return this},lerpVectors:function(a,c,d){return this.subVectors(c,a).multiplyScalar(d).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,c){void 0===c&&(c=0);this.x=a[c];this.y=a[c+1];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.x;a[c+1]=this.y;return a},fromBufferAttribute:function(a,c,d){void 0!==d&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().");
this.x=a.getX(c);this.y=a.getY(c);return this},rotateAround:function(a,c){var d=Math.cos(c);c=Math.sin(c);var g=this.x-a.x,u=this.y-a.y;this.x=g*d-u*c+a.x;this.y=g*c+u*d+a.y;return this}});var Pg=0;e.DEFAULT_IMAGE=void 0;e.DEFAULT_MAPPING=300;Object.defineProperty(e.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(e.prototype,h.prototype,{constructor:e,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.image=
a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];
var c={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var d=this.image;void 0===d.uuid&&(d.uuid=xb.generateUUID());if(void 0===a.images[d.uuid]){var g=a.images,u=d.uuid,x=d.uuid;if(void 0!==d.toDataURL)var A=d;
else A=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),A.width=d.width,A.height=d.height,A.getContext("2d").drawImage(d,0,0,d.width,d.height);A=2048<A.width||2048<A.height?A.toDataURL("image/jpeg",.6):A.toDataURL("image/png");g[u]={uuid:x,url:A}}c.image=d.uuid}return a.textures[this.uuid]=c},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300===this.mapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=
Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}});Object.assign(p.prototype,{isVector4:!0,set:function(a,c,d,g){this.x=a;this.y=c;this.z=d;this.w=g;return this},setScalar:function(a){this.w=this.z=this.y=
this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,c){switch(a){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;case 3:this.w=c;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+
a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,c){if(void 0!==c)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,c);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,c){this.x=a.x+
c.x;this.y=a.y+c.y;this.z=a.z+c.z;this.w=a.w+c.w;return this},addScaledVector:function(a,c){this.x+=a.x*c;this.y+=a.y*c;this.z+=a.z*c;this.w+=a.w*c;return this},sub:function(a,c){if(void 0!==c)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,c);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,c){this.x=a.x-c.x;this.y=
a.y-c.y;this.z=a.z-c.z;this.w=a.w-c.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var c=this.x,d=this.y,g=this.z,u=this.w;a=a.elements;this.x=a[0]*c+a[4]*d+a[8]*g+a[12]*u;this.y=a[1]*c+a[5]*d+a[9]*g+a[13]*u;this.z=a[2]*c+a[6]*d+a[10]*g+a[14]*u;this.w=a[3]*c+a[7]*d+a[11]*g+a[15]*u;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=
2*Math.acos(a.w);var c=Math.sqrt(1-a.w*a.w);1E-4>c?(this.x=1,this.z=this.y=0):(this.x=a.x/c,this.y=a.y/c,this.z=a.z/c);return this},setAxisAngleFromRotationMatrix:function(a){a=a.elements;var c=a[0];var d=a[4];var g=a[8],u=a[1],x=a[5],A=a[9];var H=a[2];var K=a[6];var M=a[10];if(.01>Math.abs(d-u)&&.01>Math.abs(g-H)&&.01>Math.abs(A-K)){if(.1>Math.abs(d+u)&&.1>Math.abs(g+H)&&.1>Math.abs(A+K)&&.1>Math.abs(c+x+M-3))return this.set(1,0,0,0),this;a=Math.PI;c=(c+1)/2;x=(x+1)/2;M=(M+1)/2;d=(d+u)/4;g=(g+H)/
4;A=(A+K)/4;c>x&&c>M?.01>c?(K=0,d=H=.707106781):(K=Math.sqrt(c),H=d/K,d=g/K):x>M?.01>x?(K=.707106781,H=0,d=.707106781):(H=Math.sqrt(x),K=d/H,d=A/H):.01>M?(H=K=.707106781,d=0):(d=Math.sqrt(M),K=g/d,H=A/d);this.set(K,H,d,a);return this}a=Math.sqrt((K-A)*(K-A)+(g-H)*(g-H)+(u-d)*(u-d));.001>Math.abs(a)&&(a=1);this.x=(K-A)/a;this.y=(g-H)/a;this.z=(u-d)/a;this.w=Math.acos((c+x+M-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=
Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,c){this.x=Math.max(a.x,Math.min(c.x,this.x));this.y=Math.max(a.y,Math.min(c.y,this.y));this.z=Math.max(a.z,Math.min(c.z,this.z));this.w=Math.max(a.w,Math.min(c.w,this.w));return this},clampScalar:function(){var a=new p,c=new p;return function(d,g){a.set(d,d,d,d);c.set(g,g,g,g);return this.clamp(a,c)}}(),floor:function(){this.x=
Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+
Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,c){this.x+=(a.x-this.x)*c;this.y+=(a.y-this.y)*c;this.z+=(a.z-this.z)*c;this.w+=(a.w-this.w)*c;return this},lerpVectors:function(a,c,d){return this.subVectors(c,a).multiplyScalar(d).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,c){void 0===
c&&(c=0);this.x=a[c];this.y=a[c+1];this.z=a[c+2];this.w=a[c+3];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.x;a[c+1]=this.y;a[c+2]=this.z;a[c+3]=this.w;return a},fromBufferAttribute:function(a,c,d){void 0!==d&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().");this.x=a.getX(c);this.y=a.getY(c);this.z=a.getZ(c);this.w=a.getW(c);return this}});Object.assign(q.prototype,h.prototype,{isWebGLRenderTarget:!0,setSize:function(a,c){if(this.width!==
a||this.height!==c)this.width=a,this.height=c,this.dispose();this.viewport.set(0,0,a,c);this.scissor.set(0,0,a,c)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});l.prototype=Object.create(q.prototype);
l.prototype.constructor=l;l.prototype.isWebGLRenderTargetCube=!0;Object.assign(t,{slerp:function(a,c,d,g){return d.copy(a).slerp(c,g)},slerpFlat:function(a,c,d,g,u,x,A){var H=d[g+0],K=d[g+1],M=d[g+2];d=d[g+3];g=u[x+0];var R=u[x+1],O=u[x+2];u=u[x+3];if(d!==u||H!==g||K!==R||M!==O){x=1-A;var P=H*g+K*R+M*O+d*u,Z=0<=P?1:-1,da=1-P*P;da>Number.EPSILON&&(da=Math.sqrt(da),P=Math.atan2(da,P*Z),x=Math.sin(x*P)/da,A=Math.sin(A*P)/da);Z*=A;H=H*x+g*Z;K=K*x+R*Z;M=M*x+O*Z;d=d*x+u*Z;x===1-A&&(A=1/Math.sqrt(H*H+K*
K+M*M+d*d),H*=A,K*=A,M*=A,d*=A)}a[c]=H;a[c+1]=K;a[c+2]=M;a[c+3]=d}});Object.defineProperties(t.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=a;this.onChangeCallback()}},w:{get:function(){return this._w},set:function(a){this._w=a;this.onChangeCallback()}}});Object.assign(t.prototype,{set:function(a,c,d,g){this._x=
a;this._y=c;this._z=d;this._w=g;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,c){if(!1===(a&&a.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var d=Math.cos(a._x/2),g=Math.cos(a._y/2),u=Math.cos(a._z/2),x=Math.sin(a._x/2),A=Math.sin(a._y/
2),H=Math.sin(a._z/2);a=a.order;"XYZ"===a?(this._x=x*g*u+d*A*H,this._y=d*A*u-x*g*H,this._z=d*g*H+x*A*u,this._w=d*g*u-x*A*H):"YXZ"===a?(this._x=x*g*u+d*A*H,this._y=d*A*u-x*g*H,this._z=d*g*H-x*A*u,this._w=d*g*u+x*A*H):"ZXY"===a?(this._x=x*g*u-d*A*H,this._y=d*A*u+x*g*H,this._z=d*g*H+x*A*u,this._w=d*g*u-x*A*H):"ZYX"===a?(this._x=x*g*u-d*A*H,this._y=d*A*u+x*g*H,this._z=d*g*H-x*A*u,this._w=d*g*u+x*A*H):"YZX"===a?(this._x=x*g*u+d*A*H,this._y=d*A*u+x*g*H,this._z=d*g*H-x*A*u,this._w=d*g*u-x*A*H):"XZY"===a&&
(this._x=x*g*u-d*A*H,this._y=d*A*u-x*g*H,this._z=d*g*H+x*A*u,this._w=d*g*u+x*A*H);if(!1!==c)this.onChangeCallback();return this},setFromAxisAngle:function(a,c){c/=2;var d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var c=a.elements,d=c[0];a=c[4];var g=c[8],u=c[1],x=c[5],A=c[9],H=c[2],K=c[6];c=c[10];var M=d+x+c;0<M?(d=.5/Math.sqrt(M+1),this._w=.25/d,this._x=(K-A)*d,this._y=(g-H)*d,this._z=(u-a)*d):
d>x&&d>c?(d=2*Math.sqrt(1+d-x-c),this._w=(K-A)/d,this._x=.25*d,this._y=(a+u)/d,this._z=(g+H)/d):x>c?(d=2*Math.sqrt(1+x-d-c),this._w=(g-H)/d,this._x=(a+u)/d,this._y=.25*d,this._z=(A+K)/d):(d=2*Math.sqrt(1+c-d-x),this._w=(u-a)/d,this._x=(g+H)/d,this._y=(A+K)/d,this._z=.25*d);this.onChangeCallback();return this},setFromUnitVectors:function(){var a=new r,c;return function(d,g){void 0===a&&(a=new r);c=d.dot(g)+1;1E-6>c?(c=0,Math.abs(d.x)>Math.abs(d.z)?a.set(-d.y,d.x,0):a.set(0,-d.z,d.y)):a.crossVectors(d,
g);this._x=a.x;this._y=a.y;this._z=a.z;this._w=c;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=
this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,c){return void 0!==c?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,c)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,c){var d=a._x,g=a._y,u=a._z;a=a._w;
var x=c._x,A=c._y,H=c._z;c=c._w;this._x=d*c+a*x+g*H-u*A;this._y=g*c+a*A+u*x-d*H;this._z=u*c+a*H+d*A-g*x;this._w=a*c-d*x-g*A-u*H;this.onChangeCallback();return this},slerp:function(a,c){if(0===c)return this;if(1===c)return this.copy(a);var d=this._x,g=this._y,u=this._z,x=this._w,A=x*a._w+d*a._x+g*a._y+u*a._z;0>A?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,A=-A):this.copy(a);if(1<=A)return this._w=x,this._x=d,this._y=g,this._z=u,this;a=Math.sqrt(1-A*A);if(.001>Math.abs(a))return this._w=
.5*(x+this._w),this._x=.5*(d+this._x),this._y=.5*(g+this._y),this._z=.5*(u+this._z),this;var H=Math.atan2(a,A);A=Math.sin((1-c)*H)/a;c=Math.sin(c*H)/a;this._w=x*A+this._w*c;this._x=d*A+this._x*c;this._y=g*A+this._y*c;this._z=u*A+this._z*c;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,c){void 0===c&&(c=0);this._x=a[c];this._y=a[c+1];this._z=a[c+2];this._w=a[c+3];this.onChangeCallback();return this},
toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this._x;a[c+1]=this._y;a[c+2]=this._z;a[c+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}});Object.assign(r.prototype,{isVector3:!0,set:function(a,c,d){this.x=a;this.y=c;this.z=d;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,
c){switch(a){case 0:this.x=c;break;case 1:this.y=c;break;case 2:this.z=c;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,c);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;this.z=a.z+c.z;return this},addScaledVector:function(a,c){this.x+=a.x*c;this.y+=a.y*c;this.z+=a.z*c;return this},sub:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,c);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;this.z=a.z-c.z;return this},multiply:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,c);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,
c){this.x=a.x*c.x;this.y=a.y*c.y;this.z=a.z*c.z;return this},applyEuler:function(){var a=new t;return function(c){!1===(c&&c.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");return this.applyQuaternion(a.setFromEuler(c))}}(),applyAxisAngle:function(){var a=new t;return function(c,d){return this.applyQuaternion(a.setFromAxisAngle(c,d))}}(),applyMatrix3:function(a){var c=this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*c+a[3]*d+
a[6]*g;this.y=a[1]*c+a[4]*d+a[7]*g;this.z=a[2]*c+a[5]*d+a[8]*g;return this},applyMatrix4:function(a){var c=this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*c+a[4]*d+a[8]*g+a[12];this.y=a[1]*c+a[5]*d+a[9]*g+a[13];this.z=a[2]*c+a[6]*d+a[10]*g+a[14];return this.divideScalar(a[3]*c+a[7]*d+a[11]*g+a[15])},applyQuaternion:function(a){var c=this.x,d=this.y,g=this.z,u=a.x,x=a.y,A=a.z;a=a.w;var H=a*c+x*g-A*d,K=a*d+A*c-u*g,M=a*g+u*d-x*c;c=-u*c-x*d-A*g;this.x=H*a+c*-u+K*-A-M*-x;this.y=K*a+c*-x+M*-u-H*-A;this.z=
M*a+c*-A+H*-x-K*-u;return this},project:function(){var a=new y;return function(c){a.multiplyMatrices(c.projectionMatrix,a.getInverse(c.matrixWorld));return this.applyMatrix4(a)}}(),unproject:function(){var a=new y;return function(c){a.multiplyMatrices(c.matrixWorld,a.getInverse(c.projectionMatrix));return this.applyMatrix4(a)}}(),transformDirection:function(a){var c=this.x,d=this.y,g=this.z;a=a.elements;this.x=a[0]*c+a[4]*d+a[8]*g;this.y=a[1]*c+a[5]*d+a[9]*g;this.z=a[2]*c+a[6]*d+a[10]*g;return this.normalize()},
divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,c){this.x=Math.max(a.x,Math.min(c.x,this.x));this.y=Math.max(a.y,Math.min(c.y,this.y));this.z=Math.max(a.z,Math.min(c.z,this.z));return this},
clampScalar:function(){var a=new r,c=new r;return function(d,g){a.set(d,d,d);c.set(g,g,g);return this.clamp(a,c)}}(),clampLength:function(a,c){var d=this.length();return this.multiplyScalar(Math.max(a,Math.min(c,d))/d)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);
this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*
this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,c){this.x+=(a.x-this.x)*c;this.y+=(a.y-this.y)*c;this.z+=(a.z-this.z)*c;return this},lerpVectors:function(a,c,d){return this.subVectors(c,a).multiplyScalar(d).add(a)},cross:function(a,c){if(void 0!==c)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),
this.crossVectors(a,c);c=this.x;var d=this.y,g=this.z;this.x=d*a.z-g*a.y;this.y=g*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,c){var d=a.x,g=a.y;a=a.z;var u=c.x,x=c.y;c=c.z;this.x=g*c-a*x;this.y=a*u-d*c;this.z=d*x-g*u;return this},projectOnVector:function(a){var c=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(c)},projectOnPlane:function(){var a=new r;return function(c){a.copy(this).projectOnVector(c);return this.sub(a)}}(),reflect:function(){var a=new r;return function(c){return this.sub(a.copy(c).multiplyScalar(2*
this.dot(c)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(xb.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var c=this.x-a.x,d=this.y-a.y;a=this.z-a.z;return c*c+d*d+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var c=Math.sin(a.phi)*a.radius;this.x=c*Math.sin(a.theta);this.y=Math.cos(a.phi)*
a.radius;this.z=c*Math.cos(a.theta);return this},setFromCylindrical:function(a){this.x=a.radius*Math.sin(a.theta);this.y=a.y;this.z=a.radius*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var c=this.setFromMatrixColumn(a,0).length(),d=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=c;this.y=d;this.z=a;return this},setFromMatrixColumn:function(a,c){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");
var d=a;a=c;c=d}return this.fromArray(a.elements,4*c)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,c){void 0===c&&(c=0);this.x=a[c];this.y=a[c+1];this.z=a[c+2];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.x;a[c+1]=this.y;a[c+2]=this.z;return a},fromBufferAttribute:function(a,c,d){void 0!==d&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().");this.x=a.getX(c);this.y=a.getY(c);this.z=a.getZ(c);
return this}});Object.assign(y.prototype,{isMatrix4:!0,set:function(a,c,d,g,u,x,A,H,K,M,R,O,P,Z,da,na){var qa=this.elements;qa[0]=a;qa[4]=c;qa[8]=d;qa[12]=g;qa[1]=u;qa[5]=x;qa[9]=A;qa[13]=H;qa[2]=K;qa[6]=M;qa[10]=R;qa[14]=O;qa[3]=P;qa[7]=Z;qa[11]=da;qa[15]=na;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new y).fromArray(this.elements)},copy:function(a){for(var c=0;16>c;c++)this.elements[c]=a.elements[c];return this},copyPosition:function(a){var c=
this.elements;a=a.elements;c[12]=a[12];c[13]=a[13];c[14]=a[14];return this},extractBasis:function(a,c,d){a.setFromMatrixColumn(this,0);c.setFromMatrixColumn(this,1);d.setFromMatrixColumn(this,2);return this},makeBasis:function(a,c,d){this.set(a.x,c.x,d.x,0,a.y,c.y,d.y,0,a.z,c.z,d.z,0,0,0,0,1);return this},extractRotation:function(){var a=new r;return function(c){var d=this.elements,g=c.elements,u=1/a.setFromMatrixColumn(c,0).length(),x=1/a.setFromMatrixColumn(c,1).length();c=1/a.setFromMatrixColumn(c,
2).length();d[0]=g[0]*u;d[1]=g[1]*u;d[2]=g[2]*u;d[4]=g[4]*x;d[5]=g[5]*x;d[6]=g[6]*x;d[8]=g[8]*c;d[9]=g[9]*c;d[10]=g[10]*c;return this}}(),makeRotationFromEuler:function(a){!1===(a&&a.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=this.elements,d=a.x,g=a.y,u=a.z,x=Math.cos(d);d=Math.sin(d);var A=Math.cos(g);g=Math.sin(g);var H=Math.cos(u);u=Math.sin(u);if("XYZ"===a.order){a=x*H;var K=x*u,M=d*H,R=d*u;c[0]=A*H;c[4]=
-A*u;c[8]=g;c[1]=K+M*g;c[5]=a-R*g;c[9]=-d*A;c[2]=R-a*g;c[6]=M+K*g;c[10]=x*A}else"YXZ"===a.order?(a=A*H,K=A*u,M=g*H,R=g*u,c[0]=a+R*d,c[4]=M*d-K,c[8]=x*g,c[1]=x*u,c[5]=x*H,c[9]=-d,c[2]=K*d-M,c[6]=R+a*d,c[10]=x*A):"ZXY"===a.order?(a=A*H,K=A*u,M=g*H,R=g*u,c[0]=a-R*d,c[4]=-x*u,c[8]=M+K*d,c[1]=K+M*d,c[5]=x*H,c[9]=R-a*d,c[2]=-x*g,c[6]=d,c[10]=x*A):"ZYX"===a.order?(a=x*H,K=x*u,M=d*H,R=d*u,c[0]=A*H,c[4]=M*g-K,c[8]=a*g+R,c[1]=A*u,c[5]=R*g+a,c[9]=K*g-M,c[2]=-g,c[6]=d*A,c[10]=x*A):"YZX"===a.order?(a=x*A,K=x*
g,M=d*A,R=d*g,c[0]=A*H,c[4]=R-a*u,c[8]=M*u+K,c[1]=u,c[5]=x*H,c[9]=-d*H,c[2]=-g*H,c[6]=K*u+M,c[10]=a-R*u):"XZY"===a.order&&(a=x*A,K=x*g,M=d*A,R=d*g,c[0]=A*H,c[4]=-u,c[8]=g*H,c[1]=a*u+R,c[5]=x*H,c[9]=K*u-M,c[2]=M*u-K,c[6]=d*H,c[10]=R*u+a);c[3]=0;c[7]=0;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this},makeRotationFromQuaternion:function(a){var c=this.elements,d=a.x,g=a.y,u=a.z,x=a.w,A=d+d,H=g+g,K=u+u;a=d*A;var M=d*H;d*=K;var R=g*H;g*=K;u*=K;A*=x;H*=x;x*=K;c[0]=1-(R+u);c[4]=M-x;c[8]=d+H;c[1]=M+x;
c[5]=1-(a+u);c[9]=g-A;c[2]=d-H;c[6]=g+A;c[10]=1-(a+R);c[3]=0;c[7]=0;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return this},lookAt:function(){var a=new r,c=new r,d=new r;return function(g,u,x){var A=this.elements;d.subVectors(g,u).normalize();0===d.lengthSq()&&(d.z=1);a.crossVectors(x,d).normalize();0===a.lengthSq()&&(d.z+=1E-4,a.crossVectors(x,d).normalize());c.crossVectors(d,a);A[0]=a.x;A[4]=c.x;A[8]=d.x;A[1]=a.y;A[5]=c.y;A[9]=d.y;A[2]=a.z;A[6]=c.z;A[10]=d.z;return this}}(),multiply:function(a,c){return void 0!==
c?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,c)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,c){var d=a.elements,g=c.elements;c=this.elements;a=d[0];var u=d[4],x=d[8],A=d[12],H=d[1],K=d[5],M=d[9],R=d[13],O=d[2],P=d[6],Z=d[10],da=d[14],na=d[3],qa=d[7],sa=d[11];d=d[15];var ba=g[0],oa=g[4],la=g[8],wa=g[12],ya=g[1],Ca=g[5],Ja=g[9],
Pa=g[13],Na=g[2],Ta=g[6],Qa=g[10],Xa=g[14],hb=g[3],Ua=g[7],Ma=g[11];g=g[15];c[0]=a*ba+u*ya+x*Na+A*hb;c[4]=a*oa+u*Ca+x*Ta+A*Ua;c[8]=a*la+u*Ja+x*Qa+A*Ma;c[12]=a*wa+u*Pa+x*Xa+A*g;c[1]=H*ba+K*ya+M*Na+R*hb;c[5]=H*oa+K*Ca+M*Ta+R*Ua;c[9]=H*la+K*Ja+M*Qa+R*Ma;c[13]=H*wa+K*Pa+M*Xa+R*g;c[2]=O*ba+P*ya+Z*Na+da*hb;c[6]=O*oa+P*Ca+Z*Ta+da*Ua;c[10]=O*la+P*Ja+Z*Qa+da*Ma;c[14]=O*wa+P*Pa+Z*Xa+da*g;c[3]=na*ba+qa*ya+sa*Na+d*hb;c[7]=na*oa+qa*Ca+sa*Ta+d*Ua;c[11]=na*la+qa*Ja+sa*Qa+d*Ma;c[15]=na*wa+qa*Pa+sa*Xa+d*g;return this},
multiplyToArray:function(a,c,d){var g=this.elements;this.multiplyMatrices(a,c);d[0]=g[0];d[1]=g[1];d[2]=g[2];d[3]=g[3];d[4]=g[4];d[5]=g[5];d[6]=g[6];d[7]=g[7];d[8]=g[8];d[9]=g[9];d[10]=g[10];d[11]=g[11];d[12]=g[12];d[13]=g[13];d[14]=g[14];d[15]=g[15];return this},multiplyScalar:function(a){var c=this.elements;c[0]*=a;c[4]*=a;c[8]*=a;c[12]*=a;c[1]*=a;c[5]*=a;c[9]*=a;c[13]*=a;c[2]*=a;c[6]*=a;c[10]*=a;c[14]*=a;c[3]*=a;c[7]*=a;c[11]*=a;c[15]*=a;return this},applyToBufferAttribute:function(){var a=new r;
return function(c){for(var d=0,g=c.count;d<g;d++)a.x=c.getX(d),a.y=c.getY(d),a.z=c.getZ(d),a.applyMatrix4(this),c.setXYZ(d,a.x,a.y,a.z);return c}}(),determinant:function(){var a=this.elements,c=a[0],d=a[4],g=a[8],u=a[12],x=a[1],A=a[5],H=a[9],K=a[13],M=a[2],R=a[6],O=a[10],P=a[14];return a[3]*(+u*H*R-g*K*R-u*A*O+d*K*O+g*A*P-d*H*P)+a[7]*(+c*H*P-c*K*O+u*x*O-g*x*P+g*K*M-u*H*M)+a[11]*(+c*K*R-c*A*P-u*x*R+d*x*P+u*A*M-d*K*M)+a[15]*(-g*A*M-c*H*R+c*A*O+g*x*R-d*x*O+d*H*M)},transpose:function(){var a=this.elements;
var c=a[1];a[1]=a[4];a[4]=c;c=a[2];a[2]=a[8];a[8]=c;c=a[6];a[6]=a[9];a[9]=c;c=a[3];a[3]=a[12];a[12]=c;c=a[7];a[7]=a[13];a[13]=c;c=a[11];a[11]=a[14];a[14]=c;return this},setPosition:function(a){var c=this.elements;c[12]=a.x;c[13]=a.y;c[14]=a.z;return this},getInverse:function(a,c){var d=this.elements,g=a.elements;a=g[0];var u=g[1],x=g[2],A=g[3],H=g[4],K=g[5],M=g[6],R=g[7],O=g[8],P=g[9],Z=g[10],da=g[11],na=g[12],qa=g[13],sa=g[14];g=g[15];var ba=P*sa*R-qa*Z*R+qa*M*da-K*sa*da-P*M*g+K*Z*g,oa=na*Z*R-O*
sa*R-na*M*da+H*sa*da+O*M*g-H*Z*g,la=O*qa*R-na*P*R+na*K*da-H*qa*da-O*K*g+H*P*g,wa=na*P*M-O*qa*M-na*K*Z+H*qa*Z+O*K*sa-H*P*sa,ya=a*ba+u*oa+x*la+A*wa;if(0===ya){if(!0===c)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}c=1/ya;d[0]=ba*c;d[1]=(qa*Z*A-P*sa*A-qa*x*da+u*sa*da+P*x*g-u*Z*g)*c;d[2]=(K*sa*A-qa*M*A+qa*x*R-u*sa*R-K*x*g+u*M*g)*c;d[3]=(P*M*A-K*Z*A-P*x*R+u*Z*R+K*
x*da-u*M*da)*c;d[4]=oa*c;d[5]=(O*sa*A-na*Z*A+na*x*da-a*sa*da-O*x*g+a*Z*g)*c;d[6]=(na*M*A-H*sa*A-na*x*R+a*sa*R+H*x*g-a*M*g)*c;d[7]=(H*Z*A-O*M*A+O*x*R-a*Z*R-H*x*da+a*M*da)*c;d[8]=la*c;d[9]=(na*P*A-O*qa*A-na*u*da+a*qa*da+O*u*g-a*P*g)*c;d[10]=(H*qa*A-na*K*A+na*u*R-a*qa*R-H*u*g+a*K*g)*c;d[11]=(O*K*A-H*P*A-O*u*R+a*P*R+H*u*da-a*K*da)*c;d[12]=wa*c;d[13]=(O*qa*x-na*P*x+na*u*Z-a*qa*Z-O*u*sa+a*P*sa)*c;d[14]=(na*K*x-H*qa*x-na*u*M+a*qa*M+H*u*sa-a*K*sa)*c;d[15]=(H*P*x-O*K*x+O*u*M-a*P*M-H*u*Z+a*K*Z)*c;return this},
scale:function(a){var c=this.elements,d=a.x,g=a.y;a=a.z;c[0]*=d;c[4]*=g;c[8]*=a;c[1]*=d;c[5]*=g;c[9]*=a;c[2]*=d;c[6]*=g;c[10]*=a;c[3]*=d;c[7]*=g;c[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,c,d){this.set(1,0,0,a,0,1,0,c,0,0,1,d,0,0,0,1);return this},makeRotationX:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,
c,-a,0,0,a,c,0,0,0,0,1);return this},makeRotationY:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(c,0,a,0,0,1,0,0,-a,0,c,0,0,0,0,1);return this},makeRotationZ:function(a){var c=Math.cos(a);a=Math.sin(a);this.set(c,-a,0,0,a,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,c){var d=Math.cos(c);c=Math.sin(c);var g=1-d,u=a.x,x=a.y;a=a.z;var A=g*u,H=g*x;this.set(A*u+d,A*x-c*a,A*a+c*x,0,A*x+c*a,H*x+d,H*a-c*u,0,A*a-c*x,H*a+c*u,g*a*a+d,0,0,0,0,1);return this},makeScale:function(a,c,d){this.set(a,
0,0,0,0,c,0,0,0,0,d,0,0,0,0,1);return this},makeShear:function(a,c,d){this.set(1,c,d,0,a,1,d,0,a,c,1,0,0,0,0,1);return this},compose:function(a,c,d){this.makeRotationFromQuaternion(c);this.scale(d);this.setPosition(a);return this},decompose:function(){var a=new r,c=new y;return function(d,g,u){var x=this.elements,A=a.set(x[0],x[1],x[2]).length(),H=a.set(x[4],x[5],x[6]).length(),K=a.set(x[8],x[9],x[10]).length();0>this.determinant()&&(A=-A);d.x=x[12];d.y=x[13];d.z=x[14];for(d=0;16>d;d++)c.elements[d]=
this.elements[d];d=1/A;x=1/H;var M=1/K;c.elements[0]*=d;c.elements[1]*=d;c.elements[2]*=d;c.elements[4]*=x;c.elements[5]*=x;c.elements[6]*=x;c.elements[8]*=M;c.elements[9]*=M;c.elements[10]*=M;g.setFromRotationMatrix(c);u.x=A;u.y=H;u.z=K;return this}}(),makePerspective:function(a,c,d,g,u,x){void 0===x&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var A=this.elements;A[0]=2*u/(c-a);A[4]=0;A[8]=(c+a)/(c-a);A[12]=0;A[1]=0;A[5]=2*
u/(d-g);A[9]=(d+g)/(d-g);A[13]=0;A[2]=0;A[6]=0;A[10]=-(x+u)/(x-u);A[14]=-2*x*u/(x-u);A[3]=0;A[7]=0;A[11]=-1;A[15]=0;return this},makeOrthographic:function(a,c,d,g,u,x){var A=this.elements,H=1/(c-a),K=1/(d-g),M=1/(x-u);A[0]=2*H;A[4]=0;A[8]=0;A[12]=-((c+a)*H);A[1]=0;A[5]=2*K;A[9]=0;A[13]=-((d+g)*K);A[2]=0;A[6]=0;A[10]=-2*M;A[14]=-((x+u)*M);A[3]=0;A[7]=0;A[11]=0;A[15]=1;return this},equals:function(a){var c=this.elements;a=a.elements;for(var d=0;16>d;d++)if(c[d]!==a[d])return!1;return!0},fromArray:function(a,
c){void 0===c&&(c=0);for(var d=0;16>d;d++)this.elements[d]=a[d+c];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);var d=this.elements;a[c]=d[0];a[c+1]=d[1];a[c+2]=d[2];a[c+3]=d[3];a[c+4]=d[4];a[c+5]=d[5];a[c+6]=d[6];a[c+7]=d[7];a[c+8]=d[8];a[c+9]=d[9];a[c+10]=d[10];a[c+11]=d[11];a[c+12]=d[12];a[c+13]=d[13];a[c+14]=d[14];a[c+15]=d[15];return a}});z.prototype=Object.create(e.prototype);z.prototype.constructor=z;z.prototype.isCubeTexture=!0;Object.defineProperty(z.prototype,"images",
{get:function(){return this.image},set:function(a){this.image=a}});var vg=new e,wg=new z,sg=[],tg=[],ug=new Float32Array(16);ca.prototype.setValue=function(a,c){for(var d=this.seq,g=0,u=d.length;g!==u;++g){var x=d[g];x.setValue(a,c[x.id])}};var Pf=/([\w\d_]+)(\])?(\[|\.)?/g;pa.prototype.setValue=function(a,c,d){c=this.map[c];void 0!==c&&c.setValue(a,d,this.renderer)};pa.prototype.set=function(a,c,d){var g=this.map[d];void 0!==g&&g.setValue(a,c[d],this.renderer)};pa.prototype.setOptional=function(a,
c,d){c=c[d];void 0!==c&&this.setValue(a,d,c)};pa.upload=function(a,c,d,g){for(var u=0,x=c.length;u!==x;++u){var A=c[u],H=d[A.id];!1!==H.needsUpdate&&A.setValue(a,H.value,g)}};pa.seqWithValue=function(a,c){for(var d=[],g=0,u=a.length;g!==u;++g){var x=a[g];x.id in c&&d.push(x)}return d};var nc={merge:function(a){for(var c={},d=0;d<a.length;d++){var g=this.clone(a[d]),u;for(u in g)c[u]=g[u]}return c},clone:function(a){var c={},d;for(d in a){c[d]={};for(var g in a[d]){var u=a[d][g];u&&(u.isColor||u.isMatrix3||
u.isMatrix4||u.isVector2||u.isVector3||u.isVector4||u.isTexture)?c[d][g]=u.clone():Array.isArray(u)?c[d][g]=u.slice():c[d][g]=u}}return c}},Mb={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",
color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",
gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n\t}\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 matDiffColor = material.diffuseColor;\n\t\tvec3 matSpecColor = material.specularColor;\n\t\tvec3 lightColor   = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 spec = Rect_Area_Light_Specular_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n\t\t\t\troughness,\n\t\t\t\tltcMat, ltcMag );\n\t\tvec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n\t\t\t\tgeometry,\n\t\t\t\trectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n\t\treflectedLight.directSpecular += lightColor * matSpecColor * spec;\n\t\treflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",
meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",
normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"},$g={aliceblue:15792383,antiquewhite:16444375,
aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,
darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,
indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,
maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,
papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,
white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(ka.prototype,{isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,c,d){this.r=a;this.g=c;this.b=d;return this},setHSL:function(){function a(c,
d,g){0>g&&(g+=1);1<g&&--g;return g<1/6?c+6*(d-c)*g:.5>g?d:g<2/3?c+6*(d-c)*(2/3-g):c}return function(c,d,g){c=xb.euclideanModulo(c,1);d=xb.clamp(d,0,1);g=xb.clamp(g,0,1);0===d?this.r=this.g=this.b=g:(d=.5>=g?g*(1+d):g+d-g*d,g=2*g-d,this.r=a(g,d,c+1/3),this.g=a(g,d,c),this.b=a(g,d,c-1/3));return this}}(),setStyle:function(a){function c(A){void 0!==A&&1>parseFloat(A)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var d;if(d=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var g=d[2];
switch(d[1]){case "rgb":case "rgba":if(d=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=Math.min(255,parseInt(d[1],10))/255,this.g=Math.min(255,parseInt(d[2],10))/255,this.b=Math.min(255,parseInt(d[3],10))/255,c(d[5]),this;if(d=/^(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(d[1],10))/100,this.g=Math.min(100,parseInt(d[2],10))/100,this.b=Math.min(100,parseInt(d[3],10))/100,c(d[5]),this;break;case "hsl":case "hsla":if(d=
/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g)){g=parseFloat(d[1])/360;var u=parseInt(d[2],10)/100,x=parseInt(d[3],10)/100;c(d[5]);return this.setHSL(g,u,x)}}}else if(d=/^#([A-Fa-f0-9]+)$/.exec(a)){d=d[1];g=d.length;if(3===g)return this.r=parseInt(d.charAt(0)+d.charAt(0),16)/255,this.g=parseInt(d.charAt(1)+d.charAt(1),16)/255,this.b=parseInt(d.charAt(2)+d.charAt(2),16)/255,this;if(6===g)return this.r=parseInt(d.charAt(0)+d.charAt(1),16)/255,this.g=parseInt(d.charAt(2)+
d.charAt(3),16)/255,this.b=parseInt(d.charAt(4)+d.charAt(5),16)/255,this}a&&0<a.length&&(d=$g[a],void 0!==d?this.setHex(d):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,c){void 0===c&&(c=2);this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},copyLinearToGamma:function(a,c){void 0===c&&(c=2);c=0<c?
1/c:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},convertGammaToLinear:function(){var a=this.r,c=this.g,d=this.b;this.r=a*a;this.g=c*c;this.b=d*d;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};
var c=this.r,d=this.g,g=this.b,u=Math.max(c,d,g),x=Math.min(c,d,g),A,H=(x+u)/2;if(x===u)x=A=0;else{var K=u-x;x=.5>=H?K/(u+x):K/(2-u-x);switch(u){case c:A=(d-g)/K+(d<g?6:0);break;case d:A=(g-c)/K+2;break;case g:A=(c-d)/K+4}A/=6}a.h=A;a.s=x;a.l=H;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,c,d){var g=this.getHSL();g.h+=a;g.s+=c;g.l+=d;this.setHSL(g.h,g.s,g.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;
return this},addColors:function(a,c){this.r=a.r+c.r;this.g=a.g+c.g;this.b=a.b+c.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,c){this.r+=(a.r-this.r)*c;this.g+=(a.g-this.g)*c;this.b+=(a.b-this.b)*
c;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,c){void 0===c&&(c=0);this.r=a[c];this.g=a[c+1];this.b=a[c+2];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this.r;a[c+1]=this.g;a[c+2]=this.b;return a},toJSON:function(){return this.getHex()}});va.prototype=Object.create(e.prototype);va.prototype.constructor=va;va.prototype.isDataTexture=!0;var Ab={common:{diffuse:{value:new ka(15658734)},opacity:{value:1},map:{value:null},
offsetRepeat:{value:new p(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new k(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},
displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new ka(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},
position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},
position:{},width:{},height:{}}}},points:{diffuse:{value:new ka(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new p(0,0,1,1)}}},dd={basic:{uniforms:nc.merge([Ab.common,Ab.aomap,Ab.lightmap,Ab.fog]),vertexShader:Mb.meshbasic_vert,fragmentShader:Mb.meshbasic_frag},lambert:{uniforms:nc.merge([Ab.common,Ab.aomap,Ab.lightmap,Ab.emissivemap,Ab.fog,Ab.lights,{emissive:{value:new ka(0)}}]),vertexShader:Mb.meshlambert_vert,fragmentShader:Mb.meshlambert_frag},
phong:{uniforms:nc.merge([Ab.common,Ab.aomap,Ab.lightmap,Ab.emissivemap,Ab.bumpmap,Ab.normalmap,Ab.displacementmap,Ab.gradientmap,Ab.fog,Ab.lights,{emissive:{value:new ka(0)},specular:{value:new ka(1118481)},shininess:{value:30}}]),vertexShader:Mb.meshphong_vert,fragmentShader:Mb.meshphong_frag},standard:{uniforms:nc.merge([Ab.common,Ab.aomap,Ab.lightmap,Ab.emissivemap,Ab.bumpmap,Ab.normalmap,Ab.displacementmap,Ab.roughnessmap,Ab.metalnessmap,Ab.fog,Ab.lights,{emissive:{value:new ka(0)},roughness:{value:.5},
metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Mb.meshphysical_vert,fragmentShader:Mb.meshphysical_frag},points:{uniforms:nc.merge([Ab.points,Ab.fog]),vertexShader:Mb.points_vert,fragmentShader:Mb.points_frag},dashed:{uniforms:nc.merge([Ab.common,Ab.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mb.linedashed_vert,fragmentShader:Mb.linedashed_frag},depth:{uniforms:nc.merge([Ab.common,Ab.displacementmap]),vertexShader:Mb.depth_vert,fragmentShader:Mb.depth_frag},
normal:{uniforms:nc.merge([Ab.common,Ab.bumpmap,Ab.normalmap,Ab.displacementmap,{opacity:{value:1}}]),vertexShader:Mb.normal_vert,fragmentShader:Mb.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Mb.cube_vert,fragmentShader:Mb.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Mb.equirect_vert,fragmentShader:Mb.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new r}},vertexShader:Mb.distanceRGBA_vert,fragmentShader:Mb.distanceRGBA_frag}};
dd.physical={uniforms:nc.merge([dd.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Mb.meshphysical_vert,fragmentShader:Mb.meshphysical_frag};Object.assign(Aa.prototype,{set:function(a,c){this.min.copy(a);this.max.copy(c);return this},setFromPoints:function(a){this.makeEmpty();for(var c=0,d=a.length;c<d;c++)this.expandByPoint(a[c]);return this},setFromCenterAndSize:function(){var a=new k;return function(c,d){d=a.copy(d).multiplyScalar(.5);this.min.copy(c).sub(d);
this.max.copy(c).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){a=a||new k;return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new k;return this.isEmpty()?
a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,
c){return(c||new k).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,c){return(c||new k).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new k;return function(c){return a.copy(c).clamp(this.min,this.max).sub(c).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});var Qg=0;Object.defineProperty(Za.prototype,"needsUpdate",{get:function(){return this._needsUpdate},set:function(a){!0===a&&this.update();this._needsUpdate=a}});Object.assign(Za.prototype,h.prototype,{isMaterial:!0,setValues:function(a){if(void 0!==a)for(var c in a){var d=a[c];if(void 0===d)console.warn("THREE.Material: '"+
c+"' parameter is undefined.");else{var g=this[c];void 0===g?console.warn("THREE."+this.type+": '"+c+"' is not a property of this material."):g&&g.isColor?g.set(d):g&&g.isVector3&&d&&d.isVector3?g.copy(d):this[c]="overdraw"===c?Number(d):d}}},toJSON:function(a){function c(u){var x=[],A;for(A in u){var H=u[A];delete H.metadata;x.push(H)}return x}var d=void 0===a;d&&(a={textures:{},images:{}});var g={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};g.uuid=this.uuid;g.type=this.type;
""!==this.name&&(g.name=this.name);this.color&&this.color.isColor&&(g.color=this.color.getHex());void 0!==this.roughness&&(g.roughness=this.roughness);void 0!==this.metalness&&(g.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(g.emissive=this.emissive.getHex());this.specular&&this.specular.isColor&&(g.specular=this.specular.getHex());void 0!==this.shininess&&(g.shininess=this.shininess);void 0!==this.clearCoat&&(g.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(g.clearCoatRoughness=
this.clearCoatRoughness);this.map&&this.map.isTexture&&(g.map=this.map.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(g.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(g.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap&&this.bumpMap.isTexture&&(g.bumpMap=this.bumpMap.toJSON(a).uuid,g.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(g.normalMap=this.normalMap.toJSON(a).uuid,g.normalScale=this.normalScale.toArray());this.displacementMap&&
this.displacementMap.isTexture&&(g.displacementMap=this.displacementMap.toJSON(a).uuid,g.displacementScale=this.displacementScale,g.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(g.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(g.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(g.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&
(g.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(g.envMap=this.envMap.toJSON(a).uuid,g.reflectivity=this.reflectivity);this.gradientMap&&this.gradientMap.isTexture&&(g.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.size&&(g.size=this.size);void 0!==this.sizeAttenuation&&(g.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(g.blending=this.blending);2!==this.shading&&(g.shading=this.shading);0!==this.side&&(g.side=this.side);0!==this.vertexColors&&
(g.vertexColors=this.vertexColors);1>this.opacity&&(g.opacity=this.opacity);!0===this.transparent&&(g.transparent=this.transparent);g.depthFunc=this.depthFunc;g.depthTest=this.depthTest;g.depthWrite=this.depthWrite;0<this.alphaTest&&(g.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(g.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(g.wireframe=this.wireframe);1<this.wireframeLinewidth&&(g.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(g.wireframeLinecap=
this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(g.wireframeLinejoin=this.wireframeLinejoin);g.skinning=this.skinning;g.morphTargets=this.morphTargets;d&&(d=c(a.textures),a=c(a.images),0<d.length&&(g.textures=d),0<a.length&&(g.images=a));return g},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;
this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=
a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;this.clipIntersection=a.clipIntersection;a=a.clippingPlanes;var c=null;if(null!==a){var d=a.length;c=Array(d);for(var g=0;g!==d;++g)c[g]=a[g].clone()}this.clippingPlanes=c;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}});kb.prototype=Object.create(Za.prototype);kb.prototype.constructor=
kb;kb.prototype.isShaderMaterial=!0;kb.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=nc.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};kb.prototype.toJSON=function(a){a=
Za.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};Hb.prototype=Object.create(Za.prototype);Hb.prototype.constructor=Hb;Hb.prototype.isMeshDepthMaterial=!0;Hb.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;
this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};Object.assign(vb.prototype,{isBox3:!0,set:function(a,c){this.min.copy(a);this.max.copy(c);return this},setFromArray:function(a){for(var c=Infinity,d=Infinity,g=Infinity,u=-Infinity,x=-Infinity,A=-Infinity,H=0,K=a.length;H<K;H+=3){var M=a[H],R=a[H+1],O=a[H+2];M<c&&(c=M);R<d&&(d=R);O<g&&(g=O);M>u&&(u=M);R>x&&(x=R);O>A&&(A=O)}this.min.set(c,d,g);this.max.set(u,x,A);return this},
setFromBufferAttribute:function(a){for(var c=Infinity,d=Infinity,g=Infinity,u=-Infinity,x=-Infinity,A=-Infinity,H=0,K=a.count;H<K;H++){var M=a.getX(H),R=a.getY(H),O=a.getZ(H);M<c&&(c=M);R<d&&(d=R);O<g&&(g=O);M>u&&(u=M);R>x&&(x=R);O>A&&(A=O)}this.min.set(c,d,g);this.max.set(u,x,A);return this},setFromPoints:function(a){this.makeEmpty();for(var c=0,d=a.length;c<d;c++)this.expandByPoint(a[c]);return this},setFromCenterAndSize:function(){var a=new r;return function(c,d){d=a.copy(d).multiplyScalar(.5);
this.min.copy(c).sub(d);this.max.copy(c).add(d);return this}}(),setFromObject:function(a){this.makeEmpty();return this.expandByObject(a)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){a=
a||new r;return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new r;return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},expandByObject:function(){var a=new r;return function(c){var d=this;c.updateMatrixWorld(!0);
c.traverse(function(g){var u;var x=g.geometry;if(void 0!==x)if(x.isGeometry){var A=x.vertices;x=0;for(u=A.length;x<u;x++)a.copy(A[x]),a.applyMatrix4(g.matrixWorld),d.expandByPoint(a)}else if(x.isBufferGeometry&&(A=x.attributes.position,void 0!==A))for(x=0,u=A.count;x<u;x++)a.fromBufferAttribute(A,x).applyMatrix4(g.matrixWorld),d.expandByPoint(a)});return this}}(),containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},
containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,c){return(c||new r).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a=
new r;return function(c){this.clampPoint(c.center,a);return a.distanceToSquared(c.center)<=c.radius*c.radius}}(),intersectsPlane:function(a){if(0<a.normal.x){var c=a.normal.x*this.min.x;var d=a.normal.x*this.max.x}else c=a.normal.x*this.max.x,d=a.normal.x*this.min.x;0<a.normal.y?(c+=a.normal.y*this.min.y,d+=a.normal.y*this.max.y):(c+=a.normal.y*this.max.y,d+=a.normal.y*this.min.y);0<a.normal.z?(c+=a.normal.z*this.min.z,d+=a.normal.z*this.max.z):(c+=a.normal.z*this.max.z,d+=a.normal.z*this.min.z);
return c<=a.constant&&d>=a.constant},clampPoint:function(a,c){return(c||new r).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new r;return function(c){return a.copy(c).clamp(this.min,this.max).sub(c).length()}}(),getBoundingSphere:function(){var a=new r;return function(c){c=c||new Nb;this.getCenter(c.center);c.radius=.5*this.getSize(a).length();return c}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);
this.max.max(a.max);return this},applyMatrix4:function(){var a=[new r,new r,new r,new r,new r,new r,new r,new r];return function(c){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(c);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(c);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(c);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(c);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(c);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(c);
a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(c);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(c);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}});Object.assign(Nb.prototype,{set:function(a,c){this.center.copy(a);this.radius=c;return this},setFromPoints:function(){var a=new vb;return function(c,d){var g=this.center;void 0!==d?g.copy(d):a.setFromPoints(c).getCenter(g);
for(var u=d=0,x=c.length;u<x;u++)d=Math.max(d,g.distanceToSquared(c[u]));this.radius=Math.sqrt(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var c=this.radius+
a.radius;return a.center.distanceToSquared(this.center)<=c*c},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,c){var d=this.center.distanceToSquared(a);c=c||new r;c.copy(a);d>this.radius*this.radius&&(c.sub(this.center).normalize(),c.multiplyScalar(this.radius).add(this.center));return c},getBoundingBox:function(a){a=a||new vb;a.set(this.center,this.center);a.expandByScalar(this.radius);
return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}});Object.assign(Pb.prototype,{isMatrix3:!0,set:function(a,c,d,g,u,x,A,H,K){var M=this.elements;M[0]=a;M[1]=g;M[2]=A;M[3]=c;M[4]=u;M[5]=H;M[6]=d;M[7]=x;M[8]=K;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},
copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]);return this},applyToBufferAttribute:function(){var a=new r;return function(c){for(var d=0,g=c.count;d<g;d++)a.x=c.getX(d),a.y=c.getY(d),a.z=c.getZ(d),a.applyMatrix3(this),c.setXYZ(d,a.x,a.y,a.z);return c}}(),multiplyScalar:function(a){var c=this.elements;c[0]*=a;c[3]*=a;c[6]*=a;c[1]*=a;c[4]*=a;c[7]*=a;c[2]*=
a;c[5]*=a;c[8]*=a;return this},determinant:function(){var a=this.elements,c=a[0],d=a[1],g=a[2],u=a[3],x=a[4],A=a[5],H=a[6],K=a[7];a=a[8];return c*x*a-c*A*K-d*u*a+d*A*H+g*u*K-g*x*H},getInverse:function(a,c){a&&a.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var d=a.elements;a=this.elements;var g=d[0],u=d[1],x=d[2],A=d[3],H=d[4],K=d[5],M=d[6],R=d[7];d=d[8];var O=d*H-K*R,P=K*M-d*A,Z=R*A-H*M,da=g*O+u*P+x*Z;if(0===da){if(!0===c)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");
console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}c=1/da;a[0]=O*c;a[1]=(x*R-d*u)*c;a[2]=(K*u-x*H)*c;a[3]=P*c;a[4]=(d*g-x*M)*c;a[5]=(x*A-K*g)*c;a[6]=Z*c;a[7]=(u*M-R*g)*c;a[8]=(H*g-u*A)*c;return this},transpose:function(){var a=this.elements;var c=a[1];a[1]=a[3];a[3]=c;c=a[2];a[2]=a[6];a[6]=c;c=a[5];a[5]=a[7];a[7]=c;return this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var c=
this.elements;a[0]=c[0];a[1]=c[3];a[2]=c[6];a[3]=c[1];a[4]=c[4];a[5]=c[7];a[6]=c[2];a[7]=c[5];a[8]=c[8];return this},fromArray:function(a,c){void 0===c&&(c=0);for(var d=0;9>d;d++)this.elements[d]=a[d+c];return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);var d=this.elements;a[c]=d[0];a[c+1]=d[1];a[c+2]=d[2];a[c+3]=d[3];a[c+4]=d[4];a[c+5]=d[5];a[c+6]=d[6];a[c+7]=d[7];a[c+8]=d[8];return a}});Object.assign(Sb.prototype,{set:function(a,c){this.normal.copy(a);this.constant=c;return this},
setComponents:function(a,c,d,g){this.normal.set(a,c,d);this.constant=g;return this},setFromNormalAndCoplanarPoint:function(a,c){this.normal.copy(a);this.constant=-c.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new r,c=new r;return function(d,g,u){g=a.subVectors(u,g).cross(c.subVectors(d,g)).normalize();this.setFromNormalAndCoplanarPoint(g,d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;
return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,c){return this.orthoPoint(a,c).sub(a).negate()},orthoPoint:function(a,c){a=this.distanceToPoint(a);return(c||new r).copy(this.normal).multiplyScalar(a)},
intersectLine:function(){var a=new r;return function(c,d){d=d||new r;var g=c.delta(a),u=this.normal.dot(g);if(0===u){if(0===this.distanceToPoint(c.start))return d.copy(c.start)}else if(u=-(c.start.dot(this.normal)+this.constant)/u,!(0>u||1<u))return d.copy(g).multiplyScalar(u).add(c.start)}}(),intersectsLine:function(a){var c=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>c&&0<a||0>a&&0<c},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},
coplanarPoint:function(a){return(a||new r).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new r,c=new Pb;return function(d,g){var u=this.coplanarPoint(a).applyMatrix4(d);d=g||c.getNormalMatrix(d);d=this.normal.applyMatrix3(d).normalize();this.constant=-u.dot(d);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}});Object.assign(bd.prototype,{set:function(a,
c,d,g,u,x){var A=this.planes;A[0].copy(a);A[1].copy(c);A[2].copy(d);A[3].copy(g);A[4].copy(u);A[5].copy(x);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var c=this.planes,d=0;6>d;d++)c[d].copy(a.planes[d]);return this},setFromMatrix:function(a){var c=this.planes,d=a.elements;a=d[0];var g=d[1],u=d[2],x=d[3],A=d[4],H=d[5],K=d[6],M=d[7],R=d[8],O=d[9],P=d[10],Z=d[11],da=d[12],na=d[13],qa=d[14];d=d[15];c[0].setComponents(x-a,M-A,Z-R,d-da).normalize();c[1].setComponents(x+
a,M+A,Z+R,d+da).normalize();c[2].setComponents(x+g,M+H,Z+O,d+na).normalize();c[3].setComponents(x-g,M-H,Z-O,d-na).normalize();c[4].setComponents(x-u,M-K,Z-P,d-qa).normalize();c[5].setComponents(x+u,M+K,Z+P,d+qa).normalize();return this},intersectsObject:function(){var a=new Nb;return function(c){var d=c.geometry;null===d.boundingSphere&&d.computeBoundingSphere();a.copy(d.boundingSphere).applyMatrix4(c.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new Nb;return function(c){a.center.set(0,
0,0);a.radius=.7071067811865476;a.applyMatrix4(c.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var c=this.planes,d=a.center;a=-a.radius;for(var g=0;6>g;g++)if(c[g].distanceToPoint(d)<a)return!1;return!0},intersectsBox:function(){var a=new r,c=new r;return function(d){for(var g=this.planes,u=0;6>u;u++){var x=g[u];a.x=0<x.normal.x?d.min.x:d.max.x;c.x=0<x.normal.x?d.max.x:d.min.x;a.y=0<x.normal.y?d.min.y:d.max.y;c.y=0<x.normal.y?d.max.y:d.min.y;a.z=0<x.normal.z?d.min.z:
d.max.z;c.z=0<x.normal.z?d.max.z:d.min.z;var A=x.distanceToPoint(a);x=x.distanceToPoint(c);if(0>A&&0>x)return!1}return!0}}(),containsPoint:function(a){for(var c=this.planes,d=0;6>d;d++)if(0>c[d].distanceToPoint(a))return!1;return!0}});Object.assign(sc.prototype,{set:function(a,c){this.origin.copy(a);this.direction.copy(c);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,c){return(c||
new r).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new r;return function(c){this.origin.copy(this.at(c,a));return this}}(),closestPointToPoint:function(a,c){c=c||new r;c.subVectors(a,this.origin);a=c.dot(this.direction);return 0>a?c.copy(this.origin):c.copy(this.direction).multiplyScalar(a).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},
distanceSqToPoint:function(){var a=new r;return function(c){var d=a.subVectors(c,this.origin).dot(this.direction);if(0>d)return this.origin.distanceToSquared(c);a.copy(this.direction).multiplyScalar(d).add(this.origin);return a.distanceToSquared(c)}}(),distanceSqToSegment:function(){var a=new r,c=new r,d=new r;return function(g,u,x,A){a.copy(g).add(u).multiplyScalar(.5);c.copy(u).sub(g).normalize();d.copy(this.origin).sub(a);var H=.5*g.distanceTo(u),K=-this.direction.dot(c),M=d.dot(this.direction),
R=-d.dot(c),O=d.lengthSq(),P=Math.abs(1-K*K);if(0<P){g=K*R-M;u=K*M-R;var Z=H*P;0<=g?u>=-Z?u<=Z?(H=1/P,g*=H,u*=H,K=g*(g+K*u+2*M)+u*(K*g+u+2*R)+O):(u=H,g=Math.max(0,-(K*u+M)),K=-g*g+u*(u+2*R)+O):(u=-H,g=Math.max(0,-(K*u+M)),K=-g*g+u*(u+2*R)+O):u<=-Z?(g=Math.max(0,-(-K*H+M)),u=0<g?-H:Math.min(Math.max(-H,-R),H),K=-g*g+u*(u+2*R)+O):u<=Z?(g=0,u=Math.min(Math.max(-H,-R),H),K=u*(u+2*R)+O):(g=Math.max(0,-(K*H+M)),u=0<g?H:Math.min(Math.max(-H,-R),H),K=-g*g+u*(u+2*R)+O)}else u=0<K?-H:H,g=Math.max(0,-(K*u+M)),
K=-g*g+u*(u+2*R)+O;x&&x.copy(this.direction).multiplyScalar(g).add(this.origin);A&&A.copy(c).multiplyScalar(u).add(a);return K}}(),intersectSphere:function(){var a=new r;return function(c,d){a.subVectors(c.center,this.origin);var g=a.dot(this.direction),u=a.dot(a)-g*g;c=c.radius*c.radius;if(u>c)return null;c=Math.sqrt(c-u);u=g-c;g+=c;return 0>u&&0>g?null:0>u?this.at(g,d):this.at(u,d)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var c=
a.normal.dot(this.direction);if(0===c)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/c;return 0<=a?a:null},intersectPlane:function(a,c){a=this.distanceToPlane(a);return null===a?null:this.at(a,c)},intersectsPlane:function(a){var c=a.distanceToPoint(this.origin);return 0===c||0>a.normal.dot(this.direction)*c?!0:!1},intersectBox:function(a,c){var d=1/this.direction.x;var g=1/this.direction.y;var u=1/this.direction.z,x=this.origin;if(0<=d){var A=(a.min.x-x.x)*
d;d*=a.max.x-x.x}else A=(a.max.x-x.x)*d,d*=a.min.x-x.x;if(0<=g){var H=(a.min.y-x.y)*g;g*=a.max.y-x.y}else H=(a.max.y-x.y)*g,g*=a.min.y-x.y;if(A>g||H>d)return null;if(H>A||A!==A)A=H;if(g<d||d!==d)d=g;0<=u?(H=(a.min.z-x.z)*u,a=(a.max.z-x.z)*u):(H=(a.max.z-x.z)*u,a=(a.min.z-x.z)*u);if(A>a||H>d)return null;if(H>A||A!==A)A=H;if(a<d||d!==d)d=a;return 0>d?null:this.at(0<=A?A:d,c)},intersectsBox:function(){var a=new r;return function(c){return null!==this.intersectBox(c,a)}}(),intersectTriangle:function(){var a=
new r,c=new r,d=new r,g=new r;return function(u,x,A,H,K){c.subVectors(x,u);d.subVectors(A,u);g.crossVectors(c,d);x=this.direction.dot(g);if(0<x){if(H)return null;H=1}else if(0>x)H=-1,x=-x;else return null;a.subVectors(this.origin,u);u=H*this.direction.dot(d.crossVectors(a,d));if(0>u)return null;A=H*this.direction.dot(c.cross(a));if(0>A||u+A>x)return null;u=-H*a.dot(g);return 0>u?null:this.at(u/x,K)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);
this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}});tc.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");tc.DefaultOrder="XYZ";Object.defineProperties(tc.prototype,{x:{get:function(){return this._x},set:function(a){this._x=a;this.onChangeCallback()}},y:{get:function(){return this._y},set:function(a){this._y=a;this.onChangeCallback()}},z:{get:function(){return this._z},set:function(a){this._z=
a;this.onChangeCallback()}},order:{get:function(){return this._order},set:function(a){this._order=a;this.onChangeCallback()}}});Object.assign(tc.prototype,{isEuler:!0,set:function(a,c,d,g){this._x=a;this._y=c;this._z=d;this._order=g||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,
c,d){var g=xb.clamp,u=a.elements;a=u[0];var x=u[4],A=u[8],H=u[1],K=u[5],M=u[9],R=u[2],O=u[6];u=u[10];c=c||this._order;"XYZ"===c?(this._y=Math.asin(g(A,-1,1)),.99999>Math.abs(A)?(this._x=Math.atan2(-M,u),this._z=Math.atan2(-x,a)):(this._x=Math.atan2(O,K),this._z=0)):"YXZ"===c?(this._x=Math.asin(-g(M,-1,1)),.99999>Math.abs(M)?(this._y=Math.atan2(A,u),this._z=Math.atan2(H,K)):(this._y=Math.atan2(-R,a),this._z=0)):"ZXY"===c?(this._x=Math.asin(g(O,-1,1)),.99999>Math.abs(O)?(this._y=Math.atan2(-R,u),this._z=
Math.atan2(-x,K)):(this._y=0,this._z=Math.atan2(H,a))):"ZYX"===c?(this._y=Math.asin(-g(R,-1,1)),.99999>Math.abs(R)?(this._x=Math.atan2(O,u),this._z=Math.atan2(H,a)):(this._x=0,this._z=Math.atan2(-x,K))):"YZX"===c?(this._z=Math.asin(g(H,-1,1)),.99999>Math.abs(H)?(this._x=Math.atan2(-M,K),this._y=Math.atan2(-R,a)):(this._x=0,this._y=Math.atan2(A,u))):"XZY"===c?(this._z=Math.asin(-g(x,-1,1)),.99999>Math.abs(x)?(this._x=Math.atan2(O,K),this._y=Math.atan2(A,a)):(this._x=Math.atan2(-M,u),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+
c);this._order=c;if(!1!==d)this.onChangeCallback();return this},setFromQuaternion:function(){var a=new y;return function(c,d,g){a.makeRotationFromQuaternion(c);return this.setFromRotationMatrix(a,d,g)}}(),setFromVector3:function(a,c){return this.set(a.x,a.y,a.z,c||this._order)},reorder:function(){var a=new t;return function(c){a.setFromEuler(this);return this.setFromQuaternion(a,c)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=
a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,c){void 0===a&&(a=[]);void 0===c&&(c=0);a[c]=this._x;a[c+1]=this._y;a[c+2]=this._z;a[c+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new r(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}});Object.assign(te.prototype,{set:function(a){this.mask=1<<a},enable:function(a){this.mask|=
1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}});var Rg=0;lb.DefaultUp=new r(0,1,0);lb.DefaultMatrixAutoUpdate=!0;Object.assign(lb.prototype,h.prototype,{isObject3D:!0,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,c){this.quaternion.setFromAxisAngle(a,c)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,
!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new t;return function(c,d){a.setFromAxisAngle(c,d);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new r(1,0,0);return function(c){return this.rotateOnAxis(a,c)}}(),rotateY:function(){var a=new r(0,1,0);return function(c){return this.rotateOnAxis(a,c)}}(),rotateZ:function(){var a=new r(0,0,1);return function(c){return this.rotateOnAxis(a,
c)}}(),translateOnAxis:function(){var a=new r;return function(c,d){a.copy(c).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(d));return this}}(),translateX:function(){var a=new r(1,0,0);return function(c){return this.translateOnAxis(a,c)}}(),translateY:function(){var a=new r(0,1,0);return function(c){return this.translateOnAxis(a,c)}}(),translateZ:function(){var a=new r(0,0,1);return function(c){return this.translateOnAxis(a,c)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},
worldToLocal:function(){var a=new y;return function(c){return c.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new y;return function(c){a.lookAt(c,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var c=0;c<arguments.length;c++)this.add(arguments[c]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),
a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var c=0;c<arguments.length;c++)this.remove(arguments[c]);c=this.children.indexOf(a);-1!==c&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(c,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",
a)},getObjectByProperty:function(a,c){if(this[a]===c)return this;for(var d=0,g=this.children.length;d<g;d++){var u=this.children[d].getObjectByProperty(a,c);if(void 0!==u)return u}},getWorldPosition:function(a){a=a||new r;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new r,c=new r;return function(d){d=d||new t;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,d,c);return d}}(),getWorldRotation:function(){var a=new t;return function(c){c=
c||new tc;this.getWorldQuaternion(a);return c.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new r,c=new t;return function(d){d=d||new r;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,d);return d}}(),getWorldDirection:function(){var a=new t;return function(c){c=c||new r;this.getWorldQuaternion(a);return c.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var c=this.children,d=0,g=c.length;d<g;d++)c[d].traverse(a)},traverseVisible:function(a){if(!1!==
this.visible){a(this);for(var c=this.children,d=0,g=c.length;d<g;d++)c[d].traverseVisible(a)}},traverseAncestors:function(a){var c=this.parent;null!==c&&(a(c),c.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,
this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var c=this.children,d=0,g=c.length;d<g;d++)c[d].updateMatrixWorld(a)},toJSON:function(a){function c(H){var K=[],M;for(M in H){var R=H[M];delete R.metadata;K.push(R)}return K}var d=void 0===a||""===a,g={};d&&(a={geometries:{},materials:{},textures:{},images:{}},g.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var u={};u.uuid=this.uuid;u.type=this.type;""!==this.name&&(u.name=this.name);"{}"!==JSON.stringify(this.userData)&&(u.userData=
this.userData);!0===this.castShadow&&(u.castShadow=!0);!0===this.receiveShadow&&(u.receiveShadow=!0);!1===this.visible&&(u.visible=!1);u.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),u.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),u.material=this.material.uuid);if(0<this.children.length){u.children=
[];for(var x=0;x<this.children.length;x++)u.children.push(this.children[x].toJSON(a).object)}if(d){d=c(a.geometries);x=c(a.materials);var A=c(a.textures);a=c(a.images);0<d.length&&(g.geometries=d);0<x.length&&(g.materials=x);0<A.length&&(g.textures=A);0<a.length&&(g.images=a)}g.object=u;return g},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,c){void 0===c&&(c=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);
this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===c)for(c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});Object.assign(ed.prototype,
{set:function(a,c){this.start.copy(a);this.end.copy(c);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){return(a||new r).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new r).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,
c){c=c||new r;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new r,c=new r;return function(d,g){a.subVectors(d,this.start);c.subVectors(this.end,this.start);d=c.dot(c);d=c.dot(a)/d;g&&(d=xb.clamp(d,0,1));return d}}(),closestPointToPoint:function(a,c,d){a=this.closestPointToPointParameter(a,c);d=d||new r;return this.delta(d).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},
equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}});Object.assign(gc,{normal:function(){var a=new r;return function(c,d,g,u){u=u||new r;u.subVectors(g,d);a.subVectors(c,d);u.cross(a);c=u.lengthSq();return 0<c?u.multiplyScalar(1/Math.sqrt(c)):u.set(0,0,0)}}(),barycoordFromPoint:function(){var a=new r,c=new r,d=new r;return function(g,u,x,A,H){a.subVectors(A,u);c.subVectors(x,u);d.subVectors(g,u);g=a.dot(a);u=a.dot(c);x=a.dot(d);var K=c.dot(c);A=c.dot(d);var M=g*K-u*u;H=
H||new r;if(0===M)return H.set(-2,-1,-1);M=1/M;K=(K*x-u*A)*M;g=(g*A-u*x)*M;return H.set(1-K-g,g,K)}}(),containsPoint:function(){var a=new r;return function(c,d,g,u){c=gc.barycoordFromPoint(c,d,g,u,a);return 0<=c.x&&0<=c.y&&1>=c.x+c.y}}()});Object.assign(gc.prototype,{set:function(a,c,d){this.a.copy(a);this.b.copy(c);this.c.copy(d);return this},setFromPointsAndIndices:function(a,c,d,g){this.a.copy(a[c]);this.b.copy(a[d]);this.c.copy(a[g]);return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new r,c=new r;return function(){a.subVectors(this.c,this.b);c.subVectors(this.a,this.b);return.5*a.cross(c).length()}}(),midpoint:function(a){return(a||new r).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return gc.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new Sb).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,c){return gc.barycoordFromPoint(a,
this.a,this.b,this.c,c)},containsPoint:function(a){return gc.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a=new Sb,c=[new ed,new ed,new ed],d=new r,g=new r;return function(u,x){x=x||new r;var A=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(u,d);if(!0===this.containsPoint(d))x.copy(d);else for(c[0].set(this.a,this.b),c[1].set(this.b,this.c),c[2].set(this.c,this.a),u=0;u<c.length;u++){c[u].closestPointToPoint(d,!0,g);var H=d.distanceToSquared(g);
H<A&&(A=H,x.copy(g))}return x}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}});Object.assign(bc.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var c=0,d=a.vertexNormals.length;c<d;c++)this.vertexNormals[c]=a.vertexNormals[c].clone();c=0;for(d=a.vertexColors.length;c<d;c++)this.vertexColors[c]=a.vertexColors[c].clone();
return this}});hc.prototype=Object.create(Za.prototype);hc.prototype.constructor=hc;hc.prototype.isMeshBasicMaterial=!0;hc.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;
this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};Object.defineProperty(zb.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(zb.prototype,{isBufferAttribute:!0,setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==
a?a.length/this.itemSize:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,c,d){a*=this.itemSize;d*=c.itemSize;for(var g=0,u=this.itemSize;g<u;g++)this.array[a+g]=c.array[d+g];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var c=this.array,d=0,g=
0,u=a.length;g<u;g++){var x=a[g];void 0===x&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",g),x=new ka);c[d++]=x.r;c[d++]=x.g;c[d++]=x.b}return this},copyIndicesArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var x=a[g];c[d++]=x.a;c[d++]=x.b;c[d++]=x.c}return this},copyVector2sArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var x=a[g];void 0===x&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",g),x=
new k);c[d++]=x.x;c[d++]=x.y}return this},copyVector3sArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var x=a[g];void 0===x&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",g),x=new r);c[d++]=x.x;c[d++]=x.y;c[d++]=x.z}return this},copyVector4sArray:function(a){for(var c=this.array,d=0,g=0,u=a.length;g<u;g++){var x=a[g];void 0===x&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",g),x=new p);c[d++]=x.x;c[d++]=x.y;c[d++]=
x.z;c[d++]=x.w}return this},set:function(a,c){void 0===c&&(c=0);this.array.set(a,c);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,c){this.array[a*this.itemSize]=c;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,c){this.array[a*this.itemSize+1]=c;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,c){this.array[a*this.itemSize+2]=c;return this},getW:function(a){return this.array[a*this.itemSize+
3]},setW:function(a,c){this.array[a*this.itemSize+3]=c;return this},setXY:function(a,c,d){a*=this.itemSize;this.array[a+0]=c;this.array[a+1]=d;return this},setXYZ:function(a,c,d,g){a*=this.itemSize;this.array[a+0]=c;this.array[a+1]=d;this.array[a+2]=g;return this},setXYZW:function(a,c,d,g,u){a*=this.itemSize;this.array[a+0]=c;this.array[a+1]=d;this.array[a+2]=g;this.array[a+3]=u;return this},onUpload:function(a){this.onUploadCallback=a;return this},clone:function(){return(new this.constructor(this.array,
this.itemSize)).copy(this)}});Yc.prototype=Object.create(zb.prototype);Yc.prototype.constructor=Yc;Pc.prototype=Object.create(zb.prototype);Pc.prototype.constructor=Pc;uc.prototype=Object.create(zb.prototype);uc.prototype.constructor=uc;fd.prototype=Object.create(zb.prototype);fd.prototype.constructor=fd;Bc.prototype=Object.create(zb.prototype);Bc.prototype.constructor=Bc;Cc.prototype=Object.create(zb.prototype);Cc.prototype.constructor=Cc;Qc.prototype=Object.create(zb.prototype);Qc.prototype.constructor=
Qc;ib.prototype=Object.create(zb.prototype);ib.prototype.constructor=ib;Zc.prototype=Object.create(zb.prototype);Zc.prototype.constructor=Zc;Object.assign(ue.prototype,{computeGroups:function(a){var c=[],d=void 0;a=a.faces;for(var g=0;g<a.length;g++){var u=a[g];if(u.materialIndex!==d){d=u.materialIndex;void 0!==x&&(x.count=3*g-x.start,c.push(x));var x={start:3*g,materialIndex:d}}}void 0!==x&&(x.count=3*g-x.start,c.push(x));this.groups=c},fromGeometry:function(a){var c=a.faces,d=a.vertices,g=a.faceVertexUvs,
u=g[0]&&0<g[0].length,x=g[1]&&0<g[1].length,A=a.morphTargets,H=A.length;if(0<H){var K=[];for(var M=0;M<H;M++)K[M]=[];this.morphTargets.position=K}var R=a.morphNormals,O=R.length;if(0<O){var P=[];for(M=0;M<O;M++)P[M]=[];this.morphTargets.normal=P}var Z=a.skinIndices,da=a.skinWeights,na=Z.length===d.length,qa=da.length===d.length;for(M=0;M<c.length;M++){var sa=c[M];this.vertices.push(d[sa.a],d[sa.b],d[sa.c]);var ba=sa.vertexNormals;3===ba.length?this.normals.push(ba[0],ba[1],ba[2]):(ba=sa.normal,this.normals.push(ba,
ba,ba));ba=sa.vertexColors;3===ba.length?this.colors.push(ba[0],ba[1],ba[2]):(ba=sa.color,this.colors.push(ba,ba,ba));!0===u&&(ba=g[0][M],void 0!==ba?this.uvs.push(ba[0],ba[1],ba[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",M),this.uvs.push(new k,new k,new k)));!0===x&&(ba=g[1][M],void 0!==ba?this.uvs2.push(ba[0],ba[1],ba[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",M),this.uvs2.push(new k,new k,new k)));for(ba=0;ba<H;ba++){var oa=A[ba].vertices;
K[ba].push(oa[sa.a],oa[sa.b],oa[sa.c])}for(ba=0;ba<O;ba++)oa=R[ba].vertexNormals[M],P[ba].push(oa.a,oa.b,oa.c);na&&this.skinIndices.push(Z[sa.a],Z[sa.b],Z[sa.c]);qa&&this.skinWeights.push(da[sa.a],da[sa.b],da[sa.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this}});var Qf=0;Object.assign(sb.prototype,h.prototype,
{isGeometry:!0,applyMatrix:function(a){for(var c=(new Pb).getNormalMatrix(a),d=0,g=this.vertices.length;d<g;d++)this.vertices[d].applyMatrix4(a);d=0;for(g=this.faces.length;d<g;d++){a=this.faces[d];a.normal.applyMatrix3(c).normalize();for(var u=0,x=a.vertexNormals.length;u<x;u++)a.vertexNormals[u].applyMatrix3(c).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a=
new y;return function(c){a.makeRotationX(c);this.applyMatrix(a);return this}}(),rotateY:function(){var a=new y;return function(c){a.makeRotationY(c);this.applyMatrix(a);return this}}(),rotateZ:function(){var a=new y;return function(c){a.makeRotationZ(c);this.applyMatrix(a);return this}}(),translate:function(){var a=new y;return function(c,d,g){a.makeTranslation(c,d,g);this.applyMatrix(a);return this}}(),scale:function(){var a=new y;return function(c,d,g){a.makeScale(c,d,g);this.applyMatrix(a);return this}}(),
lookAt:function(){var a=new lb;return function(c){a.lookAt(c);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function c(sa,ba,oa,la){var wa=void 0!==A?[R[sa].clone(),R[ba].clone(),R[oa].clone()]:[],ya=void 0!==H?[d.colors[sa].clone(),d.colors[ba].clone(),d.colors[oa].clone()]:[];la=new bc(sa,ba,oa,wa,ya,la);d.faces.push(la);void 0!==K&&d.faceVertexUvs[0].push([O[sa].clone(),O[ba].clone(),O[oa].clone()]);void 0!==M&&d.faceVertexUvs[1].push([P[sa].clone(),P[ba].clone(),
P[oa].clone()])}var d=this,g=null!==a.index?a.index.array:void 0,u=a.attributes,x=u.position.array,A=void 0!==u.normal?u.normal.array:void 0,H=void 0!==u.color?u.color.array:void 0,K=void 0!==u.uv?u.uv.array:void 0,M=void 0!==u.uv2?u.uv2.array:void 0;void 0!==M&&(this.faceVertexUvs[1]=[]);for(var R=[],O=[],P=[],Z=u=0;u<x.length;u+=3,Z+=2)d.vertices.push(new r(x[u],x[u+1],x[u+2])),void 0!==A&&R.push(new r(A[u],A[u+1],A[u+2])),void 0!==H&&d.colors.push(new ka(H[u],H[u+1],H[u+2])),void 0!==K&&O.push(new k(K[Z],
K[Z+1])),void 0!==M&&P.push(new k(M[Z],M[Z+1]));if(void 0!==g)if(x=a.groups,0<x.length)for(u=0;u<x.length;u++){var da=x[u],na=da.start,qa=da.count;Z=na;for(na+=qa;Z<na;Z+=3)c(g[Z],g[Z+1],g[Z+2],da.materialIndex)}else for(u=0;u<g.length;u+=3)c(g[u],g[u+1],g[u+2]);else for(u=0;u<x.length/3;u+=3)c(u,u+1,u+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();
var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,c=this.boundingSphere.radius;c=0===c?1:1/c;var d=new y;d.set(c,0,0,-c*a.x,0,c,0,-c*a.y,0,0,c,-c*a.z,0,0,0,1);this.applyMatrix(d);return this},computeFaceNormals:function(){for(var a=new r,c=new r,d=0,g=this.faces.length;d<g;d++){var u=this.faces[d],x=this.vertices[u.a],A=this.vertices[u.b];a.subVectors(this.vertices[u.c],A);c.subVectors(x,
A);a.cross(c);a.normalize();u.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var c;var d=Array(this.vertices.length);var g=0;for(c=this.vertices.length;g<c;g++)d[g]=new r;if(a){var u=new r,x=new r;a=0;for(g=this.faces.length;a<g;a++){c=this.faces[a];var A=this.vertices[c.a];var H=this.vertices[c.b];var K=this.vertices[c.c];u.subVectors(K,H);x.subVectors(A,H);u.cross(x);d[c.a].add(u);d[c.b].add(u);d[c.c].add(u)}}else for(this.computeFaceNormals(),a=0,g=this.faces.length;a<g;a++)c=
this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);g=0;for(c=this.vertices.length;g<c;g++)d[g].normalize();a=0;for(g=this.faces.length;a<g;a++)c=this.faces[a],A=c.vertexNormals,3===A.length?(A[0].copy(d[c.a]),A[1].copy(d[c.b]),A[2].copy(d[c.c])):(A[0]=d[c.a].clone(),A[1]=d[c.b].clone(),A[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var a;this.computeFaceNormals();var c=0;for(a=this.faces.length;c<a;c++){var d=this.faces[c];
var g=d.vertexNormals;3===g.length?(g[0].copy(d.normal),g[1].copy(d.normal),g[2].copy(d.normal)):(g[0]=d.normal.clone(),g[1]=d.normal.clone(),g[2]=d.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,c;var d=0;for(c=this.faces.length;d<c;d++){var g=this.faces[d];g.__originalFaceNormal?g.__originalFaceNormal.copy(g.normal):g.__originalFaceNormal=g.normal.clone();g.__originalVertexNormals||(g.__originalVertexNormals=[]);var u=0;for(a=g.vertexNormals.length;u<
a;u++)g.__originalVertexNormals[u]?g.__originalVertexNormals[u].copy(g.vertexNormals[u]):g.__originalVertexNormals[u]=g.vertexNormals[u].clone()}var x=new sb;x.faces=this.faces;u=0;for(a=this.morphTargets.length;u<a;u++){if(!this.morphNormals[u]){this.morphNormals[u]={};this.morphNormals[u].faceNormals=[];this.morphNormals[u].vertexNormals=[];g=this.morphNormals[u].faceNormals;var A=this.morphNormals[u].vertexNormals;d=0;for(c=this.faces.length;d<c;d++){var H=new r;var K={a:new r,b:new r,c:new r};
g.push(H);A.push(K)}}A=this.morphNormals[u];x.vertices=this.morphTargets[u].vertices;x.computeFaceNormals();x.computeVertexNormals();d=0;for(c=this.faces.length;d<c;d++)g=this.faces[d],H=A.faceNormals[d],K=A.vertexNormals[d],H.copy(g.normal),K.a.copy(g.vertexNormals[0]),K.b.copy(g.vertexNormals[1]),K.c.copy(g.vertexNormals[2])}d=0;for(c=this.faces.length;d<c;d++)g=this.faces[d],g.normal=g.__originalFaceNormal,g.vertexNormals=g.__originalVertexNormals},computeLineDistances:function(){for(var a=0,c=
this.vertices,d=0,g=c.length;d<g;d++)0<d&&(a+=c[d].distanceTo(c[d-1])),this.lineDistances[d]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new vb);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Nb);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,c,d){if(!1===(a&&a.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var g,
u=this.vertices.length,x=this.vertices,A=a.vertices,H=this.faces,K=a.faces,M=this.faceVertexUvs[0],R=a.faceVertexUvs[0],O=this.colors,P=a.colors;void 0===d&&(d=0);void 0!==c&&(g=(new Pb).getNormalMatrix(c));a=0;for(var Z=A.length;a<Z;a++){var da=A[a].clone();void 0!==c&&da.applyMatrix4(c);x.push(da)}a=0;for(Z=P.length;a<Z;a++)O.push(P[a].clone());a=0;for(Z=K.length;a<Z;a++){A=K[a];var na=A.vertexNormals;P=A.vertexColors;O=new bc(A.a+u,A.b+u,A.c+u);O.normal.copy(A.normal);void 0!==g&&O.normal.applyMatrix3(g).normalize();
c=0;for(x=na.length;c<x;c++)da=na[c].clone(),void 0!==g&&da.applyMatrix3(g).normalize(),O.vertexNormals.push(da);O.color.copy(A.color);c=0;for(x=P.length;c<x;c++)da=P[c],O.vertexColors.push(da.clone());O.materialIndex=A.materialIndex+d;H.push(O)}a=0;for(Z=R.length;a<Z;a++)if(d=R[a],g=[],void 0!==d){c=0;for(x=d.length;c<x;c++)g.push(d[c].clone());M.push(g)}}},mergeMesh:function(a){!1===(a&&a.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&
a.updateMatrix(),this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},c=[],d=[],g=Math.pow(10,4),u;var x=0;for(u=this.vertices.length;x<u;x++){var A=this.vertices[x];A=Math.round(A.x*g)+"_"+Math.round(A.y*g)+"_"+Math.round(A.z*g);void 0===a[A]?(a[A]=x,c.push(this.vertices[x]),d[x]=c.length-1):d[x]=d[a[A]]}a=[];x=0;for(u=this.faces.length;x<u;x++)for(g=this.faces[x],g.a=d[g.a],g.b=d[g.b],g.c=d[g.c],g=[g.a,g.b,g.c],A=0;3>A;A++)if(g[A]===g[(A+1)%3]){a.push(x);break}for(x=a.length-1;0<=
x;x--)for(g=a[x],this.faces.splice(g,1),d=0,u=this.faceVertexUvs.length;d<u;d++)this.faceVertexUvs[d].splice(g,1);x=this.vertices.length-c.length;this.vertices=c;return x},sortFacesByMaterialIndex:function(){for(var a=this.faces,c=a.length,d=0;d<c;d++)a[d]._id=d;a.sort(function(K,M){return K.materialIndex-M.materialIndex});var g=this.faceVertexUvs[0],u=this.faceVertexUvs[1],x,A;g&&g.length===c&&(x=[]);u&&u.length===c&&(A=[]);for(d=0;d<c;d++){var H=a[d]._id;x&&x.push(g[H]);A&&A.push(u[H])}x&&(this.faceVertexUvs[0]=
x);A&&(this.faceVertexUvs[1]=A)},toJSON:function(){function a(wa,ya,Ca){return Ca?wa|1<<ya:wa&~(1<<ya)}function c(wa){var ya=wa.x.toString()+wa.y.toString()+wa.z.toString();if(void 0!==M[ya])return M[ya];M[ya]=K.length/3;K.push(wa.x,wa.y,wa.z);return M[ya]}function d(wa){var ya=wa.r.toString()+wa.g.toString()+wa.b.toString();if(void 0!==O[ya])return O[ya];O[ya]=R.length;R.push(wa.getHex());return O[ya]}function g(wa){var ya=wa.x.toString()+wa.y.toString();if(void 0!==Z[ya])return Z[ya];Z[ya]=P.length/
2;P.push(wa.x,wa.y);return Z[ya]}var u={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};u.uuid=this.uuid;u.type=this.type;""!==this.name&&(u.name=this.name);if(void 0!==this.parameters){var x=this.parameters,A;for(A in x)void 0!==x[A]&&(u[A]=x[A]);return u}x=[];for(A=0;A<this.vertices.length;A++){var H=this.vertices[A];x.push(H.x,H.y,H.z)}H=[];var K=[],M={},R=[],O={},P=[],Z={};for(A=0;A<this.faces.length;A++){var da=this.faces[A],na=void 0!==this.faceVertexUvs[0][A],qa=0<da.normal.length(),
sa=0<da.vertexNormals.length,ba=1!==da.color.r||1!==da.color.g||1!==da.color.b,oa=0<da.vertexColors.length,la=0;la=a(la,0,0);la=a(la,1,!0);la=a(la,2,!1);la=a(la,3,na);la=a(la,4,qa);la=a(la,5,sa);la=a(la,6,ba);la=a(la,7,oa);H.push(la);H.push(da.a,da.b,da.c);H.push(da.materialIndex);na&&(na=this.faceVertexUvs[0][A],H.push(g(na[0]),g(na[1]),g(na[2])));qa&&H.push(c(da.normal));sa&&(qa=da.vertexNormals,H.push(c(qa[0]),c(qa[1]),c(qa[2])));ba&&H.push(d(da.color));oa&&(da=da.vertexColors,H.push(d(da[0]),
d(da[1]),d(da[2])))}u.data={};u.data.vertices=x;u.data.normals=K;0<R.length&&(u.data.colors=R);0<P.length&&(u.data.uvs=[P]);u.data.faces=H;return u},clone:function(){return(new sb).copy(this)},copy:function(a){var c,d,g;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;var u=a.vertices;var x=0;for(c=u.length;x<c;x++)this.vertices.push(u[x].clone());
u=a.colors;x=0;for(c=u.length;x<c;x++)this.colors.push(u[x].clone());u=a.faces;x=0;for(c=u.length;x<c;x++)this.faces.push(u[x].clone());x=0;for(c=a.faceVertexUvs.length;x<c;x++){var A=a.faceVertexUvs[x];void 0===this.faceVertexUvs[x]&&(this.faceVertexUvs[x]=[]);u=0;for(d=A.length;u<d;u++){var H=A[u],K=[];var M=0;for(g=H.length;M<g;M++)K.push(H[M].clone());this.faceVertexUvs[x].push(K)}}M=a.morphTargets;x=0;for(c=M.length;x<c;x++){g={};g.name=M[x].name;if(void 0!==M[x].vertices)for(g.vertices=[],u=
0,d=M[x].vertices.length;u<d;u++)g.vertices.push(M[x].vertices[u].clone());if(void 0!==M[x].normals)for(g.normals=[],u=0,d=M[x].normals.length;u<d;u++)g.normals.push(M[x].normals[u].clone());this.morphTargets.push(g)}M=a.morphNormals;x=0;for(c=M.length;x<c;x++){g={};if(void 0!==M[x].vertexNormals)for(g.vertexNormals=[],u=0,d=M[x].vertexNormals.length;u<d;u++)A=M[x].vertexNormals[u],H={},H.a=A.a.clone(),H.b=A.b.clone(),H.c=A.c.clone(),g.vertexNormals.push(H);if(void 0!==M[x].faceNormals)for(g.faceNormals=
[],u=0,d=M[x].faceNormals.length;u<d;u++)g.faceNormals.push(M[x].faceNormals[u].clone());this.morphNormals.push(g)}u=a.skinWeights;x=0;for(c=u.length;x<c;x++)this.skinWeights.push(u[x].clone());u=a.skinIndices;x=0;for(c=u.length;x<c;x++)this.skinIndices.push(u[x].clone());u=a.lineDistances;x=0;for(c=u.length;x<c;x++)this.lineDistances.push(u[x]);x=a.boundingBox;null!==x&&(this.boundingBox=x.clone());x=a.boundingSphere;null!==x&&(this.boundingSphere=x.clone());this.elementsNeedUpdate=a.elementsNeedUpdate;
this.verticesNeedUpdate=a.verticesNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.lineDistancesNeedUpdate=a.lineDistancesNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});ob.MaxIndex=65535;Object.assign(ob.prototype,h.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){Array.isArray(a)?this.index=new (65535<
Rc(a)?Qc:Bc)(a,1):this.index=a},addAttribute:function(a,c,d){if(!1===(c&&c.isBufferAttribute)&&!1===(c&&c.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new zb(c,d));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(c);else return this.attributes[a]=c,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];
return this},addGroup:function(a,c,d){this.groups.push({start:a,count:c,materialIndex:void 0!==d?d:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,c){this.drawRange.start=a;this.drawRange.count=c},applyMatrix:function(a){var c=this.attributes.position;void 0!==c&&(a.applyToBufferAttribute(c),c.needsUpdate=!0);c=this.attributes.normal;void 0!==c&&((new Pb).getNormalMatrix(a).applyToBufferAttribute(c),c.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&
this.computeBoundingSphere();return this},rotateX:function(){var a=new y;return function(c){a.makeRotationX(c);this.applyMatrix(a);return this}}(),rotateY:function(){var a=new y;return function(c){a.makeRotationY(c);this.applyMatrix(a);return this}}(),rotateZ:function(){var a=new y;return function(c){a.makeRotationZ(c);this.applyMatrix(a);return this}}(),translate:function(){var a=new y;return function(c,d,g){a.makeTranslation(c,d,g);this.applyMatrix(a);return this}}(),scale:function(){var a=new y;
return function(c,d,g){a.makeScale(c,d,g);this.applyMatrix(a);return this}}(),lookAt:function(){var a=new lb;return function(c){a.lookAt(c);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var c=a.geometry;if(a.isPoints||a.isLine){a=new ib(3*c.vertices.length,3);var d=new ib(3*c.colors.length,3);this.addAttribute("position",a.copyVector3sArray(c.vertices));
this.addAttribute("color",d.copyColorsArray(c.colors));c.lineDistances&&c.lineDistances.length===c.vertices.length&&(a=new ib(c.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(c.lineDistances)));null!==c.boundingSphere&&(this.boundingSphere=c.boundingSphere.clone());null!==c.boundingBox&&(this.boundingBox=c.boundingBox.clone())}else a.isMesh&&c&&c.isGeometry&&this.fromGeometry(c);return this},updateFromObject:function(a){var c=a.geometry;if(a.isMesh){var d=c.__directGeometry;
!0===c.elementsNeedUpdate&&(d=void 0,c.elementsNeedUpdate=!1);if(void 0===d)return this.fromGeometry(c);d.verticesNeedUpdate=c.verticesNeedUpdate;d.normalsNeedUpdate=c.normalsNeedUpdate;d.colorsNeedUpdate=c.colorsNeedUpdate;d.uvsNeedUpdate=c.uvsNeedUpdate;d.groupsNeedUpdate=c.groupsNeedUpdate;c.verticesNeedUpdate=!1;c.normalsNeedUpdate=!1;c.colorsNeedUpdate=!1;c.uvsNeedUpdate=!1;c.groupsNeedUpdate=!1;c=d}!0===c.verticesNeedUpdate&&(d=this.attributes.position,void 0!==d&&(d.copyVector3sArray(c.vertices),
d.needsUpdate=!0),c.verticesNeedUpdate=!1);!0===c.normalsNeedUpdate&&(d=this.attributes.normal,void 0!==d&&(d.copyVector3sArray(c.normals),d.needsUpdate=!0),c.normalsNeedUpdate=!1);!0===c.colorsNeedUpdate&&(d=this.attributes.color,void 0!==d&&(d.copyColorsArray(c.colors),d.needsUpdate=!0),c.colorsNeedUpdate=!1);c.uvsNeedUpdate&&(d=this.attributes.uv,void 0!==d&&(d.copyVector2sArray(c.uvs),d.needsUpdate=!0),c.uvsNeedUpdate=!1);c.lineDistancesNeedUpdate&&(d=this.attributes.lineDistance,void 0!==d&&
(d.copyArray(c.lineDistances),d.needsUpdate=!0),c.lineDistancesNeedUpdate=!1);c.groupsNeedUpdate&&(c.computeGroups(a.geometry),this.groups=c.groups,c.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new ue).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var c=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new zb(c,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(c=new Float32Array(3*a.normals.length),
this.addAttribute("normal",(new zb(c,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(c=new Float32Array(3*a.colors.length),this.addAttribute("color",(new zb(c,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(c=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new zb(c,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(c=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new zb(c,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(c=new (65535<Rc(a.indices)?Uint32Array:Uint16Array)(3*
a.indices.length),this.setIndex((new zb(c,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var d in a.morphTargets){c=[];for(var g=a.morphTargets[d],u=0,x=g.length;u<x;u++){var A=g[u],H=new ib(3*A.length,3);c.push(H.copyVector3sArray(A))}this.morphAttributes[d]=c}0<a.skinIndices.length&&(d=new ib(4*a.skinIndices.length,4),this.addAttribute("skinIndex",d.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(d=new ib(4*a.skinWeights.length,4),this.addAttribute("skinWeight",d.copyVector4sArray(a.skinWeights)));
null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new vb);var a=this.attributes.position;void 0!==a?this.boundingBox.setFromBufferAttribute(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',
this)},computeBoundingSphere:function(){var a=new vb,c=new r;return function(){null===this.boundingSphere&&(this.boundingSphere=new Nb);var d=this.attributes.position;if(d){var g=this.boundingSphere.center;a.setFromBufferAttribute(d);a.getCenter(g);for(var u=0,x=0,A=d.count;x<A;x++)c.x=d.getX(x),c.y=d.getY(x),c.z=d.getZ(x),u=Math.max(u,g.distanceToSquared(c));this.boundingSphere.radius=Math.sqrt(u);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,c=this.attributes,d=this.groups;if(c.position){var g=c.position.array;if(void 0===c.normal)this.addAttribute("normal",new zb(new Float32Array(g.length),3));else for(var u=c.normal.array,x=0,A=u.length;x<A;x++)u[x]=0;u=c.normal.array;var H=new r,K=new r,M=new r,R=new r,O=new r;if(a){a=a.array;0===d.length&&this.addGroup(0,a.length);for(var P=0,Z=d.length;P<Z;++P){x=d[P];A=x.start;var da=x.count;x=A;for(A+=da;x<
A;x+=3){da=3*a[x+0];var na=3*a[x+1];var qa=3*a[x+2];H.fromArray(g,da);K.fromArray(g,na);M.fromArray(g,qa);R.subVectors(M,K);O.subVectors(H,K);R.cross(O);u[da]+=R.x;u[da+1]+=R.y;u[da+2]+=R.z;u[na]+=R.x;u[na+1]+=R.y;u[na+2]+=R.z;u[qa]+=R.x;u[qa+1]+=R.y;u[qa+2]+=R.z}}}else for(x=0,A=g.length;x<A;x+=9)H.fromArray(g,x),K.fromArray(g,x+3),M.fromArray(g,x+6),R.subVectors(M,K),O.subVectors(H,K),R.cross(O),u[x]=R.x,u[x+1]=R.y,u[x+2]=R.z,u[x+3]=R.x,u[x+4]=R.y,u[x+5]=R.z,u[x+6]=R.x,u[x+7]=R.y,u[x+8]=R.z;this.normalizeNormals();
c.normal.needsUpdate=!0}},merge:function(a,c){if(!1===(a&&a.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===c&&(c=0);var d=this.attributes,g;for(g in d)if(void 0!==a.attributes[g]){var u=d[g].array,x=a.attributes[g],A=x.array,H=0;for(x=x.itemSize*c;H<A.length;H++,x++)u[x]=A[H]}return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,c,d,g,u=0,x=a.length;u<x;u+=3)c=a[u],d=a[u+1],g=a[u+2],c=1/
Math.sqrt(c*c+d*d+g*g),a[u]*=c,a[u+1]*=c,a[u+2]*=c},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new ob,c=this.index.array,d=this.attributes,g;for(g in d){var u=d[g],x=u.array;u=u.itemSize;for(var A=new x.constructor(c.length*u),H,K=0,M=0,R=c.length;M<R;M++){H=c[M]*u;for(var O=0;O<u;O++)A[K++]=x[H++]}a.addAttribute(g,new zb(A,u))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",
generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var c=this.parameters;for(u in c)void 0!==c[u]&&(a[u]=c[u]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(c=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:c});d=this.attributes;for(u in d){var g=d[u];c=Array.prototype.slice.call(g.array);a.data.attributes[u]={itemSize:g.itemSize,type:g.array.constructor.name,array:c,
normalized:g.normalized}}var u=this.groups;0<u.length&&(a.data.groups=JSON.parse(JSON.stringify(u)));u=this.boundingSphere;null!==u&&(a.data.boundingSphere={center:u.center.toArray(),radius:u.radius});return a},clone:function(){return(new ob).copy(this)},copy:function(a){var c;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.name=a.name;var d=a.index;null!==d&&this.setIndex(d.clone());d=a.attributes;for(A in d)this.addAttribute(A,
d[A].clone());var g=a.morphAttributes;for(A in g){var u=[],x=g[A];d=0;for(c=x.length;d<c;d++)u.push(x[d].clone());this.morphAttributes[A]=u}var A=a.groups;d=0;for(c=A.length;d<c;d++)g=A[d],this.addGroup(g.start,g.count,g.materialIndex);A=a.boundingBox;null!==A&&(this.boundingBox=A.clone());A=a.boundingSphere;null!==A&&(this.boundingSphere=A.clone());this.drawRange.start=a.drawRange.start;this.drawRange.count=a.drawRange.count;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
Zb.prototype=Object.assign(Object.create(lb.prototype),{constructor:Zb,isMesh:!0,setDrawMode:function(a){this.drawMode=a},copy:function(a){lb.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){var a=this.geometry.morphTargets;if(void 0!==a&&0<a.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var c=0,d=a.length;c<d;c++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[a[c].name]=c}},raycast:function(){function a(ba,oa,
la,wa,ya,Ca,Ja){gc.barycoordFromPoint(ba,oa,la,wa,na);ya.multiplyScalar(na.x);Ca.multiplyScalar(na.y);Ja.multiplyScalar(na.z);ya.add(Ca).add(Ja);return ya.clone()}function c(ba,oa,la,wa,ya,Ca,Ja){var Pa=ba.material;if(null===(1===Pa.side?la.intersectTriangle(Ca,ya,wa,!0,Ja):la.intersectTriangle(wa,ya,Ca,2!==Pa.side,Ja)))return null;sa.copy(Ja);sa.applyMatrix4(ba.matrixWorld);la=oa.ray.origin.distanceTo(sa);return la<oa.near||la>oa.far?null:{distance:la,point:sa.clone(),object:ba}}function d(ba,oa,
la,wa,ya,Ca,Ja,Pa){A.fromBufferAttribute(wa,Ca);H.fromBufferAttribute(wa,Ja);K.fromBufferAttribute(wa,Pa);if(ba=c(ba,oa,la,A,H,K,qa))ya&&(P.fromBufferAttribute(ya,Ca),Z.fromBufferAttribute(ya,Ja),da.fromBufferAttribute(ya,Pa),ba.uv=a(qa,A,H,K,P,Z,da)),ba.face=new bc(Ca,Ja,Pa,gc.normal(A,H,K)),ba.faceIndex=Ca;return ba}var g=new y,u=new sc,x=new Nb,A=new r,H=new r,K=new r,M=new r,R=new r,O=new r,P=new k,Z=new k,da=new k,na=new r,qa=new r,sa=new r;return function(ba,oa){var la=this.geometry,wa=this.material,
ya=this.matrixWorld;if(void 0!==wa&&(null===la.boundingSphere&&la.computeBoundingSphere(),x.copy(la.boundingSphere),x.applyMatrix4(ya),!1!==ba.ray.intersectsSphere(x)&&(g.getInverse(ya),u.copy(ba.ray).applyMatrix4(g),null===la.boundingBox||!1!==u.intersectsBox(la.boundingBox)))){var Ca;if(la.isBufferGeometry){wa=la.index;var Ja=la.attributes.position;ya=la.attributes.uv;var Pa;if(null!==wa){var Na=0;for(Pa=wa.count;Na<Pa;Na+=3){la=wa.getX(Na);var Ta=wa.getX(Na+1);var Qa=wa.getX(Na+2);if(Ca=d(this,
ba,u,Ja,ya,la,Ta,Qa))Ca.faceIndex=Math.floor(Na/3),oa.push(Ca)}}else for(Na=0,Pa=Ja.count;Na<Pa;Na+=3)if(la=Na,Ta=Na+1,Qa=Na+2,Ca=d(this,ba,u,Ja,ya,la,Ta,Qa))Ca.index=la,oa.push(Ca)}else if(la.isGeometry){ya=wa&&wa.isMultiMaterial;Na=!0===ya?wa.materials:null;Pa=la.vertices;Ta=la.faces;Qa=la.faceVertexUvs[0];0<Qa.length&&(Ja=Qa);for(var Xa=0,hb=Ta.length;Xa<hb;Xa++){var Ua=Ta[Xa];Ca=!0===ya?Na[Ua.materialIndex]:wa;if(void 0!==Ca){Qa=Pa[Ua.a];var Ma=Pa[Ua.b];var Sa=Pa[Ua.c];if(!0===Ca.morphTargets){Ca=
la.morphTargets;var Ga=this.morphTargetInfluences;A.set(0,0,0);H.set(0,0,0);K.set(0,0,0);for(var db=0,Ya=Ca.length;db<Ya;db++){var Cb=Ga[db];if(0!==Cb){var Jb=Ca[db].vertices;A.addScaledVector(M.subVectors(Jb[Ua.a],Qa),Cb);H.addScaledVector(R.subVectors(Jb[Ua.b],Ma),Cb);K.addScaledVector(O.subVectors(Jb[Ua.c],Sa),Cb)}}A.add(Qa);H.add(Ma);K.add(Sa);Qa=A;Ma=H;Sa=K}if(Ca=c(this,ba,u,Qa,Ma,Sa,qa))Ja&&(Ga=Ja[Xa],P.copy(Ga[0]),Z.copy(Ga[1]),da.copy(Ga[2]),Ca.uv=a(qa,Qa,Ma,Sa,P,Z,da)),Ca.face=Ua,Ca.faceIndex=
Xa,oa.push(Ca)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});oc.prototype=Object.create(sb.prototype);oc.prototype.constructor=oc;pc.prototype=Object.create(ob.prototype);pc.prototype.constructor=pc;ua.prototype=Object.create(sb.prototype);ua.prototype.constructor=ua;Da.prototype=Object.create(ob.prototype);Da.prototype.constructor=Da;Ka.prototype=Object.create(lb.prototype);Ka.prototype.constructor=Ka;Ka.prototype.isCamera=!0;Ka.prototype.getWorldDirection=
function(){var a=new t;return function(c){c=c||new r;this.getWorldQuaternion(a);return c.set(0,0,-1).applyQuaternion(a)}}();Ka.prototype.lookAt=function(){var a=new y;return function(c){a.lookAt(this.position,c,this.up);this.quaternion.setFromRotationMatrix(a)}}();Ka.prototype.clone=function(){return(new this.constructor).copy(this)};Ka.prototype.copy=function(a){lb.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};
Oa.prototype=Object.assign(Object.create(Ka.prototype),{constructor:Oa,isPerspectiveCamera:!0,copy:function(a){Ka.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*xb.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=
Math.tan(.5*xb.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*xb.RAD2DEG*Math.atan(Math.tan(.5*xb.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,c,d,g,u,x){this.aspect=a/c;this.view={fullWidth:a,fullHeight:c,offsetX:d,offsetY:g,width:u,height:x};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=
null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,c=a*Math.tan(.5*xb.DEG2RAD*this.fov)/this.zoom,d=2*c,g=this.aspect*d,u=-.5*g,x=this.view;if(null!==x){var A=x.fullWidth,H=x.fullHeight;u+=x.offsetX*g/A;c-=x.offsetY*d/H;g*=x.width/A;d*=x.height/H}x=this.filmOffset;0!==x&&(u+=a*x/this.getFilmWidth());this.projectionMatrix.makePerspective(u,u+g,c,c-d,a,this.far)},toJSON:function(a){a=lb.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=
this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});Ha.prototype=Object.assign(Object.create(Ka.prototype),{constructor:Ha,isOrthographicCamera:!0,copy:function(a){Ka.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=
null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,c,d,g,u,x){this.view={fullWidth:a,fullHeight:c,offsetX:d,offsetY:g,width:u,height:x};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),d=(this.right+this.left)/2,g=(this.top+this.bottom)/2,u=d-a;d+=a;a=g+c;c=g-c;if(null!==this.view){d=this.zoom/(this.view.width/
this.view.fullWidth);c=this.zoom/(this.view.height/this.view.fullHeight);var x=(this.right-this.left)/this.view.width;g=(this.top-this.bottom)/this.view.height;u+=this.view.offsetX/d*x;d=u+this.view.width/d*x;a-=this.view.offsetY/c*g;c=a-this.view.height/c*g}this.projectionMatrix.makeOrthographic(u,d,a,c,this.near,this.far)},toJSON:function(a){a=lb.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;
a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});var Sg=0;Kd.prototype.isFogExp2=!0;Kd.prototype.clone=function(){return new Kd(this.color.getHex(),this.density)};Kd.prototype.toJSON=function(a){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Ld.prototype.isFog=!0;Ld.prototype.clone=function(){return new Ld(this.color.getHex(),this.near,this.far)};Ld.prototype.toJSON=function(a){return{type:"Fog",color:this.color.getHex(),
near:this.near,far:this.far}};kf.prototype=Object.assign(Object.create(lb.prototype),{constructor:kf,copy:function(a,c){lb.prototype.copy.call(this,a,c);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this},toJSON:function(a){var c=lb.prototype.toJSON.call(this,a);null!==this.background&&(c.object.background=
this.background.toJSON(a));null!==this.fog&&(c.object.fog=this.fog.toJSON());return c}});Vf.prototype=Object.assign(Object.create(lb.prototype),{constructor:Vf,isLensFlare:!0,copy:function(a){lb.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var c=0,d=a.lensFlares.length;c<d;c++)this.lensFlares.push(a.lensFlares[c]);return this},add:function(a,c,d,g,u,x){void 0===c&&(c=-1);void 0===d&&(d=0);void 0===x&&(x=1);void 0===u&&
(u=new ka(16777215));void 0===g&&(g=1);d=Math.min(d,Math.max(0,d));this.lensFlares.push({texture:a,size:c,distance:d,x:0,y:0,z:0,scale:1,rotation:0,opacity:x,color:u,blending:g})},updateLensFlares:function(){var a,c=this.lensFlares.length,d=2*-this.positionScreen.x,g=2*-this.positionScreen.y;for(a=0;a<c;a++){var u=this.lensFlares[a];u.x=this.positionScreen.x+d*u.distance;u.y=this.positionScreen.y+g*u.distance;u.wantedRotation=u.x*Math.PI*.25;u.rotation+=.25*(u.wantedRotation-u.rotation)}}});pd.prototype=
Object.create(Za.prototype);pd.prototype.constructor=pd;pd.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};xe.prototype=Object.assign(Object.create(lb.prototype),{constructor:xe,isSprite:!0,raycast:function(){var a=new r;return function(c,d){a.setFromMatrixPosition(this.matrixWorld);c=c.ray.distanceSqToPoint(a);c>this.scale.x*this.scale.y/4||d.push({distance:Math.sqrt(c),point:this.position,face:null,object:this})}}(),
clone:function(){return(new this.constructor(this.material)).copy(this)}});ye.prototype=Object.assign(Object.create(lb.prototype),{constructor:ye,copy:function(a){lb.prototype.copy.call(this,a,!1);a=a.levels;for(var c=0,d=a.length;c<d;c++){var g=a[c];this.addLevel(g.object.clone(),g.distance)}return this},addLevel:function(a,c){void 0===c&&(c=0);c=Math.abs(c);for(var d=this.levels,g=0;g<d.length&&!(c<d[g].distance);g++);d.splice(g,0,{distance:c,object:a});this.add(a)},getObjectForDistance:function(a){for(var c=
this.levels,d=1,g=c.length;d<g&&!(a<c[d].distance);d++);return c[d-1].object},raycast:function(){var a=new r;return function(c,d){a.setFromMatrixPosition(this.matrixWorld);var g=c.ray.origin.distanceTo(a);this.getObjectForDistance(g).raycast(c,d)}}(),update:function(){var a=new r,c=new r;return function(d){var g=this.levels;if(1<g.length){a.setFromMatrixPosition(d.matrixWorld);c.setFromMatrixPosition(this.matrixWorld);d=a.distanceTo(c);g[0].object.visible=!0;for(var u=1,x=g.length;u<x;u++)if(d>=g[u].distance)g[u-
1].object.visible=!1,g[u].object.visible=!0;else break;for(;u<x;u++)g[u].object.visible=!1}}}(),toJSON:function(a){a=lb.prototype.toJSON.call(this,a);a.object.levels=[];for(var c=this.levels,d=0,g=c.length;d<g;d++){var u=c[d];a.object.levels.push({object:u.object.uuid,distance:u.distance})}return a}});Object.assign(lf.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,c=this.bones.length;a<c;a++){var d=new y;this.bones[a]&&d.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(d)}},
pose:function(){for(var a,c=0,d=this.bones.length;c<d;c++)(a=this.bones[c])&&a.matrixWorld.getInverse(this.boneInverses[c]);c=0;for(d=this.bones.length;c<d;c++)if(a=this.bones[c])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new y;return function(){for(var c=0,d=this.bones.length;c<d;c++)a.multiplyMatrices(this.bones[c]?this.bones[c].matrixWorld:
this.identityMatrix,this.boneInverses[c]),a.toArray(this.boneMatrices,16*c);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new lf(this.bones,this.boneInverses,this.useVertexTexture)}});mf.prototype=Object.assign(Object.create(lb.prototype),{constructor:mf,isBone:!0});nf.prototype=Object.assign(Object.create(Zb.prototype),{constructor:nf,isSkinnedMesh:!0,bind:function(a,c){this.skeleton=a;void 0===c&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),
c=this.matrixWorld);this.bindMatrix.copy(c);this.bindMatrixInverse.getInverse(c)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var c=this.geometry.skinWeights[a],d=1/c.lengthManhattan();Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){c=new p;var g=this.geometry.attributes.skinWeight;for(a=0;a<g.count;a++)c.x=g.getX(a),c.y=g.getY(a),
c.z=g.getZ(a),c.w=g.getW(a),d=1/c.lengthManhattan(),Infinity!==d?c.multiplyScalar(d):c.set(1,0,0,0),g.setXYZW(a,c.x,c.y,c.z,c.w)}},updateMatrixWorld:function(a){Zb.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,
this.skeleton.useVertexTexture)).copy(this)}});$b.prototype=Object.create(Za.prototype);$b.prototype.constructor=$b;$b.prototype.isLineBasicMaterial=!0;$b.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};Ic.prototype=Object.assign(Object.create(lb.prototype),{constructor:Ic,isLine:!0,raycast:function(){var a=new y,c=new sc,d=new Nb;return function(g,u){var x=g.linePrecision;x*=
x;var A=this.geometry,H=this.matrixWorld;null===A.boundingSphere&&A.computeBoundingSphere();d.copy(A.boundingSphere);d.applyMatrix4(H);if(!1!==g.ray.intersectsSphere(d)){a.getInverse(H);c.copy(g.ray).applyMatrix4(a);var K=new r,M=new r;H=new r;var R=new r,O=this&&this.isLineSegments?2:1;if(A.isBufferGeometry){var P=A.index,Z=A.attributes.position.array;if(null!==P){P=P.array;A=0;for(var da=P.length-1;A<da;A+=O){var na=P[A+1];K.fromArray(Z,3*P[A]);M.fromArray(Z,3*na);na=c.distanceSqToSegment(K,M,R,
H);na>x||(R.applyMatrix4(this.matrixWorld),na=g.ray.origin.distanceTo(R),na<g.near||na>g.far||u.push({distance:na,point:H.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}}else for(A=0,da=Z.length/3-1;A<da;A+=O)K.fromArray(Z,3*A),M.fromArray(Z,3*A+3),na=c.distanceSqToSegment(K,M,R,H),na>x||(R.applyMatrix4(this.matrixWorld),na=g.ray.origin.distanceTo(R),na<g.near||na>g.far||u.push({distance:na,point:H.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,
object:this}))}else if(A.isGeometry)for(K=A.vertices,M=K.length,A=0;A<M-1;A+=O)na=c.distanceSqToSegment(K[A],K[A+1],R,H),na>x||(R.applyMatrix4(this.matrixWorld),na=g.ray.origin.distanceTo(R),na<g.near||na>g.far||u.push({distance:na,point:H.clone().applyMatrix4(this.matrixWorld),index:A,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Vb.prototype=Object.assign(Object.create(Ic.prototype),{constructor:Vb,isLineSegments:!0});
of.prototype=Object.assign(Object.create(Ic.prototype),{constructor:of,isLineLoop:!0});Jc.prototype=Object.create(Za.prototype);Jc.prototype.constructor=Jc;Jc.prototype.isPointsMaterial=!0;Jc.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};Md.prototype=Object.assign(Object.create(lb.prototype),{constructor:Md,isPoints:!0,raycast:function(){var a=new y,c=new sc,d=new Nb;return function(g,
u){function x(na,qa){var sa=c.distanceSqToPoint(na);if(sa<R){na=c.closestPointToPoint(na);na.applyMatrix4(K);var ba=g.ray.origin.distanceTo(na);ba<g.near||ba>g.far||u.push({distance:ba,distanceToRay:Math.sqrt(sa),point:na.clone(),index:qa,face:null,object:A})}}var A=this,H=this.geometry,K=this.matrixWorld,M=g.params.Points.threshold;null===H.boundingSphere&&H.computeBoundingSphere();d.copy(H.boundingSphere);d.applyMatrix4(K);if(!1!==g.ray.intersectsSphere(d)){a.getInverse(K);c.copy(g.ray).applyMatrix4(a);
M/=(this.scale.x+this.scale.y+this.scale.z)/3;var R=M*M;M=new r;if(H.isBufferGeometry){var O=H.index;H=H.attributes.position.array;if(null!==O){var P=O.array;O=0;for(var Z=P.length;O<Z;O++){var da=P[O];M.fromArray(H,3*da);x(M,da)}}else for(O=0,P=H.length/3;O<P;O++)M.fromArray(H,3*O),x(M,O)}else for(M=H.vertices,O=0,P=M.length;O<P;O++)x(M[O],O)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});ze.prototype=Object.assign(Object.create(lb.prototype),{constructor:ze});
pf.prototype=Object.create(e.prototype);pf.prototype.constructor=pf;Nd.prototype=Object.create(e.prototype);Nd.prototype.constructor=Nd;Nd.prototype.isCompressedTexture=!0;qf.prototype=Object.create(e.prototype);qf.prototype.constructor=qf;Ae.prototype=Object.create(e.prototype);Ae.prototype.constructor=Ae;Ae.prototype.isDepthTexture=!0;Od.prototype=Object.create(ob.prototype);Od.prototype.constructor=Od;Be.prototype=Object.create(sb.prototype);Be.prototype.constructor=Be;Pd.prototype=Object.create(ob.prototype);
Pd.prototype.constructor=Pd;Ce.prototype=Object.create(sb.prototype);Ce.prototype.constructor=Ce;qc.prototype=Object.create(ob.prototype);qc.prototype.constructor=qc;De.prototype=Object.create(sb.prototype);De.prototype.constructor=De;Qd.prototype=Object.create(qc.prototype);Qd.prototype.constructor=Qd;Ee.prototype=Object.create(sb.prototype);Ee.prototype.constructor=Ee;qd.prototype=Object.create(qc.prototype);qd.prototype.constructor=qd;Fe.prototype=Object.create(sb.prototype);Fe.prototype.constructor=
Fe;Rd.prototype=Object.create(qc.prototype);Rd.prototype.constructor=Rd;Ge.prototype=Object.create(sb.prototype);Ge.prototype.constructor=Ge;Sd.prototype=Object.create(qc.prototype);Sd.prototype.constructor=Sd;He.prototype=Object.create(sb.prototype);He.prototype.constructor=He;Td.prototype=Object.create(ob.prototype);Td.prototype.constructor=Td;Ie.prototype=Object.create(sb.prototype);Ie.prototype.constructor=Ie;Ud.prototype=Object.create(ob.prototype);Ud.prototype.constructor=Ud;Je.prototype=Object.create(sb.prototype);
Je.prototype.constructor=Je;Vd.prototype=Object.create(ob.prototype);Vd.prototype.constructor=Vd;var Kc={area:function(a){for(var c=a.length,d=0,g=c-1,u=0;u<c;g=u++)d+=a[g].x*a[u].y-a[u].x*a[g].y;return.5*d},triangulate:function(){return function(a,c){var d=a.length;if(3>d)return null;var g=[],u=[],x=[],A;if(0<Kc.area(a))for(A=0;A<d;A++)u[A]=A;else for(A=0;A<d;A++)u[A]=d-1-A;var H=2*d;for(A=d-1;2<d;){if(0>=H--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}var K=
A;d<=K&&(K=0);A=K+1;d<=A&&(A=0);var M=A+1;d<=M&&(M=0);a:{var R;var O=a[u[K]].x;var P=a[u[K]].y;var Z=a[u[A]].x;var da=a[u[A]].y;var na=a[u[M]].x;var qa=a[u[M]].y;if(0>=(Z-O)*(qa-P)-(da-P)*(na-O))var sa=!1;else{var ba=na-Z;var oa=qa-da;var la=O-na;var wa=P-qa;var ya=Z-O;sa=da-P;for(R=0;R<d;R++){var Ca=a[u[R]].x;var Ja=a[u[R]].y;if(!(Ca===O&&Ja===P||Ca===Z&&Ja===da||Ca===na&&Ja===qa)){var Pa=Ca-O;var Na=Ja-P;var Ta=Ca-Z;var Qa=Ja-da;Ca-=na;Ja-=qa;Qa=ba*Qa-oa*Ta;Na=ya*Na-sa*Pa;Ca=la*Ja-wa*Ca;if(Qa>=
-Number.EPSILON&&Ca>=-Number.EPSILON&&Na>=-Number.EPSILON){sa=!1;break a}}}sa=!0}}if(sa){g.push([a[u[K]],a[u[A]],a[u[M]]]);x.push([u[K],u[A],u[M]]);K=A;for(M=A+1;M<d;K++,M++)u[K]=u[M];d--;H=2*d}}return c?x:g}}(),triangulateShape:function(a,c){function d(O){var P=O.length;2<P&&O[P-1].equals(O[0])&&O.pop()}function g(O,P,Z){return O.x!==P.x?O.x<P.x?O.x<=Z.x&&Z.x<=P.x:P.x<=Z.x&&Z.x<=O.x:O.y<P.y?O.y<=Z.y&&Z.y<=P.y:P.y<=Z.y&&Z.y<=O.y}function u(O,P,Z,da,na){var qa=P.x-O.x,sa=P.y-O.y,ba=da.x-Z.x,oa=da.y-
Z.y,la=O.x-Z.x,wa=O.y-Z.y,ya=sa*ba-qa*oa,Ca=sa*la-qa*wa;if(Math.abs(ya)>Number.EPSILON){if(0<ya){if(0>Ca||Ca>ya)return[];ba=oa*la-ba*wa;if(0>ba||ba>ya)return[]}else{if(0<Ca||Ca<ya)return[];ba=oa*la-ba*wa;if(0<ba||ba<ya)return[]}if(0===ba)return!na||0!==Ca&&Ca!==ya?[O]:[];if(ba===ya)return!na||0!==Ca&&Ca!==ya?[P]:[];if(0===Ca)return[Z];if(Ca===ya)return[da];na=ba/ya;return[{x:O.x+na*qa,y:O.y+na*sa}]}if(0!==Ca||oa*la!==ba*wa)return[];sa=0===qa&&0===sa;ba=0===ba&&0===oa;if(sa&&ba)return O.x!==Z.x||O.y!==
Z.y?[]:[O];if(sa)return g(Z,da,O)?[O]:[];if(ba)return g(O,P,Z)?[Z]:[];0!==qa?(O.x<P.x?(qa=O,ba=O.x,sa=P,O=P.x):(qa=P,ba=P.x,sa=O,O=O.x),Z.x<da.x?(P=Z,ya=Z.x,oa=da,Z=da.x):(P=da,ya=da.x,oa=Z,Z=Z.x)):(O.y<P.y?(qa=O,ba=O.y,sa=P,O=P.y):(qa=P,ba=P.y,sa=O,O=O.y),Z.y<da.y?(P=Z,ya=Z.y,oa=da,Z=da.y):(P=da,ya=da.y,oa=Z,Z=Z.y));return ba<=ya?O<ya?[]:O===ya?na?[]:[P]:O<=Z?[P,sa]:[P,oa]:ba>Z?[]:ba===Z?na?[]:[qa]:O<=Z?[qa,sa]:[qa,oa]}function x(O,P,Z,da){var na=P.x-O.x,qa=P.y-O.y;P=Z.x-O.x;Z=Z.y-O.y;var sa=da.x-
O.x;da=da.y-O.y;O=na*Z-qa*P;na=na*da-qa*sa;return Math.abs(O)>Number.EPSILON?(P=sa*Z-da*P,0<O?0<=na&&0<=P:0<=na||0<=P):0<na}d(a);c.forEach(d);var A,H={},K=a.concat();var M=0;for(A=c.length;M<A;M++)Array.prototype.push.apply(K,c[M]);M=0;for(A=K.length;M<A;M++){var R=K[M].x+":"+K[M].y;void 0!==H[R]&&console.warn("THREE.ShapeUtils: Duplicate point",R,M);H[R]=M}M=function(O,P){function Z(Xa,hb){var Ua=qa.length-1,Ma=Xa-1;0>Ma&&(Ma=Ua);var Sa=Xa+1;Sa>Ua&&(Sa=0);Ua=x(qa[Xa],qa[Ma],qa[Sa],Ta[hb]);if(!Ua)return!1;
Ua=Ta.length-1;Ma=hb-1;0>Ma&&(Ma=Ua);Sa=hb+1;Sa>Ua&&(Sa=0);return(Ua=x(Ta[hb],Ta[Ma],Ta[Sa],qa[Xa]))?!0:!1}function da(Xa,hb){var Ua;for(Ua=0;Ua<qa.length;Ua++){var Ma=Ua+1;Ma%=qa.length;Ma=u(Xa,hb,qa[Ua],qa[Ma],!0);if(0<Ma.length)return!0}return!1}function na(Xa,hb){var Ua,Ma;for(Ua=0;Ua<sa.length;Ua++){var Sa=P[sa[Ua]];for(Ma=0;Ma<Sa.length;Ma++){var Ga=Ma+1;Ga%=Sa.length;Ga=u(Xa,hb,Sa[Ma],Sa[Ga],!0);if(0<Ga.length)return!0}}return!1}var qa=O.concat(),sa=[],ba,oa;O=[];var la,wa=0;for(ba=P.length;wa<
ba;wa++)sa.push(wa);var ya=0;for(var Ca=2*sa.length;0<sa.length;){Ca--;if(0>Ca){console.log("Infinite Loop! Holes left:"+sa.length+", Probably Hole outside Shape!");break}for(oa=ya;oa<qa.length;oa++){var Ja=qa[oa];ba=-1;for(wa=0;wa<sa.length;wa++){var Pa=sa[wa];var Na=Ja.x+":"+Ja.y+":"+Pa;if(void 0===O[Na]){var Ta=P[Pa];for(la=0;la<Ta.length;la++)if(Pa=Ta[la],Z(oa,la)&&!da(Ja,Pa)&&!na(Ja,Pa)){ba=la;sa.splice(wa,1);ya=qa.slice(0,oa+1);Pa=qa.slice(oa);la=Ta.slice(ba);var Qa=Ta.slice(0,ba+1);qa=ya.concat(la).concat(Qa).concat(Pa);
ya=oa;break}if(0<=ba)break;O[Na]=!0}}if(0<=ba)break}}return qa}(a,c);K=Kc.triangulate(M,!1);M=0;for(A=K.length;M<A;M++)for(c=K[M],a=0;3>a;a++)R=c[a].x+":"+c[a].y,R=H[R],void 0!==R&&(c[a]=R);return K.concat()},isClockWise:function(a){return 0>Kc.area(a)}};Fc.prototype=Object.create(sb.prototype);Fc.prototype.constructor=Fc;Fc.prototype.addShapeList=function(a,c){for(var d=a.length,g=0;g<d;g++)this.addShape(a[g],c)};Fc.prototype.addShape=function(a,c){function d(pb,Ba,mb){Ba||console.error("THREE.ExtrudeGeometry: vec does not exist");
return Ba.clone().multiplyScalar(mb).add(pb)}function g(pb,Ba,mb){var nb=pb.x-Ba.x;var tb=pb.y-Ba.y;var eb=mb.x-pb.x;var yb=mb.y-pb.y,Eb=nb*nb+tb*tb;if(Math.abs(nb*yb-tb*eb)>Number.EPSILON){var Ib=Math.sqrt(Eb),Ub=Math.sqrt(eb*eb+yb*yb);Eb=Ba.x-tb/Ib;Ba=Ba.y+nb/Ib;yb=((mb.x-yb/Ub-Eb)*yb-(mb.y+eb/Ub-Ba)*eb)/(nb*yb-tb*eb);eb=Eb+nb*yb-pb.x;nb=Ba+tb*yb-pb.y;tb=eb*eb+nb*nb;if(2>=tb)return new k(eb,nb);tb=Math.sqrt(tb/2)}else pb=!1,nb>Number.EPSILON?eb>Number.EPSILON&&(pb=!0):nb<-Number.EPSILON?eb<-Number.EPSILON&&
(pb=!0):Math.sign(tb)===Math.sign(yb)&&(pb=!0),pb?(eb=-tb,tb=Math.sqrt(Eb)):(eb=nb,nb=tb,tb=Math.sqrt(Eb/2));return new k(eb/tb,nb/tb)}function u(pb,Ba){for(Ga=pb.length;0<=--Ga;){var mb=Ga;var nb=Ga-1;0>nb&&(nb=pb.length-1);var tb,eb=Z+2*R;for(tb=0;tb<eb;tb++){var yb=Ua*tb,Eb=Ua*(tb+1),Ib=Ba+mb+yb;yb=Ba+nb+yb;var Ub=Ba+nb+Eb;Eb=Ba+mb+Eb;Ib+=Ja;yb+=Ja;Ub+=Ja;Eb+=Ja;Ca.faces.push(new bc(Ib,yb,Eb,null,null,1));Ca.faces.push(new bc(yb,Ub,Eb,null,null,1));Ib=qa.generateSideWallUV(Ca,Ib,yb,Ub,Eb);Ca.faceVertexUvs[0].push([Ib[0],
Ib[1],Ib[3]]);Ca.faceVertexUvs[0].push([Ib[1],Ib[2],Ib[3]])}}}function x(pb,Ba,mb){Ca.vertices.push(new r(pb,Ba,mb))}function A(pb,Ba,mb){pb+=Ja;Ba+=Ja;mb+=Ja;Ca.faces.push(new bc(pb,Ba,mb,null,null,0));pb=qa.generateTopUV(Ca,pb,Ba,mb);Ca.faceVertexUvs[0].push(pb)}var H=void 0!==c.amount?c.amount:100,K=void 0!==c.bevelThickness?c.bevelThickness:6,M=void 0!==c.bevelSize?c.bevelSize:K-2,R=void 0!==c.bevelSegments?c.bevelSegments:3,O=void 0!==c.bevelEnabled?c.bevelEnabled:!0,P=void 0!==c.curveSegments?
c.curveSegments:12,Z=void 0!==c.steps?c.steps:1,da=c.extrudePath,na=!1,qa=void 0!==c.UVGenerator?c.UVGenerator:Fc.WorldUVGenerator;if(da){var sa=da.getSpacedPoints(Z);na=!0;O=!1;var ba=void 0!==c.frames?c.frames:da.computeFrenetFrames(Z,!1);var oa=new r;var la=new r;var wa=new r}O||(M=K=R=0);var ya,Ca=this,Ja=this.vertices.length;c=a.extractPoints(P);a=c.shape;var Pa=c.holes;if(c=!Kc.isClockWise(a)){a=a.reverse();var Na=0;for(ya=Pa.length;Na<ya;Na++){var Ta=Pa[Na];Kc.isClockWise(Ta)&&(Pa[Na]=Ta.reverse())}c=
!1}var Qa=Kc.triangulateShape(a,Pa),Xa=a;Na=0;for(ya=Pa.length;Na<ya;Na++)Ta=Pa[Na],a=a.concat(Ta);var hb,Ua=a.length,Ma,Sa=Qa.length;c=[];var Ga=0;var db=Xa.length;var Ya=db-1;for(hb=Ga+1;Ga<db;Ga++,Ya++,hb++)Ya===db&&(Ya=0),hb===db&&(hb=0),c[Ga]=g(Xa[Ga],Xa[Ya],Xa[hb]);P=[];da=c.concat();Na=0;for(ya=Pa.length;Na<ya;Na++){Ta=Pa[Na];var Cb=[];Ga=0;db=Ta.length;Ya=db-1;for(hb=Ga+1;Ga<db;Ga++,Ya++,hb++)Ya===db&&(Ya=0),hb===db&&(hb=0),Cb[Ga]=g(Ta[Ga],Ta[Ya],Ta[hb]);P.push(Cb);da=da.concat(Cb)}for(Ya=
0;Ya<R;Ya++){db=Ya/R;var Jb=K*Math.cos(db*Math.PI/2);hb=M*Math.sin(db*Math.PI/2);Ga=0;for(db=Xa.length;Ga<db;Ga++){var Kb=d(Xa[Ga],c[Ga],hb);x(Kb.x,Kb.y,-Jb)}Na=0;for(ya=Pa.length;Na<ya;Na++)for(Ta=Pa[Na],Cb=P[Na],Ga=0,db=Ta.length;Ga<db;Ga++)Kb=d(Ta[Ga],Cb[Ga],hb),x(Kb.x,Kb.y,-Jb)}hb=M;for(Ga=0;Ga<Ua;Ga++)Kb=O?d(a[Ga],da[Ga],hb):a[Ga],na?(la.copy(ba.normals[0]).multiplyScalar(Kb.x),oa.copy(ba.binormals[0]).multiplyScalar(Kb.y),wa.copy(sa[0]).add(la).add(oa),x(wa.x,wa.y,wa.z)):x(Kb.x,Kb.y,0);for(db=
1;db<=Z;db++)for(Ga=0;Ga<Ua;Ga++)Kb=O?d(a[Ga],da[Ga],hb):a[Ga],na?(la.copy(ba.normals[db]).multiplyScalar(Kb.x),oa.copy(ba.binormals[db]).multiplyScalar(Kb.y),wa.copy(sa[db]).add(la).add(oa),x(wa.x,wa.y,wa.z)):x(Kb.x,Kb.y,H/Z*db);for(Ya=R-1;0<=Ya;Ya--){db=Ya/R;Jb=K*Math.cos(db*Math.PI/2);hb=M*Math.sin(db*Math.PI/2);Ga=0;for(db=Xa.length;Ga<db;Ga++)Kb=d(Xa[Ga],c[Ga],hb),x(Kb.x,Kb.y,H+Jb);Na=0;for(ya=Pa.length;Na<ya;Na++)for(Ta=Pa[Na],Cb=P[Na],Ga=0,db=Ta.length;Ga<db;Ga++)Kb=d(Ta[Ga],Cb[Ga],hb),na?
x(Kb.x,Kb.y+sa[Z-1].y,sa[Z-1].x+Jb):x(Kb.x,Kb.y,H+Jb)}(function(){if(O){var pb=0*Ua;for(Ga=0;Ga<Sa;Ga++)Ma=Qa[Ga],A(Ma[2]+pb,Ma[1]+pb,Ma[0]+pb);pb=Ua*(Z+2*R);for(Ga=0;Ga<Sa;Ga++)Ma=Qa[Ga],A(Ma[0]+pb,Ma[1]+pb,Ma[2]+pb)}else{for(Ga=0;Ga<Sa;Ga++)Ma=Qa[Ga],A(Ma[2],Ma[1],Ma[0]);for(Ga=0;Ga<Sa;Ga++)Ma=Qa[Ga],A(Ma[0]+Ua*Z,Ma[1]+Ua*Z,Ma[2]+Ua*Z)}})();(function(){var pb=0;u(Xa,pb);pb+=Xa.length;Na=0;for(ya=Pa.length;Na<ya;Na++)Ta=Pa[Na],u(Ta,pb),pb+=Ta.length})()};Fc.WorldUVGenerator={generateTopUV:function(a,
c,d,g){a=a.vertices;c=a[c];d=a[d];g=a[g];return[new k(c.x,c.y),new k(d.x,d.y),new k(g.x,g.y)]},generateSideWallUV:function(a,c,d,g,u){a=a.vertices;c=a[c];d=a[d];g=a[g];u=a[u];return.01>Math.abs(c.y-d.y)?[new k(c.x,1-c.z),new k(d.x,1-d.z),new k(g.x,1-g.z),new k(u.x,1-u.z)]:[new k(c.y,1-c.z),new k(d.y,1-d.z),new k(g.y,1-g.z),new k(u.y,1-u.z)]}};Ke.prototype=Object.create(Fc.prototype);Ke.prototype.constructor=Ke;Le.prototype=Object.create(sb.prototype);Le.prototype.constructor=Le;rd.prototype=Object.create(ob.prototype);
rd.prototype.constructor=rd;Me.prototype=Object.create(sb.prototype);Me.prototype.constructor=Me;Wd.prototype=Object.create(ob.prototype);Wd.prototype.constructor=Wd;Ne.prototype=Object.create(sb.prototype);Ne.prototype.constructor=Ne;Xd.prototype=Object.create(ob.prototype);Xd.prototype.constructor=Xd;Yd.prototype=Object.create(sb.prototype);Yd.prototype.constructor=Yd;Zd.prototype=Object.create(ob.prototype);Zd.prototype.constructor=Zd;$d.prototype=Object.create(ob.prototype);$d.prototype.constructor=
$d;sd.prototype=Object.create(sb.prototype);sd.prototype.constructor=sd;$c.prototype=Object.create(ob.prototype);$c.prototype.constructor=$c;Oe.prototype=Object.create(sd.prototype);Oe.prototype.constructor=Oe;Pe.prototype=Object.create($c.prototype);Pe.prototype.constructor=Pe;Qe.prototype=Object.create(sb.prototype);Qe.prototype.constructor=Qe;ae.prototype=Object.create(ob.prototype);ae.prototype.constructor=ae;var Oc=Object.freeze({WireframeGeometry:Od,ParametricGeometry:Be,ParametricBufferGeometry:Pd,
TetrahedronGeometry:De,TetrahedronBufferGeometry:Qd,OctahedronGeometry:Ee,OctahedronBufferGeometry:qd,IcosahedronGeometry:Fe,IcosahedronBufferGeometry:Rd,DodecahedronGeometry:Ge,DodecahedronBufferGeometry:Sd,PolyhedronGeometry:Ce,PolyhedronBufferGeometry:qc,TubeGeometry:He,TubeBufferGeometry:Td,TorusKnotGeometry:Ie,TorusKnotBufferGeometry:Ud,TorusGeometry:Je,TorusBufferGeometry:Vd,TextGeometry:Ke,SphereGeometry:Le,SphereBufferGeometry:rd,RingGeometry:Me,RingBufferGeometry:Wd,PlaneGeometry:ua,PlaneBufferGeometry:Da,
LatheGeometry:Ne,LatheBufferGeometry:Xd,ShapeGeometry:Yd,ShapeBufferGeometry:Zd,ExtrudeGeometry:Fc,EdgesGeometry:$d,ConeGeometry:Oe,ConeBufferGeometry:Pe,CylinderGeometry:sd,CylinderBufferGeometry:$c,CircleGeometry:Qe,CircleBufferGeometry:ae,BoxGeometry:oc,BoxBufferGeometry:pc});be.prototype=Object.create(kb.prototype);be.prototype.constructor=be;be.prototype.isShadowMaterial=!0;ce.prototype=Object.create(kb.prototype);ce.prototype.constructor=ce;ce.prototype.isRawShaderMaterial=!0;Object.assign(rf.prototype,
{isMultiMaterial:!0,toJSON:function(a){for(var c={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},d=this.materials,g=0,u=d.length;g<u;g++){var x=d[g].toJSON(a);delete x.metadata;c.materials.push(x)}c.visible=this.visible;return c},clone:function(){for(var a=new this.constructor,c=0;c<this.materials.length;c++)a.materials.push(this.materials[c].clone());a.visible=this.visible;return a}});Wc.prototype=Object.create(Za.prototype);Wc.prototype.constructor=
Wc;Wc.prototype.isMeshStandardMaterial=!0;Wc.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;
this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=
a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};td.prototype=Object.create(Wc.prototype);td.prototype.constructor=td;td.prototype.isMeshPhysicalMaterial=!0;td.prototype.copy=function(a){Wc.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};Lc.prototype=Object.create(Za.prototype);Lc.prototype.constructor=
Lc;Lc.prototype.isMeshPhongMaterial=!0;Lc.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;
this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=
a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};ud.prototype=Object.create(Lc.prototype);ud.prototype.constructor=ud;ud.prototype.isMeshToonMaterial=!0;ud.prototype.copy=function(a){Lc.prototype.copy.call(this,a);this.gradientMap=a.gradientMap;return this};vd.prototype=Object.create(Za.prototype);vd.prototype.constructor=vd;vd.prototype.isMeshNormalMaterial=!0;vd.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.bumpMap=a.bumpMap;this.bumpScale=
a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};wd.prototype=Object.create(Za.prototype);wd.prototype.constructor=wd;wd.prototype.isMeshLambertMaterial=!0;wd.prototype.copy=function(a){Za.prototype.copy.call(this,
a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;
this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};xd.prototype=Object.create(Za.prototype);xd.prototype.constructor=xd;xd.prototype.isLineDashedMaterial=!0;xd.prototype.copy=function(a){Za.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};var ah=Object.freeze({ShadowMaterial:be,
SpriteMaterial:pd,RawShaderMaterial:ce,ShaderMaterial:kb,PointsMaterial:Jc,MultiMaterial:rf,MeshPhysicalMaterial:td,MeshStandardMaterial:Wc,MeshPhongMaterial:Lc,MeshToonMaterial:ud,MeshNormalMaterial:vd,MeshLambertMaterial:wd,MeshDepthMaterial:Hb,MeshBasicMaterial:hc,LineDashedMaterial:xd,LineBasicMaterial:$b,Material:Za}),df={enabled:!1,files:{},add:function(a,c){!1!==this.enabled&&(this.files[a]=c)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},
clear:function(){this.files={}}},zc=new Wf;Object.assign(Mc.prototype,{load:function(a,c,d,g){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);var u=this,x=df.get(a);if(void 0!==x)return u.manager.itemStart(a),setTimeout(function(){c&&c(x);u.manager.itemEnd(a)},0),x;var A=a.match(/^data:(.*?)(;base64)?,(.*)$/);if(A){var H=A[1],K=!!A[2];A=A[3];A=window.decodeURIComponent(A);K&&(A=window.atob(A));try{var M=(this.responseType||"").toLowerCase();switch(M){case "arraybuffer":case "blob":var R=new ArrayBuffer(A.length);
var O=new Uint8Array(R);for(K=0;K<A.length;K++)O[K]=A.charCodeAt(K);"blob"===M&&(R=new Blob([R],{type:H}));break;case "document":R=(new DOMParser).parseFromString(A,H);break;case "json":R=JSON.parse(A);break;default:R=A}window.setTimeout(function(){c&&c(R);u.manager.itemEnd(a)},0)}catch(Z){window.setTimeout(function(){g&&g(Z);u.manager.itemError(a)},0)}}else{var P=new XMLHttpRequest;P.open("GET",a,!0);P.addEventListener("load",function(Z){var da=Z.target.response;df.add(a,da);200===this.status?(c&&
c(da),u.manager.itemEnd(a)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),c&&c(da),u.manager.itemEnd(a)):(g&&g(Z),u.manager.itemError(a))},!1);void 0!==d&&P.addEventListener("progress",function(Z){d(Z)},!1);P.addEventListener("error",function(Z){g&&g(Z);u.manager.itemError(a)},!1);void 0!==this.responseType&&(P.responseType=this.responseType);void 0!==this.withCredentials&&(P.withCredentials=this.withCredentials);P.overrideMimeType&&P.overrideMimeType(void 0!==this.mimeType?
this.mimeType:"text/plain");P.send(null)}u.manager.itemStart(a);return P},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setMimeType:function(a){this.mimeType=a;return this}});Object.assign(zg.prototype,{load:function(a,c,d,g){function u(P){K.load(a[P],function(Z){Z=x._parser(Z,!0);A[P]={width:Z.width,height:Z.height,format:Z.format,mipmaps:Z.mipmaps};M+=1;6===M&&(1===Z.mipmapCount&&
(H.minFilter=1006),H.format=Z.format,H.needsUpdate=!0,c&&c(H))},d,g)}var x=this,A=[],H=new Nd;H.image=A;var K=new Mc(this.manager);K.setPath(this.path);K.setResponseType("arraybuffer");if(Array.isArray(a))for(var M=0,R=0,O=a.length;R<O;++R)u(R);else K.load(a,function(P){P=x._parser(P,!0);if(P.isCubemap)for(var Z=P.mipmaps.length/P.mipmapCount,da=0;da<Z;da++){A[da]={mipmaps:[]};for(var na=0;na<P.mipmapCount;na++)A[da].mipmaps.push(P.mipmaps[da*P.mipmapCount+na]),A[da].format=P.format,A[da].width=P.width,
A[da].height=P.height}else H.image.width=P.width,H.image.height=P.height,H.mipmaps=P.mipmaps;1===P.mipmapCount&&(H.minFilter=1006);H.format=P.format;H.needsUpdate=!0;c&&c(H)},d,g);return H},setPath:function(a){this.path=a;return this}});Object.assign(Xf.prototype,{load:function(a,c,d,g){var u=this,x=new va,A=new Mc(this.manager);A.setResponseType("arraybuffer");A.load(a,function(H){if(H=u._parser(H))void 0!==H.image?x.image=H.image:void 0!==H.data&&(x.image.width=H.width,x.image.height=H.height,x.image.data=
H.data),x.wrapS=void 0!==H.wrapS?H.wrapS:1001,x.wrapT=void 0!==H.wrapT?H.wrapT:1001,x.magFilter=void 0!==H.magFilter?H.magFilter:1006,x.minFilter=void 0!==H.minFilter?H.minFilter:1008,x.anisotropy=void 0!==H.anisotropy?H.anisotropy:1,void 0!==H.format&&(x.format=H.format),void 0!==H.type&&(x.type=H.type),void 0!==H.mipmaps&&(x.mipmaps=H.mipmaps),1===H.mipmapCount&&(x.minFilter=1006),x.needsUpdate=!0,c&&c(x,H)},d,g);return x}});Object.assign(Re.prototype,{load:function(a,c,d,g){void 0===a&&(a="");
void 0!==this.path&&(a=this.path+a);var u=this,x=df.get(a);if(void 0!==x)return u.manager.itemStart(a),setTimeout(function(){c&&c(x);u.manager.itemEnd(a)},0),x;d=document.createElementNS("http://www.w3.org/1999/xhtml","img");d.addEventListener("load",function(){df.add(a,this);c&&c(this);u.manager.itemEnd(a)},!1);d.addEventListener("error",function(A){g&&g(A);u.manager.itemError(a)},!1);void 0!==this.crossOrigin&&(d.crossOrigin=this.crossOrigin);u.manager.itemStart(a);d.src=a;return d},setCrossOrigin:function(a){this.crossOrigin=
a;return this},setPath:function(a){this.path=a;return this}});Object.assign(Yf.prototype,{load:function(a,c,d,g){function u(K){A.load(a[K],function(M){x.images[K]=M;H++;6===H&&(x.needsUpdate=!0,c&&c(x))},void 0,g)}var x=new z,A=new Re(this.manager);A.setCrossOrigin(this.crossOrigin);A.setPath(this.path);var H=0;for(d=0;d<a.length;++d)u(d);return x},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(sf.prototype,{load:function(a,
c,d,g){var u=new e,x=new Re(this.manager);x.setCrossOrigin(this.crossOrigin);x.setPath(this.path);x.load(a,function(A){var H=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data:image\/jpeg/);u.format=H?1022:1023;u.image=A;u.needsUpdate=!0;void 0!==c&&c(u)},d,g);return u},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});ac.prototype=Object.assign(Object.create(lb.prototype),{constructor:ac,isLight:!0,copy:function(a){lb.prototype.copy.call(this,
a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=lb.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&
(a.object.shadow=this.shadow.toJSON());return a}});tf.prototype=Object.assign(Object.create(ac.prototype),{constructor:tf,isHemisphereLight:!0,copy:function(a){ac.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);return this}});Object.assign(yd.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=
this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;return a}});uf.prototype=Object.assign(Object.create(yd.prototype),{constructor:uf,isSpotLightShadow:!0,update:function(a){var c=2*xb.RAD2DEG*a.angle,d=this.mapSize.width/this.mapSize.height;a=a.distance||500;var g=this.camera;if(c!==g.fov||d!==g.aspect||a!==g.far)g.fov=c,g.aspect=d,g.far=a,g.updateProjectionMatrix()}});
vf.prototype=Object.assign(Object.create(ac.prototype),{constructor:vf,isSpotLight:!0,copy:function(a){ac.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});wf.prototype=Object.assign(Object.create(ac.prototype),{constructor:wf,isPointLight:!0,copy:function(a){ac.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();
return this}});xf.prototype=Object.assign(Object.create(yd.prototype),{constructor:xf});yf.prototype=Object.assign(Object.create(ac.prototype),{constructor:yf,isDirectionalLight:!0,copy:function(a){ac.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});zf.prototype=Object.assign(Object.create(ac.prototype),{constructor:zf,isAmbientLight:!0});var kc={arraySlice:function(a,c,d){return kc.isTypedArray(a)?new a.constructor(a.subarray(c,d)):a.slice(c,d)},
convertArray:function(a,c,d){return!a||!d&&a.constructor===c?a:"number"===typeof c.BYTES_PER_ELEMENT?new c(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var c=a.length,d=Array(c),g=0;g!==c;++g)d[g]=g;d.sort(function(u,x){return a[u]-a[x]});return d},sortedArray:function(a,c,d){for(var g=a.length,u=new a.constructor(g),x=0,A=0;A!==g;++x)for(var H=d[x]*c,K=0;K!==c;++K)u[A++]=a[H+K];return u},flattenJSON:function(a,
c,d,g){for(var u=1,x=a[0];void 0!==x&&void 0===x[g];)x=a[u++];if(void 0!==x){var A=x[g];if(void 0!==A)if(Array.isArray(A)){do A=x[g],void 0!==A&&(c.push(x.time),d.push.apply(d,A)),x=a[u++];while(void 0!==x)}else if(void 0!==A.toArray){do A=x[g],void 0!==A&&(c.push(x.time),A.toArray(d,d.length)),x=a[u++];while(void 0!==x)}else{do A=x[g],void 0!==A&&(c.push(x.time),d.push(A)),x=a[u++];while(void 0!==x)}}}};Object.assign(Ac.prototype,{evaluate:function(a){var c=this.parameterPositions,d=this._cachedIndex,
g=c[d],u=c[d-1];a:{b:{c:{d:if(!(a<g)){for(var x=d+2;;){if(void 0===g){if(a<u)break d;this._cachedIndex=d=c.length;return this.afterEnd_(d-1,a,u)}if(d===x)break;u=g;g=c[++d];if(a<g)break b}g=c.length;break c}if(a>=u)break a;else{x=c[1];a<x&&(d=2,u=x);for(x=d-2;;){if(void 0===u)return this._cachedIndex=0,this.beforeStart_(0,a,g);if(d===x)break;g=u;u=c[--d-1];if(a>=u)break b}g=d;d=0}}for(;d<g;)u=d+g>>>1,a<c[u]?g=u:d=u+1;g=c[d];u=c[d-1];if(void 0===u)return this._cachedIndex=0,this.beforeStart_(0,a,g);
if(void 0===g)return this._cachedIndex=d=c.length,this.afterEnd_(d-1,u,a)}this._cachedIndex=d;this.intervalChanged_(d,u,g)}return this.interpolate_(d,u,a,g)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var c=this.resultBuffer,d=this.sampleValues,g=this.valueSize;a*=g;for(var u=0;u!==g;++u)c[u]=d[a+u];return c},interpolate_:function(a,c,d,g){throw Error("call to abstract method");},intervalChanged_:function(a,c,
d){}});Object.assign(Ac.prototype,{beforeStart_:Ac.prototype.copySampleValue_,afterEnd_:Ac.prototype.copySampleValue_});Af.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Af,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,c,d){var g=this.parameterPositions,u=a-2,x=a+1,A=g[u],H=g[x];if(void 0===A)switch(this.getSettings_().endingStart){case 2401:u=a;A=2*c-d;break;case 2402:u=g.length-2;A=c+g[u]-g[u+1];break;default:u=a,A=d}if(void 0===H)switch(this.getSettings_().endingEnd){case 2401:x=
a;H=2*d-c;break;case 2402:x=1;H=d+g[1]-g[0];break;default:x=a-1,H=c}a=.5*(d-c);g=this.valueSize;this._weightPrev=a/(c-A);this._weightNext=a/(H-d);this._offsetPrev=u*g;this._offsetNext=x*g},interpolate_:function(a,c,d,g){var u=this.resultBuffer,x=this.sampleValues,A=this.valueSize;a*=A;var H=a-A,K=this._offsetPrev,M=this._offsetNext,R=this._weightPrev,O=this._weightNext,P=(d-c)/(g-c);d=P*P;g=d*P;c=-R*g+2*R*d-R*P;R=(1+R)*g+(-1.5-2*R)*d+(-.5+R)*P+1;P=(-1-O)*g+(1.5+O)*d+.5*P;O=O*g-O*d;for(d=0;d!==A;++d)u[d]=
c*x[K+d]+R*x[H+d]+P*x[a+d]+O*x[M+d];return u}});Se.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Se,interpolate_:function(a,c,d,g){var u=this.resultBuffer,x=this.sampleValues,A=this.valueSize;a*=A;var H=a-A;c=(d-c)/(g-c);d=1-c;for(g=0;g!==A;++g)u[g]=x[H+g]*d+x[a+g]*c;return u}});Bf.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Bf,interpolate_:function(a,c,d,g){return this.copySampleValue_(a-1)}});var jd={TimeBufferType:Float32Array,ValueBufferType:Float32Array,
DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new Bf(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new Se(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new Af(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){switch(a){case 2300:var c=this.InterpolantFactoryMethodDiscrete;break;case 2301:c=this.InterpolantFactoryMethodLinear;break;case 2302:c=
this.InterpolantFactoryMethodSmooth}if(void 0===c){c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw Error(c);console.warn(c)}else this.createInterpolant=c},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},
getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var c=this.times,d=0,g=c.length;d!==g;++d)c[d]+=a;return this},scale:function(a){if(1!==a)for(var c=this.times,d=0,g=c.length;d!==g;++d)c[d]*=a;return this},trim:function(a,c){for(var d=this.times,g=d.length,u=0,x=g-1;u!==g&&d[u]<a;)++u;for(;-1!==x&&d[x]>c;)--x;++x;if(0!==u||x!==g)u>=x&&(x=Math.max(x,1),u=x-1),a=this.getValueSize(),this.times=kc.arraySlice(d,u,x),this.values=kc.arraySlice(this.values,
u*a,x*a);return this},validate:function(){var a=!0,c=this.getValueSize();0!==c-Math.floor(c)&&(console.error("invalid value size in track",this),a=!1);var d=this.times;c=this.values;var g=d.length;0===g&&(console.error("track is empty",this),a=!1);for(var u=null,x=0;x!==g;x++){var A=d[x];if("number"===typeof A&&isNaN(A)){console.error("time is not a valid number",this,x,A);a=!1;break}if(null!==u&&u>A){console.error("out of order keys",this,x,A,u);a=!1;break}u=A}if(void 0!==c&&kc.isTypedArray(c))for(x=
0,d=c.length;x!==d;++x)if(g=c[x],isNaN(g)){console.error("value is not a valid number",this,x,g);a=!1;break}return a},optimize:function(){for(var a=this.times,c=this.values,d=this.getValueSize(),g=2302===this.getInterpolation(),u=1,x=a.length-1,A=1;A<x;++A){var H=!1,K=a[A];if(K!==a[A+1]&&(1!==A||K!==K[0]))if(g)H=!0;else{var M=A*d,R=M-d,O=M+d;for(K=0;K!==d;++K){var P=c[M+K];if(P!==c[R+K]||P!==c[O+K]){H=!0;break}}}if(H){if(A!==u)for(a[u]=a[A],H=A*d,M=u*d,K=0;K!==d;++K)c[M+K]=c[H+K];++u}}if(0<x){a[u]=
a[x];H=x*d;M=u*d;for(K=0;K!==d;++K)c[M+K]=c[H+K];++u}u!==a.length&&(this.times=kc.arraySlice(a,0,u),this.values=kc.arraySlice(c,0,u*d));return this}};de.prototype=Object.assign(Object.create(jd),{constructor:de,ValueTypeName:"vector"});Cf.prototype=Object.assign(Object.create(Ac.prototype),{constructor:Cf,interpolate_:function(a,c,d,g){var u=this.resultBuffer,x=this.sampleValues,A=this.valueSize;a*=A;c=(d-c)/(g-c);for(d=a+A;a!==d;a+=4)t.slerpFlat(u,0,x,a-A,x,a,c);return u}});Te.prototype=Object.assign(Object.create(jd),
{constructor:Te,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new Cf(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});ee.prototype=Object.assign(Object.create(jd),{constructor:ee,ValueTypeName:"number"});Df.prototype=Object.assign(Object.create(jd),{constructor:Df,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});
Ef.prototype=Object.assign(Object.create(jd),{constructor:Ef,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});Ff.prototype=Object.assign(Object.create(jd),{constructor:Ff,ValueTypeName:"color"});Ad.prototype=jd;jd.constructor=Ad;Object.assign(Ad,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var c=Ad._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var d=
[],g=[];kc.flattenJSON(a.keys,d,g,"value");a.times=d;a.values=g}return void 0!==c.parse?c.parse(a):new c(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var c=a.constructor;if(void 0!==c.toJSON)c=c.toJSON(a);else{c={name:a.name,times:kc.convertArray(a.times,Array),values:kc.convertArray(a.values,Array)};var d=a.getInterpolation();d!==a.DefaultInterpolation&&(c.interpolation=d)}c.type=a.ValueTypeName;return c},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return ee;
case "vector":case "vector2":case "vector3":case "vector4":return de;case "color":return Ff;case "quaternion":return Te;case "bool":case "boolean":return Ef;case "string":return Df}throw Error("Unsupported typeName: "+a);}});Object.assign(Gc,{parse:function(a){for(var c=[],d=a.tracks,g=1/(a.fps||1),u=0,x=d.length;u!==x;++u)c.push(Ad.parse(d[u]).scale(g));return new Gc(a.name,a.duration,c)},toJSON:function(a){var c=[],d=a.tracks;a={name:a.name,duration:a.duration,tracks:c};for(var g=0,u=d.length;g!==
u;++g)c.push(Ad.toJSON(d[g]));return a},CreateFromMorphTargetSequence:function(a,c,d,g){for(var u=c.length,x=[],A=0;A<u;A++){var H=[],K=[];H.push((A+u-1)%u,A,(A+1)%u);K.push(0,1,0);var M=kc.getKeyframeOrder(H);H=kc.sortedArray(H,1,M);K=kc.sortedArray(K,1,M);g||0!==H[0]||(H.push(u),K.push(K[0]));x.push((new ee(".morphTargetInfluences["+c[A].name+"]",H,K)).scale(1/d))}return new Gc(a,-1,x)},findByName:function(a,c){var d=a;Array.isArray(a)||(d=a.geometry&&a.geometry.animations||a.animations);for(a=
0;a<d.length;a++)if(d[a].name===c)return d[a];return null},CreateClipsFromMorphTargetSequences:function(a,c,d){for(var g={},u=/^([\w-]*?)([\d]+)$/,x=0,A=a.length;x<A;x++){var H=a[x],K=H.name.match(u);if(K&&1<K.length){var M=K[1];(K=g[M])||(g[M]=K=[]);K.push(H)}}a=[];for(M in g)a.push(Gc.CreateFromMorphTargetSequence(M,g[M],c,d));return a},parseAnimation:function(a,c){if(!a)return console.error("  no animation in JSONLoader data"),null;var d=function(na,qa,sa,ba,oa){if(0!==sa.length){var la=[],wa=
[];kc.flattenJSON(sa,la,wa,ba);0!==la.length&&oa.push(new na(qa,la,wa))}},g=[],u=a.name||"default",x=a.length||-1,A=a.fps||30;a=a.hierarchy||[];for(var H=0;H<a.length;H++){var K=a[H].keys;if(K&&0!==K.length)if(K[0].morphTargets){x={};for(var M=0;M<K.length;M++)if(K[M].morphTargets)for(var R=0;R<K[M].morphTargets.length;R++)x[K[M].morphTargets[R]]=-1;for(var O in x){var P=[],Z=[];for(R=0;R!==K[M].morphTargets.length;++R){var da=K[M];P.push(da.time);Z.push(da.morphTarget===O?1:0)}g.push(new ee(".morphTargetInfluence["+
O+"]",P,Z))}x=x.length*(A||1)}else M=".bones["+c[H].name+"]",d(de,M+".position",K,"pos",g),d(Te,M+".quaternion",K,"rot",g),d(de,M+".scale",K,"scl",g)}return 0===g.length?null:new Gc(u,x,g)}});Object.assign(Gc.prototype,{resetDuration:function(){for(var a=0,c=0,d=this.tracks.length;c!==d;++c){var g=this.tracks[c];a=Math.max(a,g.times[g.times.length-1])}this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=
0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}});Object.assign(Gf.prototype,{load:function(a,c,d,g){var u=this;(new Mc(u.manager)).load(a,function(x){c(u.parse(JSON.parse(x)))},d,g)},setTextures:function(a){this.textures=a},parse:function(a){function c(A){void 0===d[A]&&console.warn("THREE.MaterialLoader: Undefined texture",A);return d[A]}var d=this.textures,g=new ah[a.type];void 0!==a.uuid&&(g.uuid=a.uuid);void 0!==a.name&&(g.name=a.name);void 0!==a.color&&g.color.setHex(a.color);
void 0!==a.roughness&&(g.roughness=a.roughness);void 0!==a.metalness&&(g.metalness=a.metalness);void 0!==a.emissive&&g.emissive.setHex(a.emissive);void 0!==a.specular&&g.specular.setHex(a.specular);void 0!==a.shininess&&(g.shininess=a.shininess);void 0!==a.clearCoat&&(g.clearCoat=a.clearCoat);void 0!==a.clearCoatRoughness&&(g.clearCoatRoughness=a.clearCoatRoughness);void 0!==a.uniforms&&(g.uniforms=a.uniforms);void 0!==a.vertexShader&&(g.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(g.fragmentShader=
a.fragmentShader);void 0!==a.vertexColors&&(g.vertexColors=a.vertexColors);void 0!==a.fog&&(g.fog=a.fog);void 0!==a.shading&&(g.shading=a.shading);void 0!==a.blending&&(g.blending=a.blending);void 0!==a.side&&(g.side=a.side);void 0!==a.opacity&&(g.opacity=a.opacity);void 0!==a.transparent&&(g.transparent=a.transparent);void 0!==a.alphaTest&&(g.alphaTest=a.alphaTest);void 0!==a.depthTest&&(g.depthTest=a.depthTest);void 0!==a.depthWrite&&(g.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(g.colorWrite=
a.colorWrite);void 0!==a.wireframe&&(g.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(g.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(g.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(g.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.skinning&&(g.skinning=a.skinning);void 0!==a.morphTargets&&(g.morphTargets=a.morphTargets);void 0!==a.size&&(g.size=a.size);void 0!==a.sizeAttenuation&&(g.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(g.map=
c(a.map));void 0!==a.alphaMap&&(g.alphaMap=c(a.alphaMap),g.transparent=!0);void 0!==a.bumpMap&&(g.bumpMap=c(a.bumpMap));void 0!==a.bumpScale&&(g.bumpScale=a.bumpScale);void 0!==a.normalMap&&(g.normalMap=c(a.normalMap));if(void 0!==a.normalScale){var u=a.normalScale;!1===Array.isArray(u)&&(u=[u,u]);g.normalScale=(new k).fromArray(u)}void 0!==a.displacementMap&&(g.displacementMap=c(a.displacementMap));void 0!==a.displacementScale&&(g.displacementScale=a.displacementScale);void 0!==a.displacementBias&&
(g.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(g.roughnessMap=c(a.roughnessMap));void 0!==a.metalnessMap&&(g.metalnessMap=c(a.metalnessMap));void 0!==a.emissiveMap&&(g.emissiveMap=c(a.emissiveMap));void 0!==a.emissiveIntensity&&(g.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(g.specularMap=c(a.specularMap));void 0!==a.envMap&&(g.envMap=c(a.envMap));void 0!==a.reflectivity&&(g.reflectivity=a.reflectivity);void 0!==a.lightMap&&(g.lightMap=c(a.lightMap));void 0!==
a.lightMapIntensity&&(g.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(g.aoMap=c(a.aoMap));void 0!==a.aoMapIntensity&&(g.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(g.gradientMap=c(a.gradientMap));if(void 0!==a.materials){u=0;for(var x=a.materials.length;u<x;u++)g.materials.push(this.parse(a.materials[u]))}return g}});Object.assign(Zf.prototype,{load:function(a,c,d,g){var u=this;(new Mc(u.manager)).load(a,function(x){c(u.parse(JSON.parse(x)))},d,g)},parse:function(a){var c=
new ob,d=a.data.index,g={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};void 0!==d&&(d=new g[d.type](d.array),c.setIndex(new zb(d,1)));var u=a.data.attributes;for(A in u){var x=u[A];d=new g[x.type](x.array);c.addAttribute(A,new zb(d,x.itemSize,x.normalized))}g=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==g){var A=0;for(d=g.length;A!==d;++A)u=g[A],c.addGroup(u.start,u.count,u.materialIndex)}a=a.data.boundingSphere;void 0!==
a&&(g=new r,void 0!==a.center&&g.fromArray(a.center),c.boundingSphere=new Nb(g,a.radius));return c}});fe.Handlers={handlers:[],add:function(a,c){this.handlers.push(a,c)},get:function(a){for(var c=this.handlers,d=0,g=c.length;d<g;d+=2){var u=c[d+1];if(c[d].test(a))return u}return null}};Object.assign(fe.prototype,{crossOrigin:void 0,extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,c,d){for(var g=[],u=0;u<a.length;++u)g[u]=
this.createMaterial(a[u],c,d);return g},createMaterial:function(){var a={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},c=new ka,d=new sf,g=new Gf;return function(u,x,A){function H(P,Z,da,na,qa){P=x+P;var sa=fe.Handlers.get(P);null!==sa?P=sa.load(P):(d.setCrossOrigin(A),P=d.load(P));void 0!==Z&&(P.repeat.fromArray(Z),1!==Z[0]&&(P.wrapS=1E3),1!==Z[1]&&(P.wrapT=1E3));void 0!==da&&P.offset.fromArray(da);void 0!==na&&("repeat"===na[0]&&(P.wrapS=
1E3),"mirror"===na[0]&&(P.wrapS=1002),"repeat"===na[1]&&(P.wrapT=1E3),"mirror"===na[1]&&(P.wrapT=1002));void 0!==qa&&(P.anisotropy=qa);Z=xb.generateUUID();K[Z]=P;return Z}var K={},M={uuid:xb.generateUUID(),type:"MeshLambertMaterial"},R;for(R in u){var O=u[R];switch(R){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":M.name=O;break;case "blending":M.blending=a[O];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",R,
"is no longer supported.");break;case "colorDiffuse":M.color=c.fromArray(O).getHex();break;case "colorSpecular":M.specular=c.fromArray(O).getHex();break;case "colorEmissive":M.emissive=c.fromArray(O).getHex();break;case "specularCoef":M.shininess=O;break;case "shading":"basic"===O.toLowerCase()&&(M.type="MeshBasicMaterial");"phong"===O.toLowerCase()&&(M.type="MeshPhongMaterial");"standard"===O.toLowerCase()&&(M.type="MeshStandardMaterial");break;case "mapDiffuse":M.map=H(O,u.mapDiffuseRepeat,u.mapDiffuseOffset,
u.mapDiffuseWrap,u.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":M.emissiveMap=H(O,u.mapEmissiveRepeat,u.mapEmissiveOffset,u.mapEmissiveWrap,u.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":M.lightMap=H(O,u.mapLightRepeat,u.mapLightOffset,u.mapLightWrap,u.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;
case "mapAO":M.aoMap=H(O,u.mapAORepeat,u.mapAOOffset,u.mapAOWrap,u.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":M.bumpMap=H(O,u.mapBumpRepeat,u.mapBumpOffset,u.mapBumpWrap,u.mapBumpAnisotropy);break;case "mapBumpScale":M.bumpScale=O;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":M.normalMap=H(O,u.mapNormalRepeat,u.mapNormalOffset,u.mapNormalWrap,u.mapNormalAnisotropy);
break;case "mapNormalFactor":M.normalScale=[O,O];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":M.specularMap=H(O,u.mapSpecularRepeat,u.mapSpecularOffset,u.mapSpecularWrap,u.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":M.metalnessMap=H(O,u.mapMetalnessRepeat,u.mapMetalnessOffset,u.mapMetalnessWrap,u.mapMetalnessAnisotropy);
break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":M.roughnessMap=H(O,u.mapRoughnessRepeat,u.mapRoughnessOffset,u.mapRoughnessWrap,u.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":M.alphaMap=H(O,u.mapAlphaRepeat,u.mapAlphaOffset,u.mapAlphaWrap,u.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;
case "flipSided":M.side=1;break;case "doubleSided":M.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");M.opacity=O;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":M[R]=O;break;case "vertexColors":!0===O&&(M.vertexColors=2);"face"===O&&(M.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",R,O)}}"MeshBasicMaterial"===
M.type&&delete M.emissive;"MeshPhongMaterial"!==M.type&&delete M.specular;1>M.opacity&&(M.transparent=!0);g.setTextures(K);return g.parse(M)}}()});Object.assign($f.prototype,{load:function(a,c,d,g){var u=this,x=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:fe.prototype.extractUrlBase(a),A=new Mc(this.manager);A.setWithCredentials(this.withCredentials);A.load(a,function(H){H=JSON.parse(H);var K=H.metadata;if(void 0!==K&&(K=K.type,void 0!==K)){if("object"===K.toLowerCase()){console.error("THREE.JSONLoader: "+
a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===K.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");return}}H=u.parse(H,x);c(H.geometry,H.materials)},d,g)},setTexturePath:function(a){this.texturePath=a},parse:function(a,c){var d=new sb,g=void 0!==a.scale?1/a.scale:1;(function(u){var x,A,H,K=a.faces;var M=a.vertices;var R=a.normals,O=a.colors,P=0;if(void 0!==a.uvs){for(x=0;x<a.uvs.length;x++)a.uvs[x].length&&P++;for(x=
0;x<P;x++)d.faceVertexUvs[x]=[]}var Z=0;for(H=M.length;Z<H;)x=new r,x.x=M[Z++]*u,x.y=M[Z++]*u,x.z=M[Z++]*u,d.vertices.push(x);Z=0;for(H=K.length;Z<H;){u=K[Z++];var da=u&1;var na=u&2;x=u&8;var qa=u&16;var sa=u&32;M=u&64;u&=128;if(da){da=new bc;da.a=K[Z];da.b=K[Z+1];da.c=K[Z+3];var ba=new bc;ba.a=K[Z+1];ba.b=K[Z+2];ba.c=K[Z+3];Z+=4;na&&(na=K[Z++],da.materialIndex=na,ba.materialIndex=na);na=d.faces.length;if(x)for(x=0;x<P;x++){var oa=a.uvs[x];d.faceVertexUvs[x][na]=[];d.faceVertexUvs[x][na+1]=[];for(A=
0;4>A;A++){var la=K[Z++];var wa=oa[2*la];la=oa[2*la+1];wa=new k(wa,la);2!==A&&d.faceVertexUvs[x][na].push(wa);0!==A&&d.faceVertexUvs[x][na+1].push(wa)}}qa&&(qa=3*K[Z++],da.normal.set(R[qa++],R[qa++],R[qa]),ba.normal.copy(da.normal));if(sa)for(x=0;4>x;x++)qa=3*K[Z++],sa=new r(R[qa++],R[qa++],R[qa]),2!==x&&da.vertexNormals.push(sa),0!==x&&ba.vertexNormals.push(sa);M&&(M=K[Z++],M=O[M],da.color.setHex(M),ba.color.setHex(M));if(u)for(x=0;4>x;x++)M=K[Z++],M=O[M],2!==x&&da.vertexColors.push(new ka(M)),0!==
x&&ba.vertexColors.push(new ka(M));d.faces.push(da);d.faces.push(ba)}else{da=new bc;da.a=K[Z++];da.b=K[Z++];da.c=K[Z++];na&&(na=K[Z++],da.materialIndex=na);na=d.faces.length;if(x)for(x=0;x<P;x++)for(oa=a.uvs[x],d.faceVertexUvs[x][na]=[],A=0;3>A;A++)la=K[Z++],wa=oa[2*la],la=oa[2*la+1],wa=new k(wa,la),d.faceVertexUvs[x][na].push(wa);qa&&(qa=3*K[Z++],da.normal.set(R[qa++],R[qa++],R[qa]));if(sa)for(x=0;3>x;x++)qa=3*K[Z++],sa=new r(R[qa++],R[qa++],R[qa]),da.vertexNormals.push(sa);M&&(M=K[Z++],da.color.setHex(O[M]));
if(u)for(x=0;3>x;x++)M=K[Z++],da.vertexColors.push(new ka(O[M]));d.faces.push(da)}}})(g);(function(){var u=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var x=0,A=a.skinWeights.length;x<A;x+=u)d.skinWeights.push(new p(a.skinWeights[x],1<u?a.skinWeights[x+1]:0,2<u?a.skinWeights[x+2]:0,3<u?a.skinWeights[x+3]:0));if(a.skinIndices)for(x=0,A=a.skinIndices.length;x<A;x+=u)d.skinIndices.push(new p(a.skinIndices[x],1<u?a.skinIndices[x+1]:0,2<u?a.skinIndices[x+2]:0,3<u?a.skinIndices[x+
3]:0));d.bones=a.bones;d.bones&&0<d.bones.length&&(d.skinWeights.length!==d.skinIndices.length||d.skinIndices.length!==d.vertices.length)&&console.warn("When skinning, number of vertices ("+d.vertices.length+"), skinIndices ("+d.skinIndices.length+"), and skinWeights ("+d.skinWeights.length+") should match.")})();(function(u){if(void 0!==a.morphTargets)for(var x=0,A=a.morphTargets.length;x<A;x++){d.morphTargets[x]={};d.morphTargets[x].name=a.morphTargets[x].name;d.morphTargets[x].vertices=[];for(var H=
d.morphTargets[x].vertices,K=a.morphTargets[x].vertices,M=0,R=K.length;M<R;M+=3){var O=new r;O.x=K[M]*u;O.y=K[M+1]*u;O.z=K[M+2]*u;H.push(O)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),u=d.faces,H=a.morphColors[0].colors,x=0,A=u.length;x<A;x++)u[x].color.fromArray(H,3*x)})(g);(function(){var u=[],x=[];void 0!==a.animation&&x.push(a.animation);void 0!==a.animations&&(a.animations.length?x=x.concat(a.animations):
x.push(a.animations));for(var A=0;A<x.length;A++){var H=Gc.parseAnimation(x[A],d.bones);H&&u.push(H)}d.morphTargets&&(x=Gc.CreateClipsFromMorphTargetSequences(d.morphTargets,10),u=u.concat(x));0<u.length&&(d.animations=u)})();d.computeFaceNormals();d.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:d};c=fe.prototype.initMaterials(a.materials,c,this.crossOrigin);return{geometry:d,materials:c}}});Object.assign(Ag.prototype,{load:function(a,c,d,g){""===this.texturePath&&
(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var u=this;(new Mc(u.manager)).load(a,function(x){var A=null;try{A=JSON.parse(x)}catch(H){void 0!==g&&g(H);console.error("THREE:ObjectLoader: Can't parse "+a+".",H.message);return}x=A.metadata;void 0===x||void 0===x.type||"geometry"===x.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+a+". Use THREE.JSONLoader instead."):u.parse(A,c)},d,g)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=
a},parse:function(a,c){var d=this.parseGeometries(a.geometries),g=this.parseImages(a.images,function(){void 0!==c&&c(u)});g=this.parseTextures(a.textures,g);g=this.parseMaterials(a.materials,g);var u=this.parseObject(a.object,d,g);a.animations&&(u.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===c||c(u);return u},parseGeometries:function(a){var c={};if(void 0!==a)for(var d=new $f,g=new Zf,u=0,x=a.length;u<x;u++){var A=a[u];switch(A.type){case "PlaneGeometry":case "PlaneBufferGeometry":var H=
new Oc[A.type](A.width,A.height,A.widthSegments,A.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":H=new Oc[A.type](A.width,A.height,A.depth,A.widthSegments,A.heightSegments,A.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":H=new Oc[A.type](A.radius,A.segments,A.thetaStart,A.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":H=new Oc[A.type](A.radiusTop,A.radiusBottom,A.height,A.radialSegments,A.heightSegments,A.openEnded,
A.thetaStart,A.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":H=new Oc[A.type](A.radius,A.height,A.radialSegments,A.heightSegments,A.openEnded,A.thetaStart,A.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":H=new Oc[A.type](A.radius,A.widthSegments,A.heightSegments,A.phiStart,A.phiLength,A.thetaStart,A.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":H=new Oc[A.type](A.radius,A.detail);
break;case "RingGeometry":case "RingBufferGeometry":H=new Oc[A.type](A.innerRadius,A.outerRadius,A.thetaSegments,A.phiSegments,A.thetaStart,A.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":H=new Oc[A.type](A.radius,A.tube,A.radialSegments,A.tubularSegments,A.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":H=new Oc[A.type](A.radius,A.tube,A.tubularSegments,A.radialSegments,A.p,A.q);break;case "LatheGeometry":case "LatheBufferGeometry":H=new Oc[A.type](A.points,
A.segments,A.phiStart,A.phiLength);break;case "BufferGeometry":H=g.parse(A);break;case "Geometry":H=d.parse(A.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+A.type+'"');continue}H.uuid=A.uuid;void 0!==A.name&&(H.name=A.name);c[A.uuid]=H}return c},parseMaterials:function(a,c){var d={};if(void 0!==a){var g=new Gf;g.setTextures(c);c=0;for(var u=a.length;c<u;c++){var x=g.parse(a[c]);d[x.uuid]=x}}return d},parseAnimations:function(a){for(var c=
[],d=0;d<a.length;d++){var g=Gc.parse(a[d]);c.push(g)}return c},parseImages:function(a,c){function d(M){g.manager.itemStart(M);return x.load(M,function(){g.manager.itemEnd(M)},void 0,function(){g.manager.itemError(M)})}var g=this,u={};if(void 0!==a&&0<a.length){c=new Wf(c);var x=new Re(c);x.setCrossOrigin(this.crossOrigin);c=0;for(var A=a.length;c<A;c++){var H=a[c],K=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(H.url)?H.url:g.texturePath+H.url;u[H.uuid]=d(K)}}return u},parseTextures:function(a,c){function d(O,
P){if("number"===typeof O)return O;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",O);return P[O]}var g={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},u={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},x={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,
LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008},A={};if(void 0!==a)for(var H=0,K=a.length;H<K;H++){var M=a[H];void 0===M.image&&console.warn('THREE.ObjectLoader: No "image" specified for',M.uuid);void 0===c[M.image]&&console.warn("THREE.ObjectLoader: Undefined image",M.image);var R=new e(c[M.image]);R.needsUpdate=!0;R.uuid=M.uuid;void 0!==M.name&&(R.name=M.name);void 0!==M.mapping&&(R.mapping=d(M.mapping,g));void 0!==M.offset&&R.offset.fromArray(M.offset);void 0!==
M.repeat&&R.repeat.fromArray(M.repeat);void 0!==M.wrap&&(R.wrapS=d(M.wrap[0],u),R.wrapT=d(M.wrap[1],u));void 0!==M.minFilter&&(R.minFilter=d(M.minFilter,x));void 0!==M.magFilter&&(R.magFilter=d(M.magFilter,x));void 0!==M.anisotropy&&(R.anisotropy=M.anisotropy);void 0!==M.flipY&&(R.flipY=M.flipY);A[M.uuid]=R}return A},parseObject:function(){var a=new y;return function(c,d,g){function u(R){void 0===d[R]&&console.warn("THREE.ObjectLoader: Undefined geometry",R);return d[R]}function x(R){if(void 0!==
R)return void 0===g[R]&&console.warn("THREE.ObjectLoader: Undefined material",R),g[R]}switch(c.type){case "Scene":var A=new kf;void 0!==c.background&&Number.isInteger(c.background)&&(A.background=new ka(c.background));void 0!==c.fog&&("Fog"===c.fog.type?A.fog=new Ld(c.fog.color,c.fog.near,c.fog.far):"FogExp2"===c.fog.type&&(A.fog=new Kd(c.fog.color,c.fog.density)));break;case "PerspectiveCamera":A=new Oa(c.fov,c.aspect,c.near,c.far);void 0!==c.focus&&(A.focus=c.focus);void 0!==c.zoom&&(A.zoom=c.zoom);
void 0!==c.filmGauge&&(A.filmGauge=c.filmGauge);void 0!==c.filmOffset&&(A.filmOffset=c.filmOffset);void 0!==c.view&&(A.view=Object.assign({},c.view));break;case "OrthographicCamera":A=new Ha(c.left,c.right,c.top,c.bottom,c.near,c.far);break;case "AmbientLight":A=new zf(c.color,c.intensity);break;case "DirectionalLight":A=new yf(c.color,c.intensity);break;case "PointLight":A=new wf(c.color,c.intensity,c.distance,c.decay);break;case "SpotLight":A=new vf(c.color,c.intensity,c.distance,c.angle,c.penumbra,
c.decay);break;case "HemisphereLight":A=new tf(c.color,c.groundColor,c.intensity);break;case "Mesh":A=u(c.geometry);var H=x(c.material);A=A.bones&&0<A.bones.length?new nf(A,H):new Zb(A,H);break;case "LOD":A=new ye;break;case "Line":A=new Ic(u(c.geometry),x(c.material),c.mode);break;case "LineLoop":A=new of(u(c.geometry),x(c.material));break;case "LineSegments":A=new Vb(u(c.geometry),x(c.material));break;case "PointCloud":case "Points":A=new Md(u(c.geometry),x(c.material));break;case "Sprite":A=new xe(x(c.material));
break;case "Group":A=new ze;break;case "SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:A=new lb}A.uuid=c.uuid;void 0!==c.name&&(A.name=c.name);void 0!==c.matrix?(a.fromArray(c.matrix),a.decompose(A.position,A.quaternion,A.scale)):(void 0!==c.position&&A.position.fromArray(c.position),void 0!==c.rotation&&A.rotation.fromArray(c.rotation),void 0!==c.quaternion&&A.quaternion.fromArray(c.quaternion),void 0!==c.scale&&
A.scale.fromArray(c.scale));void 0!==c.castShadow&&(A.castShadow=c.castShadow);void 0!==c.receiveShadow&&(A.receiveShadow=c.receiveShadow);c.shadow&&(void 0!==c.shadow.bias&&(A.shadow.bias=c.shadow.bias),void 0!==c.shadow.radius&&(A.shadow.radius=c.shadow.radius),void 0!==c.shadow.mapSize&&A.shadow.mapSize.fromArray(c.shadow.mapSize),void 0!==c.shadow.camera&&(A.shadow.camera=this.parseObject(c.shadow.camera)));void 0!==c.visible&&(A.visible=c.visible);void 0!==c.userData&&(A.userData=c.userData);
if(void 0!==c.children)for(var K in c.children)A.add(this.parseObject(c.children[K],d,g));if("LOD"===c.type)for(c=c.levels,H=0;H<c.length;H++){var M=c[H];K=A.getObjectByProperty("uuid",M.object);void 0!==K&&A.addLevel(K,M.distance)}return A}}()});Object.assign(rc.prototype,{getPoint:function(){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){void 0===a&&(a=5);for(var c=[],d=
0;d<=a;d++)c.push(this.getPoint(d/a));return c},getSpacedPoints:function(a){void 0===a&&(a=5);for(var c=[],d=0;d<=a;d++)c.push(this.getPointAt(d/a));return c},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){void 0===a&&(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var c=[],d=this.getPoint(0),g,u=0;c.push(0);for(g=1;g<=
a;g++){var x=this.getPoint(g/a);u+=x.distanceTo(d);c.push(u);d=x}return this.cacheArcLengths=c},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,c){var d=this.getLengths(),g=d.length;c=c?c:a*d[g-1];for(var u=0,x=g-1,A;u<=x;)if(a=Math.floor(u+(x-u)/2),A=d[a]-c,0>A)u=a+1;else if(0<A)x=a-1;else{x=a;break}a=x;if(d[a]===c)return a/(g-1);u=d[a];return(a+(c-u)/(d[a+1]-u))/(g-1)},getTangent:function(a){var c=a-1E-4;a+=1E-4;0>c&&(c=0);1<a&&(a=1);c=this.getPoint(c);
return this.getPoint(a).clone().sub(c).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)},computeFrenetFrames:function(a,c){var d=new r,g=[],u=[],x=[],A=new r,H=new y,K;for(K=0;K<=a;K++){var M=K/a;g[K]=this.getTangentAt(M);g[K].normalize()}u[0]=new r;x[0]=new r;K=Number.MAX_VALUE;M=Math.abs(g[0].x);var R=Math.abs(g[0].y),O=Math.abs(g[0].z);M<=K&&(K=M,d.set(1,0,0));R<=K&&(K=R,d.set(0,1,0));O<=K&&d.set(0,0,1);A.crossVectors(g[0],d).normalize();u[0].crossVectors(g[0],
A);x[0].crossVectors(g[0],u[0]);for(K=1;K<=a;K++)u[K]=u[K-1].clone(),x[K]=x[K-1].clone(),A.crossVectors(g[K-1],g[K]),A.length()>Number.EPSILON&&(A.normalize(),d=Math.acos(xb.clamp(g[K-1].dot(g[K]),-1,1)),u[K].applyMatrix4(H.makeRotationAxis(A,d))),x[K].crossVectors(g[K],u[K]);if(!0===c)for(d=Math.acos(xb.clamp(u[0].dot(u[a]),-1,1)),d/=a,0<g[0].dot(A.crossVectors(u[0],u[a]))&&(d=-d),K=1;K<=a;K++)u[K].applyMatrix4(H.makeRotationAxis(g[K],d*K)),x[K].crossVectors(g[K],u[K]);return{tangents:g,normals:u,
binormals:x}}});Xc.prototype=Object.create(rc.prototype);Xc.prototype.constructor=Xc;Xc.prototype.isLineCurve=!0;Xc.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var c=this.v2.clone().sub(this.v1);c.multiplyScalar(a).add(this.v1);return c};Xc.prototype.getPointAt=function(a){return this.getPoint(a)};Xc.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};Ue.prototype=Object.assign(Object.create(rc.prototype),{constructor:Ue,add:function(a){this.curves.push(a)},
closePath:function(){var a=this.curves[0].getPoint(0),c=this.curves[this.curves.length-1].getPoint(1);a.equals(c)||this.curves.push(new Xc(c,a))},getPoint:function(a){var c=a*this.getLength(),d=this.getCurveLengths();for(a=0;a<d.length;){if(d[a]>=c)return c=d[a]-c,a=this.curves[a],d=a.getLength(),a.getPointAt(0===d?0:1-c/d);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},
getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],c=0,d=0,g=this.curves.length;d<g;d++)c+=this.curves[d].getLength(),a.push(c);return this.cacheLengths=a},getSpacedPoints:function(a){void 0===a&&(a=40);for(var c=[],d=0;d<=a;d++)c.push(this.getPoint(d/a));this.autoClose&&c.push(c[0]);return c},getPoints:function(a){a=a||12;for(var c=[],d,g=0,u=this.curves;g<u.length;g++){var x=u[g];x=x.getPoints(x&&x.isEllipseCurve?
2*a:x&&x.isLineCurve?1:x&&x.isSplineCurve?a*x.points.length:a);for(var A=0;A<x.length;A++){var H=x[A];d&&d.equals(H)||(c.push(H),d=H)}}this.autoClose&&1<c.length&&!c[c.length-1].equals(c[0])&&c.push(c[0]);return c},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){for(var c=new sb,d=0,g=a.length;d<g;d++){var u=a[d];c.vertices.push(new r(u.x,u.y,
u.z||0))}return c}});ad.prototype=Object.create(rc.prototype);ad.prototype.constructor=ad;ad.prototype.isEllipseCurve=!0;ad.prototype.getPoint=function(a){for(var c=2*Math.PI,d=this.aEndAngle-this.aStartAngle,g=Math.abs(d)<Number.EPSILON;0>d;)d+=c;for(;d>c;)d-=c;d<Number.EPSILON&&(d=g?0:c);!0!==this.aClockwise||g||(d=d===c?-c:d-c);c=this.aStartAngle+a*d;a=this.aX+this.xRadius*Math.cos(c);var u=this.aY+this.yRadius*Math.sin(c);0!==this.aRotation&&(c=Math.cos(this.aRotation),d=Math.sin(this.aRotation),
g=a-this.aX,u-=this.aY,a=g*c-u*d+this.aX,u=g*d+u*c+this.aY);return new k(a,u)};Dd.prototype=Object.create(rc.prototype);Dd.prototype.constructor=Dd;Dd.prototype.isSplineCurve=!0;Dd.prototype.getPoint=function(a){var c=this.points,d=(c.length-1)*a;a=Math.floor(d);d-=a;var g=c[0===a?a:a-1],u=c[a],x=c[a>c.length-2?c.length-1:a+1];c=c[a>c.length-3?c.length-1:a+2];return new k(Bg(d,g.x,u.x,x.x,c.x),Bg(d,g.y,u.y,x.y,c.y))};ge.prototype=Object.create(rc.prototype);ge.prototype.constructor=ge;ge.prototype.getPoint=
function(a){var c=this.v0,d=this.v1,g=this.v2,u=this.v3;return new k(Cd(a,c.x,d.x,g.x,u.x),Cd(a,c.y,d.y,g.y,u.y))};he.prototype=Object.create(rc.prototype);he.prototype.constructor=he;he.prototype.getPoint=function(a){var c=this.v0,d=this.v1,g=this.v2;return new k(Bd(a,c.x,d.x,g.x),Bd(a,c.y,d.y,g.y))};var og=Object.assign(Object.create(Ue.prototype),{fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var c=1,d=a.length;c<d;c++)this.lineTo(a[c].x,a[c].y)},moveTo:function(a,c){this.currentPoint.set(a,
c)},lineTo:function(a,c){var d=new Xc(this.currentPoint.clone(),new k(a,c));this.curves.push(d);this.currentPoint.set(a,c)},quadraticCurveTo:function(a,c,d,g){a=new he(this.currentPoint.clone(),new k(a,c),new k(d,g));this.curves.push(a);this.currentPoint.set(d,g)},bezierCurveTo:function(a,c,d,g,u,x){a=new ge(this.currentPoint.clone(),new k(a,c),new k(d,g),new k(u,x));this.curves.push(a);this.currentPoint.set(u,x)},splineThru:function(a){var c=[this.currentPoint.clone()].concat(a);c=new Dd(c);this.curves.push(c);
this.currentPoint.copy(a[a.length-1])},arc:function(a,c,d,g,u,x){this.absarc(a+this.currentPoint.x,c+this.currentPoint.y,d,g,u,x)},absarc:function(a,c,d,g,u,x){this.absellipse(a,c,d,d,g,u,x)},ellipse:function(a,c,d,g,u,x,A,H){this.absellipse(a+this.currentPoint.x,c+this.currentPoint.y,d,g,u,x,A,H)},absellipse:function(a,c,d,g,u,x,A,H){a=new ad(a,c,d,g,u,x,A,H);0<this.curves.length&&(c=a.getPoint(0),c.equals(this.currentPoint)||this.lineTo(c.x,c.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});
Ve.prototype=og;og.constructor=Ve;Ed.prototype=Object.assign(Object.create(og),{constructor:Ed,getPointsHoles:function(a){for(var c=[],d=0,g=this.holes.length;d<g;d++)c[d]=this.holes[d].getPoints(a);return c},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});Object.assign(ag.prototype,{moveTo:function(a,c){this.currentPath=new Ve;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,c)},
lineTo:function(a,c){this.currentPath.lineTo(a,c)},quadraticCurveTo:function(a,c,d,g){this.currentPath.quadraticCurveTo(a,c,d,g)},bezierCurveTo:function(a,c,d,g,u,x){this.currentPath.bezierCurveTo(a,c,d,g,u,x)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,c){function d(qa){for(var sa=[],ba=0,oa=qa.length;ba<oa;ba++){var la=qa[ba],wa=new Ed;wa.curves=la.curves;sa.push(wa)}return sa}function g(qa,sa){for(var ba=sa.length,oa=!1,la=ba-1,wa=0;wa<ba;la=wa++){var ya=sa[la],
Ca=sa[wa],Ja=Ca.x-ya.x,Pa=Ca.y-ya.y;if(Math.abs(Pa)>Number.EPSILON){if(0>Pa&&(ya=sa[wa],Ja=-Ja,Ca=sa[la],Pa=-Pa),!(qa.y<ya.y||qa.y>Ca.y))if(qa.y===ya.y){if(qa.x===ya.x)return!0}else{la=Pa*(qa.x-ya.x)-Ja*(qa.y-ya.y);if(0===la)return!0;0>la||(oa=!oa)}}else if(qa.y===ya.y&&(Ca.x<=qa.x&&qa.x<=ya.x||ya.x<=qa.x&&qa.x<=Ca.x))return!0}return oa}var u=Kc.isClockWise,x=this.subPaths;if(0===x.length)return[];if(!0===c)return d(x);c=[];if(1===x.length){var A=x[0];var H=new Ed;H.curves=A.curves;c.push(H);return c}var K=
!u(x[0].getPoints());K=a?!K:K;H=[];var M=[],R=[],O=0;M[O]=void 0;R[O]=[];for(var P=0,Z=x.length;P<Z;P++){A=x[P];var da=A.getPoints();var na=u(da);(na=a?!na:na)?(!K&&M[O]&&O++,M[O]={s:new Ed,p:da},M[O].s.curves=A.curves,K&&O++,R[O]=[]):R[O].push({h:A,p:da[0]})}if(!M[0])return d(x);if(1<M.length){P=!1;a=[];u=0;for(x=M.length;u<x;u++)H[u]=[];u=0;for(x=M.length;u<x;u++)for(A=R[u],na=0;na<A.length;na++){K=A[na];O=!0;for(da=0;da<M.length;da++)g(K.p,M[da].p)&&(u!==da&&a.push({froms:u,tos:da,hole:na}),O?
(O=!1,H[da].push(K)):P=!0);O&&H[u].push(K)}0<a.length&&(P||(R=H))}P=0;for(u=M.length;P<u;P++)for(H=M[P].s,c.push(H),a=R[P],x=0,A=a.length;x<A;x++)H.holes.push(a[x].h);return c}});Object.assign(bg.prototype,{isFont:!0,generateShapes:function(a,c,d){void 0===c&&(c=100);void 0===d&&(d=4);var g=this.data;a=String(a).split("");var u=c/g.resolution,x=(g.boundingBox.yMax-g.boundingBox.yMin+g.underlineThickness)*u,A=0,H=0;c=[];for(var K=0;K<a.length;K++){var M=a[K];if("\n"===M)A=0,H-=x;else{var R;var O=u;
var P=A,Z=H;if(M=g.glyphs[M]||g.glyphs["?"]){var da=new ag,na=[];if(M.o)for(var qa=M._cachedOutline||(M._cachedOutline=M.o.split(" ")),sa=0,ba=qa.length;sa<ba;)switch(qa[sa++]){case "m":var oa=qa[sa++]*O+P;var la=qa[sa++]*O+Z;da.moveTo(oa,la);break;case "l":oa=qa[sa++]*O+P;la=qa[sa++]*O+Z;da.lineTo(oa,la);break;case "q":var wa=qa[sa++]*O+P;var ya=qa[sa++]*O+Z;var Ca=qa[sa++]*O+P;var Ja=qa[sa++]*O+Z;da.quadraticCurveTo(Ca,Ja,wa,ya);if(R=na[na.length-1]){var Pa=R.x;R=R.y;for(var Na=1;Na<=d;Na++){var Ta=
Na/d;Bd(Ta,Pa,Ca,wa);Bd(Ta,R,Ja,ya)}}break;case "b":if(wa=qa[sa++]*O+P,ya=qa[sa++]*O+Z,Ca=qa[sa++]*O+P,Ja=qa[sa++]*O+Z,oa=qa[sa++]*O+P,la=qa[sa++]*O+Z,da.bezierCurveTo(Ca,Ja,oa,la,wa,ya),R=na[na.length-1])for(Pa=R.x,R=R.y,Na=1;Na<=d;Na++)Ta=Na/d,Cd(Ta,Pa,Ca,oa,wa),Cd(Ta,R,Ja,la,ya)}O={offsetX:M.ha*O,path:da}}else O=void 0;A+=O.offsetX;c.push(O.path)}}d=[];g=0;for(a=c.length;g<a;g++)Array.prototype.push.apply(d,c[g].toShapes());return d}});Object.assign(Cg.prototype,{load:function(a,c,d,g){var u=this;
(new Mc(this.manager)).load(a,function(x){try{var A=JSON.parse(x)}catch(H){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),A=JSON.parse(x.substring(65,x.length-2))}x=u.parse(A);c&&c(x)},d,g)},parse:function(a){return new bg(a)}});var Nf,fg={getContext:function(){void 0===Nf&&(Nf=new (window.AudioContext||window.webkitAudioContext));return Nf},setContext:function(a){Nf=a}};Object.assign(cg.prototype,{load:function(a,c,d,g){var u=new Mc(this.manager);
u.setResponseType("arraybuffer");u.load(a,function(x){fg.getContext().decodeAudioData(x,function(A){c(A)})},d,g)}});dg.prototype=Object.assign(Object.create(ac.prototype),{constructor:dg,isRectAreaLight:!0,copy:function(a){ac.prototype.copy.call(this,a);this.width=a.width;this.height=a.height;return this}});Object.assign(Dg.prototype,{update:function(){var a,c,d,g,u,x,A,H,K=new y,M=new y;return function(R){if(a!==this||c!==R.focus||d!==R.fov||g!==R.aspect*this.aspect||u!==R.near||x!==R.far||A!==R.zoom||
H!==this.eyeSep){a=this;c=R.focus;d=R.fov;g=R.aspect*this.aspect;u=R.near;x=R.far;A=R.zoom;var O=R.projectionMatrix.clone();H=this.eyeSep/2;var P=H*u/c,Z=u*Math.tan(xb.DEG2RAD*d*.5)/A;M.elements[12]=-H;K.elements[12]=H;var da=-Z*g+P;var na=Z*g+P;O.elements[0]=2*u/(na-da);O.elements[8]=(na+da)/(na-da);this.cameraL.projectionMatrix.copy(O);da=-Z*g-P;na=Z*g-P;O.elements[0]=2*u/(na-da);O.elements[8]=(na+da)/(na-da);this.cameraR.projectionMatrix.copy(O)}this.cameraL.matrixWorld.copy(R.matrixWorld).multiply(M);
this.cameraR.matrixWorld.copy(R.matrixWorld).multiply(K)}}()});Hf.prototype=Object.create(lb.prototype);Hf.prototype.constructor=Hf;eg.prototype=Object.assign(Object.create(lb.prototype),{constructor:eg,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==
this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new r,c=new t,d=new r,g=new r;return function(u){lb.prototype.updateMatrixWorld.call(this,u);u=this.context.listener;var x=
this.up;this.matrixWorld.decompose(a,c,d);g.set(0,0,-1).applyQuaternion(c);u.positionX?(u.positionX.setValueAtTime(a.x,this.context.currentTime),u.positionY.setValueAtTime(a.y,this.context.currentTime),u.positionZ.setValueAtTime(a.z,this.context.currentTime),u.forwardX.setValueAtTime(g.x,this.context.currentTime),u.forwardY.setValueAtTime(g.y,this.context.currentTime),u.forwardZ.setValueAtTime(g.z,this.context.currentTime),u.upX.setValueAtTime(x.x,this.context.currentTime),u.upY.setValueAtTime(x.y,
this.context.currentTime),u.upZ.setValueAtTime(x.z,this.context.currentTime)):(u.setPosition(a.x,a.y,a.z),u.setOrientation(g.x,g.y,g.z,x.x,x.y,x.z))}}()});ie.prototype=Object.assign(Object.create(lb.prototype),{constructor:ie,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===
this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else{var a=this.context.createBufferSource();a.buffer=this.buffer;a.loop=this.loop;a.onended=this.onEnded.bind(this);a.playbackRate.setValueAtTime(this.playbackRate,this.startTime);a.start(0,this.startTime);this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,c=this.filters.length;a<c;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());
return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,c=this.filters.length;a<c;a++)this.filters[a-1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},
setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),
!1):this.loop},setLoop:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=a,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(a){this.gain.gain.value=a;return this}});gg.prototype=Object.assign(Object.create(ie.prototype),{constructor:gg,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=
a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new r;return function(c){lb.prototype.updateMatrixWorld.call(this,c);a.setFromMatrixPosition(this.matrixWorld);
this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(hg.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,c=this.getFrequencyData(),d=0;d<c.length;d++)a+=c[d];return a/c.length}});Object.assign(ig.prototype,{accumulate:function(a,c){var d=this.buffer,g=this.valueSize;a=a*g+g;var u=this.cumulativeWeight;if(0===u){for(u=0;u!==g;++u)d[a+u]=d[u];u=c}else u+=c,this._mixBufferRegion(d,a,0,c/u,g);this.cumulativeWeight=
u},apply:function(a){var c=this.valueSize,d=this.buffer;a=a*c+c;var g=this.cumulativeWeight,u=this.binding;this.cumulativeWeight=0;1>g&&this._mixBufferRegion(d,a,3*c,1-g,c);g=c;for(var x=c+c;g!==x;++g)if(d[g]!==d[g+c]){u.setValue(d,a);break}},saveOriginalState:function(){var a=this.buffer,c=this.valueSize,d=3*c;this.binding.getValue(a,d);for(var g=c;g!==d;++g)a[g]=a[d+g%c];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,
c,d,g,u){if(.5<=g)for(g=0;g!==u;++g)a[c+g]=a[d+g]},_slerp:function(a,c,d,g){t.slerpFlat(a,c,a,c,a,d,g)},_lerp:function(a,c,d,g,u){for(var x=1-g,A=0;A!==u;++A){var H=c+A;a[H]=a[H]*x+a[d+A]*g}}});Object.assign(Eg.prototype,{getValue:function(a,c){this.bind();var d=this._bindings[this._targetGroup.nCachedObjects_];void 0!==d&&d.getValue(a,c)},setValue:function(a,c){for(var d=this._bindings,g=this._targetGroup.nCachedObjects_,u=d.length;g!==u;++g)d[g].setValue(a,c)},bind:function(){for(var a=this._bindings,
c=this._targetGroup.nCachedObjects_,d=a.length;c!==d;++c)a[c].bind()},unbind:function(){for(var a=this._bindings,c=this._targetGroup.nCachedObjects_,d=a.length;c!==d;++c)a[c].unbind()}});Object.assign(lc,{Composite:Eg,create:function(a,c,d){return a&&a.isAnimationObjectGroup?new lc.Composite(a,c,d):new lc(a,c,d)},parseTrackName:function(a){var c=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(a);if(!c)throw Error("cannot parse trackName at all: "+a);c={nodeName:c[2],
objectName:c[3],objectIndex:c[4],propertyName:c[5],propertyIndex:c[6]};if(null===c.propertyName||0===c.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return c},findNode:function(a,c){if(!c||""===c||"root"===c||"."===c||-1===c||c===a.name||c===a.uuid)return a;if(a.skeleton){var d=function(u){for(var x=0;x<u.bones.length;x++){var A=u.bones[x];if(A.name===c)return A}return null}(a.skeleton);if(d)return d}if(a.children){var g=function(u){for(var x=0;x<u.length;x++){var A=
u[x];if(A.name===c||A.uuid===c||(A=g(A.children)))return A}return null};if(a=g(a.children))return a}return null}});Object.assign(lc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,c){a[c]=this.node[this.propertyName]},function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==u;++g)a[c++]=d[g]},function(a,
c){a[c]=this.resolvedProperty[this.propertyIndex]},function(a,c){this.resolvedProperty.toArray(a,c)}],SetterByBindingTypeAndVersioning:[[function(a,c){this.node[this.propertyName]=a[c]},function(a,c){this.node[this.propertyName]=a[c];this.targetObject.needsUpdate=!0},function(a,c){this.node[this.propertyName]=a[c];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==u;++g)d[g]=a[c++]},function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==
u;++g)d[g]=a[c++];this.targetObject.needsUpdate=!0},function(a,c){for(var d=this.resolvedProperty,g=0,u=d.length;g!==u;++g)d[g]=a[c++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){this.resolvedProperty[this.propertyIndex]=a[c]},function(a,c){this.resolvedProperty[this.propertyIndex]=a[c];this.targetObject.needsUpdate=!0},function(a,c){this.resolvedProperty[this.propertyIndex]=a[c];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,c){this.resolvedProperty.fromArray(a,c)},function(a,
c){this.resolvedProperty.fromArray(a,c);this.targetObject.needsUpdate=!0},function(a,c){this.resolvedProperty.fromArray(a,c);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(a,c){this.bind();this.getValue(a,c)},setValue:function(a,c){this.bind();this.setValue(a,c)},bind:function(){var a=this.node,c=this.parsedPath,d=c.objectName,g=c.propertyName,u=c.propertyIndex;a||(this.node=a=lc.findNode(this.rootNode,c.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=
this._setValue_unavailable;if(a){if(d){var x=c.objectIndex;switch(d){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(d=
0;d<a.length;d++)if(a[d].name===x){x=d;break}break;default:if(void 0===a[d]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[d]}if(void 0!==x){if(void 0===a[x]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[x]}}x=a[g];if(void 0===x)console.error("  trying to update property for track: "+c.nodeName+"."+g+" but it wasn't found.",a);else{c=this.Versioning.None;void 0!==a.needsUpdate?(c=this.Versioning.NeedsUpdate,
this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);d=this.BindingType.Direct;if(void 0!==u){if("morphTargetInfluences"===g){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(d=0;d<this.node.geometry.morphTargets.length;d++)if(a.geometry.morphTargets[d].name===
u){u=d;break}}d=this.BindingType.ArrayElement;this.resolvedProperty=x;this.propertyIndex=u}else void 0!==x.fromArray&&void 0!==x.toArray?(d=this.BindingType.HasFromToArray,this.resolvedProperty=x):Array.isArray(x)?(d=this.BindingType.EntireArray,this.resolvedProperty=x):this.propertyName=g;this.getValue=this.GetterByBindingType[d];this.setValue=this.SetterByBindingTypeAndVersioning[d][c]}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=
null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(lc.prototype,{_getValue_unbound:lc.prototype.getValue,_setValue_unbound:lc.prototype.setValue});Object.assign(Fg.prototype,{isAnimationObjectGroup:!0,add:function(a){for(var c=this._objects,d=c.length,g=this.nCachedObjects_,u=this._indicesByUUID,x=this._paths,A=this._parsedPaths,H=this._bindings,K=H.length,M=0,R=arguments.length;M!==R;++M){var O=arguments[M],P=O.uuid,Z=u[P];if(void 0===Z){Z=d++;u[P]=Z;
c.push(O);P=0;for(var da=K;P!==da;++P)H[P].push(new lc(O,x[P],A[P]))}else if(Z<g){var na=--g;da=c[na];u[da.uuid]=Z;c[Z]=da;u[P]=na;c[na]=O;P=0;for(da=K;P!==da;++P){var qa=H[P],sa=qa[Z];qa[Z]=qa[na];void 0===sa&&(sa=new lc(O,x[P],A[P]));qa[na]=sa}}else void 0!==c[Z]&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=g},remove:function(a){for(var c=this._objects,d=this.nCachedObjects_,g=this._indicesByUUID,
u=this._bindings,x=u.length,A=0,H=arguments.length;A!==H;++A){var K=arguments[A],M=K.uuid,R=g[M];if(void 0!==R&&R>=d){var O=d++,P=c[O];g[P.uuid]=R;c[R]=P;g[M]=O;c[O]=K;K=0;for(M=x;K!==M;++K){P=u[K];var Z=P[R];P[R]=P[O];P[O]=Z}}}this.nCachedObjects_=d},uncache:function(a){for(var c=this._objects,d=c.length,g=this.nCachedObjects_,u=this._indicesByUUID,x=this._bindings,A=x.length,H=0,K=arguments.length;H!==K;++H){var M=arguments[H].uuid,R=u[M];if(void 0!==R)if(delete u[M],R<g){M=--g;var O=c[M],P=--d,
Z=c[P];u[O.uuid]=R;c[R]=O;u[Z.uuid]=M;c[M]=Z;c.pop();O=0;for(Z=A;O!==Z;++O){var da=x[O],na=da[P];da[R]=da[M];da[M]=na;da.pop()}}else for(P=--d,Z=c[P],u[Z.uuid]=R,c[R]=Z,c.pop(),O=0,Z=A;O!==Z;++O)da=x[O],da[R]=da[P],da.pop()}this.nCachedObjects_=g},subscribe_:function(a,c){var d=this._bindingsIndicesByPath,g=d[a],u=this._bindings;if(void 0!==g)return u[g];var x=this._paths,A=this._parsedPaths,H=this._objects,K=this.nCachedObjects_,M=Array(H.length);g=u.length;d[a]=g;x.push(a);A.push(c);u.push(M);d=
K;for(g=H.length;d!==g;++d)M[d]=new lc(H[d],a,c);return M},unsubscribe_:function(a){var c=this._bindingsIndicesByPath,d=c[a];if(void 0!==d){var g=this._paths,u=this._parsedPaths,x=this._bindings,A=x.length-1,H=x[A];c[a[A]]=d;x[d]=H;x.pop();u[d]=u[A];u.pop();g[d]=g[A];g.pop()}}});Object.assign(Gg.prototype,{play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=
0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,c){this.loop=a;this.repetitions=c;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},
getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,c,d){a.fadeOut(c);this.fadeIn(c);if(d){d=this._clip.duration;var g=a._clip.duration,u=d/g;a.warp(1,g/d,c);this.warp(u,1,c)}return this},crossFadeTo:function(a,c,d){return a.crossFadeFrom(this,c,d)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));
return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,c,d){var g=this._mixer,u=g.time,x=this._timeScaleInterpolant,
A=this.timeScale;null===x&&(this._timeScaleInterpolant=x=g._lendControlInterpolant());g=x.parameterPositions;x=x.sampleValues;g[0]=u;g[1]=u+d;x[0]=a/A;x[1]=c/A;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,c,d,g){var u=
this._startTime;if(null!==u){c=(a-u)*d;if(0>c||0===d)return;this._startTime=null;c*=d}c*=this._updateTimeScale(a);d=this._updateTime(c);a=this._updateWeight(a);if(0<a){c=this._interpolants;u=this._propertyBindings;for(var x=0,A=c.length;x!==A;++x)c[x].evaluate(d),u[x].accumulate(g,a)}},_updateWeight:function(a){var c=0;if(this.enabled){c=this.weight;var d=this._weightInterpolant;if(null!==d){var g=d.evaluate(a)[0];c*=g;a>d.parameterPositions[1]&&(this.stopFading(),0===g&&(this.enabled=!1))}}return this._effectiveWeight=
c},_updateTimeScale:function(a){var c=0;if(!this.paused){c=this.timeScale;var d=this._timeScaleInterpolant;if(null!==d){var g=d.evaluate(a)[0];c*=g;a>d.parameterPositions[1]&&(this.stopWarping(),0===c?this.paused=!0:this.timeScale=c)}}return this._effectiveTimeScale=c},_updateTime:function(a){var c=this.time+a;if(0===a)return c;var d=this._clip.duration,g=this.loop,u=this._loopCount;if(2200===g)a:{if(-1===u&&(this._loopCount=0,this._setEndings(!0,!0,!1)),c>=d)c=d;else if(0>c)c=0;else break a;this.clampWhenFinished?
this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{g=2202===g;-1===u&&(0<=a?(u=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g));if(c>=d||0>c){var x=Math.floor(c/d);c-=d*x;u+=Math.abs(x);var A=this.repetitions-u;0>A?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,c=0<a?d:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(0===A?(a=0>a,this._setEndings(a,!a,g)):
this._setEndings(!1,!1,g),this._loopCount=u,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:x}))}if(g&&1===(u&1))return this.time=c,d-c}return this.time=c},_setEndings:function(a,c,d){var g=this._interpolantSettings;d?(g.endingStart=2401,g.endingEnd=2401):(g.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,g.endingEnd=c?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,c,d){var g=this._mixer,u=g.time,x=this._weightInterpolant;null===x&&(this._weightInterpolant=x=g._lendControlInterpolant());
g=x.parameterPositions;x=x.sampleValues;g[0]=u;x[0]=c;g[1]=u+a;x[1]=d;return this}});Object.assign(Hg.prototype,h.prototype,{_bindAction:function(a,c){var d=a._localRoot||this._root,g=a._clip.tracks,u=g.length,x=a._propertyBindings;a=a._interpolants;var A=d.uuid,H=this._bindingsByRootAndName,K=H[A];void 0===K&&(K={},H[A]=K);for(H=0;H!==u;++H){var M=g[H],R=M.name,O=K[R];if(void 0===O){O=x[H];if(void 0!==O){null===O._cacheIndex&&(++O.referenceCount,this._addInactiveBinding(O,A,R));continue}O=new ig(lc.create(d,
R,c&&c._propertyBindings[H].binding.parsedPath),M.ValueTypeName,M.getValueSize());++O.referenceCount;this._addInactiveBinding(O,A,R)}x[H]=O;a[H].resultBuffer=O.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var c=(a._localRoot||this._root).uuid,d=a._clip.uuid,g=this._actionsByClip[d];this._bindAction(a,g&&g.knownActions[0]);this._addInactiveAction(a,d,c)}c=a._propertyBindings;d=0;for(g=c.length;d!==g;++d){var u=c[d];0===u.useCount++&&(this._lendBinding(u),
u.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var c=a._propertyBindings,d=0,g=c.length;d!==g;++d){var u=c[d];0===--u.useCount&&(u.restoreOriginalState(),this._takeBackBinding(u))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=
this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,c,d){var g=this._actions,u=this._actionsByClip,x=u[c];void 0===x?(x={knownActions:[a],
actionByRoot:{}},a._byClipCacheIndex=0,u[c]=x):(c=x.knownActions,a._byClipCacheIndex=c.length,c.push(a));a._cacheIndex=g.length;g.push(a);x.actionByRoot[d]=a},_removeInactiveAction:function(a){var c=this._actions,d=c[c.length-1],g=a._cacheIndex;d._cacheIndex=g;c[g]=d;c.pop();a._cacheIndex=null;c=a._clip.uuid;d=this._actionsByClip;g=d[c];var u=g.knownActions,x=u[u.length-1],A=a._byClipCacheIndex;x._byClipCacheIndex=A;u[A]=x;u.pop();a._byClipCacheIndex=null;delete g.actionByRoot[(a._localRoot||this._root).uuid];
0===u.length&&delete d[c];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var c=0,d=a.length;c!==d;++c){var g=a[c];0===--g.referenceCount&&this._removeInactiveBinding(g)}},_lendAction:function(a){var c=this._actions,d=a._cacheIndex,g=this._nActiveActions++,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_takeBackAction:function(a){var c=this._actions,d=a._cacheIndex,g=--this._nActiveActions,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=
d;c[d]=u},_addInactiveBinding:function(a,c,d){var g=this._bindingsByRootAndName,u=g[c],x=this._bindings;void 0===u&&(u={},g[c]=u);u[d]=a;a._cacheIndex=x.length;x.push(a)},_removeInactiveBinding:function(a){var c=this._bindings,d=a.binding,g=d.rootNode.uuid;d=d.path;var u=this._bindingsByRootAndName,x=u[g],A=c[c.length-1];a=a._cacheIndex;A._cacheIndex=a;c[a]=A;c.pop();delete x[d];a:{for(var H in x)break a;delete u[g]}},_lendBinding:function(a){var c=this._bindings,d=a._cacheIndex,g=this._nActiveBindings++,
u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_takeBackBinding:function(a){var c=this._bindings,d=a._cacheIndex,g=--this._nActiveBindings,u=c[g];a._cacheIndex=g;c[g]=a;u._cacheIndex=d;c[d]=u},_lendControlInterpolant:function(){var a=this._controlInterpolants,c=this._nActiveControlInterpolants++,d=a[c];void 0===d&&(d=new Se(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),d.__cacheIndex=c,a[c]=d);return d},_takeBackControlInterpolant:function(a){var c=this._controlInterpolants,
d=a.__cacheIndex,g=--this._nActiveControlInterpolants,u=c[g];a.__cacheIndex=g;c[g]=a;u.__cacheIndex=d;c[d]=u},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(a,c){var d=c||this._root,g=d.uuid;d="string"===typeof a?Gc.findByName(d,a):a;a=null!==d?d.uuid:a;var u=this._actionsByClip[a],x=null;if(void 0!==u){x=u.actionByRoot[g];if(void 0!==x)return x;x=u.knownActions[0];null===d&&(d=x._clip)}if(null===d)return null;c=new Gg(this,d,c);this._bindAction(c,x);this._addInactiveAction(c,
a,g);return c},existingAction:function(a,c){var d=c||this._root;c=d.uuid;d="string"===typeof a?Gc.findByName(d,a):a;a=this._actionsByClip[d?d.uuid:a];return void 0!==a?a.actionByRoot[c]||null:null},stopAllAction:function(){for(var a=this._actions,c=this._nActiveActions,d=this._bindings,g=this._nActiveBindings,u=this._nActiveBindings=this._nActiveActions=0;u!==c;++u)a[u].reset();for(u=0;u!==g;++u)d[u].useCount=0;return this},update:function(a){a*=this.timeScale;for(var c=this._actions,d=this._nActiveActions,
g=this.time+=a,u=Math.sign(a),x=this._accuIndex^=1,A=0;A!==d;++A){var H=c[A];H.enabled&&H._update(g,a,u,x)}a=this._bindings;c=this._nActiveBindings;for(A=0;A!==c;++A)a[A].apply(x);return this},getRoot:function(){return this._root},uncacheClip:function(a){var c=this._actions;a=a.uuid;var d=this._actionsByClip,g=d[a];if(void 0!==g){g=g.knownActions;for(var u=0,x=g.length;u!==x;++u){var A=g[u];this._deactivateAction(A);var H=A._cacheIndex,K=c[c.length-1];A._cacheIndex=null;A._byClipCacheIndex=null;K._cacheIndex=
H;c[H]=K;c.pop();this._removeInactiveBindingsForAction(A)}delete d[a]}},uncacheRoot:function(a){a=a.uuid;var c=this._actionsByClip;for(g in c){var d=c[g].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}var g=this._bindingsByRootAndName[a];if(void 0!==g)for(var u in g)a=g[u],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,c){a=this.existingAction(a,c);null!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}});If.prototype.clone=
function(){return new If(void 0===this.value.clone?this.value:this.value.clone())};Fd.prototype=Object.create(ob.prototype);Fd.prototype.constructor=Fd;Fd.prototype.isInstancedBufferGeometry=!0;Fd.prototype.addGroup=function(a,c,d){this.groups.push({start:a,count:c,materialIndex:d})};Fd.prototype.copy=function(a){var c=a.index;null!==c&&this.setIndex(c.clone());c=a.attributes;for(var d in c)this.addAttribute(d,c[d].clone());a=a.groups;d=0;for(c=a.length;d<c;d++){var g=a[d];this.addGroup(g.start,g.count,
g.materialIndex)}return this};Object.defineProperties(jg.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}});Object.assign(jg.prototype,{isInterleavedBufferAttribute:!0,setX:function(a,c){this.data.array[a*this.data.stride+this.offset]=c;return this},setY:function(a,c){this.data.array[a*this.data.stride+this.offset+1]=c;return this},setZ:function(a,c){this.data.array[a*this.data.stride+this.offset+2]=c;return this},setW:function(a,c){this.data.array[a*
this.data.stride+this.offset+3]=c;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;return this},setXYZ:function(a,c,d,g){a=a*this.data.stride+
this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;this.data.array[a+2]=g;return this},setXYZW:function(a,c,d,g,u){a=a*this.data.stride+this.offset;this.data.array[a+0]=c;this.data.array[a+1]=d;this.data.array[a+2]=g;this.data.array[a+3]=u;return this}});Object.defineProperty(je.prototype,"needsUpdate",{set:function(a){!0===a&&this.version++}});Object.assign(je.prototype,{isInterleavedBuffer:!0,setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");
this.count=void 0!==a?a.length/this.stride:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,c,d){a*=this.stride;d*=c.stride;for(var g=0,u=this.stride;g<u;g++)this.array[a+g]=c.array[d+g];return this},set:function(a,c){void 0===c&&(c=0);this.array.set(a,c);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(a){this.onUploadCallback=
a;return this}});ke.prototype=Object.create(je.prototype);ke.prototype.constructor=ke;ke.prototype.isInstancedInterleavedBuffer=!0;ke.prototype.copy=function(a){je.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};le.prototype=Object.create(zb.prototype);le.prototype.constructor=le;le.prototype.isInstancedBufferAttribute=!0;le.prototype.copy=function(a){zb.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};Object.assign(Ig.prototype,{linePrecision:1,
set:function(a,c){this.ray.set(a,c)},setFromCamera:function(a,c){c&&c.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(c).sub(this.ray.origin).normalize()):c&&c.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(c.near+c.far)/(c.near-c.far)).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,c){var d=[];kg(a,this,d,
c);d.sort(Jg);return d},intersectObjects:function(a,c){var d=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),d;for(var g=0,u=a.length;g<u;g++)kg(a[g],this,d,c);d.sort(Jg);return d}});Object.assign(Kg.prototype,{start:function(){this.oldTime=this.startTime=(performance||Date).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},
getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var c=(performance||Date).now();a=(c-this.oldTime)/1E3;this.oldTime=c;this.elapsedTime+=a}return a}});Object.assign(Lg.prototype,{set:function(a,c,d){this.radius=a;this.phi=c;this.theta=d;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));
return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(xb.clamp(a.y/this.radius,-1,1)));return this}});Object.assign(Mg.prototype,{set:function(a,c,d){this.radius=a;this.theta=c;this.y=d;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.theta=a.theta;this.y=a.y;return this},setFromVector3:function(a){this.radius=Math.sqrt(a.x*a.x+a.z*a.z);
this.theta=Math.atan2(a.x,a.z);this.y=a.y;return this}});ic.prototype=Object.create(Zb.prototype);ic.prototype.constructor=ic;ic.prototype.createAnimation=function(a,c,d,g){c={start:c,end:d,length:d-c+1,fps:g,duration:(d-c)/g,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=c;this.animationsList.push(c)};ic.prototype.autoCreateAnimations=function(a){for(var c=/([a-z]+)_?(\d+)/i,d,g={},u=this.geometry,x=0,A=u.morphTargets.length;x<
A;x++){var H=u.morphTargets[x].name.match(c);if(H&&1<H.length){var K=H[1];g[K]||(g[K]={start:Infinity,end:-Infinity});H=g[K];x<H.start&&(H.start=x);x>H.end&&(H.end=x);d||(d=K)}}for(K in g)H=g[K],this.createAnimation(K,H.start,H.end,a);this.firstAnimation=d};ic.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};ic.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};ic.prototype.setAnimationFPS=
function(a,c){if(a=this.animationsMap[a])a.fps=c,a.duration=(a.end-a.start)/a.fps};ic.prototype.setAnimationDuration=function(a,c){if(a=this.animationsMap[a])a.duration=c,a.fps=(a.end-a.start)/a.duration};ic.prototype.setAnimationWeight=function(a,c){if(a=this.animationsMap[a])a.weight=c};ic.prototype.setAnimationTime=function(a,c){if(a=this.animationsMap[a])a.time=c};ic.prototype.getAnimationTime=function(a){var c=0;if(a=this.animationsMap[a])c=a.time;return c};ic.prototype.getAnimationDuration=
function(a){var c=-1;if(a=this.animationsMap[a])c=a.duration;return c};ic.prototype.playAnimation=function(a){var c=this.animationsMap[a];c?(c.time=0,c.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};ic.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};ic.prototype.update=function(a){for(var c=0,d=this.animationsList.length;c<d;c++){var g=this.animationsList[c];if(g.active){var u=g.duration/g.length;g.time+=g.direction*a;if(g.mirroredLoop){if(g.time>
g.duration||0>g.time)g.direction*=-1,g.time>g.duration&&(g.time=g.duration,g.directionBackwards=!0),0>g.time&&(g.time=0,g.directionBackwards=!1)}else g.time%=g.duration,0>g.time&&(g.time+=g.duration);var x=g.start+xb.clamp(Math.floor(g.time/u),0,g.length-1),A=g.weight;x!==g.currentFrame&&(this.morphTargetInfluences[g.lastFrame]=0,this.morphTargetInfluences[g.currentFrame]=1*A,this.morphTargetInfluences[x]=0,g.lastFrame=g.currentFrame,g.currentFrame=x);u=g.time%u/u;g.directionBackwards&&(u=1-u);g.currentFrame!==
g.lastFrame?(this.morphTargetInfluences[g.currentFrame]=u*A,this.morphTargetInfluences[g.lastFrame]=(1-u)*A):this.morphTargetInfluences[g.currentFrame]=A}}};We.prototype=Object.create(lb.prototype);We.prototype.constructor=We;We.prototype.isImmediateRenderObject=!0;Xe.prototype=Object.create(Vb.prototype);Xe.prototype.constructor=Xe;Xe.prototype.update=function(){var a=new r,c=new r,d=new Pb;return function(){var g=["a","b","c"];this.object.updateMatrixWorld(!0);d.getNormalMatrix(this.object.matrixWorld);
var u=this.object.matrixWorld,x=this.geometry.attributes.position,A=this.object.geometry;if(A&&A.isGeometry)for(var H=A.vertices,K=A.faces,M=A=0,R=K.length;M<R;M++)for(var O=K[M],P=0,Z=O.vertexNormals.length;P<Z;P++){var da=O.vertexNormals[P];a.copy(H[O[g[P]]]).applyMatrix4(u);c.copy(da).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);x.setXYZ(A,a.x,a.y,a.z);A+=1;x.setXYZ(A,c.x,c.y,c.z);A+=1}else if(A&&A.isBufferGeometry)for(g=A.attributes.position,H=A.attributes.normal,P=A=0,Z=g.count;P<
Z;P++)a.set(g.getX(P),g.getY(P),g.getZ(P)).applyMatrix4(u),c.set(H.getX(P),H.getY(P),H.getZ(P)),c.applyMatrix3(d).normalize().multiplyScalar(this.size).add(a),x.setXYZ(A,a.x,a.y,a.z),A+=1,x.setXYZ(A,c.x,c.y,c.z),A+=1;x.needsUpdate=!0;return this}}();me.prototype=Object.create(lb.prototype);me.prototype.constructor=me;me.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};me.prototype.update=function(){var a=new r,c=new r;return function(){var d=this.light.distance?
this.light.distance:1E3,g=d*Math.tan(this.light.angle);this.cone.scale.set(g,g,d);a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(c.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();ne.prototype=Object.create(Vb.prototype);ne.prototype.constructor=ne;ne.prototype.getBoneList=function(a){var c=[];a&&a.isBone&&c.push(a);for(var d=0;d<a.children.length;d++)c.push.apply(c,this.getBoneList(a.children[d]));
return c};ne.prototype.update=function(){var a=new r,c=new y,d=new y;return function(){var g=this.geometry,u=g.getAttribute("position");d.getInverse(this.root.matrixWorld);for(var x=0,A=0;x<this.bones.length;x++){var H=this.bones[x];H.parent&&H.parent.isBone&&(c.multiplyMatrices(d,H.matrixWorld),a.setFromMatrixPosition(c),u.setXYZ(A,a.x,a.y,a.z),c.multiplyMatrices(d,H.parent.matrixWorld),a.setFromMatrixPosition(c),u.setXYZ(A+1,a.x,a.y,a.z),A+=2)}g.getAttribute("position").needsUpdate=!0}}();oe.prototype=
Object.create(Zb.prototype);oe.prototype.constructor=oe;oe.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};oe.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};pe.prototype=Object.create(lb.prototype);pe.prototype.constructor=pe;pe.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose();this.children[1].geometry.dispose();this.children[1].material.dispose()};pe.prototype.update=
function(){var a=new r,c=new r;return function(){var d=this.children[0],g=this.children[1];if(this.light.target){a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);var u=c.clone().sub(a);d.lookAt(u);g.lookAt(u)}d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);g.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);g=.5*this.light.width;u=.5*this.light.height;d=d.geometry.getAttribute("position");var x=
d.array;x[0]=g;x[1]=-u;x[2]=0;x[3]=g;x[4]=u;x[5]=0;x[6]=-g;x[7]=u;x[8]=0;x[9]=-g;x[10]=u;x[11]=0;x[12]=-g;x[13]=-u;x[14]=0;x[15]=g;x[16]=-u;x[17]=0;d.needsUpdate=!0}}();qe.prototype=Object.create(lb.prototype);qe.prototype.constructor=qe;qe.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};qe.prototype.update=function(){var a=new r,c=new ka,d=new ka;return function(){var g=this.children[0],u=g.geometry.getAttribute("color");c.copy(this.light.color).multiplyScalar(this.light.intensity);
d.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var x=0,A=u.count;x<A;x++){var H=x<A/2?c:d;u.setXYZ(x,H.r,H.g,H.b)}g.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());u.needsUpdate=!0}}();Ye.prototype=Object.create(Vb.prototype);Ye.prototype.constructor=Ye;Jf.prototype=Object.create(Vb.prototype);Jf.prototype.constructor=Jf;Ze.prototype=Object.create(Vb.prototype);Ze.prototype.constructor=Ze;Ze.prototype.update=function(){var a=new r,c=new r,d=new Pb;return function(){this.object.updateMatrixWorld(!0);
d.getNormalMatrix(this.object.matrixWorld);var g=this.object.matrixWorld,u=this.geometry.attributes.position,x=this.object.geometry,A=x.vertices;x=x.faces;for(var H=0,K=0,M=x.length;K<M;K++){var R=x[K],O=R.normal;a.copy(A[R.a]).add(A[R.b]).add(A[R.c]).divideScalar(3).applyMatrix4(g);c.copy(O).applyMatrix3(d).normalize().multiplyScalar(this.size).add(a);u.setXYZ(H,a.x,a.y,a.z);H+=1;u.setXYZ(H,c.x,c.y,c.z);H+=1}u.needsUpdate=!0;return this}}();re.prototype=Object.create(lb.prototype);re.prototype.constructor=
re;re.prototype.dispose=function(){var a=this.children[0],c=this.children[1];a.geometry.dispose();a.material.dispose();c.geometry.dispose();c.material.dispose()};re.prototype.update=function(){var a=new r,c=new r,d=new r;return function(){a.setFromMatrixPosition(this.light.matrixWorld);c.setFromMatrixPosition(this.light.target.matrixWorld);d.subVectors(c,a);var g=this.children[0],u=this.children[1];g.lookAt(d);g.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);u.lookAt(d);
u.scale.z=d.length()}}();$e.prototype=Object.create(Vb.prototype);$e.prototype.constructor=$e;$e.prototype.update=function(){function a(x,A,H,K){g.set(A,H,K).unproject(u);x=d[x];if(void 0!==x)for(A=c.getAttribute("position"),H=0,K=x.length;H<K;H++)A.setXYZ(x[H],g.x,g.y,g.z)}var c,d,g=new r,u=new Ka;return function(){c=this.geometry;d=this.pointMap;u.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",
-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);c.getAttribute("position").needsUpdate=!0}}();se.prototype=Object.create(Vb.prototype);se.prototype.constructor=se;se.prototype.update=function(){var a=new vb;return function(c){c&&c.isBox3?a.copy(c):a.setFromObject(c);if(!a.isEmpty()){c=a.min;var d=a.max,g=this.geometry.attributes.position,
u=g.array;u[0]=d.x;u[1]=d.y;u[2]=d.z;u[3]=c.x;u[4]=d.y;u[5]=d.z;u[6]=c.x;u[7]=c.y;u[8]=d.z;u[9]=d.x;u[10]=c.y;u[11]=d.z;u[12]=d.x;u[13]=d.y;u[14]=c.z;u[15]=c.x;u[16]=d.y;u[17]=c.z;u[18]=c.x;u[19]=c.y;u[20]=c.z;u[21]=d.x;u[22]=c.y;u[23]=c.z;g.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var Kf,lg;Gd.prototype=Object.create(lb.prototype);Gd.prototype.constructor=Gd;Gd.prototype.setDirection=function(){var a=new r,c;return function(d){.99999<d.y?this.quaternion.set(0,0,0,1):-.99999>d.y?
this.quaternion.set(1,0,0,0):(a.set(d.z,0,-d.x).normalize(),c=Math.acos(d.y),this.quaternion.setFromAxisAngle(a,c))}}();Gd.prototype.setLength=function(a,c,d){void 0===c&&(c=.2*a);void 0===d&&(d=.2*c);this.line.scale.set(1,Math.max(0,a-c),1);this.line.updateMatrix();this.cone.scale.set(d,c,d);this.cone.position.y=a;this.cone.updateMatrix()};Gd.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};Lf.prototype=Object.create(Vb.prototype);Lf.prototype.constructor=
Lf;var Of=new r,pg=new mg,qg=new mg,rg=new mg;Nc.prototype=Object.create(rc.prototype);Nc.prototype.constructor=Nc;Nc.prototype.getPoint=function(a){var c=this.points,d=c.length;2>d&&console.log("duh, you need at least 2 points");a*=d-(this.closed?0:1);var g=Math.floor(a);a-=g;this.closed?g+=0<g?0:(Math.floor(Math.abs(g)/c.length)+1)*c.length:0===a&&g===d-1&&(g=d-2,a=1);if(this.closed||0<g)var u=c[(g-1)%d];else Of.subVectors(c[0],c[1]).add(c[0]),u=Of;var x=c[g%d];var A=c[(g+1)%d];this.closed||g+2<
d?c=c[(g+2)%d]:(Of.subVectors(c[d-1],c[d-2]).add(c[d-1]),c=Of);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var H="chordal"===this.type?.5:.25;d=Math.pow(u.distanceToSquared(x),H);g=Math.pow(x.distanceToSquared(A),H);H=Math.pow(A.distanceToSquared(c),H);1E-4>g&&(g=1);1E-4>d&&(d=g);1E-4>H&&(H=g);pg.initNonuniformCatmullRom(u.x,x.x,A.x,c.x,d,g,H);qg.initNonuniformCatmullRom(u.y,x.y,A.y,c.y,d,g,H);rg.initNonuniformCatmullRom(u.z,x.z,A.z,c.z,d,g,H)}else"catmullrom"===this.type&&
(d=void 0!==this.tension?this.tension:.5,pg.initCatmullRom(u.x,x.x,A.x,c.x,d),qg.initCatmullRom(u.y,x.y,A.y,c.y,d),rg.initCatmullRom(u.z,x.z,A.z,c.z,d));return new r(pg.calc(a),qg.calc(a),rg.calc(a))};af.prototype=Object.create(rc.prototype);af.prototype.constructor=af;af.prototype.getPoint=function(a){var c=this.v0,d=this.v1,g=this.v2,u=this.v3;return new r(Cd(a,c.x,d.x,g.x,u.x),Cd(a,c.y,d.y,g.y,u.y),Cd(a,c.z,d.z,g.z,u.z))};bf.prototype=Object.create(rc.prototype);bf.prototype.constructor=bf;bf.prototype.getPoint=
function(a){var c=this.v0,d=this.v1,g=this.v2;return new r(Bd(a,c.x,d.x,g.x),Bd(a,c.y,d.y,g.y),Bd(a,c.z,d.z,g.z))};cf.prototype=Object.create(rc.prototype);cf.prototype.constructor=cf;cf.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var c=new r;c.subVectors(this.v2,this.v1);c.multiplyScalar(a);c.add(this.v1);return c};Mf.prototype=Object.create(ad.prototype);Mf.prototype.constructor=Mf;rc.create=function(a,c){console.log("THREE.Curve.create() has been deprecated");a.prototype=Object.create(rc.prototype);
a.prototype.constructor=a;a.prototype.getPoint=c;return a};Ng.prototype=Object.create(Nc.prototype);Og.prototype=Object.create(Nc.prototype);ng.prototype=Object.create(Nc.prototype);Object.assign(ng.prototype,{initFromArray:function(a){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(a){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(a){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});
Ye.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Object.assign(Aa.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");
return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(vb.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");
return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});ed.prototype.center=function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(a)};xb.random16=function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");
return Math.random()};Object.assign(Pb.prototype,{flattenToArrayOffset:function(a,c){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,c)},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},applyToBuffer:function(a,c,d){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)},applyToVector3Array:function(a,c,d){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(y.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},
flattenToArrayOffset:function(a,c){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,c)},getPosition:function(){var a;return function(){void 0===a&&(a=new r);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");
return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},
rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(a,c,d){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)},applyToVector3Array:function(a,c,d){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},
makeFrustum:function(a,c,d,g,u,x){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(a,c,g,d,u,x)}});Sb.prototype.isIntersectionLine=function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(a)};t.prototype.multiplyVector3=function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");
return a.applyQuaternion(this)};Object.assign(sc.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});
Object.assign(Ed.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new Fc(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Yd(this,a)}});Object.assign(k.prototype,{fromAttribute:function(a,c,d){console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,c,d)}});Object.assign(r.prototype,
{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,c){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(c,a)},applyProjection:function(a){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(a)},fromAttribute:function(a,c,d){console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,
c,d)}});Object.assign(p.prototype,{fromAttribute:function(a,c,d){console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(a,c,d)}});sb.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")};Object.assign(lb.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},
translate:function(a,c){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(c,a)}});Object.defineProperties(lb.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(ye.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Oa.prototype.setLens=function(a,c){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==c&&(this.filmGauge=c);this.setFocalLength(a)};Object.defineProperties(ac.prototype,
{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");
this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},
shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(zb.prototype,
{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}}});Object.assign(ob.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,c,d){void 0!==d&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,
c)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(ob.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");
return this.groups}}});Object.defineProperties(If.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(Za.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+
": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new ka}}});Object.defineProperties(Lc.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(kb.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});Object.assign(Rf.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");
return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},
supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");
return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},
addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(Rf.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");
this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties(cd.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(q.prototype,
{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");
return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");
return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},
set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});ie.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var c=this;(new cg).load(a,function(d){c.setBuffer(d)});return this};
hg.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};b.WebGLRenderTargetCube=l;b.WebGLRenderTarget=q;b.WebGLRenderer=Rf;b.ShaderLib=dd;b.UniformsLib=Ab;b.UniformsUtils=nc;b.ShaderChunk=Mb;b.FogExp2=Kd;b.Fog=Ld;b.Scene=kf;b.LensFlare=Vf;b.Sprite=xe;b.LOD=ye;b.SkinnedMesh=nf;b.Skeleton=lf;b.Bone=mf;b.Mesh=Zb;b.LineSegments=Vb;b.LineLoop=of;b.Line=Ic;b.Points=Md;b.Group=ze;b.VideoTexture=pf;b.DataTexture=va;b.CompressedTexture=
Nd;b.CubeTexture=z;b.CanvasTexture=qf;b.DepthTexture=Ae;b.Texture=e;b.CompressedTextureLoader=zg;b.DataTextureLoader=Xf;b.CubeTextureLoader=Yf;b.TextureLoader=sf;b.ObjectLoader=Ag;b.MaterialLoader=Gf;b.BufferGeometryLoader=Zf;b.DefaultLoadingManager=zc;b.LoadingManager=Wf;b.JSONLoader=$f;b.ImageLoader=Re;b.FontLoader=Cg;b.FileLoader=Mc;b.Loader=fe;b.Cache=df;b.AudioLoader=cg;b.SpotLightShadow=uf;b.SpotLight=vf;b.PointLight=wf;b.RectAreaLight=dg;b.HemisphereLight=tf;b.DirectionalLightShadow=xf;b.DirectionalLight=
yf;b.AmbientLight=zf;b.LightShadow=yd;b.Light=ac;b.StereoCamera=Dg;b.PerspectiveCamera=Oa;b.OrthographicCamera=Ha;b.CubeCamera=Hf;b.Camera=Ka;b.AudioListener=eg;b.PositionalAudio=gg;b.AudioContext=fg;b.AudioAnalyser=hg;b.Audio=ie;b.VectorKeyframeTrack=de;b.StringKeyframeTrack=Df;b.QuaternionKeyframeTrack=Te;b.NumberKeyframeTrack=ee;b.ColorKeyframeTrack=Ff;b.BooleanKeyframeTrack=Ef;b.PropertyMixer=ig;b.PropertyBinding=lc;b.KeyframeTrack=Ad;b.AnimationUtils=kc;b.AnimationObjectGroup=Fg;b.AnimationMixer=
Hg;b.AnimationClip=Gc;b.Uniform=If;b.InstancedBufferGeometry=Fd;b.BufferGeometry=ob;b.GeometryIdCount=function(){return Qf++};b.Geometry=sb;b.InterleavedBufferAttribute=jg;b.InstancedInterleavedBuffer=ke;b.InterleavedBuffer=je;b.InstancedBufferAttribute=le;b.Face3=bc;b.Object3D=lb;b.Raycaster=Ig;b.Layers=te;b.EventDispatcher=h;b.Clock=Kg;b.QuaternionLinearInterpolant=Cf;b.LinearInterpolant=Se;b.DiscreteInterpolant=Bf;b.CubicInterpolant=Af;b.Interpolant=Ac;b.Triangle=gc;b.Math=xb;b.Spherical=Lg;b.Cylindrical=
Mg;b.Plane=Sb;b.Frustum=bd;b.Sphere=Nb;b.Ray=sc;b.Matrix4=y;b.Matrix3=Pb;b.Box3=vb;b.Box2=Aa;b.Line3=ed;b.Euler=tc;b.Vector4=p;b.Vector3=r;b.Vector2=k;b.Quaternion=t;b.Color=ka;b.MorphBlendMesh=ic;b.ImmediateRenderObject=We;b.VertexNormalsHelper=Xe;b.SpotLightHelper=me;b.SkeletonHelper=ne;b.PointLightHelper=oe;b.RectAreaLightHelper=pe;b.HemisphereLightHelper=qe;b.GridHelper=Ye;b.PolarGridHelper=Jf;b.FaceNormalsHelper=Ze;b.DirectionalLightHelper=re;b.CameraHelper=$e;b.BoxHelper=se;b.ArrowHelper=Gd;
b.AxisHelper=Lf;b.CatmullRomCurve3=Nc;b.CubicBezierCurve3=af;b.QuadraticBezierCurve3=bf;b.LineCurve3=cf;b.ArcCurve=Mf;b.EllipseCurve=ad;b.SplineCurve=Dd;b.CubicBezierCurve=ge;b.QuadraticBezierCurve=he;b.LineCurve=Xc;b.Shape=Ed;b.Path=Ve;b.ShapePath=ag;b.Font=bg;b.CurvePath=Ue;b.Curve=rc;b.ShapeUtils=Kc;b.SceneUtils={createMultiMaterialObject:function(a,c){for(var d=new ze,g=0,u=c.length;g<u;g++)d.add(new Zb(a,c[g]));return d},detach:function(a,c,d){a.applyMatrix(c.matrixWorld);c.remove(a);d.add(a)},
attach:function(a,c,d){var g=new y;g.getInverse(d.matrixWorld);a.applyMatrix(g);c.remove(a);d.add(a)}};b.WireframeGeometry=Od;b.ParametricGeometry=Be;b.ParametricBufferGeometry=Pd;b.TetrahedronGeometry=De;b.TetrahedronBufferGeometry=Qd;b.OctahedronGeometry=Ee;b.OctahedronBufferGeometry=qd;b.IcosahedronGeometry=Fe;b.IcosahedronBufferGeometry=Rd;b.DodecahedronGeometry=Ge;b.DodecahedronBufferGeometry=Sd;b.PolyhedronGeometry=Ce;b.PolyhedronBufferGeometry=qc;b.TubeGeometry=He;b.TubeBufferGeometry=Td;b.TorusKnotGeometry=
Ie;b.TorusKnotBufferGeometry=Ud;b.TorusGeometry=Je;b.TorusBufferGeometry=Vd;b.TextGeometry=Ke;b.SphereGeometry=Le;b.SphereBufferGeometry=rd;b.RingGeometry=Me;b.RingBufferGeometry=Wd;b.PlaneGeometry=ua;b.PlaneBufferGeometry=Da;b.LatheGeometry=Ne;b.LatheBufferGeometry=Xd;b.ShapeGeometry=Yd;b.ShapeBufferGeometry=Zd;b.ExtrudeGeometry=Fc;b.EdgesGeometry=$d;b.ConeGeometry=Oe;b.ConeBufferGeometry=Pe;b.CylinderGeometry=sd;b.CylinderBufferGeometry=$c;b.CircleGeometry=Qe;b.CircleBufferGeometry=ae;b.BoxGeometry=
oc;b.BoxBufferGeometry=pc;b.ShadowMaterial=be;b.SpriteMaterial=pd;b.RawShaderMaterial=ce;b.ShaderMaterial=kb;b.PointsMaterial=Jc;b.MultiMaterial=rf;b.MeshPhysicalMaterial=td;b.MeshStandardMaterial=Wc;b.MeshPhongMaterial=Lc;b.MeshToonMaterial=ud;b.MeshNormalMaterial=vd;b.MeshLambertMaterial=wd;b.MeshDepthMaterial=Hb;b.MeshBasicMaterial=hc;b.LineDashedMaterial=xd;b.LineBasicMaterial=$b;b.Material=Za;b.Float64BufferAttribute=Zc;b.Float32BufferAttribute=ib;b.Uint32BufferAttribute=Qc;b.Int32BufferAttribute=
Cc;b.Uint16BufferAttribute=Bc;b.Int16BufferAttribute=fd;b.Uint8ClampedBufferAttribute=uc;b.Uint8BufferAttribute=Pc;b.Int8BufferAttribute=Yc;b.BufferAttribute=zb;b.REVISION="85dev";b.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};b.CullFaceNone=0;b.CullFaceBack=1;b.CullFaceFront=2;b.CullFaceFrontBack=3;b.FrontFaceDirectionCW=0;b.FrontFaceDirectionCCW=1;b.BasicShadowMap=0;b.PCFShadowMap=1;b.PCFSoftShadowMap=2;b.FrontSide=0;b.BackSide=1;b.DoubleSide=2;b.FlatShading=1;b.SmoothShading=2;b.NoColors=0;b.FaceColors=1;b.VertexColors=
2;b.NoBlending=0;b.NormalBlending=1;b.AdditiveBlending=2;b.SubtractiveBlending=3;b.MultiplyBlending=4;b.CustomBlending=5;b.AddEquation=100;b.SubtractEquation=101;b.ReverseSubtractEquation=102;b.MinEquation=103;b.MaxEquation=104;b.ZeroFactor=200;b.OneFactor=201;b.SrcColorFactor=202;b.OneMinusSrcColorFactor=203;b.SrcAlphaFactor=204;b.OneMinusSrcAlphaFactor=205;b.DstAlphaFactor=206;b.OneMinusDstAlphaFactor=207;b.DstColorFactor=208;b.OneMinusDstColorFactor=209;b.SrcAlphaSaturateFactor=210;b.NeverDepth=
0;b.AlwaysDepth=1;b.LessDepth=2;b.LessEqualDepth=3;b.EqualDepth=4;b.GreaterEqualDepth=5;b.GreaterDepth=6;b.NotEqualDepth=7;b.MultiplyOperation=0;b.MixOperation=1;b.AddOperation=2;b.NoToneMapping=0;b.LinearToneMapping=1;b.ReinhardToneMapping=2;b.Uncharted2ToneMapping=3;b.CineonToneMapping=4;b.UVMapping=300;b.CubeReflectionMapping=301;b.CubeRefractionMapping=302;b.EquirectangularReflectionMapping=303;b.EquirectangularRefractionMapping=304;b.SphericalReflectionMapping=305;b.CubeUVReflectionMapping=306;
b.CubeUVRefractionMapping=307;b.RepeatWrapping=1E3;b.ClampToEdgeWrapping=1001;b.MirroredRepeatWrapping=1002;b.NearestFilter=1003;b.NearestMipMapNearestFilter=1004;b.NearestMipMapLinearFilter=1005;b.LinearFilter=1006;b.LinearMipMapNearestFilter=1007;b.LinearMipMapLinearFilter=1008;b.UnsignedByteType=1009;b.ByteType=1010;b.ShortType=1011;b.UnsignedShortType=1012;b.IntType=1013;b.UnsignedIntType=1014;b.FloatType=1015;b.HalfFloatType=1016;b.UnsignedShort4444Type=1017;b.UnsignedShort5551Type=1018;b.UnsignedShort565Type=
1019;b.UnsignedInt248Type=1020;b.AlphaFormat=1021;b.RGBFormat=1022;b.RGBAFormat=1023;b.LuminanceFormat=1024;b.LuminanceAlphaFormat=1025;b.RGBEFormat=1023;b.DepthFormat=1026;b.DepthStencilFormat=1027;b.RGB_S3TC_DXT1_Format=2001;b.RGBA_S3TC_DXT1_Format=2002;b.RGBA_S3TC_DXT3_Format=2003;b.RGBA_S3TC_DXT5_Format=2004;b.RGB_PVRTC_4BPPV1_Format=2100;b.RGB_PVRTC_2BPPV1_Format=2101;b.RGBA_PVRTC_4BPPV1_Format=2102;b.RGBA_PVRTC_2BPPV1_Format=2103;b.RGB_ETC1_Format=2151;b.LoopOnce=2200;b.LoopRepeat=2201;b.LoopPingPong=
2202;b.InterpolateDiscrete=2300;b.InterpolateLinear=2301;b.InterpolateSmooth=2302;b.ZeroCurvatureEnding=2400;b.ZeroSlopeEnding=2401;b.WrapAroundEnding=2402;b.TrianglesDrawMode=0;b.TriangleStripDrawMode=1;b.TriangleFanDrawMode=2;b.LinearEncoding=3E3;b.sRGBEncoding=3001;b.GammaEncoding=3007;b.RGBEEncoding=3002;b.LogLuvEncoding=3003;b.RGBM7Encoding=3004;b.RGBM16Encoding=3005;b.RGBDEncoding=3006;b.BasicDepthPacking=3200;b.RGBADepthPacking=3201;b.CubeGeometry=oc;b.Face4=function(a,c,d,g,u,x,A){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");
return new bc(a,c,d,u,x,A)};b.LineStrip=0;b.LinePieces=1;b.MeshFaceMaterial=function(a){console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial.");return new rf(a)};b.PointCloud=function(a,c){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Md(a,c)};b.Particle=function(a){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new xe(a)};b.ParticleSystem=function(a,c){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");
return new Md(a,c)};b.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Jc(a)};b.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Jc(a)};b.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Jc(a)};b.Vertex=function(a,c,d){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");
return new r(a,c,d)};b.DynamicBufferAttribute=function(a,c){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new zb(a,c)).setDynamic(!0)};b.Int8Attribute=function(a,c){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Yc(a,c)};b.Uint8Attribute=function(a,c){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Pc(a,
c)};b.Uint8ClampedAttribute=function(a,c){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new uc(a,c)};b.Int16Attribute=function(a,c){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new fd(a,c)};b.Uint16Attribute=function(a,c){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Bc(a,c)};b.Int32Attribute=
function(a,c){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new Cc(a,c)};b.Uint32Attribute=function(a,c){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Qc(a,c)};b.Float32Attribute=function(a,c){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new ib(a,c)};b.Float64Attribute=function(a,c){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");
return new Zc(a,c)};b.ClosedSplineCurve3=Ng;b.SplineCurve3=Og;b.Spline=ng;b.BoundingBoxHelper=function(a,c){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new se(a,c)};b.EdgesHelper=function(a,c){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new Vb(new $d(a.geometry),new $b({color:void 0!==c?c:16777215}))};b.WireframeHelper=function(a,c){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");
return new Vb(new Od(a.geometry),new $b({color:void 0!==c?c:16777215}))};b.XHRLoader=function(a){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Mc(a)};b.BinaryTextureLoader=function(a){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new Xf(a)};b.GeometryUtils={merge:function(a,c,d){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
if(c.isMesh){c.matrixAutoUpdate&&c.updateMatrix();var g=c.matrix;c=c.geometry}a.merge(c,g,d)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};b.ImageUtils={crossOrigin:void 0,loadTexture:function(a,c,d,g){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var u=new sf;u.setCrossOrigin(this.crossOrigin);a=u.load(a,d,void 0,g);c&&(a.mapping=c);return a},
loadTextureCube:function(a,c,d,g){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var u=new Yf;u.setCrossOrigin(this.crossOrigin);a=u.load(a,d,void 0,g);c&&(a.mapping=c);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
b.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,c){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(c)};this.unprojectVector=function(a,c){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(c)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};b.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");
this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(b,"__esModule",{value:!0})}));
THREE.VREffect=function(b,h){var k,e,p,q,l,t,r,y;function z(S){I=S;0<S.length?F=S[0]:h&&h("HMD not available")}function E(){var S=w.isPresenting;w.isPresenting=void 0!==F&&F.isPresenting;if(w.isPresenting){var T=F.getEyeParameters("left"),W=T.renderWidth;T=T.renderHeight;S||(m=b.getPixelRatio(),G=b.getSize(),b.setPixelRatio(1),b.setSize(2*W,T,!1))}else S&&(b.setPixelRatio(m),b.setSize(G.width,G.height,f))}function B(S,T,W,Y){var V=Math.PI/180;var ma=Math.tan(S.upDegrees*V);var ha=Math.tan(S.downDegrees*
V),ia=Math.tan(S.leftDegrees*V);S=Math.tan(S.rightDegrees*V);W=void 0===W?.01:W;Y=void 0===Y?1E4:Y;V=void 0===T||T?-1:1;var aa=new THREE.Matrix4,ea=aa.elements,ja=2/(ia+S),Q=2/(ma+ha);T=[ja,Q];ma=[(ia-S)*ja*.5,(ma-ha)*Q*.5];ea[0]=T[0];ea[1]=0;ea[2]=ma[0]*V;ea[3]=0;ea[4]=0;ea[5]=T[1];ea[6]=-ma[1]*V;ea[7]=0;ea[8]=0;ea[9]=0;ea[10]=Y/(W-Y)*-V;ea[11]=Y*W/(W-Y);ea[12]=0;ea[13]=0;ea[14]=V;ea[15]=0;aa.transpose();return aa}var F,I,L=new THREE.Vector3,U=new THREE.Vector3,n=null;"VRFrameData"in window&&(n=
new window.VRFrameData);navigator.getVRDisplays&&navigator.getVRDisplays().then(z).catch(function(){console.warn("THREE.VREffect: Unable to get VR Displays")});this.isPresenting=!1;this.scale=1;var w=this,G=b.getSize(),f=!1,m=b.getPixelRatio();this.getVRDisplay=function(){return F};this.setVRDisplay=function(S){F=S};this.getVRDisplays=function(){console.warn("THREE.VREffect: getVRDisplays() is being deprecated.");return I};this.setSize=function(S,T,W){G={width:S,height:T};f=W;w.isPresenting?(S=F.getEyeParameters("left"),
b.setPixelRatio(1),b.setSize(2*S.renderWidth,S.renderHeight,!1)):(b.setPixelRatio(m),b.setSize(S,T,W))};var v=b.domElement,D=[0,0,.5,1],C=[.5,0,.5,1];window.addEventListener("vrdisplaypresentchange",E,!1);this.setFullScreen=function(S){return new Promise(function(T,W){void 0===F?W(Error("No VR hardware found.")):w.isPresenting===S?T():S?T(F.requestPresent([{source:v}])):T(F.exitPresent())})};this.requestPresent=function(){return this.setFullScreen(!0)};this.exitPresent=function(){return this.setFullScreen(!1)};
this.requestAnimationFrame=function(S){return void 0!==F?F.requestAnimationFrame(S):window.requestAnimationFrame(S)};this.cancelAnimationFrame=function(S){void 0!==F?F.cancelAnimationFrame(S):window.cancelAnimationFrame(S)};this.submitFrame=function(){void 0!==F&&w.isPresenting&&F.submitFrame()};this.autoSubmitFrame=!0;var J=new THREE.PerspectiveCamera;J.layers.enable(1);var N=new THREE.PerspectiveCamera;N.layers.enable(2);this.render=function(S,T,W,Y){if(F&&w.isPresenting){var V=S.autoUpdate;V&&
(S.updateMatrixWorld(),S.autoUpdate=!1);var ma=F.getEyeParameters("left"),ha=F.getEyeParameters("right");L.fromArray(ma.offset);U.fromArray(ha.offset);Array.isArray(S)&&(console.warn("THREE.VREffect.render() no longer supports arrays. Use object.layers instead."),S=S[0]);var ia=b.getSize(),aa=F.getLayers();if(aa.length){var ea=aa[0];aa=null!==ea.leftBounds&&4===ea.leftBounds.length?ea.leftBounds:D;ea=null!==ea.rightBounds&&4===ea.rightBounds.length?ea.rightBounds:C}else aa=D,ea=C;l=Math.round(ia.width*
aa[0]);t=Math.round(ia.height*aa[1]);r=Math.round(ia.width*aa[2]);y=Math.round(ia.height*aa[3]);k=Math.round(ia.width*ea[0]);e=Math.round(ia.height*ea[1]);p=Math.round(ia.width*ea[2]);q=Math.round(ia.height*ea[3]);W?(b.setRenderTarget(W),W.scissorTest=!0):(b.setRenderTarget(null),b.setScissorTest(!0));(b.autoClear||Y)&&b.clear();null===T.parent&&T.updateMatrixWorld();T.matrixWorld.decompose(J.position,J.quaternion,J.scale);T.matrixWorld.decompose(N.position,N.quaternion,N.scale);aa=this.scale;J.translateOnAxis(L,
aa);N.translateOnAxis(U,aa);F.getFrameData?(F.depthNear=T.near,F.depthFar=T.far,F.getFrameData(n),J.projectionMatrix.elements=n.leftProjectionMatrix,N.projectionMatrix.elements=n.rightProjectionMatrix):(J.projectionMatrix=B(ma.fieldOfView,!0,T.near,T.far),N.projectionMatrix=B(ha.fieldOfView,!0,T.near,T.far));W?(W.viewport.set(l,t,r,y),W.scissor.set(l,t,r,y)):(b.setViewport(l,t,r,y),b.setScissor(l,t,r,y));b.render(S,J,W,Y);W?(W.viewport.set(k,e,p,q),W.scissor.set(k,e,p,q)):(b.setViewport(k,e,p,q),
b.setScissor(k,e,p,q));b.render(S,N,W,Y);W?(W.viewport.set(0,0,ia.width,ia.height),W.scissor.set(0,0,ia.width,ia.height),W.scissorTest=!1,b.setRenderTarget(null)):(b.setViewport(0,0,ia.width,ia.height),b.setScissorTest(!1));V&&(S.autoUpdate=!0);w.autoSubmitFrame&&w.submitFrame()}else b.render(S,T,W,Y)};this.dispose=function(){window.removeEventListener("vrdisplaypresentchange",E,!1)}};
THREE.Animation=function(b,h){this.root=b;this.data=THREE.AnimationHandler.init(h);this.hierarchy=THREE.AnimationHandler.parse(b);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=!0;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};
THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(b,h){this.currentTime=void 0!==b?b:0;this.weight=void 0!==h?h:1;this.isPlaying=!0;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=!1;THREE.AnimationHandler.stop(this)},reset:function(){for(var b=0,h=this.hierarchy.length;b<h;b++){var k=this.hierarchy[b];void 0===k.animationCache&&(k.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}});
var e=this.data.name,p=k.animationCache.animations,q=p[e];void 0===q&&(q={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:k.matrix},p[e]=q);for(k=0;3>k;k++){e=this.keyTypes[k];p=this.data.hierarchy[b].keys[0];for(var l=this.getNextKeyWith(e,b,1);l.time<this.currentTime&&l.index>p.index;)p=l,l=this.getNextKeyWith(e,b,l.index+1);q.prevKey[e]=p;q.nextKey[e]=l}}},resetBlendWeights:function(){for(var b=0,h=this.hierarchy.length;b<h;b++){var k=this.hierarchy[b].animationCache;void 0!==
k&&(k=k.blending,k.positionWeight=0,k.quaternionWeight=0,k.scaleWeight=0)}},update:function(){var b=[],h=new THREE.Vector3,k=new THREE.Vector3,e=new THREE.Quaternion,p=function(l,t){var r=[],y=[];t*=l.length-1;var z=Math.floor(t);t-=z;r[0]=0===z?z:z-1;r[1]=z;r[2]=z>l.length-2?z:z+1;r[3]=z>l.length-3?z:z+2;z=l[r[0]];var E=l[r[1]];var B=l[r[2]];var F=l[r[3]];l=t*t;r=t*l;y[0]=q(z[0],E[0],B[0],F[0],t,l,r);y[1]=q(z[1],E[1],B[1],F[1],t,l,r);y[2]=q(z[2],E[2],B[2],F[2],t,l,r);return y},q=function(l,t,r,y,
z,E,B){l=.5*(r-l);y=.5*(y-t);return(2*(t-r)+l+y)*B+(-3*(t-r)-2*l-y)*E+l*z+t};return function(l){if(!1!==this.isPlaying&&(this.currentTime+=l*this.timeScale,0!==this.weight)){l=this.data.length;if(this.currentTime>l||0>this.currentTime)this.loop?(this.currentTime%=l,0>this.currentTime&&(this.currentTime+=l),this.reset()):this.stop();l=0;for(var t=this.hierarchy.length;l<t;l++)for(var r=this.hierarchy[l],y=r.animationCache.animations[this.data.name],z=r.animationCache.blending,E=0;3>E;E++){var B=this.keyTypes[E],
F=y.prevKey[B],I=y.nextKey[B];if(0<this.timeScale&&I.time<=this.currentTime||0>this.timeScale&&F.time>=this.currentTime){F=this.data.hierarchy[l].keys[0];for(I=this.getNextKeyWith(B,l,1);I.time<this.currentTime&&I.index>F.index;)F=I,I=this.getNextKeyWith(B,l,I.index+1);y.prevKey[B]=F;y.nextKey[B]=I}var L=(this.currentTime-F.time)/(I.time-F.time),U=F[B],n=I[B];0>L&&(L=0);1<L&&(L=1);if("pos"===B)if(this.interpolationType===THREE.AnimationHandler.LINEAR)k.x=U[0]+(n[0]-U[0])*L,k.y=U[1]+(n[1]-U[1])*L,
k.z=U[2]+(n[2]-U[2])*L,F=this.weight/(this.weight+z.positionWeight),r.position.lerp(k,F),z.positionWeight+=this.weight;else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)b[0]=this.getPrevKeyWith("pos",l,F.index-1).pos,b[1]=U,b[2]=n,b[3]=this.getNextKeyWith("pos",l,I.index+1).pos,L=.33*L+.33,I=p(b,L),F=this.weight/(this.weight+z.positionWeight),z.positionWeight+=this.weight,B=r.position,B.x+=(I[0]-B.x)*F,B.y+=(I[1]-
B.y)*F,B.z+=(I[2]-B.z)*F,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(L=p(b,1.01*L),h.set(L[0],L[1],L[2]),h.sub(B),h.y=0,h.normalize(),r.rotation.set(0,Math.atan2(h.x,h.z),0))}else"rot"===B?(THREE.Quaternion.slerp(U,n,e,L),0===z.quaternionWeight?(r.quaternion.copy(e),z.quaternionWeight=this.weight):(F=this.weight/(this.weight+z.quaternionWeight),THREE.Quaternion.slerp(r.quaternion,e,r.quaternion,F),z.quaternionWeight+=this.weight)):"scl"===B&&(k.x=U[0]+(n[0]-U[0])*L,k.y=U[1]+
(n[1]-U[1])*L,k.z=U[2]+(n[2]-U[2])*L,F=this.weight/(this.weight+z.scaleWeight),r.scale.lerp(k,F),z.scaleWeight+=this.weight)}return!0}}}(),getNextKeyWith:function(b,h,k){var e=this.data.hierarchy[h].keys;for(k=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?k<e.length-1?k:e.length-1:k%e.length;k<e.length;k++)if(void 0!==e[k][b])return e[k];return this.data.hierarchy[h].keys[0]},getPrevKeyWith:function(b,h,k){var e=this.data.hierarchy[h].keys;
for(k=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<k?k:0:0<=k?k:k+e.length;0<=k;k--)if(void 0!==e[k][b])return e[k];return this.data.hierarchy[h].keys[e.length-1]}};
THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){console.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){console.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){console.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(b){if(!0===b.initialized)return b;for(var h=0;h<b.hierarchy.length;h++){for(var k=0;k<b.hierarchy[h].keys.length;k++)if(0>b.hierarchy[h].keys[k].time&&(b.hierarchy[h].keys[k].time=
0),void 0!==b.hierarchy[h].keys[k].rot&&!(b.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)){var e=b.hierarchy[h].keys[k].rot;b.hierarchy[h].keys[k].rot=(new THREE.Quaternion).fromArray(e)}if(b.hierarchy[h].keys.length&&void 0!==b.hierarchy[h].keys[0].morphTargets){e={};for(k=0;k<b.hierarchy[h].keys.length;k++)for(var p=0;p<b.hierarchy[h].keys[k].morphTargets.length;p++){var q=b.hierarchy[h].keys[k].morphTargets[p];e[q]=-1}b.hierarchy[h].usedMorphTargets=e;for(k=0;k<b.hierarchy[h].keys.length;k++){var l=
{};for(q in e){for(p=0;p<b.hierarchy[h].keys[k].morphTargets.length;p++)if(b.hierarchy[h].keys[k].morphTargets[p]===q){l[q]=b.hierarchy[h].keys[k].morphTargetsInfluences[p];break}p===b.hierarchy[h].keys[k].morphTargets.length&&(l[q]=0)}b.hierarchy[h].keys[k].morphTargetsInfluences=l}}for(k=1;k<b.hierarchy[h].keys.length;k++)b.hierarchy[h].keys[k].time===b.hierarchy[h].keys[k-1].time&&(b.hierarchy[h].keys.splice(k,1),k--);for(k=0;k<b.hierarchy[h].keys.length;k++)b.hierarchy[h].keys[k].index=k}b.initialized=
!0;return b},parse:function(b){var h=function(p,q){q.push(p);for(var l=0;l<p.children.length;l++)h(p.children[l],q)},k=[];if(b instanceof THREE.SkinnedMesh)for(var e=0;e<b.skeleton.bones.length;e++)k.push(b.skeleton.bones[e]);else h(b,k);return k},play:function(b){-1===this.animations.indexOf(b)&&this.animations.push(b)},stop:function(b){b=this.animations.indexOf(b);-1!==b&&this.animations.splice(b,1)},update:function(b){for(var h=0;h<this.animations.length;h++)this.animations[h].resetBlendWeights();
for(h=0;h<this.animations.length;h++)this.animations[h].update(b)}};
THREE.KeyFrameAnimation=function(b){this.root=b.node;this.data=THREE.AnimationHandler.init(b);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=!1;this.loop=this.isPaused=!0;b=0;for(var h=this.hierarchy.length;b<h;b++){var k=this.data.hierarchy[b].sids,e=this.hierarchy[b];if(this.data.hierarchy[b].keys.length&&k){for(var p=0;p<k.length;p++){var q=k[p],l=this.getNextKeyWith(q,b,0);l&&l.apply(q)}e.matrixAutoUpdate=!1;this.data.hierarchy[b].node.updateMatrix();
e.matrixWorldNeedsUpdate=!0}}};
THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(b){this.currentTime=void 0!==b?b:0;if(!1===this.isPlaying){this.isPlaying=!0;var h=this.hierarchy.length;for(b=0;b<h;b++){var k=this.hierarchy[b];var e=this.data.hierarchy[b];void 0===e.animationCache&&(e.animationCache={},e.animationCache.prevKey=null,e.animationCache.nextKey=null,e.animationCache.originalMatrix=k.matrix);k=this.data.hierarchy[b].keys;1<k.length&&(e.animationCache.prevKey=k[0],e.animationCache.nextKey=
k[1],this.startTime=Math.min(k[0].time,this.startTime),this.endTime=Math.max(k[k.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1},stop:function(){this.isPaused=this.isPlaying=!1;for(var b=0;b<this.data.hierarchy.length;b++){var h=this.hierarchy[b],k=this.data.hierarchy[b];if(void 0!==k.animationCache){var e=k.animationCache.originalMatrix;e.copy(h.matrix);h.matrix=e;delete k.animationCache}}},update:function(b){if(!1!==this.isPlaying){this.currentTime+=b*this.timeScale;b=this.data.length;
!0===this.loop&&this.currentTime>b&&(this.currentTime%=b);this.currentTime=Math.min(this.currentTime,b);b=0;for(var h=this.hierarchy.length;b<h;b++){var k=this.hierarchy[b],e=this.data.hierarchy[b],p=e.keys;e=e.animationCache;if(p.length){var q=e.prevKey,l=e.nextKey;if(l.time<=this.currentTime){for(;l.time<this.currentTime&&l.index>q.index;)q=l,l=p[q.index+1];e.prevKey=q;e.nextKey=l}l.time>=this.currentTime?q.interpolate(l,this.currentTime):q.interpolate(l,l.time);this.data.hierarchy[b].node.updateMatrix();
k.matrixWorldNeedsUpdate=!0}}}},getNextKeyWith:function(b,h,k){h=this.data.hierarchy[h].keys;for(k%=h.length;k<h.length;k++)if(h[k].hasTarget(b))return h[k];return h[0]},getPrevKeyWith:function(b,h,k){h=this.data.hierarchy[h].keys;for(k=0<=k?k:k+h.length;0<=k;k--)if(h[k].hasTarget(b))return h[k];return h[h.length-1]}};
!function(b){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=b();else{var h;"undefined"!=typeof window?h=window:"undefined"!=typeof global?h=global:"undefined"!=typeof self&&(h=self);h.CANNON=b()}}(function(){return function p(h,k,e){function q(r,y){if(!k[r]){if(!h[r]){var z="function"==typeof require&&require;if(!y&&z)return z(r,!0);if(l)return l(r,!0);throw Error("Cannot find module '"+r+"'");}y=k[r]={exports:{}};h[r][0].call(y.exports,function(E){var B=h[r][1][E];return q(B?
B:E)},y,y.exports,p,h,k,e)}return k[r].exports}for(var l="function"==typeof require&&require,t=0;t<e.length;t++)q(e[t]);return q}({1:[function(h,k){k.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},
bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(h,k){k.exports={version:h("../package.json").version,AABB:h("./collision/AABB"),ArrayCollisionMatrix:h("./collision/ArrayCollisionMatrix"),
Body:h("./objects/Body"),Box:h("./shapes/Box"),Broadphase:h("./collision/Broadphase"),Constraint:h("./constraints/Constraint"),ContactEquation:h("./equations/ContactEquation"),Narrowphase:h("./world/Narrowphase"),ConeTwistConstraint:h("./constraints/ConeTwistConstraint"),ContactMaterial:h("./material/ContactMaterial"),ConvexPolyhedron:h("./shapes/ConvexPolyhedron"),Cylinder:h("./shapes/Cylinder"),DistanceConstraint:h("./constraints/DistanceConstraint"),Equation:h("./equations/Equation"),EventTarget:h("./utils/EventTarget"),
FrictionEquation:h("./equations/FrictionEquation"),GSSolver:h("./solver/GSSolver"),GridBroadphase:h("./collision/GridBroadphase"),Heightfield:h("./shapes/Heightfield"),HingeConstraint:h("./constraints/HingeConstraint"),LockConstraint:h("./constraints/LockConstraint"),Mat3:h("./math/Mat3"),Material:h("./material/Material"),NaiveBroadphase:h("./collision/NaiveBroadphase"),ObjectCollisionMatrix:h("./collision/ObjectCollisionMatrix"),Pool:h("./utils/Pool"),Particle:h("./shapes/Particle"),Plane:h("./shapes/Plane"),
PointToPointConstraint:h("./constraints/PointToPointConstraint"),Quaternion:h("./math/Quaternion"),Ray:h("./collision/Ray"),RaycastVehicle:h("./objects/RaycastVehicle"),RaycastResult:h("./collision/RaycastResult"),RigidVehicle:h("./objects/RigidVehicle"),RotationalEquation:h("./equations/RotationalEquation"),RotationalMotorEquation:h("./equations/RotationalMotorEquation"),SAPBroadphase:h("./collision/SAPBroadphase"),SPHSystem:h("./objects/SPHSystem"),Shape:h("./shapes/Shape"),Solver:h("./solver/Solver"),
Sphere:h("./shapes/Sphere"),SplitSolver:h("./solver/SplitSolver"),Spring:h("./objects/Spring"),Trimesh:h("./shapes/Trimesh"),Vec3:h("./math/Vec3"),Vec3Pool:h("./utils/Vec3Pool"),World:h("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,
"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,
"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(h,k){function e(t){t=t||{};this.lowerBound=
new p;t.lowerBound&&this.lowerBound.copy(t.lowerBound);this.upperBound=new p;t.upperBound&&this.upperBound.copy(t.upperBound)}var p=h("../math/Vec3");h("../utils/Utils");k.exports=e;var q=new p;e.prototype.setFromPoints=function(t,r,y,z){var E=this.lowerBound,B=this.upperBound;E.copy(t[0]);y&&y.vmult(E,E);B.copy(E);for(var F=1;F<t.length;F++){var I=t[F];y&&(y.vmult(I,q),I=q);I.x>B.x&&(B.x=I.x);I.x<E.x&&(E.x=I.x);I.y>B.y&&(B.y=I.y);I.y<E.y&&(E.y=I.y);I.z>B.z&&(B.z=I.z);I.z<E.z&&(E.z=I.z)}return r&&
(r.vadd(E,E),r.vadd(B,B)),z&&(E.x-=z,E.y-=z,E.z-=z,B.x+=z,B.y+=z,B.z+=z),this};e.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this};e.prototype.clone=function(){return(new e).copy(this)};e.prototype.extend=function(t){var r=t.lowerBound.x;this.lowerBound.x>r&&(this.lowerBound.x=r);r=t.upperBound.x;this.upperBound.x<r&&(this.upperBound.x=r);r=t.lowerBound.y;this.lowerBound.y>r&&(this.lowerBound.y=r);r=t.upperBound.y;this.upperBound.y<r&&(this.upperBound.y=
r);r=t.lowerBound.z;this.lowerBound.z>r&&(this.lowerBound.z=r);r=t.upperBound.z;this.upperBound.z<r&&(this.upperBound.z=r)};e.prototype.overlaps=function(t){var r=this.lowerBound,y=this.upperBound,z=t.lowerBound;t=t.upperBound;return(z.x<=y.x&&y.x<=t.x||r.x<=t.x&&t.x<=y.x)&&(z.y<=y.y&&y.y<=t.y||r.y<=t.y&&t.y<=y.y)&&(z.z<=y.z&&y.z<=t.z||r.z<=t.z&&t.z<=y.z)};e.prototype.contains=function(t){var r=this.lowerBound,y=this.upperBound,z=t.lowerBound;t=t.upperBound;return r.x<=z.x&&y.x>=t.x&&r.y<=z.y&&y.y>=
t.y&&r.z<=z.z&&y.z>=t.z};e.prototype.getCorners=function(t,r,y,z,E,B,F,I){var L=this.lowerBound,U=this.upperBound;t.copy(L);r.set(U.x,L.y,L.z);y.set(U.x,U.y,L.z);z.set(L.x,U.y,U.z);E.set(U.x,L.y,L.z);B.set(L.x,U.y,L.z);F.set(L.x,L.y,U.z);I.copy(U)};var l=[new p,new p,new p,new p,new p,new p,new p,new p];e.prototype.toLocalFrame=function(t,r){this.getCorners(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);for(var y=0;8!==y;y++){var z=l[y];t.pointToLocal(z,z)}return r.setFromPoints(l)};e.prototype.toWorldFrame=
function(t,r){this.getCorners(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7]);for(var y=0;8!==y;y++){var z=l[y];t.pointToWorld(z,z)}return r.setFromPoints(l)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(h,k){function e(){this.matrix=[]}k.exports=e;e.prototype.get=function(p,q){if(p=p.index,q=q.index,q>p){var l=q;q=p;p=l}return this.matrix[(p*(p+1)>>1)+q-1]};e.prototype.set=function(p,q,l){if(p=p.index,q=q.index,q>p){var t=q;q=p;p=t}this.matrix[(p*(p+1)>>1)+q-1]=l?1:0};e.prototype.reset=function(){for(var p=
0,q=this.matrix.length;p!==q;p++)this.matrix[p]=0};e.prototype.setNumObjects=function(p){this.matrix.length=p*(p-1)>>1}},{}],5:[function(h,k){function e(){this.world=null;this.useBoundingBoxes=!1;this.dirty=!0}var p=h("../objects/Body"),q=h("../math/Vec3"),l=h("../math/Quaternion");h("../shapes/Shape");h("../shapes/Plane");k.exports=e;e.prototype.collisionPairs=function(){throw Error("collisionPairs not implemented for this BroadPhase class!");};var t=p.STATIC|p.KINEMATIC;e.prototype.needBroadphaseCollision=
function(F,I){return 0===(F.collisionFilterGroup&I.collisionFilterMask)||0===(I.collisionFilterGroup&F.collisionFilterMask)?!1:0===(F.type&t)&&F.sleepState!==p.SLEEPING||0===(I.type&t)&&I.sleepState!==p.SLEEPING?!0:!1};e.prototype.intersectionTest=function(F,I,L,U){this.useBoundingBoxes?this.doBoundingBoxBroadphase(F,I,L,U):this.doBoundingSphereBroadphase(F,I,L,U)};var r=new q;new q;new l;new q;e.prototype.doBoundingSphereBroadphase=function(F,I,L,U){I.position.vsub(F.position,r);var n=Math.pow(F.boundingRadius+
I.boundingRadius,2),w=r.norm2();n>w&&(L.push(F),U.push(I))};e.prototype.doBoundingBoxBroadphase=function(F,I,L,U){F.aabbNeedsUpdate&&F.computeAABB();I.aabbNeedsUpdate&&I.computeAABB();F.aabb.overlaps(I.aabb)&&(L.push(F),U.push(I))};var y={keys:[]},z=[],E=[];e.prototype.makePairsUnique=function(F,I){for(var L=F.length,U=0;U!==L;U++)z[U]=F[U],E[U]=I[U];F.length=0;for(U=I.length=0;U!==L;U++){var n=z[U].id,w=E[U].id;n=w>n?n+","+w:w+","+n;y[n]=U;y.keys.push(n)}for(U=0;U!==y.keys.length;U++)n=y.keys.pop(),
L=y[n],F.push(z[L]),I.push(E[L]),delete y[n]};e.prototype.setWorld=function(){};var B=new q;e.boundingSphereCheck=function(F,I){return F.position.vsub(I.position,B),Math.pow(F.shape.boundingSphereRadius+I.shape.boundingSphereRadius,2)>B.norm2()};e.prototype.aabbQuery=function(){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(h,k){function e(r,
y,z,E,B){p.apply(this);this.nx=z||10;this.ny=E||10;this.nz=B||10;this.aabbMin=r||new q(100,100,100);this.aabbMax=y||new q(-100,-100,-100);r=this.nx*this.ny*this.nz;if(0>=r)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[];this.binLengths=[];this.bins.length=r;this.binLengths.length=r;for(y=0;r>y;y++)this.bins[y]=[],this.binLengths[y]=0}k.exports=e;var p=h("./Broadphase"),q=h("../math/Vec3"),l=h("../shapes/Shape");e.prototype=new p;e.prototype.constructor=e;var t=new q;new q;e.prototype.collisionPairs=
function(r,y,z){function E(kb,Hb,vb,Nb,Pb,Sb,bd){kb=(kb-C)*S|0;Hb=(Hb-J)*T|0;vb=(vb-N)*W|0;Nb=ea((Nb-C)*S);Pb=ea((Pb-J)*T);Sb=ea((Sb-N)*W);0>kb?kb=0:kb>=L&&(kb=L-1);0>Hb?Hb=0:Hb>=U&&(Hb=U-1);0>vb?vb=0:vb>=n&&(vb=n-1);0>Nb?Nb=0:Nb>=L&&(Nb=L-1);0>Pb?Pb=0:Pb>=U&&(Pb=U-1);0>Sb?Sb=0:Sb>=n&&(Sb=n-1);kb*=w;Hb*=G;vb*=f;Nb*=w;Pb*=G;for(Sb*=f;Nb>=kb;kb+=w)for(var cd=Hb;Pb>=cd;cd+=G)for(var sc=vb;Sb>=sc;sc+=f){var tc=kb+cd+sc;ia[tc][aa[tc]++]=bd}}var B=r.numObjects();r=r.bodies;var F=this.aabbMax,I=this.aabbMin,
L=this.nx,U=this.ny,n=this.nz,w=U*n,G=n,f=1,m=F.x,v=F.y,D=F.z,C=I.x,J=I.y,N=I.z,S=L/(m-C),T=U/(v-J),W=n/(D-N);m=(m-C)/L;var Y=(v-J)/U;D=(D-N)/n;var V=.5*Math.sqrt(m*m+Y*Y+D*D);v=l.types;var ma=v.SPHERE,ha=v.PLANE,ia=(v.BOX,v.COMPOUND,v.CONVEXPOLYHEDRON,this.bins),aa=this.binLengths;v=this.bins.length;for(I=0;I!==v;I++)aa[I]=0;var ea=Math.ceil;I=Math.min;F=Math.max;for(I=0;I!==B;I++){F=r[I];var ja=F.shape;switch(ja.type){case ma:var Q=F.position.x,X=F.position.y,ca=F.position.z;ja=ja.radius;E(Q-ja,
X-ja,ca-ja,Q+ja,X+ja,ca+ja,F);break;case ha:ja.worldNormalNeedsUpdate&&ja.computeWorldNormal(F.quaternion);ca=ja.worldNormal;ja=J+.5*Y-F.position.y;var pa=N+.5*D-F.position.z,ka=t;ka.set(C+.5*m-F.position.x,ja,pa);for(var va=Q=0;Q!==L;Q++,va+=w,ka.y=ja,ka.x+=m)for(var Aa=X=0;X!==U;X++,Aa+=G,ka.z=pa,ka.y+=Y)for(var xa=0,Ia=0;xa!==n;xa++,Ia+=f,ka.z+=D)if(ka.dot(ca)<V){var Za=va+Aa+Ia;ia[Za][aa[Za]++]=F}break;default:F.aabbNeedsUpdate&&F.computeAABB(),E(F.aabb.lowerBound.x,F.aabb.lowerBound.y,F.aabb.lowerBound.z,
F.aabb.upperBound.x,F.aabb.upperBound.y,F.aabb.upperBound.z,F)}}for(I=0;I!==v;I++)if(B=aa[I],1<B)for(r=ia[I],Q=0;Q!==B;Q++)for(F=r[Q],X=0;X!==Q;X++)m=r[X],this.needBroadphaseCollision(F,m)&&this.intersectionTest(F,m,y,z);this.makePairsUnique(y,z)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(h,k){function e(){p.apply(this)}k.exports=e;var p=h("./Broadphase");h=h("./AABB");e.prototype=new p;e.prototype.constructor=e;e.prototype.collisionPairs=function(q,l,t){var r,y=q.bodies,
z=y.length;for(q=0;q!==z;q++)for(r=0;r!==q;r++){var E=y[q];var B=y[r];this.needBroadphaseCollision(E,B)&&this.intersectionTest(E,B,l,t)}};new h;e.prototype.aabbQuery=function(q,l,t){t=t||[];for(var r=0;r<q.bodies.length;r++){var y=q.bodies[r];y.aabbNeedsUpdate&&y.computeAABB();y.aabb.overlaps(l)&&t.push(y)}return t}},{"./AABB":3,"./Broadphase":5}],8:[function(h,k){function e(){this.matrix={}}k.exports=e;e.prototype.get=function(p,q){if(p=p.id,q=q.id,q>p){var l=q;q=p;p=l}return p+"-"+q in this.matrix};
e.prototype.set=function(p,q,l){if(p=p.id,q=q.id,q>p){var t=q;q=p;p=t}l?this.matrix[p+"-"+q]=!0:delete this.matrix[p+"-"+q]};e.prototype.reset=function(){this.matrix={}};e.prototype.setNumObjects=function(){}},{}],9:[function(h,k){function e(ia,aa){this.from=ia?ia.clone():new q;this.to=aa?aa.clone():new q;this._direction=new q;this.precision=1E-4;this.checkCollisionResponse=!0;this.skipBackfaces=!1;this.collisionFilterGroup=this.collisionFilterMask=-1;this.mode=e.ANY;this.result=new t;this.hasHit=
!1;this.callback=function(){}}function p(ia,aa,ea,ja){ja.vsub(aa,ma);ea.vsub(aa,E);ia.vsub(aa,B);var Q,X;ia=ma.dot(ma);aa=ma.dot(E);ea=ma.dot(B);ja=E.dot(E);var ca=E.dot(B);return 0<=(Q=ja*ea-aa*ca)&&0<=(X=ia*ca-aa*ea)&&ia*ja-aa*aa>Q+X}k.exports=e;var q=h("../math/Vec3");k=h("../math/Quaternion");var l=h("../math/Transform"),t=(h("../shapes/ConvexPolyhedron"),h("../shapes/Box"),h("../collision/RaycastResult")),r=h("../shapes/Shape");h=h("../collision/AABB");e.prototype.constructor=e;e.CLOSEST=1;e.ANY=
2;e.ALL=4;var y=new h,z=[];e.prototype.intersectWorld=function(ia,aa){return this.mode=aa.mode||e.ANY,this.result=aa.result||new t,this.skipBackfaces=!!aa.skipBackfaces,this.collisionFilterMask="undefined"!=typeof aa.collisionFilterMask?aa.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!=typeof aa.collisionFilterGroup?aa.collisionFilterGroup:-1,aa.from&&this.from.copy(aa.from),aa.to&&this.to.copy(aa.to),this.callback=aa.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),
this.getAABB(y),z.length=0,ia.broadphase.aabbQuery(ia,y,z),this.intersectBodies(z),this.hasHit};var E=new q,B=new q;e.pointInTriangle=p;var F=new q,I=new k;e.prototype.intersectBody=function(ia,aa){aa&&(this.result=aa,this._updateDirection());aa=this.checkCollisionResponse;if((!aa||ia.collisionResponse)&&0!==(this.collisionFilterGroup&ia.collisionFilterMask)&&0!==(ia.collisionFilterGroup&this.collisionFilterMask))for(var ea=0,ja=ia.shapes.length;ja>ea;ea++){var Q=ia.shapes[ea];if((!aa||Q.collisionResponse)&&
(ia.quaternion.mult(ia.shapeOrientations[ea],I),ia.quaternion.vmult(ia.shapeOffsets[ea],F),F.vadd(ia.position,F),this.intersectShape(Q,I,F,ia),this.result._shouldStop))break}};e.prototype.intersectBodies=function(ia,aa){aa&&(this.result=aa,this._updateDirection());aa=0;for(var ea=ia.length;!this.result._shouldStop&&ea>aa;aa++)this.intersectBody(ia[aa])};e.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction);this._direction.normalize()};e.prototype.intersectShape=function(ia,
aa,ea,ja){var Q=this.from,X=this._direction;ea.vsub(Q,ma);var ca=ma.dot(X);X.mult(ca,ha);ha.vadd(Q,ha);ea.distanceTo(ha)>ia.boundingSphereRadius||(Q=this[ia.type])&&Q.call(this,ia,aa,ea,ja)};var L=(new q,new q,new q),U=new q,n=new q,w=new q;new q;new t;e.prototype.intersectBox=function(ia,aa,ea,ja){return this.intersectConvex(ia.convexPolyhedronRepresentation,aa,ea,ja)};e.prototype[r.types.BOX]=e.prototype.intersectBox;e.prototype.intersectPlane=function(ia,aa,ea,ja){var Q=this.from,X=this.to,ca=
this._direction,pa=new q(0,0,1);aa.vmult(pa,pa);var ka=new q;Q.vsub(ea,ka);aa=ka.dot(pa);X.vsub(ea,ka);ka=ka.dot(pa);if(!(0<aa*ka||Q.distanceTo(X)<aa||(ka=pa.dot(ca),Math.abs(ka)<this.precision))){var va=new q;X=new q;aa=new q;Q.vsub(ea,va);ea=-pa.dot(va)/ka;ca.scale(ea,X);Q.vadd(X,aa);this.reportIntersection(pa,aa,ia,ja,-1)}};e.prototype[r.types.PLANE]=e.prototype.intersectPlane;e.prototype.getAABB=function(ia){var aa=this.to,ea=this.from;ia.lowerBound.x=Math.min(aa.x,ea.x);ia.lowerBound.y=Math.min(aa.y,
ea.y);ia.lowerBound.z=Math.min(aa.z,ea.z);ia.upperBound.x=Math.max(aa.x,ea.x);ia.upperBound.y=Math.max(aa.y,ea.y);ia.upperBound.z=Math.max(aa.z,ea.z)};var G={faceList:[0]};e.prototype.intersectHeightfield=function(ia,aa,ea,ja){var Q=(ia.data,ia.elementSize,new q),X=new e(this.from,this.to);l.pointToLocalFrame(ea,aa,X.from,X.from);l.pointToLocalFrame(ea,aa,X.to,X.to);var ca=[],pa=null,ka=null,va=null,Aa=null,xa=ia.getIndexOfPosition(X.from.x,X.from.y,ca,!1);if(xa&&(pa=ca[0],ka=ca[1],va=ca[0],Aa=ca[1]),
xa=ia.getIndexOfPosition(X.to.x,X.to.y,ca,!1),xa&&((null===pa||ca[0]<pa)&&(pa=ca[0]),(null===va||ca[0]>va)&&(va=ca[0]),(null===ka||ca[1]<ka)&&(ka=ca[1]),(null===Aa||ca[1]>Aa)&&(Aa=ca[1])),null!==pa)for(X=[],ia.getRectMinMax(pa,ka,va,Aa,X),pa=(X[0],X[1],pa);va>=pa;pa++)for(X=ka;Aa>=X;X++){if(this.result._shouldStop||(ia.getConvexTrianglePillar(pa,X,!1),l.pointToWorldFrame(ea,aa,ia.pillarOffset,Q),this.intersectConvex(ia.pillarConvex,aa,Q,ja,G),this.result._shouldStop))return;ia.getConvexTrianglePillar(pa,
X,!0);l.pointToWorldFrame(ea,aa,ia.pillarOffset,Q);this.intersectConvex(ia.pillarConvex,aa,Q,ja,G)}};e.prototype[r.types.HEIGHTFIELD]=e.prototype.intersectHeightfield;var f=new q,m=new q;e.prototype.intersectSphere=function(ia,aa,ea,ja){aa=this.from;var Q=this.to,X=Math.pow(Q.x-aa.x,2)+Math.pow(Q.y-aa.y,2)+Math.pow(Q.z-aa.z,2),ca=2*((Q.x-aa.x)*(aa.x-ea.x)+(Q.y-aa.y)*(aa.y-ea.y)+(Q.z-aa.z)*(aa.z-ea.z)),pa=Math.pow(ca,2)-4*X*(Math.pow(aa.x-ea.x,2)+Math.pow(aa.y-ea.y,2)+Math.pow(aa.z-ea.z,2)-Math.pow(ia.radius,
2));if(!(0>pa))if(0===pa)aa.lerp(Q,pa,f),f.vsub(ea,m),m.normalize(),this.reportIntersection(m,f,ia,ja,-1);else{var ka=(-ca-Math.sqrt(pa))/(2*X);X=(-ca+Math.sqrt(pa))/(2*X);(0<=ka&&1>=ka&&(aa.lerp(Q,ka,f),f.vsub(ea,m),m.normalize(),this.reportIntersection(m,f,ia,ja,-1)),this.result._shouldStop)||0<=X&&1>=X&&(aa.lerp(Q,X,f),f.vsub(ea,m),m.normalize(),this.reportIntersection(m,f,ia,ja,-1))}};e.prototype[r.types.SPHERE]=e.prototype.intersectSphere;var v=new q,D=(new q,new q,new q);e.prototype.intersectConvex=
function(ia,aa,ea,ja,Q){Q=Q&&Q.faceList||null;for(var X=ia.faces,ca=ia.vertices,pa=ia.faceNormals,ka=this._direction,va=this.from,Aa=va.distanceTo(this.to),xa=Q?Q.length:X.length,Ia=this.result,Za=0;!Ia._shouldStop&&xa>Za;Za++){var kb=Q?Q[Za]:Za,Hb=X[kb],vb=pa[kb],Nb=aa,Pb=ea;D.copy(ca[Hb[0]]);Nb.vmult(D,D);D.vadd(Pb,D);D.vsub(va,D);Nb.vmult(vb,v);vb=ka.dot(v);if(!(Math.abs(vb)<this.precision||(vb=v.dot(D)/vb,0>vb)))for(ka.mult(vb,L),L.vadd(va,L),U.copy(ca[Hb[0]]),Nb.vmult(U,U),Pb.vadd(U,U),vb=1;!Ia._shouldStop&&
vb<Hb.length-1;vb++){n.copy(ca[Hb[vb]]);w.copy(ca[Hb[vb+1]]);Nb.vmult(n,n);Nb.vmult(w,w);Pb.vadd(n,n);Pb.vadd(w,w);var Sb=L.distanceTo(va);!p(L,U,n,w)&&!p(L,n,U,w)||Sb>Aa||this.reportIntersection(v,L,ia,ja,kb)}}};e.prototype[r.types.CONVEXPOLYHEDRON]=e.prototype.intersectConvex;var C=new q,J=new q,N=new q,S=new q,T=new q,W=new q,Y=(new h,[]),V=new l;e.prototype.intersectTrimesh=function(ia,aa,ea,ja,Q){Q=(Q&&Q.faceList||null,ia.indices);var X=(ia.vertices,ia.faceNormals,this.from),ca=this.to,pa=this._direction;
V.position.copy(ea);V.quaternion.copy(aa);l.vectorToLocalFrame(ea,aa,pa,J);l.pointToLocalFrame(ea,aa,X,N);l.pointToLocalFrame(ea,aa,ca,S);X=N.distanceSquared(S);ia.tree.rayQuery(this,V,Y);ca=0;for(pa=Y.length;!this.result._shouldStop&&ca!==pa;ca++){var ka=Y[ca];ia.getNormal(ka,C);ia.getVertex(Q[3*ka],U);U.vsub(N,D);var va=J.dot(C);va=C.dot(D)/va;0>va||(J.scale(va,L),L.vadd(N,L),ia.getVertex(Q[3*ka+1],n),ia.getVertex(Q[3*ka+2],w),va=L.distanceSquared(N),!p(L,n,U,w)&&!p(L,U,n,w)||va>X||(l.vectorToWorldFrame(aa,
C,T),l.pointToWorldFrame(ea,aa,L,W),this.reportIntersection(T,W,ia,ja,ka)))}Y.length=0};e.prototype[r.types.TRIMESH]=e.prototype.intersectTrimesh;e.prototype.reportIntersection=function(ia,aa,ea,ja,Q){var X=this.from,ca=this.to,pa=X.distanceTo(aa),ka=this.result;if(!(this.skipBackfaces&&0<ia.dot(this._direction)))switch(ka.hitFaceIndex="undefined"!=typeof Q?Q:-1,this.mode){case e.ALL:this.hasHit=!0;ka.set(X,ca,ia,aa,ea,ja,pa);ka.hasHit=!0;this.callback(ka);break;case e.CLOSEST:(pa<ka.distance||!ka.hasHit)&&
(this.hasHit=!0,ka.hasHit=!0,ka.set(X,ca,ia,aa,ea,ja,pa));break;case e.ANY:this.hasHit=!0,ka.hasHit=!0,ka.set(X,ca,ia,aa,ea,ja,pa),ka._shouldStop=!0}};var ma=new q,ha=new q},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(h,k){function e(){this.rayFromWorld=new p;this.rayToWorld=new p;this.hitNormalWorld=new p;this.hitPointWorld=new p;this.hasHit=
!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1}var p=h("../math/Vec3");k.exports=e;e.prototype.reset=function(){this.rayFromWorld.setZero();this.rayToWorld.setZero();this.hitNormalWorld.setZero();this.hitPointWorld.setZero();this.hasHit=!1;this.body=this.shape=null;this.distance=this.hitFaceIndex=-1;this._shouldStop=!1};e.prototype.abort=function(){this._shouldStop=!0};e.prototype.set=function(q,l,t,r,y,z,E){this.rayFromWorld.copy(q);this.rayToWorld.copy(l);this.hitNormalWorld.copy(t);
this.hitPointWorld.copy(r);this.shape=y;this.body=z;this.distance=E}},{"../math/Vec3":30}],11:[function(h,k){function e(q){p.apply(this);this.axisList=[];this.world=null;this.axisIndex=0;var l=this.axisList;this._addBodyHandler=function(t){l.push(t.body)};this._removeBodyHandler=function(t){t=l.indexOf(t.body);-1!==t&&l.splice(t,1)};q&&this.setWorld(q)}var p=(h("../shapes/Shape"),h("../collision/Broadphase"));k.exports=e;e.prototype=new p;e.prototype.setWorld=function(q){for(var l=this.axisList.length=
0;l<q.bodies.length;l++)this.axisList.push(q.bodies[l]);q.removeEventListener("addBody",this._addBodyHandler);q.removeEventListener("removeBody",this._removeBodyHandler);q.addEventListener("addBody",this._addBodyHandler);q.addEventListener("removeBody",this._removeBodyHandler);this.world=q;this.dirty=!0};e.insertionSortX=function(q){for(var l=1,t=q.length;t>l;l++){for(var r=q[l],y=l-1;0<=y&&!(q[y].aabb.lowerBound.x<=r.aabb.lowerBound.x);y--)q[y+1]=q[y];q[y+1]=r}return q};e.insertionSortY=function(q){for(var l=
1,t=q.length;t>l;l++){for(var r=q[l],y=l-1;0<=y&&!(q[y].aabb.lowerBound.y<=r.aabb.lowerBound.y);y--)q[y+1]=q[y];q[y+1]=r}return q};e.insertionSortZ=function(q){for(var l=1,t=q.length;t>l;l++){for(var r=q[l],y=l-1;0<=y&&!(q[y].aabb.lowerBound.z<=r.aabb.lowerBound.z);y--)q[y+1]=q[y];q[y+1]=r}return q};e.prototype.collisionPairs=function(q,l,t){var r,y=this.axisList,z=y.length,E=this.axisIndex;this.dirty&&(this.sortList(),this.dirty=!1);for(q=0;q!==z;q++){var B=y[q];for(r=q+1;z>r;r++){var F=y[r];if(this.needBroadphaseCollision(B,
F)){if(!e.checkBounds(B,F,E))break;this.intersectionTest(B,F,l,t)}}}};e.prototype.sortList=function(){for(var q=this.axisList,l=this.axisIndex,t=q.length,r=0;r!==t;r++){var y=q[r];y.aabbNeedsUpdate&&y.computeAABB()}0===l?e.insertionSortX(q):1===l?e.insertionSortY(q):2===l&&e.insertionSortZ(q)};e.checkBounds=function(q,l,t){var r,y;0===t?(r=q.position.x,y=l.position.x):1===t?(r=q.position.y,y=l.position.y):2===t&&(r=q.position.z,y=l.position.z);return r+q.boundingRadius>y-l.boundingRadius};e.prototype.autoDetectAxis=
function(){for(var q=0,l=0,t=0,r=0,y=0,z=0,E=this.axisList,B=E.length,F=1/B,I=0;I!==B;I++){var L=E[I],U=L.position.x;q+=U;l+=U*U;U=L.position.y;t+=U;r+=U*U;L=L.position.z;y+=L;z+=L*L}q=l-q*q*F;t=r-t*t*F;y=z-y*y*F;this.axisIndex=q>t?q>y?0:2:t>y?1:2};e.prototype.aabbQuery=function(q,l,t){t=t||[];this.dirty&&(this.sortList(),this.dirty=!1);q=this.axisIndex;var r="x";1===q&&(r="y");2===q&&(r="z");q=this.axisList;for(r=(l.lowerBound[r],l.upperBound[r],0);r<q.length;r++){var y=q[r];y.aabbNeedsUpdate&&y.computeAABB();
y.aabb.overlaps(l)&&t.push(y)}return t}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(h,k){function e(r,y,z){z=z||{};var E="undefined"!=typeof z.maxForce?z.maxForce:1E6,B=z.pivotA?z.pivotA.clone():new t,F=z.pivotB?z.pivotB.clone():new t;this.axisA=z.axisA?z.axisA.clone():new t;this.axisB=z.axisB?z.axisB.clone():new t;p.call(this,r,B,y,F,E);this.collideConnected=!!z.collideConnected;this.angle="undefined"!=typeof z.angle?z.angle:0;B=this.coneEquation=new q(r,y,z);r=this.twistEquation=
new l(r,y,z);this.twistAngle="undefined"!=typeof z.twistAngle?z.twistAngle:0;B.maxForce=0;B.minForce=-E;r.maxForce=0;r.minForce=-E;this.equations.push(B,r)}k.exports=e;var p=(h("./Constraint"),h("./PointToPointConstraint")),q=h("../equations/ConeEquation"),l=h("../equations/RotationalEquation"),t=(h("../equations/ContactEquation"),h("../math/Vec3"));e.prototype=new p;e.constructor=e;new t;new t;e.prototype.update=function(){var r=this.bodyA,y=this.bodyB,z=this.coneEquation,E=this.twistEquation;p.prototype.update.call(this);
r.vectorToWorldFrame(this.axisA,z.axisA);y.vectorToWorldFrame(this.axisB,z.axisB);this.axisA.tangents(E.axisA,E.axisA);r.vectorToWorldFrame(E.axisA,E.axisA);this.axisB.tangents(E.axisB,E.axisB);y.vectorToWorldFrame(E.axisB,E.axisB);z.angle=this.angle;E.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(h,k){function e(q,l,t){t=p.defaults(t,
{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=q;this.bodyB=l;this.id=e.idCounter++;this.collideConnected=t.collideConnected;t.wakeUpBodies&&(q&&q.wakeUp(),l&&l.wakeUp())}k.exports=e;var p=h("../utils/Utils");e.prototype.update=function(){throw Error("method update() not implmemented in this Constraint subclass!");};e.prototype.enable=function(){for(var q=this.equations,l=0;l<q.length;l++)q[l].enabled=!0};e.prototype.disable=function(){for(var q=this.equations,l=0;l<q.length;l++)q[l].enabled=
!1};e.idCounter=0},{"../utils/Utils":53}],14:[function(h,k){function e(l,t,r,y){p.call(this,l,t);"undefined"==typeof r&&(r=l.position.distanceTo(t.position));"undefined"==typeof y&&(y=1E6);this.distance=r;l=this.distanceEquation=new q(l,t);this.equations.push(l);l.minForce=-y;l.maxForce=y}k.exports=e;var p=h("./Constraint"),q=h("../equations/ContactEquation");e.prototype=new p;e.prototype.update=function(){var l=this.distanceEquation,t=.5*this.distance,r=l.ni;this.bodyB.position.vsub(this.bodyA.position,
r);r.normalize();r.mult(t,l.ri);r.mult(-t,l.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(h,k){function e(z,E,B){B=B||{};var F="undefined"!=typeof B.maxForce?B.maxForce:1E6,I=B.pivotA?B.pivotA.clone():new t,L=B.pivotB?B.pivotB.clone():new t;p.call(this,z,I,E,L,F);(this.axisA=B.axisA?B.axisA.clone():new t(1,0,0)).normalize();(this.axisB=B.axisB?B.axisB.clone():new t(1,0,0)).normalize();I=this.rotationalEquation1=new q(z,E,B);B=this.rotationalEquation2=new q(z,E,B);z=this.motorEquation=
new l(z,E,F);z.enabled=!1;this.equations.push(I,B,z)}k.exports=e;var p=(h("./Constraint"),h("./PointToPointConstraint")),q=h("../equations/RotationalEquation"),l=h("../equations/RotationalMotorEquation"),t=(h("../equations/ContactEquation"),h("../math/Vec3"));e.prototype=new p;e.constructor=e;e.prototype.enableMotor=function(){this.motorEquation.enabled=!0};e.prototype.disableMotor=function(){this.motorEquation.enabled=!1};e.prototype.setMotorSpeed=function(z){this.motorEquation.targetVelocity=z};
e.prototype.setMotorMaxForce=function(z){this.motorEquation.maxForce=z;this.motorEquation.minForce=-z};var r=new t,y=new t;e.prototype.update=function(){var z=this.bodyA,E=this.bodyB,B=this.motorEquation,F=this.rotationalEquation1,I=this.rotationalEquation2,L=this.axisA,U=this.axisB;p.prototype.update.call(this);z.quaternion.vmult(L,r);E.quaternion.vmult(U,y);r.tangents(F.axisA,I.axisA);F.axisB.copy(y);I.axisB.copy(y);this.motorEquation.enabled&&(z.quaternion.vmult(this.axisA,B.axisA),E.quaternion.vmult(this.axisB,
B.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(h,k){function e(t,r,y){y=y||{};var z="undefined"!=typeof y.maxForce?y.maxForce:1E6,E=new l,B=new l,F=new l;t.position.vadd(r.position,F);F.scale(.5,F);r.pointToLocalFrame(F,B);t.pointToLocalFrame(F,E);p.call(this,t,E,r,B,z);z=this.rotationalEquation1=new q(t,r,y);E=this.rotationalEquation2=new q(t,
r,y);t=this.rotationalEquation3=new q(t,r,y);this.equations.push(z,E,t)}k.exports=e;var p=(h("./Constraint"),h("./PointToPointConstraint")),q=h("../equations/RotationalEquation"),l=(h("../equations/RotationalMotorEquation"),h("../equations/ContactEquation"),h("../math/Vec3"));e.prototype=new p;e.constructor=e;new l;new l;e.prototype.update=function(){var t=this.bodyA,r=this.bodyB,y=(this.motorEquation,this.rotationalEquation1),z=this.rotationalEquation2,E=this.rotationalEquation3;p.prototype.update.call(this);
t.vectorToWorldFrame(l.UNIT_X,y.axisA);r.vectorToWorldFrame(l.UNIT_Y,y.axisB);t.vectorToWorldFrame(l.UNIT_Y,z.axisA);r.vectorToWorldFrame(l.UNIT_Z,z.axisB);t.vectorToWorldFrame(l.UNIT_Z,E.axisA);r.vectorToWorldFrame(l.UNIT_X,E.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(h,k){function e(t,r,y,z,E){p.call(this,t,y);E="undefined"!=typeof E?E:
1E6;this.pivotA=r?r.clone():new l;this.pivotB=z?z.clone():new l;r=this.equationX=new q(t,y);z=this.equationY=new q(t,y);t=this.equationZ=new q(t,y);this.equations.push(r,z,t);r.minForce=z.minForce=t.minForce=-E;r.maxForce=z.maxForce=t.maxForce=E;r.ni.set(1,0,0);z.ni.set(0,1,0);t.ni.set(0,0,1)}k.exports=e;var p=h("./Constraint"),q=h("../equations/ContactEquation"),l=h("../math/Vec3");e.prototype=new p;e.prototype.update=function(){var t=this.bodyB,r=this.equationX,y=this.equationY,z=this.equationZ;
this.bodyA.quaternion.vmult(this.pivotA,r.ri);t.quaternion.vmult(this.pivotB,r.rj);y.ri.copy(r.ri);y.rj.copy(r.rj);z.ri.copy(r.ri);z.rj.copy(r.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(h,k){function e(r,y,z){z=z||{};var E="undefined"!=typeof z.maxForce?z.maxForce:1E6;q.call(this,r,y,-E,E);this.axisA=z.axisA?z.axisA.clone():new p(1,0,0);this.axisB=z.axisB?z.axisB.clone():new p(0,1,0);this.angle="undefined"!=typeof z.angle?z.angle:0}k.exports=e;var p=
h("../math/Vec3"),q=(h("../math/Mat3"),h("./Equation"));e.prototype=new q;e.prototype.constructor=e;var l=new p,t=new p;e.prototype.computeB=function(r){var y=this.a,z=this.b,E=this.axisA,B=this.axisB,F=this.jacobianElementA,I=this.jacobianElementB;E.cross(B,l);B.cross(E,t);F.rotational.copy(t);I.rotational.copy(l);E=Math.cos(this.angle)-E.dot(B);B=this.computeGW();F=this.computeGiMf();return-E*y-B*z-r*F}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(h,k){function e(I,L,U){p.call(this,
I,L,0,"undefined"!=typeof U?U:1E6);this.restitution=0;this.ri=new q;this.rj=new q;this.ni=new q}k.exports=e;var p=h("./Equation"),q=h("../math/Vec3");h("../math/Mat3");e.prototype=new p;e.prototype.constructor=e;var l=new q,t=new q,r=new q;e.prototype.computeB=function(I){var L=this.a,U=this.b,n=this.bi,w=this.bj,G=this.ri,f=this.rj,m=n.velocity,v=n.angularVelocity,D=(n.force,n.torque,w.velocity),C=w.angularVelocity,J=(w.force,w.torque,r),N=this.jacobianElementA,S=this.jacobianElementB,T=this.ni;
G.cross(T,l);f.cross(T,t);T.negate(N.spatial);l.negate(N.rotational);S.spatial.copy(T);S.rotational.copy(t);J.copy(w.position);J.vadd(f,J);J.vsub(n.position,J);J.vsub(G,J);n=T.dot(J);w=this.restitution+1;m=w*D.dot(T)-w*m.dot(T)+C.dot(t)-v.dot(l);v=this.computeGiMf();return-n*L-m*U-I*v};var y=new q,z=new q,E=new q,B=new q,F=new q;e.prototype.getImpactVelocityAlongNormal=function(){return this.bi.position.vadd(this.ri,E),this.bj.position.vadd(this.rj,B),this.bi.getVelocityAtWorldPoint(E,y),this.bj.getVelocityAtWorldPoint(B,
z),y.vsub(z,F),this.ni.dot(F)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(h,k){function e(B,F,I,L){this.id=e.id++;this.minForce="undefined"==typeof I?-1E6:I;this.maxForce="undefined"==typeof L?1E6:L;this.bi=B;this.bj=F;this.eps=this.b=this.a=0;this.jacobianElementA=new p;this.jacobianElementB=new p;this.enabled=!0;this.setSpookParams(1E7,4,1/60)}k.exports=e;var p=h("../math/JacobianElement");h=h("../math/Vec3");e.prototype.constructor=e;e.id=0;e.prototype.setSpookParams=
function(B,F,I){this.a=4/(I*(1+4*F));this.b=4*F/(1+4*F);this.eps=4/(I*I*B*(1+4*F))};e.prototype.computeB=function(B,F,I){var L=this.computeGW(),U=this.computeGq(),n=this.computeGiMf();return-U*B-L*F-n*I};e.prototype.computeGq=function(){var B=this.jacobianElementB,F=this.bj.position;return this.jacobianElementA.spatial.dot(this.bi.position)+B.spatial.dot(F)};var q=new h;e.prototype.computeGW=function(){var B=this.jacobianElementB,F=this.bi,I=this.bj,L=I.velocity;I=I.angularVelocity||q;return this.jacobianElementA.multiplyVectors(F.velocity,
F.angularVelocity||q)+B.multiplyVectors(L,I)};e.prototype.computeGWlambda=function(){var B=this.jacobianElementB,F=this.bi,I=this.bj,L=I.vlambda;I=I.wlambda||q;return this.jacobianElementA.multiplyVectors(F.vlambda,F.wlambda||q)+B.multiplyVectors(L,I)};var l=new h,t=new h,r=new h,y=new h;e.prototype.computeGiMf=function(){var B=this.jacobianElementA,F=this.jacobianElementB,I=this.bi,L=this.bj,U=I.force,n=I.torque,w=L.force,G=L.torque,f=I.invMassSolve,m=L.invMassSolve;return I.invInertiaWorldSolve?
I.invInertiaWorldSolve.vmult(n,r):r.set(0,0,0),L.invInertiaWorldSolve?L.invInertiaWorldSolve.vmult(G,y):y.set(0,0,0),U.mult(f,l),w.mult(m,t),B.multiplyVectors(l,r)+F.multiplyVectors(t,y)};var z=new h;e.prototype.computeGiMGt=function(){var B=this.jacobianElementA,F=this.jacobianElementB,I=this.bi,L=this.bj,U=I.invInertiaWorldSolve,n=L.invInertiaWorldSolve;I=I.invMassSolve+L.invMassSolve;return U&&(U.vmult(B.rotational,z),I+=z.dot(B.rotational)),n&&(n.vmult(F.rotational,z),I+=z.dot(F.rotational)),
I};var E=new h;new h;new h;new h;new h;new h;e.prototype.addToWlambda=function(B){var F=this.jacobianElementA,I=this.jacobianElementB,L=this.bi,U=this.bj;F.spatial.mult(L.invMassSolve*B,E);L.vlambda.vadd(E,L.vlambda);I.spatial.mult(U.invMassSolve*B,E);U.vlambda.vadd(E,U.vlambda);L.invInertiaWorldSolve&&(L.invInertiaWorldSolve.vmult(F.rotational,E),E.mult(B,E),L.wlambda.vadd(E,L.wlambda));U.invInertiaWorldSolve&&(U.invInertiaWorldSolve.vmult(I.rotational,E),E.mult(B,E),U.wlambda.vadd(E,U.wlambda))};
e.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(h,k){function e(r,y,z){p.call(this,r,y,-z,z);this.ri=new q;this.rj=new q;this.t=new q}k.exports=e;var p=h("./Equation"),q=h("../math/Vec3");h("../math/Mat3");e.prototype=new p;e.prototype.constructor=e;var l=new q,t=new q;e.prototype.computeB=function(r){var y=(this.a,this.b),z=(this.bi,this.bj,this.ri),E=this.rj,B=this.t;z.cross(B,l);E.cross(B,t);z=this.jacobianElementA;
E=this.jacobianElementB;B.negate(z.spatial);l.negate(z.rotational);E.spatial.copy(B);E.rotational.copy(t);B=this.computeGW();z=this.computeGiMf();return-B*y-r*z}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(h,k){function e(r,y,z){z=z||{};var E="undefined"!=typeof z.maxForce?z.maxForce:1E6;q.call(this,r,y,-E,E);this.axisA=z.axisA?z.axisA.clone():new p(1,0,0);this.axisB=z.axisB?z.axisB.clone():new p(0,1,0);this.maxAngle=Math.PI/2}k.exports=e;var p=h("../math/Vec3"),q=(h("../math/Mat3"),
h("./Equation"));e.prototype=new q;e.prototype.constructor=e;var l=new p,t=new p;e.prototype.computeB=function(r){var y=this.a,z=this.b,E=this.axisA,B=this.axisB,F=this.jacobianElementA,I=this.jacobianElementB;E.cross(B,l);B.cross(E,t);F.rotational.copy(t);I.rotational.copy(l);E=Math.cos(this.maxAngle)-E.dot(B);B=this.computeGW();F=this.computeGiMf();return-E*y-B*z-r*F}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(h,k){function e(l,t,r){r="undefined"!=typeof r?r:1E6;q.call(this,
l,t,-r,r);this.axisA=new p;this.axisB=new p;this.targetVelocity=0}k.exports=e;var p=h("../math/Vec3"),q=(h("../math/Mat3"),h("./Equation"));e.prototype=new q;e.prototype.constructor=e;e.prototype.computeB=function(l){var t=(this.a,this.b),r=(this.bi,this.bj,this.axisA),y=this.axisB,z=this.jacobianElementB;this.jacobianElementA.rotational.copy(r);y.negate(z.rotational);r=this.computeGW()-this.targetVelocity;y=this.computeGiMf();return-r*t-l*y}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],
24:[function(h,k){function e(q,l,t){t=p.defaults(t,{friction:.3,restitution:.3,contactEquationStiffness:1E7,contactEquationRelaxation:3,frictionEquationStiffness:1E7,frictionEquationRelaxation:3});this.id=e.idCounter++;this.materials=[q,l];this.friction=t.friction;this.restitution=t.restitution;this.contactEquationStiffness=t.contactEquationStiffness;this.contactEquationRelaxation=t.contactEquationRelaxation;this.frictionEquationStiffness=t.frictionEquationStiffness;this.frictionEquationRelaxation=
t.frictionEquationRelaxation}var p=h("../utils/Utils");k.exports=e;e.idCounter=0},{"../utils/Utils":53}],25:[function(h,k){function e(p){var q="";p=p||{};"string"==typeof p?(q=p,p={}):"object"==typeof p&&(q="");this.name=q;this.id=e.idCounter++;this.friction="undefined"!=typeof p.friction?p.friction:-1;this.restitution="undefined"!=typeof p.restitution?p.restitution:-1}k.exports=e;e.idCounter=0},{}],26:[function(h,k){function e(){this.spatial=new p;this.rotational=new p}k.exports=e;var p=h("./Vec3");
e.prototype.multiplyElement=function(q){return q.spatial.dot(this.spatial)+q.rotational.dot(this.rotational)};e.prototype.multiplyVectors=function(q,l){return q.dot(this.spatial)+l.dot(this.rotational)}},{"./Vec3":30}],27:[function(h,k){function e(q){this.elements=q?q:[0,0,0,0,0,0,0,0,0]}k.exports=e;var p=h("./Vec3");e.prototype.identity=function(){var q=this.elements;q[0]=1;q[1]=0;q[2]=0;q[3]=0;q[4]=1;q[5]=0;q[6]=0;q[7]=0;q[8]=1};e.prototype.setZero=function(){var q=this.elements;q[0]=0;q[1]=0;q[2]=
0;q[3]=0;q[4]=0;q[5]=0;q[6]=0;q[7]=0;q[8]=0};e.prototype.setTrace=function(q){var l=this.elements;l[0]=q.x;l[4]=q.y;l[8]=q.z};e.prototype.getTrace=function(q){q=q||new p;var l=this.elements;q.x=l[0];q.y=l[4];q.z=l[8]};e.prototype.vmult=function(q,l){l=l||new p;var t=this.elements,r=q.x,y=q.y;q=q.z;return l.x=t[0]*r+t[1]*y+t[2]*q,l.y=t[3]*r+t[4]*y+t[5]*q,l.z=t[6]*r+t[7]*y+t[8]*q,l};e.prototype.smult=function(q){for(var l=0;l<this.elements.length;l++)this.elements[l]*=q};e.prototype.mmult=function(q,
l){l=l||new e;for(var t=0;3>t;t++)for(var r=0;3>r;r++){for(var y=0,z=0;3>z;z++)y+=q.elements[t+3*z]*this.elements[z+3*r];l.elements[t+3*r]=y}return l};e.prototype.scale=function(q,l){l=l||new e;for(var t=this.elements,r=l.elements,y=0;3!==y;y++)r[3*y]=q.x*t[3*y],r[3*y+1]=q.y*t[3*y+1],r[3*y+2]=q.z*t[3*y+2];return l};e.prototype.solve=function(q,l){l=l||new p;for(var t=[],r=0;12>r;r++)t.push(0);var y;for(r=0;3>r;r++)for(y=0;3>y;y++)t[r+4*y]=this.elements[r+3*y];t[3]=q.x;t[7]=q.y;t[11]=q.z;var z=3,E=
z;do{if(r=E-z,0===t[r+4*r])for(y=r+1;E>y;y++)if(0!==t[r+4*y]){var B=4;do{var F=4-B;t[F+4*r]+=t[F+4*y]}while(--B);break}if(0!==t[r+4*r])for(y=r+1;E>y;y++){var I=t[r+4*y]/t[r+4*r];B=4;do F=4-B,t[F+4*y]=r>=F?0:t[F+4*y]-t[F+4*r]*I;while(--B)}}while(--z);if(l.z=t[11]/t[10],l.y=(t[7]-t[6]*l.z)/t[5],l.x=(t[3]-t[2]*l.z-t[1]*l.y)/t[0],isNaN(l.x)||isNaN(l.y)||isNaN(l.z)||1/0===l.x||1/0===l.y||1/0===l.z)throw"Could not solve equation! Got x=["+l.toString()+"], b=["+q.toString()+"], A=["+this.toString()+"]";
return l};e.prototype.e=function(q,l,t){return void 0===t?this.elements[l+3*q]:void(this.elements[l+3*q]=t)};e.prototype.copy=function(q){for(var l=0;l<q.elements.length;l++)this.elements[l]=q.elements[l];return this};e.prototype.toString=function(){for(var q="",l=0;9>l;l++)q+=this.elements[l]+",";return q};e.prototype.reverse=function(q){q=q||new e;for(var l=[],t=0;18>t;t++)l.push(0);var r;for(t=0;3>t;t++)for(r=0;3>r;r++)l[t+6*r]=this.elements[t+3*r];l[3]=1;l[9]=0;l[15]=0;l[4]=0;l[10]=1;l[16]=0;
l[5]=0;l[11]=0;l[17]=1;var y=3,z=y;do{if(t=z-y,0===l[t+6*t])for(r=t+1;z>r;r++)if(0!==l[t+6*r]){var E=6;do{var B=6-E;l[B+6*t]+=l[B+6*r]}while(--E);break}if(0!==l[t+6*t])for(r=t+1;z>r;r++){var F=l[t+6*r]/l[t+6*t];E=6;do B=6-E,l[B+6*r]=t>=B?0:l[B+6*r]-l[B+6*t]*F;while(--E)}}while(--y);t=2;do{r=t-1;do{F=l[t+6*r]/l[t+6*t];E=6;do B=6-E,l[B+6*r]-=l[B+6*t]*F;while(--E)}while(r--)}while(--t);t=2;do{F=1/l[t+6*t];E=6;do B=6-E,l[B+6*t]*=F;while(--E)}while(t--);t=2;do{r=2;do{if(B=l[3+r+6*t],isNaN(B)||1/0===B)throw"Could not reverse! A=["+
this.toString()+"]";q.e(t,r,B)}while(r--)}while(t--);return q};e.prototype.setRotationFromQuaternion=function(q){var l=q.x,t=q.y,r=q.z,y=q.w,z=l+l,E=t+t,B=r+r;q=l*z;var F=l*E;l*=B;var I=t*E;t*=B;r*=B;z*=y;E*=y;y*=B;B=this.elements;return B[0]=1-(I+r),B[1]=F-y,B[2]=l+E,B[3]=F+y,B[4]=1-(q+r),B[5]=t-z,B[6]=l-E,B[7]=t+z,B[8]=1-(q+I),this};e.prototype.transpose=function(q){q=q||new e;for(var l=q.elements,t=this.elements,r=0;3!==r;r++)for(var y=0;3!==y;y++)l[3*r+y]=t[3*y+r];return q}},{"./Vec3":30}],28:[function(h,
k){function e(z,E,B,F){this.x=void 0!==z?z:0;this.y=void 0!==E?E:0;this.z=void 0!==B?B:0;this.w=void 0!==F?F:1}k.exports=e;var p=h("./Vec3");e.prototype.set=function(z,E,B,F){this.x=z;this.y=E;this.z=B;this.w=F};e.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w};e.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]};e.prototype.setFromAxisAngle=function(z,E){var B=Math.sin(.5*E);this.x=z.x*B;this.y=z.y*B;this.z=z.z*B;this.w=Math.cos(.5*E)};e.prototype.toAxisAngle=
function(z){z=z||new p;this.normalize();var E=2*Math.acos(this.w),B=Math.sqrt(1-this.w*this.w);return.001>B?(z.x=this.x,z.y=this.y,z.z=this.z):(z.x=this.x/B,z.y=this.y/B,z.z=this.z/B),[z,E]};var q=new p,l=new p;e.prototype.setFromVectors=function(z,E){if(z.isAntiparallelTo(E))z.tangents(q,l),this.setFromAxisAngle(q,Math.PI);else{var B=z.cross(E);this.x=B.x;this.y=B.y;this.z=B.z;this.w=Math.sqrt(Math.pow(z.norm(),2)*Math.pow(E.norm(),2))+z.dot(E);this.normalize()}};var t=new p,r=new p,y=new p;e.prototype.mult=
function(z,E){E=E||new e;var B=this.w;return t.set(this.x,this.y,this.z),r.set(z.x,z.y,z.z),E.w=B*z.w-t.dot(r),t.cross(r,y),E.x=B*r.x+z.w*t.x+y.x,E.y=B*r.y+z.w*t.y+y.y,E.z=B*r.z+z.w*t.z+y.z,E};e.prototype.inverse=function(z){var E=this.x,B=this.y,F=this.z,I=this.w;z=z||new e;this.conjugate(z);E=1/(E*E+B*B+F*F+I*I);return z.x*=E,z.y*=E,z.z*=E,z.w*=E,z};e.prototype.conjugate=function(z){return z=z||new e,z.x=-this.x,z.y=-this.y,z.z=-this.z,z.w=this.w,z};e.prototype.normalize=function(){var z=Math.sqrt(this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===z?(this.x=0,this.y=0,this.z=0,this.w=0):(z=1/z,this.x*=z,this.y*=z,this.z*=z,this.w*=z)};e.prototype.normalizeFast=function(){var z=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===z?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=z,this.y*=z,this.z*=z,this.w*=z)};e.prototype.vmult=function(z,E){E=E||new p;var B=z.x,F=z.y,I=z.z;z=this.x;var L=this.y,U=this.z,n=this.w,w=n*B+L*I-U*F,G=n*F+U*B-z*I,f=n*I+z*F-L*B;B=-z*B-L*F-U*I;return E.x=
w*n+B*-z+G*-U-f*-L,E.y=G*n+B*-L+f*-z-w*-U,E.z=f*n+B*-U+w*-L-G*-z,E};e.prototype.copy=function(z){return this.x=z.x,this.y=z.y,this.z=z.z,this.w=z.w,this};e.prototype.toEuler=function(z,E){E=E||"YZX";var B,F,I,L=this.x,U=this.y,n=this.z,w=this.w;switch(E){case "YZX":E=L*U+n*w;if(.499<E&&(B=2*Math.atan2(L,w),F=Math.PI/2,I=0),-.499>E&&(B=-2*Math.atan2(L,w),F=-Math.PI/2,I=0),isNaN(B))I=n*n,B=Math.atan2(2*U*w-2*L*n,1-2*U*U-2*I),F=Math.asin(2*E),I=Math.atan2(2*L*w-2*U*n,1-2*L*L-2*I);break;default:throw Error("Euler order "+
E+" not supported yet.");}z.y=B;z.z=F;z.x=I};e.prototype.setFromEuler=function(z,E,B,F){F=F||"XYZ";var I=Math.cos(z/2),L=Math.cos(E/2),U=Math.cos(B/2);z=Math.sin(z/2);E=Math.sin(E/2);B=Math.sin(B/2);return"XYZ"===F?(this.x=z*L*U+I*E*B,this.y=I*E*U-z*L*B,this.z=I*L*B+z*E*U,this.w=I*L*U-z*E*B):"YXZ"===F?(this.x=z*L*U+I*E*B,this.y=I*E*U-z*L*B,this.z=I*L*B-z*E*U,this.w=I*L*U+z*E*B):"ZXY"===F?(this.x=z*L*U-I*E*B,this.y=I*E*U+z*L*B,this.z=I*L*B+z*E*U,this.w=I*L*U-z*E*B):"ZYX"===F?(this.x=z*L*U-I*E*B,this.y=
I*E*U+z*L*B,this.z=I*L*B-z*E*U,this.w=I*L*U+z*E*B):"YZX"===F?(this.x=z*L*U+I*E*B,this.y=I*E*U+z*L*B,this.z=I*L*B-z*E*U,this.w=I*L*U-z*E*B):"XZY"===F&&(this.x=z*L*U-I*E*B,this.y=I*E*U-z*L*B,this.z=I*L*B+z*E*U,this.w=I*L*U+z*E*B),this};e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(h,k){function e(t){t=t||{};this.position=new p;t.position&&this.position.copy(t.position);this.quaternion=new q;t.quaternion&&this.quaternion.copy(t.quaternion)}var p=
h("./Vec3"),q=h("./Quaternion");k.exports=e;var l=new q;e.pointToLocalFrame=function(t,r,y,z){z=z||new p;return y.vsub(t,z),r.conjugate(l),l.vmult(z,z),z};e.prototype.pointToLocal=function(t,r){return e.pointToLocalFrame(this.position,this.quaternion,t,r)};e.pointToWorldFrame=function(t,r,y,z){z=z||new p;return r.vmult(y,z),z.vadd(t,z),z};e.prototype.pointToWorld=function(t,r){return e.pointToWorldFrame(this.position,this.quaternion,t,r)};e.prototype.vectorToWorldFrame=function(t,r){r=r||new p;return this.quaternion.vmult(t,
r),r};e.vectorToWorldFrame=function(t,r,y){return t.vmult(r,y),y};e.vectorToLocalFrame=function(t,r,y,z){z=z||new p;return r.w*=-1,r.vmult(y,z),r.w*=-1,z}},{"./Quaternion":28,"./Vec3":30}],30:[function(h,k){function e(r,y,z){this.x=r||0;this.y=y||0;this.z=z||0}k.exports=e;var p=h("./Mat3");e.ZERO=new e(0,0,0);e.UNIT_X=new e(1,0,0);e.UNIT_Y=new e(0,1,0);e.UNIT_Z=new e(0,0,1);e.prototype.cross=function(r,y){var z=r.x,E=r.y;r=r.z;var B=this.x,F=this.y,I=this.z;return y=y||new e,y.x=F*r-I*E,y.y=I*z-B*
r,y.z=B*E-F*z,y};e.prototype.set=function(r,y,z){return this.x=r,this.y=y,this.z=z,this};e.prototype.setZero=function(){this.x=this.y=this.z=0};e.prototype.vadd=function(r,y){return y?(y.x=r.x+this.x,y.y=r.y+this.y,y.z=r.z+this.z,void 0):new e(this.x+r.x,this.y+r.y,this.z+r.z)};e.prototype.vsub=function(r,y){return y?(y.x=this.x-r.x,y.y=this.y-r.y,y.z=this.z-r.z,void 0):new e(this.x-r.x,this.y-r.y,this.z-r.z)};e.prototype.crossmat=function(){return new p([0,-this.z,this.y,this.z,0,-this.x,-this.y,
this.x,0])};e.prototype.normalize=function(){var r=this.x,y=this.y,z=this.z;r=Math.sqrt(r*r+y*y+z*z);0<r?(y=1/r,this.x*=y,this.y*=y,this.z*=y):this.z=this.y=this.x=0;return r};e.prototype.unit=function(r){r=r||new e;var y=this.x,z=this.y,E=this.z,B=Math.sqrt(y*y+z*z+E*E);return 0<B?(B=1/B,r.x=y*B,r.y=z*B,r.z=E*B):(r.x=1,r.y=0,r.z=0),r};e.prototype.norm=function(){var r=this.x,y=this.y,z=this.z;return Math.sqrt(r*r+y*y+z*z)};e.prototype.length=e.prototype.norm;e.prototype.norm2=function(){return this.dot(this)};
e.prototype.lengthSquared=e.prototype.norm2;e.prototype.distanceTo=function(r){var y=this.x,z=this.y,E=this.z,B=r.x,F=r.y;r=r.z;return Math.sqrt((B-y)*(B-y)+(F-z)*(F-z)+(r-E)*(r-E))};e.prototype.distanceSquared=function(r){var y=this.x,z=this.y,E=this.z,B=r.x,F=r.y;r=r.z;return(B-y)*(B-y)+(F-z)*(F-z)+(r-E)*(r-E)};e.prototype.mult=function(r,y){y=y||new e;var z=this.y,E=this.z;return y.x=r*this.x,y.y=r*z,y.z=r*E,y};e.prototype.scale=e.prototype.mult;e.prototype.dot=function(r){return this.x*r.x+this.y*
r.y+this.z*r.z};e.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z};e.prototype.negate=function(r){return r=r||new e,r.x=-this.x,r.y=-this.y,r.z=-this.z,r};var q=new e,l=new e;e.prototype.tangents=function(r,y){var z=this.norm();0<z?(z=1/z,q.set(this.x*z,this.y*z,this.z*z),.9>Math.abs(q.x)?(l.set(1,0,0),q.cross(l,r)):(l.set(0,1,0),q.cross(l,r)),q.cross(r,y)):(r.set(1,0,0),y.set(0,1,0))};e.prototype.toString=function(){return this.x+","+this.y+","+this.z};e.prototype.toArray=function(){return[this.x,
this.y,this.z]};e.prototype.copy=function(r){return this.x=r.x,this.y=r.y,this.z=r.z,this};e.prototype.lerp=function(r,y,z){var E=this.x,B=this.y,F=this.z;z.x=E+(r.x-E)*y;z.y=B+(r.y-B)*y;z.z=F+(r.z-F)*y};e.prototype.almostEquals=function(r,y){return void 0===y&&(y=1E-6),Math.abs(this.x-r.x)>y||Math.abs(this.y-r.y)>y||Math.abs(this.z-r.z)>y?!1:!0};e.prototype.almostZero=function(r){return void 0===r&&(r=1E-6),Math.abs(this.x)>r||Math.abs(this.y)>r||Math.abs(this.z)>r?!1:!0};var t=new e;e.prototype.isAntiparallelTo=
function(r,y){return this.negate(t),t.almostEquals(r,y)};e.prototype.clone=function(){return new e(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(h,k){function e(J){J=J||{};p.apply(this);this.id=e.idCounter++;this.postStep=this.preStep=this.world=null;this.vlambda=new q;this.collisionFilterGroup="number"==typeof J.collisionFilterGroup?J.collisionFilterGroup:1;this.collisionFilterMask="number"==typeof J.collisionFilterMask?J.collisionFilterMask:1;this.collisionResponse=!0;this.position=new q;
J.position&&this.position.copy(J.position);this.previousPosition=new q;this.initPosition=new q;this.velocity=new q;J.velocity&&this.velocity.copy(J.velocity);this.initVelocity=new q;this.force=new q;var N="number"==typeof J.mass?J.mass:0;this.mass=N;this.invMass=0<N?1/N:0;this.material=J.material||null;this.linearDamping="number"==typeof J.linearDamping?J.linearDamping:.01;this.type=0>=N?e.STATIC:e.DYNAMIC;typeof J.type==typeof e.STATIC&&(this.type=J.type);this.allowSleep="undefined"!=typeof J.allowSleep?
J.allowSleep:!0;this.sleepState=0;this.sleepSpeedLimit="undefined"!=typeof J.sleepSpeedLimit?J.sleepSpeedLimit:.1;this.sleepTimeLimit="undefined"!=typeof J.sleepTimeLimit?J.sleepTimeLimit:1;this.timeLastSleepy=0;this._wakeUpAfterNarrowphase=!1;this.torque=new q;this.quaternion=new t;J.quaternion&&this.quaternion.copy(J.quaternion);this.initQuaternion=new t;this.angularVelocity=new q;J.angularVelocity&&this.angularVelocity.copy(J.angularVelocity);this.initAngularVelocity=new q;this.interpolatedPosition=
new q;this.interpolatedQuaternion=new t;this.shapes=[];this.shapeOffsets=[];this.shapeOrientations=[];this.inertia=new q;this.invInertia=new q;this.invInertiaWorld=new l;this.invMassSolve=0;this.invInertiaSolve=new q;this.invInertiaWorldSolve=new l;this.fixedRotation="undefined"!=typeof J.fixedRotation?J.fixedRotation:!1;this.angularDamping="undefined"!=typeof J.angularDamping?J.angularDamping:.01;this.aabb=new r;this.aabbNeedsUpdate=!0;this.wlambda=new q;J.shape&&this.addShape(J.shape);this.updateMassProperties()}
k.exports=e;var p=h("../utils/EventTarget"),q=(h("../shapes/Shape"),h("../math/Vec3")),l=h("../math/Mat3"),t=h("../math/Quaternion"),r=(h("../material/Material"),h("../collision/AABB")),y=h("../shapes/Box");e.prototype=new p;e.prototype.constructor=e;e.DYNAMIC=1;e.STATIC=2;e.KINEMATIC=4;e.AWAKE=0;e.SLEEPY=1;e.SLEEPING=2;e.idCounter=0;e.prototype.wakeUp=function(){var J=this.sleepState;this.sleepState=0;J===e.SLEEPING&&this.dispatchEvent({type:"wakeup"})};e.prototype.sleep=function(){this.sleepState=
e.SLEEPING;this.velocity.set(0,0,0);this.angularVelocity.set(0,0,0)};e.sleepyEvent={type:"sleepy"};e.sleepEvent={type:"sleep"};e.prototype.sleepTick=function(J){if(this.allowSleep){var N=this.sleepState,S=this.velocity.norm2()+this.angularVelocity.norm2(),T=Math.pow(this.sleepSpeedLimit,2);N===e.AWAKE&&T>S?(this.sleepState=e.SLEEPY,this.timeLastSleepy=J,this.dispatchEvent(e.sleepyEvent)):N===e.SLEEPY&&S>T?this.wakeUp():N===e.SLEEPY&&J-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(e.sleepEvent))}};
e.prototype.updateSolveMassProperties=function(){this.sleepState===e.SLEEPING||this.type===e.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))};e.prototype.pointToLocalFrame=function(J,N){N=N||new q;return J.vsub(this.position,N),this.quaternion.conjugate().vmult(N,N),N};e.prototype.vectorToLocalFrame=function(J,N){N=N||new q;
return this.quaternion.conjugate().vmult(J,N),N};e.prototype.pointToWorldFrame=function(J,N){N=N||new q;return this.quaternion.vmult(J,N),N.vadd(this.position,N),N};e.prototype.vectorToWorldFrame=function(J,N){N=N||new q;return this.quaternion.vmult(J,N),N};var z=new q,E=new t;e.prototype.addShape=function(J,N,S){var T=new q,W=new t;return N&&T.copy(N),S&&W.copy(S),this.shapes.push(J),this.shapeOffsets.push(T),this.shapeOrientations.push(W),this.updateMassProperties(),this.updateBoundingRadius(),
this.aabbNeedsUpdate=!0,this};e.prototype.updateBoundingRadius=function(){for(var J=this.shapes,N=this.shapeOffsets,S=J.length,T=0,W=0;W!==S;W++){var Y=J[W];Y.updateBoundingSphereRadius();var V=N[W].norm();Y=Y.boundingSphereRadius;V+Y>T&&(T=V+Y)}this.boundingRadius=T};var B=new r;e.prototype.computeAABB=function(){for(var J=this.shapes,N=this.shapeOffsets,S=this.shapeOrientations,T=J.length,W=this.quaternion,Y=this.aabb,V=0;V!==T;V++){var ma=J[V];S[V].mult(W,E);E.vmult(N[V],z);z.vadd(this.position,
z);ma.calculateWorldAABB(z,E,B.lowerBound,B.upperBound);0===V?Y.copy(B):Y.extend(B)}this.aabbNeedsUpdate=!1};var F=new l,I=new l;new l;e.prototype.updateInertiaWorld=function(J){var N=this.invInertia;if(N.x!==N.y||N.y!==N.z||J)F.setRotationFromQuaternion(this.quaternion),F.transpose(I),F.scale(N,F),F.mmult(I,this.invInertiaWorld)};var L=new q,U=new q;e.prototype.applyForce=function(J,N){this.type===e.DYNAMIC&&(N.vsub(this.position,L),L.cross(J,U),this.force.vadd(J,this.force),this.torque.vadd(U,this.torque))};
var n=new q,w=new q;e.prototype.applyLocalForce=function(J,N){this.type===e.DYNAMIC&&(this.vectorToWorldFrame(J,n),this.pointToWorldFrame(N,w),this.applyForce(n,w))};var G=new q,f=new q,m=new q;e.prototype.applyImpulse=function(J,N){this.type===e.DYNAMIC&&(N.vsub(this.position,G),f.copy(J),f.mult(this.invMass,f),this.velocity.vadd(f,this.velocity),G.cross(J,m),this.invInertiaWorld.vmult(m,m),this.angularVelocity.vadd(m,this.angularVelocity))};var v=new q,D=new q;e.prototype.applyLocalImpulse=function(J,
N){this.type===e.DYNAMIC&&(this.vectorToWorldFrame(J,v),this.pointToWorldFrame(N,D),this.applyImpulse(v,D))};var C=new q;e.prototype.updateMassProperties=function(){this.invMass=0<this.mass?1/this.mass:0;var J=this.inertia,N=this.fixedRotation;this.computeAABB();C.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2);y.calculateInertia(C,this.mass,J);this.invInertia.set(0<J.x&&!N?1/J.x:0,0<J.y&&!N?
1/J.y:0,0<J.z&&!N?1/J.z:0);this.updateInertiaWorld(!0)};e.prototype.getVelocityAtWorldPoint=function(J,N){var S=new q;return J.vsub(this.position,S),this.angularVelocity.cross(S,N),this.velocity.vadd(N,N),N}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(h,k){function e(T){this.chassisBody=T.chassisBody;this.wheelInfos=[];this.sliding=!1;this.world=null;this.indexRightAxis=
"undefined"!=typeof T.indexRightAxis?T.indexRightAxis:1;this.indexForwardAxis="undefined"!=typeof T.indexForwardAxis?T.indexForwardAxis:0;this.indexUpAxis="undefined"!=typeof T.indexUpAxis?T.indexUpAxis:2}function p(T,W,Y){var V=m,ma=v,ha=D,ia=C;return W.vsub(T.position,V),V.cross(Y,ma),T.invInertiaWorld.vmult(ma,ia),ia.cross(V,ha),T.invMass+Y.dot(ha)}var q=(h("./Body"),h("../math/Vec3")),l=h("../math/Quaternion"),t=(h("../collision/RaycastResult"),h("../collision/Ray")),r=h("../objects/WheelInfo");
k.exports=e;var y=(new q,new q,new q,new q),z=new q,E=new q;new t;e.prototype.addWheel=function(T){T=T||{};T=new r(T);var W=this.wheelInfos.length;return this.wheelInfos.push(T),W};e.prototype.setSteeringValue=function(T,W){this.wheelInfos[W].steering=T};new q;e.prototype.applyEngineForce=function(T,W){this.wheelInfos[W].engineForce=T};e.prototype.setBrake=function(T,W){this.wheelInfos[W].brake=T};e.prototype.addToWorld=function(T){this.constraints;T.add(this.chassisBody);var W=this;this.preStepCallback=
function(){W.updateVehicle(T.dt)};T.addEventListener("preStep",this.preStepCallback);this.world=T};e.prototype.getVehicleAxisWorld=function(T,W){W.set(0===T?1:0,1===T?1:0,2===T?1:0);this.chassisBody.vectorToWorldFrame(W,W)};e.prototype.updateVehicle=function(T){for(var W=this.wheelInfos,Y=W.length,V=this.chassisBody,ma=0;Y>ma;ma++)this.updateWheelTransform(ma);this.currentVehicleSpeedKmHour=3.6*V.velocity.norm();ma=new q;this.getVehicleAxisWorld(this.indexForwardAxis,ma);0>ma.dot(V.velocity)&&(this.currentVehicleSpeedKmHour*=
-1);for(ma=0;Y>ma;ma++)this.castRay(W[ma]);this.updateSuspension(T);var ha=new q,ia=new q;for(ma=0;Y>ma;ma++){var aa=W[ma],ea=aa.suspensionForce;ea>aa.maxSuspensionForce&&(ea=aa.maxSuspensionForce);aa.raycastResult.hitNormalWorld.scale(ea*T,ha);aa.raycastResult.hitPointWorld.vsub(V.position,ia);V.applyImpulse(ha,aa.raycastResult.hitPointWorld)}this.updateFriction(T);ha=new q;ia=new q;ea=new q;for(ma=0;Y>ma;ma++){aa=W[ma];V.getVelocityAtWorldPoint(aa.chassisConnectionPointWorld,ea);var ja=1;switch(this.indexUpAxis){case 1:ja=
-1}if(aa.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,ia);var Q=ia.dot(aa.raycastResult.hitNormalWorld);aa.raycastResult.hitNormalWorld.scale(Q,ha);ia.vsub(ha,ia);Q=ia.dot(ea);aa.deltaRotation=ja*Q*T/aa.radius}!aa.sliding&&aa.isInContact||0===aa.engineForce||!aa.useCustomSlidingRotationalSpeed||(aa.deltaRotation=(0<aa.engineForce?1:-1)*aa.customSlidingRotationalSpeed*T);Math.abs(aa.brake)>Math.abs(aa.engineForce)&&(aa.deltaRotation=0);aa.rotation+=aa.deltaRotation;aa.deltaRotation*=
.99}};e.prototype.updateSuspension=function(){for(var T=this.chassisBody.mass,W=this.wheelInfos,Y=W.length,V=0;Y>V;V++){var ma=W[V];if(ma.isInContact){var ha=ma.suspensionStiffness*(ma.suspensionRestLength-ma.suspensionLength)*ma.clippedInvContactDotSuspension;var ia=ma.suspensionRelativeVelocity;ha-=(0>ia?ma.dampingCompression:ma.dampingRelaxation)*ia;ma.suspensionForce=ha*T;0>ma.suspensionForce&&(ma.suspensionForce=0)}else ma.suspensionForce=0}};e.prototype.removeFromWorld=function(T){this.constraints;
T.remove(this.chassisBody);T.removeEventListener("preStep",this.preStepCallback);this.world=null};var B=new q,F=new q;e.prototype.castRay=function(T){this.updateWheelTransformWorld(T);var W=this.chassisBody,Y=-1;T.directionWorld.scale(T.suspensionRestLength+T.radius,B);var V=T.chassisConnectionPointWorld;V.vadd(B,F);var ma=T.raycastResult;ma.reset();var ha=W.collisionResponse;W.collisionResponse=!1;this.world.rayTest(V,F,ma);W.collisionResponse=ha;V=ma.body;(T.raycastResult.groundObject=0,V)?(Y=ma.distance,
T.raycastResult.hitNormalWorld=ma.hitNormalWorld,T.isInContact=!0,T.suspensionLength=ma.distance-T.radius,ma=T.suspensionRestLength-T.maxSuspensionTravel,V=T.suspensionRestLength+T.maxSuspensionTravel,T.suspensionLength<ma&&(T.suspensionLength=ma),T.suspensionLength>V&&(T.suspensionLength=V,T.raycastResult.reset()),ma=T.raycastResult.hitNormalWorld.dot(T.directionWorld),V=new q,W.getVelocityAtWorldPoint(T.raycastResult.hitPointWorld,V),W=T.raycastResult.hitNormalWorld.dot(V),-.1<=ma?(T.suspensionRelativeVelocity=
0,T.clippedInvContactDotSuspension=10):(ma=-1/ma,T.suspensionRelativeVelocity=W*ma,T.clippedInvContactDotSuspension=ma)):(T.suspensionLength=T.suspensionRestLength+0*T.maxSuspensionTravel,T.suspensionRelativeVelocity=0,T.directionWorld.scale(-1,T.raycastResult.hitNormalWorld),T.clippedInvContactDotSuspension=1);return Y};e.prototype.updateWheelTransformWorld=function(T){T.isInContact=!1;var W=this.chassisBody;W.pointToWorldFrame(T.chassisConnectionPointLocal,T.chassisConnectionPointWorld);W.vectorToWorldFrame(T.directionLocal,
T.directionWorld);W.vectorToWorldFrame(T.axleLocal,T.axleWorld)};e.prototype.updateWheelTransform=function(T){T=this.wheelInfos[T];this.updateWheelTransformWorld(T);T.directionLocal.scale(-1,y);z.copy(T.axleLocal);y.cross(z,E);E.normalize();z.normalize();var W=T.steering,Y=new l;Y.setFromAxisAngle(y,W);W=new l;W.setFromAxisAngle(z,T.rotation);var V=T.worldTransform.quaternion;this.chassisBody.quaternion.mult(Y,V);V.mult(W,V);V.normalize();Y=T.worldTransform.position;Y.copy(T.directionWorld);Y.scale(T.suspensionLength,
Y);Y.vadd(T.chassisConnectionPointWorld,Y)};var I=[new q(1,0,0),new q(0,1,0),new q(0,0,1)];e.prototype.getWheelTransformWorld=function(T){return this.wheelInfos[T].worldTransform};var L=new q,U=[],n=[];e.prototype.updateFriction=function(T){for(var W=this.wheelInfos,Y=W.length,V=this.chassisBody,ma=0,ha=0;Y>ha;ha++){var ia=W[ha],aa=ia.raycastResult.body;aa&&ma++;ia.sideImpulse=0;ia.forwardImpulse=0;n[ha]||(n[ha]=new q);U[ha]||(U[ha]=new q)}for(ha=0;Y>ha;ha++)if(ia=W[ha],aa=ia.raycastResult.body){var ea=
U[ha];this.getWheelTransformWorld(ha).vectorToWorldFrame(I[this.indexRightAxis],ea);ma=ia.raycastResult.hitNormalWorld;var ja=ea.dot(ma);ma.scale(ja,L);ea.vsub(L,ea);ea.normalize();ma.cross(ea,n[ha]);n[ha].normalize();ma=ia;ja=V;var Q=ia.raycastResult.hitPointWorld,X=ia.raycastResult.hitPointWorld;if(1.1<ea.norm2())aa=0;else{var ca=J,pa=N,ka=S;ja.getVelocityAtWorldPoint(Q,ca);aa.getVelocityAtWorldPoint(X,pa);ca.vsub(pa,ka);aa=-.2*ea.dot(ka)*(1/(ja.invMass+aa.invMass))}ma.sideImpulse=aa;ia.sideImpulse*=
1}this.sliding=!1;for(ha=0;Y>ha;ha++){ia=W[ha];aa=ia.raycastResult.body;Q=0;if(ia.slipInfo=1,aa){ma=ia.brake?ia.brake:0;pa=V;X=aa;ea=ia.raycastResult.hitPointWorld;ca=n[ha];Q=ma;ja=0;ka=ea;var va=w,Aa=G,xa=f;pa.getVelocityAtWorldPoint(ka,va);X.getVelocityAtWorldPoint(ka,Aa);va.vsub(Aa,xa);ka=ca.dot(xa);pa=p(pa,ea,ca);X=p(X,ea,ca);Q=(ja=1/(pa+X)*-ka,ja>Q&&(ja=Q),-Q>ja&&(ja=-Q),ja);Q+=ia.engineForce*T;ma/=Q;ia.slipInfo*=ma}if(ia.forwardImpulse=0,ia.skidInfo=1,aa)if(ia.skidInfo=1,aa=ia.suspensionForce*
T*ia.frictionSlip,ma=aa*aa,ia.forwardImpulse=Q,ja=.5*ia.forwardImpulse,Q=1*ia.sideImpulse,ja=ja*ja+Q*Q,ia.sliding=!1,ja>ma)this.sliding=!0,ia.sliding=!0,ma=aa/Math.sqrt(ja),ia.skidInfo*=ma}if(this.sliding)for(ha=0;Y>ha;ha++)ia=W[ha],0!==ia.sideImpulse&&1>ia.skidInfo&&(ia.forwardImpulse*=ia.skidInfo,ia.sideImpulse*=ia.skidInfo);for(ha=0;Y>ha;ha++){ia=W[ha];T=new q;if(T.copy(ia.raycastResult.hitPointWorld),0!==ia.forwardImpulse)aa=new q,n[ha].scale(ia.forwardImpulse,aa),V.applyImpulse(aa,T);0!==ia.sideImpulse&&
(aa=ia.raycastResult.body,ma=new q,ma.copy(ia.raycastResult.hitPointWorld),ja=new q,U[ha].scale(ia.sideImpulse,ja),V.pointToLocalFrame(T,T),T["xyz"[this.indexUpAxis]]*=ia.rollInfluence,V.pointToWorldFrame(T,T),V.applyImpulse(ja,T),ja.scale(-1,ja),aa.applyImpulse(ja,ma))}};var w=new q,G=new q,f=new q,m=new q,v=new q,D=new q,C=new q,J=new q,N=new q,S=new q},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(h,
k){function e(E){(this.wheelBodies=[],this.coordinateSystem="undefined"==typeof E.coordinateSystem?new t(1,2,3):E.coordinateSystem.clone(),this.chassisBody=E.chassisBody,this.chassisBody)||(E=new l(new t(5,2,.5)),this.chassisBody=new p(1,E));this.constraints=[];this.wheelAxes=[];this.wheelForces=[]}var p=h("./Body"),q=h("../shapes/Sphere"),l=h("../shapes/Box"),t=h("../math/Vec3"),r=h("../constraints/HingeConstraint");k.exports=e;e.prototype.addWheel=function(E){E=E||{};var B=E.body;B||(B=new p(1,
new q(1.2)));this.wheelBodies.push(B);this.wheelForces.push(0);var F=(new t,"undefined"!=typeof E.position?E.position.clone():new t),I=new t;this.chassisBody.pointToWorldFrame(F,I);B.position.set(I.x,I.y,I.z);E="undefined"!=typeof E.axis?E.axis.clone():new t(0,1,0);this.wheelAxes.push(E);B=new r(this.chassisBody,B,{pivotA:F,axisA:E,pivotB:t.ZERO,axisB:E,collideConnected:!1});return this.constraints.push(B),this.wheelBodies.length-1};e.prototype.setSteeringValue=function(E,B){var F=this.wheelAxes[B],
I=Math.cos(E);E=Math.sin(E);var L=F.x;F=F.y;this.constraints[B].axisA.set(I*L-E*F,E*L+I*F,0)};e.prototype.setMotorSpeed=function(E,B){B=this.constraints[B];B.enableMotor();B.motorTargetVelocity=E};e.prototype.disableMotor=function(E){this.constraints[E].disableMotor()};var y=new t;e.prototype.setWheelForce=function(E,B){this.wheelForces[B]=E};e.prototype.applyWheelForce=function(E,B){var F=this.wheelBodies[B],I=F.torque;this.wheelAxes[B].scale(E,y);F.vectorToWorldFrame(y,y);I.vadd(y,I)};e.prototype.addToWorld=
function(E){for(var B=this.constraints,F=this.wheelBodies.concat([this.chassisBody]),I=0;I<F.length;I++)E.add(F[I]);for(I=0;I<B.length;I++)E.addConstraint(B[I]);E.addEventListener("preStep",this._update.bind(this))};e.prototype._update=function(){for(var E=this.wheelForces,B=0;B<E.length;B++)this.applyWheelForce(E[B],B)};e.prototype.removeFromWorld=function(E){for(var B=this.constraints,F=this.wheelBodies.concat([this.chassisBody]),I=0;I<F.length;I++)E.remove(F[I]);for(I=0;I<B.length;I++)E.removeConstraint(B[I])};
var z=new t;e.prototype.getWheelSpeed=function(E){var B=this.wheelBodies[E].angularVelocity;return this.chassisBody.vectorToWorldFrame(this.wheelAxes[E],z),B.dot(z)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(h,k){function e(){this.particles=[];this.speedOfSound=this.smoothingRadius=this.density=1;this.viscosity=.01;this.eps=1E-6;this.pressures=[];this.densities=[];this.neighbors=[]}k.exports=e;k=(h("../shapes/Shape"),
h("../math/Vec3"));h("../math/Quaternion");h("../shapes/Particle");h("../objects/Body");h("../material/Material");e.prototype.add=function(E){this.particles.push(E);this.neighbors.length<this.particles.length&&this.neighbors.push([])};e.prototype.remove=function(E){E=this.particles.indexOf(E);-1!==E&&(this.particles.splice(E,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var p=new k;e.prototype.getNeighbors=function(E,B){for(var F=this.particles.length,I=E.id,L=this.smoothingRadius*
this.smoothingRadius,U=0;U!==F;U++){var n=this.particles[U];n.position.vsub(E.position,p);I!==n.id&&p.norm2()<L&&B.push(n)}};var q=new k,l=new k,t=new k,r=new k,y=new k,z=new k;e.prototype.update=function(){for(var E=this.particles.length,B=this.speedOfSound,F=this.eps,I=0;I!==E;I++){var L=this.particles[I],U=this.neighbors[I];U.length=0;this.getNeighbors(L,U);U.push(this.particles[I]);for(var n=U.length,w=0,G=0;G!==n;G++){L.position.vsub(U[G].position,q);var f=q.norm();f=this.w(f);w+=U[G].mass*f}this.densities[I]=
w;this.pressures[I]=B*B*(this.densities[I]-this.density)}for(I=0;I!==E;I++){B=this.particles[I];l.set(0,0,0);t.set(0,0,0);U=this.neighbors[I];n=U.length;for(G=0;G!==n;G++)w=U[G],B.position.vsub(w.position,y),f=y.norm(),L=-w.mass*(this.pressures[I]/(this.densities[I]*this.densities[I]+F)+this.pressures[G]/(this.densities[G]*this.densities[G]+F)),this.gradw(y,r),r.mult(L,r),l.vadd(r,l),w.velocity.vsub(B.velocity,z),z.mult(1/(1E-4+this.densities[I]*this.densities[G])*this.viscosity*w.mass,z),L=this.nablaw(f),
z.mult(L,z),t.vadd(z,t);t.mult(B.mass,t);l.mult(B.mass,l);B.force.vadd(t,B.force);B.force.vadd(l,B.force)}};e.prototype.w=function(E){var B=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(B,9))*Math.pow(B*B-E*E,3)};e.prototype.gradw=function(E,B){var F=E.norm(),I=this.smoothingRadius;E.mult(945/(32*Math.PI*Math.pow(I,9))*Math.pow(I*I-F*F,2),B)};e.prototype.nablaw=function(E){var B=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(B,9))*(B*B-E*E)*(7*E*E-3*B*B)}},{"../material/Material":25,
"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(h,k){function e(U,n,w){w=w||{};this.restLength="number"==typeof w.restLength?w.restLength:1;this.stiffness=w.stiffness||100;this.damping=w.damping||1;this.bodyA=U;this.bodyB=n;this.localAnchorA=new p;this.localAnchorB=new p;w.localAnchorA&&this.localAnchorA.copy(w.localAnchorA);w.localAnchorB&&this.localAnchorB.copy(w.localAnchorB);w.worldAnchorA&&this.setWorldAnchorA(w.worldAnchorA);
w.worldAnchorB&&this.setWorldAnchorB(w.worldAnchorB)}var p=h("../math/Vec3");k.exports=e;e.prototype.setWorldAnchorA=function(U){this.bodyA.pointToLocalFrame(U,this.localAnchorA)};e.prototype.setWorldAnchorB=function(U){this.bodyB.pointToLocalFrame(U,this.localAnchorB)};e.prototype.getWorldAnchorA=function(U){this.bodyA.pointToWorldFrame(this.localAnchorA,U)};e.prototype.getWorldAnchorB=function(U){this.bodyB.pointToWorldFrame(this.localAnchorB,U)};var q=new p,l=new p,t=new p,r=new p,y=new p,z=new p,
E=new p,B=new p,F=new p,I=new p,L=new p;e.prototype.applyForce=function(){var U=this.stiffness,n=this.damping,w=this.restLength,G=this.bodyA,f=this.bodyB;this.getWorldAnchorA(y);this.getWorldAnchorB(z);y.vsub(G.position,E);z.vsub(f.position,B);z.vsub(y,q);var m=q.norm();l.copy(q);l.normalize();f.velocity.vsub(G.velocity,t);f.angularVelocity.cross(B,L);t.vadd(L,t);G.angularVelocity.cross(E,L);t.vsub(L,t);l.mult(-U*(m-w)-n*t.dot(l),r);G.force.vsub(r,G.force);f.force.vadd(r,f.force);E.cross(r,F);B.cross(r,
I);G.torque.vsub(F,G.torque);f.torque.vadd(I,f.torque)}},{"../math/Vec3":30}],36:[function(h,k){function e(z){z=t.defaults(z,{chassisConnectionPointLocal:new p,chassisConnectionPointWorld:new p,directionLocal:new p,directionWorld:new p,axleLocal:new p,axleWorld:new p,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1E4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,
clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1});this.maxSuspensionTravel=z.maxSuspensionTravel;this.customSlidingRotationalSpeed=z.customSlidingRotationalSpeed;this.useCustomSlidingRotationalSpeed=z.useCustomSlidingRotationalSpeed;this.sliding=!1;this.chassisConnectionPointLocal=z.chassisConnectionPointLocal.clone();this.chassisConnectionPointWorld=
z.chassisConnectionPointWorld.clone();this.directionLocal=z.directionLocal.clone();this.directionWorld=z.directionWorld.clone();this.axleLocal=z.axleLocal.clone();this.axleWorld=z.axleWorld.clone();this.suspensionRestLength=z.suspensionRestLength;this.suspensionMaxLength=z.suspensionMaxLength;this.radius=z.radius;this.suspensionStiffness=z.suspensionStiffness;this.dampingCompression=z.dampingCompression;this.dampingRelaxation=z.dampingRelaxation;this.frictionSlip=z.frictionSlip;this.deltaRotation=
this.rotation=this.steering=0;this.rollInfluence=z.rollInfluence;this.maxSuspensionForce=z.maxSuspensionForce;this.brake=this.engineForce=0;this.isFrontWheel=z.isFrontWheel;this.clippedInvContactDotSuspension=1;this.forwardImpulse=this.sideImpulse=this.suspensionLength=this.skidInfo=this.suspensionForce=this.suspensionRelativeVelocity=0;this.raycastResult=new l;this.worldTransform=new q;this.isInContact=!1}var p=h("../math/Vec3"),q=h("../math/Transform"),l=h("../collision/RaycastResult"),t=h("../utils/Utils");
k.exports=e;var r=new p,y=new p;r=new p;e.prototype.updateWheel=function(z){var E=this.raycastResult;if(this.isInContact){var B=E.hitNormalWorld.dot(E.directionWorld);E.hitPointWorld.vsub(z.position,y);z.getVelocityAtWorldPoint(y,r);z=E.hitNormalWorld.dot(r);-.1<=B?(this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10):(B=-1/B,this.suspensionRelativeVelocity=z*B,this.clippedInvContactDotSuspension=B)}else E.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=
0,E.directionWorld.scale(-1,E.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(h,k){function e(y){p.call(this);this.type=p.types.BOX;this.halfExtents=y;this.convexPolyhedronRepresentation=null;this.updateConvexPolyhedronRepresentation();this.updateBoundingSphereRadius()}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3"),l=h("./ConvexPolyhedron");e.prototype=new p;e.prototype.constructor=
e;e.prototype.updateConvexPolyhedronRepresentation=function(){var y=this.halfExtents.x,z=this.halfExtents.y,E=this.halfExtents.z;y=[new q(-y,-z,-E),new q(y,-z,-E),new q(y,z,-E),new q(-y,z,-E),new q(-y,-z,E),new q(y,-z,E),new q(y,z,E),new q(-y,z,E)];this.convexPolyhedronRepresentation=y=(new q(0,0,1),new q(0,1,0),new q(1,0,0),new l(y,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));y.material=this.material};e.prototype.calculateLocalInertia=function(y,z){return z=z||new q,e.calculateInertia(this.halfExtents,
y,z),z};e.calculateInertia=function(y,z,E){E.x=1/12*z*(4*y.y*y.y+4*y.z*y.z);E.y=1/12*z*(4*y.x*y.x+4*y.z*y.z);E.z=1/12*z*(4*y.y*y.y+4*y.x*y.x)};e.prototype.getSideNormals=function(y,z){var E=this.halfExtents;if(y[0].set(E.x,0,0),y[1].set(0,E.y,0),y[2].set(0,0,E.z),y[3].set(-E.x,0,0),y[4].set(0,-E.y,0),y[5].set(0,0,-E.z),void 0!==z)for(E=0;E!==y.length;E++)z.vmult(y[E],y[E]);return y};e.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z};e.prototype.updateBoundingSphereRadius=
function(){this.boundingSphereRadius=this.halfExtents.norm()};var t=new q;new q;e.prototype.forEachWorldCorner=function(y,z,E){var B=this.halfExtents;B=[[B.x,B.y,B.z],[-B.x,B.y,B.z],[-B.x,-B.y,B.z],[-B.x,-B.y,-B.z],[B.x,-B.y,-B.z],[B.x,B.y,-B.z],[-B.x,B.y,-B.z],[B.x,-B.y,B.z]];for(var F=0;F<B.length;F++)t.set(B[F][0],B[F][1],B[F][2]),z.vmult(t,t),y.vadd(t,t),E(t.x,t.y,t.z)};var r=[new q,new q,new q,new q,new q,new q,new q,new q];e.prototype.calculateWorldAABB=function(y,z,E,B){var F=this.halfExtents;
r[0].set(F.x,F.y,F.z);r[1].set(-F.x,F.y,F.z);r[2].set(-F.x,-F.y,F.z);r[3].set(-F.x,-F.y,-F.z);r[4].set(F.x,-F.y,-F.z);r[5].set(F.x,F.y,-F.z);r[6].set(-F.x,F.y,-F.z);r[7].set(F.x,-F.y,F.z);var I=r[0];z.vmult(I,I);y.vadd(I,I);B.copy(I);E.copy(I);for(F=1;8>F;F++){I=r[F];z.vmult(I,I);y.vadd(I,I);var L=I.x,U=I.y;I=I.z;L>B.x&&(B.x=L);U>B.y&&(B.y=U);I>B.z&&(B.z=I);L<E.x&&(E.x=L);U<E.y&&(E.y=U);I<E.z&&(E.z=I)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(h,k){function e(aa,ea,
ja){p.call(this);this.type=p.types.CONVEXPOLYHEDRON;this.vertices=aa||[];this.worldVertices=[];this.worldVerticesNeedsUpdate=!0;this.faces=ea||[];this.faceNormals=[];this.computeNormals();this.worldFaceNormalsNeedsUpdate=!0;this.worldFaceNormals=[];this.uniqueEdges=[];this.uniqueAxes=ja?ja.slice():null;this.computeEdges();this.updateBoundingSphereRadius()}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3"),l=(h("../math/Quaternion"),h("../math/Transform"));e.prototype=new p;e.prototype.constructor=
e;var t=new q;e.prototype.computeEdges=function(){for(var aa=this.faces,ea=this.vertices,ja=(ea.length,this.uniqueEdges),Q=ja.length=0;Q!==aa.length;Q++)for(var X=aa[Q],ca=X.length,pa=0;pa!==ca;pa++){ea[X[pa]].vsub(ea[X[(pa+1)%ca]],t);t.normalize();for(var ka=!1,va=0;va!==ja.length;va++)if(ja[va].almostEquals(t)||ja[va].almostEquals(t)){ka=!0;break}ka||ja.push(t.clone())}};e.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var aa=0;aa<this.faces.length;aa++){for(var ea=
0;ea<this.faces[aa].length;ea++)if(!this.vertices[this.faces[aa][ea]])throw Error("Vertex "+this.faces[aa][ea]+" not found!");ea=this.faceNormals[aa]||new q;this.getFaceNormal(aa,ea);ea.negate(ea);this.faceNormals[aa]=ea;if(0>ea.dot(this.vertices[this.faces[aa][0]]))for(console.error(".faceNormals["+aa+"] = Vec3("+ea.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),ea=0;ea<this.faces[aa].length;ea++)console.warn(".vertices["+
this.faces[aa][ea]+"] = Vec3("+this.vertices[this.faces[aa][ea]].toString()+")")}};var r=new q,y=new q;e.computeNormal=function(aa,ea,ja,Q){ea.vsub(aa,y);ja.vsub(ea,r);r.cross(y,Q);Q.isZero()||Q.normalize()};e.prototype.getFaceNormal=function(aa,ea){aa=this.faces[aa];return e.computeNormal(this.vertices[aa[0]],this.vertices[aa[1]],this.vertices[aa[2]],ea)};var z=new q;e.prototype.clipAgainstHull=function(aa,ea,ja,Q,X,ca,pa,ka,va){for(var Aa=-1,xa=-Number.MAX_VALUE,Ia=0;Ia<ja.faces.length;Ia++){z.copy(ja.faceNormals[Ia]);
X.vmult(z,z);var Za=z.dot(ca);Za>xa&&(xa=Za,Aa=Ia)}xa=[];Ia=ja.faces[Aa];Za=Ia.length;for(var kb=0;Za>kb;kb++){var Hb=ja.vertices[Ia[kb]],vb=new q;vb.copy(Hb);X.vmult(vb,vb);Q.vadd(vb,vb);xa.push(vb)}0<=Aa&&this.clipFaceAgainstHull(ca,aa,ea,xa,pa,ka,va)};var E=new q,B=new q,F=new q,I=new q,L=new q,U=new q;e.prototype.findSeparatingAxis=function(aa,ea,ja,Q,X,ca,pa,ka){var va=Number.MAX_VALUE,Aa=0;if(this.uniqueAxes)for(var xa=0;xa!==this.uniqueAxes.length;xa++){ja.vmult(this.uniqueAxes[xa],E);var Ia=
this.testSepAxis(E,aa,ea,ja,Q,X);if(!1===Ia)return!1;va>Ia&&(va=Ia,ca.copy(E))}else{var Za=pa?pa.length:this.faces.length;for(xa=0;Za>xa;xa++){Ia=pa?pa[xa]:xa;E.copy(this.faceNormals[Ia]);ja.vmult(E,E);Ia=this.testSepAxis(E,aa,ea,ja,Q,X);if(!1===Ia)return!1;va>Ia&&(va=Ia,ca.copy(E))}}if(aa.uniqueAxes)for(xa=0;xa!==aa.uniqueAxes.length;xa++){X.vmult(aa.uniqueAxes[xa],B);Aa++;Ia=this.testSepAxis(B,aa,ea,ja,Q,X);if(!1===Ia)return!1;va>Ia&&(va=Ia,ca.copy(B))}else for(pa=ka?ka.length:aa.faces.length,xa=
0;pa>xa;xa++){Ia=ka?ka[xa]:xa;B.copy(aa.faceNormals[Ia]);X.vmult(B,B);Aa++;Ia=this.testSepAxis(B,aa,ea,ja,Q,X);if(!1===Ia)return!1;va>Ia&&(va=Ia,ca.copy(B))}for(ka=0;ka!==this.uniqueEdges.length;ka++)for(ja.vmult(this.uniqueEdges[ka],I),Aa=0;Aa!==aa.uniqueEdges.length;Aa++)if(X.vmult(aa.uniqueEdges[Aa],L),I.cross(L,U),!U.almostZero()){U.normalize();xa=this.testSepAxis(U,aa,ea,ja,Q,X);if(!1===xa)return!1;va>xa&&(va=xa,ca.copy(U))}return Q.vsub(ea,F),0<F.dot(ca)&&ca.negate(ca),!0};var n=[],w=[];e.prototype.testSepAxis=
function(aa,ea,ja,Q,X,ca){e.project(this,aa,ja,Q,n);e.project(ea,aa,X,ca,w);ja=n[0];aa=n[1];ea=w[0];Q=w[1];if(Q>ja||aa>ea)return!1;ja-=Q;aa=ea-aa;return aa>ja?ja:aa};var G=new q,f=new q;e.prototype.calculateLocalInertia=function(aa,ea){this.computeLocalAABB(G,f);var ja=f.x-G.x,Q=f.y-G.y,X=f.z-G.z;ea.x=1/12*aa*(4*Q*Q+4*X*X);ea.y=1/12*aa*(4*ja*ja+4*X*X);ea.z=1/12*aa*(4*Q*Q+4*ja*ja)};e.prototype.getPlaneConstantOfFace=function(aa){return-this.faceNormals[aa].dot(this.vertices[this.faces[aa][0]])};var m=
new q,v=new q,D=new q,C=new q,J=new q,N=new q,S=new q,T=new q;e.prototype.clipFaceAgainstHull=function(aa,ea,ja,Q,X,ca,pa){for(var ka=[],va=-1,Aa=Number.MAX_VALUE,xa=0;xa<this.faces.length;xa++){m.copy(this.faceNormals[xa]);ja.vmult(m,m);var Ia=m.dot(aa);Aa>Ia&&(Aa=Ia,va=xa)}if(!(0>va)){aa=this.faces[va];aa.connectedFaces=[];for(Aa=0;Aa<this.faces.length;Aa++)for(xa=0;xa<this.faces[Aa].length;xa++)-1!==aa.indexOf(this.faces[Aa][xa])&&Aa!==va&&-1===aa.connectedFaces.indexOf(Aa)&&aa.connectedFaces.push(Aa);
Aa=(Q.length,aa.length);for(xa=0;Aa>xa;xa++){Ia=this.vertices[aa[xa]];Ia.vsub(this.vertices[aa[(xa+1)%Aa]],v);D.copy(v);ja.vmult(D,D);ea.vadd(D,D);C.copy(this.faceNormals[va]);ja.vmult(C,C);ea.vadd(C,C);D.cross(C,J);J.negate(J);N.copy(Ia);ja.vmult(N,N);ea.vadd(N,N);Ia=(-N.dot(J),aa.connectedFaces[xa]);S.copy(this.faceNormals[Ia]);Ia=this.getPlaneConstantOfFace(Ia);T.copy(S);ja.vmult(T,T);Ia-=T.dot(ea);for(this.clipFaceAgainstPlane(Q,ka,T,Ia);Q.length;)Q.shift();for(;ka.length;)Q.push(ka.shift())}S.copy(this.faceNormals[va]);
Ia=this.getPlaneConstantOfFace(va);T.copy(S);ja.vmult(T,T);Ia-=T.dot(ea);for(Aa=0;Aa<Q.length;Aa++)if(ea=T.dot(Q[Aa])+Ia,X>=ea&&(console.log("clamped: depth="+ea+" to minDist="+(X+"")),ea=X),ca>=ea)ja=Q[Aa],0>=ea&&pa.push({point:ja,normal:T,depth:ea})}};e.prototype.clipFaceAgainstPlane=function(aa,ea,ja,Q){var X,ca=aa.length;if(2>ca)return ea;var pa=aa[aa.length-1],ka=aa[0];var va=ja.dot(pa)+Q;for(var Aa=0;ca>Aa;Aa++){if(ka=aa[Aa],X=ja.dot(ka)+Q,0>va){if(0>X){var xa=new q;xa.copy(ka)}else xa=new q,
pa.lerp(ka,va/(va-X),xa);ea.push(xa)}else 0>X&&(xa=new q,pa.lerp(ka,va/(va-X),xa),ea.push(xa),ea.push(ka));pa=ka;va=X}return ea};e.prototype.computeWorldVertices=function(aa,ea){for(var ja=this.vertices.length;this.worldVertices.length<ja;)this.worldVertices.push(new q);for(var Q=this.vertices,X=this.worldVertices,ca=0;ca!==ja;ca++)ea.vmult(Q[ca],X[ca]),aa.vadd(X[ca],X[ca]);this.worldVerticesNeedsUpdate=!1};new q;e.prototype.computeLocalAABB=function(aa,ea){var ja=this.vertices.length,Q=this.vertices;
aa.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);ea.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var X=0;ja>X;X++){var ca=Q[X];ca.x<aa.x?aa.x=ca.x:ca.x>ea.x&&(ea.x=ca.x);ca.y<aa.y?aa.y=ca.y:ca.y>ea.y&&(ea.y=ca.y);ca.z<aa.z?aa.z=ca.z:ca.z>ea.z&&(ea.z=ca.z)}};e.prototype.computeWorldFaceNormals=function(aa){for(var ea=this.faceNormals.length;this.worldFaceNormals.length<ea;)this.worldFaceNormals.push(new q);for(var ja=this.faceNormals,Q=this.worldFaceNormals,X=0;X!==ea;X++)aa.vmult(ja[X],
Q[X]);this.worldFaceNormalsNeedsUpdate=!1};e.prototype.updateBoundingSphereRadius=function(){for(var aa=0,ea=this.vertices,ja=0,Q=ea.length;ja!==Q;ja++){var X=ea[ja].norm2();X>aa&&(aa=X)}this.boundingSphereRadius=Math.sqrt(aa)};var W=new q;e.prototype.calculateWorldAABB=function(aa,ea,ja,Q){for(var X,ca,pa,ka,va,Aa,xa=this.vertices.length,Ia=this.vertices,Za=0;xa>Za;Za++){W.copy(Ia[Za]);ea.vmult(W,W);aa.vadd(W,W);var kb=W;kb.x<X||void 0===X?X=kb.x:(kb.x>ka||void 0===ka)&&(ka=kb.x);kb.y<ca||void 0===
ca?ca=kb.y:(kb.y>va||void 0===va)&&(va=kb.y);kb.z<pa||void 0===pa?pa=kb.z:(kb.z>Aa||void 0===Aa)&&(Aa=kb.z)}ja.set(X,ca,pa);Q.set(ka,va,Aa)};e.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};e.prototype.getAveragePointLocal=function(aa){aa=aa||new q;for(var ea=this.vertices.length,ja=this.vertices,Q=0;ea>Q;Q++)aa.vadd(ja[Q],aa);return aa.mult(1/ea,aa),aa};e.prototype.transformAllPoints=function(aa,ea){var ja=this.vertices.length,Q=this.vertices;if(ea){for(var X=0;ja>X;X++){var ca=
Q[X];ea.vmult(ca,ca)}for(X=0;X<this.faceNormals.length;X++)ca=this.faceNormals[X],ea.vmult(ca,ca)}if(aa)for(X=0;ja>X;X++)ca=Q[X],ca.vadd(aa,ca)};var Y=new q,V=new q,ma=new q;e.prototype.pointIsInside=function(aa){var ea=this.vertices,ja=this.faces,Q=this.faceNormals,X=this.faces.length;this.getAveragePointLocal(Y);for(var ca=0;X>ca;ca++){var pa=(this.faces[ca].length,Q[ca]);var ka=ea[ja[ca][0]],va=V;aa.vsub(ka,va);va=pa.dot(va);var Aa=ma;Y.vsub(ka,Aa);pa=pa.dot(Aa);if(0>va&&0<pa||0<va&&0>pa)return!1}return-1};
var ha=(new q,new q),ia=new q;e.project=function(aa,ea,ja,Q,X){var ca=aa.vertices.length;aa=aa.vertices;ia.setZero();l.vectorToLocalFrame(ja,Q,ea,ha);l.pointToLocalFrame(ja,Q,ia,ia);Q=ia.dot(ha);ja=ea=aa[0].dot(ha);for(var pa=1;ca>pa;pa++){var ka=aa[pa].dot(ha);ka>ea&&(ea=ka);ja>ka&&(ja=ka)}if(ja-=Q,ea-=Q,ja>ea)ca=ja,ja=ea,ea=ca;X[0]=ea;X[1]=ja}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(h,k){function e(t,r,y,z){var E=[],B=[],F=[],I=[],L=[],U=Math.cos,
n=Math.sin;E.push(new q(r*U(0),r*n(0),.5*-y));I.push(0);E.push(new q(t*U(0),t*n(0),.5*y));L.push(1);for(var w=0;z>w;w++){var G=2*Math.PI/z*(w+1),f=2*Math.PI/z*(w+.5);z-1>w?(E.push(new q(r*U(G),r*n(G),.5*-y)),I.push(2*w+2),E.push(new q(t*U(G),t*n(G),.5*y)),L.push(2*w+3),F.push([2*w+2,2*w+3,2*w+1,2*w])):F.push([0,1,2*w+1,2*w]);(1===z%2||z/2>w)&&B.push(new q(U(f),n(f),0))}F.push(L);B.push(new q(0,0,1));t=[];for(w=0;w<I.length;w++)t.push(I[I.length-w-1]);F.push(t);this.type=p.types.CONVEXPOLYHEDRON;l.call(this,
E,F,B)}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3"),l=(h("../math/Quaternion"),h("./ConvexPolyhedron"));e.prototype=new l},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(h,k){function e(r,y){y=t.defaults(y,{maxValue:null,minValue:null,elementSize:1});this.data=r;this.maxValue=y.maxValue;this.minValue=y.minValue;this.elementSize=y.elementSize;null===y.minValue&&this.updateMinValue();null===y.maxValue&&this.updateMaxValue();this.cacheEnabled=!0;
p.call(this);this.pillarConvex=new q;this.pillarOffset=new l;this.type=p.types.HEIGHTFIELD;this.updateBoundingSphereRadius();this._cachedPillars={}}var p=h("./Shape"),q=h("./ConvexPolyhedron"),l=h("../math/Vec3"),t=h("../utils/Utils");k.exports=e;e.prototype=new p;e.prototype.update=function(){this._cachedPillars={}};e.prototype.updateMinValue=function(){for(var r=this.data,y=r[0][0],z=0;z!==r.length;z++)for(var E=0;E!==r[z].length;E++){var B=r[z][E];y>B&&(y=B)}this.minValue=y};e.prototype.updateMaxValue=
function(){for(var r=this.data,y=r[0][0],z=0;z!==r.length;z++)for(var E=0;E!==r[z].length;E++){var B=r[z][E];B>y&&(y=B)}this.maxValue=y};e.prototype.setHeightValueAtIndex=function(r,y,z){this.data[r][y]=z;this.clearCachedConvexTrianglePillar(r,y,!1);0<r&&(this.clearCachedConvexTrianglePillar(r-1,y,!0),this.clearCachedConvexTrianglePillar(r-1,y,!1));0<y&&(this.clearCachedConvexTrianglePillar(r,y-1,!0),this.clearCachedConvexTrianglePillar(r,y-1,!1));0<y&&0<r&&this.clearCachedConvexTrianglePillar(r-
1,y-1,!0)};e.prototype.getRectMinMax=function(r,y,z,E,B){B=B||[];for(var F=this.data,I=this.minValue;z>=r;r++)for(var L=y;E>=L;L++){var U=F[r][L];U>I&&(I=U)}B[0]=this.minValue;B[1]=I};e.prototype.getIndexOfPosition=function(r,y,z,E){var B=this.elementSize,F=this.data;r=Math.floor(r/B);y=Math.floor(y/B);return z[0]=r,z[1]=y,E&&(0>r&&(r=0),0>y&&(y=0),r>=F.length-1&&(r=F.length-1),y>=F[0].length-1&&(y=F[0].length-1)),0>r||0>y||r>=F.length-1||y>=F[0].length-1?!1:!0};e.prototype.getHeightAt=function(r,
y,z){var E=[];this.getIndexOfPosition(r,y,E,z);r=[];return this.getRectMinMax(E[0],E[1]+1,E[0],E[1]+1,r),(r[0]+r[1])/2};e.prototype.getCacheConvexTrianglePillarKey=function(r,y,z){return r+"_"+y+"_"+(z?1:0)};e.prototype.getCachedConvexTrianglePillar=function(r,y,z){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(r,y,z)]};e.prototype.setCachedConvexTrianglePillar=function(r,y,z,E,B){this._cachedPillars[this.getCacheConvexTrianglePillarKey(r,y,z)]={convex:E,offset:B}};e.prototype.clearCachedConvexTrianglePillar=
function(r,y,z){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(r,y,z)]};e.prototype.getConvexTrianglePillar=function(r,y,z){var E=this.pillarConvex,B=this.pillarOffset;if(this.cacheEnabled){var F=this.getCachedConvexTrianglePillar(r,y,z);if(F)return this.pillarConvex=F.convex,void(this.pillarOffset=F.offset);E=new q;B=new l;this.pillarConvex=E;this.pillarOffset=B}F=this.data;var I=this.elementSize,L=E.faces;E.vertices.length=6;for(var U=0;6>U;U++)E.vertices[U]||(E.vertices[U]=new l);
L.length=5;for(U=0;5>U;U++)L[U]||(L[U]=[]);U=E.vertices;var n=(Math.min(F[r][y],F[r+1][y],F[r][y+1],F[r+1][y+1])-this.minValue)/2+this.minValue;z?(B.set((r+.75)*I,(y+.75)*I,n),U[0].set(.25*I,.25*I,F[r+1][y+1]-n),U[1].set(-.75*I,.25*I,F[r][y+1]-n),U[2].set(.25*I,-.75*I,F[r+1][y]-n),U[3].set(.25*I,.25*I,-n-1),U[4].set(-.75*I,.25*I,-n-1),U[5].set(.25*I,-.75*I,-n-1),L[0][0]=0,L[0][1]=1,L[0][2]=2,L[1][0]=5,L[1][1]=4,L[1][2]=3,L[2][0]=2,L[2][1]=5,L[2][2]=3,L[2][3]=0,L[3][0]=3,L[3][1]=4,L[3][2]=1,L[3][3]=
0,L[4][0]=1,L[4][1]=4,L[4][2]=5,L[4][3]=2):(B.set((r+.25)*I,(y+.25)*I,n),U[0].set(-.25*I,-.25*I,F[r][y]-n),U[1].set(.75*I,-.25*I,F[r+1][y]-n),U[2].set(-.25*I,.75*I,F[r][y+1]-n),U[3].set(-.25*I,-.25*I,-n-1),U[4].set(.75*I,-.25*I,-n-1),U[5].set(-.25*I,.75*I,-n-1),L[0][0]=0,L[0][1]=1,L[0][2]=2,L[1][0]=5,L[1][1]=4,L[1][2]=3,L[2][0]=0,L[2][1]=2,L[2][2]=5,L[2][3]=3,L[3][0]=1,L[3][1]=0,L[3][2]=3,L[3][3]=4,L[4][0]=4,L[4][1]=5,L[4][2]=2,L[4][3]=1);E.computeNormals();E.computeEdges();E.updateBoundingSphereRadius();
this.setCachedConvexTrianglePillar(r,y,z,E,B)};e.prototype.calculateLocalInertia=function(r,y){return y=y||new l,y.set(0,0,0),y};e.prototype.volume=function(){return Number.MAX_VALUE};e.prototype.calculateWorldAABB=function(r,y,z,E){z.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);E.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.prototype.updateBoundingSphereRadius=function(){var r=this.data,y=this.elementSize;this.boundingSphereRadius=(new l(r.length*y,r[0].length*y,Math.max(Math.abs(this.maxValue),
Math.abs(this.minValue)))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(h,k){function e(){p.call(this);this.type=p.types.PARTICLE}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3");e.prototype=new p;e.prototype.constructor=e;e.prototype.calculateLocalInertia=function(l,t){return t=t||new q,t.set(0,0,0),t};e.prototype.volume=function(){return 0};e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0};e.prototype.calculateWorldAABB=
function(l,t,r,y){r.copy(l);y.copy(l)}},{"../math/Vec3":30,"./Shape":43}],42:[function(h,k){function e(){p.call(this);this.type=p.types.PLANE;this.worldNormal=new q;this.worldNormalNeedsUpdate=!0;this.boundingSphereRadius=Number.MAX_VALUE}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3");e.prototype=new p;e.prototype.constructor=e;e.prototype.computeWorldNormal=function(t){var r=this.worldNormal;r.set(0,0,1);t.vmult(r,r);this.worldNormalNeedsUpdate=!1};e.prototype.calculateLocalInertia=function(t,
r){return r||new q};e.prototype.volume=function(){return Number.MAX_VALUE};var l=new q;e.prototype.calculateWorldAABB=function(t,r,y,z){l.set(0,0,1);r.vmult(l,l);r=Number.MAX_VALUE;y.set(-r,-r,-r);z.set(r,r,r);1===l.x&&(z.x=t.x);1===l.y&&(z.y=t.y);1===l.z&&(z.z=t.z);-1===l.x&&(y.x=t.x);-1===l.y&&(y.y=t.y);-1===l.z&&(y.z=t.z)};e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(h,k){function e(){this.id=e.idCounter++;
this.boundingSphereRadius=this.type=0;this.collisionResponse=!0;this.material=null}k.exports=e;e=h("./Shape");h("../math/Vec3");h("../math/Quaternion");h("../material/Material");e.prototype.constructor=e;e.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type;};e.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type;};e.prototype.calculateLocalInertia=function(){throw"calculateLocalInertia() not implemented for shape type "+
this.type;};e.idCounter=0;e.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(h,k){function e(l){if(p.call(this),this.radius=void 0!==l?Number(l):1,this.type=p.types.SPHERE,0>this.radius)throw Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3");e.prototype=new p;
e.prototype.constructor=e;e.prototype.calculateLocalInertia=function(l,t){t=t||new q;l=2*l*this.radius*this.radius/5;return t.x=l,t.y=l,t.z=l,t};e.prototype.volume=function(){return 4*Math.PI*this.radius/3};e.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius};e.prototype.calculateWorldAABB=function(l,t,r,y){t=this.radius;for(var z=["x","y","z"],E=0;E<z.length;E++){var B=z[E];r[B]=l[B]-t;y[B]=l[B]+t}}},{"../math/Vec3":30,"./Shape":43}],45:[function(h,k){function e(v,
D){p.call(this);this.type=p.types.TRIMESH;this.vertices=new Float32Array(v);this.indices=new Int16Array(D);this.normals=new Float32Array(D.length);this.aabb=new t;this.edges=null;this.scale=new q(1,1,1);this.tree=new r;this.updateEdges();this.updateNormals();this.updateAABB();this.updateBoundingSphereRadius();this.updateTree()}k.exports=e;var p=h("./Shape"),q=h("../math/Vec3"),l=(h("../math/Quaternion"),h("../math/Transform")),t=h("../collision/AABB"),r=h("../utils/Octree");e.prototype=new p;e.prototype.constructor=
e;var y=new q;e.prototype.updateTree=function(){var v=this.tree;v.reset();v.aabb.copy(this.aabb);var D=this.scale;v.aabb.lowerBound.x*=1/D.x;v.aabb.lowerBound.y*=1/D.y;v.aabb.lowerBound.z*=1/D.z;v.aabb.upperBound.x*=1/D.x;v.aabb.upperBound.y*=1/D.y;v.aabb.upperBound.z*=1/D.z;D=new t;for(var C=new q,J=new q,N=new q,S=[C,J,N],T=0;T<this.indices.length/3;T++){var W=3*T;this._getUnscaledVertex(this.indices[W],C);this._getUnscaledVertex(this.indices[W+1],J);this._getUnscaledVertex(this.indices[W+2],N);
D.setFromPoints(S);v.insert(D,T)}v.removeEmptyNodes()};var z=new t;e.prototype.getTrianglesInAABB=function(v,D){z.copy(v);var C=this.scale;v=C.x;var J=C.y;C=C.z;var N=z.lowerBound,S=z.upperBound;return N.x/=v,N.y/=J,N.z/=C,S.x/=v,S.y/=J,S.z/=C,this.tree.aabbQuery(z,D)};e.prototype.setScale=function(v){var D=v.x===v.y===v.z;this.scale.x===this.scale.y===this.scale.z&&D||this.updateNormals();this.scale.copy(v);this.updateAABB();this.updateBoundingSphereRadius()};e.prototype.updateNormals=function(){for(var v=
this.normals,D=0;D<this.indices.length/3;D++){var C=3*D,J=this.indices[C+1],N=this.indices[C+2];this.getVertex(this.indices[C],L);this.getVertex(J,U);this.getVertex(N,n);e.computeNormal(U,L,n,y);v[C]=y.x;v[C+1]=y.y;v[C+2]=y.z}};e.prototype.updateEdges=function(){for(var v={},D=function(){v[S>N?N+"_"+S:S+"_"+N]=!0},C=0;C<this.indices.length/3;C++){var J=3*C,N=this.indices[J],S=this.indices[J+1];J=this.indices[J+2];D(N,S);D(S,J);D(J,N)}D=Object.keys(v);this.edges=new Int16Array(2*D.length);for(C=0;C<
D.length;C++)J=D[C].split("_"),this.edges[2*C]=parseInt(J[0],10),this.edges[2*C+1]=parseInt(J[1],10)};e.prototype.getEdgeVertex=function(v,D,C){this.getVertex(this.edges[2*v+(D?1:0)],C)};var E=new q,B=new q;e.prototype.getEdgeVector=function(v,D){this.getEdgeVertex(v,0,E);this.getEdgeVertex(v,1,B);B.vsub(E,D)};var F=new q,I=new q;e.computeNormal=function(v,D,C,J){D.vsub(v,I);C.vsub(D,F);F.cross(I,J);J.isZero()||J.normalize()};var L=new q,U=new q,n=new q;e.prototype.getVertex=function(v,D){var C=this.scale;
return this._getUnscaledVertex(v,D),D.x*=C.x,D.y*=C.y,D.z*=C.z,D};e.prototype._getUnscaledVertex=function(v,D){v*=3;var C=this.vertices;return D.set(C[v],C[v+1],C[v+2])};e.prototype.getWorldVertex=function(v,D,C,J){return this.getVertex(v,J),l.pointToWorldFrame(D,C,J,J),J};e.prototype.getTriangleVertices=function(v,D,C,J){v*=3;this.getVertex(this.indices[v],D);this.getVertex(this.indices[v+1],C);this.getVertex(this.indices[v+2],J)};e.prototype.getNormal=function(v,D){v*=3;return D.set(this.normals[v],
this.normals[v+1],this.normals[v+2])};var w=new t;e.prototype.calculateLocalInertia=function(v,D){this.computeLocalAABB(w);var C=w.upperBound.x-w.lowerBound.x,J=w.upperBound.y-w.lowerBound.y,N=w.upperBound.z-w.lowerBound.z;return D.set(1/12*v*(4*J*J+4*N*N),1/12*v*(4*C*C+4*N*N),1/12*v*(4*J*J+4*C*C))};var G=new q;e.prototype.computeLocalAABB=function(v){var D=v.lowerBound;v=v.upperBound;var C=this.vertices.length,J=(this.vertices,G);this.getVertex(0,J);D.copy(J);v.copy(J);for(var N=0;N!==C;N++)this.getVertex(N,
J),J.x<D.x?D.x=J.x:J.x>v.x&&(v.x=J.x),J.y<D.y?D.y=J.y:J.y>v.y&&(v.y=J.y),J.z<D.z?D.z=J.z:J.z>v.z&&(v.z=J.z)};e.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)};e.prototype.updateBoundingSphereRadius=function(){var v=0,D=this.vertices,C=new q,J=0;for(D=D.length/3;J!==D;J++){this.getVertex(J,C);var N=C.norm2();N>v&&(v=N)}this.boundingSphereRadius=Math.sqrt(v)};var f=(new q,new l),m=new t;e.prototype.calculateWorldAABB=function(v,D,C,J){f.position=v;f.quaternion=D;this.aabb.toWorldFrame(f,
m);C.copy(m.lowerBound);J.copy(m.upperBound)};e.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3};e.createTorus=function(v,D,C,J,N){v=v||1;D=D||.5;C=C||8;J=J||6;N=N||2*Math.PI;for(var S=[],T=[],W=0;C>=W;W++)for(var Y=0;J>=Y;Y++){var V=Y/J*N,ma=W/C*Math.PI*2;S.push((v+D*Math.cos(ma))*Math.cos(V),(v+D*Math.cos(ma))*Math.sin(V),D*Math.sin(ma))}for(W=1;C>=W;W++)for(Y=1;J>=Y;Y++)v=(J+1)*(W-1)+Y-1,D=(J+1)*(W-1)+Y,N=(J+1)*W+Y,T.push((J+1)*W+Y-1,v,N),T.push(v,D,N);return new e(S,T)}},
{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(h,k){function e(){p.call(this);this.iterations=10;this.tolerance=1E-7}k.exports=e;var p=(h("../math/Vec3"),h("../math/Quaternion"),h("./Solver"));e.prototype=new p;var q=[],l=[],t=[];e.prototype.solve=function(r,y){var z,E=0,B=this.iterations,F=this.tolerance*this.tolerance,I=this.equations,L=I.length;y=y.bodies;var U=y.length;if(0!==L)for(z=0;z!==U;z++)y[z].updateSolveMassProperties();
l.length=L;t.length=L;q.length=L;for(z=0;z!==L;z++){var n=I[z];q[z]=0;t[z]=n.computeB(r);l[z]=1/n.computeC()}if(0!==L){for(z=0;z!==U;z++)n=y[z],E=n.wlambda,n.vlambda.set(0,0,0),E&&E.set(0,0,0);for(E=0;E!==B;E++){for(var w=z=0;w!==L;w++){n=I[w];var G=t[w];var f=l[w];r=q[w];var m=n.computeGWlambda();G=f*(G-m-n.eps*r);r+G<n.minForce?G=n.minForce-r:r+G>n.maxForce&&(G=n.maxForce-r);q[w]+=G;z+=0<G?G:-G;n.addToWlambda(G)}if(F>z*z)break}for(z=0;z!==U;z++)n=y[z],B=n.velocity,F=n.angularVelocity,B.vadd(n.vlambda,
B),F&&F.vadd(n.wlambda,F)}return E}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(h,k){function e(){this.equations=[]}k.exports=e;e.prototype.solve=function(){return 0};e.prototype.addEquation=function(p){p.enabled&&this.equations.push(p)};e.prototype.removeEquation=function(p){var q=this.equations;p=q.indexOf(p);-1!==p&&q.splice(p,1)};e.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(h,k){function e(F){t.call(this);this.iterations=10;
this.tolerance=1E-7;this.subsolver=F;this.nodes=[];for(this.nodePool=[];128>this.nodePool.length;)this.nodePool.push(this.createNode())}function p(F){for(var I=F.length,L=0;L!==I;L++){var U=F[L];if(!(U.visited||U.body.type&E))return U}return!1}function q(F,I,L){I.push(F.body);I=F.eqs.length;for(var U=0;U!==I;U++){var n=F.eqs[U];-1===L.indexOf(n)&&L.push(n)}}function l(F,I){return I.id-F.id}k.exports=e;var t=(h("../math/Vec3"),h("../math/Quaternion"),h("./Solver"));h=h("../objects/Body");e.prototype=
new t;var r=[],y=[],z={bodies:[]},E=h.STATIC,B=[];e.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}};e.prototype.solve=function(F,I){var L=this.nodePool,U=I.bodies,n=this.equations,w=n.length,G=U.length;for(I=this.subsolver;L.length<G;)L.push(this.createNode());r.length=G;for(var f=0;G>f;f++)r[f]=L[f];for(f=0;f!==G;f++)L=r[f],L.body=U[f],L.children.length=0,L.eqs.length=0,L.visited=!1;for(L=0;L!==w;L++){G=n[L];f=U.indexOf(G.bi);var m=U.indexOf(G.bj);f=r[f];m=r[m];f.children.push(m);
f.eqs.push(G);m.children.push(f);m.eqs.push(G)}U=0;n=y;I.tolerance=this.tolerance;for(I.iterations=this.iterations;f=p(r);){n.length=0;z.bodies.length=0;G=f;f=q;w=z.bodies;L=n;B.push(G);G.visited=!0;for(f(G,w,L);B.length;)for(m=B.pop();G=p(m.children);)G.visited=!0,f(G,w,L),B.push(G);w=n.length;n=n.sort(l);for(f=0;f!==w;f++)I.addEquation(n[f]);I.solve(F,z);I.removeAllEquations();U++}return U}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(h,k){h=function(){};
k.exports=h;h.prototype={constructor:h,addEventListener:function(e,p){void 0===this._listeners&&(this._listeners={});var q=this._listeners;return void 0===q[e]&&(q[e]=[]),-1===q[e].indexOf(p)&&q[e].push(p),this},hasEventListener:function(e,p){if(void 0===this._listeners)return!1;var q=this._listeners;return void 0!==q[e]&&-1!==q[e].indexOf(p)?!0:!1},removeEventListener:function(e,p){if(void 0===this._listeners)return this;var q=this._listeners;if(void 0===q[e])return this;p=q[e].indexOf(p);return-1!==
p&&q[e].splice(p,1),this},dispatchEvent:function(e){if(void 0===this._listeners)return this;var p=this._listeners[e.type];if(void 0!==p){e.target=this;for(var q=0,l=p.length;l>q;q++)p[q].call(this,e)}return this}}},{}],50:[function(h,k){function e(y){y=y||{};this.root=y.root||null;this.aabb=y.aabb?y.aabb.clone():new q;this.data=[];this.children=[]}function p(y,z){z=z||{};z.root=null;z.aabb=y;e.call(this,z);this.maxDepth="undefined"!=typeof z.maxDepth?z.maxDepth:8}var q=h("../collision/AABB"),l=h("../math/Vec3");
k.exports=p;p.prototype=new e;e.prototype.reset=function(){this.children.length=this.data.length=0};e.prototype.insert=function(y,z,E){var B=this.data;if(E=E||0,!this.aabb.contains(y))return!1;var F=this.children;if(E<(this.maxDepth||this.root.maxDepth)){var I=!1;F.length||(this.subdivide(),I=!0);for(var L=0;8!==L;L++)if(F[L].insert(y,z,E+1))return!0;I&&(F.length=0)}return B.push(z),!0};var t=new l;e.prototype.subdivide=function(){var y=this.aabb,z=y.lowerBound,E=y.upperBound;y=this.children;y.push(new e({aabb:new q({lowerBound:new l(0,
0,0)})}),new e({aabb:new q({lowerBound:new l(1,0,0)})}),new e({aabb:new q({lowerBound:new l(1,1,0)})}),new e({aabb:new q({lowerBound:new l(1,1,1)})}),new e({aabb:new q({lowerBound:new l(0,1,1)})}),new e({aabb:new q({lowerBound:new l(0,0,1)})}),new e({aabb:new q({lowerBound:new l(1,0,1)})}),new e({aabb:new q({lowerBound:new l(0,1,0)})}));E.vsub(z,t);t.scale(.5,t);E=this.root||this;for(var B=0;8!==B;B++){var F=y[B];F.root=E;var I=F.aabb.lowerBound;I.x*=t.x;I.y*=t.y;I.z*=t.z;I.vadd(z,I);I.vadd(t,F.aabb.upperBound)}};
e.prototype.aabbQuery=function(y,z){for(var E=(this.data,this.children,[this]);E.length;){var B=E.pop();B.aabb.overlaps(y)&&Array.prototype.push.apply(z,B.data);Array.prototype.push.apply(E,B.children)}return z};var r=new q;e.prototype.rayQuery=function(y,z,E){return y.getAABB(r),r.toLocalFrame(z,r),this.aabbQuery(r,E),E};e.prototype.removeEmptyNodes=function(){for(var y=[this];y.length;){for(var z=y.pop(),E=z.children.length-1;0<=E;E--)z.children[E].data.length||z.children.splice(E,1);Array.prototype.push.apply(y,
z.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(h,k){function e(){this.objects=[];this.type=Object}k.exports=e;e.prototype.release=function(){for(var p=arguments.length,q=0;q!==p;q++)this.objects.push(arguments[q])};e.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()};e.prototype.constructObject=function(){throw Error("constructObject() not implemented in this Pool subclass yet!");}},{}],52:[function(h,k){function e(){this.data=
{keys:[]}}k.exports=e;e.prototype.get=function(p,q){if(p>q){var l=q;q=p;p=l}return this.data[p+"-"+q]};e.prototype.set=function(p,q,l){if(p>q){var t=q;q=p;p=t}t=p+"-"+q;this.get(p,q)||this.data.keys.push(t);this.data[t]=l};e.prototype.reset=function(){for(var p=this.data,q=p.keys;0<q.length;){var l=q.pop();delete p[l]}}},{}],53:[function(h,k){function e(){}k.exports=e;e.defaults=function(p,q){p=p||{};for(var l in q)l in p||(p[l]=q[l]);return p}},{}],54:[function(h,k){function e(){q.call(this);this.type=
p}k.exports=e;var p=h("../math/Vec3"),q=h("./Pool");e.prototype=new q;e.prototype.constructObject=function(){return new p}},{"../math/Vec3":30,"./Pool":51}],55:[function(h,k){function e(ua){this.contactPointPool=[];this.frictionEquationPool=[];this.result=[];this.frictionResult=[];this.v3pool=new y;this.world=ua;this.currentContactMaterial=null;this.enableFrictionReduction=!1}k.exports=e;k=h("../collision/AABB");var p=h("../shapes/Shape"),q=h("../collision/Ray"),l=h("../math/Vec3"),t=h("../math/Transform"),
r=(h("../shapes/ConvexPolyhedron"),h("../math/Quaternion")),y=(h("../solver/Solver"),h("../utils/Vec3Pool")),z=h("../equations/ContactEquation"),E=h("../equations/FrictionEquation");e.prototype.createContactEquation=function(ua,Da,Ka,Oa,Ha,La){var Va;this.contactPointPool.length?(Va=this.contactPointPool.pop(),Va.bi=ua,Va.bj=Da):Va=new z(ua,Da);Va.enabled=ua.collisionResponse&&Da.collisionResponse&&Ka.collisionResponse&&Oa.collisionResponse;var cb=this.currentContactMaterial;Va.restitution=cb.restitution;
Va.setSpookParams(cb.contactEquationStiffness,cb.contactEquationRelaxation,this.world.dt);ua=Ka.material||ua.material;Da=Oa.material||Da.material;return ua&&Da&&0<=ua.restitution&&0<=Da.restitution&&(Va.restitution=ua.restitution*Da.restitution),Va.si=Ha||Ka,Va.sj=La||Oa,Va};e.prototype.createFrictionEquationsFromContact=function(ua,Da){var Ka=ua.bi,Oa=ua.bj,Ha=this.world,La=this.currentContactMaterial,Va=La.friction,cb=ua.si.material||Ka.material,$a=ua.sj.material||Oa.material;if(cb&&$a&&0<=cb.friction&&
0<=$a.friction&&(Va=cb.friction*$a.friction),0<Va){Va*=Ha.gravity.length();cb=Ka.invMass+Oa.invMass;0<cb&&(cb=1/cb);var Ra=this.frictionEquationPool;$a=Ra.length?Ra.pop():new E(Ka,Oa,Va*cb);Ra=Ra.length?Ra.pop():new E(Ka,Oa,Va*cb);return $a.bi=Ra.bi=Ka,$a.bj=Ra.bj=Oa,$a.minForce=Ra.minForce=-Va*cb,$a.maxForce=Ra.maxForce=Va*cb,$a.ri.copy(ua.ri),$a.rj.copy(ua.rj),Ra.ri.copy(ua.ri),Ra.rj.copy(ua.rj),ua.ni.tangents($a.t,Ra.t),$a.setSpookParams(La.frictionEquationStiffness,La.frictionEquationRelaxation,
Ha.dt),Ra.setSpookParams(La.frictionEquationStiffness,La.frictionEquationRelaxation,Ha.dt),$a.enabled=Ra.enabled=ua.enabled,Da.push($a,Ra),!0}return!1};var B=new l,F=new l,I=new l;e.prototype.createFrictionFromAverage=function(ua){var Da=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(Da,this.frictionResult)&&1!==ua){var Ka=this.frictionResult[this.frictionResult.length-2],Oa=this.frictionResult[this.frictionResult.length-1];B.setZero();F.setZero();I.setZero();for(var Ha=
Da.bi,La=(Da.bj,0);La!==ua;La++)Da=this.result[this.result.length-1-La],Da.bodyA!==Ha?(B.vadd(Da.ni,B),F.vadd(Da.ri,F),I.vadd(Da.rj,I)):(B.vsub(Da.ni,B),F.vadd(Da.rj,F),I.vadd(Da.ri,I));ua=1/ua;F.scale(ua,Ka.ri);I.scale(ua,Ka.rj);Oa.ri.copy(Ka.ri);Oa.rj.copy(Ka.rj);B.normalize();B.tangents(Ka.t,Oa.t)}};var L=new l,U=new l,n=new r,w=new r;e.prototype.getContacts=function(ua,Da,Ka,Oa,Ha,La,Va){this.contactPointPool=Ha;this.frictionEquationPool=Va;this.result=Oa;this.frictionResult=La;Oa=0;for(Ha=ua.length;Oa!==
Ha;Oa++){La=ua[Oa];Va=Da[Oa];var cb=null;La.material&&Va.material&&(cb=Ka.getContactMaterial(La.material,Va.material)||null);for(var $a=0;$a<La.shapes.length;$a++){La.quaternion.mult(La.shapeOrientations[$a],n);La.quaternion.vmult(La.shapeOffsets[$a],L);L.vadd(La.position,L);for(var Ra=La.shapes[$a],Ea=0;Ea<Va.shapes.length;Ea++){Va.quaternion.mult(Va.shapeOrientations[Ea],w);Va.quaternion.vmult(Va.shapeOffsets[Ea],U);U.vadd(Va.position,U);var fb=Va.shapes[Ea];if(!(L.distanceTo(U)>Ra.boundingSphereRadius+
fb.boundingSphereRadius)){var ab=null;Ra.material&&fb.material&&(ab=Ka.getContactMaterial(Ra.material,fb.material)||null);this.currentContactMaterial=ab||cb||Ka.defaultContactMaterial;(ab=this[Ra.type|fb.type])&&(Ra.type<fb.type?ab.call(this,Ra,fb,L,U,n,w,La,Va,Ra,fb):ab.call(this,fb,Ra,U,L,w,n,Va,La,Ra,fb))}}}}};e.prototype[p.types.BOX|p.types.BOX]=e.prototype.boxBox=function(ua,Da,Ka,Oa,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;Da.convexPolyhedronRepresentation.material=
Da.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;Da.convexPolyhedronRepresentation.collisionResponse=Da.collisionResponse;this.convexConvex(ua.convexPolyhedronRepresentation,Da.convexPolyhedronRepresentation,Ka,Oa,Ha,La,Va,cb,ua,Da)};e.prototype[p.types.BOX|p.types.CONVEXPOLYHEDRON]=e.prototype.boxConvex=function(ua,Da,Ka,Oa,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;
this.convexConvex(ua.convexPolyhedronRepresentation,Da,Ka,Oa,Ha,La,Va,cb,ua,Da)};e.prototype[p.types.BOX|p.types.PARTICLE]=e.prototype.boxParticle=function(ua,Da,Ka,Oa,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;this.convexParticle(ua.convexPolyhedronRepresentation,Da,Ka,Oa,Ha,La,Va,cb,ua,Da)};e.prototype[p.types.SPHERE]=e.prototype.sphereSphere=function(ua,Da,Ka,Oa,Ha,La,Va,cb){Ha=this.createContactEquation(Va,
cb,ua,Da);Oa.vsub(Ka,Ha.ni);Ha.ni.normalize();Ha.ri.copy(Ha.ni);Ha.rj.copy(Ha.ni);Ha.ri.mult(ua.radius,Ha.ri);Ha.rj.mult(-Da.radius,Ha.rj);Ha.ri.vadd(Ka,Ha.ri);Ha.ri.vsub(Va.position,Ha.ri);Ha.rj.vadd(Oa,Ha.rj);Ha.rj.vsub(cb.position,Ha.rj);this.result.push(Ha);this.createFrictionEquationsFromContact(Ha,this.frictionResult)};var G=new l,f=new l,m=new l;e.prototype[p.types.PLANE|p.types.TRIMESH]=e.prototype.planeTrimesh=function(ua,Da,Ka,Oa,Ha,La,Va,cb){var $a=new l;G.set(0,0,1);Ha.vmult(G,G);for(Ha=
0;Ha<Da.vertices.length/3;Ha++){Da.getVertex(Ha,$a);var Ra=new l;Ra.copy($a);t.pointToWorldFrame(Oa,La,Ra,$a);Ra=f;$a.vsub(Ka,Ra);if(0>=G.dot(Ra)){var Ea=this.createContactEquation(Va,cb,ua,Da);Ea.ni.copy(G);var fb=m;G.scale(Ra.dot(G),fb);$a.vsub(fb,fb);Ea.ri.copy(fb);Ea.ri.vsub(Va.position,Ea.ri);Ea.rj.copy($a);Ea.rj.vsub(cb.position,Ea.rj);this.result.push(Ea);this.createFrictionEquationsFromContact(Ea,this.frictionResult)}}};var v=new l,D=new l,C=(new l,new l),J=new l,N=new l,S=new l,T=new l,W=
new l,Y=new l,V=new l,ma=new l,ha=new l,ia=new l,aa=new k,ea=[];e.prototype[p.types.SPHERE|p.types.TRIMESH]=e.prototype.sphereTrimesh=function(ua,Da,Ka,Oa,Ha,La,Va,cb){t.pointToLocalFrame(Oa,La,Ka,Y);Ha=ua.radius;aa.lowerBound.set(Y.x-Ha,Y.y-Ha,Y.z-Ha);aa.upperBound.set(Y.x+Ha,Y.y+Ha,Y.z+Ha);Da.getTrianglesInAABB(aa,ea);var $a=ua.radius*ua.radius;for(Ha=0;Ha<ea.length;Ha++)for(var Ra=0;3>Ra;Ra++)if(Da.getVertex(Da.indices[3*ea[Ha]+Ra],C),C.vsub(Y,D),D.norm2()<=$a){J.copy(C);t.pointToWorldFrame(Oa,
La,J,C);C.vsub(Ka,D);var Ea=this.createContactEquation(Va,cb,ua,Da);Ea.ni.copy(D);Ea.ni.normalize();Ea.ri.copy(Ea.ni);Ea.ri.scale(ua.radius,Ea.ri);Ea.ri.vadd(Ka,Ea.ri);Ea.ri.vsub(Va.position,Ea.ri);Ea.rj.copy(C);Ea.rj.vsub(cb.position,Ea.rj);this.result.push(Ea);this.createFrictionEquationsFromContact(Ea,this.frictionResult)}for(Ha=0;Ha<ea.length;Ha++)for(Ra=0;3>Ra;Ra++)Da.getVertex(Da.indices[3*ea[Ha]+Ra],N),Da.getVertex(Da.indices[3*ea[Ha]+(Ra+1)%3],S),S.vsub(N,T),Y.vsub(S,V),Ka=V.dot(T),Y.vsub(N,
V),Ea=V.dot(T),0<Ea&&0>Ka&&(Y.vsub(N,V),W.copy(T),W.normalize(),Ea=V.dot(W),W.scale(Ea,V),V.vadd(N,V),Ka=V.distanceTo(Y),Ka<ua.radius&&(Ea=this.createContactEquation(Va,cb,ua,Da),V.vsub(Y,Ea.ni),Ea.ni.normalize(),Ea.ni.scale(ua.radius,Ea.ri),t.pointToWorldFrame(Oa,La,V,V),V.vsub(cb.position,Ea.rj),t.vectorToWorldFrame(La,Ea.ni,Ea.ni),t.vectorToWorldFrame(La,Ea.ri,Ea.ri),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult)));Ha=0;for(Ra=ea.length;Ha!==Ra;Ha++)if(Da.getTriangleVertices(ea[Ha],
ma,ha,ia),Da.getNormal(ea[Ha],v),Y.vsub(ma,V),Ka=V.dot(v),v.scale(Ka,V),Y.vsub(V,V),Ka=V.distanceTo(Y),q.pointInTriangle(V,ma,ha,ia)&&Ka<ua.radius)Ea=this.createContactEquation(Va,cb,ua,Da),V.vsub(Y,Ea.ni),Ea.ni.normalize(),Ea.ni.scale(ua.radius,Ea.ri),t.pointToWorldFrame(Oa,La,V,V),V.vsub(cb.position,Ea.rj),t.vectorToWorldFrame(La,Ea.ni,Ea.ni),t.vectorToWorldFrame(La,Ea.ri,Ea.ri),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult);ea.length=0};var ja=new l,Q=new l;
e.prototype[p.types.SPHERE|p.types.PLANE]=e.prototype.spherePlane=function(ua,Da,Ka,Oa,Ha,La,Va,cb){Da=this.createContactEquation(Va,cb,ua,Da);if(Da.ni.set(0,0,1),La.vmult(Da.ni,Da.ni),Da.ni.negate(Da.ni),Da.ni.normalize(),Da.ni.mult(ua.radius,Da.ri),Ka.vsub(Oa,ja),Da.ni.mult(Da.ni.dot(ja),Q),ja.vsub(Q,Da.rj),-ja.dot(Da.ni)<=ua.radius)ua=Da.ri,La=Da.rj,ua.vadd(Ka,ua),ua.vsub(Va.position,ua),La.vadd(Oa,La),La.vsub(cb.position,La),this.result.push(Da),this.createFrictionEquationsFromContact(Da,this.frictionResult)};
var X=new l,ca=new l,pa=new l,ka=new l,va=new l,Aa=new l,xa=new l,Ia=[new l,new l,new l,new l,new l,new l],Za=new l,kb=new l,Hb=new l,vb=new l;e.prototype[p.types.SPHERE|p.types.BOX]=e.prototype.sphereBox=function(ua,Da,Ka,Oa,Ha,La,Va,cb){Ha=this.v3pool;Ka.vsub(Oa,ka);Da.getSideNormals(Ia,La);La=ua.radius;for(var $a=!1,Ra=null,Ea=0,fb=0,ab=0,Bb=null,Fb=0,Qb=Ia.length;Fb!==Qb&&!1===$a;Fb++){var Ob=va;Ob.copy(Ia[Fb]);var Rb=Ob.norm();Ob.normalize();var jb=ka.dot(Ob);if(Rb+La>jb&&0<jb){var Wb=Aa,cc=
xa;Wb.copy(Ia[(Fb+1)%3]);cc.copy(Ia[(Fb+2)%3]);var dc=Wb.norm(),Hc=cc.norm();Wb.normalize();cc.normalize();var mc=ka.dot(Wb),Dc=ka.dot(cc);dc>mc&&mc>-dc&&Hc>Dc&&Dc>-Hc&&(jb=Math.abs(jb-Rb-La),(null===Bb||Bb>jb)&&(Bb=jb,fb=mc,ab=Dc,Ra=Rb,kb.copy(Ob),Hb.copy(Wb),vb.copy(cc),Ea++))}}Ea&&($a=!0,Ea=this.createContactEquation(Va,cb,ua,Da),kb.mult(-La,Ea.ri),Ea.ni.copy(kb),Ea.ni.negate(Ea.ni),kb.mult(Ra,kb),Hb.mult(fb,Hb),kb.vadd(Hb,kb),vb.mult(ab,vb),kb.vadd(vb,Ea.rj),Ea.ri.vadd(Ka,Ea.ri),Ea.ri.vsub(Va.position,
Ea.ri),Ea.rj.vadd(Oa,Ea.rj),Ea.rj.vsub(cb.position,Ea.rj),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult));jb=Ha.get();for(Ra=0;2!==Ra&&!$a;Ra++)for(fb=0;2!==fb&&!$a;fb++)for(ab=0;2!==ab&&!$a;ab++)if(jb.set(0,0,0),Ra?jb.vadd(Ia[0],jb):jb.vsub(Ia[0],jb),fb?jb.vadd(Ia[1],jb):jb.vsub(Ia[1],jb),ab?jb.vadd(Ia[2],jb):jb.vsub(Ia[2],jb),Oa.vadd(jb,Za),Za.vsub(Ka,Za),Za.norm2()<La*La)$a=!0,Ea=this.createContactEquation(Va,cb,ua,Da),Ea.ri.copy(Za),Ea.ri.normalize(),Ea.ni.copy(Ea.ri),
Ea.ri.mult(La,Ea.ri),Ea.rj.copy(jb),Ea.ri.vadd(Ka,Ea.ri),Ea.ri.vsub(Va.position,Ea.ri),Ea.rj.vadd(Oa,Ea.rj),Ea.rj.vsub(cb.position,Ea.rj),this.result.push(Ea),this.createFrictionEquationsFromContact(Ea,this.frictionResult);Ha.release(jb);Bb=Ha.get();Fb=Ha.get();Ea=Ha.get();Qb=Ha.get();jb=Ha.get();Ob=Ia.length;for(Ra=0;Ra!==Ob&&!$a;Ra++)for(fb=0;fb!==Ob&&!$a;fb++)if(Ra%3!==fb%3){Ia[fb].cross(Ia[Ra],Bb);Bb.normalize();Ia[Ra].vadd(Ia[fb],Fb);Ea.copy(Ka);Ea.vsub(Fb,Ea);Ea.vsub(Oa,Ea);Rb=Ea.dot(Bb);Bb.mult(Rb,
Qb);for(ab=0;ab===Ra%3||ab===fb%3;)ab++;jb.copy(Ka);jb.vsub(Qb,jb);jb.vsub(Fb,jb);jb.vsub(Oa,jb);Rb=Math.abs(Rb);Wb=jb.norm();Rb<Ia[ab].norm()&&La>Wb&&($a=!0,ab=this.createContactEquation(Va,cb,ua,Da),Fb.vadd(Qb,ab.rj),ab.rj.copy(ab.rj),jb.negate(ab.ni),ab.ni.normalize(),ab.ri.copy(ab.rj),ab.ri.vadd(Oa,ab.ri),ab.ri.vsub(Ka,ab.ri),ab.ri.normalize(),ab.ri.mult(La,ab.ri),ab.ri.vadd(Ka,ab.ri),ab.ri.vsub(Va.position,ab.ri),ab.rj.vadd(Oa,ab.rj),ab.rj.vsub(cb.position,ab.rj),this.result.push(ab),this.createFrictionEquationsFromContact(ab,
this.frictionResult))}Ha.release(Bb,Fb,Ea,Qb,jb)};var Nb=new l,Pb=new l,Sb=new l,bd=new l,cd=new l,sc=new l,tc=new l,te=new l,lb=new l,ed=new l;e.prototype[p.types.SPHERE|p.types.CONVEXPOLYHEDRON]=e.prototype.sphereConvex=function(ua,Da,Ka,Oa,Ha,La,Va,cb){Ha=this.v3pool;Ka.vsub(Oa,Nb);for(var $a=Da.faceNormals,Ra=Da.faces,Ea=Da.vertices,fb=ua.radius,ab=0;ab!==Ea.length;ab++){var Bb=cd;La.vmult(Ea[ab],Bb);Oa.vadd(Bb,Bb);var Fb=bd;if(Bb.vsub(Ka,Fb),Fb.norm2()<fb*fb)return ua=this.createContactEquation(Va,
cb,ua,Da),ua.ri.copy(Fb),ua.ri.normalize(),ua.ni.copy(ua.ri),ua.ri.mult(fb,ua.ri),Bb.vsub(Oa,ua.rj),ua.ri.vadd(Ka,ua.ri),ua.ri.vsub(Va.position,ua.ri),ua.rj.vadd(Oa,ua.rj),ua.rj.vsub(cb.position,ua.rj),this.result.push(ua),void this.createFrictionEquationsFromContact(ua,this.frictionResult)}ab=0;for(Bb=Ra.length;ab!==Bb;ab++){Fb=Ra[ab];var Qb=sc;La.vmult($a[ab],Qb);var Ob=tc;La.vmult(Ea[Fb[0]],Ob);Ob.vadd(Oa,Ob);var Rb=te;Qb.mult(-fb,Rb);Ka.vadd(Rb,Rb);var jb=lb;Rb.vsub(Ob,jb);Rb=jb.dot(Qb);jb=ed;
if(Ka.vsub(Ob,jb),0>Rb&&0<jb.dot(Qb)){Ob=[];jb=0;for(var Wb=Fb.length;jb!==Wb;jb++){var cc=Ha.get();La.vmult(Ea[Fb[jb]],cc);Oa.vadd(cc,cc);Ob.push(cc)}a:{jb=Ob;Wb=Qb;cc=Ka;for(var dc=null,Hc=jb.length,mc=0;mc!==Hc;mc++){var Dc=jb[mc],kd=X;jb[(mc+1)%Hc].vsub(Dc,kd);var ef=ca;kd.cross(Wb,ef);kd=pa;cc.vsub(Dc,kd);Dc=ef.dot(kd);if(!(null===dc||0<Dc&&!0===dc||0>=Dc&&!1===dc)){jb=!1;break a}null===dc&&(dc=0<Dc)}jb=!0}if(jb){ua=this.createContactEquation(Va,cb,ua,Da);Qb.mult(-fb,ua.ri);Qb.negate(ua.ni);
Da=Ha.get();Qb.mult(-Rb,Da);La=Ha.get();Qb.mult(-fb,La);Ka.vsub(Oa,ua.rj);ua.rj.vadd(La,ua.rj);ua.rj.vadd(Da,ua.rj);ua.rj.vadd(Oa,ua.rj);ua.rj.vsub(cb.position,ua.rj);ua.ri.vadd(Ka,ua.ri);ua.ri.vsub(Va.position,ua.ri);Ha.release(Da);Ha.release(La);this.result.push(ua);this.createFrictionEquationsFromContact(ua,this.frictionResult);jb=0;for(Fb=Ob.length;jb!==Fb;jb++)Ha.release(Ob[jb]);break}for(jb=0;jb!==Fb.length;jb++){Qb=Ha.get();Rb=Ha.get();La.vmult(Ea[Fb[(jb+1)%Fb.length]],Qb);La.vmult(Ea[Fb[(jb+
2)%Fb.length]],Rb);Oa.vadd(Qb,Qb);Oa.vadd(Rb,Rb);Hc=Pb;Rb.vsub(Qb,Hc);dc=Sb;Hc.unit(dc);Wb=Ha.get();cc=Ha.get();Ka.vsub(Qb,cc);mc=cc.dot(dc);dc.mult(mc,Wb);Wb.vadd(Qb,Wb);dc=Ha.get();if(Wb.vsub(Ka,dc),0<mc&&mc*mc<Hc.norm2()&&dc.norm2()<fb*fb){ua=this.createContactEquation(Va,cb,ua,Da);Wb.vsub(Oa,ua.rj);Wb.vsub(Ka,ua.ni);ua.ni.normalize();ua.ni.mult(fb,ua.ri);ua.rj.vadd(Oa,ua.rj);ua.rj.vsub(cb.position,ua.rj);ua.ri.vadd(Ka,ua.ri);ua.ri.vsub(Va.position,ua.ri);this.result.push(ua);this.createFrictionEquationsFromContact(ua,
this.frictionResult);jb=0;for(Fb=Ob.length;jb!==Fb;jb++)Ha.release(Ob[jb]);return Ha.release(Qb),Ha.release(Rb),Ha.release(Wb),Ha.release(dc),void Ha.release(cc)}Ha.release(Qb);Ha.release(Rb);Ha.release(Wb);Ha.release(dc);Ha.release(cc)}jb=0;for(Fb=Ob.length;jb!==Fb;jb++)Ha.release(Ob[jb])}}};new l;new l;e.prototype[p.types.PLANE|p.types.BOX]=e.prototype.planeBox=function(ua,Da,Ka,Oa,Ha,La,Va,cb){Da.convexPolyhedronRepresentation.material=Da.material;Da.convexPolyhedronRepresentation.collisionResponse=
Da.collisionResponse;this.planeConvex(ua,Da.convexPolyhedronRepresentation,Ka,Oa,Ha,La,Va,cb)};var gc=new l,bc=new l,hc=new l,zb=new l;e.prototype[p.types.PLANE|p.types.CONVEXPOLYHEDRON]=e.prototype.planeConvex=function(ua,Da,Ka,Oa,Ha,La,Va,cb){bc.set(0,0,1);Ha.vmult(bc,bc);for(var $a=Ha=0;$a!==Da.vertices.length;$a++)if(gc.copy(Da.vertices[$a]),La.vmult(gc,gc),Oa.vadd(gc,gc),gc.vsub(Ka,hc),0>=bc.dot(hc)){var Ra=this.createContactEquation(Va,cb,ua,Da),Ea=zb;bc.mult(bc.dot(hc),Ea);gc.vsub(Ea,Ea);Ea.vsub(Ka,
Ra.ri);Ra.ni.copy(bc);gc.vsub(Oa,Ra.rj);Ra.ri.vadd(Ka,Ra.ri);Ra.ri.vsub(Va.position,Ra.ri);Ra.rj.vadd(Oa,Ra.rj);Ra.rj.vsub(cb.position,Ra.rj);this.result.push(Ra);Ha++;this.enableFrictionReduction||this.createFrictionEquationsFromContact(Ra,this.frictionResult)}this.enableFrictionReduction&&Ha&&this.createFrictionFromAverage(Ha)};var Yc=new l,Pc=new l;e.prototype[p.types.CONVEXPOLYHEDRON]=e.prototype.convexConvex=function(ua,Da,Ka,Oa,Ha,La,Va,cb,$a,Ra,Ea,fb){if(!(Ka.distanceTo(Oa)>ua.boundingSphereRadius+
Da.boundingSphereRadius)&&ua.findSeparatingAxis(Da,Ka,Ha,Oa,La,Yc,Ea,fb)){Ea=[];ua.clipAgainstHull(Ka,Ha,Da,Oa,La,Yc,-100,100,Ea);for(La=Ha=0;La!==Ea.length;La++){fb=this.createContactEquation(Va,cb,ua,Da,$a,Ra);var ab=fb.ri,Bb=fb.rj;Yc.negate(fb.ni);Ea[La].normal.negate(Pc);Pc.mult(Ea[La].depth,Pc);Ea[La].point.vadd(Pc,ab);Bb.copy(Ea[La].point);ab.vsub(Ka,ab);Bb.vsub(Oa,Bb);ab.vadd(Ka,ab);ab.vsub(Va.position,ab);Bb.vadd(Oa,Bb);Bb.vsub(cb.position,Bb);this.result.push(fb);Ha++;this.enableFrictionReduction||
this.createFrictionEquationsFromContact(fb,this.frictionResult)}this.enableFrictionReduction&&Ha&&this.createFrictionFromAverage(Ha)}};var uc=new l,fd=new l,Bc=new l;e.prototype[p.types.PLANE|p.types.PARTICLE]=e.prototype.planeParticle=function(ua,Da,Ka,Oa,Ha,La,Va,cb){uc.set(0,0,1);Va.quaternion.vmult(uc,uc);Oa.vsub(Va.position,fd);0>=uc.dot(fd)&&(ua=this.createContactEquation(cb,Va,Da,ua),ua.ni.copy(uc),ua.ni.negate(ua.ni),ua.ri.set(0,0,0),uc.mult(uc.dot(Oa),Bc),Oa.vsub(Bc,Bc),ua.rj.copy(Bc),this.result.push(ua),
this.createFrictionEquationsFromContact(ua,this.frictionResult))};var Cc=new l;e.prototype[p.types.PARTICLE|p.types.SPHERE]=e.prototype.sphereParticle=function(ua,Da,Ka,Oa,Ha,La,Va,cb){Cc.set(0,0,1);Oa.vsub(Ka,Cc);Cc.norm2()<=ua.radius*ua.radius&&(Da=this.createContactEquation(cb,Va,Da,ua),Cc.normalize(),Da.rj.copy(Cc),Da.rj.mult(ua.radius,Da.rj),Da.ni.copy(Cc),Da.ni.negate(Da.ni),Da.ri.set(0,0,0),this.result.push(Da),this.createFrictionEquationsFromContact(Da,this.frictionResult))};var Qc=new r,
ib=new l,Zc=(new l,new l),ue=new l,Rc=new l;e.prototype[p.types.PARTICLE|p.types.CONVEXPOLYHEDRON]=e.prototype.convexParticle=function(ua,Da,Ka,Oa,Ha,La,Va,cb){var $a=-1;La=null;var Ra=0;if(ib.copy(Oa),ib.vsub(Ka,ib),Ha.conjugate(Qc),Qc.vmult(ib,ib),ua.pointIsInside(ib)){ua.worldVerticesNeedsUpdate&&ua.computeWorldVertices(Ka,Ha);ua.worldFaceNormalsNeedsUpdate&&ua.computeWorldFaceNormals(Ha);Ha=0;for(var Ea=ua.faces.length;Ha!==Ea;Ha++){var fb=ua.worldFaceNormals[Ha];Oa.vsub(ua.worldVertices[ua.faces[Ha][0]],
ue);var ab=-fb.dot(ue);(null===La||Math.abs(ab)<Math.abs(La))&&(La=ab,$a=Ha,Zc.copy(fb),Ra++)}-1!==$a?(ua=this.createContactEquation(cb,Va,Da,ua),Zc.mult(La,Rc),Rc.vadd(Oa,Rc),Rc.vsub(Ka,Rc),ua.rj.copy(Rc),Zc.negate(ua.ni),ua.ri.set(0,0,0),Da=ua.ri,La=ua.rj,Da.vadd(Oa,Da),Da.vsub(cb.position,Da),La.vadd(Ka,La),La.vsub(Va.position,La),this.result.push(ua),this.createFrictionEquationsFromContact(ua,this.frictionResult)):console.warn("Point found inside convex, but did not find penetrating face!")}};
e.prototype[p.types.BOX|p.types.HEIGHTFIELD]=e.prototype.boxHeightfield=function(ua,Da,Ka,Oa,Ha,La,Va,cb){ua.convexPolyhedronRepresentation.material=ua.material;ua.convexPolyhedronRepresentation.collisionResponse=ua.collisionResponse;this.convexHeightfield(ua.convexPolyhedronRepresentation,Da,Ka,Oa,Ha,La,Va,cb)};var sb=new l,ob=new l,Zb=[0];e.prototype[p.types.CONVEXPOLYHEDRON|p.types.HEIGHTFIELD]=e.prototype.convexHeightfield=function(ua,Da,Ka,Oa,Ha,La,Va,cb){var $a=Da.data,Ra=Da.elementSize,Ea=
ua.boundingSphereRadius;t.pointToLocalFrame(Oa,La,Ka,sb);var fb=Math.floor((sb.x-Ea)/Ra)-1,ab=Math.ceil((sb.x+Ea)/Ra)+1,Bb=Math.floor((sb.y-Ea)/Ra)-1;Ra=Math.ceil((sb.y+Ea)/Ra)+1;if(!(0>ab||0>Ra||fb>$a.length||Bb>$a[0].length)){0>fb&&(fb=0);0>ab&&(ab=0);0>Bb&&(Bb=0);0>Ra&&(Ra=0);fb>=$a.length&&(fb=$a.length-1);ab>=$a.length&&(ab=$a.length-1);Ra>=$a[0].length&&(Ra=$a[0].length-1);Bb>=$a[0].length&&(Bb=$a[0].length-1);$a=[];Da.getRectMinMax(fb,Bb,ab,Ra,$a);var Fb=$a[0];if(!(sb.z-Ea>$a[1]||sb.z+Ea<Fb))for(Ea=
fb;ab>Ea;Ea++)for(fb=Bb;Ra>fb;fb++)Da.getConvexTrianglePillar(Ea,fb,!1),t.pointToWorldFrame(Oa,La,Da.pillarOffset,ob),Ka.distanceTo(ob)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.convexConvex(ua,Da.pillarConvex,Ka,ob,Ha,La,Va,cb,null,null,Zb,null),Da.getConvexTrianglePillar(Ea,fb,!0),t.pointToWorldFrame(Oa,La,Da.pillarOffset,ob),Ka.distanceTo(ob)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.convexConvex(ua,Da.pillarConvex,Ka,ob,Ha,La,Va,cb,null,null,Zb,
null)}};var oc=new l,pc=new l;e.prototype[p.types.SPHERE|p.types.HEIGHTFIELD]=e.prototype.sphereHeightfield=function(ua,Da,Ka,Oa,Ha,La,Va,cb){var $a=Da.data,Ra=ua.radius,Ea=Da.elementSize;t.pointToLocalFrame(Oa,La,Ka,oc);var fb=Math.floor((oc.x-Ra)/Ea)-1,ab=Math.ceil((oc.x+Ra)/Ea)+1,Bb=Math.floor((oc.y-Ra)/Ea)-1;Ea=Math.ceil((oc.y+Ra)/Ea)+1;if(!(0>ab||0>Ea||fb>$a.length||Ea>$a[0].length)){0>fb&&(fb=0);0>ab&&(ab=0);0>Bb&&(Bb=0);0>Ea&&(Ea=0);fb>=$a.length&&(fb=$a.length-1);ab>=$a.length&&(ab=$a.length-
1);Ea>=$a[0].length&&(Ea=$a[0].length-1);Bb>=$a[0].length&&(Bb=$a[0].length-1);$a=[];Da.getRectMinMax(fb,Bb,ab,Ea,$a);var Fb=$a[0];if(!(oc.z-Ra>$a[1]||oc.z+Ra<Fb))for(Ra=this.result;ab>fb;fb++)for($a=Bb;Ea>$a;$a++)if(Fb=Ra.length,Da.getConvexTrianglePillar(fb,$a,!1),t.pointToWorldFrame(Oa,La,Da.pillarOffset,pc),Ka.distanceTo(pc)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.sphereConvex(ua,Da.pillarConvex,Ka,pc,Ha,La,Va,cb),Da.getConvexTrianglePillar(fb,$a,!0),t.pointToWorldFrame(Oa,
La,Da.pillarOffset,pc),Ka.distanceTo(pc)<Da.pillarConvex.boundingSphereRadius+ua.boundingSphereRadius&&this.sphereConvex(ua,Da.pillarConvex,Ka,pc,Ha,La,Va,cb),2<Ra.length-Fb)return}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(h,k){function e(){r.apply(this);
this.dt=-1;this.allowSleep=!1;this.contacts=[];this.frictionEquations=[];this.quatNormalizeSkip=0;this.quatNormalizeFast=!1;this.stepnumber=this.time=0;this.default_dt=1/60;this.nextId=0;this.gravity=new q;this.broadphase=new n;this.bodies=[];this.solver=new l;this.constraints=[];this.narrowphase=new t(this);this.collisionMatrix=new y;this.collisionMatrixPrevious=new y;this.materials=[];this.contactmaterials=[];this.contactMaterialTable=new F;this.defaultMaterial=new z("default");this.defaultContactMaterial=
new E(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0});this.doProfiling=!1;this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0};this.subsystems=[];this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null}}k.exports=e;var p=h("../shapes/Shape"),q=h("../math/Vec3");k=h("../math/Quaternion");var l=h("../solver/GSSolver"),t=(h("../utils/Vec3Pool"),h("../equations/ContactEquation"),h("../equations/FrictionEquation"),
h("./Narrowphase")),r=h("../utils/EventTarget"),y=h("../collision/ArrayCollisionMatrix"),z=h("../material/Material"),E=h("../material/ContactMaterial"),B=h("../objects/Body"),F=h("../utils/TupleDictionary"),I=h("../collision/RaycastResult"),L=h("../collision/AABB"),U=h("../collision/Ray"),n=h("../collision/NaiveBroadphase");e.prototype=new r;var w=(new L,new U);if(e.prototype.getContactMaterial=function(V,ma){return this.contactMaterialTable.get(V.id,ma.id)},e.prototype.numObjects=function(){return this.bodies.length},
e.prototype.collisionMatrixTick=function(){var V=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix;this.collisionMatrix=V;this.collisionMatrix.reset()},e.prototype.add=e.prototype.addBody=function(V){-1===this.bodies.indexOf(V)&&(V.index=this.bodies.length,this.bodies.push(V),V.world=this,V.initPosition.copy(V.position),V.initVelocity.copy(V.velocity),V.timeLastSleepy=this.time,V instanceof B&&(V.initAngularVelocity.copy(V.angularVelocity),V.initQuaternion.copy(V.quaternion)),
this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=V,this.dispatchEvent(this.addBodyEvent))},e.prototype.addConstraint=function(V){this.constraints.push(V)},e.prototype.removeConstraint=function(V){V=this.constraints.indexOf(V);-1!==V&&this.constraints.splice(V,1)},e.prototype.rayTest=function(V,ma,ha){ha instanceof I?this.raycastClosest(V,ma,{skipBackfaces:!0},ha):this.raycastAll(V,ma,{skipBackfaces:!0},ha)},e.prototype.raycastAll=function(V,ma,ha,ia){return ha.mode=U.ALL,
ha.from=V,ha.to=ma,ha.callback=ia,w.intersectWorld(this,ha)},e.prototype.raycastAny=function(V,ma,ha,ia){return ha.mode=U.ANY,ha.from=V,ha.to=ma,ha.result=ia,w.intersectWorld(this,ha)},e.prototype.raycastClosest=function(V,ma,ha,ia){return ha.mode=U.CLOSEST,ha.from=V,ha.to=ma,ha.result=ia,w.intersectWorld(this,ha)},e.prototype.remove=function(V){V.world=null;var ma=this.bodies.length-1,ha=this.bodies,ia=ha.indexOf(V);if(-1!==ia){ha.splice(ia,1);for(ia=0;ia!==ha.length;ia++)ha[ia].index=ia;this.collisionMatrix.setNumObjects(ma);
this.removeBodyEvent.body=V;this.dispatchEvent(this.removeBodyEvent)}},e.prototype.removeBody=e.prototype.remove,e.prototype.addMaterial=function(V){this.materials.push(V)},e.prototype.addContactMaterial=function(V){this.contactmaterials.push(V);this.contactMaterialTable.set(V.materials[0].id,V.materials[1].id,V)},"undefined"==typeof performance&&(performance={}),!performance.now){var G=Date.now();performance.timing&&performance.timing.navigationStart&&(G=performance.timing.navigationStart);performance.now=
function(){return Date.now()-G}}var f=new q;e.prototype.step=function(V,ma,ha){if(ha=ha||10,ma=ma||0,0===ma)this.internalStep(V),this.time+=V;else{var ia=Math.floor((this.time+ma)/V)-Math.floor(this.time/V);ia=Math.min(ia,ha);ha=performance.now();for(var aa=0;aa!==ia&&(this.internalStep(V),!(performance.now()-ha>1E3*V));aa++);this.time+=ma;V=this.time%V/V;ma=this.bodies;for(ia=0;ia!==ma.length;ia++)ha=ma[ia],ha.type!==B.STATIC&&ha.sleepState!==B.SLEEPING?(ha.position.vsub(ha.previousPosition,f),f.scale(V,
f),ha.position.vadd(f,ha.interpolatedPosition)):(ha.interpolatedPosition.copy(ha.position),ha.interpolatedQuaternion.copy(ha.quaternion))}};var m={type:"postStep"},v={type:"preStep"},D={type:"collide",body:null,contact:null},C=[],J=[],N=[],S=[],T=(new q,new q,new q,new q,new q,new q,new q,new q,new q,new k,new k),W=new k,Y=new q;e.prototype.internalStep=function(V){this.dt=V;var ma,ha=this.contacts,ia=this.numObjects(),aa=this.bodies,ea=this.solver,ja=this.gravity,Q=this.doProfiling,X=this.profile,
ca=B.DYNAMIC,pa=this.constraints,ka=(ja.norm(),ja.x),va=ja.y,Aa=ja.z;Q&&(ma=performance.now());for(ja=0;ja!==ia;ja++){var xa=aa[ja];if(xa.type&ca){var Ia=xa.force;xa=xa.mass;Ia.x+=xa*ka;Ia.y+=xa*va;Ia.z+=xa*Aa}}ja=0;for(xa=this.subsystems.length;ja!==xa;ja++)this.subsystems[ja].update();Q&&(ma=performance.now());N.length=0;S.length=0;this.broadphase.collisionPairs(this,N,S);Q&&(X.broadphase=performance.now()-ma);xa=pa.length;for(ja=0;ja!==xa;ja++)if(ka=pa[ja],!ka.collideConnected)for(va=N.length-
1;0<=va;--va)(ka.bodyA===N[va]&&ka.bodyB===S[va]||ka.bodyB===N[va]&&ka.bodyA===S[va])&&(N.splice(va,1),S.splice(va,1));this.collisionMatrixTick();Q&&(ma=performance.now());xa=ha.length;for(ja=0;ja!==xa;ja++)C.push(ha[ja]);ha.length=0;xa=this.frictionEquations.length;for(ja=0;ja!==xa;ja++)J.push(this.frictionEquations[ja]);this.frictionEquations.length=0;this.narrowphase.getContacts(N,S,this,ha,C,this.frictionEquations,J);Q&&(X.narrowphase=performance.now()-ma);Q&&(ma=performance.now());for(ja=0;ja<
this.frictionEquations.length;ja++)ea.addEquation(this.frictionEquations[ja]);ja=ha.length;for(va=0;va!==ja;va++)ka=ha[va],xa=ka.bi,Aa=ka.bj,ka.si,ka.sj,xa.material&&Aa.material&&this.getContactMaterial(xa.material,Aa.material),(xa.material&&Aa.material&&0<=xa.material.restitution&&0<=Aa.material.restitution&&(ka.restitution=xa.material.restitution*Aa.material.restitution),ea.addEquation(ka),xa.allowSleep&&xa.type===B.DYNAMIC&&xa.sleepState===B.SLEEPING&&Aa.sleepState===B.AWAKE&&Aa.type!==B.STATIC)&&
Aa.velocity.norm2()+Aa.angularVelocity.norm2()>=2*Math.pow(Aa.sleepSpeedLimit,2)&&(xa._wakeUpAfterNarrowphase=!0),Aa.allowSleep&&Aa.type===B.DYNAMIC&&Aa.sleepState===B.SLEEPING&&xa.sleepState===B.AWAKE&&xa.type!==B.STATIC&&xa.velocity.norm2()+xa.angularVelocity.norm2()>=2*Math.pow(xa.sleepSpeedLimit,2)&&(Aa._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(xa,Aa,!0),this.collisionMatrixPrevious.get(xa,Aa)||(D.body=Aa,D.contact=ka,xa.dispatchEvent(D),D.body=xa,Aa.dispatchEvent(D));Q&&(X.makeContactConstraints=
performance.now()-ma,ma=performance.now());for(ja=0;ja!==ia;ja++)xa=aa[ja],xa._wakeUpAfterNarrowphase&&(xa.wakeUp(),xa._wakeUpAfterNarrowphase=!1);xa=pa.length;for(ja=0;ja!==xa;ja++)for(ka=pa[ja],ka.update(),va=0,ha=ka.equations.length;va!==ha;va++)ea.addEquation(ka.equations[va]);ea.solve(V,this);Q&&(X.solve=performance.now()-ma);ea.removeAllEquations();ea=Math.pow;for(ja=0;ja!==ia;ja++)if(xa=aa[ja],xa.type&ca&&(pa=ea(1-xa.linearDamping,V),ha=xa.velocity,ha.mult(pa,ha),pa=xa.angularVelocity))ha=
ea(1-xa.angularDamping,V),pa.mult(ha,pa);this.dispatchEvent(v);for(ja=0;ja!==ia;ja++)xa=aa[ja],xa.preStep&&xa.preStep.call(xa);Q&&(ma=performance.now());ca=B.DYNAMIC|B.KINEMATIC;ea=0===this.stepnumber%(this.quatNormalizeSkip+1);pa=this.quatNormalizeFast;ha=.5*V;p.types.PLANE;p.types.CONVEXPOLYHEDRON;for(ja=0;ja!==ia;ja++)if(xa=aa[ja],ka=xa.force,va=xa.torque,xa.type&ca&&xa.sleepState!==B.SLEEPING){Aa=xa.velocity;Ia=xa.angularVelocity;var Za=xa.position,kb=xa.quaternion,Hb=xa.invMass,vb=xa.invInertiaWorld;
Aa.x+=ka.x*Hb*V;Aa.y+=ka.y*Hb*V;Aa.z+=ka.z*Hb*V;xa.angularVelocity&&(vb.vmult(va,Y),Y.mult(V,Y),Y.vadd(Ia,Ia));Za.x+=Aa.x*V;Za.y+=Aa.y*V;Za.z+=Aa.z*V;xa.angularVelocity&&(T.set(Ia.x,Ia.y,Ia.z,0),T.mult(kb,W),kb.x+=ha*W.x,kb.y+=ha*W.y,kb.z+=ha*W.z,kb.w+=ha*W.w,ea&&(pa?kb.normalizeFast():kb.normalize()));xa.aabb&&(xa.aabbNeedsUpdate=!0);xa.updateInertiaWorld&&xa.updateInertiaWorld()}this.clearForces();this.broadphase.dirty=!0;Q&&(X.integrate=performance.now()-ma);this.time+=V;this.stepnumber+=1;this.dispatchEvent(m);
for(ja=0;ja!==ia;ja++)xa=aa[ja],(V=xa.postStep)&&V.call(xa);if(this.allowSleep)for(ja=0;ja!==ia;ja++)aa[ja].sleepTick(this.time)};e.prototype.clearForces=function(){for(var V=this.bodies,ma=V.length,ha=0;ha!==ma;ha++){var ia=V[ha];ia.force;ia.torque;ia.force.set(0,0,0);ia.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,
"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)});
!function(b,h,k){function e(l,t){if(!h[l]){if(!b[l]){var r="function"==typeof require&&require;if(!t&&r)return r(l,!0);if(p)return p(l,!0);throw Error("Cannot find module '"+l+"'");}t=h[l]={exports:{}};b[l][0].call(t.exports,function(y){var z=b[l][1][y];return e(z?z:y)},t,t.exports)}return h[l].exports}for(var p="function"==typeof require&&require,q=0;q<k.length;q++)e(k[q]);return e}({1:[function(b,h){var k=(b("./pointable"),b("gl-matrix")),e=k.vec3,p=k.mat3,q=k.mat4;b=(b("underscore"),h.exports=
function(l,t){this.finger=l;this._matrix=this._center=null;this.type=t.type;this.prevJoint=t.prevJoint;this.nextJoint=t.nextJoint;this.width=t.width;l=Array(3);e.sub(l,t.nextJoint,t.prevJoint);this.length=e.length(l);this.basis=t.basis});b.prototype.left=function(){return this._left?this._left:(this._left=0>p.determinant(this.basis[0].concat(this.basis[1]).concat(this.basis[2])),this._left)};b.prototype.matrix=function(){if(this._matrix)return this._matrix;var l=this.basis,t=this._matrix=q.create();
return t[0]=l[0][0],t[1]=l[0][1],t[2]=l[0][2],t[4]=l[1][0],t[5]=l[1][1],t[6]=l[1][2],t[8]=l[2][0],t[9]=l[2][1],t[10]=l[2][2],t[3]=this.center()[0],t[7]=this.center()[1],t[11]=this.center()[2],this.left()&&(t[0]*=-1,t[1]*=-1,t[2]*=-1),this._matrix};b.prototype.lerp=function(l,t){e.lerp(l,this.prevJoint,this.nextJoint,t)};b.prototype.center=function(){if(this._center)return this._center;var l=e.create();return this.lerp(l,.5),this._center=l,l};b.prototype.direction=function(){return[-1*this.basis[2][0],
-1*this.basis[2][1],-1*this.basis[2][2]]}},{"./pointable":14,"gl-matrix":23,underscore:24}],2:[function(b,h){b=h.exports=function(k){this.pos=0;this._buf=[];this.size=k};b.prototype.get=function(k){return void 0==k&&(k=0),k>=this.size?void 0:k>=this._buf.length?void 0:this._buf[(this.pos-k-1)%this.size]};b.prototype.push=function(k){return this._buf[this.pos%this.size]=k,this.pos++}},{}],3:[function(b,h){var k=b("../protocol").chooseProtocol,e=b("events").EventEmitter,p=b("underscore"),q=h.exports=
function(l){this.opts=p.defaults(l||{},{host:"127.0.0.1",enableGestures:!1,scheme:this.getScheme(),port:this.getPort(),background:!1,optimizeHMD:!1,requestProtocolVersion:q.defaultProtocolVersion});this.host=this.opts.host;this.port=this.opts.port;this.scheme=this.opts.scheme;this.protocolVersionVerified=!1;this.optimizeHMD=this.background=null;this.on("ready",function(){this.enableGestures(this.opts.enableGestures);this.setBackground(this.opts.background);this.setOptimizeHMD(this.opts.optimizeHMD);
console.log(this.opts.optimizeHMD?"Optimized for head mounted display usage.":"Optimized for desktop usage.")})};q.defaultProtocolVersion=6;q.prototype.getUrl=function(){return this.scheme+"//"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"};q.prototype.getScheme=function(){return"ws:"};q.prototype.getPort=function(){return 6437};q.prototype.setBackground=function(l){this.opts.background=l;this.protocol&&this.protocol.sendBackground&&this.background!==this.opts.background&&
(this.background=this.opts.background,this.protocol.sendBackground(this,this.opts.background))};q.prototype.setOptimizeHMD=function(l){this.opts.optimizeHMD=l;this.protocol&&this.protocol.sendOptimizeHMD&&this.optimizeHMD!==this.opts.optimizeHMD&&(this.optimizeHMD=this.opts.optimizeHMD,this.protocol.sendOptimizeHMD(this,this.opts.optimizeHMD))};q.prototype.handleOpen=function(){this.connected||(this.connected=!0,this.emit("connect"))};q.prototype.enableGestures=function(l){this.gesturesEnabled=l?
!0:!1;this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))};q.prototype.handleClose=function(l){this.connected&&(this.disconnect(),1001===l&&1<this.opts.requestProtocolVersion&&(this.protocolVersionVerified?this.protocolVersionVerified=!1:this.opts.requestProtocolVersion--),this.startReconnection())};q.prototype.startReconnection=function(){var l=this;this.reconnectionTimer||(this.reconnectionTimer=setInterval(function(){l.reconnect()},500))};q.prototype.stopReconnection=function(){this.reconnectionTimer=
clearInterval(this.reconnectionTimer)};q.prototype.disconnect=function(l){return l||this.stopReconnection(),this.socket?(this.socket.close(),delete this.socket,delete this.protocol,delete this.background,delete this.optimizeHMD,delete this.focusedState,this.connected&&(this.connected=!1,this.emit("disconnect")),!0):void 0};q.prototype.reconnect=function(){this.connected?this.stopReconnection():(this.disconnect(!0),this.connect())};q.prototype.handleData=function(l){var t;l=JSON.parse(l);void 0===
this.protocol?(t=this.protocol=k(l),this.protocolVersionVerified=!0,this.emit("ready")):t=this.protocol(l);this.emit(t.type,t)};q.prototype.connect=function(){return this.socket?void 0:(this.socket=this.setupSocket(),!0)};q.prototype.send=function(l){this.socket.send(l)};q.prototype.reportFocus=function(l){this.connected&&this.focusedState!==l&&(this.focusedState=l,this.emit(this.focusedState?"focus":"blur"),this.protocol&&this.protocol.sendFocused&&this.protocol.sendFocused(this,this.focusedState))};
p.extend(q.prototype,e.prototype)},{"../protocol":15,events:21,underscore:24}],4:[function(b,h){var k=h.exports=b("./base");b=b("underscore");h=h.exports=function(e){k.call(this,e);var p=this;this.on("ready",function(){p.startFocusLoop()});this.on("disconnect",function(){p.stopFocusLoop()})};b.extend(h.prototype,k.prototype);h.__proto__=k;h.prototype.useSecure=function(){return"https:"===location.protocol};h.prototype.getScheme=function(){return this.useSecure()?"wss:":"ws:"};h.prototype.getPort=
function(){return this.useSecure()?6436:6437};h.prototype.setupSocket=function(){var e=this,p=new WebSocket(this.getUrl());return p.onopen=function(){e.handleOpen()},p.onclose=function(q){e.handleClose(q.code,q.reason)},p.onmessage=function(q){e.handleData(q.data)},p.onerror=function(){e.useSecure()&&"wss:"===e.scheme&&(e.scheme="ws:",e.port=6437,e.disconnect(),e.connect())},p};h.prototype.startFocusLoop=function(){if(!this.focusDetectorTimer){var e=this,p=null;p="undefined"!=typeof document.hidden?
"hidden":"undefined"!=typeof document.mozHidden?"mozHidden":"undefined"!=typeof document.msHidden?"msHidden":"undefined"!=typeof document.webkitHidden?"webkitHidden":void 0;void 0===e.windowVisible&&(e.windowVisible=void 0===p?!0:!1===document[p]);var q=window.addEventListener("focus",function(){e.windowVisible=!0;t()}),l=window.addEventListener("blur",function(){e.windowVisible=!1;t()});this.on("disconnect",function(){window.removeEventListener("focus",q);window.removeEventListener("blur",l)});var t=
function(){e.reportFocus((void 0===p?!0:!1===document[p])&&e.windowVisible)};t();this.focusDetectorTimer=setInterval(t,100)}};h.prototype.stopFocusLoop=function(){this.focusDetectorTimer&&(clearTimeout(this.focusDetectorTimer),delete this.focusDetectorTimer)}},{"./base":3,underscore:24}],5:[function(b,h){var k=b("__browserify_process"),e=b("./frame"),p=b("./hand"),q=b("./pointable"),l=b("./finger"),t=b("./circular_buffer"),r=b("./pipeline"),y=b("events").EventEmitter,z=b("./gesture").gestureListener,
E=b("./dialog"),B=b("underscore"),F=h.exports=function(I){var L=this;I=B.defaults(I||{},{inNode:"undefined"!=typeof k&&k.versions&&k.versions.node});this.inNode=I.inNode;I=B.defaults(I||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",suppressAnimationLoop:!this.useAnimationLoop(),loopWhileDisconnected:!0,useAllPlugins:!1,checkVersion:!0});this.animationFrameRequested=!1;this.onAnimationFrame=function(U){L.lastConnectionFrame.valid&&L.emit("animationFrame",L.lastConnectionFrame);
L.emit("frameEnd",U);L.loopWhileDisconnected&&(!1!==L.connection.focusedState||L.connection.opts.background)?window.requestAnimationFrame(L.onAnimationFrame):L.animationFrameRequested=!1};this.suppressAnimationLoop=I.suppressAnimationLoop;this.loopWhileDisconnected=I.loopWhileDisconnected;this.frameEventName=I.frameEventName;this.useAllPlugins=I.useAllPlugins;this.history=new t(200);this.lastConnectionFrame=this.lastValidFrame=this.lastFrame=e.Invalid;this.accumulatedGestures=[];this.checkVersion=
I.checkVersion;this.connectionType=void 0===I.connectionType?b(this.inBrowser()?"./connection/browser":"./connection/node"):I.connectionType;this.connection=new this.connectionType(I);this.streamingCount=0;this.devices={};this.plugins={};this._pluginPipelineSteps={};this._pluginExtendedMethods={};I.useAllPlugins&&this.useRegisteredPlugins();this.setupFrameEvents(I);this.setupConnectionEvents();this.startAnimationLoop()};F.prototype.gesture=function(I,L){I=z(this,I);return void 0!==L&&I.stop(L),I};
F.prototype.setBackground=function(I){return this.connection.setBackground(I),this};F.prototype.setOptimizeHMD=function(I){return this.connection.setOptimizeHMD(I),this};F.prototype.inBrowser=function(){return!this.inNode};F.prototype.useAnimationLoop=function(){return this.inBrowser()&&!this.inBackgroundPage()};F.prototype.inBackgroundPage=function(){return"undefined"!=typeof chrome&&chrome.extension&&chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===window};F.prototype.connect=
function(){return this.connection.connect(),this};F.prototype.streaming=function(){return 0<this.streamingCount};F.prototype.connected=function(){return!!this.connection.connected};F.prototype.startAnimationLoop=function(){this.suppressAnimationLoop||this.animationFrameRequested||(this.animationFrameRequested=!0,window.requestAnimationFrame(this.onAnimationFrame))};F.prototype.disconnect=function(){return this.connection.disconnect(),this};F.prototype.frame=function(I){return this.history.get(I)||
e.Invalid};F.prototype.loop=function(I){return I&&("function"==typeof I?this.on(this.frameEventName,I):this.setupFrameEvents(I)),this.connect()};F.prototype.addStep=function(I){this.pipeline||(this.pipeline=new r(this));this.pipeline.addStep(I)};F.prototype.processFrame=function(I){I.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(I.gestures));this.lastConnectionFrame=I;this.startAnimationLoop();this.emit("deviceFrame",I)};F.prototype.processFinishedFrame=function(I){if(this.lastFrame=
I,I.valid&&(this.lastValidFrame=I),I.controller=this,I.historyIdx=this.history.push(I),I.gestures){I.gestures=this.accumulatedGestures;this.accumulatedGestures=[];for(var L=0;L!=I.gestures.length;L++)this.emit("gesture",I.gestures[L],I)}this.pipeline&&(I=this.pipeline.run(I),I||(I=e.Invalid));this.emit("frame",I);this.emitHandEvents(I)};F.prototype.emitHandEvents=function(I){for(var L=0;L<I.hands.length;L++)this.emit("hand",I.hands[L])};F.prototype.setupFrameEvents=function(I){I.frame&&this.on("frame",
I.frame);I.hand&&this.on("hand",I.hand)};F.prototype.setupConnectionEvents=function(){var I=this;this.connection.on("frame",function(n){I.processFrame(n)});this.on(this.frameEventName,function(n){I.processFinishedFrame(n)});var L=function(){if(5>I.connection.opts.requestProtocolVersion&&0==I.streamingCount){I.streamingCount=1;var n={attached:!0,streaming:!0,type:"unknown",id:"Lx00000000000"};I.devices[n.id]=n;I.emit("deviceAttached",n);I.emit("deviceStreaming",n);I.emit("streamingStarted",n);I.connection.removeListener("frame",
L)}},U=function(){if(0<I.streamingCount){for(var n in I.devices)I.emit("deviceStopped",I.devices[n]),I.emit("deviceRemoved",I.devices[n]);I.emit("streamingStopped",I.devices[n]);I.streamingCount=0;for(n in I.devices)delete I.devices[n]}};this.connection.on("focus",function(){I.loopWhileDisconnected&&I.startAnimationLoop();I.emit("focus")});this.connection.on("blur",function(){I.emit("blur")});this.connection.on("protocol",function(n){n.on("beforeFrameCreated",function(w){I.emit("beforeFrameCreated",
w)});n.on("afterFrameCreated",function(w,G){I.emit("afterFrameCreated",w,G)});I.emit("protocol",n)});this.connection.on("ready",function(){I.checkVersion&&!I.inNode&&I.checkOutOfDate();I.emit("ready")});this.connection.on("connect",function(){I.emit("connect");I.connection.removeListener("frame",L);I.connection.on("frame",L)});this.connection.on("disconnect",function(){I.emit("disconnect");U()});this.connection.on("deviceConnect",function(n){n.state?(I.emit("deviceConnected"),I.connection.removeListener("frame",
L),I.connection.on("frame",L)):(I.emit("deviceDisconnected"),U())});this.connection.on("deviceEvent",function(n){n=n.state;var w=I.devices[n.id],G={},f;for(f in n)w&&w.hasOwnProperty(f)&&w[f]==n[f]||(G[f]=!0);I.devices[n.id]=n;G.attached&&I.emit(n.attached?"deviceAttached":"deviceRemoved",n);G.streaming&&(n.streaming?(I.streamingCount++,I.emit("deviceStreaming",n),1==I.streamingCount&&I.emit("streamingStarted",n),G.attached||I.emit("deviceConnected")):G.attached&&n.attached||(I.streamingCount--,I.emit("deviceStopped",
n),0==I.streamingCount&&I.emit("streamingStopped",n),I.emit("deviceDisconnected")))});this.on("newListener",function(n){"deviceConnected"!=n&&"deviceDisconnected"!=n||console.warn(n+" events are depricated.  Consider using 'streamingStarted/streamingStopped' or 'deviceStreaming/deviceStopped' instead")})};F.prototype.checkOutOfDate=function(){console.assert(this.connection&&this.connection.protocol);var I=this.connection.protocol.serviceVersion,L=this.connection.protocol.version,U=this.connectionType.defaultProtocolVersion;
return U>L?(console.warn("Your Protocol Version is v"+L+", this app was designed for v"+U),E.warnOutOfDate({sV:I,pV:L}),!0):!1};F._pluginFactories={};F.plugin=function(I,L){return this._pluginFactories[I]&&console.warn('Plugin "'+I+'" already registered'),this._pluginFactories[I]=L};F.plugins=function(){return B.keys(this._pluginFactories)};F.prototype.use=function(I,L){var U,n;if(U="function"==typeof I?I:F._pluginFactories[I],!U)throw"Leap Plugin "+I+" not found.";if(L||(L={}),this.plugins[I])return B.extend(this.plugins[I],
L),this;this.plugins[I]=L;L=U.call(this,L);for(n in L)if(U=L[n],"function"==typeof U){var w=I,G=n;-1!=["beforeFrameCreated","afterFrameCreated"].indexOf(G)?this.on(G,U):(this.pipeline||(this.pipeline=new r(this)),this._pluginPipelineSteps[w]||(this._pluginPipelineSteps[w]=[]),this._pluginPipelineSteps[w].push(this.pipeline.addWrappedStep(G,U)))}else{w=I;G=n;switch(this._pluginExtendedMethods[w]||(this._pluginExtendedMethods[w]=[]),G){case "frame":G=e;break;case "hand":G=p;break;case "pointable":G=
q;B.extend(l.prototype,U);B.extend(l.Invalid,U);break;case "finger":G=l;break;default:throw w+' specifies invalid object type "'+G+'" for prototypical extension';}B.extend(G.prototype,U);B.extend(G.Invalid,U);this._pluginExtendedMethods[w].push([G,U])}return this};F.prototype.stopUsing=function(I){var L=this._pluginPipelineSteps[I];var U=this._pluginExtendedMethods[I],n;if(this.plugins[I]){if(L)for(n=0;n<L.length;n++)this.pipeline.removeStep(L[n]);if(U)for(n=0;n<U.length;n++){L=U[n][0];var w=U[n][1];
for(var G in w)delete L.prototype[G],delete L.Invalid[G]}return delete this.plugins[I],this}};F.prototype.useRegisteredPlugins=function(){for(var I in F._pluginFactories)this.use(I)};B.extend(F.prototype,y.prototype)},{"./circular_buffer":2,"./connection/browser":4,"./connection/node":20,"./dialog":6,"./finger":7,"./frame":8,"./gesture":9,"./hand":10,"./pipeline":13,"./pointable":14,__browserify_process:22,events:21,underscore:24}],6:[function(b,h){var k=b("__browserify_process"),e=h.exports=function(p,
q){this.options=q||{};this.message=p;this.createElement()};e.prototype.createElement=function(){this.element=document.createElement("div");this.element.className="leapjs-dialog";this.element.style.position="fixed";this.element.style.top="8px";this.element.style.left=0;this.element.style.right=0;this.element.style.textAlign="center";this.element.style.zIndex=1E3;var p=document.createElement("div");this.element.appendChild(p);p.style.className="leapjs-dialog";p.style.display="inline-block";p.style.margin=
"auto";p.style.padding="8px";p.style.color="#222";p.style.background="#eee";p.style.borderRadius="4px";p.style.border="1px solid #999";p.style.textAlign="left";p.style.cursor="pointer";p.style.whiteSpace="nowrap";p.style.transition="box-shadow 1s linear";p.innerHTML=this.message;this.options.onclick&&p.addEventListener("click",this.options.onclick);this.options.onmouseover&&p.addEventListener("mouseover",this.options.onmouseover);this.options.onmouseout&&p.addEventListener("mouseout",this.options.onmouseout);
this.options.onmousemove&&p.addEventListener("mousemove",this.options.onmousemove)};e.prototype.show=function(){return document.body.appendChild(this.element),this};e.prototype.hide=function(){return document.body.removeChild(this.element),this};e.warnOutOfDate=function(p){p||(p={});var q="http://developer.leapmotion.com?";p.returnTo=window.location.href;for(var l in p)q+=l+"="+encodeURIComponent(p[l])+"&";var t;return t=new e("This site requires Leap Motion Tracking V2.<button id='leapjs-accept-upgrade'  style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 16px;'>Upgrade</button><button id='leapjs-decline-upgrade' style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 8px; '>Not Now</button>",
{onclick:function(r){"leapjs-decline-upgrade"!=r.target.id&&(r=window.open(q,"_blank","height=800,width=1000,location=1,menubar=1,resizable=1,status=1,toolbar=1,scrollbars=1"),window.focus&&r.focus());return t.hide(),!0},onmousemove:function(r){r.target==document.getElementById("leapjs-decline-upgrade")?(document.getElementById("leapjs-decline-upgrade").style.color="#000",document.getElementById("leapjs-decline-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-accept-upgrade").style.color=
"#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"):(document.getElementById("leapjs-accept-upgrade").style.color="#000",document.getElementById("leapjs-accept-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none")},onmouseout:function(){document.getElementById("leapjs-decline-upgrade").style.color="#444";document.getElementById("leapjs-decline-upgrade").style.boxShadow=
"none";document.getElementById("leapjs-accept-upgrade").style.color="#444";document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}}),t.show()};e.hasWarnedBones=!1;e.warnBones=function(){this.hasWarnedBones||(this.hasWarnedBones=!0,console.warn("Your Leap Service is out of date"),"undefined"!=typeof k&&k.versions&&k.versions.node||this.warnOutOfDate({reason:"bones"}))}},{__browserify_process:22}],7:[function(b,h){var k=b("./pointable"),e=b("./bone"),p=b("./dialog");b=b("underscore");
h=h.exports=function(q){k.call(this,q);this.dipPosition=q.dipPosition;this.pipPosition=q.pipPosition;this.mcpPosition=q.mcpPosition;this.carpPosition=q.carpPosition;this.extended=q.extended;this.type=q.type;this.finger=!0;this.positions=[this.carpPosition,this.mcpPosition,this.pipPosition,this.dipPosition,this.tipPosition];q.bases?this.addBones(q):p.warnBones()};b.extend(h.prototype,k.prototype);h.prototype.addBones=function(q){this.metacarpal=new e(this,{type:0,width:this.width,prevJoint:this.carpPosition,
nextJoint:this.mcpPosition,basis:q.bases[0]});this.proximal=new e(this,{type:1,width:this.width,prevJoint:this.mcpPosition,nextJoint:this.pipPosition,basis:q.bases[1]});this.medial=new e(this,{type:2,width:this.width,prevJoint:this.pipPosition,nextJoint:this.dipPosition,basis:q.bases[2]});this.distal=new e(this,{type:3,width:this.width,prevJoint:this.dipPosition,nextJoint:q.btipPosition,basis:q.bases[3]});this.bones=[this.metacarpal,this.proximal,this.medial,this.distal]};h.prototype.toString=function(){return"Finger [ id:"+
this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};h.Invalid={valid:!1}},{"./bone":1,"./dialog":6,"./pointable":14,underscore:24}],8:[function(b,h){var k=b("./hand"),e=b("./pointable"),p=b("./gesture").createGesture,q=b("gl-matrix"),l=q.mat3,t=q.vec3,r=b("./interaction_box"),y=b("./finger"),z=b("underscore");b=h.exports=function(E){if(this.valid=!0,this.id=E.id,this.timestamp=E.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=
[],E.interactionBox&&(this.interactionBox=new r(E.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=E.t,this._rotation=z.flatten(E.r),this._scaleFactor=E.s,this.data=E,this.type="frame",this.currentFrameRate=E.currentFrameRate,E.gestures)for(var B=0,F=E.gestures.length;B!=F;B++)this.gestures.push(p(E.gestures[B]));this.postprocessData(E)};b.prototype.postprocessData=function(E){E||(E=this.data);for(var B=0,F=E.hands.length;B!=F;B++){var I=new k(E.hands[B]);I.frame=this;this.hands.push(I);
this.handsMap[I.id]=I}E.pointables=z.sortBy(E.pointables,function(L){return L.id});B=0;for(F=E.pointables.length;B!=F;B++)I=E.pointables[B],I=I.dipPosition?new y(I):new e(I),I.frame=this,this.addPointable(I)};b.prototype.addPointable=function(E){if(this.pointables.push(E),this.pointablesMap[E.id]=E,(E.tool?this.tools:this.fingers).push(E),void 0!==E.handId&&this.handsMap.hasOwnProperty(E.handId)){var B=this.handsMap[E.handId];switch(B.pointables.push(E),(E.tool?B.tools:B.fingers).push(E),E.type){case 0:B.thumb=
E;break;case 1:B.indexFinger=E;break;case 2:B.middleFinger=E;break;case 3:B.ringFinger=E;break;case 4:B.pinky=E}}};b.prototype.tool=function(E){E=this.pointable(E);return E.tool?E:e.Invalid};b.prototype.pointable=function(E){return this.pointablesMap[E]||e.Invalid};b.prototype.finger=function(E){E=this.pointable(E);return E.tool?e.Invalid:E};b.prototype.hand=function(E){return this.handsMap[E]||k.Invalid};b.prototype.rotationAngle=function(E,B){if(!this.valid||!E.valid)return 0;var F=this.rotationMatrix(E);
F=Math.acos(.5*(F[0]+F[4]+F[8]-1));if(F=isNaN(F)?0:F,void 0!==B)E=this.rotationAxis(E),F*=t.dot(E,t.normalize(t.create(),B));return F};b.prototype.rotationAxis=function(E){return this.valid&&E.valid?t.normalize(t.create(),[this._rotation[7]-E._rotation[5],this._rotation[2]-E._rotation[6],this._rotation[3]-E._rotation[1]]):t.create()};b.prototype.rotationMatrix=function(E){if(!this.valid||!E.valid)return l.create();var B=l.transpose(l.create(),this._rotation);return l.multiply(l.create(),E._rotation,
B)};b.prototype.scaleFactor=function(E){return this.valid&&E.valid?Math.exp(this._scaleFactor-E._scaleFactor):1};b.prototype.translation=function(E){return this.valid&&E.valid?t.subtract(t.create(),this._translation,E._translation):t.create()};b.prototype.toString=function(){var E="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(E+=" | Gesture count:("+this.gestures.length+")"),E+" ]"};
b.prototype.dump=function(){var E="Frame Info:<br/>"+this.toString();E+="<br/><br/>Hands:<br/>";for(var B=0,F=this.hands.length;B!=F;B++)E+="  "+this.hands[B].toString()+"<br/>";E+="<br/><br/>Pointables:<br/>";B=0;for(F=this.pointables.length;B!=F;B++)E+="  "+this.pointables[B].toString()+"<br/>";if(this.gestures)for(E+="<br/><br/>Gestures:<br/>",B=0,F=this.gestures.length;B!=F;B++)E+="  "+this.gestures[B].toString()+"<br/>";return E+="<br/><br/>Raw JSON:<br/>",E+JSON.stringify(this.data)};b.Invalid=
{valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return e.Invalid},finger:function(){return e.Invalid},hand:function(){return k.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return l.create()},rotationAxis:function(){return t.create()},scaleFactor:function(){return 1},translation:function(){return t.create()}}},{"./finger":7,"./gesture":9,"./hand":10,"./interaction_box":12,
"./pointable":14,"gl-matrix":23,underscore:24}],9:[function(b,h,k){var e=b("gl-matrix").vec3;h=b("events").EventEmitter;var p=b("underscore"),q=(k.createGesture=function(z){switch(z.type){case "circle":var E=new l(z);break;case "swipe":E=new t(z);break;case "screenTap":E=new r(z);break;case "keyTap":E=new y(z);break;default:throw"unknown gesture type";}return E.id=z.id,E.handIds=z.handIds.slice(),E.pointableIds=z.pointableIds.slice(),E.duration=z.duration,E.state=z.state,E.type=z.type,E},k.gestureListener=
function(z,E){var B={},F={};z.on("gesture",function(L,U){if(L.type==E){if(("start"==L.state||"stop"==L.state)&&void 0===F[L.id]){var n=new q(L,U);F[L.id]=n;p.each(B,function(w,G){n.on(G,w)})}F[L.id].update(L,U);"stop"==L.state&&delete F[L.id]}});var I={start:function(L){return B.start=L,I},stop:function(L){return B.stop=L,I},complete:function(L){return B.stop=L,I},update:function(L){return B.update=L,I}};return I},k.Gesture=function(z,E){this.gestures=[z];this.frames=[E]});q.prototype.update=function(z,
E){this.lastGesture=z;this.lastFrame=E;this.gestures.push(z);this.frames.push(E);this.emit(z.state,this)};q.prototype.translation=function(){return e.subtract(e.create(),this.lastGesture.startPosition,this.lastGesture.position)};p.extend(q.prototype,h.prototype);var l=function(z){this.center=z.center;this.normal=z.normal;this.progress=z.progress;this.radius=z.radius};l.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var t=function(z){this.startPosition=z.startPosition;
this.position=z.position;this.direction=z.direction;this.speed=z.speed};t.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var r=function(z){this.position=z.position;this.direction=z.direction;this.progress=z.progress};r.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var y=function(z){this.position=z.position;this.direction=z.direction;this.progress=z.progress};y.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+
"]"}},{events:21,"gl-matrix":23,underscore:24}],10:[function(b,h){var k=b("./pointable"),e=b("./bone"),p=b("gl-matrix"),q=p.mat3,l=p.vec3,t=b("underscore");b=h.exports=function(r){this.id=r.id;this.palmPosition=r.palmPosition;this.direction=r.direction;this.palmVelocity=r.palmVelocity;this.palmNormal=r.palmNormal;this.sphereCenter=r.sphereCenter;this.sphereRadius=r.sphereRadius;this.valid=!0;this.pointables=[];this.fingers=[];this.arm=r.armBasis?new e(this,{type:4,width:r.armWidth,prevJoint:r.elbow,
nextJoint:r.wrist,basis:r.armBasis}):null;this.tools=[];this._translation=r.t;this._rotation=t.flatten(r.r);this._scaleFactor=r.s;this.timeVisible=r.timeVisible;this.stabilizedPalmPosition=r.stabilizedPalmPosition;this.type=r.type;this.grabStrength=r.grabStrength;this.pinchStrength=r.pinchStrength;this.confidence=r.confidence};b.prototype.finger=function(r){return(r=this.frame.finger(r))&&r.handId==this.id?r:k.Invalid};b.prototype.rotationAngle=function(r,y){if(!this.valid||!r.valid||!r.hand(this.id).valid)return 0;
var z=this.rotationMatrix(r);z=Math.acos(.5*(z[0]+z[4]+z[8]-1));if(z=isNaN(z)?0:z,void 0!==y)r=this.rotationAxis(r),z*=l.dot(r,l.normalize(l.create(),y));return z};b.prototype.rotationAxis=function(r){if(!this.valid||!r.valid)return l.create();r=r.hand(this.id);return r.valid?l.normalize(l.create(),[this._rotation[7]-r._rotation[5],this._rotation[2]-r._rotation[6],this._rotation[3]-r._rotation[1]]):l.create()};b.prototype.rotationMatrix=function(r){if(!this.valid||!r.valid)return q.create();r=r.hand(this.id);
if(!r.valid)return q.create();var y=q.transpose(q.create(),this._rotation);return q.multiply(q.create(),r._rotation,y)};b.prototype.scaleFactor=function(r){if(!this.valid||!r.valid)return 1;r=r.hand(this.id);return r.valid?Math.exp(this._scaleFactor-r._scaleFactor):1};b.prototype.translation=function(r){if(!this.valid||!r.valid)return l.create();r=r.hand(this.id);return r.valid?[this._translation[0]-r._translation[0],this._translation[1]-r._translation[1],this._translation[2]-r._translation[2]]:l.create()};
b.prototype.toString=function(){return"Hand ("+this.type+") [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "};b.prototype.pitch=function(){return Math.atan2(this.direction[1],-this.direction[2])};b.prototype.yaw=function(){return Math.atan2(this.direction[0],-this.direction[2])};b.prototype.roll=function(){return Math.atan2(this.palmNormal[0],-this.palmNormal[1])};b.Invalid={valid:!1,fingers:[],tools:[],pointables:[],left:!1,pointable:function(){return k.Invalid},
finger:function(){return k.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return q.create()},rotationAxis:function(){return l.create()},scaleFactor:function(){return 1},translation:function(){return l.create()}}},{"./bone":1,"./pointable":14,"gl-matrix":23,underscore:24}],11:[function(b,h){h.exports={Controller:b("./controller"),Frame:b("./frame"),Gesture:b("./gesture"),Hand:b("./hand"),Pointable:b("./pointable"),
Finger:b("./finger"),InteractionBox:b("./interaction_box"),CircularBuffer:b("./circular_buffer"),UI:b("./ui"),JSONProtocol:b("./protocol").JSONProtocol,glMatrix:b("gl-matrix"),mat3:b("gl-matrix").mat3,vec3:b("gl-matrix").vec3,loopController:void 0,version:b("./version.js"),_:b("underscore"),EventEmitter:b("events").EventEmitter,loop:function(k,e){return k&&void 0===e&&"[object Function]"==={}.toString.call(k)&&(e=k,k={}),this.loopController?k&&this.loopController.setupFrameEvents(k):this.loopController=
new this.Controller(k),this.loopController.loop(e),this.loopController},plugin:function(k,e){this.Controller.plugin(k,e)}}},{"./circular_buffer":2,"./controller":5,"./finger":7,"./frame":8,"./gesture":9,"./hand":10,"./interaction_box":12,"./pointable":14,"./protocol":15,"./ui":16,"./version.js":19,events:21,"gl-matrix":23,underscore:24}],12:[function(b,h){var k=b("gl-matrix").vec3;b=h.exports=function(e){this.valid=!0;this.center=e.center;this.size=e.size;this.width=e.size[0];this.height=e.size[1];
this.depth=e.size[2]};b.prototype.denormalizePoint=function(e){return k.fromValues((e[0]-.5)*this.size[0]+this.center[0],(e[1]-.5)*this.size[1]+this.center[1],(e[2]-.5)*this.size[2]+this.center[2])};b.prototype.normalizePoint=function(e,p){e=k.fromValues((e[0]-this.center[0])/this.size[0]+.5,(e[1]-this.center[1])/this.size[1]+.5,(e[2]-this.center[2])/this.size[2]+.5);return p&&(e[0]=Math.min(Math.max(e[0],0),1),e[1]=Math.min(Math.max(e[1],0),1),e[2]=Math.min(Math.max(e[2],0),1)),e};b.prototype.toString=
function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"};b.Invalid={valid:!1}},{"gl-matrix":23}],13:[function(b,h){b=h.exports=function(k){this.steps=[];this.controller=k};b.prototype.addStep=function(k){this.steps.push(k)};b.prototype.run=function(k){for(var e=this.steps.length,p=0;p!=e&&k;p++)k=this.steps[p](k);return k};b.prototype.removeStep=function(k){k=this.steps.indexOf(k);if(-1===k)throw"Step not found in pipeline";this.steps.splice(k,1)};
b.prototype.addWrappedStep=function(k,e){var p=this.controller,q=function(l){var t;var r="frame"==k?[l]:l[k+"s"]||[];var y=0;for(t=r.length;t>y;y++)e.call(p,r[y]);return l};return this.addStep(q),q}},{}],14:[function(b,h){b=b("gl-matrix");h=(b.vec3,h.exports=function(k){this.valid=!0;this.id=k.id;this.handId=k.handId;this.length=k.length;this.tool=k.tool;this.width=k.width;this.direction=k.direction;this.stabilizedTipPosition=k.stabilizedTipPosition;this.tipPosition=k.tipPosition;this.tipVelocity=
k.tipVelocity;this.touchZone=k.touchZone;this.touchDistance=k.touchDistance;this.timeVisible=k.timeVisible});h.prototype.toString=function(){return"Pointable [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"};h.prototype.hand=function(){return this.frame.hand(this.handId)};h.Invalid={valid:!1}},{"gl-matrix":23}],15:[function(b,h,k){var e=b("./frame"),p=(b("./hand"),b("./pointable"),b("./finger"),b("underscore")),q=b("events").EventEmitter,l=function(r){this.type=
r.type;this.state=r.state};k.chooseProtocol=function(r){switch(r.version){case 1:case 2:case 3:case 4:case 5:case 6:var y=t(r);y.sendBackground=function(z,E){z.send(y.encode({background:E}))};y.sendFocused=function(z,E){z.send(y.encode({focused:E}))};y.sendOptimizeHMD=function(z,E){z.send(y.encode({optimizeHMD:E}))};break;default:throw"unrecognized version";}return y};var t=k.JSONProtocol=function(r){var y=function(z){if(z.event)return new l(z.event);y.emit("beforeFrameCreated",z);var E=new e(z);
return y.emit("afterFrameCreated",E,z),E};return y.encode=function(z){return JSON.stringify(z)},y.version=r.version,y.serviceVersion=r.serviceVersion,y.versionLong="Version "+r.version,y.type="protocol",p.extend(y,q.prototype),y}},{"./finger":7,"./frame":8,"./hand":10,"./pointable":14,events:21,underscore:24}],16:[function(b,h,k){k.UI={Region:b("./ui/region"),Cursor:b("./ui/cursor")}},{"./ui/cursor":17,"./ui/region":18}],17:[function(b,h){h.exports=function(){return function(k){var e=k.pointables.sort(function(p,
q){return p.z-q.z})[0];return e&&e.valid&&(k.cursorPosition=e.tipPosition),k}}},{}],18:[function(b,h){var k=b("events").EventEmitter;b=b("underscore");var e=h.exports=function(p,q){this.start=new Vector(p);this.end=new Vector(q);this.enteredFrame=null};e.prototype.hasPointables=function(p){for(var q=0;q!=p.pointables.length;q++){var l=p.pointables[q].tipPosition;if(l.x>=this.start.x&&l.x<=this.end.x&&l.y>=this.start.y&&l.y<=this.end.y&&l.z>=this.start.z&&l.z<=this.end.z)return!0}return!1};e.prototype.listener=
function(p){var q=this;return p&&p.nearThreshold&&this.setupNearRegion(p.nearThreshold),function(l){return q.updatePosition(l)}};e.prototype.clipper=function(){var p=this;return function(q){return p.updatePosition(q),p.enteredFrame?q:null}};e.prototype.setupNearRegion=function(p){p=this.nearRegion=new e([this.start.x-p,this.start.y-p,this.start.z-p],[this.end.x+p,this.end.y+p,this.end.z+p]);var q=this;p.on("enter",function(l){q.emit("near",l)});p.on("exit",function(l){q.emit("far",l)});q.on("exit",
function(l){q.emit("near",l)})};e.prototype.updatePosition=function(p){return this.nearRegion&&this.nearRegion.updatePosition(p),this.hasPointables(p)&&null==this.enteredFrame?(this.enteredFrame=p,this.emit("enter",this.enteredFrame)):this.hasPointables(p)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),p};e.prototype.normalize=function(p){return new Vector([(p.x-this.start.x)/(this.end.x-this.start.x),(p.y-this.start.y)/(this.end.y-this.start.y),(p.z-this.start.z)/
(this.end.z-this.start.z)])};e.prototype.mapToXY=function(p,q,l){p=this.normalize(p);var t=p.x,r=p.y;return 1<t?t=1:-1>t&&(t=-1),1<r?r=1:-1>r&&(r=-1),[(t+1)/2*q,(1-r)/2*l,p.z]};b.extend(e.prototype,k.prototype)},{events:21,underscore:24}],19:[function(b,h){h.exports={full:"0.6.4",major:0,minor:6,dot:4}},{}],20:[function(){},{}],21:[function(b,h,k){b=b("__browserify_process");b.EventEmitter||(b.EventEmitter=function(){});k=k.EventEmitter=b.EventEmitter;var e="function"==typeof Array.isArray?Array.isArray:
function(p){return"[object Array]"===Object.prototype.toString.call(p)};k.prototype.setMaxListeners=function(p){this._events||(this._events={});this._events.maxListeners=p};k.prototype.emit=function(p){if("error"===p&&(!this._events||!this._events.error||e(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var q=this._events[p];if(!q)return!1;if("function"==typeof q){switch(arguments.length){case 1:q.call(this);
break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:var l=Array.prototype.slice.call(arguments,1);q.apply(this,l)}return!0}if(e(q)){l=Array.prototype.slice.call(arguments,1);q=q.slice();for(var t=0,r=q.length;r>t;t++)q[t].apply(this,l);return!0}return!1};k.prototype.addListener=function(p,q){if("function"!=typeof q)throw Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",p,q),this._events[p])if(e(this._events[p])){if(!this._events[p].warned){var l;
(l=void 0!==this._events.maxListeners?this._events.maxListeners:10)&&0<l&&this._events[p].length>l&&(this._events[p].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[p].length),console.trace())}this._events[p].push(q)}else this._events[p]=[this._events[p],q];else this._events[p]=q;return this};k.prototype.on=k.prototype.addListener;k.prototype.once=function(p,q){var l=this;return l.on(p,
function r(){l.removeListener(p,r);q.apply(this,arguments)}),this};k.prototype.removeListener=function(p,q){if("function"!=typeof q)throw Error("removeListener only takes instances of Function");if(!this._events||!this._events[p])return this;var l=this._events[p];if(e(l)){a:if(l.indexOf)q=l.indexOf(q);else{for(var t=0;t<l.length;t++)if(q===l[t]){q=t;break a}q=-1}if(0>q)return this;l.splice(q,1);0==l.length&&delete this._events[p]}else this._events[p]===q&&delete this._events[p];return this};k.prototype.removeAllListeners=
function(p){return 0===arguments.length?(this._events={},this):(p&&this._events&&this._events[p]&&(this._events[p]=null),this)};k.prototype.listeners=function(p){return this._events||(this._events={}),this._events[p]||(this._events[p]=[]),e(this._events[p])||(this._events[p]=[this._events[p]]),this._events[p]};k.listenerCount=function(p,q){return p._events&&p._events[q]?"function"==typeof p._events[q]?1:p._events[q].length:0}},{__browserify_process:22}],22:[function(b,h){b=h.exports={};b.nextTick=
function(){if("undefined"!=typeof window&&window.setImmediate)return function(e){return window.setImmediate(e)};if("undefined"!=typeof window&&window.postMessage&&window.addEventListener){var k=[];return window.addEventListener("message",function(e){var p=e.source;(p===window||null===p)&&"process-tick"===e.data&&(e.stopPropagation(),0<k.length)&&k.shift()()},!0),function(e){k.push(e);window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}();b.title="browser";b.browser=!0;b.env=
{};b.argv=[];b.binding=function(){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(){throw Error("process.chdir is not supported");}},{}],23:[function(b,h,k){!function(e){var p;"undefined"==typeof k?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(p={},define(function(){return p})):p="undefined"!=typeof window?window:e:p=k;(function(q){if(!l)var l=1E-6;if(!t)var t="undefined"!=typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;
var y={setMatrixArrayType:function(n){t=n}};"undefined"!=typeof q&&(q.glMatrix=y);var z=Math.PI/180;y.toRadian=function(n){return n*z};var E={create:function(){var n=new t(2);return n[0]=0,n[1]=0,n},clone:function(n){var w=new t(2);return w[0]=n[0],w[1]=n[1],w},fromValues:function(n,w){var G=new t(2);return G[0]=n,G[1]=w,G},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n},set:function(n,w,G){return n[0]=w,n[1]=G,n},add:function(n,w,G){return n[0]=w[0]+G[0],n[1]=w[1]+G[1],n},subtract:function(n,w,
G){return n[0]=w[0]-G[0],n[1]=w[1]-G[1],n}};E.sub=E.subtract;E.multiply=function(n,w,G){return n[0]=w[0]*G[0],n[1]=w[1]*G[1],n};E.mul=E.multiply;E.divide=function(n,w,G){return n[0]=w[0]/G[0],n[1]=w[1]/G[1],n};E.div=E.divide;E.min=function(n,w,G){return n[0]=Math.min(w[0],G[0]),n[1]=Math.min(w[1],G[1]),n};E.max=function(n,w,G){return n[0]=Math.max(w[0],G[0]),n[1]=Math.max(w[1],G[1]),n};E.scale=function(n,w,G){return n[0]=w[0]*G,n[1]=w[1]*G,n};E.scaleAndAdd=function(n,w,G,f){return n[0]=w[0]+G[0]*
f,n[1]=w[1]+G[1]*f,n};E.distance=function(n,w){var G=w[0]-n[0];n=w[1]-n[1];return Math.sqrt(G*G+n*n)};E.dist=E.distance;E.squaredDistance=function(n,w){var G=w[0]-n[0];n=w[1]-n[1];return G*G+n*n};E.sqrDist=E.squaredDistance;E.length=function(n){var w=n[0];n=n[1];return Math.sqrt(w*w+n*n)};E.len=E.length;E.squaredLength=function(n){var w=n[0];n=n[1];return w*w+n*n};E.sqrLen=E.squaredLength;E.negate=function(n,w){return n[0]=-w[0],n[1]=-w[1],n};E.normalize=function(n,w){var G=w[0],f=w[1];G=G*G+f*f;
return 0<G&&(G=1/Math.sqrt(G),n[0]=w[0]*G,n[1]=w[1]*G),n};E.dot=function(n,w){return n[0]*w[0]+n[1]*w[1]};E.cross=function(n,w,G){w=w[0]*G[1]-w[1]*G[0];return n[0]=n[1]=0,n[2]=w,n};E.lerp=function(n,w,G,f){var m=w[0];w=w[1];return n[0]=m+f*(G[0]-m),n[1]=w+f*(G[1]-w),n};E.random=function(n,w){w=w||1;var G=2*r()*Math.PI;return n[0]=Math.cos(G)*w,n[1]=Math.sin(G)*w,n};E.transformMat2=function(n,w,G){var f=w[0];w=w[1];return n[0]=G[0]*f+G[2]*w,n[1]=G[1]*f+G[3]*w,n};E.transformMat2d=function(n,w,G){var f=
w[0];w=w[1];return n[0]=G[0]*f+G[2]*w+G[4],n[1]=G[1]*f+G[3]*w+G[5],n};E.transformMat3=function(n,w,G){var f=w[0];w=w[1];return n[0]=G[0]*f+G[3]*w+G[6],n[1]=G[1]*f+G[4]*w+G[7],n};E.transformMat4=function(n,w,G){var f=w[0];w=w[1];return n[0]=G[0]*f+G[4]*w+G[12],n[1]=G[1]*f+G[5]*w+G[13],n};E.forEach=function(){var n=E.create();return function(w,G,f,m,v,D){G||(G=2);f||(f=0);for(m=m?Math.min(m*G+f,w.length):w.length;m>f;f+=G)n[0]=w[f],n[1]=w[f+1],v(n,n,D),w[f]=n[0],w[f+1]=n[1];return w}}();E.str=function(n){return"vec2("+
n[0]+", "+n[1]+")"};"undefined"!=typeof q&&(q.vec2=E);var B={create:function(){var n=new t(3);return n[0]=0,n[1]=0,n[2]=0,n},clone:function(n){var w=new t(3);return w[0]=n[0],w[1]=n[1],w[2]=n[2],w},fromValues:function(n,w,G){var f=new t(3);return f[0]=n,f[1]=w,f[2]=G,f},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],n},set:function(n,w,G,f){return n[0]=w,n[1]=G,n[2]=f,n},add:function(n,w,G){return n[0]=w[0]+G[0],n[1]=w[1]+G[1],n[2]=w[2]+G[2],n},subtract:function(n,w,G){return n[0]=w[0]-G[0],
n[1]=w[1]-G[1],n[2]=w[2]-G[2],n}};B.sub=B.subtract;B.multiply=function(n,w,G){return n[0]=w[0]*G[0],n[1]=w[1]*G[1],n[2]=w[2]*G[2],n};B.mul=B.multiply;B.divide=function(n,w,G){return n[0]=w[0]/G[0],n[1]=w[1]/G[1],n[2]=w[2]/G[2],n};B.div=B.divide;B.min=function(n,w,G){return n[0]=Math.min(w[0],G[0]),n[1]=Math.min(w[1],G[1]),n[2]=Math.min(w[2],G[2]),n};B.max=function(n,w,G){return n[0]=Math.max(w[0],G[0]),n[1]=Math.max(w[1],G[1]),n[2]=Math.max(w[2],G[2]),n};B.scale=function(n,w,G){return n[0]=w[0]*G,
n[1]=w[1]*G,n[2]=w[2]*G,n};B.scaleAndAdd=function(n,w,G,f){return n[0]=w[0]+G[0]*f,n[1]=w[1]+G[1]*f,n[2]=w[2]+G[2]*f,n};B.distance=function(n,w){var G=w[0]-n[0],f=w[1]-n[1];n=w[2]-n[2];return Math.sqrt(G*G+f*f+n*n)};B.dist=B.distance;B.squaredDistance=function(n,w){var G=w[0]-n[0],f=w[1]-n[1];n=w[2]-n[2];return G*G+f*f+n*n};B.sqrDist=B.squaredDistance;B.length=function(n){var w=n[0],G=n[1];n=n[2];return Math.sqrt(w*w+G*G+n*n)};B.len=B.length;B.squaredLength=function(n){var w=n[0],G=n[1];n=n[2];return w*
w+G*G+n*n};B.sqrLen=B.squaredLength;B.negate=function(n,w){return n[0]=-w[0],n[1]=-w[1],n[2]=-w[2],n};B.normalize=function(n,w){var G=w[0],f=w[1],m=w[2];G=G*G+f*f+m*m;return 0<G&&(G=1/Math.sqrt(G),n[0]=w[0]*G,n[1]=w[1]*G,n[2]=w[2]*G),n};B.dot=function(n,w){return n[0]*w[0]+n[1]*w[1]+n[2]*w[2]};B.cross=function(n,w,G){var f=w[0],m=w[1];w=w[2];var v=G[0],D=G[1];G=G[2];return n[0]=m*G-w*D,n[1]=w*v-f*G,n[2]=f*D-m*v,n};B.lerp=function(n,w,G,f){var m=w[0],v=w[1];w=w[2];return n[0]=m+f*(G[0]-m),n[1]=v+f*
(G[1]-v),n[2]=w+f*(G[2]-w),n};B.random=function(n,w){w=w||1;var G=2*r()*Math.PI,f=2*r()-1,m=Math.sqrt(1-f*f)*w;return n[0]=Math.cos(G)*m,n[1]=Math.sin(G)*m,n[2]=f*w,n};B.transformMat4=function(n,w,G){var f=w[0],m=w[1];w=w[2];return n[0]=G[0]*f+G[4]*m+G[8]*w+G[12],n[1]=G[1]*f+G[5]*m+G[9]*w+G[13],n[2]=G[2]*f+G[6]*m+G[10]*w+G[14],n};B.transformMat3=function(n,w,G){var f=w[0],m=w[1];w=w[2];return n[0]=f*G[0]+m*G[3]+w*G[6],n[1]=f*G[1]+m*G[4]+w*G[7],n[2]=f*G[2]+m*G[5]+w*G[8],n};B.transformQuat=function(n,
w,G){var f=w[0],m=w[1],v=w[2];w=G[0];var D=G[1],C=G[2];G=G[3];var J=G*f+D*v-C*m,N=G*m+C*f-w*v,S=G*v+w*m-D*f;f=-w*f-D*m-C*v;return n[0]=J*G+f*-w+N*-C-S*-D,n[1]=N*G+f*-D+S*-w-J*-C,n[2]=S*G+f*-C+J*-D-N*-w,n};B.rotateX=function(n,w,G,f){var m=[],v=[];return m[0]=w[0]-G[0],m[1]=w[1]-G[1],m[2]=w[2]-G[2],v[0]=m[0],v[1]=m[1]*Math.cos(f)-m[2]*Math.sin(f),v[2]=m[1]*Math.sin(f)+m[2]*Math.cos(f),n[0]=v[0]+G[0],n[1]=v[1]+G[1],n[2]=v[2]+G[2],n};B.rotateY=function(n,w,G,f){var m=[],v=[];return m[0]=w[0]-G[0],m[1]=
w[1]-G[1],m[2]=w[2]-G[2],v[0]=m[2]*Math.sin(f)+m[0]*Math.cos(f),v[1]=m[1],v[2]=m[2]*Math.cos(f)-m[0]*Math.sin(f),n[0]=v[0]+G[0],n[1]=v[1]+G[1],n[2]=v[2]+G[2],n};B.rotateZ=function(n,w,G,f){var m=[],v=[];return m[0]=w[0]-G[0],m[1]=w[1]-G[1],m[2]=w[2]-G[2],v[0]=m[0]*Math.cos(f)-m[1]*Math.sin(f),v[1]=m[0]*Math.sin(f)+m[1]*Math.cos(f),v[2]=m[2],n[0]=v[0]+G[0],n[1]=v[1]+G[1],n[2]=v[2]+G[2],n};B.forEach=function(){var n=B.create();return function(w,G,f,m,v,D){G||(G=3);f||(f=0);for(m=m?Math.min(m*G+f,w.length):
w.length;m>f;f+=G)n[0]=w[f],n[1]=w[f+1],n[2]=w[f+2],v(n,n,D),w[f]=n[0],w[f+1]=n[1],w[f+2]=n[2];return w}}();B.str=function(n){return"vec3("+n[0]+", "+n[1]+", "+n[2]+")"};"undefined"!=typeof q&&(q.vec3=B);var F={create:function(){var n=new t(4);return n[0]=0,n[1]=0,n[2]=0,n[3]=0,n},clone:function(n){var w=new t(4);return w[0]=n[0],w[1]=n[1],w[2]=n[2],w[3]=n[3],w},fromValues:function(n,w,G,f){var m=new t(4);return m[0]=n,m[1]=w,m[2]=G,m[3]=f,m},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],
n[3]=w[3],n},set:function(n,w,G,f,m){return n[0]=w,n[1]=G,n[2]=f,n[3]=m,n},add:function(n,w,G){return n[0]=w[0]+G[0],n[1]=w[1]+G[1],n[2]=w[2]+G[2],n[3]=w[3]+G[3],n},subtract:function(n,w,G){return n[0]=w[0]-G[0],n[1]=w[1]-G[1],n[2]=w[2]-G[2],n[3]=w[3]-G[3],n}};F.sub=F.subtract;F.multiply=function(n,w,G){return n[0]=w[0]*G[0],n[1]=w[1]*G[1],n[2]=w[2]*G[2],n[3]=w[3]*G[3],n};F.mul=F.multiply;F.divide=function(n,w,G){return n[0]=w[0]/G[0],n[1]=w[1]/G[1],n[2]=w[2]/G[2],n[3]=w[3]/G[3],n};F.div=F.divide;
F.min=function(n,w,G){return n[0]=Math.min(w[0],G[0]),n[1]=Math.min(w[1],G[1]),n[2]=Math.min(w[2],G[2]),n[3]=Math.min(w[3],G[3]),n};F.max=function(n,w,G){return n[0]=Math.max(w[0],G[0]),n[1]=Math.max(w[1],G[1]),n[2]=Math.max(w[2],G[2]),n[3]=Math.max(w[3],G[3]),n};F.scale=function(n,w,G){return n[0]=w[0]*G,n[1]=w[1]*G,n[2]=w[2]*G,n[3]=w[3]*G,n};F.scaleAndAdd=function(n,w,G,f){return n[0]=w[0]+G[0]*f,n[1]=w[1]+G[1]*f,n[2]=w[2]+G[2]*f,n[3]=w[3]+G[3]*f,n};F.distance=function(n,w){var G=w[0]-n[0],f=w[1]-
n[1],m=w[2]-n[2];n=w[3]-n[3];return Math.sqrt(G*G+f*f+m*m+n*n)};F.dist=F.distance;F.squaredDistance=function(n,w){var G=w[0]-n[0],f=w[1]-n[1],m=w[2]-n[2];n=w[3]-n[3];return G*G+f*f+m*m+n*n};F.sqrDist=F.squaredDistance;F.length=function(n){var w=n[0],G=n[1],f=n[2];n=n[3];return Math.sqrt(w*w+G*G+f*f+n*n)};F.len=F.length;F.squaredLength=function(n){var w=n[0],G=n[1],f=n[2];n=n[3];return w*w+G*G+f*f+n*n};F.sqrLen=F.squaredLength;F.negate=function(n,w){return n[0]=-w[0],n[1]=-w[1],n[2]=-w[2],n[3]=-w[3],
n};F.normalize=function(n,w){var G=w[0],f=w[1],m=w[2],v=w[3];G=G*G+f*f+m*m+v*v;return 0<G&&(G=1/Math.sqrt(G),n[0]=w[0]*G,n[1]=w[1]*G,n[2]=w[2]*G,n[3]=w[3]*G),n};F.dot=function(n,w){return n[0]*w[0]+n[1]*w[1]+n[2]*w[2]+n[3]*w[3]};F.lerp=function(n,w,G,f){var m=w[0],v=w[1],D=w[2];w=w[3];return n[0]=m+f*(G[0]-m),n[1]=v+f*(G[1]-v),n[2]=D+f*(G[2]-D),n[3]=w+f*(G[3]-w),n};F.random=function(n,w){return w=w||1,n[0]=r(),n[1]=r(),n[2]=r(),n[3]=r(),F.normalize(n,n),F.scale(n,n,w),n};F.transformMat4=function(n,
w,G){var f=w[0],m=w[1],v=w[2];w=w[3];return n[0]=G[0]*f+G[4]*m+G[8]*v+G[12]*w,n[1]=G[1]*f+G[5]*m+G[9]*v+G[13]*w,n[2]=G[2]*f+G[6]*m+G[10]*v+G[14]*w,n[3]=G[3]*f+G[7]*m+G[11]*v+G[15]*w,n};F.transformQuat=function(n,w,G){var f=w[0],m=w[1],v=w[2];w=G[0];var D=G[1],C=G[2];G=G[3];var J=G*f+D*v-C*m,N=G*m+C*f-w*v,S=G*v+w*m-D*f;f=-w*f-D*m-C*v;return n[0]=J*G+f*-w+N*-C-S*-D,n[1]=N*G+f*-D+S*-w-J*-C,n[2]=S*G+f*-C+J*-D-N*-w,n};F.forEach=function(){var n=F.create();return function(w,G,f,m,v,D){G||(G=4);f||(f=0);
for(m=m?Math.min(m*G+f,w.length):w.length;m>f;f+=G)n[0]=w[f],n[1]=w[f+1],n[2]=w[f+2],n[3]=w[f+3],v(n,n,D),w[f]=n[0],w[f+1]=n[1],w[f+2]=n[2],w[f+3]=n[3];return w}}();F.str=function(n){return"vec4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};"undefined"!=typeof q&&(q.vec4=F);y={create:function(){var n=new t(4);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n},clone:function(n){var w=new t(4);return w[0]=n[0],w[1]=n[1],w[2]=n[2],w[3]=n[3],w},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],n[3]=w[3],n},identity:function(n){return n[0]=
1,n[1]=0,n[2]=0,n[3]=1,n},transpose:function(n,w){if(n===w){var G=w[1];n[1]=w[2];n[2]=G}else n[0]=w[0],n[1]=w[2],n[2]=w[1],n[3]=w[3];return n},invert:function(n,w){var G=w[0],f=w[1],m=w[2];w=w[3];var v=G*w-m*f;return v?(v=1/v,n[0]=w*v,n[1]=-f*v,n[2]=-m*v,n[3]=G*v,n):null},adjoint:function(n,w){var G=w[0];return n[0]=w[3],n[1]=-w[1],n[2]=-w[2],n[3]=G,n},determinant:function(n){return n[0]*n[3]-n[2]*n[1]},multiply:function(n,w,G){var f=w[0],m=w[1],v=w[2];w=w[3];var D=G[0],C=G[1],J=G[2];G=G[3];return n[0]=
f*D+v*C,n[1]=m*D+w*C,n[2]=f*J+v*G,n[3]=m*J+w*G,n}};y.mul=y.multiply;y.rotate=function(n,w,G){var f=w[0],m=w[1],v=w[2];w=w[3];var D=Math.sin(G);G=Math.cos(G);return n[0]=f*G+v*D,n[1]=m*G+w*D,n[2]=f*-D+v*G,n[3]=m*-D+w*G,n};y.scale=function(n,w,G){var f=w[1],m=w[2],v=w[3],D=G[0];G=G[1];return n[0]=w[0]*D,n[1]=f*D,n[2]=m*G,n[3]=v*G,n};y.str=function(n){return"mat2("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};y.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],
2))};y.LDU=function(n,w,G,f){return n[2]=f[2]/f[0],G[0]=f[0],G[1]=f[1],G[3]=f[3]-n[2]*G[1],[n,w,G]};"undefined"!=typeof q&&(q.mat2=y);y={create:function(){var n=new t(6);return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},clone:function(n){var w=new t(6);return w[0]=n[0],w[1]=n[1],w[2]=n[2],w[3]=n[3],w[4]=n[4],w[5]=n[5],w},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],n[3]=w[3],n[4]=w[4],n[5]=w[5],n},identity:function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=1,n[4]=0,n[5]=0,n},invert:function(n,
w){var G=w[0],f=w[1],m=w[2],v=w[3],D=w[4];w=w[5];var C=G*v-f*m;return C?(C=1/C,n[0]=v*C,n[1]=-f*C,n[2]=-m*C,n[3]=G*C,n[4]=(m*w-v*D)*C,n[5]=(f*D-G*w)*C,n):null},determinant:function(n){return n[0]*n[3]-n[1]*n[2]},multiply:function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=w[4];w=w[5];var J=G[0],N=G[1],S=G[2],T=G[3],W=G[4];G=G[5];return n[0]=f*J+v*N,n[1]=m*J+D*N,n[2]=f*S+v*T,n[3]=m*S+D*T,n[4]=f*W+v*G+C,n[5]=m*W+D*G+w,n}};y.mul=y.multiply;y.rotate=function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=w[4];
w=w[5];var J=Math.sin(G);G=Math.cos(G);return n[0]=f*G+v*J,n[1]=m*G+D*J,n[2]=f*-J+v*G,n[3]=m*-J+D*G,n[4]=C,n[5]=w,n};y.scale=function(n,w,G){var f=w[1],m=w[2],v=w[3],D=w[4],C=w[5],J=G[0];G=G[1];return n[0]=w[0]*J,n[1]=f*J,n[2]=m*G,n[3]=v*G,n[4]=D,n[5]=C,n};y.translate=function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=w[4];w=w[5];var J=G[0];G=G[1];return n[0]=f,n[1]=m,n[2]=v,n[3]=D,n[4]=f*J+v*G+C,n[5]=m*J+D*G+w,n};y.str=function(n){return"mat2d("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+
")"};y.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+1)};"undefined"!=typeof q&&(q.mat2d=y);var I={create:function(){var n=new t(9);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},fromMat4:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],n[3]=w[4],n[4]=w[5],n[5]=w[6],n[6]=w[8],n[7]=w[9],n[8]=w[10],n},clone:function(n){var w=new t(9);return w[0]=n[0],w[1]=n[1],w[2]=n[2],w[3]=n[3],w[4]=
n[4],w[5]=n[5],w[6]=n[6],w[7]=n[7],w[8]=n[8],w},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],n[3]=w[3],n[4]=w[4],n[5]=w[5],n[6]=w[6],n[7]=w[7],n[8]=w[8],n},identity:function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=1,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},transpose:function(n,w){if(n===w){var G=w[1],f=w[2],m=w[5];n[1]=w[3];n[2]=w[6];n[3]=G;n[5]=w[7];n[6]=f;n[7]=m}else n[0]=w[0],n[1]=w[3],n[2]=w[6],n[3]=w[1],n[4]=w[4],n[5]=w[7],n[6]=w[2],n[7]=w[5],n[8]=w[8];return n},invert:function(n,w){var G=
w[0],f=w[1],m=w[2],v=w[3],D=w[4],C=w[5],J=w[6],N=w[7];w=w[8];var S=w*D-C*N,T=-w*v+C*J,W=N*v-D*J,Y=G*S+f*T+m*W;return Y?(Y=1/Y,n[0]=S*Y,n[1]=(-w*f+m*N)*Y,n[2]=(C*f-m*D)*Y,n[3]=T*Y,n[4]=(w*G-m*J)*Y,n[5]=(-C*G+m*v)*Y,n[6]=W*Y,n[7]=(-N*G+f*J)*Y,n[8]=(D*G-f*v)*Y,n):null},adjoint:function(n,w){var G=w[0],f=w[1],m=w[2],v=w[3],D=w[4],C=w[5],J=w[6],N=w[7];w=w[8];return n[0]=D*w-C*N,n[1]=m*N-f*w,n[2]=f*C-m*D,n[3]=C*J-v*w,n[4]=G*w-m*J,n[5]=m*v-G*C,n[6]=v*N-D*J,n[7]=f*J-G*N,n[8]=G*D-f*v,n},determinant:function(n){var w=
n[3],G=n[4],f=n[5],m=n[6],v=n[7],D=n[8];return n[0]*(D*G-f*v)+n[1]*(-D*w+f*m)+n[2]*(v*w-G*m)},multiply:function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=w[4],J=w[5],N=w[6],S=w[7];w=w[8];var T=G[0],W=G[1],Y=G[2],V=G[3],ma=G[4],ha=G[5],ia=G[6],aa=G[7];G=G[8];return n[0]=T*f+W*D+Y*N,n[1]=T*m+W*C+Y*S,n[2]=T*v+W*J+Y*w,n[3]=V*f+ma*D+ha*N,n[4]=V*m+ma*C+ha*S,n[5]=V*v+ma*J+ha*w,n[6]=ia*f+aa*D+G*N,n[7]=ia*m+aa*C+G*S,n[8]=ia*v+aa*J+G*w,n}};I.mul=I.multiply;I.translate=function(n,w,G){var f=w[0],m=w[1],v=w[2],
D=w[3],C=w[4],J=w[5],N=w[6],S=w[7];w=w[8];var T=G[0];G=G[1];return n[0]=f,n[1]=m,n[2]=v,n[3]=D,n[4]=C,n[5]=J,n[6]=T*f+G*D+N,n[7]=T*m+G*C+S,n[8]=T*v+G*J+w,n};I.rotate=function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=w[4],J=w[5],N=w[6],S=w[7];w=w[8];var T=Math.sin(G);G=Math.cos(G);return n[0]=G*f+T*D,n[1]=G*m+T*C,n[2]=G*v+T*J,n[3]=G*D-T*f,n[4]=G*C-T*m,n[5]=G*J-T*v,n[6]=N,n[7]=S,n[8]=w,n};I.scale=function(n,w,G){var f=G[0];G=G[1];return n[0]=f*w[0],n[1]=f*w[1],n[2]=f*w[2],n[3]=G*w[3],n[4]=G*w[4],n[5]=
G*w[5],n[6]=w[6],n[7]=w[7],n[8]=w[8],n};I.fromMat2d=function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=0,n[3]=w[2],n[4]=w[3],n[5]=0,n[6]=w[4],n[7]=w[5],n[8]=1,n};I.fromQuat=function(n,w){var G=w[0],f=w[1],m=w[2];w=w[3];var v=G+G,D=f+f,C=m+m;G*=v;var J=f*v;f*=D;var N=m*v,S=m*D;m*=C;v*=w;D*=w;w*=C;return n[0]=1-f-m,n[3]=J-w,n[6]=N+D,n[1]=J+w,n[4]=1-G-m,n[7]=S-v,n[2]=N-D,n[5]=S+v,n[8]=1-G-f,n};I.normalFromMat4=function(n,w){var G=w[0],f=w[1],m=w[2],v=w[3],D=w[4],C=w[5],J=w[6],N=w[7],S=w[8],T=w[9],W=w[10],
Y=w[11],V=w[12],ma=w[13],ha=w[14];w=w[15];var ia=G*C-f*D,aa=G*J-m*D,ea=G*N-v*D,ja=f*J-m*C,Q=f*N-v*C,X=m*N-v*J,ca=S*ma-T*V,pa=S*ha-W*V;S=S*w-Y*V;var ka=T*ha-W*ma;T=T*w-Y*ma;W=W*w-Y*ha;return(Y=ia*W-aa*T+ea*ka+ja*S-Q*pa+X*ca)?(Y=1/Y,n[0]=(C*W-J*T+N*ka)*Y,n[1]=(J*S-D*W-N*pa)*Y,n[2]=(D*T-C*S+N*ca)*Y,n[3]=(m*T-f*W-v*ka)*Y,n[4]=(G*W-m*S+v*pa)*Y,n[5]=(f*S-G*T-v*ca)*Y,n[6]=(ma*X-ha*Q+w*ja)*Y,n[7]=(ha*ea-V*X-w*aa)*Y,n[8]=(V*Q-ma*ea+w*ia)*Y,n):null};I.str=function(n){return"mat3("+n[0]+", "+n[1]+", "+n[2]+
", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+", "+n[8]+")"};I.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2))};"undefined"!=typeof q&&(q.mat3=I);var L={create:function(){var n=new t(16);return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},clone:function(n){var w=new t(16);return w[0]=
n[0],w[1]=n[1],w[2]=n[2],w[3]=n[3],w[4]=n[4],w[5]=n[5],w[6]=n[6],w[7]=n[7],w[8]=n[8],w[9]=n[9],w[10]=n[10],w[11]=n[11],w[12]=n[12],w[13]=n[13],w[14]=n[14],w[15]=n[15],w},copy:function(n,w){return n[0]=w[0],n[1]=w[1],n[2]=w[2],n[3]=w[3],n[4]=w[4],n[5]=w[5],n[6]=w[6],n[7]=w[7],n[8]=w[8],n[9]=w[9],n[10]=w[10],n[11]=w[11],n[12]=w[12],n[13]=w[13],n[14]=w[14],n[15]=w[15],n},identity:function(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,
n[14]=0,n[15]=1,n},transpose:function(n,w){if(n===w){var G=w[1],f=w[2],m=w[3],v=w[6],D=w[7],C=w[11];n[1]=w[4];n[2]=w[8];n[3]=w[12];n[4]=G;n[6]=w[9];n[7]=w[13];n[8]=f;n[9]=v;n[11]=w[14];n[12]=m;n[13]=D;n[14]=C}else n[0]=w[0],n[1]=w[4],n[2]=w[8],n[3]=w[12],n[4]=w[1],n[5]=w[5],n[6]=w[9],n[7]=w[13],n[8]=w[2],n[9]=w[6],n[10]=w[10],n[11]=w[14],n[12]=w[3],n[13]=w[7],n[14]=w[11],n[15]=w[15];return n},invert:function(n,w){var G=w[0],f=w[1],m=w[2],v=w[3],D=w[4],C=w[5],J=w[6],N=w[7],S=w[8],T=w[9],W=w[10],Y=
w[11],V=w[12],ma=w[13],ha=w[14];w=w[15];var ia=G*C-f*D,aa=G*J-m*D,ea=G*N-v*D,ja=f*J-m*C,Q=f*N-v*C,X=m*N-v*J,ca=S*ma-T*V,pa=S*ha-W*V,ka=S*w-Y*V,va=T*ha-W*ma,Aa=T*w-Y*ma,xa=W*w-Y*ha,Ia=ia*xa-aa*Aa+ea*va+ja*ka-Q*pa+X*ca;return Ia?(Ia=1/Ia,n[0]=(C*xa-J*Aa+N*va)*Ia,n[1]=(m*Aa-f*xa-v*va)*Ia,n[2]=(ma*X-ha*Q+w*ja)*Ia,n[3]=(W*Q-T*X-Y*ja)*Ia,n[4]=(J*ka-D*xa-N*pa)*Ia,n[5]=(G*xa-m*ka+v*pa)*Ia,n[6]=(ha*ea-V*X-w*aa)*Ia,n[7]=(S*X-W*ea+Y*aa)*Ia,n[8]=(D*Aa-C*ka+N*ca)*Ia,n[9]=(f*ka-G*Aa-v*ca)*Ia,n[10]=(V*Q-ma*ea+w*
ia)*Ia,n[11]=(T*ea-S*Q-Y*ia)*Ia,n[12]=(C*pa-D*va-J*ca)*Ia,n[13]=(G*va-f*pa+m*ca)*Ia,n[14]=(ma*aa-V*ja-ha*ia)*Ia,n[15]=(S*ja-T*aa+W*ia)*Ia,n):null},adjoint:function(n,w){var G=w[0],f=w[1],m=w[2],v=w[3],D=w[4],C=w[5],J=w[6],N=w[7],S=w[8],T=w[9],W=w[10],Y=w[11],V=w[12],ma=w[13],ha=w[14];w=w[15];return n[0]=C*(W*w-Y*ha)-T*(J*w-N*ha)+ma*(J*Y-N*W),n[1]=-(f*(W*w-Y*ha)-T*(m*w-v*ha)+ma*(m*Y-v*W)),n[2]=f*(J*w-N*ha)-C*(m*w-v*ha)+ma*(m*N-v*J),n[3]=-(f*(J*Y-N*W)-C*(m*Y-v*W)+T*(m*N-v*J)),n[4]=-(D*(W*w-Y*ha)-S*
(J*w-N*ha)+V*(J*Y-N*W)),n[5]=G*(W*w-Y*ha)-S*(m*w-v*ha)+V*(m*Y-v*W),n[6]=-(G*(J*w-N*ha)-D*(m*w-v*ha)+V*(m*N-v*J)),n[7]=G*(J*Y-N*W)-D*(m*Y-v*W)+S*(m*N-v*J),n[8]=D*(T*w-Y*ma)-S*(C*w-N*ma)+V*(C*Y-N*T),n[9]=-(G*(T*w-Y*ma)-S*(f*w-v*ma)+V*(f*Y-v*T)),n[10]=G*(C*w-N*ma)-D*(f*w-v*ma)+V*(f*N-v*C),n[11]=-(G*(C*Y-N*T)-D*(f*Y-v*T)+S*(f*N-v*C)),n[12]=-(D*(T*ha-W*ma)-S*(C*ha-J*ma)+V*(C*W-J*T)),n[13]=G*(T*ha-W*ma)-S*(f*ha-m*ma)+V*(f*W-m*T),n[14]=-(G*(C*ha-J*ma)-D*(f*ha-m*ma)+V*(f*J-m*C)),n[15]=G*(C*W-J*T)-D*(f*W-
m*T)+S*(f*J-m*C),n},determinant:function(n){var w=n[0],G=n[1],f=n[2],m=n[3],v=n[4],D=n[5],C=n[6],J=n[7],N=n[8],S=n[9],T=n[10],W=n[11],Y=n[12],V=n[13],ma=n[14];n=n[15];return(w*D-G*v)*(T*n-W*ma)-(w*C-f*v)*(S*n-W*V)+(w*J-m*v)*(S*ma-T*V)+(G*C-f*D)*(N*n-W*Y)-(G*J-m*D)*(N*ma-T*Y)+(f*J-m*C)*(N*V-S*Y)},multiply:function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=w[4],J=w[5],N=w[6],S=w[7],T=w[8],W=w[9],Y=w[10],V=w[11],ma=w[12],ha=w[13],ia=w[14];w=w[15];var aa=G[0],ea=G[1],ja=G[2],Q=G[3];return n[0]=aa*f+ea*
C+ja*T+Q*ma,n[1]=aa*m+ea*J+ja*W+Q*ha,n[2]=aa*v+ea*N+ja*Y+Q*ia,n[3]=aa*D+ea*S+ja*V+Q*w,aa=G[4],ea=G[5],ja=G[6],Q=G[7],n[4]=aa*f+ea*C+ja*T+Q*ma,n[5]=aa*m+ea*J+ja*W+Q*ha,n[6]=aa*v+ea*N+ja*Y+Q*ia,n[7]=aa*D+ea*S+ja*V+Q*w,aa=G[8],ea=G[9],ja=G[10],Q=G[11],n[8]=aa*f+ea*C+ja*T+Q*ma,n[9]=aa*m+ea*J+ja*W+Q*ha,n[10]=aa*v+ea*N+ja*Y+Q*ia,n[11]=aa*D+ea*S+ja*V+Q*w,aa=G[12],ea=G[13],ja=G[14],Q=G[15],n[12]=aa*f+ea*C+ja*T+Q*ma,n[13]=aa*m+ea*J+ja*W+Q*ha,n[14]=aa*v+ea*N+ja*Y+Q*ia,n[15]=aa*D+ea*S+ja*V+Q*w,n}};L.mul=L.multiply;
L.translate=function(n,w,G){var f,m,v,D,C,J,N,S,T,W,Y,V,ma=G[0],ha=G[1];G=G[2];return w===n?(n[12]=w[0]*ma+w[4]*ha+w[8]*G+w[12],n[13]=w[1]*ma+w[5]*ha+w[9]*G+w[13],n[14]=w[2]*ma+w[6]*ha+w[10]*G+w[14],n[15]=w[3]*ma+w[7]*ha+w[11]*G+w[15]):(f=w[0],m=w[1],v=w[2],D=w[3],C=w[4],J=w[5],N=w[6],S=w[7],T=w[8],W=w[9],Y=w[10],V=w[11],n[0]=f,n[1]=m,n[2]=v,n[3]=D,n[4]=C,n[5]=J,n[6]=N,n[7]=S,n[8]=T,n[9]=W,n[10]=Y,n[11]=V,n[12]=f*ma+C*ha+T*G+w[12],n[13]=m*ma+J*ha+W*G+w[13],n[14]=v*ma+N*ha+Y*G+w[14],n[15]=D*ma+S*ha+
V*G+w[15]),n};L.scale=function(n,w,G){var f=G[0],m=G[1];G=G[2];return n[0]=w[0]*f,n[1]=w[1]*f,n[2]=w[2]*f,n[3]=w[3]*f,n[4]=w[4]*m,n[5]=w[5]*m,n[6]=w[6]*m,n[7]=w[7]*m,n[8]=w[8]*G,n[9]=w[9]*G,n[10]=w[10]*G,n[11]=w[11]*G,n[12]=w[12],n[13]=w[13],n[14]=w[14],n[15]=w[15],n};L.rotate=function(n,w,G,f){var m,v,D,C,J,N,S,T,W,Y,V,ma,ha,ia,aa,ea,ja,Q,X,ca,pa,ka,va,Aa,xa=f[0],Ia=f[1];f=f[2];var Za=Math.sqrt(xa*xa+Ia*Ia+f*f);return Math.abs(Za)<l?null:(Za=1/Za,xa*=Za,Ia*=Za,f*=Za,m=Math.sin(G),v=Math.cos(G),D=
1-v,C=w[0],J=w[1],N=w[2],S=w[3],T=w[4],W=w[5],Y=w[6],V=w[7],ma=w[8],ha=w[9],ia=w[10],aa=w[11],ea=xa*xa*D+v,ja=Ia*xa*D+f*m,Q=f*xa*D-Ia*m,X=xa*Ia*D-f*m,ca=Ia*Ia*D+v,pa=f*Ia*D+xa*m,ka=xa*f*D+Ia*m,va=Ia*f*D-xa*m,Aa=f*f*D+v,n[0]=C*ea+T*ja+ma*Q,n[1]=J*ea+W*ja+ha*Q,n[2]=N*ea+Y*ja+ia*Q,n[3]=S*ea+V*ja+aa*Q,n[4]=C*X+T*ca+ma*pa,n[5]=J*X+W*ca+ha*pa,n[6]=N*X+Y*ca+ia*pa,n[7]=S*X+V*ca+aa*pa,n[8]=C*ka+T*va+ma*Aa,n[9]=J*ka+W*va+ha*Aa,n[10]=N*ka+Y*va+ia*Aa,n[11]=S*ka+V*va+aa*Aa,w!==n&&(n[12]=w[12],n[13]=w[13],n[14]=
w[14],n[15]=w[15]),n)};L.rotateX=function(n,w,G){var f=Math.sin(G);G=Math.cos(G);var m=w[4],v=w[5],D=w[6],C=w[7],J=w[8],N=w[9],S=w[10],T=w[11];return w!==n&&(n[0]=w[0],n[1]=w[1],n[2]=w[2],n[3]=w[3],n[12]=w[12],n[13]=w[13],n[14]=w[14],n[15]=w[15]),n[4]=m*G+J*f,n[5]=v*G+N*f,n[6]=D*G+S*f,n[7]=C*G+T*f,n[8]=J*G-m*f,n[9]=N*G-v*f,n[10]=S*G-D*f,n[11]=T*G-C*f,n};L.rotateY=function(n,w,G){var f=Math.sin(G);G=Math.cos(G);var m=w[0],v=w[1],D=w[2],C=w[3],J=w[8],N=w[9],S=w[10],T=w[11];return w!==n&&(n[4]=w[4],
n[5]=w[5],n[6]=w[6],n[7]=w[7],n[12]=w[12],n[13]=w[13],n[14]=w[14],n[15]=w[15]),n[0]=m*G-J*f,n[1]=v*G-N*f,n[2]=D*G-S*f,n[3]=C*G-T*f,n[8]=m*f+J*G,n[9]=v*f+N*G,n[10]=D*f+S*G,n[11]=C*f+T*G,n};L.rotateZ=function(n,w,G){var f=Math.sin(G);G=Math.cos(G);var m=w[0],v=w[1],D=w[2],C=w[3],J=w[4],N=w[5],S=w[6],T=w[7];return w!==n&&(n[8]=w[8],n[9]=w[9],n[10]=w[10],n[11]=w[11],n[12]=w[12],n[13]=w[13],n[14]=w[14],n[15]=w[15]),n[0]=m*G+J*f,n[1]=v*G+N*f,n[2]=D*G+S*f,n[3]=C*G+T*f,n[4]=J*G-m*f,n[5]=N*G-v*f,n[6]=S*G-
D*f,n[7]=T*G-C*f,n};L.fromRotationTranslation=function(n,w,G){var f=w[0],m=w[1],v=w[2],D=w[3],C=f+f,J=m+m,N=v+v;w=f*C;var S=f*J;f*=N;var T=m*J;m*=N;v*=N;C*=D;J*=D;D*=N;return n[0]=1-(T+v),n[1]=S+D,n[2]=f-J,n[3]=0,n[4]=S-D,n[5]=1-(w+v),n[6]=m+C,n[7]=0,n[8]=f+J,n[9]=m-C,n[10]=1-(w+T),n[11]=0,n[12]=G[0],n[13]=G[1],n[14]=G[2],n[15]=1,n};L.fromQuat=function(n,w){var G=w[0],f=w[1],m=w[2];w=w[3];var v=G+G,D=f+f,C=m+m;G*=v;var J=f*v;f*=D;var N=m*v,S=m*D;m*=C;v*=w;D*=w;w*=C;return n[0]=1-f-m,n[1]=J+w,n[2]=
N-D,n[3]=0,n[4]=J-w,n[5]=1-G-m,n[6]=S+v,n[7]=0,n[8]=N+D,n[9]=S-v,n[10]=1-G-f,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n};L.frustum=function(n,w,G,f,m,v,D){var C=1/(G-w),J=1/(m-f),N=1/(v-D);return n[0]=2*v*C,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*v*J,n[6]=0,n[7]=0,n[8]=(G+w)*C,n[9]=(m+f)*J,n[10]=(D+v)*N,n[11]=-1,n[12]=0,n[13]=0,n[14]=D*v*2*N,n[15]=0,n};L.perspective=function(n,w,G,f,m){w=1/Math.tan(w/2);var v=1/(f-m);return n[0]=w/G,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=w,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(m+
f)*v,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*m*f*v,n[15]=0,n};L.ortho=function(n,w,G,f,m,v,D){var C=1/(w-G),J=1/(f-m),N=1/(v-D);return n[0]=-2*C,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*J,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*N,n[11]=0,n[12]=(w+G)*C,n[13]=(m+f)*J,n[14]=(D+v)*N,n[15]=1,n};L.lookAt=function(n,w,G,f){var m,v,D,C,J,N,S,T,W,Y,V=w[0],ma=w[1];w=w[2];var ha=f[0],ia=f[1];f=f[2];var aa=G[0],ea=G[1];G=G[2];return Math.abs(V-aa)<l&&Math.abs(ma-ea)<l&&Math.abs(w-G)<l?L.identity(n):(S=V-aa,T=ma-ea,W=w-G,Y=1/
Math.sqrt(S*S+T*T+W*W),S*=Y,T*=Y,W*=Y,m=ia*W-f*T,v=f*S-ha*W,D=ha*T-ia*S,Y=Math.sqrt(m*m+v*v+D*D),Y?(Y=1/Y,m*=Y,v*=Y,D*=Y):(m=0,v=0,D=0),C=T*D-W*v,J=W*m-S*D,N=S*v-T*m,Y=Math.sqrt(C*C+J*J+N*N),Y?(Y=1/Y,C*=Y,J*=Y,N*=Y):(C=0,J=0,N=0),n[0]=m,n[1]=C,n[2]=S,n[3]=0,n[4]=v,n[5]=J,n[6]=T,n[7]=0,n[8]=D,n[9]=N,n[10]=W,n[11]=0,n[12]=-(m*V+v*ma+D*w),n[13]=-(C*V+J*ma+N*w),n[14]=-(S*V+T*ma+W*w),n[15]=1,n)};L.str=function(n){return"mat4("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+", "+n[4]+", "+n[5]+", "+n[6]+", "+n[7]+
", "+n[8]+", "+n[9]+", "+n[10]+", "+n[11]+", "+n[12]+", "+n[13]+", "+n[14]+", "+n[15]+")"};L.frob=function(n){return Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)+Math.pow(n[3],2)+Math.pow(n[4],2)+Math.pow(n[5],2)+Math.pow(n[6],2)+Math.pow(n[6],2)+Math.pow(n[7],2)+Math.pow(n[8],2)+Math.pow(n[9],2)+Math.pow(n[10],2)+Math.pow(n[11],2)+Math.pow(n[12],2)+Math.pow(n[13],2)+Math.pow(n[14],2)+Math.pow(n[15],2))};"undefined"!=typeof q&&(q.mat4=L);var U={create:function(){var n=new t(4);return n[0]=
0,n[1]=0,n[2]=0,n[3]=1,n}};U.rotationTo=function(){var n=B.create(),w=B.fromValues(1,0,0),G=B.fromValues(0,1,0);return function(f,m,v){var D=B.dot(m,v);return-.999999>D?(B.cross(n,w,m),1E-6>B.length(n)&&B.cross(n,G,m),B.normalize(n,n),U.setAxisAngle(f,n,Math.PI),f):.999999<D?(f[0]=0,f[1]=0,f[2]=0,f[3]=1,f):(B.cross(n,m,v),f[0]=n[0],f[1]=n[1],f[2]=n[2],f[3]=1+D,U.normalize(f,f))}}();U.setAxes=function(){var n=I.create();return function(w,G,f,m){return n[0]=f[0],n[3]=f[1],n[6]=f[2],n[1]=m[0],n[4]=m[1],
n[7]=m[2],n[2]=-G[0],n[5]=-G[1],n[8]=-G[2],U.normalize(w,U.fromMat3(w,n))}}();U.clone=F.clone;U.fromValues=F.fromValues;U.copy=F.copy;U.set=F.set;U.identity=function(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n};U.setAxisAngle=function(n,w,G){G*=.5;var f=Math.sin(G);return n[0]=f*w[0],n[1]=f*w[1],n[2]=f*w[2],n[3]=Math.cos(G),n};U.add=F.add;U.multiply=function(n,w,G){var f=w[0],m=w[1],v=w[2];w=w[3];var D=G[0],C=G[1],J=G[2];G=G[3];return n[0]=f*G+w*D+m*J-v*C,n[1]=m*G+w*C+v*D-f*J,n[2]=v*G+w*J+f*C-m*D,n[3]=
w*G-f*D-m*C-v*J,n};U.mul=U.multiply;U.scale=F.scale;U.rotateX=function(n,w,G){G*=.5;var f=w[0],m=w[1],v=w[2];w=w[3];var D=Math.sin(G);G=Math.cos(G);return n[0]=f*G+w*D,n[1]=m*G+v*D,n[2]=v*G-m*D,n[3]=w*G-f*D,n};U.rotateY=function(n,w,G){G*=.5;var f=w[0],m=w[1],v=w[2];w=w[3];var D=Math.sin(G);G=Math.cos(G);return n[0]=f*G-v*D,n[1]=m*G+w*D,n[2]=v*G+f*D,n[3]=w*G-m*D,n};U.rotateZ=function(n,w,G){G*=.5;var f=w[0],m=w[1],v=w[2];w=w[3];var D=Math.sin(G);G=Math.cos(G);return n[0]=f*G+m*D,n[1]=m*G-f*D,n[2]=
v*G+w*D,n[3]=w*G-v*D,n};U.calculateW=function(n,w){var G=w[0],f=w[1];w=w[2];return n[0]=G,n[1]=f,n[2]=w,n[3]=-Math.sqrt(Math.abs(1-G*G-f*f-w*w)),n};U.dot=F.dot;U.lerp=F.lerp;U.slerp=function(n,w,G,f){var m,v,D,C,J,N=w[0],S=w[1],T=w[2];w=w[3];var W=G[0],Y=G[1],V=G[2];G=G[3];return v=N*W+S*Y+T*V+w*G,0>v&&(v=-v,W=-W,Y=-Y,V=-V,G=-G),1E-6<1-v?(m=Math.acos(v),D=Math.sin(m),C=Math.sin((1-f)*m)/D,J=Math.sin(f*m)/D):(C=1-f,J=f),n[0]=C*N+J*W,n[1]=C*S+J*Y,n[2]=C*T+J*V,n[3]=C*w+J*G,n};U.invert=function(n,w){var G=
w[0],f=w[1],m=w[2];w=w[3];var v=G*G+f*f+m*m+w*w;v=v?1/v:0;return n[0]=-G*v,n[1]=-f*v,n[2]=-m*v,n[3]=w*v,n};U.conjugate=function(n,w){return n[0]=-w[0],n[1]=-w[1],n[2]=-w[2],n[3]=w[3],n};U.length=F.length;U.len=U.length;U.squaredLength=F.squaredLength;U.sqrLen=U.squaredLength;U.normalize=F.normalize;U.fromMat3=function(n,w){var G=w[0]+w[4]+w[8];if(0<G)G=Math.sqrt(G+1),n[3]=.5*G,G=.5/G,n[0]=(w[7]-w[5])*G,n[1]=(w[2]-w[6])*G,n[2]=(w[3]-w[1])*G;else{var f=0;w[4]>w[0]&&(f=1);w[8]>w[3*f+f]&&(f=2);var m=
(f+1)%3,v=(f+2)%3;G=Math.sqrt(w[3*f+f]-w[3*m+m]-w[3*v+v]+1);n[f]=.5*G;G=.5/G;n[3]=(w[3*v+m]-w[3*m+v])*G;n[m]=(w[3*m+f]+w[3*f+m])*G;n[v]=(w[3*v+f]+w[3*f+v])*G}return n};U.str=function(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"};"undefined"!=typeof q&&(q.quat=U)})(p)}(this)},{}],24:[function(b,h,k){(function(){var e=this,p=e._,q={},l=Array.prototype,t=Object.prototype,r=l.push,y=l.slice,z=l.concat,E=t.toString,B=t.hasOwnProperty,F=l.forEach,I=l.map,L=l.reduce,U=l.reduceRight,n=l.filter,
w=l.every,G=l.some,f=l.indexOf,m=l.lastIndexOf;t=Array.isArray;var v=Object.keys,D=Function.prototype.bind,C=function(Q){return Q instanceof C?Q:this instanceof C?void(this._wrapped=Q):new C(Q)};"undefined"!=typeof k?("undefined"!=typeof h&&h.exports&&(k=h.exports=C),k._=C):e._=C;C.VERSION="1.4.4";var J=C.each=C.forEach=function(Q,X,ca){if(null!=Q)if(F&&Q.forEach===F)Q.forEach(X,ca);else if(Q.length===+Q.length)for(var pa=0,ka=Q.length;ka>pa&&X.call(ca,Q[pa],pa,Q)!==q;pa++);else for(pa in Q)if(C.has(Q,
pa)&&X.call(ca,Q[pa],pa,Q)===q)break};C.map=C.collect=function(Q,X,ca){var pa=[];return null==Q?pa:I&&Q.map===I?Q.map(X,ca):(J(Q,function(ka,va,Aa){pa[pa.length]=X.call(ca,ka,va,Aa)}),pa)};C.reduce=C.foldl=C.inject=function(Q,X,ca,pa){var ka=2<arguments.length;if(null==Q&&(Q=[]),L&&Q.reduce===L)return pa&&(X=C.bind(X,pa)),ka?Q.reduce(X,ca):Q.reduce(X);if(J(Q,function(va,Aa,xa){ka?ca=X.call(pa,ca,va,Aa,xa):(ca=va,ka=!0)}),!ka)throw new TypeError("Reduce of empty array with no initial value");return ca};
C.reduceRight=C.foldr=function(Q,X,ca,pa){var ka=2<arguments.length;if(null==Q&&(Q=[]),U&&Q.reduceRight===U)return pa&&(X=C.bind(X,pa)),ka?Q.reduceRight(X,ca):Q.reduceRight(X);var va=Q.length;if(va!==+va){var Aa=C.keys(Q);va=Aa.length}if(J(Q,function(xa,Ia,Za){Ia=Aa?Aa[--va]:--va;ka?ca=X.call(pa,ca,Q[Ia],Ia,Za):(ca=Q[Ia],ka=!0)}),!ka)throw new TypeError("Reduce of empty array with no initial value");return ca};C.find=C.detect=function(Q,X,ca){var pa;return N(Q,function(ka,va,Aa){return X.call(ca,
ka,va,Aa)?(pa=ka,!0):void 0}),pa};C.filter=C.select=function(Q,X,ca){var pa=[];return null==Q?pa:n&&Q.filter===n?Q.filter(X,ca):(J(Q,function(ka,va,Aa){X.call(ca,ka,va,Aa)&&(pa[pa.length]=ka)}),pa)};C.reject=function(Q,X,ca){return C.filter(Q,function(pa,ka,va){return!X.call(ca,pa,ka,va)},ca)};C.every=C.all=function(Q,X,ca){X||(X=C.identity);var pa=!0;return null==Q?pa:w&&Q.every===w?Q.every(X,ca):(J(Q,function(ka,va,Aa){return(pa=pa&&X.call(ca,ka,va,Aa))?void 0:q}),!!pa)};var N=C.some=C.any=function(Q,
X,ca){X||(X=C.identity);var pa=!1;return null==Q?pa:G&&Q.some===G?Q.some(X,ca):(J(Q,function(ka,va,Aa){return pa||(pa=X.call(ca,ka,va,Aa))?q:void 0}),!!pa)};C.contains=C.include=function(Q,X){return null==Q?!1:f&&Q.indexOf===f?-1!=Q.indexOf(X):N(Q,function(ca){return ca===X})};C.invoke=function(Q,X){var ca=y.call(arguments,2),pa=C.isFunction(X);return C.map(Q,function(ka){return(pa?X:ka[X]).apply(ka,ca)})};C.pluck=function(Q,X){return C.map(Q,function(ca){return ca[X]})};C.where=function(Q,X,ca){return C.isEmpty(X)?
ca?null:[]:C[ca?"find":"filter"](Q,function(pa){for(var ka in X)if(X[ka]!==pa[ka])return!1;return!0})};C.findWhere=function(Q,X){return C.where(Q,X,!0)};C.max=function(Q,X,ca){if(!X&&C.isArray(Q)&&Q[0]===+Q[0]&&65535>Q.length)return Math.max.apply(Math,Q);if(!X&&C.isEmpty(Q))return-1/0;var pa={computed:-1/0,value:-1/0};return J(Q,function(ka,va,Aa){va=X?X.call(ca,ka,va,Aa):ka;va>=pa.computed&&(pa={value:ka,computed:va})}),pa.value};C.min=function(Q,X,ca){if(!X&&C.isArray(Q)&&Q[0]===+Q[0]&&65535>Q.length)return Math.min.apply(Math,
Q);if(!X&&C.isEmpty(Q))return 1/0;var pa={computed:1/0,value:1/0};return J(Q,function(ka,va,Aa){va=X?X.call(ca,ka,va,Aa):ka;va<pa.computed&&(pa={value:ka,computed:va})}),pa.value};C.shuffle=function(Q){var X,ca=0,pa=[];return J(Q,function(ka){X=C.random(ca++);pa[ca-1]=pa[X];pa[X]=ka}),pa};var S=function(Q){return C.isFunction(Q)?Q:function(X){return X[Q]}};C.sortBy=function(Q,X,ca){var pa=S(X);return C.pluck(C.map(Q,function(ka,va,Aa){return{value:ka,index:va,criteria:pa.call(ca,ka,va,Aa)}}).sort(function(ka,
va){var Aa=ka.criteria,xa=va.criteria;if(Aa!==xa){if(Aa>xa||void 0===Aa)return 1;if(xa>Aa||void 0===xa)return-1}return ka.index<va.index?-1:1}),"value")};var T=function(Q,X,ca,pa){var ka={},va=S(X||C.identity);return J(Q,function(Aa,xa){xa=va.call(ca,Aa,xa,Q);pa(ka,xa,Aa)}),ka};C.groupBy=function(Q,X,ca){return T(Q,X,ca,function(pa,ka,va){(C.has(pa,ka)?pa[ka]:pa[ka]=[]).push(va)})};C.countBy=function(Q,X,ca){return T(Q,X,ca,function(pa,ka){C.has(pa,ka)||(pa[ka]=0);pa[ka]++})};C.sortedIndex=function(Q,
X,ca,pa){ca=null==ca?C.identity:S(ca);X=ca.call(pa,X);for(var ka=0,va=Q.length;va>ka;){var Aa=ka+va>>>1;ca.call(pa,Q[Aa])<X?ka=Aa+1:va=Aa}return ka};C.toArray=function(Q){return Q?C.isArray(Q)?y.call(Q):Q.length===+Q.length?C.map(Q,C.identity):C.values(Q):[]};C.size=function(Q){return null==Q?0:Q.length===+Q.length?Q.length:C.keys(Q).length};C.first=C.head=C.take=function(Q,X,ca){return null==Q?void 0:null==X||ca?Q[0]:y.call(Q,0,X)};C.initial=function(Q,X,ca){return y.call(Q,0,Q.length-(null==X||
ca?1:X))};C.last=function(Q,X,ca){return null==Q?void 0:null==X||ca?Q[Q.length-1]:y.call(Q,Math.max(Q.length-X,0))};C.rest=C.tail=C.drop=function(Q,X,ca){return y.call(Q,null==X||ca?1:X)};C.compact=function(Q){return C.filter(Q,C.identity)};var W=function(Q,X,ca){return J(Q,function(pa){C.isArray(pa)?X?r.apply(ca,pa):W(pa,X,ca):ca.push(pa)}),ca};C.flatten=function(Q,X){return W(Q,X,[])};C.without=function(Q){return C.difference(Q,y.call(arguments,1))};C.uniq=C.unique=function(Q,X,ca,pa){C.isFunction(X)&&
(pa=ca,ca=X,X=!1);ca=ca?C.map(Q,ca,pa):Q;var ka=[],va=[];return J(ca,function(Aa,xa){(X?xa&&va[va.length-1]===Aa:C.contains(va,Aa))||(va.push(Aa),ka.push(Q[xa]))}),ka};C.union=function(){return C.uniq(z.apply(l,arguments))};C.intersection=function(Q){var X=y.call(arguments,1);return C.filter(C.uniq(Q),function(ca){return C.every(X,function(pa){return 0<=C.indexOf(pa,ca)})})};C.difference=function(Q){var X=z.apply(l,y.call(arguments,1));return C.filter(Q,function(ca){return!C.contains(X,ca)})};C.zip=
function(){for(var Q=y.call(arguments),X=C.max(C.pluck(Q,"length")),ca=Array(X),pa=0;X>pa;pa++)ca[pa]=C.pluck(Q,""+pa);return ca};C.object=function(Q,X){if(null==Q)return{};for(var ca={},pa=0,ka=Q.length;ka>pa;pa++)X?ca[Q[pa]]=X[pa]:ca[Q[pa][0]]=Q[pa][1];return ca};C.indexOf=function(Q,X,ca){if(null==Q)return-1;var pa=0,ka=Q.length;if(ca){if("number"!=typeof ca)return pa=C.sortedIndex(Q,X),Q[pa]===X?pa:-1;pa=0>ca?Math.max(0,ka+ca):ca}if(f&&Q.indexOf===f)return Q.indexOf(X,ca);for(;ka>pa;pa++)if(Q[pa]===
X)return pa;return-1};C.lastIndexOf=function(Q,X,ca){if(null==Q)return-1;var pa=null!=ca;if(m&&Q.lastIndexOf===m)return pa?Q.lastIndexOf(X,ca):Q.lastIndexOf(X);for(ca=pa?ca:Q.length;ca--;)if(Q[ca]===X)return ca;return-1};C.range=function(Q,X,ca){1>=arguments.length&&(X=Q||0,Q=0);ca=arguments[2]||1;for(var pa=Math.max(Math.ceil((X-Q)/ca),0),ka=0,va=Array(pa);pa>ka;)va[ka++]=Q,Q+=ca;return va};C.bind=function(Q,X){if(Q.bind===D&&D)return D.apply(Q,y.call(arguments,1));var ca=y.call(arguments,2);return function(){return Q.apply(X,
ca.concat(y.call(arguments)))}};C.partial=function(Q){var X=y.call(arguments,1);return function(){return Q.apply(this,X.concat(y.call(arguments)))}};C.bindAll=function(Q){var X=y.call(arguments,1);return 0===X.length&&(X=C.functions(Q)),J(X,function(ca){Q[ca]=C.bind(Q[ca],Q)}),Q};C.memoize=function(Q,X){var ca={};return X||(X=C.identity),function(){var pa=X.apply(this,arguments);return C.has(ca,pa)?ca[pa]:ca[pa]=Q.apply(this,arguments)}};C.delay=function(Q,X){var ca=y.call(arguments,2);return setTimeout(function(){return Q.apply(null,
ca)},X)};C.defer=function(Q){return C.delay.apply(C,[Q,1].concat(y.call(arguments,1)))};C.throttle=function(Q,X){var ca,pa,ka,va,Aa=0,xa=function(){Aa=new Date;ka=null;va=Q.apply(ca,pa)};return function(){var Ia=new Date,Za=X-(Ia-Aa);return ca=this,pa=arguments,0>=Za?(clearTimeout(ka),ka=null,Aa=Ia,va=Q.apply(ca,pa)):ka||(ka=setTimeout(xa,Za)),va}};C.debounce=function(Q,X,ca){var pa,ka;return function(){var va=this,Aa=arguments,xa=ca&&!pa;return clearTimeout(pa),pa=setTimeout(function(){pa=null;ca||
(ka=Q.apply(va,Aa))},X),xa&&(ka=Q.apply(va,Aa)),ka}};C.once=function(Q){var X,ca=!1;return function(){return ca?X:(ca=!0,X=Q.apply(this,arguments),Q=null,X)}};C.wrap=function(Q,X){return function(){var ca=[Q];return r.apply(ca,arguments),X.apply(this,ca)}};C.compose=function(){var Q=arguments;return function(){for(var X=arguments,ca=Q.length-1;0<=ca;ca--)X=[Q[ca].apply(this,X)];return X[0]}};C.after=function(Q,X){return 0>=Q?X():function(){return 1>--Q?X.apply(this,arguments):void 0}};C.keys=v||function(Q){if(Q!==
Object(Q))throw new TypeError("Invalid object");var X=[],ca;for(ca in Q)C.has(Q,ca)&&(X[X.length]=ca);return X};C.values=function(Q){var X=[],ca;for(ca in Q)C.has(Q,ca)&&X.push(Q[ca]);return X};C.pairs=function(Q){var X=[],ca;for(ca in Q)C.has(Q,ca)&&X.push([ca,Q[ca]]);return X};C.invert=function(Q){var X={},ca;for(ca in Q)C.has(Q,ca)&&(X[Q[ca]]=ca);return X};C.functions=C.methods=function(Q){var X=[],ca;for(ca in Q)C.isFunction(Q[ca])&&X.push(ca);return X.sort()};C.extend=function(Q){return J(y.call(arguments,
1),function(X){if(X)for(var ca in X)Q[ca]=X[ca]}),Q};C.pick=function(Q){var X={},ca=z.apply(l,y.call(arguments,1));return J(ca,function(pa){pa in Q&&(X[pa]=Q[pa])}),X};C.omit=function(Q){var X={},ca=z.apply(l,y.call(arguments,1)),pa;for(pa in Q)C.contains(ca,pa)||(X[pa]=Q[pa]);return X};C.defaults=function(Q){return J(y.call(arguments,1),function(X){if(X)for(var ca in X)null==Q[ca]&&(Q[ca]=X[ca])}),Q};C.clone=function(Q){return C.isObject(Q)?C.isArray(Q)?Q.slice():C.extend({},Q):Q};C.tap=function(Q,
X){return X(Q),Q};var Y=function(Q,X,ca,pa){if(Q===X)return 0!==Q||1/Q==1/X;if(null==Q||null==X)return Q===X;Q instanceof C&&(Q=Q._wrapped);X instanceof C&&(X=X._wrapped);var ka=E.call(Q);if(ka!=E.call(X))return!1;switch(ka){case "[object String]":return Q==String(X);case "[object Number]":return Q!=+Q?X!=+X:0==Q?1/Q==1/X:Q==+X;case "[object Date]":case "[object Boolean]":return+Q==+X;case "[object RegExp]":return Q.source==X.source&&Q.global==X.global&&Q.multiline==X.multiline&&Q.ignoreCase==X.ignoreCase}if("object"!=
typeof Q||"object"!=typeof X)return!1;for(var va=ca.length;va--;)if(ca[va]==Q)return pa[va]==X;ca.push(Q);pa.push(X);va=0;var Aa=!0;if("[object Array]"==ka){if(va=Q.length,Aa=va==X.length)for(;va--&&(Aa=Y(Q[va],X[va],ca,pa)););}else{ka=Q.constructor;var xa=X.constructor;if(ka!==xa&&!(C.isFunction(ka)&&ka instanceof ka&&C.isFunction(xa)&&xa instanceof xa))return!1;for(var Ia in Q)if(C.has(Q,Ia)&&(va++,!(Aa=C.has(X,Ia)&&Y(Q[Ia],X[Ia],ca,pa))))break;if(Aa){for(Ia in X)if(C.has(X,Ia)&&!va--)break;Aa=
!va}}return ca.pop(),pa.pop(),Aa};C.isEqual=function(Q,X){return Y(Q,X,[],[])};C.isEmpty=function(Q){if(null==Q)return!0;if(C.isArray(Q)||C.isString(Q))return 0===Q.length;for(var X in Q)if(C.has(Q,X))return!1;return!0};C.isElement=function(Q){return!(!Q||1!==Q.nodeType)};C.isArray=t||function(Q){return"[object Array]"==E.call(Q)};C.isObject=function(Q){return Q===Object(Q)};J("Arguments Function String Number Date RegExp".split(" "),function(Q){C["is"+Q]=function(X){return E.call(X)=="[object "+
Q+"]"}});C.isArguments(arguments)||(C.isArguments=function(Q){return!(!Q||!C.has(Q,"callee"))});"function"!=typeof/./&&(C.isFunction=function(Q){return"function"==typeof Q});C.isFinite=function(Q){return isFinite(Q)&&!isNaN(parseFloat(Q))};C.isNaN=function(Q){return C.isNumber(Q)&&Q!=+Q};C.isBoolean=function(Q){return!0===Q||!1===Q||"[object Boolean]"==E.call(Q)};C.isNull=function(Q){return null===Q};C.isUndefined=function(Q){return void 0===Q};C.has=function(Q,X){return B.call(Q,X)};C.noConflict=
function(){return e._=p,this};C.identity=function(Q){return Q};C.times=function(Q,X,ca){for(var pa=Array(Q),ka=0;Q>ka;ka++)pa[ka]=X.call(ca,ka);return pa};C.random=function(Q,X){return null==X&&(X=Q,Q=0),Q+Math.floor(Math.random()*(X-Q+1))};var V={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};V.unescape=C.invert(V.escape);var ma={escape:new RegExp("["+C.keys(V.escape).join("")+"]","g"),unescape:new RegExp("("+C.keys(V.unescape).join("|")+")","g")};C.each(["escape",
"unescape"],function(Q){C[Q]=function(X){return null==X?"":(""+X).replace(ma[Q],function(ca){return V[Q][ca]})}});C.result=function(Q,X){if(null==Q)return null;X=Q[X];return C.isFunction(X)?X.call(Q):X};C.mixin=function(Q){J(C.functions(Q),function(X){var ca=C[X]=Q[X];C.prototype[X]=function(){var pa=[this._wrapped];return r.apply(pa,arguments),ja.call(this,ca.apply(C,pa))}})};var ha=0;C.uniqueId=function(Q){var X=++ha+"";return Q?Q+X:X};C.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var ia=/(.)^/,aa={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},ea=/\\|'|\r|\n|\t|\u2028|\u2029/g;C.template=function(Q,X,ca){ca=C.defaults({},ca,C.templateSettings);var pa=new RegExp([(ca.escape||ia).source,(ca.interpolate||ia).source,(ca.evaluate||ia).source].join("|")+"|$","g"),ka=0,va="__p+='";Q.replace(pa,function(xa,Ia,Za,kb,Hb){return va+=Q.slice(ka,Hb).replace(ea,function(vb){return"\\"+aa[vb]}),Ia&&(va+="'+\n((__t=("+Ia+"))==null?'':_.escape(__t))+\n'"),
Za&&(va+="'+\n((__t=("+Za+"))==null?'':__t)+\n'"),kb&&(va+="';\n"+kb+"\n__p+='"),ka=Hb+xa.length,xa});va+="';\n";ca.variable||(va="with(obj||{}){\n"+va+"}\n");va="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+va+"return __p;\n";try{var Aa=new Function(ca.variable||"obj","_",va)}catch(xa){throw xa.source=va,xa;}if(X)return Aa(X,C);X=function(xa){return Aa.call(this,xa,C)};return X.source="function("+(ca.variable||"obj")+"){\n"+va+"}",X};C.chain=function(Q){return C(Q).chain()};
var ja=function(Q){return this._chain?C(Q).chain():Q};C.mixin(C);J("pop push reverse shift sort splice unshift".split(" "),function(Q){var X=l[Q];C.prototype[Q]=function(){var ca=this._wrapped;return X.apply(ca,arguments),"shift"!=Q&&"splice"!=Q||0!==ca.length||delete ca[0],ja.call(this,ca)}});J(["concat","join","slice"],function(Q){var X=l[Q];C.prototype[Q]=function(){return ja.call(this,X.apply(this._wrapped,arguments))}});C.extend(C.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},
{}],25:[function(b){"undefined"!=typeof window&&"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(h){setTimeout(h,1E3/60)});Leap=b("../lib/index")},{"../lib/index":11}]},{},[25]);
var Stats=function(){function b(z){e.appendChild(z.dom);return z}function h(z){for(var E=0;E<e.children.length;E++)e.children[E].style.display=E===z?"block":"none";k=z}var k=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";e.addEventListener("click",function(z){z.preventDefault();h(++k%e.children.length)},!1);var p=(performance||Date).now(),q=p,l=0,t=b(new Stats.Panel("FPS","#fff","#222")),r=b(new Stats.Panel("MS","#fff","#222"));
if(self.performance&&self.performance.memory)var y=b(new Stats.Panel("MB","#fff","#222"));h(0);return{REVISION:17,dom:e,addPanel:b,showPanel:h,begin:function(){p=(performance||Date).now()},end:function(){l++;var z=(performance||Date).now();r.update(z-p,200);if(z>q+1E3&&(t.update(1E3*l/(z-q),100),q=z,l=0,y)){var E=performance.memory;y.update(E.usedJSHeapSize/1048576,E.jsHeapSizeLimit/1048576)}return z},update:function(){p=this.end()},domElement:e,setMode:h}};
Stats.Panel=function(b,h,k){var e=Infinity,p=0,q=Math.round,l=q(window.devicePixelRatio||1),t=80*l,r=48*l,y=3*l,z=2*l,E=3*l,B=15*l,F=74*l,I=30*l,L=document.createElement("canvas");L.width=t;L.height=r;L.style.cssText="width:80px;height:48px";var U=L.getContext("2d");U.font="bold "+9*l+"px Helvetica,Arial,sans-serif";U.textBaseline="top";U.fillStyle=k;U.fillRect(0,0,t,r);U.fillStyle=h;U.fillText(b,y,z);U.fillRect(E,B,F,I);U.fillStyle=k;U.globalAlpha=.9;U.fillRect(E,B,F,I);return{dom:L,update:function(n,
w){e=Math.min(e,n);p=Math.max(p,n);U.fillStyle=k;U.globalAlpha=1;U.fillRect(0,0,t,B);U.fillStyle=h;U.fillText(q(n)+" "+b+" ("+q(e)+"-"+q(p)+")",y,z);U.drawImage(L,E+l,B,F-l,I,E,B,F-l,I);U.fillRect(E+F-l,B,l,I);U.fillStyle=k;U.globalAlpha=.9;U.fillRect(E+F-l,B,l,q((1-n/w)*I))}}};"object"===typeof module&&(module.exports=Stats);var SPE={distributions:{BOX:1,SPHERE:2,DISC:3},valueOverLifetimeLength:4};
"function"==typeof define&&define.amd?define("spe",SPE):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=SPE);SPE.TypedArrayHelper=function(b,h,k,e){this.componentSize=k||1;this.size=h||1;this.TypedArrayConstructor=b||Float32Array;this.array=new b(h*this.componentSize);this.indexOffset=e||0};SPE.TypedArrayHelper.constructor=SPE.TypedArrayHelper;
SPE.TypedArrayHelper.prototype.setSize=function(b,h){var k=this.array.length;return h||(b*=this.componentSize),k>b?this.shrink(b):b>k?this.grow(b):void console.info("TypedArray is already of size:",b+".","Will not resize.")};SPE.TypedArrayHelper.prototype.shrink=function(b){return this.array=this.array.subarray(0,b),this.size=b,this};SPE.TypedArrayHelper.prototype.grow=function(b){var h=this.array,k=new this.TypedArrayConstructor(b);return k.set(h),this.array=k,this.size=b,this};
SPE.TypedArrayHelper.prototype.splice=function(b,h){b*=this.componentSize;h*=this.componentSize;for(var k=[],e=this.array,p=e.length,q=0;p>q;++q)(b>q||q>=h)&&k.push(e[q]);return this.setFromArray(0,k),this};SPE.TypedArrayHelper.prototype.setFromArray=function(b,h){var k=b+h.length;return k>this.array.length?this.grow(k):k<this.array.length&&this.shrink(k),this.array.set(h,this.indexOffset+b),this};SPE.TypedArrayHelper.prototype.setVec2=function(b,h){return this.setVec2Components(b,h.x,h.y)};
SPE.TypedArrayHelper.prototype.setVec2Components=function(b,h,k){var e=this.array;b=this.indexOffset+b*this.componentSize;return e[b]=h,e[b+1]=k,this};SPE.TypedArrayHelper.prototype.setVec3=function(b,h){return this.setVec3Components(b,h.x,h.y,h.z)};SPE.TypedArrayHelper.prototype.setVec3Components=function(b,h,k,e){var p=this.array;b=this.indexOffset+b*this.componentSize;return p[b]=h,p[b+1]=k,p[b+2]=e,this};
SPE.TypedArrayHelper.prototype.setVec4=function(b,h){return this.setVec4Components(b,h.x,h.y,h.z,h.w)};SPE.TypedArrayHelper.prototype.setVec4Components=function(b,h,k,e,p){var q=this.array;b=this.indexOffset+b*this.componentSize;return q[b]=h,q[b+1]=k,q[b+2]=e,q[b+3]=p,this};SPE.TypedArrayHelper.prototype.setMat3=function(b,h){return this.setFromArray(this.indexOffset+b*this.componentSize,h.elements)};
SPE.TypedArrayHelper.prototype.setMat4=function(b,h){return this.setFromArray(this.indexOffset+b*this.componentSize,h.elements)};SPE.TypedArrayHelper.prototype.setColor=function(b,h){return this.setVec3Components(b,h.r,h.g,h.b)};SPE.TypedArrayHelper.prototype.setNumber=function(b,h){return this.array[this.indexOffset+b*this.componentSize]=h,this};SPE.TypedArrayHelper.prototype.getValueAtIndex=function(b){return this.array[this.indexOffset+b]};
SPE.TypedArrayHelper.prototype.getComponentValueAtIndex=function(b){return this.array.subarray(this.indexOffset+b*this.componentSize)};SPE.ShaderAttribute=function(b,h,k){var e=SPE.ShaderAttribute.typeSizeMap;this.type="string"==typeof b&&e.hasOwnProperty(b)?b:"f";this.componentSize=e[this.type];this.arrayType=k||Float32Array;this.bufferAttribute=this.typedArray=null;this.dynamicBuffer=!!h;this.updateMax=this.updateMin=0};SPE.ShaderAttribute.constructor=SPE.ShaderAttribute;
SPE.ShaderAttribute.typeSizeMap={f:1,v2:2,v3:3,v4:4,c:3,m3:9,m4:16};SPE.ShaderAttribute.prototype.setUpdateRange=function(b,h){this.updateMin=Math.min(b*this.componentSize,this.updateMin*this.componentSize);this.updateMax=Math.max(h*this.componentSize,this.updateMax*this.componentSize)};
SPE.ShaderAttribute.prototype.flagUpdate=function(){var b=this.bufferAttribute,h=b.updateRange;h.offset=this.updateMin;h.count=Math.min(this.updateMax-this.updateMin+this.componentSize,this.typedArray.array.length);b.needsUpdate=!0};SPE.ShaderAttribute.prototype.resetUpdateRange=function(){this.updateMax=this.updateMin=0};SPE.ShaderAttribute.prototype.resetDynamic=function(){this.bufferAttribute.dynamic=this.dynamicBuffer};
SPE.ShaderAttribute.prototype.splice=function(b,h){this.typedArray.splice(b,h);this.forceUpdateAll()};SPE.ShaderAttribute.prototype.forceUpdateAll=function(){this.bufferAttribute.array=this.typedArray.array;this.bufferAttribute.updateRange.offset=0;this.bufferAttribute.updateRange.count=-1;this.bufferAttribute.dynamic=!1;this.bufferAttribute.needsUpdate=!0};
SPE.ShaderAttribute.prototype._ensureTypedArray=function(b){null!==this.typedArray&&this.typedArray.size===b*this.componentSize||(null!==this.typedArray&&this.typedArray.size!==b?this.typedArray.setSize(b):null===this.typedArray&&(this.typedArray=new SPE.TypedArrayHelper(this.arrayType,b,this.componentSize)))};
SPE.ShaderAttribute.prototype._createBufferAttribute=function(b){return this._ensureTypedArray(b),null!==this.bufferAttribute?(this.bufferAttribute.array=this.typedArray.array,void(this.bufferAttribute.needsUpdate=!0)):(this.bufferAttribute=new THREE.BufferAttribute(this.typedArray.array,this.componentSize),void(this.bufferAttribute.dynamic=this.dynamicBuffer))};SPE.ShaderAttribute.prototype.getLength=function(){return null===this.typedArray?0:this.typedArray.array.length};
SPE.shaderChunks={defines:"#define PACKED_COLOR_SIZE 256.0\n#define PACKED_COLOR_DIVISOR 255.0",uniforms:"uniform float deltaTime;\nuniform float runTime;\nuniform sampler2D texture;\nuniform vec4 textureAnimation;\nuniform float scale;",attributes:"attribute vec4 acceleration;\nattribute vec3 velocity;\nattribute vec4 rotation;\nattribute vec3 rotationCenter;\nattribute vec4 params;\nattribute vec4 size;\nattribute vec4 angle;\nattribute vec4 color;\nattribute vec4 opacity;",varyings:"varying vec4 vColor;\n#ifdef SHOULD_ROTATE_TEXTURE\n    varying float vAngle;\n#endif\n#ifdef SHOULD_CALCULATE_SPRITE\n    varying vec4 vSpriteSheet;\n#endif",
branchAvoidanceFunctions:"float when_gt(float x, float y) {\n    return max(sign(x - y), 0.0);\n}\nfloat when_lt(float x, float y) {\n    return min( max(1.0 - sign(x - y), 0.0), 1.0 );\n}\nfloat when_eq( float x, float y ) {\n    return 1.0 - abs( sign( x - y ) );\n}\nfloat when_ge(float x, float y) {\n  return 1.0 - when_lt(x, y);\n}\nfloat when_le(float x, float y) {\n  return 1.0 - when_gt(x, y);\n}\nfloat and(float a, float b) {\n    return a * b;\n}\nfloat or(float a, float b) {\n    return min(a + b, 1.0);\n}",
unpackColor:"vec3 unpackColor( in float hex ) {\n   vec3 c = vec3( 0.0 );\n   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float b = mod( hex, PACKED_COLOR_SIZE );\n   c.r = r / PACKED_COLOR_DIVISOR;\n   c.g = g / PACKED_COLOR_DIVISOR;\n   c.b = b / PACKED_COLOR_DIVISOR;\n   return c;\n}",unpackRotationAxis:"vec3 unpackRotationAxis( in float hex ) {\n   vec3 c = vec3( 0.0 );\n   float r = mod( (hex / PACKED_COLOR_SIZE / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float g = mod( (hex / PACKED_COLOR_SIZE), PACKED_COLOR_SIZE );\n   float b = mod( hex, PACKED_COLOR_SIZE );\n   c.r = r / PACKED_COLOR_DIVISOR;\n   c.g = g / PACKED_COLOR_DIVISOR;\n   c.b = b / PACKED_COLOR_DIVISOR;\n   c *= vec3( 2.0 );\n   c -= vec3( 1.0 );\n   return c;\n}",
floatOverLifetime:"float getFloatOverLifetime( in float positionInTime, in vec4 attr ) {\n    highp float value = 0.0;\n    float deltaAge = positionInTime * float( VALUE_OVER_LIFETIME_LENGTH - 1 );\n    float fIndex = 0.0;\n    float shouldApplyValue = 0.0;\n    value += attr[ 0 ] * when_eq( deltaAge, 0.0 );\n\n    for( int i = 0; i < VALUE_OVER_LIFETIME_LENGTH - 1; ++i ) {\n       fIndex = float( i );\n       shouldApplyValue = and( when_gt( deltaAge, fIndex ), when_le( deltaAge, fIndex + 1.0 ) );\n       value += shouldApplyValue * mix( attr[ i ], attr[ i + 1 ], deltaAge - fIndex );\n    }\n\n    return value;\n}",
colorOverLifetime:"vec3 getColorOverLifetime( in float positionInTime, in vec3 color1, in vec3 color2, in vec3 color3, in vec3 color4 ) {\n    vec3 value = vec3( 0.0 );\n    value.x = getFloatOverLifetime( positionInTime, vec4( color1.x, color2.x, color3.x, color4.x ) );\n    value.y = getFloatOverLifetime( positionInTime, vec4( color1.y, color2.y, color3.y, color4.y ) );\n    value.z = getFloatOverLifetime( positionInTime, vec4( color1.z, color2.z, color3.z, color4.z ) );\n    return value;\n}",
paramFetchingFunctions:"float getAlive() {\n   return params.x;\n}\nfloat getAge() {\n   return params.y;\n}\nfloat getMaxAge() {\n   return params.z;\n}\nfloat getWiggle() {\n   return params.w;\n}",forceFetchingFunctions:"vec4 getPosition( in float age ) {\n   return modelViewMatrix * vec4( position, 1.0 );\n}\nvec3 getVelocity( in float age ) {\n   return velocity * age;\n}\nvec3 getAcceleration( in float age ) {\n   return acceleration.xyz * age;\n}",rotationFunctions:"#ifdef SHOULD_ROTATE_PARTICLES\n   mat4 getRotationMatrix( in vec3 axis, in float angle) {\n       axis = normalize(axis);\n       float s = sin(angle);\n       float c = cos(angle);\n       float oc = 1.0 - c;\n\n       return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,\n                   oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,\n                   oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,\n                   0.0,                                0.0,                                0.0,                                1.0);\n   }\n\n   vec3 getRotation( in vec3 pos, in float positionInTime ) {\n      if( rotation.y == 0.0 ) {\n           return pos;\n      }\n\n      vec3 axis = unpackRotationAxis( rotation.x );\n      vec3 center = rotationCenter;\n      vec3 translated;\n      mat4 rotationMatrix;\n      float angle = 0.0;\n      angle += when_eq( rotation.z, 0.0 ) * rotation.y;\n      angle += when_gt( rotation.z, 0.0 ) * mix( 0.0, rotation.y, positionInTime );\n      translated = rotationCenter - pos;\n      rotationMatrix = getRotationMatrix( axis, angle );\n      return center - vec3( rotationMatrix * vec4( translated, 0.0 ) );\n   }\n#endif",
rotateTexture:"    vec2 vUv = vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y );\n\n    #ifdef SHOULD_ROTATE_TEXTURE\n       float x = gl_PointCoord.x - 0.5;\n       float y = 1.0 - gl_PointCoord.y - 0.5;\n       float c = cos( -vAngle );\n       float s = sin( -vAngle );\n       vUv = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );\n    #endif\n\n    #ifdef SHOULD_CALCULATE_SPRITE\n        float framesX = vSpriteSheet.x;\n        float framesY = vSpriteSheet.y;\n        float columnNorm = vSpriteSheet.z;\n        float rowNorm = vSpriteSheet.w;\n        vUv.x = gl_PointCoord.x * framesX + columnNorm;\n        vUv.y = 1.0 - (gl_PointCoord.y * framesY + rowNorm);\n    #endif\n\n    vec4 rotatedTexture = texture2D( texture, vUv );"};
SPE.shaders={vertex:[SPE.shaderChunks.defines,SPE.shaderChunks.uniforms,SPE.shaderChunks.attributes,SPE.shaderChunks.varyings,THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,SPE.shaderChunks.branchAvoidanceFunctions,SPE.shaderChunks.unpackColor,SPE.shaderChunks.unpackRotationAxis,SPE.shaderChunks.floatOverLifetime,SPE.shaderChunks.colorOverLifetime,SPE.shaderChunks.paramFetchingFunctions,SPE.shaderChunks.forceFetchingFunctions,SPE.shaderChunks.rotationFunctions,"void main() {\n    highp float age = getAge();\n    highp float alive = getAlive();\n    highp float maxAge = getMaxAge();\n    highp float positionInTime = (age / maxAge);\n    highp float isAlive = when_gt( alive, 0.0 );\n    #ifdef SHOULD_WIGGLE_PARTICLES\n        float wiggleAmount = positionInTime * getWiggle();\n        float wiggleSin = isAlive * sin( wiggleAmount );\n        float wiggleCos = isAlive * cos( wiggleAmount );\n    #endif\n    vec3 vel = getVelocity( age );\n    vec3 accel = getAcceleration( age );\n    vec3 force = vec3( 0.0 );\n    vec3 pos = vec3( position );\n    float drag = 1.0 - (positionInTime * 0.5) * acceleration.w;\n    force += vel;\n    force *= drag;\n    force += accel * age;\n    pos += force;\n    #ifdef SHOULD_WIGGLE_PARTICLES\n        pos.x += wiggleSin;\n        pos.y += wiggleCos;\n        pos.z += wiggleSin;\n    #endif\n    #ifdef SHOULD_ROTATE_PARTICLES\n        pos = getRotation( pos, positionInTime );\n    #endif\n    vec4 mvPos = modelViewMatrix * vec4( pos, 1.0 );\n    highp float pointSize = getFloatOverLifetime( positionInTime, size ) * isAlive;\n    #ifdef HAS_PERSPECTIVE\n        float perspective = scale / length( mvPos.xyz );\n    #else\n        float perspective = 1.0;\n    #endif\n    float pointSizePerspective = pointSize * perspective;\n    #ifdef COLORIZE\n       vec3 c = isAlive * getColorOverLifetime(\n           positionInTime,\n           unpackColor( color.x ),\n           unpackColor( color.y ),\n           unpackColor( color.z ),\n           unpackColor( color.w )\n       );\n    #else\n       vec3 c = vec3(1.0);\n    #endif\n    float o = isAlive * getFloatOverLifetime( positionInTime, opacity );\n    vColor = vec4( c, o );\n    #ifdef SHOULD_ROTATE_TEXTURE\n        vAngle = isAlive * getFloatOverLifetime( positionInTime, angle );\n    #endif\n    #ifdef SHOULD_CALCULATE_SPRITE\n        float framesX = textureAnimation.x;\n        float framesY = textureAnimation.y;\n        float loopCount = textureAnimation.w;\n        float totalFrames = textureAnimation.z;\n        float frameNumber = mod( (positionInTime * loopCount) * totalFrames, totalFrames );\n        float column = floor(mod( frameNumber, framesX ));\n        float row = floor( (frameNumber - column) / framesX );\n        float columnNorm = column / framesX;\n        float rowNorm = row / framesY;\n        vSpriteSheet.x = 1.0 / framesX;\n        vSpriteSheet.y = 1.0 / framesY;\n        vSpriteSheet.z = columnNorm;\n        vSpriteSheet.w = rowNorm;\n    #endif\n    gl_PointSize = pointSizePerspective;\n    gl_Position = projectionMatrix * mvPos;",
THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragment:[SPE.shaderChunks.uniforms,THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,SPE.shaderChunks.varyings,SPE.shaderChunks.branchAvoidanceFunctions,"void main() {\n    vec3 outgoingLight = vColor.xyz;\n    \n    #ifdef ALPHATEST\n       if ( vColor.w < float(ALPHATEST) ) discard;\n    #endif",SPE.shaderChunks.rotateTexture,THREE.ShaderChunk.logdepthbuf_fragment,"    outgoingLight = vColor.xyz * rotatedTexture.xyz;",
THREE.ShaderChunk.fog_fragment,"    gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );\n}"].join("\n")};
SPE.utils={types:{BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object"},ensureTypedArg:function(b,h,k){return typeof b===h?b:k},ensureArrayTypedArg:function(b,h,k){if(Array.isArray(b)){for(var e=b.length-1;0<=e;--e)if(typeof b[e]!==h)return k;return b}return this.ensureTypedArg(b,h,k)},ensureInstanceOf:function(b,h,k){return void 0!==h&&b instanceof h?b:k},ensureArrayInstanceOf:function(b,h,k){if(Array.isArray(b)){for(var e=b.length-1;0<=e;--e)if(void 0!==h&&0==b[e]instanceof h)return k;
return b}return this.ensureInstanceOf(b,h,k)},ensureValueOverLifetimeCompliance:function(b,h,k){h=h||3;k=k||3;!1===Array.isArray(b._value)&&(b._value=[b._value]);!1===Array.isArray(b._spread)&&(b._spread=[b._spread]);var e=this.clamp(b._value.length,h,k);h=this.clamp(b._spread.length,h,k);e=Math.max(e,h);b._value.length!==e&&(b._value=this.interpolateArray(b._value,e));b._spread.length!==e&&(b._spread=this.interpolateArray(b._spread,e))},interpolateArray:function(b,h){for(var k=b.length,e=["function"==
typeof b[0].clone?b[0].clone():b[0]],p=(k-1)/(h-1),q=1;h-1>q;++q){var l=q*p,t=Math.floor(l);e[q]=this.lerpTypeAgnostic(b[t],b[Math.ceil(l)],l-t)}return e.push("function"==typeof b[k-1].clone?b[k-1].clone():b[k-1]),e},clamp:function(b,h,k){return Math.max(h,Math.min(b,k))},zeroToEpsilon:function(b,h){var k=b;return k=h?1E-4*Math.random():1E-5,0>b&&-1E-5<b&&(k=-k),k},lerpTypeAgnostic:function(b,h,k){var e,p=this.types;return typeof b===p.NUMBER&&typeof h===p.NUMBER?b+(h-b)*k:b instanceof THREE.Vector2&&
h instanceof THREE.Vector2?(e=b.clone(),e.x=this.lerp(b.x,h.x,k),e.y=this.lerp(b.y,h.y,k),e):b instanceof THREE.Vector3&&h instanceof THREE.Vector3?(e=b.clone(),e.x=this.lerp(b.x,h.x,k),e.y=this.lerp(b.y,h.y,k),e.z=this.lerp(b.z,h.z,k),e):b instanceof THREE.Vector4&&h instanceof THREE.Vector4?(e=b.clone(),e.x=this.lerp(b.x,h.x,k),e.y=this.lerp(b.y,h.y,k),e.z=this.lerp(b.z,h.z,k),e.w=this.lerp(b.w,h.w,k),e):b instanceof THREE.Color&&h instanceof THREE.Color?(e=b.clone(),e.r=this.lerp(b.r,h.r,k),e.g=
this.lerp(b.g,h.g,k),e.b=this.lerp(b.b,h.b,k),e):void console.warn("Invalid argument types, or argument types do not match:",b,h)},lerp:function(b,h,k){return b+(h-b)*k},roundToNearestMultiple:function(b,h){var k=0;return 0===h?b:(k=Math.abs(b)%h,0===k?b:0>b?-(Math.abs(b)-k):b+h-k)},arrayValuesAreEqual:function(b){for(var h=0;h<b.length-1;++h)if(b[h]!==b[h+1])return!1;return!0},randomFloat:function(b,h){return b+h*(Math.random()-.5)},randomVector3:function(b,h,k,e,p){var q=k.x+(Math.random()*e.x-
.5*e.x),l=k.y+(Math.random()*e.y-.5*e.y);k=k.z+(Math.random()*e.z-.5*e.z);p&&(q=.5*-p.x+this.roundToNearestMultiple(q,p.x),l=.5*-p.y+this.roundToNearestMultiple(l,p.y),k=.5*-p.z+this.roundToNearestMultiple(k,p.z));b.typedArray.setVec3Components(h,q,l,k)},randomColor:function(b,h,k,e){var p=k.r+Math.random()*e.x,q=k.g+Math.random()*e.y;k=k.b+Math.random()*e.z;p=this.clamp(p,0,1);q=this.clamp(q,0,1);k=this.clamp(k,0,1);b.typedArray.setVec3Components(h,p,q,k)},randomColorAsHex:function(){var b=new THREE.Color;
return function(h,k,e,p){for(var q=e.length,l=[],t=0;q>t;++t){var r=p[t];b.copy(e[t]);b.r+=Math.random()*r.x-.5*r.x;b.g+=Math.random()*r.y-.5*r.y;b.b+=Math.random()*r.z-.5*r.z;b.r=this.clamp(b.r,0,1);b.g=this.clamp(b.g,0,1);b.b=this.clamp(b.b,0,1);l.push(b.getHex())}h.typedArray.setVec4Components(k,l[0],l[1],l[2],l[3])}}(),randomVector3OnSphere:function(b,h,k,e,p,q,l,t){t=2*Math.random()-1;var r=6.2832*Math.random(),y=Math.sqrt(1-t*t);e=this.randomFloat(e,p);l&&(e=Math.round(e/l)*l);l=y*Math.cos(r)*
e;r=y*Math.sin(r)*e;l*=q.x;r*=q.y;q=t*e*q.z;l+=k.x;r+=k.y;q+=k.z;b.typedArray.setVec3Components(h,l,r,q)},seededRandom:function(b){b=1E4*Math.sin(b);return b-(0|b)},randomVector3OnDisc:function(b,h,k,e,p,q,l){var t=6.2832*Math.random();e=Math.abs(this.randomFloat(e,p));l&&(e=Math.round(e/l)*l);l=Math.cos(t)*e;t=Math.sin(t)*e;l*=q.x;t*=q.y;l+=k.x;t+=k.y;k=0+k.z;b.typedArray.setVec3Components(h,l,t,k)},randomDirectionVector3OnSphere:function(){var b=new THREE.Vector3;return function(h,k,e,p,q,l,t,r){b.copy(l);
b.x-=e;b.y-=p;b.z-=q;b.normalize().multiplyScalar(-this.randomFloat(t,r));h.typedArray.setVec3Components(k,b.x,b.y,b.z)}}(),randomDirectionVector3OnDisc:function(){var b=new THREE.Vector3;return function(h,k,e,p,q,l,t,r){b.copy(l);b.x-=e;b.y-=p;b.z-=q;b.normalize().multiplyScalar(-this.randomFloat(t,r));h.typedArray.setVec3Components(k,b.x,b.y,0)}}(),getPackedRotationAxis:function(){var b=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Color,e=new THREE.Vector3(1,1,1);return function(p,q){return b.copy(p).normalize(),
h.copy(q).normalize(),b.x+=.5*-q.x+Math.random()*q.x,b.y+=.5*-q.y+Math.random()*q.y,b.z+=.5*-q.z+Math.random()*q.z,b.normalize().add(e).multiplyScalar(.5),k.setRGB(b.x,b.y,b.z),k.getHex()}}()};
SPE.Group=function(b){var h=SPE.utils,k=h.types;b=h.ensureTypedArg(b,k.OBJECT,{});b.texture=h.ensureTypedArg(b.texture,k.OBJECT,{});this.uuid=THREE.Math.generateUUID();this.fixedTimeStep=h.ensureTypedArg(b.fixedTimeStep,k.NUMBER,.016);this.texture=h.ensureInstanceOf(b.texture.value,THREE.Texture,null);this.textureFrames=h.ensureInstanceOf(b.texture.frames,THREE.Vector2,new THREE.Vector2(1,1));this.textureFrameCount=h.ensureTypedArg(b.texture.frameCount,k.NUMBER,this.textureFrames.x*this.textureFrames.y);
this.textureLoop=h.ensureTypedArg(b.texture.loop,k.NUMBER,1);this.textureFrames.max(new THREE.Vector2(1,1));this.hasPerspective=h.ensureTypedArg(b.hasPerspective,k.BOOLEAN,!0);this.colorize=h.ensureTypedArg(b.colorize,k.BOOLEAN,!0);this.maxParticleCount=h.ensureTypedArg(b.maxParticleCount,k.NUMBER,null);this.blending=h.ensureTypedArg(b.blending,k.NUMBER,THREE.AdditiveBlending);this.transparent=h.ensureTypedArg(b.transparent,k.BOOLEAN,!0);this.alphaTest=parseFloat(h.ensureTypedArg(b.alphaTest,k.NUMBER,
0));this.depthWrite=h.ensureTypedArg(b.depthWrite,k.BOOLEAN,!1);this.depthTest=h.ensureTypedArg(b.depthTest,k.BOOLEAN,!0);this.fog=h.ensureTypedArg(b.fog,k.BOOLEAN,!0);this.scale=h.ensureTypedArg(b.scale,k.NUMBER,300);this.emitters=[];this.emitterIDs=[];this._pool=[];this._poolCreationSettings=null;this._createNewWhenPoolEmpty=0;this._attributesNeedDynamicReset=this._attributesNeedRefresh=!1;this.particleCount=0;this.uniforms={texture:{type:"t",value:this.texture},textureAnimation:{type:"v4",value:new THREE.Vector4(this.textureFrames.x,
this.textureFrames.y,this.textureFrameCount,Math.max(Math.abs(this.textureLoop),1))},fogColor:{type:"c",value:null},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5},deltaTime:{type:"f",value:0},runTime:{type:"f",value:0},scale:{type:"f",value:this.scale}};this.defines={HAS_PERSPECTIVE:this.hasPerspective,COLORIZE:this.colorize,VALUE_OVER_LIFETIME_LENGTH:SPE.valueOverLifetimeLength,SHOULD_ROTATE_TEXTURE:!1,SHOULD_ROTATE_PARTICLES:!1,SHOULD_WIGGLE_PARTICLES:!1,
SHOULD_CALCULATE_SPRITE:1<this.textureFrames.x||1<this.textureFrames.y};this.attributes={position:new SPE.ShaderAttribute("v3",!0),acceleration:new SPE.ShaderAttribute("v4",!0),velocity:new SPE.ShaderAttribute("v3",!0),rotation:new SPE.ShaderAttribute("v4",!0),rotationCenter:new SPE.ShaderAttribute("v3",!0),params:new SPE.ShaderAttribute("v4",!0),size:new SPE.ShaderAttribute("v4",!0),angle:new SPE.ShaderAttribute("v4",!0),color:new SPE.ShaderAttribute("v4",!0),opacity:new SPE.ShaderAttribute("v4",
!0)};this.attributeKeys=Object.keys(this.attributes);this.attributeCount=this.attributeKeys.length;this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:this.blending,transparent:this.transparent,alphaTest:this.alphaTest,depthWrite:this.depthWrite,depthTest:this.depthTest,defines:this.defines,fog:this.fog});this.geometry=new THREE.BufferGeometry;this.mesh=new THREE.Points(this.geometry,this.material);null===this.maxParticleCount&&
console.warn("SPE.Group: No maxParticleCount specified. Adding emitters after rendering will probably cause errors.")};SPE.Group.constructor=SPE.Group;
SPE.Group.prototype._updateDefines=function(){var b=this.emitters,h=b.length-1,k=this.defines;for(h;0<=h;--h){var e=b[h];k.SHOULD_CALCULATE_SPRITE||(k.SHOULD_ROTATE_TEXTURE=k.SHOULD_ROTATE_TEXTURE||!!Math.max(Math.max.apply(null,e.angle.value),Math.max.apply(null,e.angle.spread)));k.SHOULD_ROTATE_PARTICLES=k.SHOULD_ROTATE_PARTICLES||!!Math.max(e.rotation.angle,e.rotation.angleSpread);k.SHOULD_WIGGLE_PARTICLES=k.SHOULD_WIGGLE_PARTICLES||!!Math.max(e.wiggle.value,e.wiggle.spread)}this.material.needsUpdate=
!0};SPE.Group.prototype._applyAttributesToGeometry=function(){var b,h,k=this.attributes,e=this.geometry,p=e.attributes,q;for(q in k)k.hasOwnProperty(q)&&(b=k[q],h=p[q],h?h.array=b.typedArray.array:e.addAttribute(q,b.bufferAttribute),b.bufferAttribute.needsUpdate=!0);this.geometry.setDrawRange(0,this.particleCount)};
SPE.Group.prototype.addEmitter=function(b){if(0==b instanceof SPE.Emitter)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",b);if(-1<this.emitterIDs.indexOf(b.uuid))return void console.error("Emitter already exists in this group. Will not add again.");if(null!==b.group)return void console.error("Emitter already belongs to another group. Will not add to requested group.");var h=this.attributes,k=this.particleCount,e=k+b.particleCount;this.particleCount=
e;null!==this.maxParticleCount&&this.particleCount>this.maxParticleCount&&console.warn("SPE.Group: maxParticleCount exceeded. Requesting",this.particleCount,"particles, can support only",this.maxParticleCount);b._calculatePPSValue(b.maxAge._value+b.maxAge._spread);b._setBufferUpdateRanges(this.attributeKeys);b._setAttributeOffset(k);b.group=this;b.attributes=this.attributes;for(var p in h)h.hasOwnProperty(p)&&h[p]._createBufferAttribute(null!==this.maxParticleCount?this.maxParticleCount:this.particleCount);
for(h=k;e>h;++h)b._assignPositionValue(h),b._assignForceValue(h,"velocity"),b._assignForceValue(h,"acceleration"),b._assignAbsLifetimeValue(h,"opacity"),b._assignAbsLifetimeValue(h,"size"),b._assignAngleValue(h),b._assignRotationValue(h),b._assignParamsValue(h),b._assignColorValue(h);return this._applyAttributesToGeometry(),this.emitters.push(b),this.emitterIDs.push(b.uuid),this._updateDefines(b),this.material.needsUpdate=!0,this.geometry.needsUpdate=!0,this._attributesNeedRefresh=!0,this};
SPE.Group.prototype.removeEmitter=function(b){var h=this.emitterIDs.indexOf(b.uuid);if(0==b instanceof SPE.Emitter)return void console.error("`emitter` argument must be instance of SPE.Emitter. Was provided with:",b);if(-1===h)return void console.error("Emitter does not exist in this group. Will not remove.");for(var k=b.attributeOffset,e=k+b.particleCount,p=this.attributes.params.typedArray,q=k;e>q;++q)p.array[4*q]=0,p.array[4*q+1]=0;this.emitters.splice(h,1);this.emitterIDs.splice(h,1);for(var l in this.attributes)this.attributes.hasOwnProperty(l)&&
this.attributes[l].splice(k,e);this.particleCount-=b.particleCount;b._onRemove();this._attributesNeedRefresh=!0};SPE.Group.prototype.getFromPool=function(){var b=this._pool,h=this._createNewWhenPoolEmpty;return b.length?b.pop():h?new SPE.Emitter(this._poolCreationSettings):null};SPE.Group.prototype.releaseIntoPool=function(b){return 0==b instanceof SPE.Emitter?void console.error("Argument is not instanceof SPE.Emitter:",b):(b.reset(),this._pool.unshift(b),this)};SPE.Group.prototype.getPool=function(){return this._pool};
SPE.Group.prototype.addPool=function(b,h,k){this._poolCreationSettings=h;this._createNewWhenPoolEmpty=!!k;for(var e=0;b>e;++e)k=Array.isArray(h)?new SPE.Emitter(h[e]):new SPE.Emitter(h),this.addEmitter(k),this.releaseIntoPool(k);return this};
SPE.Group.prototype._triggerSingleEmitter=function(b){var h=this.getFromPool(),k=this;return null===h?void console.log("SPE.Group pool ran out."):(b instanceof THREE.Vector3&&(h.position.value.copy(b),h.position.value=h.position.value),h.enable(),setTimeout(function(){h.disable();k.releaseIntoPool(h)},1E3*Math.max(h.duration,h.maxAge.value+h.maxAge.spread)),this)};
SPE.Group.prototype.triggerPoolEmitter=function(b,h){if("number"==typeof b&&1<b)for(var k=0;b>k;++k)this._triggerSingleEmitter(h);else this._triggerSingleEmitter(h);return this};SPE.Group.prototype._updateUniforms=function(b){this.uniforms.runTime.value+=b;this.uniforms.deltaTime.value=b};SPE.Group.prototype._resetBufferRanges=function(){var b=this.attributeKeys,h=this.attributeCount-1,k=this.attributes;for(h;0<=h;--h)k[b[h]].resetUpdateRange()};
SPE.Group.prototype._updateBuffers=function(b){var h=this.attributeKeys,k=this.attributeCount-1,e=this.attributes,p=b.bufferUpdateRanges;for(k;0<=k;--k){var q=h[k];b=p[q];q=e[q];q.setUpdateRange(b.min,b.max);q.flagUpdate()}};
SPE.Group.prototype.tick=function(b){var h=this.emitters,k=h.length,e=b||this.fixedTimeStep,p=this.attributeKeys,q=this.attributes;if(this._updateUniforms(e),this._resetBufferRanges(),0!==k||!1!==this._attributesNeedRefresh||!1!==this._attributesNeedDynamicReset){for(b=0;k>b;++b){var l=h[b];l.tick(e);this._updateBuffers(l)}if(!0===this._attributesNeedDynamicReset){for(b=this.attributeCount-1;0<=b;--b)q[p[b]].resetDynamic();this._attributesNeedDynamicReset=!1}if(!0===this._attributesNeedRefresh){for(b=
this.attributeCount-1;0<=b;--b)q[p[b]].forceUpdateAll();this._attributesNeedRefresh=!1;this._attributesNeedDynamicReset=!0}}};SPE.Group.prototype.dispose=function(){return this.geometry.dispose(),this.material.dispose(),this};
SPE.Emitter=function(b){var h=SPE.utils,k=h.types,e=SPE.valueOverLifetimeLength;b=h.ensureTypedArg(b,k.OBJECT,{});b.position=h.ensureTypedArg(b.position,k.OBJECT,{});b.velocity=h.ensureTypedArg(b.velocity,k.OBJECT,{});b.acceleration=h.ensureTypedArg(b.acceleration,k.OBJECT,{});b.radius=h.ensureTypedArg(b.radius,k.OBJECT,{});b.drag=h.ensureTypedArg(b.drag,k.OBJECT,{});b.rotation=h.ensureTypedArg(b.rotation,k.OBJECT,{});b.color=h.ensureTypedArg(b.color,k.OBJECT,{});b.opacity=h.ensureTypedArg(b.opacity,
k.OBJECT,{});b.size=h.ensureTypedArg(b.size,k.OBJECT,{});b.angle=h.ensureTypedArg(b.angle,k.OBJECT,{});b.wiggle=h.ensureTypedArg(b.wiggle,k.OBJECT,{});b.maxAge=h.ensureTypedArg(b.maxAge,k.OBJECT,{});b.onParticleSpawn&&console.warn("onParticleSpawn has been removed. Please set properties directly to alter values at runtime.");this.uuid=THREE.Math.generateUUID();this.type=h.ensureTypedArg(b.type,k.NUMBER,SPE.distributions.BOX);this.position={_value:h.ensureInstanceOf(b.position.value,THREE.Vector3,
new THREE.Vector3),_spread:h.ensureInstanceOf(b.position.spread,THREE.Vector3,new THREE.Vector3),_spreadClamp:h.ensureInstanceOf(b.position.spreadClamp,THREE.Vector3,new THREE.Vector3),_distribution:h.ensureTypedArg(b.position.distribution,k.NUMBER,this.type),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1),_radius:h.ensureTypedArg(b.position.radius,k.NUMBER,10),_radiusScale:h.ensureInstanceOf(b.position.radiusScale,THREE.Vector3,new THREE.Vector3(1,1,1)),_distributionClamp:h.ensureTypedArg(b.position.distributionClamp,
k.NUMBER,0)};this.velocity={_value:h.ensureInstanceOf(b.velocity.value,THREE.Vector3,new THREE.Vector3),_spread:h.ensureInstanceOf(b.velocity.spread,THREE.Vector3,new THREE.Vector3),_distribution:h.ensureTypedArg(b.velocity.distribution,k.NUMBER,this.type),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.acceleration={_value:h.ensureInstanceOf(b.acceleration.value,THREE.Vector3,new THREE.Vector3),_spread:h.ensureInstanceOf(b.acceleration.spread,THREE.Vector3,new THREE.Vector3),
_distribution:h.ensureTypedArg(b.acceleration.distribution,k.NUMBER,this.type),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.drag={_value:h.ensureTypedArg(b.drag.value,k.NUMBER,0),_spread:h.ensureTypedArg(b.drag.spread,k.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.wiggle={_value:h.ensureTypedArg(b.wiggle.value,k.NUMBER,0),_spread:h.ensureTypedArg(b.wiggle.spread,k.NUMBER,0)};this.rotation={_axis:h.ensureInstanceOf(b.rotation.axis,THREE.Vector3,
new THREE.Vector3(0,1,0)),_axisSpread:h.ensureInstanceOf(b.rotation.axisSpread,THREE.Vector3,new THREE.Vector3),_angle:h.ensureTypedArg(b.rotation.angle,k.NUMBER,0),_angleSpread:h.ensureTypedArg(b.rotation.angleSpread,k.NUMBER,0),_static:h.ensureTypedArg(b.rotation["static"],k.BOOLEAN,!1),_center:h.ensureInstanceOf(b.rotation.center,THREE.Vector3,this.position._value.clone()),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.maxAge={_value:h.ensureTypedArg(b.maxAge.value,k.NUMBER,
2),_spread:h.ensureTypedArg(b.maxAge.spread,k.NUMBER,0)};this.color={_value:h.ensureArrayInstanceOf(b.color.value,THREE.Color,new THREE.Color),_spread:h.ensureArrayInstanceOf(b.color.spread,THREE.Vector3,new THREE.Vector3),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.opacity={_value:h.ensureArrayTypedArg(b.opacity.value,k.NUMBER,1),_spread:h.ensureArrayTypedArg(b.opacity.spread,k.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.size={_value:h.ensureArrayTypedArg(b.size.value,
k.NUMBER,1),_spread:h.ensureArrayTypedArg(b.size.spread,k.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.angle={_value:h.ensureArrayTypedArg(b.angle.value,k.NUMBER,0),_spread:h.ensureArrayTypedArg(b.angle.spread,k.NUMBER,0),_randomise:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)};this.particleCount=h.ensureTypedArg(b.particleCount,k.NUMBER,100);this.duration=h.ensureTypedArg(b.duration,k.NUMBER,null);this.isStatic=h.ensureTypedArg(b.isStatic,k.BOOLEAN,!1);this.activeMultiplier=
h.ensureTypedArg(b.activeMultiplier,k.NUMBER,1);this.direction=h.ensureTypedArg(b.direction,k.NUMBER,1);this.alive=h.ensureTypedArg(b.alive,k.BOOLEAN,!0);this.activeParticleCount=this.age=this.attributeEnd=this.attributeOffset=this.activationIndex=this.particlesPerSecond=0;this.paramsArray=this.attributes=this.group=null;this.resetFlags={position:h.ensureTypedArg(b.position.randomise,k.BOOLEAN,!1)||h.ensureTypedArg(b.radius.randomise,k.BOOLEAN,!1),velocity:h.ensureTypedArg(b.velocity.randomise,k.BOOLEAN,
!1),acceleration:h.ensureTypedArg(b.acceleration.randomise,k.BOOLEAN,!1)||h.ensureTypedArg(b.drag.randomise,k.BOOLEAN,!1),rotation:h.ensureTypedArg(b.rotation.randomise,k.BOOLEAN,!1),rotationCenter:h.ensureTypedArg(b.rotation.randomise,k.BOOLEAN,!1),size:h.ensureTypedArg(b.size.randomise,k.BOOLEAN,!1),color:h.ensureTypedArg(b.color.randomise,k.BOOLEAN,!1),opacity:h.ensureTypedArg(b.opacity.randomise,k.BOOLEAN,!1),angle:h.ensureTypedArg(b.angle.randomise,k.BOOLEAN,!1)};this.updateFlags={};this.updateCounts=
{};this.updateMap={maxAge:"params",position:"position",velocity:"velocity",acceleration:"acceleration",drag:"acceleration",wiggle:"params",rotation:"rotation",size:"size",color:"color",opacity:"opacity",angle:"angle"};for(var p in this.updateMap)this.updateMap.hasOwnProperty(p)&&(this.updateCounts[this.updateMap[p]]=0,this.updateFlags[this.updateMap[p]]=!1,this._createGetterSetters(this[p],p));this.bufferUpdateRanges={};this.attributeKeys=null;this.attributeCount=0;h.ensureValueOverLifetimeCompliance(this.color,
e,e);h.ensureValueOverLifetimeCompliance(this.opacity,e,e);h.ensureValueOverLifetimeCompliance(this.size,e,e);h.ensureValueOverLifetimeCompliance(this.angle,e,e)};SPE.Emitter.constructor=SPE.Emitter;
SPE.Emitter.prototype._createGetterSetters=function(b,h){var k=this,e;for(e in b)if(b.hasOwnProperty(e)){var p=e.replace("_","");Object.defineProperty(b,p,{get:function(q){return function(){return this[q]}}(e),set:function(q){return function(l){var t=k.updateMap[h],r=this[q],y=SPE.valueOverLifetimeLength;"_rotationCenter"===q?(k.updateFlags.rotationCenter=!0,k.updateCounts.rotationCenter=0):"_randomise"===q?k.resetFlags[t]=l:(k.updateFlags[t]=!0,k.updateCounts[t]=0);k.group._updateDefines();this[q]=
l;Array.isArray(r)&&SPE.utils.ensureValueOverLifetimeCompliance(k[h],y,y)}}(e)})}};SPE.Emitter.prototype._setBufferUpdateRanges=function(b){this.attributeKeys=b;this.attributeCount=b.length;for(var h=this.attributeCount-1;0<=h;--h)this.bufferUpdateRanges[b[h]]={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}};SPE.Emitter.prototype._calculatePPSValue=function(b){var h=this.particleCount;this.duration?this.particlesPerSecond=h/(b<this.duration?b:this.duration):this.particlesPerSecond=h/b};
SPE.Emitter.prototype._setAttributeOffset=function(b){this.activationIndex=this.attributeOffset=b;this.activationEnd=b+this.particleCount};
SPE.Emitter.prototype._assignValue=function(b,h){switch(b){case "position":this._assignPositionValue(h);break;case "velocity":case "acceleration":this._assignForceValue(h,b);break;case "size":case "opacity":this._assignAbsLifetimeValue(h,b);break;case "angle":this._assignAngleValue(h);break;case "params":this._assignParamsValue(h);break;case "rotation":this._assignRotationValue(h);break;case "color":this._assignColorValue(h)}};
SPE.Emitter.prototype._assignPositionValue=function(b){var h=SPE.distributions,k=SPE.utils,e=this.position,p=this.attributes.position,q=e._value,l=e._spread;switch(e._distribution){case h.BOX:k.randomVector3(p,b,q,l,e._spreadClamp);break;case h.SPHERE:k.randomVector3OnSphere(p,b,q,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x,e._distributionClamp||this.particleCount);break;case h.DISC:k.randomVector3OnDisc(p,b,q,e._radius,e._spread.x,e._radiusScale,e._spreadClamp.x)}};
SPE.Emitter.prototype._assignForceValue=function(b,h){var k=SPE.distributions;var e=SPE.utils,p=this[h];var q=p._value;var l=p._spread;switch(p._distribution){case k.BOX:e.randomVector3(this.attributes[h],b,q,l);break;case k.SPHERE:l=this.attributes.position.typedArray.array;var t=3*b;k=l[t];q=l[t+1];l=l[t+2];e.randomDirectionVector3OnSphere(this.attributes[h],b,k,q,l,this.position._value,p._value.x,p._spread.x);break;case k.DISC:l=this.attributes.position.typedArray.array,t=3*b,k=l[t],q=l[t+1],l=
l[t+2],e.randomDirectionVector3OnDisc(this.attributes[h],b,k,q,l,this.position._value,p._value.x,p._spread.x)}"acceleration"===h&&(h=e.clamp(e.randomFloat(this.drag._value,this.drag._spread),0,1),this.attributes.acceleration.typedArray.array[4*b+3]=h)};
SPE.Emitter.prototype._assignAbsLifetimeValue=function(b,h){var k,e=this.attributes[h].typedArray;h=this[h];var p=SPE.utils;p.arrayValuesAreEqual(h._value)&&p.arrayValuesAreEqual(h._spread)?(k=Math.abs(p.randomFloat(h._value[0],h._spread[0])),e.setVec4Components(b,k,k,k,k)):e.setVec4Components(b,Math.abs(p.randomFloat(h._value[0],h._spread[0])),Math.abs(p.randomFloat(h._value[1],h._spread[1])),Math.abs(p.randomFloat(h._value[2],h._spread[2])),Math.abs(p.randomFloat(h._value[3],h._spread[3])))};
SPE.Emitter.prototype._assignAngleValue=function(b){var h,k=this.attributes.angle.typedArray,e=this.angle,p=SPE.utils;p.arrayValuesAreEqual(e._value)&&p.arrayValuesAreEqual(e._spread)?(h=p.randomFloat(e._value[0],e._spread[0]),k.setVec4Components(b,h,h,h,h)):k.setVec4Components(b,p.randomFloat(e._value[0],e._spread[0]),p.randomFloat(e._value[1],e._spread[1]),p.randomFloat(e._value[2],e._spread[2]),p.randomFloat(e._value[3],e._spread[3]))};
SPE.Emitter.prototype._assignParamsValue=function(b){this.attributes.params.typedArray.setVec4Components(b,this.isStatic?1:0,0,Math.abs(SPE.utils.randomFloat(this.maxAge._value,this.maxAge._spread)),SPE.utils.randomFloat(this.wiggle._value,this.wiggle._spread))};
SPE.Emitter.prototype._assignRotationValue=function(b){this.attributes.rotation.typedArray.setVec3Components(b,SPE.utils.getPackedRotationAxis(this.rotation._axis,this.rotation._axisSpread),SPE.utils.randomFloat(this.rotation._angle,this.rotation._angleSpread),this.rotation._static?0:1);this.attributes.rotationCenter.typedArray.setVec3(b,this.rotation._center)};SPE.Emitter.prototype._assignColorValue=function(b){SPE.utils.randomColorAsHex(this.attributes.color,b,this.color._value,this.color._spread)};
SPE.Emitter.prototype._resetParticle=function(b){for(var h,k,e=this.resetFlags,p=this.updateFlags,q=this.updateCounts,l=this.attributeKeys,t=this.attributeCount-1;0<=t;--t)h=l[t],k=p[h],!0!==e[h]&&!0!==k||(this._assignValue(h,b),this._updateAttributeUpdateRange(h,b),!0===k&&q[h]===this.particleCount?(p[h]=!1,q[h]=0):1==k&&++q[h])};SPE.Emitter.prototype._updateAttributeUpdateRange=function(b,h){b=this.bufferUpdateRanges[b];b.min=Math.min(h,b.min);b.max=Math.max(h,b.max)};
SPE.Emitter.prototype._resetBufferRanges=function(){var b=this.bufferUpdateRanges,h=this.bufferUpdateKeys,k=this.bufferUpdateCount-1;for(k;0<=k;--k){var e=h[k];b[e].min=Number.POSITIVE_INFINITY;b[e].max=Number.NEGATIVE_INFINITY}};SPE.Emitter.prototype._onRemove=function(){this.activeParticleCount=this.activationIndex=this.attributeOffset=this.particlesPerSecond=0;this.paramsArray=this.attributes=this.group=null;this.age=0};SPE.Emitter.prototype._decrementParticleCount=function(){--this.activeParticleCount};
SPE.Emitter.prototype._incrementParticleCount=function(){++this.activeParticleCount};SPE.Emitter.prototype._checkParticleAges=function(b,h,k,e){for(var p,q,l,t=h-1;t>=b;--t)h=4*t,l=k[h],0!==l&&(q=k[h+1],p=k[h+2],1===this.direction?(q+=e,q>=p&&(q=0,l=0,this._decrementParticleCount())):(q-=e,0>=q&&(q=p,l=0,this._decrementParticleCount())),k[h]=l,k[h+1]=q,this._updateAttributeUpdateRange("params",t))};
SPE.Emitter.prototype._activateParticles=function(b,h,k,e){for(var p,q,l=this.direction,t=b;h>t;++t)p=4*t,0!=k[p]&&1!==this.particleCount||(this._incrementParticleCount(),k[p]=1,this._resetParticle(t),q=e*(t-b),k[p+1]=-1===l?k[p+2]-q:q,this._updateAttributeUpdateRange("params",t))};
SPE.Emitter.prototype.tick=function(b){if(!this.isStatic){null===this.paramsArray&&(this.paramsArray=this.attributes.params.typedArray.array);var h=this.attributeOffset,k=h+this.particleCount,e=this.paramsArray,p=this.particlesPerSecond*this.activeMultiplier*b,q=this.activationIndex;if(this._resetBufferRanges(),this._checkParticleAges(h,k,e,b),!1===this.alive)return void(this.age=0);if(null!==this.duration&&this.age>this.duration)return this.alive=!1,void(this.age=0);q=1===this.particleCount?q:0|
q;var l=Math.min(q+p,this.activationEnd),t=l-this.activationIndex|0;this._activateParticles(q,l,e,0<t?b/t:0);this.activationIndex+=p;this.activationIndex>k&&(this.activationIndex=h);this.age+=b}};SPE.Emitter.prototype.reset=function(b){if(this.age=0,this.alive=!1,!0===b){for(var h=this.attributeOffset,k=this.paramsArray,e=this.attributes.params.bufferAttribute,p=h+this.particleCount-1;p>=h;--p)b=4*p,k[b]=0,k[b+1]=0;e.updateRange.offset=0;e.updateRange.count=-1;e.needsUpdate=!0}return this};
SPE.Emitter.prototype.enable=function(){return this.alive=!0,this};SPE.Emitter.prototype.disable=function(){return this.alive=!1,this};SPE.Emitter.prototype.remove=function(){return null!==this.group?this.group.removeEmitter(this):console.error("Emitter does not belong to a group, cannot remove."),this};
var __extends=this&&this.__extends||function(b,h){function k(){this.constructor=b}for(var e in h)h.hasOwnProperty(e)&&(b[e]=h[e]);b.prototype=null===h?Object.create(h):(k.prototype=h.prototype,new k)},spine;
(function(b){var h=function(){function l(t,r,y){if(null==t)throw Error("name cannot be null.");if(null==r)throw Error("timelines cannot be null.");this.name=t;this.timelines=r;this.duration=y}l.prototype.apply=function(t,r,y,z,E,B,F,I){if(null==t)throw Error("skeleton cannot be null.");z&&0!=this.duration&&(y%=this.duration,0<r&&(r%=this.duration));z=this.timelines;for(var L=0,U=z.length;L<U;L++)z[L].apply(t,r,y,E,B,F,I)};l.binarySearch=function(t,r,y){void 0===y&&(y=1);var z=0,E=t.length/y-2;if(0==
E)return y;for(var B=E>>>1;;){t[(B+1)*y]<=r?z=B+1:E=B;if(z==E)return(z+1)*y;B=z+E>>>1}};l.linearSearch=function(t,r,y){for(var z=0,E=t.length-y;z<=E;z+=y)if(t[z]>r)return z;return-1};return l}();b.Animation=h;(function(l){l[l.rotate=0]="rotate";l[l.translate=1]="translate";l[l.scale=2]="scale";l[l.shear=3]="shear";l[l.attachment=4]="attachment";l[l.color=5]="color";l[l.deform=6]="deform";l[l.event=7]="event";l[l.drawOrder=8]="drawOrder";l[l.ikConstraint=9]="ikConstraint";l[l.transformConstraint=10]=
"transformConstraint";l[l.pathConstraintPosition=11]="pathConstraintPosition";l[l.pathConstraintSpacing=12]="pathConstraintSpacing";l[l.pathConstraintMix=13]="pathConstraintMix"})(b.TimelineType||(b.TimelineType={}));var k=b.TimelineType,e=function(){function l(t){if(0>=t)throw Error("frameCount must be > 0: "+t);this.curves=b.Utils.newFloatArray((t-1)*l.BEZIER_SIZE)}l.prototype.getFrameCount=function(){return this.curves.length/l.BEZIER_SIZE+1};l.prototype.setLinear=function(t){this.curves[t*l.BEZIER_SIZE]=
l.LINEAR};l.prototype.setStepped=function(t){this.curves[t*l.BEZIER_SIZE]=l.STEPPED};l.prototype.getCurveType=function(t){t*=l.BEZIER_SIZE;if(t==this.curves.length)return l.LINEAR;t=this.curves[t];return t==l.LINEAR?l.LINEAR:t==l.STEPPED?l.STEPPED:l.BEZIER};l.prototype.setCurve=function(t,r,y,z,E){var B=.03*(2*-r+z),F=.03*(2*-y+E);z=.006*(3*(r-z)+1);E=.006*(3*(y-E)+1);var I=2*B+z,L=2*F+E;r=.3*r+B+.16666667*z;y=.3*y+F+.16666667*E;t*=l.BEZIER_SIZE;F=this.curves;F[t++]=l.BEZIER;B=r;for(var U=y,n=t+l.BEZIER_SIZE-
1;t<n;t+=2)F[t]=B,F[t+1]=U,r+=I,y+=L,I+=z,L+=E,B+=r,U+=y};l.prototype.getCurvePercent=function(t,r){r=b.MathUtils.clamp(r,0,1);var y=this.curves;t*=l.BEZIER_SIZE;var z=y[t];if(z==l.LINEAR)return r;if(z==l.STEPPED)return 0;t++;z=0;for(var E=t,B=t+l.BEZIER_SIZE-1;t<B;t+=2)if(z=y[t],z>=r)return t==E?B=E=0:(E=y[t-2],B=y[t-1]),B+(y[t+1]-B)*(r-E)/(z-E);y=y[t-1];return y+(1-y)*(r-z)/(1-z)};l.LINEAR=0;l.STEPPED=1;l.BEZIER=2;l.BEZIER_SIZE=19;return l}();b.CurveTimeline=e;var p=function(l){function t(r){l.call(this,
r);this.frames=b.Utils.newFloatArray(r<<1)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.rotate<<24)+this.boneIndex};t.prototype.setFrame=function(r,y,z){r<<=1;this.frames[r]=y;this.frames[r+t.ROTATION]=z};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.bones[this.boneIndex];if(z<y[0])F&&(r.rotation=r.data.rotation);else if(z>=y[y.length-t.ENTRIES])F?r.rotation=r.data.rotation+y[y.length+t.PREV_ROTATION]*B:(F=r.data.rotation+y[y.length+t.PREV_ROTATION]-r.rotation,r.rotation+=
(F-360*(16384-(16384.499999999996-F/360|0)))*B);else{I=h.binarySearch(y,z,t.ENTRIES);E=y[I+t.PREV_ROTATION];var L=y[I];z=this.getCurvePercent((I>>1)-1,1-(z-L)/(y[I+t.PREV_TIME]-L));y=y[I+t.ROTATION]-E;y=E+(y-360*(16384-(16384.499999999996-y/360|0)))*z;F?r.rotation=r.data.rotation+(y-360*(16384-(16384.499999999996-y/360|0)))*B:(y=r.data.rotation+y-r.rotation,r.rotation+=(y-360*(16384-(16384.499999999996-y/360|0)))*B)}};t.ENTRIES=2;t.PREV_TIME=-2;t.PREV_ROTATION=-1;t.ROTATION=1;return t}(e);b.RotateTimeline=
p;p=function(l){function t(r){l.call(this,r);this.frames=b.Utils.newFloatArray(r*t.ENTRIES)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.translate<<24)+this.boneIndex};t.prototype.setFrame=function(r,y,z,E){r*=t.ENTRIES;this.frames[r]=y;this.frames[r+t.X]=z;this.frames[r+t.Y]=E};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.bones[this.boneIndex];if(z<y[0])F&&(r.x=r.data.x,r.y=r.data.y);else{if(z>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_X],I=y[y.length+t.PREV_Y];else{var L=
h.binarySearch(y,z,t.ENTRIES);E=y[L+t.PREV_X];I=y[L+t.PREV_Y];var U=y[L];z=this.getCurvePercent(L/t.ENTRIES-1,1-(z-U)/(y[L+t.PREV_TIME]-U));E+=(y[L+t.X]-E)*z;I+=(y[L+t.Y]-I)*z}F?(r.x=r.data.x+E*B,r.y=r.data.y+I*B):(r.x+=(r.data.x+E-r.x)*B,r.y+=(r.data.y+I-r.y)*B)}};t.ENTRIES=3;t.PREV_TIME=-3;t.PREV_X=-2;t.PREV_Y=-1;t.X=1;t.Y=2;return t}(e);b.TranslateTimeline=p;var q=function(l){function t(r){l.call(this,r)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.scale<<24)+this.boneIndex};t.prototype.apply=
function(r,y,z,E,B,F,I){var L=this.frames;r=r.bones[this.boneIndex];if(z<L[0])F&&(r.scaleX=r.data.scaleX,r.scaleY=r.data.scaleY);else{if(z>=L[L.length-t.ENTRIES])y=L[L.length+t.PREV_X]*r.data.scaleX,E=L[L.length+t.PREV_Y]*r.data.scaleY;else{var U=h.binarySearch(L,z,t.ENTRIES);y=L[U+t.PREV_X];E=L[U+t.PREV_Y];var n=L[U];z=this.getCurvePercent(U/t.ENTRIES-1,1-(z-n)/(L[U+t.PREV_TIME]-n));y=(y+(L[U+t.X]-y)*z)*r.data.scaleX;E=(E+(L[U+t.Y]-E)*z)*r.data.scaleY}1==B?(r.scaleX=y,r.scaleY=E):(F?(F=r.data.scaleX,
z=r.data.scaleY):(F=r.scaleX,z=r.scaleY),I?(y=Math.abs(y)*b.MathUtils.signum(F),E=Math.abs(E)*b.MathUtils.signum(z)):(F=Math.abs(F)*b.MathUtils.signum(y),z=Math.abs(z)*b.MathUtils.signum(E)),r.scaleX=F+(y-F)*B,r.scaleY=z+(E-z)*B)}};return t}(p);b.ScaleTimeline=q;p=function(l){function t(r){l.call(this,r)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.shear<<24)+this.boneIndex};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.bones[this.boneIndex];if(z<y[0])F&&(r.shearX=r.data.shearX,
r.shearY=r.data.shearY);else{if(z>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_X],I=y[y.length+t.PREV_Y];else{var L=h.binarySearch(y,z,t.ENTRIES);E=y[L+t.PREV_X];I=y[L+t.PREV_Y];var U=y[L];z=this.getCurvePercent(L/t.ENTRIES-1,1-(z-U)/(y[L+t.PREV_TIME]-U));E+=(y[L+t.X]-E)*z;I+=(y[L+t.Y]-I)*z}F?(r.shearX=r.data.shearX+E*B,r.shearY=r.data.shearY+I*B):(r.shearX+=(r.data.shearX+E-r.shearX)*B,r.shearY+=(r.data.shearY+I-r.shearY)*B)}};return t}(p);b.ShearTimeline=p;p=function(l){function t(r){l.call(this,
r);this.frames=b.Utils.newFloatArray(r*t.ENTRIES)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.color<<24)+this.slotIndex};t.prototype.setFrame=function(r,y,z,E,B,F){r*=t.ENTRIES;this.frames[r]=y;this.frames[r+t.R]=z;this.frames[r+t.G]=E;this.frames[r+t.B]=B;this.frames[r+t.A]=F};t.prototype.apply=function(r,y,z,E,B,F,I){r=r.slots[this.slotIndex];var L=this.frames;if(z<L[0])F&&r.color.setFromColor(r.data.color);else{if(z>=L[L.length-t.ENTRIES]){z=L.length;y=L[z+t.PREV_R];E=L[z+t.PREV_G];
I=L[z+t.PREV_B];var U=L[z+t.PREV_A]}else{var n=h.binarySearch(L,z,t.ENTRIES);y=L[n+t.PREV_R];E=L[n+t.PREV_G];I=L[n+t.PREV_B];U=L[n+t.PREV_A];var w=L[n];z=this.getCurvePercent(n/t.ENTRIES-1,1-(z-w)/(L[n+t.PREV_TIME]-w));y+=(L[n+t.R]-y)*z;E+=(L[n+t.G]-E)*z;I+=(L[n+t.B]-I)*z;U+=(L[n+t.A]-U)*z}1==B?r.color.set(y,E,I,U):(z=r.color,F&&z.setFromColor(r.data.color),z.add((y-z.r)*B,(E-z.g)*B,(I-z.b)*B,(U-z.a)*B))}};t.ENTRIES=5;t.PREV_TIME=-5;t.PREV_R=-4;t.PREV_G=-3;t.PREV_B=-2;t.PREV_A=-1;t.R=1;t.G=2;t.B=
3;t.A=4;return t}(e);b.ColorTimeline=p;p=function(){function l(t){this.frames=b.Utils.newFloatArray(t);this.attachmentNames=Array(t)}l.prototype.getPropertyId=function(){return(k.attachment<<24)+this.slotIndex};l.prototype.getFrameCount=function(){return this.frames.length};l.prototype.setFrame=function(t,r,y){this.frames[t]=r;this.attachmentNames[t]=y};l.prototype.apply=function(t,r,y,z,E,B,F){r=t.slots[this.slotIndex];F&&B?(y=r.data.attachmentName,r.setAttachment(null==y?null:t.getAttachment(this.slotIndex,
y))):(F=this.frames,y<F[0]?B&&(y=r.data.attachmentName,r.setAttachment(null==y?null:t.getAttachment(this.slotIndex,y))):(y=y>=F[F.length-1]?F.length-1:h.binarySearch(F,y,1)-1,y=this.attachmentNames[y],t.slots[this.slotIndex].setAttachment(null==y?null:t.getAttachment(this.slotIndex,y))))};return l}();b.AttachmentTimeline=p;p=function(l){function t(r){l.call(this,r);this.frames=b.Utils.newFloatArray(r);this.frameVertices=Array(r)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.deform<<
24)+this.slotIndex};t.prototype.setFrame=function(r,y,z){this.frames[r]=y;this.frameVertices[r]=z};t.prototype.apply=function(r,y,z,E,B,F,I){r=r.slots[this.slotIndex];var L=r.getAttachment();if(L instanceof b.VertexAttachment&&L.applyDeform(this.attachment)){var U=this.frames;y=r.attachmentVertices;if(z<U[0])F&&b.Utils.setArraySize(y,0);else if(I=this.frameVertices,r=I[0].length,y.length!=r&&(B=1),y=b.Utils.setArraySize(y,r),z>=U[U.length-1])if(z=I[U.length-1],1==B)b.Utils.arrayCopy(z,0,y,0,r);else if(F)if(F=
L,null==F.bones)for(F=F.vertices,L=0;L<r;L++)U=F[L],y[L]=U+(z[L]-U)*B;else for(L=0;L<r;L++)y[L]=z[L]*B;else for(L=0;L<r;L++)y[L]+=(z[L]-y[L])*B;else{var n=h.binarySearch(U,z);E=I[n-1];I=I[n];var w=U[n];z=this.getCurvePercent(n-1,1-(z-w)/(U[n-1]-w));if(1==B)for(L=0;L<r;L++)n=E[L],y[L]=n+(I[L]-n)*z;else if(F)if(F=L,null==F.bones)for(F=F.vertices,L=0;L<r;L++)n=E[L],U=F[L],y[L]=U+(n+(I[L]-n)*z-U)*B;else for(L=0;L<r;L++)n=E[L],y[L]=(n+(I[L]-n)*z)*B;else for(L=0;L<r;L++)n=E[L],y[L]+=(n+(I[L]-n)*z-y[L])*
B}}};return t}(e);b.DeformTimeline=p;p=function(){function l(t){this.frames=b.Utils.newFloatArray(t);this.events=Array(t)}l.prototype.getPropertyId=function(){return k.event<<24};l.prototype.getFrameCount=function(){return this.frames.length};l.prototype.setFrame=function(t,r){this.frames[t]=r.time;this.events[t]=r};l.prototype.apply=function(t,r,y,z,E,B,F){if(null!=z){var I=this.frames,L=this.frames.length;if(r>y)this.apply(t,r,Number.MAX_VALUE,z,E,B,F),r=-1;else if(r>=I[L-1])return;if(!(y<I[0])){if(r<
I[0])t=0;else for(t=h.binarySearch(I,r),r=I[t];0<t&&I[t-1]==r;)t--;for(;t<L&&y>=I[t];t++)z.push(this.events[t])}}};return l}();b.EventTimeline=p;p=function(){function l(t){this.frames=b.Utils.newFloatArray(t);this.drawOrders=Array(t)}l.prototype.getPropertyId=function(){return k.drawOrder<<24};l.prototype.getFrameCount=function(){return this.frames.length};l.prototype.setFrame=function(t,r,y){this.frames[t]=r;this.drawOrders[t]=y};l.prototype.apply=function(t,r,y,z,E,B,F){r=t.drawOrder;z=t.slots;
if(F&&B)b.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else if(F=this.frames,y<F[0])B&&b.Utils.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);else if(t=y>=F[F.length-1]?F.length-1:h.binarySearch(F,y)-1,t=this.drawOrders[t],null==t)b.Utils.arrayCopy(z,0,r,0,z.length);else for(y=0,B=t.length;y<B;y++)r[y]=z[t[y]]};return l}();b.DrawOrderTimeline=p;p=function(l){function t(r){l.call(this,r);this.frames=b.Utils.newFloatArray(r*t.ENTRIES)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.ikConstraint<<
24)+this.ikConstraintIndex};t.prototype.setFrame=function(r,y,z,E){r*=t.ENTRIES;this.frames[r]=y;this.frames[r+t.MIX]=z;this.frames[r+t.BEND_DIRECTION]=E};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.ikConstraints[this.ikConstraintIndex];if(z<y[0])F&&(r.mix=r.data.mix,r.bendDirection=r.data.bendDirection);else if(z>=y[y.length-t.ENTRIES])F?(r.mix=r.data.mix+(y[y.length+t.PREV_MIX]-r.data.mix)*B,r.bendDirection=I?r.data.bendDirection:y[y.length+t.PREV_BEND_DIRECTION]):(r.mix+=(y[y.length+
t.PREV_MIX]-r.mix)*B,I||(r.bendDirection=y[y.length+t.PREV_BEND_DIRECTION]));else{E=h.binarySearch(y,z,t.ENTRIES);var L=y[E+t.PREV_MIX],U=y[E];z=this.getCurvePercent(E/t.ENTRIES-1,1-(z-U)/(y[E+t.PREV_TIME]-U));F?(r.mix=r.data.mix+(L+(y[E+t.MIX]-L)*z-r.data.mix)*B,r.bendDirection=I?r.data.bendDirection:y[E+t.PREV_BEND_DIRECTION]):(r.mix+=(L+(y[E+t.MIX]-L)*z-r.mix)*B,I||(r.bendDirection=y[E+t.PREV_BEND_DIRECTION]))}};t.ENTRIES=3;t.PREV_TIME=-3;t.PREV_MIX=-2;t.PREV_BEND_DIRECTION=-1;t.MIX=1;t.BEND_DIRECTION=
2;return t}(e);b.IkConstraintTimeline=p;p=function(l){function t(r){l.call(this,r);this.frames=b.Utils.newFloatArray(r*t.ENTRIES)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.transformConstraint<<24)+this.transformConstraintIndex};t.prototype.setFrame=function(r,y,z,E,B,F){r*=t.ENTRIES;this.frames[r]=y;this.frames[r+t.ROTATE]=z;this.frames[r+t.TRANSLATE]=E;this.frames[r+t.SCALE]=B;this.frames[r+t.SHEAR]=F};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.transformConstraints[this.transformConstraintIndex];
if(z<y[0])F&&(F=r.data,r.rotateMix=F.rotateMix,r.translateMix=F.rotateMix,r.scaleMix=F.scaleMix,r.shearMix=F.shearMix);else{if(z>=y[y.length-t.ENTRIES]){z=y.length;E=y[z+t.PREV_ROTATE];I=y[z+t.PREV_TRANSLATE];var L=y[z+t.PREV_SCALE];var U=y[z+t.PREV_SHEAR]}else{var n=h.binarySearch(y,z,t.ENTRIES);E=y[n+t.PREV_ROTATE];I=y[n+t.PREV_TRANSLATE];L=y[n+t.PREV_SCALE];U=y[n+t.PREV_SHEAR];var w=y[n];z=this.getCurvePercent(n/t.ENTRIES-1,1-(z-w)/(y[n+t.PREV_TIME]-w));E+=(y[n+t.ROTATE]-E)*z;I+=(y[n+t.TRANSLATE]-
I)*z;L+=(y[n+t.SCALE]-L)*z;U+=(y[n+t.SHEAR]-U)*z}F?(F=r.data,r.rotateMix=F.rotateMix+(E-F.rotateMix)*B,r.translateMix=F.translateMix+(I-F.translateMix)*B,r.scaleMix=F.scaleMix+(L-F.scaleMix)*B,r.shearMix=F.shearMix+(U-F.shearMix)*B):(r.rotateMix+=(E-r.rotateMix)*B,r.translateMix+=(I-r.translateMix)*B,r.scaleMix+=(L-r.scaleMix)*B,r.shearMix+=(U-r.shearMix)*B)}};t.ENTRIES=5;t.PREV_TIME=-5;t.PREV_ROTATE=-4;t.PREV_TRANSLATE=-3;t.PREV_SCALE=-2;t.PREV_SHEAR=-1;t.ROTATE=1;t.TRANSLATE=2;t.SCALE=3;t.SHEAR=
4;return t}(e);b.TransformConstraintTimeline=p;p=function(l){function t(r){l.call(this,r);this.frames=b.Utils.newFloatArray(r*t.ENTRIES)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.pathConstraintPosition<<24)+this.pathConstraintIndex};t.prototype.setFrame=function(r,y,z){r*=t.ENTRIES;this.frames[r]=y;this.frames[r+t.VALUE]=z};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.pathConstraints[this.pathConstraintIndex];if(z<y[0])F&&(r.position=r.data.position);else{if(z>=y[y.length-
t.ENTRIES])E=y[y.length+t.PREV_VALUE];else{I=h.binarySearch(y,z,t.ENTRIES);E=y[I+t.PREV_VALUE];var L=y[I];z=this.getCurvePercent(I/t.ENTRIES-1,1-(z-L)/(y[I+t.PREV_TIME]-L));E+=(y[I+t.VALUE]-E)*z}r.position=F?r.data.position+(E-r.data.position)*B:r.position+(E-r.position)*B}};t.ENTRIES=2;t.PREV_TIME=-2;t.PREV_VALUE=-1;t.VALUE=1;return t}(e);b.PathConstraintPositionTimeline=p;p=function(l){function t(r){l.call(this,r)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.pathConstraintSpacing<<
24)+this.pathConstraintIndex};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.pathConstraints[this.pathConstraintIndex];if(z<y[0])F&&(r.spacing=r.data.spacing);else{if(z>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_VALUE];else{I=h.binarySearch(y,z,t.ENTRIES);E=y[I+t.PREV_VALUE];var L=y[I];z=this.getCurvePercent(I/t.ENTRIES-1,1-(z-L)/(y[I+t.PREV_TIME]-L));E+=(y[I+t.VALUE]-E)*z}r.spacing=F?r.data.spacing+(E-r.data.spacing)*B:r.spacing+(E-r.spacing)*B}};return t}(p);b.PathConstraintSpacingTimeline=
p;e=function(l){function t(r){l.call(this,r);this.frames=b.Utils.newFloatArray(r*t.ENTRIES)}__extends(t,l);t.prototype.getPropertyId=function(){return(k.pathConstraintMix<<24)+this.pathConstraintIndex};t.prototype.setFrame=function(r,y,z,E){r*=t.ENTRIES;this.frames[r]=y;this.frames[r+t.ROTATE]=z;this.frames[r+t.TRANSLATE]=E};t.prototype.apply=function(r,y,z,E,B,F,I){y=this.frames;r=r.pathConstraints[this.pathConstraintIndex];if(z<y[0])F&&(r.rotateMix=r.data.rotateMix,r.translateMix=r.data.translateMix);
else{if(z>=y[y.length-t.ENTRIES])E=y[y.length+t.PREV_ROTATE],I=y[y.length+t.PREV_TRANSLATE];else{var L=h.binarySearch(y,z,t.ENTRIES);E=y[L+t.PREV_ROTATE];I=y[L+t.PREV_TRANSLATE];var U=y[L];z=this.getCurvePercent(L/t.ENTRIES-1,1-(z-U)/(y[L+t.PREV_TIME]-U));E+=(y[L+t.ROTATE]-E)*z;I+=(y[L+t.TRANSLATE]-I)*z}F?(r.rotateMix=r.data.rotateMix+(E-r.data.rotateMix)*B,r.translateMix=r.data.translateMix+(I-r.data.translateMix)*B):(r.rotateMix+=(E-r.rotateMix)*B,r.translateMix+=(I-r.translateMix)*B)}};t.ENTRIES=
3;t.PREV_TIME=-3;t.PREV_ROTATE=-2;t.PREV_TRANSLATE=-1;t.ROTATE=1;t.TRANSLATE=2;return t}(e);b.PathConstraintMixTimeline=e})(spine||(spine={}));
(function(b){var h=function(){function q(l){this.tracks=[];this.events=[];this.listeners=[];this.queue=new e(this);this.propertyIDs=new b.IntSet;this.animationsChanged=!1;this.timeScale=1;this.trackEntryPool=new b.Pool(function(){return new k});this.data=l}q.prototype.update=function(l){l*=this.timeScale;for(var t=this.tracks,r=0,y=t.length;r<y;r++){var z=t[r];if(null!=z){z.animationLast=z.nextAnimationLast;z.trackLast=z.nextTrackLast;var E=l*z.timeScale;if(0<z.delay){z.delay-=E;if(0<z.delay)continue;
E=-z.delay;z.delay=0}var B=z.next;if(null!=B){var F=z.trackLast-B.delay;if(0<=F){B.delay=0;B.trackTime=F+l*B.timeScale;z.trackTime+=E;for(this.setCurrent(r,B);null!=B.mixingFrom;)B.mixTime+=E,B=B.mixingFrom;continue}}else if(z.trackLast>=z.trackEnd&&null==z.mixingFrom){t[r]=null;this.queue.end(z);this.disposeNext(z);continue}this.updateMixingFrom(z,l);z.trackTime+=E}}this.queue.drain()};q.prototype.updateMixingFrom=function(l,t){var r=l.mixingFrom;null!=r&&(this.updateMixingFrom(r,t),l.mixTime>=l.mixDuration&&
null!=r.mixingFrom&&0<l.mixTime?(l.mixingFrom=null,this.queue.end(r)):(r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast,r.trackTime+=t*r.timeScale,l.mixTime+=t*r.timeScale))};q.prototype.apply=function(l){if(null==l)throw Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var t=this.events,r=this.tracks,y=0,z=r.length;y<z;y++){var E=r[y];if(!(null==E||0<E.delay)){var B=E.alpha;null!=E.mixingFrom?B*=this.applyMixingFrom(E,l):E.trackTime>=E.trackEnd&&
(B=0);var F=E.animationLast,I=E.getAnimationTime(),L=E.animation.timelines.length,U=E.animation.timelines;if(1==B)for(var n=0;n<L;n++)U[n].apply(l,F,I,t,1,!0,!1);else{var w=0==E.timelinesRotation.length;w&&b.Utils.setArraySize(E.timelinesRotation,L<<1,null);var G=E.timelinesRotation,f=E.timelinesFirst;for(n=0;n<L;n++){var m=U[n];m instanceof b.RotateTimeline?this.applyRotateTimeline(m,l,I,B,f[n],G,n<<1,w):m.apply(l,F,I,t,B,f[n],!1)}}this.queueEvents(E,I);E.nextAnimationLast=I;E.nextTrackLast=E.trackTime}}this.queue.drain()};
q.prototype.applyMixingFrom=function(l,t){var r=l.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,t);var y;0==l.mixDuration?y=1:(y=l.mixTime/l.mixDuration,1<y&&(y=1));var z=y<r.eventThreshold?this.events:null,E=y<r.attachmentThreshold,B=y<r.drawOrderThreshold,F=r.animationLast,I=r.getAnimationTime(),L=r.animation.timelines.length,U=r.animation.timelines,n=r.timelinesFirst;l=r.alpha*l.mixAlpha*(1-y);var w=0==r.timelinesRotation.length;w&&b.Utils.setArraySize(r.timelinesRotation,L<<1,null);for(var G=
r.timelinesRotation,f=0;f<L;f++){var m=U[f],v=n[f];if(m instanceof b.RotateTimeline)this.applyRotateTimeline(m,t,I,l,v,G,f<<1,w);else{if(!v){if(!E&&m instanceof b.AttachmentTimeline)continue;if(!B&&m instanceof b.DrawOrderTimeline)continue}m.apply(t,F,I,z,l,v,!0)}}this.queueEvents(r,I);r.nextAnimationLast=I;r.nextTrackLast=r.trackTime;return y};q.prototype.applyRotateTimeline=function(l,t,r,y,z,E,B,F){if(1==y)l.apply(t,0,r,null,1,z,!1);else{var I=l.frames;t=t.bones[l.boneIndex];if(r<I[0])z&&(t.rotation=
t.data.rotation);else{if(r>=I[I.length-b.RotateTimeline.ENTRIES])I=t.data.rotation+I[I.length+b.RotateTimeline.PREV_ROTATION];else{var L=b.Animation.binarySearch(I,r,b.RotateTimeline.ENTRIES),U=I[L+b.RotateTimeline.PREV_ROTATION],n=I[L];l=l.getCurvePercent((L>>1)-1,1-(r-n)/(I[L+b.RotateTimeline.PREV_TIME]-n));I=I[L+b.RotateTimeline.ROTATION]-U;I=U+(I-360*(16384-(16384.499999999996-I/360|0)))*l+t.data.rotation;I-=360*(16384-(16384.499999999996-I/360|0))}z=z?t.data.rotation:t.rotation;I-=z;0==I?r=F?
E[B]=0:E[B]:(I-=360*(16384-(16384.499999999996-I/360|0)),F?(F=0,r=I):(F=E[B],r=E[B+1]),U=0<I,l=0<=F,b.MathUtils.signum(r)!=b.MathUtils.signum(I)&&90>=Math.abs(r)&&(180<Math.abs(F)&&(F+=360*b.MathUtils.signum(F)),l=U),r=I+F-F%360,l!=U&&(r+=360*b.MathUtils.signum(F)),E[B]=r);E[B+1]=I;z+=r*y;t.rotation=z-360*(16384-(16384.499999999996-z/360|0))}}};q.prototype.queueEvents=function(l,t){for(var r=l.animationStart,y=l.animationEnd,z=y-r,E=l.trackLast%z,B=this.events,F=0,I=B.length;F<I;F++){var L=B[F];if(L.time<
E)break;L.time>y||this.queue.event(l,L)}for((l.loop?E>l.trackTime%z:t>=y&&l.animationLast<y)&&this.queue.complete(l);F<I;F++)B[F].time<r||this.queue.event(l,B[F]);this.events.length=0};q.prototype.clearTracks=function(){this.queue.drainDisabled=!0;for(var l=0,t=this.tracks.length;l<t;l++)this.clearTrack(l);this.tracks.length=0;this.queue.drainDisabled=!1;this.queue.drain()};q.prototype.clearTrack=function(l){if(!(l>=this.tracks.length)&&(l=this.tracks[l],null!=l)){this.queue.end(l);this.disposeNext(l);
for(var t=l;;){var r=t.mixingFrom;if(null==r)break;this.queue.end(r);t.mixingFrom=null;t=r}this.tracks[l.trackIndex]=null;this.queue.drain()}};q.prototype.setCurrent=function(l,t){var r=this.expandToIndex(l);this.tracks[l]=t;null!=r&&(this.queue.interrupt(r),t.mixingFrom=r,t.mixTime=0,null!=r.mixingFrom&&(t.mixAlpha*=Math.min(r.mixTime/r.mixDuration,1)));this.queue.start(t)};q.prototype.setAnimation=function(l,t,r){var y=this.data.skeletonData.findAnimation(t);if(null==y)throw Error("Animation not found: "+
t);return this.setAnimationWith(l,y,r)};q.prototype.setAnimationWith=function(l,t,r){if(null==t)throw Error("animation cannot be null.");var y=this.expandToIndex(l);null!=y&&(-1==y.nextTrackLast?(this.tracks[l]=y.mixingFrom,this.queue.interrupt(y),this.queue.end(y),this.disposeNext(y),y=y.mixingFrom):this.disposeNext(y));t=this.trackEntry(l,t,r,y);this.setCurrent(l,t);this.queue.drain();return t};q.prototype.addAnimation=function(l,t,r,y){var z=this.data.skeletonData.findAnimation(t);if(null==z)throw Error("Animation not found: "+
t);return this.addAnimationWith(l,z,r,y)};q.prototype.addAnimationWith=function(l,t,r,y){if(null==t)throw Error("animation cannot be null.");var z=this.expandToIndex(l);if(null!=z)for(;null!=z.next;)z=z.next;r=this.trackEntry(l,t,r,z);null==z?(this.setCurrent(l,r),this.queue.drain()):(z.next=r,0>=y&&(l=z.animationEnd-z.animationStart,y=0!=l?y+(l*(1+(z.trackTime/l|0))-this.data.getMix(z.animation,t)):0));r.delay=y;return r};q.prototype.setEmptyAnimation=function(l,t){l=this.setAnimationWith(l,q.emptyAnimation,
!1);l.mixDuration=t;l.trackEnd=t;return l};q.prototype.addEmptyAnimation=function(l,t,r){0>=r&&(r-=t);l=this.addAnimationWith(l,q.emptyAnimation,!1,r);l.mixDuration=t;l.trackEnd=t;return l};q.prototype.setEmptyAnimations=function(l){this.queue.drainDisabled=!0;for(var t=0,r=this.tracks.length;t<r;t++){var y=this.tracks[t];null!=y&&this.setEmptyAnimation(y.trackIndex,l)}this.queue.drainDisabled=!1;this.queue.drain()};q.prototype.expandToIndex=function(l){if(l<this.tracks.length)return this.tracks[l];
b.Utils.ensureArrayCapacity(this.tracks,l-this.tracks.length+1,null);this.tracks.length=l+1;return null};q.prototype.trackEntry=function(l,t,r,y){var z=this.trackEntryPool.obtain();z.trackIndex=l;z.animation=t;z.loop=r;z.eventThreshold=0;z.attachmentThreshold=0;z.drawOrderThreshold=0;z.animationStart=0;z.animationEnd=t.duration;z.animationLast=-1;z.nextAnimationLast=-1;z.delay=0;z.trackTime=0;z.trackLast=-1;z.nextTrackLast=-1;z.trackEnd=r?Number.MAX_VALUE:z.animationEnd;z.timeScale=1;z.alpha=1;z.mixAlpha=
1;z.mixTime=0;z.mixDuration=null==y?0:this.data.getMix(y.animation,t);return z};q.prototype.disposeNext=function(l){for(var t=l.next;null!=t;)this.queue.dispose(t),t=t.next;l.next=null};q.prototype._animationsChanged=function(){this.animationsChanged=!1;var l=0,t=this.tracks.length;for(this.propertyIDs.clear();l<t;l++){var r=this.tracks[l];if(null!=r){this.setTimelinesFirst(r);l++;break}}for(;l<t;l++)r=this.tracks[l],null!=r&&this.checkTimelinesFirst(r)};q.prototype.setTimelinesFirst=function(l){if(null!=
l.mixingFrom)this.setTimelinesFirst(l.mixingFrom),this.checkTimelinesUsage(l,l.timelinesFirst);else{var t=this.propertyIDs,r=l.animation.timelines,y=r.length;l=b.Utils.setArraySize(l.timelinesFirst,y,!1);for(var z=0;z<y;z++)t.add(r[z].getPropertyId()),l[z]=!0}};q.prototype.checkTimelinesFirst=function(l){null!=l.mixingFrom&&this.checkTimelinesFirst(l.mixingFrom);this.checkTimelinesUsage(l,l.timelinesFirst)};q.prototype.checkTimelinesUsage=function(l,t){var r=this.propertyIDs;l=l.animation.timelines;
var y=l.length;t=b.Utils.setArraySize(t,y);for(var z=0;z<y;z++)t[z]=r.add(l[z].getPropertyId())};q.prototype.getCurrent=function(l){return l>=this.tracks.length?null:this.tracks[l]};q.prototype.addListener=function(l){if(null==l)throw Error("listener cannot be null.");this.listeners.push(l)};q.prototype.removeListener=function(l){l=this.listeners.indexOf(l);0<=l&&this.listeners.splice(l,1)};q.prototype.clearListeners=function(){this.listeners.length=0};q.prototype.clearListenerNotifications=function(){this.queue.clear()};
q.emptyAnimation=new b.Animation("<empty>",[],0);return q}();b.AnimationState=h;var k=function(){function q(){this.timelinesFirst=[];this.timelinesRotation=[]}q.prototype.reset=function(){this.listener=this.animation=this.mixingFrom=this.next=null;this.timelinesFirst.length=0;this.timelinesRotation.length=0};q.prototype.getAnimationTime=function(){if(this.loop){var l=this.animationEnd-this.animationStart;return 0==l?this.animationStart:this.trackTime%l+this.animationStart}return Math.min(this.trackTime+
this.animationStart,this.animationEnd)};q.prototype.setAnimationLast=function(l){this.nextAnimationLast=this.animationLast=l};q.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart};q.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0};return q}();b.TrackEntry=k;var e=function(){function q(l){this.objects=[];this.drainDisabled=!1;this.animState=l}q.prototype.start=function(l){this.objects.push(p.start);this.objects.push(l);this.animState.animationsChanged=
!0};q.prototype.interrupt=function(l){this.objects.push(p.interrupt);this.objects.push(l)};q.prototype.end=function(l){this.objects.push(p.end);this.objects.push(l);this.animState.animationsChanged=!0};q.prototype.dispose=function(l){this.objects.push(p.dispose);this.objects.push(l)};q.prototype.complete=function(l){this.objects.push(p.complete);this.objects.push(l)};q.prototype.event=function(l,t){this.objects.push(p.event);this.objects.push(l);this.objects.push(t)};q.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=
!0;for(var l=this.objects,t=this.animState.listeners,r=0;r<l.length;r+=2){var y=l[r+1];switch(l[r]){case p.start:null!=y.listener&&y.listener.start&&y.listener.start(y);for(var z=0;z<t.length;z++)t[z].start&&t[z].start(y);break;case p.interrupt:null!=y.listener&&y.listener.interrupt&&y.listener.interrupt(y);for(z=0;z<t.length;z++)t[z].interrupt&&t[z].interrupt(y);break;case p.end:for(null!=y.listener&&y.listener.end&&y.listener.end(y),z=0;z<t.length;z++)t[z].end&&t[z].end(y);case p.dispose:null!=
y.listener&&y.listener.dispose&&y.listener.dispose(y);for(z=0;z<t.length;z++)t[z].dispose&&t[z].dispose(y);this.animState.trackEntryPool.free(y);break;case p.complete:null!=y.listener&&y.listener.complete&&y.listener.complete(y);for(z=0;z<t.length;z++)t[z].complete&&t[z].complete(y);break;case p.event:var E=l[r++ +2];null!=y.listener&&y.listener.event&&y.listener.event(y,E);for(z=0;z<t.length;z++)t[z].event&&t[z].event(y,E)}}this.clear();this.drainDisabled=!1}};q.prototype.clear=function(){this.objects.length=
0};return q}();b.EventQueue=e;(function(q){q[q.start=0]="start";q[q.interrupt=1]="interrupt";q[q.end=2]="end";q[q.dispose=3]="dispose";q[q.complete=4]="complete";q[q.event=5]="event"})(b.EventType||(b.EventType={}));var p=b.EventType;h=function(){function q(){}q.prototype.start=function(l){};q.prototype.interrupt=function(l){};q.prototype.end=function(l){};q.prototype.dispose=function(l){};q.prototype.complete=function(l){};q.prototype.event=function(l,t){};return q}();b.AnimationStateAdapter2=h})(spine||
(spine={}));
(function(b){var h=function(){function k(e){this.animationToMixTime={};this.defaultMix=0;if(null==e)throw Error("skeletonData cannot be null.");this.skeletonData=e}k.prototype.setMix=function(e,p,q){var l=this.skeletonData.findAnimation(e);if(null==l)throw Error("Animation not found: "+e);e=this.skeletonData.findAnimation(p);if(null==e)throw Error("Animation not found: "+p);this.setMixWith(l,e,q)};k.prototype.setMixWith=function(e,p,q){if(null==e)throw Error("from cannot be null.");if(null==p)throw Error("to cannot be null.");
this.animationToMixTime[e.name+p.name]=q};k.prototype.getMix=function(e,p){e=this.animationToMixTime[e.name+p.name];return void 0===e?this.defaultMix:e};return k}();b.AnimationStateData=h})(spine||(spine={}));
(function(b){var h=function(){function k(e,p){void 0===p&&(p="");this.assets={};this.errors={};this.loaded=this.toLoad=0;this.textureLoader=e;this.pathPrefix=p}k.prototype.loadText=function(e,p,q){var l=this;void 0===p&&(p=null);void 0===q&&(q=null);e=this.pathPrefix+e;this.toLoad++;var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(200<=t.status&&300>t.status?(l.assets[e]=t.responseText,p&&p(e,t.responseText)):(l.errors[e]="Couldn't load text "+e+": status "+
t.status+", "+t.responseText,q&&q(e,"Couldn't load text "+e+": status "+t.status+", "+t.responseText)),l.toLoad--,l.loaded++)};t.open("GET",e,!0);t.send()};k.prototype.loadTexture=function(e,p,q){var l=this;void 0===p&&(p=null);void 0===q&&(q=null);e=this.pathPrefix+e;this.toLoad++;var t=new Image;t.crossOrigin="anonymous";t.src=e;t.onload=function(r){r=l.textureLoader(t);l.assets[e]=r;l.toLoad--;l.loaded++;p&&p(e,t)};t.onerror=function(r){l.errors[e]="Couldn't load image "+e;l.toLoad--;l.loaded++;
q&&q(e,"Couldn't load image "+e)}};k.prototype.get=function(e){e=this.pathPrefix+e;return this.assets[e]};k.prototype.remove=function(e){e=this.pathPrefix+e;var p=this.assets[e];p.dispose&&p.dispose();this.assets[e]=null};k.prototype.removeAll=function(){for(var e in this.assets){var p=this.assets[e];p.dispose&&p.dispose()}this.assets={}};k.prototype.isLoadingComplete=function(){return 0==this.toLoad};k.prototype.getToLoad=function(){return this.toLoad};k.prototype.getLoaded=function(){return this.loaded};
k.prototype.dispose=function(){this.removeAll()};k.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length};k.prototype.getErrors=function(){return this.errors};return k}();b.AssetManager=h})(spine||(spine={}));
(function(b){var h=function(){function k(e){this.atlas=e}k.prototype.newRegionAttachment=function(e,p,q){e=this.atlas.findRegion(q);if(null==e)throw Error("Region not found in atlas: "+q+" (region attachment: "+p+")");e.renderObject=e;p=new b.RegionAttachment(p);p.setRegion(e);return p};k.prototype.newMeshAttachment=function(e,p,q){e=this.atlas.findRegion(q);if(null==e)throw Error("Region not found in atlas: "+q+" (mesh attachment: "+p+")");e.renderObject=e;p=new b.MeshAttachment(p);p.region=e;return p};
k.prototype.newBoundingBoxAttachment=function(e,p){return new b.BoundingBoxAttachment(p)};k.prototype.newPathAttachment=function(e,p){return new b.PathAttachment(p)};return k}();b.AtlasAttachmentLoader=h})(spine||(spine={}));
(function(b){var h=function(){return function(k){if(null==k)throw Error("name cannot be null.");this.name=k}}();b.Attachment=h;h=function(k){function e(p){k.call(this,p);this.worldVerticesLength=0}__extends(e,k);e.prototype.computeWorldVertices=function(p,q){this.computeWorldVerticesWith(p,0,this.worldVerticesLength,q,0)};e.prototype.computeWorldVerticesWith=function(p,q,l,t,r){l+=r;var y=p.bone.skeleton,z=p.attachmentVertices,E=this.vertices,B=this.bones;if(null==B){0<z.length&&(E=z);p=p.bone;z=
p.worldX;B=p.worldY;var F=p.a;y=p.b;var I=p.c;p=p.d;for(var L=q;r<l;L+=2,r+=2){q=E[L];var U=E[L+1];t[r]=q*F+U*y+z;t[r+1]=q*I+U*p+B}}else{for(U=p=F=0;U<q;U+=2)I=B[F],F+=I+1,p+=I;L=y.bones;if(0==z.length)for(y=3*p;r<l;r+=2){var n=0,w=0;I=B[F++];for(I+=F;F<I;F++,y+=3){p=L[B[F]];q=E[y];U=E[y+1];var G=E[y+2];n+=(q*p.a+U*p.b+p.worldX)*G;w+=(q*p.c+U*p.d+p.worldY)*G}t[r]=n;t[r+1]=w}else{y=3*p;for(var f=p<<1;r<l;r+=2){w=n=0;I=B[F++];for(I+=F;F<I;F++,y+=3,f+=2)p=L[B[F]],q=E[y]+z[f],U=E[y+1]+z[f+1],G=E[y+2],
n+=(q*p.a+U*p.b+p.worldX)*G,w+=(q*p.c+U*p.d+p.worldY)*G;t[r]=n;t[r+1]=w}}}};e.prototype.applyDeform=function(p){return this==p};return e}(h);b.VertexAttachment=h})(spine||(spine={}));(function(b){b=b.AttachmentType||(b.AttachmentType={});b[b.Region=0]="Region";b[b.BoundingBox=1]="BoundingBox";b[b.Mesh=2]="Mesh";b[b.LinkedMesh=3]="LinkedMesh";b[b.Path=4]="Path"})(spine||(spine={}));
(function(b){var h=function(k){function e(p){k.call(this,p);this.color=new b.Color(1,1,1,1)}__extends(e,k);return e}(b.VertexAttachment);b.BoundingBoxAttachment=h})(spine||(spine={}));
(function(b){var h=function(k){function e(p){k.call(this,p);this.color=new b.Color(1,1,1,1);this.inheritDeform=!1;this.tempColor=new b.Color(0,0,0,0)}__extends(e,k);e.prototype.updateUVs=function(){var p=this.regionUVs,q=p.length,l=8*(q>>1);if(null==this.worldVertices||this.worldVertices.length!=l)this.worldVertices=b.Utils.newFloatArray(l);var t,r,y;null==this.region?(l=t=0,r=y=1):(l=this.region.u,t=this.region.v,r=this.region.u2-l,y=this.region.v2-t);if(this.region.rotate)for(var z=0,E=6;z<q;z+=
2,E+=8)this.worldVertices[E]=l+p[z+1]*r,this.worldVertices[E+1]=t+y-p[z]*y;else for(z=0,E=6;z<q;z+=2,E+=8)this.worldVertices[E]=l+p[z]*r,this.worldVertices[E+1]=t+p[z+1]*y};e.prototype.updateWorldVertices=function(p,q){var l=p.bone.skeleton,t=l.color,r=p.color,y=this.color,z=t.a*r.a*y.a;q=q?z:1;var E=this.tempColor;E.set(t.r*r.r*y.r*q,t.g*r.g*y.g*q,t.b*r.b*y.b*q,z);var B=p.attachmentVertices;t=this.vertices;r=this.worldVertices;var F=this.bones;if(null==F){F=t.length;0<B.length&&(t=B);p=p.bone;B=
p.worldX;var I=p.worldY,L=p.a;l=p.b;var U=p.c;p=p.d;for(z=y=0;y<F;y+=2,z+=8){q=t[y];var n=t[y+1];r[z]=q*L+n*l+B;r[z+1]=q*U+n*p+I;r[z+2]=E.r;r[z+3]=E.g;r[z+4]=E.b;r[z+5]=E.a}return r}I=l.bones;if(0==B.length)for(l=y=z=0,L=F.length;y<L;z+=8){for(var w=U=0,G=F[y++]+y;y<G;y++,l+=3){p=I[F[y]];q=t[l];n=t[l+1];var f=t[l+2];U+=(q*p.a+n*p.b+p.worldX)*f;w+=(q*p.c+n*p.d+p.worldY)*f}r[z]=U;r[z+1]=w;r[z+2]=E.r;r[z+3]=E.g;r[z+4]=E.b;r[z+5]=E.a}else{var m=l=y=z=0;for(L=F.length;y<L;z+=8){w=U=0;for(G=F[y++]+y;y<
G;y++,l+=3,m+=2)p=I[F[y]],q=t[l]+B[m],n=t[l+1]+B[m+1],f=t[l+2],U+=(q*p.a+n*p.b+p.worldX)*f,w+=(q*p.c+n*p.d+p.worldY)*f;r[z]=U;r[z+1]=w;r[z+2]=E.r;r[z+3]=E.g;r[z+4]=E.b;r[z+5]=E.a}}return r};e.prototype.applyDeform=function(p){return this==p||this.inheritDeform&&this.parentMesh==p};e.prototype.getParentMesh=function(){return this.parentMesh};e.prototype.setParentMesh=function(p){this.parentMesh=p;null!=p&&(this.bones=p.bones,this.vertices=p.vertices,this.regionUVs=p.regionUVs,this.triangles=p.triangles,
this.hullLength=p.hullLength)};return e}(b.VertexAttachment);b.MeshAttachment=h})(spine||(spine={}));(function(b){var h=function(k){function e(p){k.call(this,p);this.constantSpeed=this.closed=!1;this.color=new b.Color(1,1,1,1)}__extends(e,k);return e}(b.VertexAttachment);b.PathAttachment=h})(spine||(spine={}));
(function(b){var h=function(k){function e(p){k.call(this,p);this.y=this.x=0;this.scaleY=this.scaleX=1;this.height=this.width=this.rotation=0;this.color=new b.Color(1,1,1,1);this.offset=b.Utils.newFloatArray(8);this.vertices=b.Utils.newFloatArray(32);this.tempColor=new b.Color(1,1,1,1)}__extends(e,k);e.prototype.setRegion=function(p){var q=this.vertices;p.rotate?(q[e.U2]=p.u,q[e.V2]=p.v2,q[e.U3]=p.u,q[e.V3]=p.v,q[e.U4]=p.u2,q[e.V4]=p.v,q[e.U1]=p.u2,q[e.V1]=p.v2):(q[e.U1]=p.u,q[e.V1]=p.v2,q[e.U2]=p.u,
q[e.V2]=p.v,q[e.U3]=p.u2,q[e.V3]=p.v,q[e.U4]=p.u2,q[e.V4]=p.v2);this.region=p};e.prototype.updateOffset=function(){var p=this.width/this.region.originalWidth*this.scaleX,q=this.height/this.region.originalHeight*this.scaleY,l=-this.width/2*this.scaleX+this.region.offsetX*p,t=-this.height/2*this.scaleY+this.region.offsetY*q,r=l+this.region.width*p;p=t+this.region.height*q;q=this.rotation*Math.PI/180;var y=Math.cos(q),z=Math.sin(q);q=l*y+this.x;l*=z;var E=t*y+this.y;t*=z;var B=r*y+this.x;r*=z;y=p*y+
this.y;p*=z;z=this.offset;z[e.OX1]=q-t;z[e.OY1]=E+l;z[e.OX2]=q-p;z[e.OY2]=y+l;z[e.OX3]=B-p;z[e.OY3]=y+r;z[e.OX4]=B-t;z[e.OY4]=E+r};e.prototype.updateWorldVertices=function(p,q){var l=p.bone.skeleton.color,t=p.color,r=this.color,y=l.a*t.a*r.a;q=q?y:1;var z=this.tempColor;z.set(l.r*t.r*r.r*q,l.g*t.g*r.g*q,l.b*t.b*r.b*q,y);l=this.vertices;t=this.offset;p=p.bone;r=p.worldX;y=p.worldY;q=p.a;var E=p.b,B=p.c;p=p.d;var F=t[e.OX1];var I=t[e.OY1];l[e.X1]=F*q+I*E+r;l[e.Y1]=F*B+I*p+y;l[e.C1R]=z.r;l[e.C1G]=z.g;
l[e.C1B]=z.b;l[e.C1A]=z.a;F=t[e.OX2];I=t[e.OY2];l[e.X2]=F*q+I*E+r;l[e.Y2]=F*B+I*p+y;l[e.C2R]=z.r;l[e.C2G]=z.g;l[e.C2B]=z.b;l[e.C2A]=z.a;F=t[e.OX3];I=t[e.OY3];l[e.X3]=F*q+I*E+r;l[e.Y3]=F*B+I*p+y;l[e.C3R]=z.r;l[e.C3G]=z.g;l[e.C3B]=z.b;l[e.C3A]=z.a;F=t[e.OX4];I=t[e.OY4];l[e.X4]=F*q+I*E+r;l[e.Y4]=F*B+I*p+y;l[e.C4R]=z.r;l[e.C4G]=z.g;l[e.C4B]=z.b;l[e.C4A]=z.a;return l};e.OX1=0;e.OY1=1;e.OX2=2;e.OY2=3;e.OX3=4;e.OY3=5;e.OX4=6;e.OY4=7;e.X1=0;e.Y1=1;e.C1R=2;e.C1G=3;e.C1B=4;e.C1A=5;e.U1=6;e.V1=7;e.X2=8;e.Y2=
9;e.C2R=10;e.C2G=11;e.C2B=12;e.C2A=13;e.U2=14;e.V2=15;e.X3=16;e.Y3=17;e.C3R=18;e.C3G=19;e.C3B=20;e.C3A=21;e.U3=22;e.V3=23;e.X4=24;e.Y4=25;e.C4R=26;e.C4G=27;e.C4B=28;e.C4A=29;e.U4=30;e.V4=31;return e}(b.Attachment);b.RegionAttachment=h})(spine||(spine={}));(function(b){b=b.BlendMode||(b.BlendMode={});b[b.Normal=0]="Normal";b[b.Additive=1]="Additive";b[b.Multiply=2]="Multiply";b[b.Screen=3]="Screen"})(spine||(spine={}));
(function(b){var h=function(){function k(e,p,q){this.children=[];this.ashearY=this.ashearX=this.ascaleY=this.ascaleX=this.arotation=this.ay=this.ax=this.shearY=this.shearX=this.scaleY=this.scaleX=this.rotation=this.y=this.x=0;this.appliedValid=!1;this.worldY=this.d=this.c=this.worldX=this.b=this.a=0;this.sorted=!1;if(null==e)throw Error("data cannot be null.");if(null==p)throw Error("skeleton cannot be null.");this.data=e;this.skeleton=p;this.parent=q;this.setToSetupPose()}k.prototype.update=function(){this.updateWorldTransformWith(this.x,
this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};k.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)};k.prototype.updateWorldTransformWith=function(e,p,q,l,t,r,y){this.ax=e;this.ay=p;this.arotation=q;this.ascaleX=l;this.ascaleY=t;this.ashearX=r;this.ashearY=y;this.appliedValid=!0;var z=this.parent;if(null==z){y=q+90+y;z=b.MathUtils.cosDeg(q+r)*l;var E=b.MathUtils.cosDeg(y)*t;l*=
b.MathUtils.sinDeg(q+r);t*=b.MathUtils.sinDeg(y);var B=this.skeleton;B.flipX&&(e=-e,z=-z,E=-E);B.flipY&&(p=-p,l=-l,t=-t);this.a=z;this.b=E;this.c=l;this.d=t;this.worldX=e+B.x;this.worldY=p+B.y}else{B=z.a;var F=z.b,I=z.c,L=z.d;this.worldX=B*e+F*p+z.worldX;this.worldY=I*e+L*p+z.worldY;switch(this.data.transformMode){case b.TransformMode.Normal:y=q+90+y;z=b.MathUtils.cosDeg(q+r)*l;E=b.MathUtils.cosDeg(y)*t;l*=b.MathUtils.sinDeg(q+r);t*=b.MathUtils.sinDeg(y);this.a=B*z+F*l;this.b=B*E+F*t;this.c=I*z+L*
l;this.d=I*E+L*t;return;case b.TransformMode.OnlyTranslation:y=q+90+y;this.a=b.MathUtils.cosDeg(q+r)*l;this.b=b.MathUtils.cosDeg(y)*t;this.c=b.MathUtils.sinDeg(q+r)*l;this.d=b.MathUtils.sinDeg(y)*t;break;case b.TransformMode.NoRotationOrReflection:z=B*B+I*I;1E-4<z?(z=Math.abs(B*L-F*I)/z,F=I*z,L=B*z,z=Math.atan2(I,B)*b.MathUtils.radDeg):(I=B=0,z=90-Math.atan2(L,F)*b.MathUtils.radDeg);r=q+r-z;y=q+y-z+90;z=b.MathUtils.cosDeg(r)*l;E=b.MathUtils.cosDeg(y)*t;l*=b.MathUtils.sinDeg(r);t*=b.MathUtils.sinDeg(y);
this.a=B*z-F*l;this.b=B*E-F*t;this.c=I*z+L*l;this.d=I*E+L*t;break;case b.TransformMode.NoScale:case b.TransformMode.NoScaleOrReflection:z=b.MathUtils.cosDeg(q);E=b.MathUtils.sinDeg(q);q=B*z+F*E;e=I*z+L*E;z=Math.sqrt(q*q+e*e);1E-5<z&&(z=1/z);q*=z;e*=z;z=Math.sqrt(q*q+e*e);E=Math.PI/2+Math.atan2(e,q);p=Math.cos(E)*z;var U=Math.sin(E)*z;z=b.MathUtils.cosDeg(r)*l;E=b.MathUtils.cosDeg(90+y)*t;l*=b.MathUtils.sinDeg(r);t*=b.MathUtils.sinDeg(90+y);this.a=q*z+p*l;this.b=q*E+p*t;this.c=e*z+U*l;this.d=e*E+U*
t;if(this.data.transformMode!=b.TransformMode.NoScaleOrReflection?0>B*L-F*I:this.skeleton.flipX!=this.skeleton.flipY)this.b=-this.b,this.d=-this.d;return}this.skeleton.flipX&&(this.a=-this.a,this.b=-this.b);this.skeleton.flipY&&(this.c=-this.c,this.d=-this.d)}};k.prototype.setToSetupPose=function(){var e=this.data;this.x=e.x;this.y=e.y;this.rotation=e.rotation;this.scaleX=e.scaleX;this.scaleY=e.scaleY;this.shearX=e.shearX;this.shearY=e.shearY};k.prototype.getWorldRotationX=function(){return Math.atan2(this.c,
this.a)*b.MathUtils.radDeg};k.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*b.MathUtils.radDeg};k.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)};k.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)};k.prototype.worldToLocalRotationX=function(){var e=this.parent;if(null==e)return this.arotation;var p=this.a,q=this.c;return Math.atan2(e.a*q-e.c*p,e.d*p-e.b*q)*b.MathUtils.radDeg};k.prototype.worldToLocalRotationY=
function(){var e=this.parent;if(null==e)return this.arotation;var p=this.b,q=this.d;return Math.atan2(e.a*q-e.c*p,e.d*p-e.b*q)*b.MathUtils.radDeg};k.prototype.rotateWorld=function(e){var p=this.a,q=this.b,l=this.c,t=this.d,r=b.MathUtils.cosDeg(e);e=b.MathUtils.sinDeg(e);this.a=r*p-e*l;this.b=r*q-e*t;this.c=e*p+r*l;this.d=e*q+r*t;this.appliedValid=!1};k.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)this.ax=this.worldX,this.ay=this.worldY,this.arotation=
Math.atan2(this.c,this.a)*b.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*b.MathUtils.radDeg;else{var p=e.a,q=e.b,l=e.c,t=e.d,r=1/(p*t-q*l),y=this.worldX-e.worldX;e=this.worldY-e.worldY;this.ax=y*t*r-e*q*r;this.ay=e*p*r-y*l*r;t*=r;p*=r;q*=r;r*=l;l=t*this.a-q*this.c;q=t*this.b-q*this.d;t=p*this.c-r*this.a;r=p*this.d-r*this.b;this.ashearX=
0;this.ascaleX=Math.sqrt(l*l+t*t);1E-4<this.ascaleX?(p=l*r-q*t,this.ascaleY=p/this.ascaleX,this.ashearY=Math.atan2(l*q+t*r,p)*b.MathUtils.radDeg,this.arotation=Math.atan2(t,l)*b.MathUtils.radDeg):(this.ascaleX=0,this.ascaleY=Math.sqrt(q*q+r*r),this.ashearY=0,this.arotation=90-Math.atan2(r,q)*b.MathUtils.radDeg)}};k.prototype.worldToLocal=function(e){var p=this.a,q=this.b,l=this.c,t=this.d,r=1/(p*t-q*l),y=e.x-this.worldX,z=e.y-this.worldY;e.x=y*t*r-z*q*r;e.y=z*p*r-y*l*r;return e};k.prototype.localToWorld=
function(e){var p=e.x,q=e.y;e.x=p*this.a+q*this.b+this.worldX;e.y=p*this.c+q*this.d+this.worldY;return e};return k}();b.Bone=h})(spine||(spine={}));
(function(b){var h=function(){return function(e,p,q){this.rotation=this.y=this.x=0;this.scaleY=this.scaleX=1;this.shearY=this.shearX=0;this.transformMode=k.Normal;if(0>e)throw Error("index must be >= 0.");if(null==p)throw Error("name cannot be null.");this.index=e;this.name=p;this.parent=q}}();b.BoneData=h;(function(e){e[e.Normal=0]="Normal";e[e.OnlyTranslation=1]="OnlyTranslation";e[e.NoRotationOrReflection=2]="NoRotationOrReflection";e[e.NoScale=3]="NoScale";e[e.NoScaleOrReflection=4]="NoScaleOrReflection"})(b.TransformMode||
(b.TransformMode={}));var k=b.TransformMode})(spine||(spine={}));(function(b){var h=function(){return function(k,e){if(null==e)throw Error("data cannot be null.");this.time=k;this.data=e}}();b.Event=h})(spine||(spine={}));(function(b){var h=function(){return function(k){this.name=k}}();b.EventData=h})(spine||(spine={}));
(function(b){var h=function(){function k(e,p){this.mix=1;this.bendDirection=0;if(null==e)throw Error("data cannot be null.");if(null==p)throw Error("skeleton cannot be null.");this.data=e;this.mix=e.mix;this.bendDirection=e.bendDirection;this.bones=[];for(var q=0;q<e.bones.length;q++)this.bones.push(p.findBone(e.bones[q].name));this.target=p.findBone(e.target.name)}k.prototype.getOrder=function(){return this.data.order};k.prototype.apply=function(){this.update()};k.prototype.update=function(){var e=
this.target,p=this.bones;switch(p.length){case 1:this.apply1(p[0],e.worldX,e.worldY,this.mix);break;case 2:this.apply2(p[0],p[1],e.worldX,e.worldY,this.bendDirection,this.mix)}};k.prototype.apply1=function(e,p,q,l){e.appliedValid||e.updateAppliedTransform();var t=e.parent,r=1/(t.a*t.d-t.b*t.c);p-=t.worldX;q-=t.worldY;t=Math.atan2((q*t.a-p*t.c)*r-e.ay,(p*t.d-q*t.b)*r-e.ax)*b.MathUtils.radDeg-e.ashearX-e.arotation;0>e.ascaleX&&(t+=180);180<t?t-=360:-180>t&&(t+=360);e.updateWorldTransformWith(e.ax,e.ay,
e.arotation+t*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)};k.prototype.apply2=function(e,p,q,l,t,r){if(0==r)p.updateWorldTransform();else{e.appliedValid||e.updateAppliedTransform();p.appliedValid||p.updateAppliedTransform();var y=e.ax,z=e.ay,E=e.ascaleX,B=e.ascaleY,F=p.ascaleX,I,L,U;0>E?(E=-E,I=180,U=-1):(I=0,U=1);0>B&&(B=-B,U=-U);0>F?(F=-F,L=180):L=0;var n=p.ax,w,G,f,m=e.a,v=e.b,D=e.c,C=e.d,J=1E-4>=Math.abs(E-B);J?(w=p.ay,G=m*n+v*w+e.worldX,f=D*n+C*w+e.worldY):(w=0,G=m*n+e.worldX,f=D*n+e.worldY);
var N=e.parent;m=N.a;v=N.b;D=N.c;C=N.d;var S=1/(m*C-v*D);q-=N.worldX;l-=N.worldY;var T=(q*C-l*v)*S-y,W=(l*m-q*D)*S-z;q=G-N.worldX;l=f-N.worldY;v=(q*C-l*v)*S-y;m=(l*m-q*D)*S-z;S=Math.sqrt(v*v+m*m);v=p.data.length*F;if(J)v*=E,m=(T*T+W*W-S*S-v*v)/(2*S*v),-1>m?m=-1:1<m&&(m=1),t*=Math.acos(m),m=S+v*m,v*=Math.sin(t),m=Math.atan2(W*m-T*v,T*m+W*v);else if(m=E*v,v*=B,l=m*m,F=v*v,J=T*T+W*W,T=Math.atan2(W,T),D=F*S*S+l*J-l*F,q=-2*F*S,W=F-l,C=q*q-4*W*D,0<=C&&(C=Math.sqrt(C),0>q&&(C=-C),C=-(q+C)/2,q=C/W,C=D/C,
C=Math.abs(q)<Math.abs(C)?q:C,C*C<=J))l=Math.sqrt(J-C*C)*t,m=T-Math.atan2(l,C),t=Math.atan2(l/B,(C-S)/E);else{E=0;D=Number.MAX_VALUE;var Y=N=f=B=G=W=0;q=S+m;C=q*q;C>f&&(B=0,f=C,N=q);q=S-m;C=q*q;C<D&&(E=b.MathUtils.PI,D=C,W=q);F=Math.acos(-m*S/(l-F));q=m*Math.cos(F)+S;l=v*Math.sin(F);C=q*q+l*l;C<D&&(E=F,D=C,W=q,G=l);C>f&&(B=F,f=C,N=q,Y=l);J<=(D+f)/2?(m=T-Math.atan2(G*t,W),t*=E):(m=T-Math.atan2(Y*t,N),t*=B)}v=Math.atan2(w,n)*U;S=e.arotation;m=(m-v)*b.MathUtils.radDeg+I-S;180<m?m-=360:-180>m&&(m+=360);
e.updateWorldTransformWith(y,z,S+m*r,e.ascaleX,e.ascaleY,0,0);S=p.arotation;t=((t+v)*b.MathUtils.radDeg-p.ashearX)*U+L-S;180<t?t-=360:-180>t&&(t+=360);p.updateWorldTransformWith(n,w,S+t*r,p.ascaleX,p.ascaleY,p.ashearX,p.ashearY)}};return k}();b.IkConstraint=h})(spine||(spine={}));(function(b){var h=function(){return function(k){this.order=0;this.bones=[];this.mix=this.bendDirection=1;this.name=k}}();b.IkConstraintData=h})(spine||(spine={}));
(function(b){var h=function(){function k(e,p){this.translateMix=this.rotateMix=this.spacing=this.position=0;this.spaces=[];this.positions=[];this.world=[];this.curves=[];this.lengths=[];this.segments=[];if(null==e)throw Error("data cannot be null.");if(null==p)throw Error("skeleton cannot be null.");this.data=e;this.bones=[];for(var q=0,l=e.bones.length;q<l;q++)this.bones.push(p.findBone(e.bones[q].name));this.target=p.findSlot(e.target.name);this.position=e.position;this.spacing=e.spacing;this.rotateMix=
e.rotateMix;this.translateMix=e.translateMix}k.prototype.apply=function(){this.update()};k.prototype.update=function(){var e=this.target.getAttachment();if(e instanceof b.PathAttachment){var p=this.rotateMix,q=this.translateMix,l=0<p;if(0<q||l){var t=this.data,r=t.spacingMode,y=r==b.SpacingMode.Length,z=t.rotateMode,E=z==b.RotateMode.Tangent,B=z==b.RotateMode.ChainScale,F=this.bones.length,I=E?F:F+1,L=this.bones,U=b.Utils.setArraySize(this.spaces,I),n=null,w=this.spacing;if(B||y){B&&(n=b.Utils.setArraySize(this.lengths,
F));for(var G=0,f=I-1;G<f;){var m=L[G],v=m.data.length,D=v*m.a;v*=m.c;v=Math.sqrt(D*D+v*v);B&&(n[G]=v);U[++G]=y?Math.max(0,v+w):w}}else for(G=1;G<I;G++)U[G]=w;e=this.computeWorldPositions(e,I,E,t.positionMode==b.PositionMode.Percent,r==b.SpacingMode.Percent);r=e[0];y=e[1];t=t.offsetRotation;0==t?z=z==b.RotateMode.Chain:(z=!1,I=this.target.bone,t*=0<I.a*I.d-I.b*I.c?b.MathUtils.degRad:-b.MathUtils.degRad);G=0;for(I=3;G<F;G++,I+=3){m=L[G];m.worldX+=(r-m.worldX)*q;m.worldY+=(y-m.worldY)*q;D=e[I];v=e[I+
1];w=D-r;f=v-y;B&&(r=n[G],0!=r&&(r=(Math.sqrt(w*w+f*f)/r-1)*p+1,m.a*=r,m.c*=r));r=D;y=v;if(l){D=m.a;v=m.b;var C=m.c,J=m.d;var N=E?e[I-1]:0==U[G+1]?e[I+2]:Math.atan2(f,w);N-=Math.atan2(C,D);if(z){var S=Math.cos(N);var T=Math.sin(N);var W=m.data.length;r+=(W*(S*D-T*C)-w)*p;y+=(W*(T*D+S*C)-f)*p}else N+=t;N>b.MathUtils.PI?N-=b.MathUtils.PI2:N<-b.MathUtils.PI&&(N+=b.MathUtils.PI2);N*=p;S=Math.cos(N);T=Math.sin(N);m.a=S*D-T*C;m.b=S*v-T*J;m.c=T*D+S*C;m.d=T*v+S*J}m.appliedValid=!1}}}};k.prototype.computeWorldPositions=
function(e,p,q,l,t){var r=this.target,y=this.position,z=this.spaces,E=b.Utils.setArraySize(this.positions,3*p+2),B=e.closed,F=e.worldVerticesLength,I=F/6,L=k.NONE;if(!e.constantSpeed){var U=e.lengths;I-=B?1:2;var n=U[I];l&&(y*=n);if(t)for(var w=0;w<p;w++)z[w]*=n;var G=b.Utils.setArraySize(this.world,8);for(t=l=w=0;w<p;w++,l+=3){var f=z[w],m=y+=f;if(B)m%=n,0>m&&(m+=n),t=0;else if(0>m){L!=k.BEFORE&&(L=k.BEFORE,e.computeWorldVerticesWith(r,2,4,G,0));this.addBeforePosition(m,G,0,E,l);continue}else if(m>
n){L!=k.AFTER&&(L=k.AFTER,e.computeWorldVerticesWith(r,F-6,4,G,0));this.addAfterPosition(m-n,G,0,E,l);continue}for(;;t++){var v=U[t];if(!(m>v)){if(0==t)m/=v;else{var D=U[t-1];m=(m-D)/(v-D)}break}}t!=L&&(L=t,B&&t==I?(e.computeWorldVerticesWith(r,F-4,4,G,0),e.computeWorldVerticesWith(r,0,4,G,4)):e.computeWorldVerticesWith(r,6*t+2,8,G,0));this.addCurvePosition(m,G[0],G[1],G[2],G[3],G[4],G[5],G[6],G[7],E,l,q||0<w&&0==f)}return E}B?(F+=2,G=b.Utils.setArraySize(this.world,F),e.computeWorldVerticesWith(r,
2,F-4,G,0),e.computeWorldVerticesWith(r,0,2,G,F-4),G[F-2]=G[0],G[F-1]=G[1]):(I--,F-=4,G=b.Utils.setArraySize(this.world,F),e.computeWorldVerticesWith(r,2,F,G,0));e=b.Utils.setArraySize(this.curves,I);r=0;U=G[0];n=G[1];var C=v=0,J=0,N=0,S=0,T=0;w=0;for(f=2;w<I;w++,f+=6){v=G[f];C=G[f+1];J=G[f+2];N=G[f+3];S=G[f+4];T=G[f+5];var W=.1875*(U-2*v+J);var Y=.1875*(n-2*C+N);D=.09375*(3*(v-J)-U+S);var V=.09375*(3*(C-N)-n+T);var ma=2*W+D;var ha=2*Y+V;W=.75*(v-U)+W+.16666667*D;Y=.75*(C-n)+Y+.16666667*V;r+=Math.sqrt(W*
W+Y*Y);W+=ma;Y+=ha;ma+=D;ha+=V;r+=Math.sqrt(W*W+Y*Y);W+=ma;Y+=ha;r+=Math.sqrt(W*W+Y*Y);W+=ma+D;Y+=ha+V;r+=Math.sqrt(W*W+Y*Y);e[w]=r;U=S;n=T}l&&(y*=r);if(t)for(w=0;w<p;w++)z[w]*=r;I=this.segments;var ia=0;for(V=t=l=w=0;w<p;w++,l+=3){f=z[w];m=y+=f;if(B)m%=r,0>m&&(m+=r),t=0;else if(0>m){this.addBeforePosition(m,G,0,E,l);continue}else if(m>r){this.addAfterPosition(m-r,G,F-4,E,l);continue}for(;;t++)if(ma=e[t],!(m>ma)){0==t?m/=ma:(D=e[t-1],m=(m-D)/(ma-D));break}if(t!=L){L=t;var aa=6*t;U=G[aa];n=G[aa+1];
v=G[aa+2];C=G[aa+3];J=G[aa+4];N=G[aa+5];S=G[aa+6];T=G[aa+7];W=.03*(U-2*v+J);Y=.03*(n-2*C+N);D=.006*(3*(v-J)-U+S);V=.006*(3*(C-N)-n+T);ma=2*W+D;ha=2*Y+V;W=.3*(v-U)+W+.16666667*D;Y=.3*(C-n)+Y+.16666667*V;ia=Math.sqrt(W*W+Y*Y);I[0]=ia;for(aa=1;8>aa;aa++)W+=ma,Y+=ha,ma+=D,ha+=V,ia+=Math.sqrt(W*W+Y*Y),I[aa]=ia;W+=ma;Y+=ha;ia+=Math.sqrt(W*W+Y*Y);I[8]=ia;W+=ma+D;Y+=ha+V;ia+=Math.sqrt(W*W+Y*Y);I[9]=ia;V=0}for(m*=ia;;V++)if(ma=I[V],!(m>ma)){0==V?m/=ma:(D=I[V-1],m=V+(m-D)/(ma-D));break}this.addCurvePosition(.1*
m,U,n,v,C,J,N,S,T,E,l,q||0<w&&0==f)}return E};k.prototype.addBeforePosition=function(e,p,q,l,t){var r=p[q],y=p[q+1];p=Math.atan2(p[q+3]-y,p[q+2]-r);l[t]=r+e*Math.cos(p);l[t+1]=y+e*Math.sin(p);l[t+2]=p};k.prototype.addAfterPosition=function(e,p,q,l,t){var r=p[q+2],y=p[q+3];p=Math.atan2(y-p[q+1],r-p[q]);l[t]=r+e*Math.cos(p);l[t+1]=y+e*Math.sin(p);l[t+2]=p};k.prototype.addCurvePosition=function(e,p,q,l,t,r,y,z,E,B,F,I){if(0==e||isNaN(e))e=1E-4;var L=e*e,U=L*e,n=1-e,w=n*n,G=w*n,f=n*e,m=3*f;n*=m;e*=m;
z=p*G+l*n+r*e+z*U;E=q*G+t*n+y*e+E*U;B[F]=z;B[F+1]=E;I&&(B[F+2]=Math.atan2(E-(q*w+t*f*2+y*L),z-(p*w+l*f*2+r*L)))};k.prototype.getOrder=function(){return this.data.order};k.NONE=-1;k.BEFORE=-2;k.AFTER=-3;return k}();b.PathConstraint=h})(spine||(spine={}));
(function(b){var h=function(){return function(k){this.order=0;this.bones=[];this.name=k}}();b.PathConstraintData=h;(function(k){k[k.Fixed=0]="Fixed";k[k.Percent=1]="Percent"})(b.PositionMode||(b.PositionMode={}));(function(k){k[k.Length=0]="Length";k[k.Fixed=1]="Fixed";k[k.Percent=2]="Percent"})(b.SpacingMode||(b.SpacingMode={}));(function(k){k[k.Tangent=0]="Tangent";k[k.Chain=1]="Chain";k[k.ChainScale=2]="ChainScale"})(b.RotateMode||(b.RotateMode={}))})(spine||(spine={}));
(function(b){var h=function(){function e(p){this.toLoad=[];this.assets={};this.clientId=p}e.prototype.loaded=function(){var p=0,q;for(q in this.assets)p++;return p};return e}(),k=function(){function e(p){void 0===p&&(p="");this.clientAssets={};this.queuedAssets={};this.rawAssets={};this.errors={};this.pathPrefix=p}e.prototype.queueAsset=function(p,q,l){var t=this.clientAssets[p];if(null===t||void 0===t)t=new h(p),this.clientAssets[p]=t;null!==q&&(t.textureLoader=q);t.toLoad.push(l);if(this.queuedAssets[l]===
l)return!1;this.queuedAssets[l]=l;return!0};e.prototype.loadText=function(p,q){var l=this;q=this.pathPrefix+q;if(this.queueAsset(p,null,q)){var t=new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(200<=t.status&&300>t.status?l.rawAssets[q]=t.responseText:l.errors[q]="Couldn't load text "+q+": status "+t.status+", "+t.responseText)};t.open("GET",q,!0);t.send()}};e.prototype.loadJson=function(p,q){var l=this;q=this.pathPrefix+q;if(this.queueAsset(p,null,q)){var t=
new XMLHttpRequest;t.onreadystatechange=function(){t.readyState==XMLHttpRequest.DONE&&(200<=t.status&&300>t.status?l.rawAssets[q]=JSON.parse(t.responseText):l.errors[q]="Couldn't load text "+q+": status "+t.status+", "+t.responseText)};t.open("GET",q,!0);t.send()}};e.prototype.loadTexture=function(p,q,l){var t=this;l=this.pathPrefix+l;if(this.queueAsset(p,q,l)){var r=new Image;r.src=l;r.crossOrigin="anonymous";r.onload=function(y){t.rawAssets[l]=r};r.onerror=function(y){t.errors[l]="Couldn't load image "+
l}}};e.prototype.get=function(p,q){q=this.pathPrefix+q;p=this.clientAssets[p];return null===p||void 0===p?!0:p.assets[q]};e.prototype.updateClientAssets=function(p){for(var q=0;q<p.toLoad.length;q++){var l=p.toLoad[q],t=p.assets[l];if(null===t||void 0===t)t=this.rawAssets[l],null!==t&&void 0!==t&&(p.assets[l]=t instanceof HTMLImageElement?p.textureLoader(t):t)}};e.prototype.isLoadingComplete=function(p){p=this.clientAssets[p];if(null===p||void 0===p)return!0;this.updateClientAssets(p);return p.toLoad.length==
p.loaded()};e.prototype.dispose=function(){};e.prototype.hasErrors=function(){return 0<Object.keys(this.errors).length};e.prototype.getErrors=function(){return this.errors};return e}();b.SharedAssetManager=k})(spine||(spine={}));
(function(b){var h=function(){function k(e){this._updateCache=[];this.updateCacheReset=[];this.time=0;this.flipY=this.flipX=!1;this.y=this.x=0;if(null==e)throw Error("data cannot be null.");this.data=e;this.bones=[];for(var p=0;p<e.bones.length;p++){var q=e.bones[p];if(null==q.parent)q=new b.Bone(q,this,null);else{var l=this.bones[q.parent.index];q=new b.Bone(q,this,l);l.children.push(q)}this.bones.push(q)}this.slots=[];this.drawOrder=[];for(p=0;p<e.slots.length;p++)l=e.slots[p],q=this.bones[l.boneData.index],
q=new b.Slot(l,q),this.slots.push(q),this.drawOrder.push(q);this.ikConstraints=[];for(p=0;p<e.ikConstraints.length;p++)this.ikConstraints.push(new b.IkConstraint(e.ikConstraints[p],this));this.transformConstraints=[];for(p=0;p<e.transformConstraints.length;p++)this.transformConstraints.push(new b.TransformConstraint(e.transformConstraints[p],this));this.pathConstraints=[];for(p=0;p<e.pathConstraints.length;p++)this.pathConstraints.push(new b.PathConstraint(e.pathConstraints[p],this));this.color=new b.Color(1,
1,1,1);this.updateCache()}k.prototype.updateCache=function(){this._updateCache.length=0;for(var e=this.bones,p=0,q=e.length;p<q;p++)e[p].sorted=!1;q=this.ikConstraints;var l=this.transformConstraints,t=this.pathConstraints,r=q.length,y=l.length,z=t.length,E=r+y+z;p=0;a:for(;p<E;p++){for(var B=0;B<r;B++){var F=q[B];if(F.data.order==p){this.sortIkConstraint(F);continue a}}for(B=0;B<y;B++)if(F=l[B],F.data.order==p){this.sortTransformConstraint(F);continue a}for(B=0;B<z;B++)if(F=t[B],F.data.order==p){this.sortPathConstraint(F);
continue a}}p=0;for(q=e.length;p<q;p++)this.sortBone(e[p])};k.prototype.sortIkConstraint=function(e){this.sortBone(e.target);var p=e.bones,q=p[0];this.sortBone(q);if(1<p.length){var l=p[p.length-1];-1<this._updateCache.indexOf(l)||this.updateCacheReset.push(l)}this._updateCache.push(e);this.sortReset(q.children);p[p.length-1].sorted=!0};k.prototype.sortPathConstraint=function(e){var p=e.target,q=p.data.index,l=p.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,q,l);null!=this.data.defaultSkin&&
this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,q,l);for(var t=0,r=this.data.skins.length;t<r;t++)this.sortPathConstraintAttachment(this.data.skins[t],q,l);t=p.getAttachment();t instanceof b.PathAttachment&&this.sortPathConstraintAttachmentWith(t,l);l=e.bones;p=l.length;for(t=0;t<p;t++)this.sortBone(l[t]);this._updateCache.push(e);for(t=0;t<p;t++)this.sortReset(l[t].children);for(t=0;t<p;t++)l[t].sorted=!0};k.prototype.sortTransformConstraint=function(e){this.sortBone(e.target);
for(var p=e.bones,q=p.length,l=0;l<q;l++)this.sortBone(p[l]);this._updateCache.push(e);for(l=0;l<q;l++)this.sortReset(p[l].children);for(l=0;l<q;l++)p[l].sorted=!0};k.prototype.sortPathConstraintAttachment=function(e,p,q){if(e=e.attachments[p])for(var l in e)this.sortPathConstraintAttachmentWith(e[l],q)};k.prototype.sortPathConstraintAttachmentWith=function(e,p){if(e instanceof b.PathAttachment)if(e=e.bones,null==e)this.sortBone(p);else{p=this.bones;for(var q=0;q<e.length;){var l=e[q++];for(l=q+l;q<
l;q++)this.sortBone(p[e[q]])}}};k.prototype.sortBone=function(e){if(!e.sorted){var p=e.parent;null!=p&&this.sortBone(p);e.sorted=!0;this._updateCache.push(e)}};k.prototype.sortReset=function(e){for(var p=0,q=e.length;p<q;p++){var l=e[p];l.sorted&&this.sortReset(l.children);l.sorted=!1}};k.prototype.updateWorldTransform=function(){for(var e=this.updateCacheReset,p=0,q=e.length;p<q;p++){var l=e[p];l.ax=l.x;l.ay=l.y;l.arotation=l.rotation;l.ascaleX=l.scaleX;l.ascaleY=l.scaleY;l.ashearX=l.shearX;l.ashearY=
l.shearY;l.appliedValid=!0}e=this._updateCache;p=0;for(q=e.length;p<q;p++)e[p].update()};k.prototype.setToSetupPose=function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()};k.prototype.setBonesToSetupPose=function(){for(var e=this.bones,p=0,q=e.length;p<q;p++)e[p].setToSetupPose();var l=this.ikConstraints;p=0;for(q=l.length;p<q;p++)e=l[p],e.bendDirection=e.data.bendDirection,e.mix=e.data.mix;var t=this.transformConstraints;p=0;for(q=t.length;p<q;p++)e=t[p],l=e.data,e.rotateMix=l.rotateMix,
e.translateMix=l.translateMix,e.scaleMix=l.scaleMix,e.shearMix=l.shearMix;t=this.pathConstraints;p=0;for(q=t.length;p<q;p++)e=t[p],l=e.data,e.position=l.position,e.spacing=l.spacing,e.rotateMix=l.rotateMix,e.translateMix=l.translateMix};k.prototype.setSlotsToSetupPose=function(){var e=this.slots;b.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var p=0,q=e.length;p<q;p++)e[p].setToSetupPose()};k.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]};k.prototype.findBone=
function(e){if(null==e)throw Error("boneName cannot be null.");for(var p=this.bones,q=0,l=p.length;q<l;q++){var t=p[q];if(t.data.name==e)return t}return null};k.prototype.findBoneIndex=function(e){if(null==e)throw Error("boneName cannot be null.");for(var p=this.bones,q=0,l=p.length;q<l;q++)if(p[q].data.name==e)return q;return-1};k.prototype.findSlot=function(e){if(null==e)throw Error("slotName cannot be null.");for(var p=this.slots,q=0,l=p.length;q<l;q++){var t=p[q];if(t.data.name==e)return t}return null};
k.prototype.findSlotIndex=function(e){if(null==e)throw Error("slotName cannot be null.");for(var p=this.slots,q=0,l=p.length;q<l;q++)if(p[q].data.name==e)return q;return-1};k.prototype.setSkinByName=function(e){var p=this.data.findSkin(e);if(null==p)throw Error("Skin not found: "+e);this.setSkin(p)};k.prototype.setSkin=function(e){if(null!=e)if(null!=this.skin)e.attachAll(this,this.skin);else for(var p=this.slots,q=0,l=p.length;q<l;q++){var t=p[q],r=t.data.attachmentName;null!=r&&(r=e.getAttachment(q,
r),null!=r&&t.setAttachment(r))}this.skin=e};k.prototype.getAttachmentByName=function(e,p){return this.getAttachment(this.data.findSlotIndex(e),p)};k.prototype.getAttachment=function(e,p){if(null==p)throw Error("attachmentName cannot be null.");if(null!=this.skin){var q=this.skin.getAttachment(e,p);if(null!=q)return q}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,p):null};k.prototype.setAttachment=function(e,p){if(null==e)throw Error("slotName cannot be null.");for(var q=
this.slots,l=0,t=q.length;l<t;l++){var r=q[l];if(r.data.name==e){q=null;if(null!=p&&(q=this.getAttachment(l,p),null==q))throw Error("Attachment not found: "+p+", for slot: "+e);r.setAttachment(q);return}}throw Error("Slot not found: "+e);};k.prototype.findIkConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var p=this.ikConstraints,q=0,l=p.length;q<l;q++){var t=p[q];if(t.data.name==e)return t}return null};k.prototype.findTransformConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");
for(var p=this.transformConstraints,q=0,l=p.length;q<l;q++){var t=p[q];if(t.data.name==e)return t}return null};k.prototype.findPathConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var p=this.pathConstraints,q=0,l=p.length;q<l;q++){var t=p[q];if(t.data.name==e)return t}return null};k.prototype.getBounds=function(e,p){if(null==e)throw Error("offset cannot be null.");if(null==p)throw Error("size cannot be null.");for(var q=this.drawOrder,l=Number.POSITIVE_INFINITY,
t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,y=Number.NEGATIVE_INFINITY,z=0,E=q.length;z<E;z++){var B=q[z],F=null,I=B.getAttachment();I instanceof b.RegionAttachment?F=I.updateWorldVertices(B,!1):I instanceof b.MeshAttachment&&(F=I.updateWorldVertices(B,!0));if(null!=F)for(B=0,I=F.length;B<I;B+=8){var L=F[B],U=F[B+1];l=Math.min(l,L);t=Math.min(t,U);r=Math.max(r,L);y=Math.max(y,U)}}e.set(l,t);p.set(r-l,y-t)};k.prototype.update=function(e){this.time+=e};return k}();b.Skeleton=h})(spine||(spine=
{}));
(function(b){var h=function(){function k(){this.maxY=this.maxX=this.minY=this.minX=0;this.boundingBoxes=[];this.polygons=[];this.polygonPool=new b.Pool(function(){return b.Utils.newFloatArray(16)})}k.prototype.update=function(e,p){if(null==e)throw Error("skeleton cannot be null.");var q=this.boundingBoxes,l=this.polygons,t=this.polygonPool;e=e.slots;var r=e.length;q.length=0;t.freeAll(l);for(var y=l.length=0;y<r;y++){var z=e[y],E=z.getAttachment();if(E instanceof b.BoundingBoxAttachment){q.push(E);var B=
t.obtain();B.length!=E.worldVerticesLength&&(B=b.Utils.newFloatArray(E.worldVerticesLength));l.push(B);E.computeWorldVertices(z,B)}}p?this.aabbCompute():(this.minY=this.minX=Number.POSITIVE_INFINITY,this.maxY=this.maxX=Number.NEGATIVE_INFINITY)};k.prototype.aabbCompute=function(){for(var e=Number.POSITIVE_INFINITY,p=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,t=this.polygons,r=0,y=t.length;r<y;r++){var z=t[r],E=z,B=0;for(z=z.length;B<z;B+=2){var F=E[B],I=E[B+1];
e=Math.min(e,F);p=Math.min(p,I);q=Math.max(q,F);l=Math.max(l,I)}}this.minX=e;this.minY=p;this.maxX=q;this.maxY=l};k.prototype.aabbContainsPoint=function(e,p){return e>=this.minX&&e<=this.maxX&&p>=this.minY&&p<=this.maxY};k.prototype.aabbIntersectsSegment=function(e,p,q,l){var t=this.minX,r=this.minY,y=this.maxX,z=this.maxY;if(e<=t&&q<=t||p<=r&&l<=r||e>=y&&q>=y||p>=z&&l>=z)return!1;q=(l-p)/(q-e);l=q*(t-e)+p;if(l>r&&l<z)return!0;l=q*(y-e)+p;if(l>r&&l<z)return!0;r=(r-p)/q+e;if(r>t&&r<y)return!0;r=(z-
p)/q+e;return r>t&&r<y?!0:!1};k.prototype.aabbIntersectsSkeleton=function(e){return this.minX<e.maxX&&this.maxX>e.minX&&this.minY<e.maxY&&this.maxY>e.minY};k.prototype.containsPoint=function(e,p){for(var q=this.polygons,l=0,t=q.length;l<t;l++)if(this.containsPointPolygon(q[l],e,p))return this.boundingBoxes[l];return null};k.prototype.containsPointPolygon=function(e,p,q){for(var l=e.length,t=l-2,r=!1,y=0;y<l;y+=2){var z=e[y+1],E=e[t+1];if(z<q&&E>=q||E<q&&z>=q){var B=e[y];B+(q-z)/(E-z)*(e[t]-B)<p&&
(r=!r)}t=y}return r};k.prototype.intersectsSegment=function(e,p,q,l){for(var t=this.polygons,r=0,y=t.length;r<y;r++)if(this.intersectsSegmentPolygon(t[r],e,p,q,l))return this.boundingBoxes[r];return null};k.prototype.intersectsSegmentPolygon=function(e,p,q,l,t){for(var r=e.length,y=p-l,z=q-t,E=p*t-q*l,B=e[r-2],F=e[r-1],I=0;I<r;I+=2){var L=e[I],U=e[I+1],n=B*U-F*L,w=B-L,G=F-U,f=y*G-z*w;w=(E*w-y*n)/f;if((w>=B&&w<=L||w>=L&&w<=B)&&(w>=p&&w<=l||w>=l&&w<=p)&&(B=(E*G-z*n)/f,(B>=F&&B<=U||B>=U&&B<=F)&&(B>=
q&&B<=t||B>=t&&B<=q)))return!0;B=L;F=U}return!1};k.prototype.getPolygon=function(e){if(null==e)throw Error("boundingBox cannot be null.");e=this.boundingBoxes.indexOf(e);return-1==e?null:this.polygons[e]};k.prototype.getWidth=function(){return this.maxX-this.minX};k.prototype.getHeight=function(){return this.maxY-this.minY};return k}();b.SkeletonBounds=h})(spine||(spine={}));
(function(b){var h=function(){function k(){this.bones=[];this.slots=[];this.skins=[];this.events=[];this.animations=[];this.ikConstraints=[];this.transformConstraints=[];this.pathConstraints=[];this.fps=0}k.prototype.findBone=function(e){if(null==e)throw Error("boneName cannot be null.");for(var p=this.bones,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findBoneIndex=function(e){if(null==e)throw Error("boneName cannot be null.");for(var p=this.bones,q=0,l=p.length;q<
l;q++)if(p[q].name==e)return q;return-1};k.prototype.findSlot=function(e){if(null==e)throw Error("slotName cannot be null.");for(var p=this.slots,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findSlotIndex=function(e){if(null==e)throw Error("slotName cannot be null.");for(var p=this.slots,q=0,l=p.length;q<l;q++)if(p[q].name==e)return q;return-1};k.prototype.findSkin=function(e){if(null==e)throw Error("skinName cannot be null.");for(var p=this.skins,q=0,l=p.length;q<
l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findEvent=function(e){if(null==e)throw Error("eventDataName cannot be null.");for(var p=this.events,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findAnimation=function(e){if(null==e)throw Error("animationName cannot be null.");for(var p=this.animations,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findIkConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");
for(var p=this.ikConstraints,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findTransformConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var p=this.transformConstraints,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};k.prototype.findPathConstraint=function(e){if(null==e)throw Error("constraintName cannot be null.");for(var p=this.pathConstraints,q=0,l=p.length;q<l;q++){var t=p[q];if(t.name==e)return t}return null};
k.prototype.findPathConstraintIndex=function(e){if(null==e)throw Error("pathConstraintName cannot be null.");for(var p=this.pathConstraints,q=0,l=p.length;q<l;q++)if(p[q].name==e)return q;return-1};return k}();b.SkeletonData=h})(spine||(spine={}));
(function(b){var h=function(){function e(p){this.scale=1;this.linkedMeshes=[];this.attachmentLoader=p}e.prototype.readSkeletonData=function(p){var q=this.scale,l=new b.SkeletonData;p="string"===typeof p?JSON.parse(p):p;var t=p.skeleton;null!=t&&(l.hash=t.hash,l.version=t.spine,l.width=t.width,l.height=t.height,l.fps=t.fps,l.imagesPath=t.images);if(p.bones)for(t=0;t<p.bones.length;t++){var r=p.bones[t],y=null,z=this.getValue(r,"parent",null);if(null!=z&&(y=l.findBone(z),null==y))throw Error("Parent bone not found: "+
z);y=new b.BoneData(l.bones.length,r.name,y);y.length=this.getValue(r,"length",0)*q;y.x=this.getValue(r,"x",0)*q;y.y=this.getValue(r,"y",0)*q;y.rotation=this.getValue(r,"rotation",0);y.scaleX=this.getValue(r,"scaleX",1);y.scaleY=this.getValue(r,"scaleY",1);y.shearX=this.getValue(r,"shearX",0);y.shearY=this.getValue(r,"shearY",0);y.transformMode=e.transformModeFromString(this.getValue(r,"transform","normal"));l.bones.push(y)}if(p.slots)for(t=0;t<p.slots.length;t++){r=p.slots[t];var E=r.name;z=r.bone;
y=l.findBone(z);if(null==y)throw Error("Slot bone not found: "+z);y=new b.SlotData(l.slots.length,E,y);z=this.getValue(r,"color",null);null!=z&&y.color.setFromString(z);y.attachmentName=this.getValue(r,"attachment",null);y.blendMode=e.blendModeFromString(this.getValue(r,"blend","normal"));l.slots.push(y)}if(p.ik)for(t=0;t<p.ik.length;t++){r=p.ik[t];y=new b.IkConstraintData(r.name);y.order=this.getValue(r,"order",0);for(var B=0;B<r.bones.length;B++){z=r.bones[B];var F=l.findBone(z);if(null==F)throw Error("IK bone not found: "+
z);y.bones.push(F)}z=r.target;y.target=l.findBone(z);if(null==y.target)throw Error("IK target bone not found: "+z);y.bendDirection=this.getValue(r,"bendPositive",!0)?1:-1;y.mix=this.getValue(r,"mix",1);l.ikConstraints.push(y)}if(p.transform)for(t=0;t<p.transform.length;t++){r=p.transform[t];y=new b.TransformConstraintData(r.name);y.order=this.getValue(r,"order",0);for(B=0;B<r.bones.length;B++){z=r.bones[B];F=l.findBone(z);if(null==F)throw Error("Transform constraint bone not found: "+z);y.bones.push(F)}z=
r.target;y.target=l.findBone(z);if(null==y.target)throw Error("Transform constraint target bone not found: "+z);y.offsetRotation=this.getValue(r,"rotation",0);y.offsetX=this.getValue(r,"x",0)*q;y.offsetY=this.getValue(r,"y",0)*q;y.offsetScaleX=this.getValue(r,"scaleX",0);y.offsetScaleY=this.getValue(r,"scaleY",0);y.offsetShearY=this.getValue(r,"shearY",0);y.rotateMix=this.getValue(r,"rotateMix",1);y.translateMix=this.getValue(r,"translateMix",1);y.scaleMix=this.getValue(r,"scaleMix",1);y.shearMix=
this.getValue(r,"shearMix",1);l.transformConstraints.push(y)}if(p.path)for(t=0;t<p.path.length;t++){r=p.path[t];y=new b.PathConstraintData(r.name);y.order=this.getValue(r,"order",0);for(B=0;B<r.bones.length;B++){z=r.bones[B];F=l.findBone(z);if(null==F)throw Error("Transform constraint bone not found: "+z);y.bones.push(F)}z=r.target;y.target=l.findSlot(z);if(null==y.target)throw Error("Path target slot not found: "+z);y.positionMode=e.positionModeFromString(this.getValue(r,"positionMode","percent"));
y.spacingMode=e.spacingModeFromString(this.getValue(r,"spacingMode","length"));y.rotateMode=e.rotateModeFromString(this.getValue(r,"rotateMode","tangent"));y.offsetRotation=this.getValue(r,"rotation",0);y.position=this.getValue(r,"position",0);y.positionMode==b.PositionMode.Fixed&&(y.position*=q);y.spacing=this.getValue(r,"spacing",0);if(y.spacingMode==b.SpacingMode.Length||y.spacingMode==b.SpacingMode.Fixed)y.spacing*=q;y.rotateMix=this.getValue(r,"rotateMix",1);y.translateMix=this.getValue(r,"translateMix",
1);l.pathConstraints.push(y)}if(p.skins)for(var I in p.skins){t=p.skins[I];q=new b.Skin(I);for(E in t){y=l.findSlotIndex(E);if(-1==y)throw Error("Slot not found: "+E);r=t[E];for(var L in r)z=this.readAttachment(r[L],q,y,L),null!=z&&q.addAttachment(y,L,z)}l.skins.push(q);"default"==q.name&&(l.defaultSkin=q)}t=0;for(E=this.linkedMeshes.length;t<E;t++){I=this.linkedMeshes[t];q=null==I.skin?l.defaultSkin:l.findSkin(I.skin);if(null==q)throw Error("Skin not found: "+I.skin);L=q.getAttachment(I.slotIndex,
I.parent);if(null==L)throw Error("Parent mesh not found: "+I.parent);I.mesh.setParentMesh(L);I.mesh.updateUVs()}this.linkedMeshes.length=0;if(p.events)for(var U in p.events)E=p.events[U],y=new b.EventData(U),y.intValue=this.getValue(E,"int",0),y.floatValue=this.getValue(E,"float",0),y.stringValue=this.getValue(E,"string",""),l.events.push(y);if(p.animations)for(var n in p.animations)this.readAnimation(p.animations[n],n,l);return l};e.prototype.readAttachment=function(p,q,l,t){var r=this.scale;t=this.getValue(p,
"name",t);switch(this.getValue(p,"type","region")){case "region":var y=this.getValue(p,"path",t);l=this.attachmentLoader.newRegionAttachment(q,t,y);if(null==l)break;l.path=y;l.x=this.getValue(p,"x",0)*r;l.y=this.getValue(p,"y",0)*r;l.scaleX=this.getValue(p,"scaleX",1);l.scaleY=this.getValue(p,"scaleY",1);l.rotation=this.getValue(p,"rotation",0);l.width=p.width*r;l.height=p.height*r;r=this.getValue(p,"color",null);null!=r&&l.color.setFromString(r);l.updateOffset();return l;case "boundingbox":y=this.attachmentLoader.newBoundingBoxAttachment(q,
t);if(null==y)break;this.readVertices(p,y,p.vertexCount<<1);r=this.getValue(p,"color",null);null!=r&&y.color.setFromString(r);return y;case "mesh":case "linkedmesh":y=this.getValue(p,"path",t);q=this.attachmentLoader.newMeshAttachment(q,t,y);if(null==q)break;q.path=y;r=this.getValue(p,"color",null);null!=r&&q.color.setFromString(r);y=this.getValue(p,"parent",null);if(null!=y)return q.inheritDeform=this.getValue(p,"deform",!0),this.linkedMeshes.push(new k(q,this.getValue(p,"skin",null),l,y)),q;y=p.uvs;
this.readVertices(p,q,y.length);q.triangles=p.triangles;q.regionUVs=y;q.updateUVs();q.hullLength=2*this.getValue(p,"hull",0);return q;case "path":if(y=this.attachmentLoader.newPathAttachment(q,t),null!=y){y.closed=this.getValue(p,"closed",!1);y.constantSpeed=this.getValue(p,"constantSpeed",!0);l=p.vertexCount;this.readVertices(p,y,l<<1);l=b.Utils.newArray(l/3,0);for(q=0;q<p.lengths.length;q++)l[q++]=p.lengths[q]*r;y.lengths=l;r=this.getValue(p,"color",null);null!=r&&y.color.setFromString(r);return y}}return null};
e.prototype.readVertices=function(p,q,l){var t=this.scale;q.worldVerticesLength=l;p=p.vertices;if(l==p.length){if(1!=t){l=0;for(var r=p.length;l<r;l++)p[l]*=t}q.vertices=b.Utils.toFloatArray(p)}else{var y=[],z=[];l=0;for(r=p.length;l<r;){var E=p[l++];z.push(E);for(E=l+4*E;l<E;l+=4)z.push(p[l]),y.push(p[l+1]*t),y.push(p[l+2]*t),y.push(p[l+3])}q.bones=z;q.vertices=b.Utils.toFloatArray(y)}};e.prototype.readAnimation=function(p,q,l){var t=this.scale,r=[],y=0;if(p.slots)for(var z in p.slots){var E=p.slots[z],
B=l.findSlotIndex(z);if(-1==B)throw Error("Slot not found: "+z);for(var F in E){var I=E[F];if("color"==F){var L=new b.ColorTimeline(I.length);L.slotIndex=B;for(var U=0,n=0;n<I.length;n++){var w=I[n],G=new b.Color;G.setFromString(w.color);L.setFrame(U,w.time,G.r,G.g,G.b,G.a);this.readCurve(w,L,U);U++}r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.ColorTimeline.ENTRIES])}else{F="attachment";L=new b.AttachmentTimeline(I.length);L.slotIndex=B;for(n=U=0;n<I.length;n++)w=I[n],L.setFrame(U++,w.time,
w.name);r.push(L);y=Math.max(y,L.frames[L.getFrameCount()-1])}}}if(p.bones)for(var f in p.bones){E=p.bones[f];G=l.findBoneIndex(f);if(-1==G)throw Error("Bone not found: "+f);for(F in E)if(I=E[F],"rotate"===F){L=new b.RotateTimeline(I.length);L.boneIndex=G;for(n=U=0;n<I.length;n++)w=I[n],L.setFrame(U,w.time,w.angle),this.readCurve(w,L,U),U++;r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.RotateTimeline.ENTRIES])}else if("translate"===F||"scale"===F||"shear"===F){B=1;"scale"===F?L=new b.ScaleTimeline(I.length):
"shear"===F?L=new b.ShearTimeline(I.length):(L=new b.TranslateTimeline(I.length),B=t);L.boneIndex=G;for(n=U=0;n<I.length;n++){w=I[n];var m=this.getValue(w,"x",0),v=this.getValue(w,"y",0);L.setFrame(U,w.time,m*B,v*B);this.readCurve(w,L,U);U++}r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.TranslateTimeline.ENTRIES])}else throw Error("Invalid timeline type for a bone: "+F+" ("+f+")");}if(p.ik)for(var D in p.ik){E=p.ik[D];U=l.findIkConstraint(D);L=new b.IkConstraintTimeline(E.length);L.ikConstraintIndex=
l.ikConstraints.indexOf(U);for(n=U=0;n<E.length;n++)w=E[n],L.setFrame(U,w.time,this.getValue(w,"mix",1),this.getValue(w,"bendPositive",!0)?1:-1),this.readCurve(w,L,U),U++;r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.IkConstraintTimeline.ENTRIES])}if(p.transform)for(D in p.transform){E=p.transform[D];U=l.findTransformConstraint(D);L=new b.TransformConstraintTimeline(E.length);L.transformConstraintIndex=l.transformConstraints.indexOf(U);for(n=U=0;n<E.length;n++)w=E[n],L.setFrame(U,w.time,
this.getValue(w,"rotateMix",1),this.getValue(w,"translateMix",1),this.getValue(w,"scaleMix",1),this.getValue(w,"shearMix",1)),this.readCurve(w,L,U),U++;r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.TransformConstraintTimeline.ENTRIES])}if(p.paths)for(D in p.paths){E=p.paths[D];f=l.findPathConstraintIndex(D);if(-1==f)throw Error("Path constraint not found: "+D);G=l.pathConstraints[f];for(F in E)if(I=E[F],"position"===F||"spacing"===F){B=1;if("spacing"===F){if(L=new b.PathConstraintSpacingTimeline(I.length),
G.spacingMode==b.SpacingMode.Length||G.spacingMode==b.SpacingMode.Fixed)B=t}else L=new b.PathConstraintPositionTimeline(I.length),G.positionMode==b.PositionMode.Fixed&&(B=t);L.pathConstraintIndex=f;for(n=U=0;n<I.length;n++)w=I[n],L.setFrame(U,w.time,this.getValue(w,F,0)*B),this.readCurve(w,L,U),U++;r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===F){L=new b.PathConstraintMixTimeline(I.length);L.pathConstraintIndex=f;for(n=U=0;n<I.length;n++)w=
I[n],L.setFrame(U,w.time,this.getValue(w,"rotateMix",1),this.getValue(w,"translateMix",1)),this.readCurve(w,L,U),U++;r.push(L);y=Math.max(y,L.frames[(L.getFrameCount()-1)*b.PathConstraintMixTimeline.ENTRIES])}}if(p.deform)for(var C in p.deform){f=p.deform[C];G=l.findSkin(C);if(null==G)throw Error("Skin not found: "+C);for(z in f){E=f[z];B=l.findSlotIndex(z);if(-1==B)throw Error("Slot not found: "+E.name);for(F in E){I=E[F];U=G.getAttachment(B,F);if(null==U)throw Error("Deform attachment not found: "+
I.name);m=null!=U.bones;v=U.vertices;var J=m?v.length/3*2:v.length;L=new b.DeformTimeline(I.length);L.slotIndex=B;L.attachment=U;for(D=U=0;D<I.length;D++){w=I[D];var N=this.getValue(w,"vertices",null);if(null==N)var S=m?b.Utils.newFloatArray(J):v;else{S=b.Utils.newFloatArray(J);n=this.getValue(w,"offset",0);b.Utils.arrayCopy(N,0,S,n,N.length);if(1!=t)for(N=n+N.length;n<N;n++)S[n]*=t;if(!m)for(n=0;n<J;n++)S[n]+=v[n]}L.setFrame(U,w.time,S);this.readCurve(w,L,U);U++}r.push(L);y=Math.max(y,L.frames[L.getFrameCount()-
1])}}}t=p.drawOrder;null==t&&(t=p.draworder);if(null!=t){L=new b.DrawOrderTimeline(t.length);z=l.slots.length;for(D=U=0;D<t.length;D++){F=t[D];C=null;I=this.getValue(F,"offsets",null);if(null!=I){C=b.Utils.newArray(z,-1);w=b.Utils.newArray(z-I.length,0);for(n=f=E=0;n<I.length;n++){G=I[n];B=l.findSlotIndex(G.slot);if(-1==B)throw Error("Slot not found: "+G.slot);for(;E!=B;)w[f++]=E++;C[E+G.offset]=E++}for(;E<z;)w[f++]=E++;for(n=z-1;0<=n;n--)-1==C[n]&&(C[n]=w[--f])}L.setFrame(U++,F.time,C)}r.push(L);
y=Math.max(y,L.frames[L.getFrameCount()-1])}if(p.events){L=new b.EventTimeline(p.events.length);for(n=U=0;n<p.events.length;n++){t=p.events[n];z=l.findEvent(t.name);if(null==z)throw Error("Event not found: "+t.name);B=new b.Event(t.time,z);B.intValue=this.getValue(t,"int",z.intValue);B.floatValue=this.getValue(t,"float",z.floatValue);B.stringValue=this.getValue(t,"string",z.stringValue);L.setFrame(U++,B)}r.push(L);y=Math.max(y,L.frames[L.getFrameCount()-1])}if(isNaN(y))throw Error("Error while parsing animation, duration is NaN");
l.animations.push(new b.Animation(q,r,y))};e.prototype.readCurve=function(p,q,l){p.curve&&("stepped"===p.curve?q.setStepped(l):"[object Array]"===Object.prototype.toString.call(p.curve)&&(p=p.curve,q.setCurve(l,p[0],p[1],p[2],p[3])))};e.prototype.getValue=function(p,q,l){return void 0!==p[q]?p[q]:l};e.blendModeFromString=function(p){p=p.toLowerCase();if("normal"==p)return b.BlendMode.Normal;if("additive"==p)return b.BlendMode.Additive;if("multiply"==p)return b.BlendMode.Multiply;if("screen"==p)return b.BlendMode.Screen;
throw Error("Unknown blend mode: "+p);};e.positionModeFromString=function(p){p=p.toLowerCase();if("fixed"==p)return b.PositionMode.Fixed;if("percent"==p)return b.PositionMode.Percent;throw Error("Unknown position mode: "+p);};e.spacingModeFromString=function(p){p=p.toLowerCase();if("length"==p)return b.SpacingMode.Length;if("fixed"==p)return b.SpacingMode.Fixed;if("percent"==p)return b.SpacingMode.Percent;throw Error("Unknown position mode: "+p);};e.rotateModeFromString=function(p){p=p.toLowerCase();
if("tangent"==p)return b.RotateMode.Tangent;if("chain"==p)return b.RotateMode.Chain;if("chainscale"==p)return b.RotateMode.ChainScale;throw Error("Unknown rotate mode: "+p);};e.transformModeFromString=function(p){p=p.toLowerCase();if("normal"==p)return b.TransformMode.Normal;if("onlytranslation"==p)return b.TransformMode.OnlyTranslation;if("norotationorreflection"==p)return b.TransformMode.NoRotationOrReflection;if("noscale"==p)return b.TransformMode.NoScale;if("noscaleorreflection"==p)return b.TransformMode.NoScaleOrReflection;
throw Error("Unknown transform mode: "+p);};return e}();b.SkeletonJson=h;var k=function(){return function(e,p,q,l){this.mesh=e;this.skin=p;this.slotIndex=q;this.parent=l}}()})(spine||(spine={}));
(function(b){var h=function(){function k(e){this.attachments=[];if(null==e)throw Error("name cannot be null.");this.name=e}k.prototype.addAttachment=function(e,p,q){if(null==q)throw Error("attachment cannot be null.");var l=this.attachments;e>=l.length&&(l.length=e+1);l[e]||(l[e]={});l[e][p]=q};k.prototype.getAttachment=function(e,p){return(e=this.attachments[e])?e[p]:null};k.prototype.attachAll=function(e,p){for(var q=0,l=0;l<e.slots.length;l++){var t=e.slots[l],r=t.getAttachment();if(r&&q<p.attachments.length){var y=
p.attachments[q],z;for(z in y)if(r==y[z]){r=this.getAttachment(q,z);null!=r&&t.setAttachment(r);break}}q++}};return k}();b.Skin=h})(spine||(spine={}));
(function(b){var h=function(){function k(e,p){this.attachmentVertices=[];if(null==e)throw Error("data cannot be null.");if(null==p)throw Error("bone cannot be null.");this.data=e;this.bone=p;this.color=new b.Color;this.setToSetupPose()}k.prototype.getAttachment=function(){return this.attachment};k.prototype.setAttachment=function(e){this.attachment!=e&&(this.attachment=e,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)};k.prototype.setAttachmentTime=function(e){this.attachmentTime=
this.bone.skeleton.time-e};k.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime};k.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color);null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))};return k}();b.Slot=h})(spine||(spine={}));
(function(b){var h=function(){return function(k,e,p){this.color=new b.Color(1,1,1,1);if(0>k)throw Error("index must be >= 0.");if(null==e)throw Error("name cannot be null.");if(null==p)throw Error("boneData cannot be null.");this.index=k;this.name=e;this.boneData=p}}();b.SlotData=h})(spine||(spine={}));
(function(b){var h=function(){function p(q){this._image=q}p.prototype.getImage=function(){return this._image};p.filterFromString=function(q){switch(q.toLowerCase()){case "nearest":return k.Nearest;case "linear":return k.Linear;case "mipmap":return k.MipMap;case "mipmapnearestnearest":return k.MipMapNearestNearest;case "mipmaplinearnearest":return k.MipMapLinearNearest;case "mipmapnearestlinear":return k.MipMapNearestLinear;case "mipmaplinearlinear":return k.MipMapLinearLinear;default:throw Error("Unknown texture filter "+
q);}};p.wrapFromString=function(q){switch(q.toLowerCase()){case "mirroredtepeat":return e.MirroredRepeat;case "clamptoedge":return e.ClampToEdge;case "repeat":return e.Repeat;default:throw Error("Unknown texture wrap "+q);}};return p}();b.Texture=h;(function(p){p[p.Nearest=9728]="Nearest";p[p.Linear=9729]="Linear";p[p.MipMap=9987]="MipMap";p[p.MipMapNearestNearest=9984]="MipMapNearestNearest";p[p.MipMapLinearNearest=9985]="MipMapLinearNearest";p[p.MipMapNearestLinear=9986]="MipMapNearestLinear";p[p.MipMapLinearLinear=
9987]="MipMapLinearLinear"})(b.TextureFilter||(b.TextureFilter={}));var k=b.TextureFilter;(function(p){p[p.MirroredRepeat=33648]="MirroredRepeat";p[p.ClampToEdge=33071]="ClampToEdge";p[p.Repeat=10497]="Repeat"})(b.TextureWrap||(b.TextureWrap={}));var e=b.TextureWrap;h=function(){return function(){this.height=this.width=this.v2=this.u2=this.v=this.u=0;this.rotate=!1;this.originalHeight=this.originalWidth=this.offsetY=this.offsetX=0}}();b.TextureRegion=h})(spine||(spine={}));
(function(b){var h=function(){function q(l,t){this.pages=[];this.regions=[];this.load(l,t)}q.prototype.load=function(l,t){if(null==t)throw Error("textureLoader cannot be null.");l=new k(l);for(var r=Array(4),y=null;;){var z=l.readLine();if(null==z)break;z=z.trim();if(0==z.length)y=null;else if(y){var E=new p;E.name=z;E.page=y;E.rotate="true"==l.readValue();l.readTuple(r);z=parseInt(r[0]);var B=parseInt(r[1]);l.readTuple(r);var F=parseInt(r[0]),I=parseInt(r[1]);E.u=z/y.width;E.v=B/y.height;E.rotate?
(E.u2=(z+I)/y.width,E.v2=(B+F)/y.height):(E.u2=(z+F)/y.width,E.v2=(B+I)/y.height);E.x=z;E.y=B;E.width=Math.abs(F);E.height=Math.abs(I);4==l.readTuple(r)&&4==l.readTuple(r)&&l.readTuple(r);E.originalWidth=parseInt(r[0]);E.originalHeight=parseInt(r[1]);l.readTuple(r);E.offsetX=parseInt(r[0]);E.offsetY=parseInt(r[1]);E.index=parseInt(l.readValue());E.texture=y.texture;this.regions.push(E)}else y=new e,y.name=z,2==l.readTuple(r)&&(y.width=parseInt(r[0]),y.height=parseInt(r[1]),l.readTuple(r)),l.readTuple(r),
y.minFilter=b.Texture.filterFromString(r[0]),y.magFilter=b.Texture.filterFromString(r[1]),E=l.readValue(),y.uWrap=b.TextureWrap.ClampToEdge,y.vWrap=b.TextureWrap.ClampToEdge,"x"==E?y.uWrap=b.TextureWrap.Repeat:"y"==E?y.vWrap=b.TextureWrap.Repeat:"xy"==E&&(y.uWrap=y.vWrap=b.TextureWrap.Repeat),y.texture=t(z),y.texture.setFilters(y.minFilter,y.magFilter),y.texture.setWraps(y.uWrap,y.vWrap),y.width=y.texture.getImage().width,y.height=y.texture.getImage().height,this.pages.push(y)}};q.prototype.findRegion=
function(l){for(var t=0;t<this.regions.length;t++)if(this.regions[t].name==l)return this.regions[t];return null};q.prototype.dispose=function(){for(var l=0;l<this.pages.length;l++)this.pages[l].texture.dispose()};return q}();b.TextureAtlas=h;var k=function(){function q(l){this.index=0;this.lines=l.split(/\r\n|\r|\n/)}q.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]};q.prototype.readValue=function(){var l=this.readLine(),t=l.indexOf(":");if(-1==t)throw Error("Invalid line: "+
l);return l.substring(t+1).trim()};q.prototype.readTuple=function(l){var t=this.readLine(),r=t.indexOf(":");if(-1==r)throw Error("Invalid line: "+t);var y=0;for(r+=1;3>y;y++){var z=t.indexOf(",",r);if(-1==z)break;l[y]=t.substr(r,z-r).trim();r=z+1}l[y]=t.substring(r).trim();return y+1};return q}(),e=function(){return function(){}}();b.TextureAtlasPage=e;var p=function(q){function l(){q.apply(this,arguments)}__extends(l,q);return l}(b.TextureRegion);b.TextureAtlasRegion=p})(spine||(spine={}));
(function(b){var h=function(){function k(e,p){this.shearMix=this.scaleMix=this.translateMix=this.rotateMix=0;this.temp=new b.Vector2;if(null==e)throw Error("data cannot be null.");if(null==p)throw Error("skeleton cannot be null.");this.data=e;this.rotateMix=e.rotateMix;this.translateMix=e.translateMix;this.scaleMix=e.scaleMix;this.shearMix=e.shearMix;this.bones=[];for(var q=0;q<e.bones.length;q++)this.bones.push(p.findBone(e.bones[q].name));this.target=p.findBone(e.target.name)}k.prototype.apply=
function(){this.update()};k.prototype.update=function(){var e=this.rotateMix,p=this.translateMix,q=this.scaleMix,l=this.shearMix,t=this.target,r=t.a,y=t.b,z=t.c,E=t.d,B=0<r*E-y*z?b.MathUtils.degRad:-b.MathUtils.degRad,F=this.data.offsetRotation*B;B*=this.data.offsetShearY;for(var I=this.bones,L=0,U=I.length;L<U;L++){var n=I[L],w=!1;if(0!=e){var G=n.a;w=n.b;var f=n.c,m=n.d,v=Math.atan2(z,r)-Math.atan2(f,G)+F;v>b.MathUtils.PI?v-=b.MathUtils.PI2:v<-b.MathUtils.PI&&(v+=b.MathUtils.PI2);v*=e;var D=Math.cos(v);
v=Math.sin(v);n.a=D*G-v*f;n.b=D*w-v*m;n.c=v*G+D*f;n.d=v*w+D*m;w=!0}0!=p&&(w=this.temp,t.localToWorld(w.set(this.data.offsetX,this.data.offsetY)),n.worldX+=(w.x-n.worldX)*p,n.worldY+=(w.y-n.worldY)*p,w=!0);0<q&&(w=Math.sqrt(n.a*n.a+n.c*n.c),m=Math.sqrt(r*r+z*z),1E-5<w&&(w=(w+(m-w+this.data.offsetScaleX)*q)/w),n.a*=w,n.c*=w,w=Math.sqrt(n.b*n.b+n.d*n.d),m=Math.sqrt(y*y+E*E),1E-5<w&&(w=(w+(m-w+this.data.offsetScaleY)*q)/w),n.b*=w,n.d*=w,w=!0);0<l&&(w=n.b,m=n.d,G=Math.atan2(m,w),v=Math.atan2(E,y)-Math.atan2(z,
r)-(G-Math.atan2(n.c,n.a)),v>b.MathUtils.PI?v-=b.MathUtils.PI2:v<-b.MathUtils.PI&&(v+=b.MathUtils.PI2),v=G+(v+B)*l,w=Math.sqrt(w*w+m*m),n.b=Math.cos(v)*w,n.d=Math.sin(v)*w,w=!0);w&&(n.appliedValid=!1)}};k.prototype.getOrder=function(){return this.data.order};return k}();b.TransformConstraint=h})(spine||(spine={}));
(function(b){var h=function(){return function(k){this.order=0;this.bones=[];this.offsetShearY=this.offsetScaleY=this.offsetScaleX=this.offsetY=this.offsetX=this.offsetRotation=this.shearMix=this.scaleMix=this.translateMix=this.rotateMix=0;if(null==k)throw Error("name cannot be null.");this.name=k}}();b.TransformConstraintData=h})(spine||(spine={}));
(function(b){var h=function(){function k(){this.array=[]}k.prototype.add=function(e){var p=this.contains(e);this.array[e|0]=e|0;return!p};k.prototype.contains=function(e){return void 0!=this.array[e|0]};k.prototype.remove=function(e){this.array[e|0]=void 0};k.prototype.clear=function(){this.array.length=0};return k}();b.IntSet=h;h=function(){function k(e,p,q,l){void 0===e&&(e=0);void 0===p&&(p=0);void 0===q&&(q=0);void 0===l&&(l=0);this.r=e;this.g=p;this.b=q;this.a=l}k.prototype.set=function(e,p,
q,l){this.r=e;this.g=p;this.b=q;this.a=l;this.clamp();return this};k.prototype.setFromColor=function(e){this.r=e.r;this.g=e.g;this.b=e.b;this.a=e.a;return this};k.prototype.setFromString=function(e){e="#"==e.charAt(0)?e.substr(1):e;this.r=parseInt(e.substr(0,2),16)/255;this.g=parseInt(e.substr(2,2),16)/255;this.b=parseInt(e.substr(4,2),16)/255;this.a=(8!=e.length?255:parseInt(e.substr(6,2),16))/255;return this};k.prototype.add=function(e,p,q,l){this.r+=e;this.g+=p;this.b+=q;this.a+=l;this.clamp();
return this};k.prototype.clamp=function(){0>this.r?this.r=0:1<this.r&&(this.r=1);0>this.g?this.g=0:1<this.g&&(this.g=1);0>this.b?this.b=0:1<this.b&&(this.b=1);0>this.a?this.a=0:1<this.a&&(this.a=1);return this};k.WHITE=new k(1,1,1,1);k.RED=new k(1,0,0,1);k.GREEN=new k(0,1,0,1);k.BLUE=new k(0,0,1,1);k.MAGENTA=new k(1,0,1,1);return k}();b.Color=h;h=function(){function k(){}k.clamp=function(e,p,q){return e<p?p:e>q?q:e};k.cosDeg=function(e){return Math.cos(e*k.degRad)};k.sinDeg=function(e){return Math.sin(e*
k.degRad)};k.signum=function(e){return 0<e?1:0>e?-1:0};k.toInt=function(e){return 0<e?Math.floor(e):Math.ceil(e)};k.cbrt=function(e){var p=Math.pow(Math.abs(e),1/3);return 0>e?-p:p};k.PI=3.1415927;k.PI2=2*k.PI;k.radiansToDegrees=180/k.PI;k.radDeg=k.radiansToDegrees;k.degreesToRadians=k.PI/180;k.degRad=k.degreesToRadians;return k}();b.MathUtils=h;h=function(){function k(){}k.arrayCopy=function(e,p,q,l,t){for(var r=p;r<p+t;r++,l++)q[l]=e[r]};k.setArraySize=function(e,p,q){void 0===q&&(q=0);var l=e.length;
if(l==p)return e;e.length=p;if(l<p)for(;l<p;l++)e[l]=q;return e};k.ensureArrayCapacity=function(e,p,q){void 0===q&&(q=0);return e.length>=p?e:k.setArraySize(e,p,q)};k.newArray=function(e,p){for(var q=Array(e),l=0;l<e;l++)q[l]=p;return q};k.newFloatArray=function(e){if(k.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);e=Array(e);for(var p=0;p<e.length;p++)e[p]=0;return e};k.toFloatArray=function(e){return k.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e};k.SUPPORTS_TYPED_ARRAYS="undefined"!==typeof Float32Array;
return k}();b.Utils=h;h=function(){function k(){}k.logBones=function(e){for(var p=0;p<e.bones.length;p++){var q=e.bones[p];console.log(q.data.name+", "+q.a+", "+q.b+", "+q.c+", "+q.d+", "+q.worldX+", "+q.worldY)}};return k}();b.DebugUtils=h;h=function(){function k(e){this.items=[];this.instantiator=e}k.prototype.obtain=function(){return 0<this.items.length?this.items.pop():this.instantiator()};k.prototype.free=function(e){e.reset&&e.reset();this.items.push(e)};k.prototype.freeAll=function(e){for(var p=
0;p<e.length;p++)e[p].reset&&e[p].reset(),this.items[p]=e[p]};k.prototype.clear=function(){this.items.length=0};return k}();b.Pool=h;h=function(){function k(e,p){void 0===e&&(e=0);void 0===p&&(p=0);this.x=e;this.y=p}k.prototype.set=function(e,p){this.x=e;this.y=p;return this};k.prototype.length=function(){var e=this.x,p=this.y;return Math.sqrt(e*e+p*p)};k.prototype.normalize=function(){var e=this.length();0!=e&&(this.x/=e,this.y/=e);return this};return k}();b.Vector2=h;h=function(){function k(){this.maxDelta=
.064;this.totalTime=this.delta=this.framesPerSecond=0;this.lastTime=Date.now()/1E3;this.frameTime=this.frameCount=0}k.prototype.update=function(){var e=Date.now()/1E3;this.delta=e-this.lastTime;this.frameTime+=this.delta;this.totalTime+=this.delta;this.delta>this.maxDelta&&(this.delta=this.maxDelta);this.lastTime=e;this.frameCount++;1<this.frameTime&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameCount=this.frameTime=0)};return k}();b.TimeKeeper=h})(spine||(spine={}));
(function(b){(function(h){var k=function(e){function p(q){void 0===q&&(q="");e.call(this,function(l){return new h.ThreeJsTexture(l)},q)}__extends(p,e);return p}(b.AssetManager);h.AssetManager=k})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){(function(h){var k=function(){function e(p,q){void 0===q&&(q=10920);this.indicesLength=this.verticesLength=0;if(10920<q)throw Error("Can't have more than 10920 triangles per batch: "+q);var l=this.vertices=new Float32Array(q*e.VERTEX_SIZE);q=this.indices=new Uint16Array(3*q);this.mesh=p;var t=new THREE.BufferGeometry;l=this.vertexBuffer=new THREE.InterleavedBuffer(l,e.VERTEX_SIZE);l.dynamic=!0;t.addAttribute("position",new THREE.InterleavedBufferAttribute(l,3,0,!1));t.addAttribute("color",
new THREE.InterleavedBufferAttribute(l,4,3,!1));t.addAttribute("uv",new THREE.InterleavedBufferAttribute(l,2,7,!1));t.setIndex(new THREE.BufferAttribute(q,1));t.getIndex().dynamic=!0;t.drawRange.start=0;t.drawRange.count=0;p.geometry=t}e.prototype.begin=function(){this.indicesLength=this.verticesLength=0};e.prototype.batch=function(p,q,l){void 0===l&&(l=0);for(var t=this.verticesLength/e.VERTEX_SIZE,r=this.vertices,y=this.verticesLength,z=0;z<p.length;)r[y++]=p[z++],r[y++]=p[z++],r[y++]=l,r[y++]=
p[z++],r[y++]=p[z++],r[y++]=p[z++],r[y++]=p[z++],r[y++]=p[z++],r[y++]=p[z++];this.verticesLength=y;p=this.indices;y=this.indicesLength;for(z=0;z<q.length;y++,z++)p[y]=q[z]+t;this.indicesLength+=q.length};e.prototype.end=function(){this.vertexBuffer.needsUpdate=!0;this.vertexBuffer.updateRange.offset=0;this.vertexBuffer.updateRange.count=this.verticesLength;var p=this.mesh.geometry;p.getIndex().needsUpdate=!0;p.getIndex().updateRange.offset=0;p.getIndex().updateRange.count=this.indicesLength;p.drawRange.start=
0;p.drawRange.count=this.indicesLength};e.VERTEX_SIZE=9;return e}();h.MeshBatcher=k})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){(function(h){var k=function(e){function p(q){e.call(this);this.zOffset=.1;this.skeleton=new b.Skeleton(q);q=new b.AnimationStateData(q);this.state=new b.AnimationState(q);q=this.material=new THREE.MeshBasicMaterial;q.side=THREE.DoubleSide;q.transparent=!0;q.alphaTest=.5;this.batcher=new h.MeshBatcher(this)}__extends(p,e);p.prototype.update=function(q){var l=this.state,t=this.skeleton;l.update(q);l.apply(t);t.updateWorldTransform();this.updateGeometry()};p.prototype.updateGeometry=function(){var q=
this.skeleton.drawOrder,l=this.batcher;l.begin();for(var t=0,r=this.zOffset,y=0,z=q.length;y<z;y++){var E=q[y];var B=E.getAttachment();if(B instanceof b.RegionAttachment){var F=B;E=F.updateWorldVertices(E,!1);B=p.QUAD_TRIANGLES;F=F.region.renderObject.texture}else if(B instanceof b.MeshAttachment)F=B,E=F.updateWorldVertices(E,!1),B=F.triangles,F=F.region.renderObject.texture;else continue;if(null!=F){if(!this.material.map){var I=this.material;I.map=F.texture;I.needsUpdate=!0}this.batcher.batch(E,
B,t);t+=r}}l.end()};p.createMesh=function(q){var l=new THREE.BufferGeometry,t=new Float32Array(1024);t.set([-200,-200,1,0,0,1,0,0,200,-200,0,1,0,1,1,0,200,200,0,0,1,1,1,1,-200,200,1,1,0,.1,0,1],0);t=new THREE.InterleavedBuffer(t,8);var r=new THREE.InterleavedBufferAttribute(t,2,0,!1);l.addAttribute("position",r);r=new THREE.InterleavedBufferAttribute(t,4,2,!1);l.addAttribute("color",r);new THREE.InterleavedBufferAttribute(t,2,6,!1);l.addAttribute("uv",r);t=new Uint16Array(1024);t.set([0,1,2,2,3,0],
0);l.setIndex(new THREE.BufferAttribute(t,1));l.drawRange.start=0;l.drawRange.count=6;t=new THREE.MeshBasicMaterial;t.vertexColors=THREE.VertexColors;t.transparent=!0;t.map=q;return new THREE.Mesh(l,t)};p.QUAD_TRIANGLES=[0,1,2,2,3,0];return p}(THREE.Mesh);h.SkeletonMesh=k})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){(function(h){var k=function(e){function p(q){e.call(this,q);this.texture=new THREE.Texture(q);this.texture.flipY=!1;this.texture.needsUpdate=!0}__extends(p,e);p.prototype.setFilters=function(q,l){this.texture.minFilter=p.toThreeJsTextureFilter(q);this.texture.magFilter=p.toThreeJsTextureFilter(l)};p.prototype.setWraps=function(q,l){this.texture.wrapS=p.toThreeJsTextureWrap(q);this.texture.wrapT=p.toThreeJsTextureWrap(l)};p.prototype.dispose=function(){this.texture.dispose()};p.toThreeJsTextureFilter=
function(q){if(q===b.TextureFilter.Linear)return THREE.LinearFilter;if(q===b.TextureFilter.MipMap)return THREE.LinearMipMapLinearFilter;if(q===b.TextureFilter.MipMapLinearNearest)return THREE.LinearMipMapNearestFilter;if(q===b.TextureFilter.MipMapNearestLinear)return THREE.NearestMipMapLinearFilter;if(q===b.TextureFilter.MipMapNearestNearest)return THREE.NearestMipMapNearestFilter;if(q===b.TextureFilter.Nearest)return THREE.NearestFilter;throw Error("Unknown texture filter: "+q);};p.toThreeJsTextureWrap=
function(q){if(q===b.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(q===b.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(q===b.TextureWrap.Repeat)return THREE.RepeatWrapping;throw Error("Unknown texture wrap: "+q);};return p}(b.Texture);h.ThreeJsTexture=k})(b.threejs||(b.threejs={}))})(spine||(spine={}));
(function(b){function h(f){B.debug&&console.log("Graph created");this.list_of_graphcanvas=null;this.clear();f&&this.configure(f)}function k(f,m,v,D,C,J){this.id=f;this.type=m;this.origin_id=v;this.origin_slot=D;this.target_id=C;this.target_slot=J;this._data=null;this._pos=new Float32Array(2)}function e(f){this._ctor(f)}function p(f){this._ctor(f)}function q(f,m){this.offset=new Float32Array([0,0]);this.scale=1;this.max_scale=10;this.min_scale=.1;this.onredraw=null;this.enabled=!0;this.last_mouse=
[0,0];this.element=null;this.visible_area=new Float32Array(4);f&&(this.element=f,m||this.bindEvents(f))}function l(f,m,v){v=v||{};this.background_image=l.DEFAULT_BACKGROUND_IMAGE;f&&f.constructor===String&&(f=document.querySelector(f));this.ds=new q;this.zoom_modify_alpha=!0;this.title_text_font=""+B.NODE_TEXT_SIZE+"px Arial";this.inner_text_font="normal "+B.NODE_SUBTEXT_SIZE+"px Arial";this.node_title_color=B.NODE_TITLE_COLOR;this.default_link_color=B.LINK_COLOR;this.default_connection_color={input_off:"#778",
input_on:"#7F7",output_off:"#778",output_on:"#7F7"};this.highquality_render=!0;this.use_gradients=!1;this.editor_alpha=1;this.pause_rendering=!1;this.clear_background=!0;this.read_only=!1;this.render_only_selected=!0;this.live_mode=!1;this.allow_searchbox=this.allow_interaction=this.allow_dragnodes=this.allow_dragcanvas=this.show_info=!0;this.drag_mode=this.allow_reconnect_links=!1;this.filter=this.dragging_rectangle=null;this.set_canvas_dirty_on_mouse_event=!0;this.always_render_background=!1;this.render_canvas_border=
this.render_shadows=!0;this.render_connections_shadows=!1;this.render_connections_border=!0;this.render_connection_arrows=this.render_curved_connections=!1;this.render_collapsed_slots=!0;this.render_execution_order=!1;this.render_link_tooltip=this.render_title_colored=!0;this.links_render_mode=B.SPLINE_LINK;this.mouse=[0,0];this.canvas_mouse=this.graph_mouse=[0,0];this.onAfterChange=this.onBeforeChange=this.onConnectingChange=this.onSelectionChange=this.onNodeMoved=this.onDrawLinkTooltip=this.onDrawOverlay=
this.onDrawForeground=this.onDrawBackground=this.onMouse=this.onSearchBoxSelection=this.onSearchBox=null;this.connections_width=3;this.round_radius=8;this.over_link_center=this.node_widget=this.current_node=null;this.last_mouse_position=[0,0];this.visible_area=this.ds.visible_area;this.visible_links=[];m&&m.attachCanvas(this);this.setCanvas(f);this.clear();v.skip_render||this.startRendering();this.autoresize=v.autoresize}function t(f,m){return Math.sqrt((m[0]-f[0])*(m[0]-f[0])+(m[1]-f[1])*(m[1]-f[1]))}
function r(f,m,v,D,C,J){return v<f&&v+C>f&&D<m&&D+J>m?!0:!1}function y(f,m){var v=f[0]+f[2],D=f[1]+f[3],C=m[1]+m[3];return f[0]>m[0]+m[2]||f[1]>C||v<m[0]||D<m[1]?!1:!0}function z(f,m){function v(T){var W=parseInt(J.style.top);J.style.top=(W+T.deltaY*m.scroll_speed).toFixed()+"px";T.preventDefault();return!0}this.options=m=m||{};var D=this;m.parentMenu&&(m.parentMenu.constructor!==this.constructor?(console.error("parentMenu must be of class ContextMenu, ignoring it"),m.parentMenu=null):(this.parentMenu=
m.parentMenu,this.parentMenu.lock=!0,this.parentMenu.current_submenu=this));var C=null;m.event&&(C=m.event.constructor.name);"MouseEvent"!==C&&"CustomEvent"!==C&&"PointerEvent"!==C&&(console.error("Event passed to ContextMenu is not of type MouseEvent or CustomEvent. Ignoring it."),m.event=null);var J=document.createElement("div");J.className="litegraph litecontextmenu litemenubar-panel";m.className&&(J.className+=" "+m.className);J.style.minWidth=100;J.style.minHeight=100;J.style.pointerEvents="none";
setTimeout(function(){J.style.pointerEvents="auto"},100);J.addEventListener("mouseup",function(T){T.preventDefault();return!0},!0);J.addEventListener("contextmenu",function(T){if(2!=T.button)return!1;T.preventDefault();return!1},!0);J.addEventListener("mousedown",function(T){if(2==T.button)return D.close(),T.preventDefault(),!0},!0);m.scroll_speed||(m.scroll_speed=.1);J.addEventListener("wheel",v,!0);J.addEventListener("mousewheel",v,!0);this.root=J;m.title&&(C=document.createElement("div"),C.className=
"litemenu-title",C.innerHTML=m.title,J.appendChild(C));for(var N=C=0;N<f.length;N++){var S=f.constructor==Array?f[N]:N;null!=S&&S.constructor!==String&&(S=void 0===S.content?String(S):S.content);this.addItem(S,f[N],m);C++}J.addEventListener("mouseleave",function(T){D.lock||(J.closing_timer&&clearTimeout(J.closing_timer),J.closing_timer=setTimeout(D.close.bind(D,T),500))});J.addEventListener("mouseenter",function(T){J.closing_timer&&clearTimeout(J.closing_timer)});f=document;m.event&&(f=m.event.target.ownerDocument);
f||(f=document);f.fullscreenElement?f.fullscreenElement.appendChild(J):f.body.appendChild(J);C=m.left||0;f=m.top||0;m.event&&(C=m.event.clientX-10,f=m.event.clientY-10,m.title&&(f-=20),m.parentMenu&&(C=m.parentMenu.root.getBoundingClientRect(),C=C.left+C.width),N=document.body.getBoundingClientRect(),S=J.getBoundingClientRect(),0==N.height&&console.error("document.body height is 0. That is dangerous, set html,body { height: 100%; }"),N.width&&C>N.width-S.width-10&&(C=N.width-S.width-10),N.height&&
f>N.height-S.height-10&&(f=N.height-S.height-10));J.style.left=C+"px";J.style.top=f+"px";m.scale&&(J.style.transform="scale("+m.scale+")")}function E(f){this.points=f;this.nearest=this.selected=-1;this.size=null;this.must_update=!0;this.margin=5}var B=b.LiteGraph={VERSION:.4,CANVAS_GRID_SIZE:10,NODE_TITLE_HEIGHT:30,NODE_TITLE_TEXT_Y:20,NODE_SLOT_HEIGHT:20,NODE_WIDGET_HEIGHT:20,NODE_WIDTH:140,NODE_MIN_WIDTH:50,NODE_COLLAPSED_RADIUS:10,NODE_COLLAPSED_WIDTH:80,NODE_TITLE_COLOR:"#999",NODE_TEXT_SIZE:14,
NODE_TEXT_COLOR:"#AAA",NODE_SUBTEXT_SIZE:12,NODE_DEFAULT_COLOR:"#333",NODE_DEFAULT_BGCOLOR:"#353535",NODE_DEFAULT_BOXCOLOR:"#666",NODE_DEFAULT_SHAPE:"box",DEFAULT_SHADOW_COLOR:"rgba(0,0,0,0.5)",DEFAULT_GROUP_FONT:24,WIDGET_BGCOLOR:"#222",WIDGET_OUTLINE_COLOR:"#666",WIDGET_TEXT_COLOR:"#DDD",WIDGET_SECONDARY_TEXT_COLOR:"#999",LINK_COLOR:"#9A9",EVENT_LINK_COLOR:"#A86",CONNECTING_LINK_COLOR:"#AFA",MAX_NUMBER_OF_NODES:1E3,DEFAULT_POSITION:[100,100],VALID_SHAPES:["default","box","round","card"],BOX_SHAPE:1,
ROUND_SHAPE:2,CIRCLE_SHAPE:3,CARD_SHAPE:4,ARROW_SHAPE:5,INPUT:1,OUTPUT:2,EVENT:-1,ACTION:-1,ALWAYS:0,ON_EVENT:1,NEVER:2,ON_TRIGGER:3,UP:1,DOWN:2,LEFT:3,RIGHT:4,CENTER:5,STRAIGHT_LINK:0,LINEAR_LINK:1,SPLINE_LINK:2,NORMAL_TITLE:0,NO_TITLE:1,TRANSPARENT_TITLE:2,AUTOHIDE_TITLE:3,proxy:null,node_images_path:"",debug:!1,catch_exceptions:!0,throw_errors:!0,allow_scripts:!1,registered_node_types:{},node_types_by_file_extension:{},Nodes:{},Globals:{},searchbox_extras:{},registerNodeType:function(f,m){if(!m.prototype)throw"Cannot register a simple object, it must be a class with a prototype";
m.type=f;B.debug&&console.log("Node registered: "+f);f.split("/");var v=m.name,D=f.lastIndexOf("/");m.category=f.substr(0,D);m.title||(m.title=v);if(m.prototype)for(var C in e.prototype)m.prototype[C]||(m.prototype[C]=e.prototype[C]);D=this.registered_node_types[f];if(!D&&(Object.hasOwnProperty(m.prototype,"shape")||Object.defineProperty(m.prototype,"shape",{set:function(N){switch(N){case "default":delete this._shape;break;case "box":this._shape=B.BOX_SHAPE;break;case "round":this._shape=B.ROUND_SHAPE;
break;case "circle":this._shape=B.CIRCLE_SHAPE;break;case "card":this._shape=B.CARD_SHAPE;break;default:this._shape=N}},get:function(N){return this._shape},enumerable:!0,configurable:!0}),m.prototype.onPropertyChange&&console.warn("LiteGraph node class "+f+" has onPropertyChange method, it must be called onPropertyChanged with d at the end"),m.supported_extensions))for(C in m.supported_extensions){var J=m.supported_extensions[C];J&&J.constructor===String&&(this.node_types_by_file_extension[J.toLowerCase()]=
m)}this.registered_node_types[f]=m;m.constructor.name&&(this.Nodes[v]=m);if(B.onNodeTypeRegistered)B.onNodeTypeRegistered(f,m);if(D&&B.onNodeTypeReplaced)B.onNodeTypeReplaced(f,m,D);m.prototype.onPropertyChange&&console.warn("LiteGraph node class "+f+" has onPropertyChange method, it must be called onPropertyChanged with d at the end");if(m.supported_extensions)for(C=0;C<m.supported_extensions.length;C++)(J=m.supported_extensions[C])&&J.constructor===String&&(this.node_types_by_file_extension[J.toLowerCase()]=
m)},unregisterNodeType:function(f){var m=f.constructor===String?this.registered_node_types[f]:f;if(!m)throw"node type not found: "+f;delete this.registered_node_types[m.type];m.constructor.name&&delete this.Nodes[m.constructor.name]},wrapFunctionAsNode:function(f,m,v,D,C){for(var J=Array(m.length),N="",S=B.getParameterNames(m),T=0;T<S.length;++T)N+="this.addInput('"+S[T]+"',"+(v&&v[T]?"'"+v[T]+"'":"0")+");\n";N+="this.addOutput('out',"+(D?"'"+D+"'":0)+");\n";C&&(N+="this.properties = "+JSON.stringify(C)+
";\n");v=Function(N);v.title=f.split("/").pop();v.desc="Generated from "+m.name;v.prototype.onExecute=function(){for(var W=0;W<J.length;++W)J[W]=this.getInputData(W);W=m.apply(this,J);this.setOutputData(0,W)};this.registerNodeType(f,v)},clearRegisteredTypes:function(){this.registered_node_types={};this.node_types_by_file_extension={};this.Nodes={};this.searchbox_extras={}},addNodeMethod:function(f,m){e.prototype[f]=m;for(var v in this.registered_node_types){var D=this.registered_node_types[v];D.prototype[f]&&
(D.prototype["_"+f]=D.prototype[f]);D.prototype[f]=m}},createNode:function(f,m,v){var D=this.registered_node_types[f];if(!D)return B.debug&&console.log('GraphNode type "'+f+'" not registered.'),null;m=m||D.title||f;var C=null;if(B.catch_exceptions)try{C=new D(m)}catch(N){return console.error(N),null}else C=new D(m);C.type=f;!C.title&&m&&(C.title=m);C.properties||(C.properties={});C.properties_info||(C.properties_info=[]);C.flags||(C.flags={});C.size||(C.size=C.computeSize());C.pos||(C.pos=B.DEFAULT_POSITION.concat());
C.mode||(C.mode=B.ALWAYS);if(v)for(var J in v)C[J]=v[J];return C},getNodeType:function(f){return this.registered_node_types[f]},getNodeTypesInCategory:function(f,m){var v=[],D;for(D in this.registered_node_types){var C=this.registered_node_types[D];C.filter==m&&(""==f?null==C.category&&v.push(C):C.category==f&&v.push(C))}return v},getNodeTypesCategories:function(f){var m={"":1},v;for(v in this.registered_node_types){var D=this.registered_node_types[v];D.category&&!D.skip_list&&D.filter==f&&(m[D.category]=
1)}f=[];for(v in m)f.push(v);return f},reloadNodes:function(f){for(var m=document.getElementsByTagName("script"),v=[],D=0;D<m.length;D++)v.push(m[D]);m=document.getElementsByTagName("head")[0];f=document.location.href+f;for(D=0;D<v.length;D++){var C=v[D].src;if(C&&C.substr(0,f.length)==f)try{B.debug&&console.log("Reloading: "+C);var J=document.createElement("script");J.type="text/javascript";J.src=C;m.appendChild(J);m.removeChild(v[D])}catch(N){if(B.throw_errors)throw N;B.debug&&console.log("Error while reloading "+
C)}}B.debug&&console.log("Nodes reloaded")},cloneObject:function(f,m){if(null==f)return null;f=JSON.parse(JSON.stringify(f));if(!m)return f;for(var v in f)m[v]=f[v];return m},isValidConnection:function(f,m){if(!f||!m||f==m||f==B.EVENT&&m==B.ACTION)return!0;f=String(f);m=String(m);f=f.toLowerCase();m=m.toLowerCase();if(-1==f.indexOf(",")&&-1==m.indexOf(","))return f==m;f=f.split(",");m=m.split(",");for(var v=0;v<f.length;++v)for(var D=0;D<m.length;++D)if(f[v]==m[D])return!0;return!1},registerSearchboxExtra:function(f,
m,v){this.searchbox_extras[m.toLowerCase()]={type:f,desc:m,data:v}},fetchFile:function(f,m,v,D){if(!f)return null;m=m||"text";if(f.constructor===String)return"http"==f.substr(0,4)&&B.proxy&&(f=B.proxy+f.substr(f.indexOf(":")+3)),fetch(f).then(function(J){if(!J.ok)throw Error("File not found");if("arraybuffer"==m)return J.arrayBuffer();if("text"==m||"string"==m)return J.text();if("json"==m)return J.json();if("blob"==m)return J.blob()}).then(function(J){v&&v(J)}).catch(function(J){console.error("error fetching file:",
f);D&&D(J)});if(f.constructor===File||f.constructor===Blob){var C=new FileReader;C.onload=function(J){J=J.target.result;"json"==m&&(J=JSON.parse(J));v&&v(J)};if("arraybuffer"==m)return C.readAsArrayBuffer(f);if("text"==m||"json"==m)return C.readAsText(f);if("blob"==m)return C.readAsBinaryString(f)}return null}};B.getTime="undefined"!=typeof performance?performance.now.bind(performance):"undefined"!=typeof Date&&Date.now?Date.now.bind(Date):"undefined"!=typeof process?function(){var f=process.hrtime();
return.001*f[0]+1E-6*f[1]}:function(){return(new Date).getTime()};b.LGraph=B.LGraph=h;h.supported_types=["number","string","boolean"];h.prototype.getSupportedTypes=function(){return this.supported_types||h.supported_types};h.STATUS_STOPPED=1;h.STATUS_RUNNING=2;h.prototype.clear=function(){this.stop();this.status=h.STATUS_STOPPED;this.last_link_id=this.last_node_id=0;this._version=-1;if(this._nodes)for(var f=0;f<this._nodes.length;++f){var m=this._nodes[f];if(m.onRemoved)m.onRemoved()}this._nodes=
[];this._nodes_by_id={};this._nodes_in_order=[];this._nodes_executable=null;this._groups=[];this.links={};this.iteration=0;this.config={};this.vars={};this.extra={};this.fixedtime=this.runningtime=this.globaltime=0;this.elapsed_time=this.fixedtime_lapse=.01;this.starttime=this.last_update_time=0;this.catch_errors=!0;this.inputs={};this.outputs={};this.change();this.sendActionToCanvas("clear")};h.prototype.attachCanvas=function(f){if(f.constructor!=l)throw"attachCanvas expects a LGraphCanvas instance";
f.graph&&f.graph!=this&&f.graph.detachCanvas(f);f.graph=this;this.list_of_graphcanvas||(this.list_of_graphcanvas=[]);this.list_of_graphcanvas.push(f)};h.prototype.detachCanvas=function(f){if(this.list_of_graphcanvas){var m=this.list_of_graphcanvas.indexOf(f);-1!=m&&(f.graph=null,this.list_of_graphcanvas.splice(m,1))}};h.prototype.start=function(f){if(this.status!=h.STATUS_RUNNING){this.status=h.STATUS_RUNNING;if(this.onPlayEvent)this.onPlayEvent();this.sendEventToAllNodes("onStart");this.last_update_time=
this.starttime=B.getTime();f=f||0;var m=this;if(0==f&&"undefined"!=typeof window&&window.requestAnimationFrame){var v=function(){if(-1==m.execution_timer_id){window.requestAnimationFrame(v);if(m.onBeforeStep)m.onBeforeStep();m.runStep(1,!m.catch_errors);if(m.onAfterStep)m.onAfterStep()}};this.execution_timer_id=-1;v()}else this.execution_timer_id=setInterval(function(){if(m.onBeforeStep)m.onBeforeStep();m.runStep(1,!m.catch_errors);if(m.onAfterStep)m.onAfterStep()},f)}};h.prototype.stop=function(){if(this.status!=
h.STATUS_STOPPED){this.status=h.STATUS_STOPPED;if(this.onStopEvent)this.onStopEvent();null!=this.execution_timer_id&&(-1!=this.execution_timer_id&&clearInterval(this.execution_timer_id),this.execution_timer_id=null);this.sendEventToAllNodes("onStop")}};h.prototype.runStep=function(f,m,v){f=f||1;var D=B.getTime();this.globaltime=.001*(D-this.starttime);var C=this._nodes_executable?this._nodes_executable:this._nodes;if(C){v=v||C.length;if(m){for(var J=0;J<f;J++){for(var N=0;N<v;++N){var S=C[N];if(S.mode==
B.ALWAYS&&S.onExecute)S.onExecute()}this.fixedtime+=this.fixedtime_lapse;if(this.onExecuteStep)this.onExecuteStep()}if(this.onAfterExecute)this.onAfterExecute()}else try{for(J=0;J<f;J++){for(N=0;N<v;++N)if(S=C[N],S.mode==B.ALWAYS&&S.onExecute)S.onExecute();this.fixedtime+=this.fixedtime_lapse;if(this.onExecuteStep)this.onExecuteStep()}if(this.onAfterExecute)this.onAfterExecute();this.errors_in_execution=!1}catch(T){this.errors_in_execution=!0;if(B.throw_errors)throw T;B.debug&&console.log("Error during execution: "+
T);this.stop()}f=B.getTime();D=f-D;0==D&&(D=1);this.execution_time=.001*D;this.globaltime+=.001*D;this.iteration+=1;this.elapsed_time=.001*(f-this.last_update_time);this.last_update_time=f}};h.prototype.updateExecutionOrder=function(){this._nodes_in_order=this.computeExecutionOrder(!1);this._nodes_executable=[];for(var f=0;f<this._nodes_in_order.length;++f)this._nodes_in_order[f].onExecute&&this._nodes_executable.push(this._nodes_in_order[f])};h.prototype.computeExecutionOrder=function(f,m){for(var v=
[],D=[],C={},J={},N={},S=0,T=this._nodes.length;S<T;++S){var W=this._nodes[S];if(!f||W.onExecute){C[W.id]=W;var Y=0;if(W.inputs)for(var V=0,ma=W.inputs.length;V<ma;V++)W.inputs[V]&&null!=W.inputs[V].link&&(Y+=1);0==Y?(D.push(W),m&&(W._level=1)):(m&&(W._level=0),N[W.id]=Y)}}for(;0!=D.length;)if(W=D.shift(),v.push(W),delete C[W.id],W.outputs)for(S=0;S<W.outputs.length;S++)if(f=W.outputs[S],null!=f&&null!=f.links&&0!=f.links.length)for(V=0;V<f.links.length;V++)(T=this.links[f.links[V]])&&!J[T.id]&&(Y=
this.getNodeById(T.target_id),null==Y?J[T.id]=!0:(m&&(!Y._level||Y._level<=W._level)&&(Y._level=W._level+1),J[T.id]=!0,--N[Y.id],0==N[Y.id]&&D.push(Y)));for(S in C)v.push(C[S]);v.length!=this._nodes.length&&B.debug&&console.warn("something went wrong, nodes missing");T=v.length;for(S=0;S<T;++S)v[S].order=S;v=v.sort(function(ha,ia){var aa=ha.constructor.priority||ha.priority||0,ea=ia.constructor.priority||ia.priority||0;return aa==ea?ha.order-ia.order:aa-ea});for(S=0;S<T;++S)v[S].order=S;return v};
h.prototype.getAncestors=function(f){for(var m=[],v=[f],D={};v.length;){var C=v.shift();if(C.inputs){D[C.id]||C==f||(D[C.id]=!0,m.push(C));for(var J=0;J<C.inputs.length;++J){var N=C.getInputNode(J);N&&-1==m.indexOf(N)&&v.push(N)}}}m.sort(function(S,T){return S.order-T.order});return m};h.prototype.arrange=function(f){f=f||100;for(var m=this.computeExecutionOrder(!1,!0),v=[],D=0;D<m.length;++D){var C=m[D],J=C._level||1;v[J]||(v[J]=[]);v[J].push(C)}m=f;for(D=0;D<v.length;++D)if(J=v[D]){for(var N=100,
S=f+B.NODE_TITLE_HEIGHT,T=0;T<J.length;++T)C=J[T],C.pos[0]=m,C.pos[1]=S,C.size[0]>N&&(N=C.size[0]),S+=C.size[1]+f+B.NODE_TITLE_HEIGHT;m+=N+f}this.setDirtyCanvas(!0,!0)};h.prototype.getTime=function(){return this.globaltime};h.prototype.getFixedTime=function(){return this.fixedtime};h.prototype.getElapsedTime=function(){return this.elapsed_time};h.prototype.sendEventToAllNodes=function(f,m,v){v=v||B.ALWAYS;var D=this._nodes_in_order?this._nodes_in_order:this._nodes;if(D)for(var C=0,J=D.length;C<J;++C){var N=
D[C];if(N.constructor===B.Subgraph&&"onExecute"!=f)N.mode==v&&N.sendEventToAllNodes(f,m,v);else if(N[f]&&N.mode==v)if(void 0===m)N[f]();else if(m&&m.constructor===Array)N[f].apply(N,m);else N[f](m)}};h.prototype.sendActionToCanvas=function(f,m){if(this.list_of_graphcanvas)for(var v=0;v<this.list_of_graphcanvas.length;++v){var D=this.list_of_graphcanvas[v];D[f]&&D[f].apply(D,m)}};h.prototype.add=function(f,m){if(f)if(f.constructor===p)this._groups.push(f),this.setDirtyCanvas(!0),this.change(),f.graph=
this,this._version++;else{-1!=f.id&&null!=this._nodes_by_id[f.id]&&(console.warn("LiteGraph: there is already a node with this ID, changing it"),f.id=++this.last_node_id);if(this._nodes.length>=B.MAX_NUMBER_OF_NODES)throw"LiteGraph: max number of nodes in a graph reached";null==f.id||-1==f.id?f.id=++this.last_node_id:this.last_node_id<f.id&&(this.last_node_id=f.id);f.graph=this;this._version++;this._nodes.push(f);this._nodes_by_id[f.id]=f;if(f.onAdded)f.onAdded(this);this.config.align_to_grid&&f.alignToGrid();
m||this.updateExecutionOrder();if(this.onNodeAdded)this.onNodeAdded(f);this.setDirtyCanvas(!0);this.change();return f}};h.prototype.remove=function(f){if(f.constructor===B.LGraphGroup){var m=this._groups.indexOf(f);-1!=m&&this._groups.splice(m,1);f.graph=null;this._version++;this.setDirtyCanvas(!0,!0);this.change()}else if(null!=this._nodes_by_id[f.id]&&!f.ignore_remove){if(f.inputs)for(m=0;m<f.inputs.length;m++){var v=f.inputs[m];null!=v.link&&f.disconnectInput(m)}if(f.outputs)for(m=0;m<f.outputs.length;m++)v=
f.outputs[m],null!=v.links&&v.links.length&&f.disconnectOutput(m);if(f.onRemoved)f.onRemoved();f.graph=null;this._version++;if(this.list_of_graphcanvas)for(m=0;m<this.list_of_graphcanvas.length;++m)v=this.list_of_graphcanvas[m],v.selected_nodes[f.id]&&delete v.selected_nodes[f.id],v.node_dragged==f&&(v.node_dragged=null);m=this._nodes.indexOf(f);-1!=m&&this._nodes.splice(m,1);delete this._nodes_by_id[f.id];if(this.onNodeRemoved)this.onNodeRemoved(f);this.sendActionToCanvas("checkPanels");this.setDirtyCanvas(!0,
!0);this.change();this.updateExecutionOrder()}};h.prototype.getNodeById=function(f){return null==f?null:this._nodes_by_id[f]};h.prototype.findNodesByClass=function(f,m){m=m||[];for(var v=m.length=0,D=this._nodes.length;v<D;++v)this._nodes[v].constructor===f&&m.push(this._nodes[v]);return m};h.prototype.findNodesByType=function(f,m){f=f.toLowerCase();m=m||[];for(var v=m.length=0,D=this._nodes.length;v<D;++v)this._nodes[v].type.toLowerCase()==f&&m.push(this._nodes[v]);return m};h.prototype.findNodeByTitle=
function(f){for(var m=0,v=this._nodes.length;m<v;++m)if(this._nodes[m].title==f)return this._nodes[m];return null};h.prototype.findNodesByTitle=function(f){for(var m=[],v=0,D=this._nodes.length;v<D;++v)this._nodes[v].title==f&&m.push(this._nodes[v]);return m};h.prototype.getNodeOnPos=function(f,m,v,D){v=v||this._nodes;for(var C=v.length-1;0<=C;C--){var J=v[C];if(J.isPointInside(f,m,D))return J}return null};h.prototype.getGroupOnPos=function(f,m){for(var v=this._groups.length-1;0<=v;v--){var D=this._groups[v];
if(D.isPointInside(f,m,2,!0))return D}return null};h.prototype.checkNodeTypes=function(){for(var f=0;f<this._nodes.length;f++){var m=this._nodes[f];if(m.constructor!=B.registered_node_types[m.type]){console.log("node being replaced by newer version: "+m.type);var v=B.createNode(m.type);this._nodes[f]=v;v.configure(m.serialize());v.graph=this;this._nodes_by_id[v.id]=v;m.inputs&&(v.inputs=m.inputs.concat());m.outputs&&(v.outputs=m.outputs.concat())}}this.updateExecutionOrder()};h.prototype.onAction=
function(f,m){this._input_nodes=this.findNodesByClass(B.GraphInput,this._input_nodes);for(var v=0;v<this._input_nodes.length;++v){var D=this._input_nodes[v];if(D.properties.name==f){D.onAction(f,m);break}}};h.prototype.trigger=function(f,m){if(this.onTrigger)this.onTrigger(f,m)};h.prototype.addInput=function(f,m,v){if(!this.inputs[f]){this.beforeChange();this.inputs[f]={name:f,type:m,value:v};this._version++;this.afterChange();if(this.onInputAdded)this.onInputAdded(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()}};
h.prototype.setInputData=function(f,m){if(f=this.inputs[f])f.value=m};h.prototype.getInputData=function(f){return(f=this.inputs[f])?f.value:null};h.prototype.renameInput=function(f,m){if(m!=f){if(!this.inputs[f])return!1;if(this.inputs[m])return console.error("there is already one input with that name"),!1;this.inputs[m]=this.inputs[f];delete this.inputs[f];this._version++;if(this.onInputRenamed)this.onInputRenamed(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()}};h.prototype.changeInputType=
function(f,m){if(!this.inputs[f])return!1;if(!this.inputs[f].type||String(this.inputs[f].type).toLowerCase()!=String(m).toLowerCase())if(this.inputs[f].type=m,this._version++,this.onInputTypeChanged)this.onInputTypeChanged(f,m)};h.prototype.removeInput=function(f){if(!this.inputs[f])return!1;delete this.inputs[f];this._version++;if(this.onInputRemoved)this.onInputRemoved(f);if(this.onInputsOutputsChange)this.onInputsOutputsChange();return!0};h.prototype.addOutput=function(f,m,v){this.outputs[f]={name:f,
type:m,value:v};this._version++;if(this.onOutputAdded)this.onOutputAdded(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()};h.prototype.setOutputData=function(f,m){if(f=this.outputs[f])f.value=m};h.prototype.getOutputData=function(f){return(f=this.outputs[f])?f.value:null};h.prototype.renameOutput=function(f,m){if(!this.outputs[f])return!1;if(this.outputs[m])return console.error("there is already one output with that name"),!1;this.outputs[m]=this.outputs[f];delete this.outputs[f];this._version++;
if(this.onOutputRenamed)this.onOutputRenamed(f,m);if(this.onInputsOutputsChange)this.onInputsOutputsChange()};h.prototype.changeOutputType=function(f,m){if(!this.outputs[f])return!1;if(!this.outputs[f].type||String(this.outputs[f].type).toLowerCase()!=String(m).toLowerCase())if(this.outputs[f].type=m,this._version++,this.onOutputTypeChanged)this.onOutputTypeChanged(f,m)};h.prototype.removeOutput=function(f){if(!this.outputs[f])return!1;delete this.outputs[f];this._version++;if(this.onOutputRemoved)this.onOutputRemoved(f);
if(this.onInputsOutputsChange)this.onInputsOutputsChange();return!0};h.prototype.triggerInput=function(f,m){f=this.findNodesByTitle(f);for(var v=0;v<f.length;++v)f[v].onTrigger(m)};h.prototype.setCallback=function(f,m){f=this.findNodesByTitle(f);for(var v=0;v<f.length;++v)f[v].setTrigger(m)};h.prototype.beforeChange=function(f){if(this.onBeforeChange)this.onBeforeChange(this,f);this.sendActionToCanvas("onBeforeChange",this)};h.prototype.afterChange=function(f){if(this.onAfterChange)this.onAfterChange(this,
f);this.sendActionToCanvas("onAfterChange",this)};h.prototype.connectionChange=function(f,m){this.updateExecutionOrder();if(this.onConnectionChange)this.onConnectionChange(f);this._version++;this.sendActionToCanvas("onConnectionChange")};h.prototype.isLive=function(){if(!this.list_of_graphcanvas)return!1;for(var f=0;f<this.list_of_graphcanvas.length;++f)if(this.list_of_graphcanvas[f].live_mode)return!0;return!1};h.prototype.clearTriggeredSlots=function(){for(var f in this.links){var m=this.links[f];
m&&m._last_time&&(m._last_time=0)}};h.prototype.change=function(){B.debug&&console.log("Graph changed");this.sendActionToCanvas("setDirty",[!0,!0]);if(this.on_change)this.on_change(this)};h.prototype.setDirtyCanvas=function(f,m){this.sendActionToCanvas("setDirty",[f,m])};h.prototype.removeLink=function(f){if(f=this.links[f]){var m=this.getNodeById(f.target_id);m&&m.disconnectInput(f.target_slot)}};h.prototype.serialize=function(){for(var f=[],m=0,v=this._nodes.length;m<v;++m)f.push(this._nodes[m].serialize());
v=[];for(m in this.links){var D=this.links[m];if(!D.serialize){console.warn("weird LLink bug, link info is not a LLink but a regular object");var C=new k;for(J in D)C[J]=D[J];D=this.links[m]=C}v.push(D.serialize())}var J=[];for(m=0;m<this._groups.length;++m)J.push(this._groups[m].serialize());f={last_node_id:this.last_node_id,last_link_id:this.last_link_id,nodes:f,links:v,groups:J,config:this.config,extra:this.extra,version:B.VERSION};if(this.onSerialize)this.onSerialize(f);return f};h.prototype.configure=
function(f,m){if(f){m||this.clear();m=f.nodes;if(f.links&&f.links.constructor===Array){for(var v=[],D=0;D<f.links.length;++D){var C=f.links[D];if(C){var J=new k;J.configure(C);v[J.id]=J}else console.warn("serialized graph link data contains errors, skipping.")}f.links=v}for(D in f)"nodes"!=D&&"groups"!=D&&(this[D]=f[D]);v=!1;this._nodes=[];if(m){D=0;for(C=m.length;D<C;++D){J=m[D];var N=B.createNode(J.type,J.title);N||(B.debug&&console.log("Node not found or has errors: "+J.type),N=new e,N.last_serialization=
J,v=N.has_errors=!0);N.id=J.id;this.add(N,!0)}D=0;for(C=m.length;D<C;++D)J=m[D],(N=this.getNodeById(J.id))&&N.configure(J)}this._groups.length=0;if(f.groups)for(D=0;D<f.groups.length;++D)m=new B.LGraphGroup,m.configure(f.groups[D]),this.add(m);this.updateExecutionOrder();this.extra=f.extra||{};if(this.onConfigure)this.onConfigure(f);this._version++;this.setDirtyCanvas(!0,!0);return v}};h.prototype.load=function(f){var m=this,v=new XMLHttpRequest;v.open("GET",f,!0);v.send(null);v.onload=function(D){200!==
v.status?console.error("Error loading graph:",v.status,v.response):(D=JSON.parse(v.response),m.configure(D))};v.onerror=function(D){console.error("Error loading graph:",D)}};h.prototype.onNodeTrace=function(f,m,v){};k.prototype.configure=function(f){f.constructor===Array?(this.id=f[0],this.origin_id=f[1],this.origin_slot=f[2],this.target_id=f[3],this.target_slot=f[4],this.type=f[5]):(this.id=f.id,this.type=f.type,this.origin_id=f.origin_id,this.origin_slot=f.origin_slot,this.target_id=f.target_id,
this.target_slot=f.target_slot)};k.prototype.serialize=function(){return[this.id,this.origin_id,this.origin_slot,this.target_id,this.target_slot,this.type]};B.LLink=k;b.LGraphNode=B.LGraphNode=e;e.prototype._ctor=function(f){this.title=f||"Unnamed";this.size=[B.NODE_WIDTH,60];this.graph=null;this._pos=new Float32Array(10,10);Object.defineProperty(this,"pos",{set:function(m){!m||2>m.length||(this._pos[0]=m[0],this._pos[1]=m[1])},get:function(){return this._pos},enumerable:!0});this.id=-1;this.type=
null;this.inputs=[];this.outputs=[];this.connections=[];this.properties={};this.properties_info=[];this.flags={}};e.prototype.configure=function(f){this.graph&&this.graph._version++;for(var m in f)if("properties"==m)for(var v in f.properties){if(this.properties[v]=f.properties[v],this.onPropertyChanged)this.onPropertyChanged(v,f.properties[v])}else null!=f[m]&&("object"==typeof f[m]?this[m]&&this[m].configure?this[m].configure(f[m]):this[m]=B.cloneObject(f[m],this[m]):this[m]=f[m]);f.title||(this.title=
this.constructor.title);if(this.onConnectionsChange){if(this.inputs)for(v=0;v<this.inputs.length;++v){m=this.inputs[v];var D=this.graph?this.graph.links[m.link]:null;this.onConnectionsChange(B.INPUT,v,!0,D,m)}if(this.outputs)for(v=0;v<this.outputs.length;++v){var C=this.outputs[v];if(C.links)for(m=0;m<C.links.length;++m)D=this.graph?this.graph.links[C.links[m]]:null,this.onConnectionsChange(B.OUTPUT,v,!0,D,C)}}if(this.widgets){for(v=0;v<this.widgets.length;++v)(m=this.widgets[v])&&m.options&&m.options.property&&
this.properties[m.options.property]&&(m.value=JSON.parse(JSON.stringify(this.properties[m.options.property])));if(f.widgets_values)for(v=0;v<f.widgets_values.length;++v)this.widgets[v]&&(this.widgets[v].value=f.widgets_values[v])}if(this.onConfigure)this.onConfigure(f)};e.prototype.serialize=function(){var f={id:this.id,type:this.type,pos:this.pos,size:this.size,flags:B.cloneObject(this.flags),order:this.order,mode:this.mode};if(this.constructor===e&&this.last_serialization)return this.last_serialization;
this.inputs&&(f.inputs=this.inputs);if(this.outputs){for(var m=0;m<this.outputs.length;m++)delete this.outputs[m]._data;f.outputs=this.outputs}this.title&&this.title!=this.constructor.title&&(f.title=this.title);this.properties&&(f.properties=B.cloneObject(this.properties));if(this.widgets&&this.serialize_widgets)for(f.widgets_values=[],m=0;m<this.widgets.length;++m)f.widgets_values[m]=this.widgets[m]?this.widgets[m].value:null;f.type||(f.type=this.constructor.type);this.color&&(f.color=this.color);
this.bgcolor&&(f.bgcolor=this.bgcolor);this.boxcolor&&(f.boxcolor=this.boxcolor);this.shape&&(f.shape=this.shape);this.onSerialize&&this.onSerialize(f)&&console.warn("node onSerialize shouldnt return anything, data should be stored in the object pass in the first parameter");return f};e.prototype.clone=function(){var f=B.createNode(this.type);if(!f)return null;var m=B.cloneObject(this.serialize());if(m.inputs)for(var v=0;v<m.inputs.length;++v)m.inputs[v].link=null;if(m.outputs)for(v=0;v<m.outputs.length;++v)m.outputs[v].links&&
(m.outputs[v].links.length=0);delete m.id;f.configure(m);return f};e.prototype.toString=function(){return JSON.stringify(this.serialize())};e.prototype.getTitle=function(){return this.title||this.constructor.title};e.prototype.setProperty=function(f,m){this.properties||(this.properties={});if(m!==this.properties[f]){var v=this.properties[f];this.properties[f]=m;this.onPropertyChanged&&!1===this.onPropertyChanged(f,m,v)&&(this.properties[f]=v);if(this.widgets)for(v=0;v<this.widgets.length;++v){var D=
this.widgets[v];if(D&&D.options.property==f){D.value=m;break}}}};e.prototype.setOutputData=function(f,m){if(this.outputs&&!(-1==f||f>=this.outputs.length)){var v=this.outputs[f];if(v&&(v._data=m,this.outputs[f].links))for(v=0;v<this.outputs[f].links.length;v++){var D=this.graph.links[this.outputs[f].links[v]];D&&(D.data=m)}}};e.prototype.setOutputDataType=function(f,m){if(this.outputs&&!(-1==f||f>=this.outputs.length)){var v=this.outputs[f];if(v&&(v.type=m,this.outputs[f].links))for(v=0;v<this.outputs[f].links.length;v++)this.graph.links[this.outputs[f].links[v]].type=
m}};e.prototype.getInputData=function(f,m){if(this.inputs&&!(f>=this.inputs.length||null==this.inputs[f].link)){f=this.graph.links[this.inputs[f].link];if(!f)return null;if(!m)return f.data;m=this.graph.getNodeById(f.origin_id);if(!m)return f.data;if(m.updateOutputData)m.updateOutputData(f.origin_slot);else if(m.onExecute)m.onExecute();return f.data}};e.prototype.getInputDataType=function(f){if(!this.inputs||f>=this.inputs.length||null==this.inputs[f].link)return null;f=this.graph.links[this.inputs[f].link];
if(!f)return null;var m=this.graph.getNodeById(f.origin_id);return m?(f=m.outputs[f.origin_slot])?f.type:null:f.type};e.prototype.getInputDataByName=function(f,m){f=this.findInputSlot(f);return-1==f?null:this.getInputData(f,m)};e.prototype.isInputConnected=function(f){return this.inputs?f<this.inputs.length&&null!=this.inputs[f].link:!1};e.prototype.getInputInfo=function(f){return this.inputs?f<this.inputs.length?this.inputs[f]:null:null};e.prototype.getInputLink=function(f){return this.inputs?f<
this.inputs.length?this.graph.links[this.inputs[f].link]:null:null};e.prototype.getInputNode=function(f){if(!this.inputs||f>=this.inputs.length)return null;f=this.inputs[f];return f&&null!==f.link?(f=this.graph.links[f.link])?this.graph.getNodeById(f.origin_id):null:null};e.prototype.getInputOrProperty=function(f){if(!this.inputs||!this.inputs.length)return this.properties?this.properties[f]:null;for(var m=0,v=this.inputs.length;m<v;++m){var D=this.inputs[m];if(f==D.name&&null!=D.link&&(D=this.graph.links[D.link]))return D.data}return this.properties[f]};
e.prototype.getOutputData=function(f){return!this.outputs||f>=this.outputs.length?null:this.outputs[f]._data};e.prototype.getOutputInfo=function(f){return this.outputs?f<this.outputs.length?this.outputs[f]:null:null};e.prototype.isOutputConnected=function(f){return this.outputs?f<this.outputs.length&&this.outputs[f].links&&this.outputs[f].links.length:!1};e.prototype.isAnyOutputConnected=function(){if(!this.outputs)return!1;for(var f=0;f<this.outputs.length;++f)if(this.outputs[f].links&&this.outputs[f].links.length)return!0;
return!1};e.prototype.getOutputNodes=function(f){if(!this.outputs||0==this.outputs.length||f>=this.outputs.length)return null;f=this.outputs[f];if(!f.links||0==f.links.length)return null;for(var m=[],v=0;v<f.links.length;v++){var D=this.graph.links[f.links[v]];D&&(D=this.graph.getNodeById(D.target_id))&&m.push(D)}return m};e.prototype.trigger=function(f,m){if(this.outputs&&this.outputs.length){this.graph&&(this.graph._last_trigger_time=B.getTime());for(var v=0;v<this.outputs.length;++v){var D=this.outputs[v];
!D||D.type!==B.EVENT||f&&D.name!=f||this.triggerSlot(v,m)}}};e.prototype.triggerSlot=function(f,m,v){if(this.outputs&&(f=this.outputs[f])&&(f=f.links)&&f.length){this.graph&&(this.graph._last_trigger_time=B.getTime());for(var D=0;D<f.length;++D){var C=f[D];if(null==v||v==C){var J=this.graph.links[f[D]];if(J&&(J._last_time=B.getTime(),C=this.graph.getNodeById(J.target_id)))if(J=C.inputs[J.target_slot],C.onAction)C.onAction(J.name,m);else if(C.mode===B.ON_TRIGGER&&C.onExecute)C.onExecute(m)}}}};e.prototype.clearTriggeredSlot=
function(f,m){if(this.outputs&&(f=this.outputs[f])&&(f=f.links)&&f.length)for(var v=0;v<f.length;++v){var D=f[v];if(null==m||m==D)if(D=this.graph.links[f[v]])D._last_time=0}};e.prototype.setSize=function(f){this.size=f;if(this.onResize)this.onResize(this.size)};e.prototype.addProperty=function(f,m,v,D){v={name:f,type:v,default_value:m};if(D)for(var C in D)v[C]=D[C];this.properties_info||(this.properties_info=[]);this.properties_info.push(v);this.properties||(this.properties={});this.properties[f]=
m;return v};e.prototype.addOutput=function(f,m,v){f={name:f,type:m,links:null};if(v)for(var D in v)f[D]=v[D];this.outputs||(this.outputs=[]);this.outputs.push(f);if(this.onOutputAdded)this.onOutputAdded(f);this.setSize(this.computeSize());this.setDirtyCanvas(!0,!0);return f};e.prototype.addOutputs=function(f){for(var m=0;m<f.length;++m){var v=f[m],D={name:v[0],type:v[1],link:null};if(f[2])for(var C in v[2])D[C]=v[2][C];this.outputs||(this.outputs=[]);this.outputs.push(D);if(this.onOutputAdded)this.onOutputAdded(D)}this.setSize(this.computeSize());
this.setDirtyCanvas(!0,!0)};e.prototype.removeOutput=function(f){this.disconnectOutput(f);this.outputs.splice(f,1);for(var m=f;m<this.outputs.length;++m)if(this.outputs[m]&&this.outputs[m].links)for(var v=this.outputs[m].links,D=0;D<v.length;++D){var C=this.graph.links[v[D]];C&&--C.origin_slot}this.setSize(this.computeSize());if(this.onOutputRemoved)this.onOutputRemoved(f);this.setDirtyCanvas(!0,!0)};e.prototype.addInput=function(f,m,v){f={name:f,type:m||0,link:null};if(v)for(var D in v)f[D]=v[D];
this.inputs||(this.inputs=[]);this.inputs.push(f);this.setSize(this.computeSize());if(this.onInputAdded)this.onInputAdded(f);this.setDirtyCanvas(!0,!0);return f};e.prototype.addInputs=function(f){for(var m=0;m<f.length;++m){var v=f[m],D={name:v[0],type:v[1],link:null};if(f[2])for(var C in v[2])D[C]=v[2][C];this.inputs||(this.inputs=[]);this.inputs.push(D);if(this.onInputAdded)this.onInputAdded(D)}this.setSize(this.computeSize());this.setDirtyCanvas(!0,!0)};e.prototype.removeInput=function(f){this.disconnectInput(f);
for(var m=this.inputs.splice(f,1),v=f;v<this.inputs.length;++v)if(this.inputs[v]){var D=this.graph.links[this.inputs[v].link];D&&--D.target_slot}this.setSize(this.computeSize());if(this.onInputRemoved)this.onInputRemoved(f,m[0]);this.setDirtyCanvas(!0,!0)};e.prototype.addConnection=function(f,m,v,D){f={name:f,type:m,pos:v,direction:D,links:null};this.connections.push(f);return f};e.prototype.computeSize=function(f){function m(Y){return Y?D*Y.length*.6:0}if(this.constructor.size)return this.constructor.size.concat();
var v=Math.max(this.inputs?this.inputs.length:1,this.outputs?this.outputs.length:1);f=f||new Float32Array([0,0]);v=Math.max(v,1);var D=B.NODE_TEXT_SIZE,C=m(this.title),J=0,N=0;if(this.inputs)for(var S=0,T=this.inputs.length;S<T;++S){var W=this.inputs[S];W=W.label||W.name||"";W=m(W);J<W&&(J=W)}if(this.outputs)for(S=0,T=this.outputs.length;S<T;++S)W=this.outputs[S],W=W.label||W.name||"",W=m(W),N<W&&(N=W);f[0]=Math.max(J+N+10,C);f[0]=Math.max(f[0],B.NODE_WIDTH);this.widgets&&this.widgets.length&&(f[0]=
Math.max(f[0],1.5*B.NODE_WIDTH));f[1]=(this.constructor.slot_start_y||0)+v*B.NODE_SLOT_HEIGHT;v=0;if(this.widgets&&this.widgets.length){S=0;for(T=this.widgets.length;S<T;++S)v=this.widgets[S].computeSize?v+(this.widgets[S].computeSize(f[0])[1]+4):v+(B.NODE_WIDGET_HEIGHT+4);v+=8}f[1]=this.widgets_up?Math.max(f[1],v):null!=this.widgets_start_y?Math.max(f[1],v+this.widgets_start_y):f[1]+v;this.constructor.min_height&&f[1]<this.constructor.min_height&&(f[1]=this.constructor.min_height);f[1]+=6;return f};
e.prototype.getPropertyInfo=function(f){var m=null;if(this.properties_info)for(var v=0;v<this.properties_info.length;++v)if(this.properties_info[v].name==f){m=this.properties_info[v];break}this.constructor["@"+f]&&(m=this.constructor["@"+f]);this.constructor.widgets_info&&this.constructor.widgets_info[f]&&(m=this.constructor.widgets_info[f]);!m&&this.onGetPropertyInfo&&(m=this.onGetPropertyInfo(f));m||(m={});m.type||(m.type=typeof this.properties[f]);"combo"==m.widget&&(m.type="enum");return m};e.prototype.addWidget=
function(f,m,v,D,C){this.widgets||(this.widgets=[]);!C&&D&&D.constructor===Object&&(C=D,D=null);C&&C.constructor===String&&(C={property:C});D&&D.constructor===String&&(C||(C={}),C.property=D,D=null);D&&D.constructor!==Function&&(console.warn("addWidget: callback must be a function"),D=null);m={type:f.toLowerCase(),name:m,value:v,callback:D,options:C||{}};void 0!==m.options.y&&(m.y=m.options.y);D||m.options.callback||m.options.property||console.warn("LiteGraph addWidget(...) without a callback or property assigned");
if("combo"==f&&!m.options.values)throw"LiteGraph addWidget('combo',...) requires to pass values in options: { values:['red','blue'] }";this.widgets.push(m);this.setSize(this.computeSize());return m};e.prototype.addCustomWidget=function(f){this.widgets||(this.widgets=[]);this.widgets.push(f);return f};e.prototype.getBounding=function(f){f=f||new Float32Array(4);f[0]=this.pos[0]-4;f[1]=this.pos[1]-B.NODE_TITLE_HEIGHT;f[2]=this.size[0]+4;f[3]=this.size[1]+B.NODE_TITLE_HEIGHT;if(this.onBounding)this.onBounding(f);
return f};e.prototype.isPointInside=function(f,m,v,D){v=v||0;var C=this.graph&&this.graph.isLive()?0:B.NODE_TITLE_HEIGHT;D&&(C=0);if(this.flags&&this.flags.collapsed){if(r(f,m,this.pos[0]-v,this.pos[1]-B.NODE_TITLE_HEIGHT-v,(this._collapsed_width||B.NODE_COLLAPSED_WIDTH)+2*v,B.NODE_TITLE_HEIGHT+2*v))return!0}else if(this.pos[0]-4-v<f&&this.pos[0]+this.size[0]+4+v>f&&this.pos[1]-C-v<m&&this.pos[1]+this.size[1]+v>m)return!0;return!1};e.prototype.getSlotInPosition=function(f,m){var v=new Float32Array(2);
if(this.inputs)for(var D=0,C=this.inputs.length;D<C;++D){var J=this.inputs[D];this.getConnectionPos(!0,D,v);if(r(f,m,v[0]-10,v[1]-5,20,10))return{input:J,slot:D,link_pos:v}}if(this.outputs)for(D=0,C=this.outputs.length;D<C;++D)if(J=this.outputs[D],this.getConnectionPos(!1,D,v),r(f,m,v[0]-10,v[1]-5,20,10))return{output:J,slot:D,link_pos:v};return null};e.prototype.findInputSlot=function(f){if(!this.inputs)return-1;for(var m=0,v=this.inputs.length;m<v;++m)if(f==this.inputs[m].name)return m;return-1};
e.prototype.findOutputSlot=function(f){if(!this.outputs)return-1;for(var m=0,v=this.outputs.length;m<v;++m)if(f==this.outputs[m].name)return m;return-1};e.prototype.connect=function(f,m,v){v=v||0;if(!this.graph)return console.log("Connect: Error, node doesn't belong to any graph. Nodes must be added first to a graph before connecting them."),null;if(f.constructor===String){if(f=this.findOutputSlot(f),-1==f)return B.debug&&console.log("Connect: Error, no slot of name "+f),null}else if(!this.outputs||
f>=this.outputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),null;m&&m.constructor===Number&&(m=this.graph.getNodeById(m));if(!m)throw"target node is null";if(m==this)return null;if(v.constructor===String){if(v=m.findInputSlot(v),-1==v)return B.debug&&console.log("Connect: Error, no slot of name "+v),null}else{if(v===B.EVENT)return null;if(!m.inputs||v>=m.inputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),null}var D=!1;null!=m.inputs[v].link&&
(this.graph.beforeChange(),m.disconnectInput(v),D=!0);var C=this.outputs[f];if(m.onConnectInput&&!1===m.onConnectInput(v,C.type,C,this,f))return null;var J=m.inputs[v],N=null;if(!B.isValidConnection(C.type,J.type))return this.setDirtyCanvas(!1,!0),D&&this.graph.connectionChange(this,N),null;D||this.graph.beforeChange();N=new k(++this.graph.last_link_id,J.type,this.id,f,m.id,v);this.graph.links[N.id]=N;null==C.links&&(C.links=[]);C.links.push(N.id);m.inputs[v].link=N.id;this.graph&&this.graph._version++;
if(this.onConnectionsChange)this.onConnectionsChange(B.OUTPUT,f,!0,N,C);if(m.onConnectionsChange)m.onConnectionsChange(B.INPUT,v,!0,N,J);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.INPUT,m,v,this,f),this.graph.onNodeConnectionChange(B.OUTPUT,this,f,m,v));this.setDirtyCanvas(!1,!0);this.graph.afterChange();this.graph.connectionChange(this,N);return N};e.prototype.disconnectOutput=function(f,m){if(f.constructor===String){if(f=this.findOutputSlot(f),-1==f)return B.debug&&
console.log("Connect: Error, no slot of name "+f),!1}else if(!this.outputs||f>=this.outputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),!1;var v=this.outputs[f];if(!v||!v.links||0==v.links.length)return!1;if(m){m.constructor===Number&&(m=this.graph.getNodeById(m));if(!m)throw"Target Node not found";for(var D=0,C=v.links.length;D<C;D++){var J=v.links[D],N=this.graph.links[J];if(N.target_id==m.id){v.links.splice(D,1);var S=m.inputs[N.target_slot];S.link=null;delete this.graph.links[J];
this.graph&&this.graph._version++;if(m.onConnectionsChange)m.onConnectionsChange(B.INPUT,N.target_slot,!1,N,S);if(this.onConnectionsChange)this.onConnectionsChange(B.OUTPUT,f,!1,N,v);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange(B.OUTPUT,this,f);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.OUTPUT,this,f),this.graph.onNodeConnectionChange(B.INPUT,m,N.target_slot));break}}}else{D=0;for(C=v.links.length;D<C;D++)if(J=v.links[D],
N=this.graph.links[J]){m=this.graph.getNodeById(N.target_id);this.graph&&this.graph._version++;if(m){S=m.inputs[N.target_slot];S.link=null;if(m.onConnectionsChange)m.onConnectionsChange(B.INPUT,N.target_slot,!1,N,S);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange(B.INPUT,m,N.target_slot)}delete this.graph.links[J];if(this.onConnectionsChange)this.onConnectionsChange(B.OUTPUT,f,!1,N,v);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.OUTPUT,
this,f),this.graph.onNodeConnectionChange(B.INPUT,m,N.target_slot))}v.links=null}this.setDirtyCanvas(!1,!0);this.graph.connectionChange(this);return!0};e.prototype.disconnectInput=function(f){if(f.constructor===String){if(f=this.findInputSlot(f),-1==f)return B.debug&&console.log("Connect: Error, no slot of name "+f),!1}else if(!this.inputs||f>=this.inputs.length)return B.debug&&console.log("Connect: Error, slot number not found"),!1;var m=this.inputs[f];if(!m)return!1;var v=this.inputs[f].link;this.inputs[f].link=
null;var D=this.graph.links[v];if(D){var C=this.graph.getNodeById(D.origin_id);if(!C)return!1;var J=C.outputs[D.origin_slot];if(!J||!J.links||0==J.links.length)return!1;for(var N=0,S=J.links.length;N<S;N++)if(J.links[N]==v){J.links.splice(N,1);break}delete this.graph.links[v];this.graph&&this.graph._version++;if(this.onConnectionsChange)this.onConnectionsChange(B.INPUT,f,!1,D,m);if(C.onConnectionsChange)C.onConnectionsChange(B.OUTPUT,N,!1,D,J);this.graph&&this.graph.onNodeConnectionChange&&(this.graph.onNodeConnectionChange(B.OUTPUT,
C,N),this.graph.onNodeConnectionChange(B.INPUT,this,f))}this.setDirtyCanvas(!1,!0);this.graph.connectionChange(this);return!0};e.prototype.getConnectionPos=function(f,m,v){v=v||new Float32Array(2);var D=0;f&&this.inputs&&(D=this.inputs.length);!f&&this.outputs&&(D=this.outputs.length);var C=.5*B.NODE_SLOT_HEIGHT;if(this.flags.collapsed)return m=this._collapsed_width||B.NODE_COLLAPSED_WIDTH,this.horizontal?(v[0]=this.pos[0]+.5*m,v[1]=f?this.pos[1]-B.NODE_TITLE_HEIGHT:this.pos[1]):(v[0]=f?this.pos[0]:
this.pos[0]+m,v[1]=this.pos[1]-.5*B.NODE_TITLE_HEIGHT),v;if(f&&-1==m)return v[0]=this.pos[0]+.5*B.NODE_TITLE_HEIGHT,v[1]=this.pos[1]+.5*B.NODE_TITLE_HEIGHT,v;if(f&&D>m&&this.inputs[m].pos)return v[0]=this.pos[0]+this.inputs[m].pos[0],v[1]=this.pos[1]+this.inputs[m].pos[1],v;if(!f&&D>m&&this.outputs[m].pos)return v[0]=this.pos[0]+this.outputs[m].pos[0],v[1]=this.pos[1]+this.outputs[m].pos[1],v;if(this.horizontal)return v[0]=this.pos[0]+this.size[0]/D*(m+.5),v[1]=f?this.pos[1]-B.NODE_TITLE_HEIGHT:this.pos[1]+
this.size[1],v;v[0]=f?this.pos[0]+C:this.pos[0]+this.size[0]+1-C;v[1]=this.pos[1]+(m+.7)*B.NODE_SLOT_HEIGHT+(this.constructor.slot_start_y||0);return v};e.prototype.alignToGrid=function(){this.pos[0]=B.CANVAS_GRID_SIZE*Math.round(this.pos[0]/B.CANVAS_GRID_SIZE);this.pos[1]=B.CANVAS_GRID_SIZE*Math.round(this.pos[1]/B.CANVAS_GRID_SIZE)};e.prototype.trace=function(f){this.console||(this.console=[]);this.console.push(f);this.console.length>e.MAX_CONSOLE&&this.console.shift();if(this.graph.onNodeTrace)this.graph.onNodeTrace(this,
f)};e.prototype.setDirtyCanvas=function(f,m){this.graph&&this.graph.sendActionToCanvas("setDirty",[f,m])};e.prototype.loadImage=function(f){var m=new Image;m.src=B.node_images_path+f;m.ready=!1;var v=this;m.onload=function(){this.ready=!0;v.setDirtyCanvas(!0)};return m};e.prototype.captureInput=function(f){if(this.graph&&this.graph.list_of_graphcanvas)for(var m=this.graph.list_of_graphcanvas,v=0;v<m.length;++v){var D=m[v];if(f||D.node_capturing_input==this)D.node_capturing_input=f?this:null}};e.prototype.collapse=
function(f){this.graph._version++;if(!1!==this.constructor.collapsable||f)this.flags.collapsed=this.flags.collapsed?!1:!0,this.setDirtyCanvas(!0,!0)};e.prototype.pin=function(f){this.graph._version++;this.flags.pinned=void 0===f?!this.flags.pinned:f};e.prototype.localToScreen=function(f,m,v){return[(f+this.pos[0])*v.scale+v.offset[0],(m+this.pos[1])*v.scale+v.offset[1]]};b.LGraphGroup=B.LGraphGroup=p;p.prototype._ctor=function(f){this.title=f||"Group";this.font_size=24;this.color=l.node_colors.pale_blue?
l.node_colors.pale_blue.groupcolor:"#AAA";this._bounding=new Float32Array([10,10,140,80]);this._pos=this._bounding.subarray(0,2);this._size=this._bounding.subarray(2,4);this._nodes=[];this.graph=null;Object.defineProperty(this,"pos",{set:function(m){!m||2>m.length||(this._pos[0]=m[0],this._pos[1]=m[1])},get:function(){return this._pos},enumerable:!0});Object.defineProperty(this,"size",{set:function(m){!m||2>m.length||(this._size[0]=Math.max(140,m[0]),this._size[1]=Math.max(80,m[1]))},get:function(){return this._size},
enumerable:!0})};p.prototype.configure=function(f){this.title=f.title;this._bounding.set(f.bounding);this.color=f.color;this.font=f.font};p.prototype.serialize=function(){var f=this._bounding;return{title:this.title,bounding:[Math.round(f[0]),Math.round(f[1]),Math.round(f[2]),Math.round(f[3])],color:this.color,font:this.font}};p.prototype.move=function(f,m,v){this._pos[0]+=f;this._pos[1]+=m;if(!v)for(v=0;v<this._nodes.length;++v){var D=this._nodes[v];D.pos[0]+=f;D.pos[1]+=m}};p.prototype.recomputeInsideNodes=
function(){this._nodes.length=0;for(var f=this.graph._nodes,m=new Float32Array(4),v=0;v<f.length;++v){var D=f[v];D.getBounding(m);y(this._bounding,m)&&this._nodes.push(D)}};p.prototype.isPointInside=e.prototype.isPointInside;p.prototype.setDirtyCanvas=e.prototype.setDirtyCanvas;B.DragAndScale=q;q.prototype.bindEvents=function(f){this.last_mouse=new Float32Array(2);this._binded_mouse_callback=this.onMouse.bind(this);f.addEventListener("mousedown",this._binded_mouse_callback);f.addEventListener("mousemove",
this._binded_mouse_callback);f.addEventListener("mousewheel",this._binded_mouse_callback,!1);f.addEventListener("wheel",this._binded_mouse_callback,!1)};q.prototype.computeVisibleArea=function(){if(this.element){var f=-this.offset[0],m=-this.offset[1],v=f+this.element.width/this.scale,D=m+this.element.height/this.scale;this.visible_area[0]=f;this.visible_area[1]=m;this.visible_area[2]=v-f;this.visible_area[3]=D-m}else this.visible_area[0]=this.visible_area[1]=this.visible_area[2]=this.visible_area[3]=
0};q.prototype.onMouse=function(f){if(this.enabled){var m=this.element,v=m.getBoundingClientRect(),D=f.clientX-v.left;v=f.clientY-v.top;f.canvasx=D;f.canvasy=v;f.dragging=this.dragging;var C=!1;this.onmouse&&(C=this.onmouse(f));if("mousedown"==f.type)this.dragging=!0,m.removeEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mousemove",this._binded_mouse_callback),document.body.addEventListener("mouseup",this._binded_mouse_callback);else if("mousemove"==f.type)C||
(m=D-this.last_mouse[0],C=v-this.last_mouse[1],this.dragging&&this.mouseDrag(m,C));else if("mouseup"==f.type)this.dragging=!1,document.body.removeEventListener("mousemove",this._binded_mouse_callback),document.body.removeEventListener("mouseup",this._binded_mouse_callback),m.addEventListener("mousemove",this._binded_mouse_callback);else if("mousewheel"==f.type||"wheel"==f.type||"DOMMouseScroll"==f.type)f.eventType="mousewheel",f.wheel="wheel"==f.type?-f.deltaY:null!=f.wheelDeltaY?f.wheelDeltaY:-60*
f.detail,f.delta=f.wheelDelta?f.wheelDelta/40:f.deltaY?-f.deltaY/3:0,this.changeDeltaScale(1+.05*f.delta);this.last_mouse[0]=D;this.last_mouse[1]=v;f.preventDefault();f.stopPropagation();return!1}};q.prototype.toCanvasContext=function(f){f.scale(this.scale,this.scale);f.translate(this.offset[0],this.offset[1])};q.prototype.convertOffsetToCanvas=function(f){return[(f[0]+this.offset[0])*this.scale,(f[1]+this.offset[1])*this.scale]};q.prototype.convertCanvasToOffset=function(f,m){m=m||[0,0];m[0]=f[0]/
this.scale-this.offset[0];m[1]=f[1]/this.scale-this.offset[1];return m};q.prototype.mouseDrag=function(f,m){this.offset[0]+=f/this.scale;this.offset[1]+=m/this.scale;if(this.onredraw)this.onredraw(this)};q.prototype.changeScale=function(f,m){f<this.min_scale?f=this.min_scale:f>this.max_scale&&(f=this.max_scale);if(f!=this.scale&&this.element){var v=this.element.getBoundingClientRect();if(v&&(m=m||[.5*v.width,.5*v.height],v=this.convertCanvasToOffset(m),this.scale=f,.01>Math.abs(this.scale-1)&&(this.scale=
1),f=this.convertCanvasToOffset(m),f=[f[0]-v[0],f[1]-v[1]],this.offset[0]+=f[0],this.offset[1]+=f[1],this.onredraw))this.onredraw(this)}};q.prototype.changeDeltaScale=function(f,m){this.changeScale(this.scale*f,m)};q.prototype.reset=function(){this.scale=1;this.offset[0]=0;this.offset[1]=0};b.LGraphCanvas=B.LGraphCanvas=l;l.DEFAULT_BACKGROUND_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAIAAAD/gAIDAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQBJREFUeNrs1rEKwjAUhlETUkj3vP9rdmr1Ysammk2w5wdxuLgcMHyptfawuZX4pJSWZTnfnu/lnIe/jNNxHHGNn//HNbbv+4dr6V+11uF527arU7+u63qfa/bnmh8sWLBgwYJlqRf8MEptXPBXJXa37BSl3ixYsGDBMliwFLyCV/DeLIMFCxYsWLBMwSt4Be/NggXLYMGCBUvBK3iNruC9WbBgwYJlsGApeAWv4L1ZBgsWLFiwYJmCV/AK3psFC5bBggULloJX8BpdwXuzYMGCBctgwVLwCl7Be7MMFixYsGDBsu8FH1FaSmExVfAxBa/gvVmwYMGCZbBg/W4vAQYA5tRF9QYlv/QAAAAASUVORK5CYII=";
l.link_type_colors={"-1":B.EVENT_LINK_COLOR,number:"#AAA",node:"#DCA"};l.gradients={};l.prototype.clear=function(){this.fps=this.render_time=this.last_draw_time=this.frame=0;this.dragging_rectangle=null;this.selected_nodes={};this.selected_group=null;this.visible_nodes=[];this.connecting_node=this.node_capturing_input=this.node_over=this.node_dragged=null;this.highlighted_links={};this.dragging_canvas=!1;this.dirty_bgcanvas=this.dirty_canvas=!0;this.node_widget=this.node_in_panel=this.dirty_area=
null;this.last_mouse=[0,0];this.last_mouseclick=0;this.visible_area.set([0,0,0,0]);if(this.onClear)this.onClear()};l.prototype.setGraph=function(f,m){this.graph!=f&&(m||this.clear(),!f&&this.graph?this.graph.detachCanvas(this):(f.attachCanvas(this),this._graph_stack&&(this._graph_stack=null),this.setDirty(!0,!0)))};l.prototype.getTopGraph=function(){return this._graph_stack.length?this._graph_stack[0]:this.graph};l.prototype.openSubgraph=function(f){if(!f)throw"graph cannot be null";if(this.graph==
f)throw"graph cannot be the same";this.clear();this.graph&&(this._graph_stack||(this._graph_stack=[]),this._graph_stack.push(this.graph));f.attachCanvas(this);this.checkPanels();this.setDirty(!0,!0)};l.prototype.closeSubgraph=function(){if(this._graph_stack&&0!=this._graph_stack.length){var f=this.graph._subgraph_node,m=this._graph_stack.pop();this.selected_nodes={};this.highlighted_links={};m.attachCanvas(this);this.setDirty(!0,!0);f&&(this.centerOnNode(f),this.selectNodes([f]))}};l.prototype.getCurrentGraph=
function(){return this.graph};l.prototype.setCanvas=function(f,m){if(f&&f.constructor===String&&(f=document.getElementById(f),!f))throw"Error creating LiteGraph canvas: Canvas not found";if(f!==this.canvas&&(!f&&this.canvas&&(m||this.unbindEvents()),this.canvas=f,this.ds.element=f)){f.className+=" lgraphcanvas";f.data=this;f.tabindex="1";this.bgcanvas=null;this.bgcanvas||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height);
if(null==f.getContext){if("canvas"!=f.localName)throw"Element supplied for LGraphCanvas must be a <canvas> element, you passed a "+f.localName;throw"This browser doesn't support Canvas";}null==(this.ctx=f.getContext("2d"))&&(f.webgl_enabled||console.warn("This canvas seems to be WebGL, enabling WebGL renderer"),this.enableWebGL());this._mousemove_callback=this.processMouseMove.bind(this);this._mouseup_callback=this.processMouseUp.bind(this);m||this.bindEvents()}};l.prototype._doNothing=function(f){f.preventDefault();
return!1};l.prototype._doReturnTrue=function(f){f.preventDefault();return!0};l.prototype.bindEvents=function(){if(this._events_binded)console.warn("LGraphCanvas: events already binded");else{var f=this.canvas,m=this.getCanvasWindow().document;this._mousedown_callback=this.processMouseDown.bind(this);this._mousewheel_callback=this.processMouseWheel.bind(this);f.addEventListener("mousedown",this._mousedown_callback,!0);f.addEventListener("mousemove",this._mousemove_callback);f.addEventListener("mousewheel",
this._mousewheel_callback,!1);f.addEventListener("contextmenu",this._doNothing);f.addEventListener("DOMMouseScroll",this._mousewheel_callback,!1);f.addEventListener("touchstart",this.touchHandler,!0);f.addEventListener("touchmove",this.touchHandler,!0);f.addEventListener("touchend",this.touchHandler,!0);f.addEventListener("touchcancel",this.touchHandler,!0);this._key_callback=this.processKey.bind(this);f.addEventListener("keydown",this._key_callback,!0);m.addEventListener("keyup",this._key_callback,
!0);this._ondrop_callback=this.processDrop.bind(this);f.addEventListener("dragover",this._doNothing,!1);f.addEventListener("dragend",this._doNothing,!1);f.addEventListener("drop",this._ondrop_callback,!1);f.addEventListener("dragenter",this._doReturnTrue,!1);this._events_binded=!0}};l.prototype.unbindEvents=function(){if(this._events_binded){var f=this.getCanvasWindow().document;this.canvas.removeEventListener("mousedown",this._mousedown_callback);this.canvas.removeEventListener("mousewheel",this._mousewheel_callback);
this.canvas.removeEventListener("DOMMouseScroll",this._mousewheel_callback);this.canvas.removeEventListener("keydown",this._key_callback);f.removeEventListener("keyup",this._key_callback);this.canvas.removeEventListener("contextmenu",this._doNothing);this.canvas.removeEventListener("drop",this._ondrop_callback);this.canvas.removeEventListener("dragenter",this._doReturnTrue);this.canvas.removeEventListener("touchstart",this.touchHandler);this.canvas.removeEventListener("touchmove",this.touchHandler);
this.canvas.removeEventListener("touchend",this.touchHandler);this.canvas.removeEventListener("touchcancel",this.touchHandler);this._ondrop_callback=this._key_callback=this._mousewheel_callback=this._mousedown_callback=null;this._events_binded=!1}else console.warn("LGraphCanvas: no events binded")};l.getFileExtension=function(f){var m=f.indexOf("?");-1!=m&&(f=f.substr(0,m));m=f.lastIndexOf(".");return-1==m?"":f.substr(m+1).toLowerCase()};l.prototype.enableWebGL=function(){this.gl=this.ctx=enableWebGLCanvas(this.canvas);
this.ctx.webgl=!0;this.bgcanvas=this.canvas;this.bgctx=this.gl;this.canvas.webgl_enabled=!0};l.prototype.setDirty=function(f,m){f&&(this.dirty_canvas=!0);m&&(this.dirty_bgcanvas=!0)};l.prototype.getCanvasWindow=function(){if(!this.canvas)return window;var f=this.canvas.ownerDocument;return f.defaultView||f.parentWindow};l.prototype.startRendering=function(){function f(){this.pause_rendering||this.draw();var m=this.getCanvasWindow();this.is_rendering&&m.requestAnimationFrame(f.bind(this))}this.is_rendering||
(this.is_rendering=!0,f.call(this))};l.prototype.stopRendering=function(){this.is_rendering=!1};l.prototype.blockClick=function(){this.block_click=!0;this.last_mouseclick=0};l.prototype.processMouseDown=function(f){this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){this.adjustMouseEvent(f);var m=this.getCanvasWindow();l.active_canvas=this;var v=this;this.canvas.removeEventListener("mousemove",this._mousemove_callback);m.document.addEventListener("mousemove",this._mousemove_callback,
!0);m.document.addEventListener("mouseup",this._mouseup_callback,!0);var D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes,5),C=!1,J=300>B.getTime()-this.last_mouseclick;this.mouse[0]=f.localX;this.mouse[1]=f.localY;this.graph_mouse[0]=f.canvasX;this.graph_mouse[1]=f.canvasY;this.last_click_position=[this.mouse[0],this.mouse[1]];this.canvas.focus();B.closeAllContextMenus(m);if(!this.onMouse||1!=this.onMouse(f)){if(1==f.which){f.ctrlKey&&(this.dragging_rectangle=new Float32Array(4),
this.dragging_rectangle[0]=f.canvasX,this.dragging_rectangle[1]=f.canvasY,this.dragging_rectangle[2]=1,this.dragging_rectangle[3]=1,C=!0);var N=!1;if(D&&this.allow_interaction&&!C&&!this.read_only){this.live_mode||D.flags.pinned||this.bringToFront(D);if(!this.connecting_node&&!D.flags.collapsed&&!this.live_mode)if(!C&&!1!==D.resizable&&r(f.canvasX,f.canvasY,D.pos[0]+D.size[0]-5,D.pos[1]+D.size[1]-5,10,10))this.graph.beforeChange(),this.resizing_node=D,this.canvas.style.cursor="se-resize",C=!0;else{if(D.outputs)for(var S=
0,T=D.outputs.length;S<T;++S){var W=D.outputs[S],Y=D.getConnectionPos(!1,S);if(r(f.canvasX,f.canvasY,Y[0]-15,Y[1]-10,30,20)){this.connecting_node=D;this.connecting_output=W;this.connecting_pos=D.getConnectionPos(!1,S);this.connecting_slot=S;f.shiftKey&&D.disconnectOutput(S);if(J){if(D.onOutputDblClick)D.onOutputDblClick(S,f)}else if(D.onOutputClick)D.onOutputClick(S,f);C=!0;break}}if(D.inputs)for(S=0,T=D.inputs.length;S<T;++S)if(W=D.inputs[S],Y=D.getConnectionPos(!0,S),r(f.canvasX,f.canvasY,Y[0]-
15,Y[1]-10,30,20)){if(J){if(D.onInputDblClick)D.onInputDblClick(S,f)}else if(D.onInputClick)D.onInputClick(S,f);if(null!==W.link){C=this.graph.links[W.link];D.disconnectInput(S);if(this.allow_reconnect_links||f.shiftKey)this.connecting_node=this.graph._nodes_by_id[C.origin_id],this.connecting_slot=C.origin_slot,this.connecting_output=this.connecting_node.outputs[this.connecting_slot],this.connecting_pos=this.connecting_node.getConnectionPos(!1,this.connecting_slot);C=this.dirty_bgcanvas=!0}}}if(!C){S=
!1;T=[f.canvasX-D.pos[0],f.canvasY-D.pos[1]];if(Y=this.processNodeWidgets(D,this.graph_mouse,f))S=!0,this.node_widget=[D,Y];if(J&&this.selected_nodes[D.id]){if(D.onDblClick)D.onDblClick(f,T,this);this.processNodeDblClicked(D);S=!0}D.onMouseDown&&D.onMouseDown(f,T,this)?S=!0:(D.subgraph&&!D.skip_subgraph_button&&!D.flags.collapsed&&T[0]>D.size[0]-B.NODE_TITLE_HEIGHT&&0>T[1]&&(v=this,setTimeout(function(){v.openSubgraph(D.subgraph)},10)),this.live_mode&&(S=N=!0));S||(this.allow_dragnodes&&(this.graph.beforeChange(),
this.node_dragged=D),this.selected_nodes[D.id]||this.processNodeSelected(D,f));this.dirty_canvas=!0}}else{if(!this.read_only)for(S=0;S<this.visible_links.length;++S)if(N=this.visible_links[S],T=N._pos,!(!T||f.canvasX<T[0]-4||f.canvasX>T[0]+4||f.canvasY<T[1]-4||f.canvasY>T[1]+4)){this.showLinkMenu(N,f);this.over_link_center=null;break}this.selected_group=this.graph.getGroupOnPos(f.canvasX,f.canvasY);this.selected_group_resizing=!1;this.selected_group&&!this.read_only&&(f.ctrlKey&&(this.dragging_rectangle=
null),10>t([f.canvasX,f.canvasY],[this.selected_group.pos[0]+this.selected_group.size[0],this.selected_group.pos[1]+this.selected_group.size[1]])*this.ds.scale?this.selected_group_resizing=!0:this.selected_group.recomputeInsideNodes());J&&!this.read_only&&this.allow_searchbox&&this.showSearchBox(f);N=!0}!C&&N&&this.allow_dragcanvas&&(this.dragging_canvas=!0)}else 2!=f.which&&3==f.which&&(this.read_only||this.processContextMenu(D,f));this.last_mouse[0]=f.localX;this.last_mouse[1]=f.localY;this.last_mouseclick=
B.getTime();this.last_mouse_dragging=!0;this.graph.change();(!m.document.activeElement||"input"!=m.document.activeElement.nodeName.toLowerCase()&&"textarea"!=m.document.activeElement.nodeName.toLowerCase())&&f.preventDefault();f.stopPropagation();if(this.onMouseDown)this.onMouseDown(f);return!1}}};l.prototype.processMouseMove=function(f){this.autoresize&&this.resize();this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){l.active_canvas=this;this.adjustMouseEvent(f);var m=[f.localX,
f.localY];this.mouse[0]=m[0];this.mouse[1]=m[1];var v=[m[0]-this.last_mouse[0],m[1]-this.last_mouse[1]];this.last_mouse=m;this.graph_mouse[0]=f.canvasX;this.graph_mouse[1]=f.canvasY;if(this.block_click)return f.preventDefault(),!1;f.dragging=this.last_mouse_dragging;this.node_widget&&(this.processNodeWidgets(this.node_widget[0],this.graph_mouse,f,this.node_widget[1]),this.dirty_canvas=!0);if(this.dragging_rectangle)this.dragging_rectangle[2]=f.canvasX-this.dragging_rectangle[0],this.dragging_rectangle[3]=
f.canvasY-this.dragging_rectangle[1],this.dirty_canvas=!0;else if(this.selected_group&&!this.read_only)this.selected_group_resizing?this.selected_group.size=[f.canvasX-this.selected_group.pos[0],f.canvasY-this.selected_group.pos[1]]:(this.selected_group.move(v[0]/this.ds.scale,v[1]/this.ds.scale,f.ctrlKey),this.selected_group._nodes.length&&(this.dirty_canvas=!0)),this.dirty_bgcanvas=!0;else if(this.dragging_canvas)this.ds.offset[0]+=v[0]/this.ds.scale,this.ds.offset[1]+=v[1]/this.ds.scale,this.dirty_bgcanvas=
this.dirty_canvas=!0;else if(this.allow_interaction&&!this.read_only){this.connecting_node&&(this.dirty_canvas=!0);var D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes);m=0;for(var C=this.graph._nodes.length;m<C;++m)if(this.graph._nodes[m].mouseOver&&D!=this.graph._nodes[m]){this.graph._nodes[m].mouseOver=!1;if(this.node_over&&this.node_over.onMouseLeave)this.node_over.onMouseLeave(f);this.node_over=null;this.dirty_canvas=!0}if(D){D.redraw_on_mouse&&(this.dirty_canvas=!0);if(!D.mouseOver&&
(D.mouseOver=!0,this.node_over=D,this.dirty_canvas=!0,D.onMouseEnter))D.onMouseEnter(f);if(D.onMouseMove)D.onMouseMove(f,[f.canvasX-D.pos[0],f.canvasY-D.pos[1]],this);if(this.connecting_node&&(C=this._highlight_input||[0,0],!this.isOverNodeBox(D,f.canvasX,f.canvasY))){var J=this.isOverNodeInput(D,f.canvasX,f.canvasY,C);-1!=J&&D.inputs[J]?B.isValidConnection(this.connecting_output.type,D.inputs[J].type)&&(this._highlight_input=C):this._highlight_input=null}this.canvas&&(r(f.canvasX,f.canvasY,D.pos[0]+
D.size[0]-5,D.pos[1]+D.size[1]-5,5,5)?this.canvas.style.cursor="se-resize":this.canvas.style.cursor="crosshair")}else{C=null;for(m=0;m<this.visible_links.length;++m){J=this.visible_links[m];var N=J._pos;if(!(!N||f.canvasX<N[0]-4||f.canvasX>N[0]+4||f.canvasY<N[1]-4||f.canvasY>N[1]+4)){C=J;break}}C!=this.over_link_center&&(this.over_link_center=C,this.dirty_canvas=!0);this.canvas&&(this.canvas.style.cursor="")}if(this.node_capturing_input&&this.node_capturing_input!=D&&this.node_capturing_input.onMouseMove)this.node_capturing_input.onMouseMove(f,
[f.canvasX-this.node_capturing_input.pos[0],f.canvasY-this.node_capturing_input.pos[1]],this);if(this.node_dragged&&!this.live_mode){for(m in this.selected_nodes)D=this.selected_nodes[m],D.pos[0]+=v[0]/this.ds.scale,D.pos[1]+=v[1]/this.ds.scale;this.dirty_bgcanvas=this.dirty_canvas=!0}this.resizing_node&&!this.live_mode&&(v=[f.canvasX-this.resizing_node.pos[0],f.canvasY-this.resizing_node.pos[1]],m=this.resizing_node.computeSize(),v[0]=Math.max(m[0],v[0]),v[1]=Math.max(m[1],v[1]),this.resizing_node.setSize(v),
this.canvas.style.cursor="se-resize",this.dirty_bgcanvas=this.dirty_canvas=!0)}f.preventDefault();return!1}};l.prototype.processMouseUp=function(f){this.set_canvas_dirty_on_mouse_event&&(this.dirty_canvas=!0);if(this.graph){var m=this.getCanvasWindow().document;l.active_canvas=this;m.removeEventListener("mousemove",this._mousemove_callback,!0);this.canvas.addEventListener("mousemove",this._mousemove_callback,!0);m.removeEventListener("mouseup",this._mouseup_callback,!0);this.adjustMouseEvent(f);m=
B.getTime();f.click_time=m-this.last_mouseclick;this.last_mouse_dragging=!1;this.last_click_position=null;this.block_click&&(console.log("foo"),this.block_click=!1);if(1==f.which)if(this.node_widget&&this.processNodeWidgets(this.node_widget[0],this.graph_mouse,f),this.node_widget=null,this.selected_group&&(this.selected_group.move(this.selected_group.pos[0]-Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]-Math.round(this.selected_group.pos[1]),f.ctrlKey),this.selected_group.pos[0]=
Math.round(this.selected_group.pos[0]),this.selected_group.pos[1]=Math.round(this.selected_group.pos[1]),this.selected_group._nodes.length&&(this.dirty_canvas=!0),this.selected_group=null),this.selected_group_resizing=!1,this.dragging_rectangle){if(this.graph){m=this.graph._nodes;var v=new Float32Array(4);this.deselectAllNodes();var D=Math.abs(this.dragging_rectangle[2]),C=Math.abs(this.dragging_rectangle[3]),J=0>this.dragging_rectangle[3]?this.dragging_rectangle[1]-C:this.dragging_rectangle[1];this.dragging_rectangle[0]=
0>this.dragging_rectangle[2]?this.dragging_rectangle[0]-D:this.dragging_rectangle[0];this.dragging_rectangle[1]=J;this.dragging_rectangle[2]=D;this.dragging_rectangle[3]=C;C=[];for(J=0;J<m.length;++J)D=m[J],D.getBounding(v),y(this.dragging_rectangle,v)&&C.push(D);C.length&&this.selectNodes(C)}this.dragging_rectangle=null}else if(this.connecting_node){this.dirty_bgcanvas=this.dirty_canvas=!0;if(D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes))this.connecting_output.type==B.EVENT&&
this.isOverNodeBox(D,f.canvasX,f.canvasY)?this.connecting_node.connect(this.connecting_slot,D,B.EVENT):(m=this.isOverNodeInput(D,f.canvasX,f.canvasY),-1!=m?this.connecting_node.connect(this.connecting_slot,D,m):(m=D.getInputInfo(0),this.connecting_output.type==B.EVENT?this.connecting_node.connect(this.connecting_slot,D,B.EVENT):m&&!m.link&&B.isValidConnection(m.type&&this.connecting_output.type)&&this.connecting_node.connect(this.connecting_slot,D,0)));this.connecting_node=this.connecting_pos=this.connecting_output=
null;this.connecting_slot=-1}else if(this.resizing_node)this.dirty_bgcanvas=this.dirty_canvas=!0,this.graph.afterChange(this.resizing_node),this.resizing_node=null;else if(this.node_dragged){(D=this.node_dragged)&&300>f.click_time&&r(f.canvasX,f.canvasY,D.pos[0],D.pos[1]-B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT)&&D.collapse();this.dirty_bgcanvas=this.dirty_canvas=!0;this.node_dragged.pos[0]=Math.round(this.node_dragged.pos[0]);this.node_dragged.pos[1]=Math.round(this.node_dragged.pos[1]);
this.graph.config.align_to_grid&&this.node_dragged.alignToGrid();if(this.onNodeMoved)this.onNodeMoved(this.node_dragged);this.graph.afterChange(this.node_dragged);this.node_dragged=null}else{D=this.graph.getNodeOnPos(f.canvasX,f.canvasY,this.visible_nodes);!D&&300>f.click_time&&this.deselectAllNodes();this.dirty_canvas=!0;this.dragging_canvas=!1;if(this.node_over&&this.node_over.onMouseUp)this.node_over.onMouseUp(f,[f.canvasX-this.node_over.pos[0],f.canvasY-this.node_over.pos[1]],this);if(this.node_capturing_input&&
this.node_capturing_input.onMouseUp)this.node_capturing_input.onMouseUp(f,[f.canvasX-this.node_capturing_input.pos[0],f.canvasY-this.node_capturing_input.pos[1]])}else 2==f.which?(this.dirty_canvas=!0,this.dragging_canvas=!1):3==f.which&&(this.dirty_canvas=!0,this.dragging_canvas=!1);this.graph.change();f.stopPropagation();f.preventDefault();return!1}};l.prototype.processMouseWheel=function(f){if(this.graph&&this.allow_dragcanvas){var m=null!=f.wheelDeltaY?f.wheelDeltaY:-60*f.detail;this.adjustMouseEvent(f);
var v=this.ds.scale;0<m?v*=1.1:0>m&&(v*=1/1.1);this.ds.changeScale(v,[f.localX,f.localY]);this.graph.change();f.preventDefault();return!1}};l.prototype.isOverNodeBox=function(f,m,v){var D=B.NODE_TITLE_HEIGHT;return r(m,v,f.pos[0]+2,f.pos[1]+2-D,D-4,D-4)?!0:!1};l.prototype.isOverNodeInput=function(f,m,v,D){if(f.inputs)for(var C=0,J=f.inputs.length;C<J;++C){var N=f.getConnectionPos(!0,C);if(f.horizontal?r(m,v,N[0]-5,N[1]-10,10,20):r(m,v,N[0]-10,N[1]-5,40,10))return D&&(D[0]=N[0],D[1]=N[1]),C}return-1};
l.prototype.processKey=function(f){if(this.graph){var m=!1;if("input"!=f.target.localName){if("keydown"==f.type){if(32==f.keyCode&&(m=this.dragging_canvas=!0),65==f.keyCode&&f.ctrlKey&&(this.selectNodes(),m=!0),"KeyC"==f.code&&(f.metaKey||f.ctrlKey)&&!f.shiftKey&&this.selected_nodes&&(this.copyToClipboard(),m=!0),"KeyV"!=f.code||!f.metaKey&&!f.ctrlKey||f.shiftKey||this.pasteFromClipboard(),46!=f.keyCode&&8!=f.keyCode||"input"==f.target.localName||"textarea"==f.target.localName||(this.deleteSelectedNodes(),
m=!0),this.selected_nodes)for(var v in this.selected_nodes)if(this.selected_nodes[v].onKeyDown)this.selected_nodes[v].onKeyDown(f)}else if("keyup"==f.type&&(32==f.keyCode&&(this.dragging_canvas=!1),this.selected_nodes))for(v in this.selected_nodes)if(this.selected_nodes[v].onKeyUp)this.selected_nodes[v].onKeyUp(f);this.graph.change();if(m)return f.preventDefault(),f.stopImmediatePropagation(),!1}}};l.prototype.copyToClipboard=function(){var f={nodes:[],links:[]},m=0,v=[],D;for(D in this.selected_nodes){var C=
this.selected_nodes[D];C._relative_id=m;v.push(C);m+=1}for(D=0;D<v.length;++D)if(C=v[D],m=C.clone()){if(f.nodes.push(m.serialize()),C.inputs&&C.inputs.length)for(m=0;m<C.inputs.length;++m){var J=C.inputs[m];if(J&&null!=J.link&&(J=this.graph.links[J.link])){var N=this.graph.getNodeById(J.origin_id);N&&this.selected_nodes[N.id]&&f.links.push([N._relative_id,J.origin_slot,C._relative_id,J.target_slot])}}}else console.warn("node type not found: "+C.type);localStorage.setItem("litegrapheditor_clipboard",
JSON.stringify(f))};l.prototype.pasteFromClipboard=function(){var f=localStorage.getItem("litegrapheditor_clipboard");if(f){this.graph.beforeChange();f=JSON.parse(f);for(var m=[],v=0;v<f.nodes.length;++v){var D=f.nodes[v],C=B.createNode(D.type);C&&(C.configure(D),C.pos[0]+=5,C.pos[1]+=5,this.graph.add(C),m.push(C))}for(v=0;v<f.links.length;++v){D=f.links[v];C=m[D[0]];var J=m[D[2]];C&&J?C.connect(D[1],J,D[3]):console.warn("Warning, nodes missing on pasting")}this.selectNodes(m);this.graph.afterChange()}};
l.prototype.processDrop=function(f){f.preventDefault();this.adjustMouseEvent(f);var m=[f.canvasX,f.canvasY],v=this.graph?this.graph.getNodeOnPos(m[0],m[1]):null;if(v){if((v.onDropFile||v.onDropData)&&(m=f.dataTransfer.files)&&m.length)for(var D=0;D<m.length;D++){var C=f.dataTransfer.files[0],J=C.name;l.getFileExtension(J);if(v.onDropFile)v.onDropFile(C);if(v.onDropData){var N=new FileReader;N.onload=function(T){v.onDropData(T.target.result,J,C)};var S=C.type.split("/")[0];"text"==S||""==S?N.readAsText(C):
"image"==S?N.readAsDataURL(C):N.readAsArrayBuffer(C)}}return v.onDropItem&&v.onDropItem(event)?!0:this.onDropItem?this.onDropItem(event):!1}m=null;this.onDropItem&&(m=this.onDropItem(event));m||this.checkDropItem(f)};l.prototype.checkDropItem=function(f){if(f.dataTransfer.files.length){var m=f.dataTransfer.files[0],v=l.getFileExtension(m.name).toLowerCase();if(v=B.node_types_by_file_extension[v]){this.graph.beforeChange();v=B.createNode(v.type);v.pos=[f.canvasX,f.canvasY];this.graph.add(v);if(v.onDropFile)v.onDropFile(m);
this.graph.afterChange()}}};l.prototype.processNodeDblClicked=function(f){if(this.onShowNodePanel)this.onShowNodePanel(f);else this.showShowNodePanel(f);if(this.onNodeDblClicked)this.onNodeDblClicked(f);this.setDirty(!0)};l.prototype.processNodeSelected=function(f,m){this.selectNode(f,m&&m.shiftKey);if(this.onNodeSelected)this.onNodeSelected(f)};l.prototype.selectNode=function(f,m){null==f?this.deselectAllNodes():this.selectNodes([f],m)};l.prototype.selectNodes=function(f,m){m||this.deselectAllNodes();
f=f||this.graph._nodes;for(m=0;m<f.length;++m){var v=f[m];if(!v.is_selected){if(!v.is_selected&&v.onSelected)v.onSelected();v.is_selected=!0;this.selected_nodes[v.id]=v;if(v.inputs)for(var D=0;D<v.inputs.length;++D)this.highlighted_links[v.inputs[D].link]=!0;if(v.outputs)for(D=0;D<v.outputs.length;++D){var C=v.outputs[D];if(C.links)for(var J=0;J<C.links.length;++J)this.highlighted_links[C.links[J]]=!0}}}if(this.onSelectionChange)this.onSelectionChange(this.selected_nodes);this.setDirty(!0)};l.prototype.deselectNode=
function(f){if(f.is_selected){if(f.onDeselected)f.onDeselected();f.is_selected=!1;if(this.onNodeDeselected)this.onNodeDeselected(f);if(f.inputs)for(var m=0;m<f.inputs.length;++m)delete this.highlighted_links[f.inputs[m].link];if(f.outputs)for(m=0;m<f.outputs.length;++m){var v=f.outputs[m];if(v.links)for(var D=0;D<v.links.length;++D)delete this.highlighted_links[v.links[D]]}}};l.prototype.deselectAllNodes=function(){if(this.graph){for(var f=this.graph._nodes,m=0,v=f.length;m<v;++m){var D=f[m];if(D.is_selected){if(D.onDeselected)D.onDeselected();
D.is_selected=!1;if(this.onNodeDeselected)this.onNodeDeselected(D)}}this.selected_nodes={};this.current_node=null;this.highlighted_links={};if(this.onSelectionChange)this.onSelectionChange(this.selected_nodes);this.setDirty(!0)}};l.prototype.deleteSelectedNodes=function(){this.graph.beforeChange();for(var f in this.selected_nodes){var m=this.selected_nodes[f];if(!m.block_delete){if(m.inputs&&m.inputs.length&&m.outputs&&m.outputs.length&&B.isValidConnection(m.inputs[0].type,m.outputs[0].type)&&m.inputs[0].link&&
m.outputs[0].links&&m.outputs[0].links.length){var v=m.graph.links[m.inputs[0].link],D=m.graph.links[m.outputs[0].links[0]],C=m.getInputNode(0),J=m.getOutputNodes(0)[0];C&&J&&C.connect(v.origin_slot,J,D.target_slot)}this.graph.remove(m);if(this.onNodeDeselected)this.onNodeDeselected(m)}}this.selected_nodes={};this.current_node=null;this.highlighted_links={};this.setDirty(!0);this.graph.afterChange()};l.prototype.centerOnNode=function(f){this.ds.offset[0]=-f.pos[0]-.5*f.size[0]+.5*this.canvas.width/
this.ds.scale;this.ds.offset[1]=-f.pos[1]-.5*f.size[1]+.5*this.canvas.height/this.ds.scale;this.setDirty(!0,!0)};l.prototype.adjustMouseEvent=function(f){if(this.canvas){var m=this.canvas.getBoundingClientRect();f.localX=f.clientX-m.left;f.localY=f.clientY-m.top}else f.localX=f.clientX,f.localY=f.clientY;f.deltaX=f.localX-this.last_mouse_position[0];f.deltaY=f.localY-this.last_mouse_position[1];this.last_mouse_position[0]=f.localX;this.last_mouse_position[1]=f.localY;f.canvasX=f.localX/this.ds.scale-
this.ds.offset[0];f.canvasY=f.localY/this.ds.scale-this.ds.offset[1]};l.prototype.setZoom=function(f,m){this.ds.changeScale(f,m);this.dirty_bgcanvas=this.dirty_canvas=!0};l.prototype.convertOffsetToCanvas=function(f,m){return this.ds.convertOffsetToCanvas(f,m)};l.prototype.convertCanvasToOffset=function(f,m){return this.ds.convertCanvasToOffset(f,m)};l.prototype.convertEventToCanvasOffset=function(f){var m=this.canvas.getBoundingClientRect();return this.convertCanvasToOffset([f.clientX-m.left,f.clientY-
m.top])};l.prototype.bringToFront=function(f){var m=this.graph._nodes.indexOf(f);-1!=m&&(this.graph._nodes.splice(m,1),this.graph._nodes.push(f))};l.prototype.sendToBack=function(f){var m=this.graph._nodes.indexOf(f);-1!=m&&(this.graph._nodes.splice(m,1),this.graph._nodes.unshift(f))};var F=new Float32Array(4);l.prototype.computeVisibleNodes=function(f,m){m=m||[];m.length=0;f=f||this.graph._nodes;for(var v=0,D=f.length;v<D;++v){var C=f[v];(!this.live_mode||C.onDrawBackground||C.onDrawForeground)&&
y(this.visible_area,C.getBounding(F))&&m.push(C)}return m};l.prototype.draw=function(f,m){if(this.canvas&&0!=this.canvas.width&&0!=this.canvas.height){var v=B.getTime();this.render_time=.001*(v-this.last_draw_time);this.last_draw_time=v;this.graph&&this.ds.computeVisibleArea();(this.dirty_bgcanvas||m||this.always_render_background||this.graph&&this.graph._last_trigger_time&&1E3>v-this.graph._last_trigger_time)&&this.drawBackCanvas();(this.dirty_canvas||f)&&this.drawFrontCanvas();this.fps=this.render_time?
1/this.render_time:0;this.frame+=1}};l.prototype.drawFrontCanvas=function(){this.dirty_canvas=!1;this.ctx||(this.ctx=this.bgcanvas.getContext("2d"));var f=this.ctx;if(f){f.start2D&&f.start2D();var m=this.canvas;f.restore();f.setTransform(1,0,0,1,0,0);this.dirty_area&&(f.save(),f.beginPath(),f.rect(this.dirty_area[0],this.dirty_area[1],this.dirty_area[2],this.dirty_area[3]),f.clip());this.clear_background&&f.clearRect(0,0,m.width,m.height);this.bgcanvas==this.canvas?this.drawBackCanvas():f.drawImage(this.bgcanvas,
0,0);if(this.onRender)this.onRender(m,f);this.show_info&&this.renderInfo(f);if(this.graph){f.save();this.ds.toCanvasContext(f);m=this.computeVisibleNodes(null,this.visible_nodes);for(var v=0;v<m.length;++v){var D=m[v];f.save();f.translate(D.pos[0],D.pos[1]);this.drawNode(D,f);f.restore()}this.render_execution_order&&this.drawExecutionOrder(f);this.graph.config.links_ontop&&(this.live_mode||this.drawConnections(f));if(null!=this.connecting_pos){f.lineWidth=this.connections_width;switch(this.connecting_output.type){case B.EVENT:m=
B.EVENT_LINK_COLOR;break;default:m=B.CONNECTING_LINK_COLOR}this.renderLink(f,this.connecting_pos,[this.graph_mouse[0],this.graph_mouse[1]],null,!1,null,m,this.connecting_output.dir||(this.connecting_node.horizontal?B.DOWN:B.RIGHT),B.CENTER);f.beginPath();this.connecting_output.type===B.EVENT||this.connecting_output.shape===B.BOX_SHAPE?f.rect(this.connecting_pos[0]-6+.5,this.connecting_pos[1]-5+.5,14,10):f.arc(this.connecting_pos[0],this.connecting_pos[1],4,0,2*Math.PI);f.fill();f.fillStyle="#ffcc00";
this._highlight_input&&(f.beginPath(),f.arc(this._highlight_input[0],this._highlight_input[1],6,0,2*Math.PI),f.fill())}this.dragging_rectangle&&(f.strokeStyle="#FFF",f.strokeRect(this.dragging_rectangle[0],this.dragging_rectangle[1],this.dragging_rectangle[2],this.dragging_rectangle[3]));if(this.over_link_center&&this.render_link_tooltip)this.drawLinkTooltip(f,this.over_link_center);else if(this.onDrawLinkTooltip)this.onDrawLinkTooltip(f,null);if(this.onDrawForeground)this.onDrawForeground(f,this.visible_rect);
f.restore()}this._graph_stack&&this._graph_stack.length&&this.drawSubgraphPanel(f);if(this.onDrawOverlay)this.onDrawOverlay(f);this.dirty_area&&f.restore();f.finish2D&&f.finish2D()}};l.prototype.drawSubgraphPanel=function(f){var m=this.graph,v=m._subgraph_node;if(v){var D=v.inputs?v.inputs.length:0,C=Math.floor(1.6*B.NODE_SLOT_HEIGHT);f.fillStyle="#111";f.globalAlpha=.8;f.beginPath();f.roundRect(10,10,300,(D+1)*C+50,8);f.fill();f.globalAlpha=1;f.fillStyle="#888";f.font="14px Arial";f.textAlign="left";
f.fillText("Graph Inputs",20,34);if(this.drawButton(280,20,20,20,"X","#151515"))this.closeSubgraph();else{D=50;f.font="20px Arial";if(v.inputs)for(var J=0;J<v.inputs.length;++J){var N=v.inputs[J];if(!N.not_subgraph_input){if(this.drawButton(20,D+2,280,C-2)){var S=v.constructor.input_node_type||"graph/input";this.graph.beforeChange();var T=B.createNode(S);T?(m.add(T),this.block_click=!1,this.last_click_position=null,this.selectNodes([T]),this.node_dragged=T,this.dragging_canvas=!1,T.setProperty("name",
N.name),T.setProperty("type",N.type),this.node_dragged.pos[0]=this.graph_mouse[0]-5,this.node_dragged.pos[1]=this.graph_mouse[1]-5,this.graph.afterChange()):console.error("graph input node not found:",S)}f.fillStyle="#9C9";f.beginPath();f.arc(284,D+.5*C,5,0,2*Math.PI);f.fill();f.fillStyle="#AAA";f.fillText(N.name,50,D+.75*C);S=f.measureText(N.name);f.fillStyle="#777";f.fillText(N.type,50+S.width+10,D+.75*C);D+=C}}this.drawButton(20,D+2,280,C-2,"+","#151515","#222")&&this.showSubgraphPropertiesDialog(v)}}else console.warn("subgraph without subnode")};
l.prototype.drawButton=function(f,m,v,D,C,J,N,S){var T=this.ctx;J=J||B.NODE_DEFAULT_COLOR;N=N||"#555";S=S||B.NODE_TEXT_COLOR;var W=this.mouse,Y=B.isInsideRectangle(W[0],W[1],f,m,v,D);W=(W=this.last_click_position)&&B.isInsideRectangle(W[0],W[1],f,m,v,D);T.fillStyle=Y?N:J;W&&(T.fillStyle="#AAA");T.beginPath();T.roundRect(f,m,v,D,4);T.fill();null!=C&&C.constructor==String&&(T.fillStyle=S,T.textAlign="center",T.font=(.65*D|0)+"px Arial",T.fillText(C,f+.5*v,m+.75*D),T.textAlign="left");f=W&&!this.block_click;
W&&this.blockClick();return f};l.prototype.isAreaClicked=function(f,m,v,D,C){var J=this.mouse;B.isInsideRectangle(J[0],J[1],f,m,v,D);m=(f=(J=this.last_click_position)&&B.isInsideRectangle(J[0],J[1],f,m,v,D))&&!this.block_click;f&&C&&this.blockClick();return m};l.prototype.renderInfo=function(f,m,v){m=m||10;v=v||this.canvas.height-80;f.save();f.translate(m,v);f.font="10px Arial";f.fillStyle="#888";this.graph?(f.fillText("T: "+this.graph.globaltime.toFixed(2)+"s",5,13),f.fillText("I: "+this.graph.iteration,
5,26),f.fillText("N: "+this.graph._nodes.length+" ["+this.visible_nodes.length+"]",5,39),f.fillText("V: "+this.graph._version,5,52),f.fillText("FPS:"+this.fps.toFixed(2),5,65)):f.fillText("No graph selected",5,13);f.restore()};l.prototype.drawBackCanvas=function(){var f=this.bgcanvas;if(f.width!=this.canvas.width||f.height!=this.canvas.height)f.width=this.canvas.width,f.height=this.canvas.height;this.bgctx||(this.bgctx=this.bgcanvas.getContext("2d"));var m=this.bgctx;m.start&&m.start();this.clear_background&&
m.clearRect(0,0,f.width,f.height);if(this._graph_stack&&this._graph_stack.length){m.save();var v=this.graph._subgraph_node;m.strokeStyle=v.bgcolor;m.lineWidth=10;m.strokeRect(1,1,f.width-2,f.height-2);m.lineWidth=1;m.font="40px Arial";m.textAlign="center";m.fillStyle=v.bgcolor||"#AAA";for(var D="",C=1;C<this._graph_stack.length;++C)D+=this._graph_stack[C]._subgraph_node.getTitle()+" >> ";m.fillText(D+v.getTitle(),.5*f.width,40);m.restore()}v=!1;this.onRenderBackground&&(v=this.onRenderBackground(f,
m));m.restore();m.setTransform(1,0,0,1,0,0);this.visible_links.length=0;if(this.graph){m.save();this.ds.toCanvasContext(m);if(this.background_image&&.5<this.ds.scale&&!v){m.globalAlpha=this.zoom_modify_alpha?(1-.5/this.ds.scale)*this.editor_alpha:this.editor_alpha;m.imageSmoothingEnabled=m.mozImageSmoothingEnabled=m.imageSmoothingEnabled=!1;if(!this._bg_img||this._bg_img.name!=this.background_image){this._bg_img=new Image;this._bg_img.name=this.background_image;this._bg_img.src=this.background_image;
var J=this;this._bg_img.onload=function(){J.draw(!0,!0)}}v=null;null==this._pattern&&0<this._bg_img.width?(v=m.createPattern(this._bg_img,"repeat"),this._pattern_img=this._bg_img,this._pattern=v):v=this._pattern;v&&(m.fillStyle=v,m.fillRect(this.visible_area[0],this.visible_area[1],this.visible_area[2],this.visible_area[3]),m.fillStyle="transparent");m.globalAlpha=1;m.imageSmoothingEnabled=m.mozImageSmoothingEnabled=m.imageSmoothingEnabled=!0}this.graph._groups.length&&!this.live_mode&&this.drawGroups(f,
m);if(this.onDrawBackground)this.onDrawBackground(m,this.visible_area);this.onBackgroundRender&&(console.error("WARNING! onBackgroundRender deprecated, now is named onDrawBackground "),this.onBackgroundRender=null);this.render_canvas_border&&(m.strokeStyle="#235",m.strokeRect(0,0,f.width,f.height));this.render_connections_shadows?(m.shadowColor="#000",m.shadowOffsetX=0,m.shadowOffsetY=0,m.shadowBlur=6):m.shadowColor="rgba(0,0,0,0)";this.live_mode||this.drawConnections(m);m.shadowColor="rgba(0,0,0,0)";
m.restore()}m.finish&&m.finish();this.dirty_bgcanvas=!1;this.dirty_canvas=!0};var I=new Float32Array(2);l.prototype.drawNode=function(f,m){this.current_node=f;var v=f.color||f.constructor.color||B.NODE_DEFAULT_COLOR,D=f.bgcolor||f.constructor.bgcolor||B.NODE_DEFAULT_BGCOLOR,C=.6>this.ds.scale;if(this.live_mode){if(!f.flags.collapsed&&(m.shadowColor="transparent",f.onDrawForeground))f.onDrawForeground(m,this,this.canvas)}else{var J=this.editor_alpha;m.globalAlpha=J;this.render_shadows&&!C?(m.shadowColor=
B.DEFAULT_SHADOW_COLOR,m.shadowOffsetX=2*this.ds.scale,m.shadowOffsetY=2*this.ds.scale,m.shadowBlur=3*this.ds.scale):m.shadowColor="transparent";if(!f.flags.collapsed||!f.onDrawCollapsed||1!=f.onDrawCollapsed(m,this)){var N=f._shape||B.BOX_SHAPE;I.set(f.size);var S=f.horizontal;if(f.flags.collapsed){m.font=this.inner_text_font;var T=f.getTitle?f.getTitle():f.title;null!=T&&(f._collapsed_width=Math.min(f.size[0],m.measureText(T).width+2*B.NODE_TITLE_HEIGHT),I[0]=f._collapsed_width,I[1]=0)}f.clip_area&&
(m.save(),m.beginPath(),N==B.BOX_SHAPE?m.rect(0,0,I[0],I[1]):N==B.ROUND_SHAPE?m.roundRect(0,0,I[0],I[1],10):N==B.CIRCLE_SHAPE&&m.arc(.5*I[0],.5*I[1],.5*I[0],0,2*Math.PI),m.clip());f.has_errors&&(D="red");this.drawNodeShape(f,m,I,v,D,f.is_selected,f.mouseOver);m.shadowColor="transparent";if(f.onDrawForeground)f.onDrawForeground(m,this,this.canvas);m.textAlign=S?"center":"left";m.font=this.inner_text_font;D=!C;N=this.connecting_output;m.lineWidth=1;T=0;var W=new Float32Array(2);if(!f.flags.collapsed){if(f.inputs)for(v=
0;v<f.inputs.length;v++){var Y=f.inputs[v];m.globalAlpha=J;this.connecting_node&&!B.isValidConnection(Y.type,N.type)&&(m.globalAlpha=.4*J);m.fillStyle=null!=Y.link?Y.color_on||this.default_connection_color.input_on:Y.color_off||this.default_connection_color.input_off;var V=f.getConnectionPos(!0,v,W);V[0]-=f.pos[0];V[1]-=f.pos[1];T<V[1]+.5*B.NODE_SLOT_HEIGHT&&(T=V[1]+.5*B.NODE_SLOT_HEIGHT);m.beginPath();Y.type===B.EVENT||Y.shape===B.BOX_SHAPE?S?m.rect(V[0]-5+.5,V[1]-8+.5,10,14):m.rect(V[0]-6+.5,V[1]-
5+.5,14,10):Y.shape===B.ARROW_SHAPE?(m.moveTo(V[0]+8,V[1]+.5),m.lineTo(V[0]-4,V[1]+6+.5),m.lineTo(V[0]-4,V[1]-6+.5),m.closePath()):C?m.rect(V[0]-4,V[1]-4,8,8):m.arc(V[0],V[1],4,0,2*Math.PI);m.fill();if(D){var ma=null!=Y.label?Y.label:Y.name;ma&&(m.fillStyle=B.NODE_TEXT_COLOR,S||Y.dir==B.UP?m.fillText(ma,V[0],V[1]-10):m.fillText(ma,V[0]+10,V[1]+5))}}this.connecting_node&&(m.globalAlpha=.4*J);m.textAlign=S?"center":"right";m.strokeStyle="black";if(f.outputs)for(v=0;v<f.outputs.length;v++)if(Y=f.outputs[v],
V=f.getConnectionPos(!1,v,W),V[0]-=f.pos[0],V[1]-=f.pos[1],T<V[1]+.5*B.NODE_SLOT_HEIGHT&&(T=V[1]+.5*B.NODE_SLOT_HEIGHT),m.fillStyle=Y.links&&Y.links.length?Y.color_on||this.default_connection_color.output_on:Y.color_off||this.default_connection_color.output_off,m.beginPath(),Y.type===B.EVENT||Y.shape===B.BOX_SHAPE?S?m.rect(V[0]-5+.5,V[1]-8+.5,10,14):m.rect(V[0]-6+.5,V[1]-5+.5,14,10):Y.shape===B.ARROW_SHAPE?(m.moveTo(V[0]+8,V[1]+.5),m.lineTo(V[0]-4,V[1]+6+.5),m.lineTo(V[0]-4,V[1]-6+.5),m.closePath()):
C?m.rect(V[0]-4,V[1]-4,8,8):m.arc(V[0],V[1],4,0,2*Math.PI),m.fill(),C||m.stroke(),D&&(ma=null!=Y.label?Y.label:Y.name))m.fillStyle=B.NODE_TEXT_COLOR,S||Y.dir==B.DOWN?m.fillText(ma,V[0],V[1]-8):m.fillText(ma,V[0]-10,V[1]+5);m.textAlign="left";m.globalAlpha=1;if(f.widgets){Y=T;if(S||f.widgets_up)Y=2;null!=f.widgets_start_y&&(Y=f.widgets_start_y);this.drawNodeWidgets(f,Y,m,this.node_widget&&this.node_widget[0]==f?this.node_widget[1]:null)}}else if(this.render_collapsed_slots){C=J=null;if(f.inputs)for(v=
0;v<f.inputs.length;v++)if(Y=f.inputs[v],null!=Y.link){J=Y;break}if(f.outputs)for(v=0;v<f.outputs.length;v++)Y=f.outputs[v],Y.links&&Y.links.length&&(C=Y);J&&(J=0,v=-.5*B.NODE_TITLE_HEIGHT,S&&(J=.5*f._collapsed_width,v=-B.NODE_TITLE_HEIGHT),m.fillStyle="#686",m.beginPath(),Y.type===B.EVENT||Y.shape===B.BOX_SHAPE?m.rect(J-7+.5,v-4,14,8):Y.shape===B.ARROW_SHAPE?(m.moveTo(J+8,v),m.lineTo(J+-4,v-4),m.lineTo(J+-4,v+4),m.closePath()):m.arc(J,v,4,0,2*Math.PI),m.fill());C&&(J=f._collapsed_width,v=-.5*B.NODE_TITLE_HEIGHT,
S&&(J=.5*f._collapsed_width,v=0),m.fillStyle="#686",m.strokeStyle="black",m.beginPath(),Y.type===B.EVENT||Y.shape===B.BOX_SHAPE?m.rect(J-7+.5,v-4,14,8):Y.shape===B.ARROW_SHAPE?(m.moveTo(J+6,v),m.lineTo(J-6,v-4),m.lineTo(J-6,v+4),m.closePath()):m.arc(J,v,4,0,2*Math.PI),m.fill())}f.clip_area&&m.restore();m.globalAlpha=1}}};l.prototype.drawLinkTooltip=function(f,m){var v=m._pos;f.fillStyle="black";f.beginPath();f.arc(v[0],v[1],3,0,2*Math.PI);f.fill();if(null!=m.data&&(!this.onDrawLinkTooltip||1!=this.onDrawLinkTooltip(f,
m,this))&&(m=m.data,m=m.constructor===Number?m.toFixed(2):m.constructor===String?'"'+m+'"':m.constructor===Boolean?String(m):m.toToolTip?m.toToolTip():"["+m.constructor.name+"]",null!=m)){m=m.substr(0,30);f.font="14px Courier New";var D=f.measureText(m).width+20;f.shadowColor="black";f.shadowOffsetX=2;f.shadowOffsetY=2;f.shadowBlur=3;f.fillStyle="#454";f.beginPath();f.roundRect(v[0]-.5*D,v[1]-15-24,D,24,3,3);f.moveTo(v[0]-10,v[1]-15);f.lineTo(v[0]+10,v[1]-15);f.lineTo(v[0],v[1]-5);f.fill();f.shadowColor=
"transparent";f.textAlign="center";f.fillStyle="#CEC";f.fillText(m,v[0],v[1]-15-24*.3)}};var L=new Float32Array(4);l.prototype.drawNodeShape=function(f,m,v,D,C,J,N){m.strokeStyle=D;m.fillStyle=C;C=B.NODE_TITLE_HEIGHT;var S=.5>this.ds.scale,T=f._shape||f.constructor.shape||B.ROUND_SHAPE,W=f.constructor.title_mode,Y=!0;W==B.TRANSPARENT_TITLE?Y=!1:W==B.AUTOHIDE_TITLE&&N&&(Y=!0);L[0]=0;L[1]=Y?-C:0;L[2]=v[0]+1;L[3]=Y?v[1]+C:v[1];N=m.globalAlpha;m.beginPath();T==B.BOX_SHAPE||S?m.fillRect(L[0],L[1],L[2],
L[3]):T==B.ROUND_SHAPE||T==B.CARD_SHAPE?m.roundRect(L[0],L[1],L[2],L[3],this.round_radius,T==B.CARD_SHAPE?0:this.round_radius):T==B.CIRCLE_SHAPE&&m.arc(.5*v[0],.5*v[1],.5*v[0],0,2*Math.PI);m.fill();f.flags.collapsed||(m.shadowColor="transparent",m.fillStyle="rgba(0,0,0,0.2)",m.fillRect(0,-1,L[2],2));m.shadowColor="transparent";if(f.onDrawBackground)f.onDrawBackground(m,this,this.canvas,this.graph_mouse);if(Y||W==B.TRANSPARENT_TITLE){if(f.onDrawTitleBar)f.onDrawTitleBar(m,C,v,this.ds.scale,D);else if(W!=
B.TRANSPARENT_TITLE&&(f.constructor.title_color||this.render_title_colored)){Y=f.constructor.title_color||D;f.flags.collapsed&&(m.shadowColor=B.DEFAULT_SHADOW_COLOR);if(this.use_gradients){var V=l.gradients[Y];V||(V=l.gradients[Y]=m.createLinearGradient(0,0,400,0),V.addColorStop(0,Y),V.addColorStop(.25,D));m.fillStyle=V}else m.fillStyle=Y;m.beginPath();T==B.BOX_SHAPE||S?m.rect(0,-C,v[0]+1,C):(T==B.ROUND_SHAPE||T==B.CARD_SHAPE)&&m.roundRect(0,-C,v[0]+1,C,this.round_radius,f.flags.collapsed?this.round_radius:
0);m.fill();m.shadowColor="transparent"}if(f.onDrawTitleBox)f.onDrawTitleBox(m,C,v,this.ds.scale);else T==B.ROUND_SHAPE||T==B.CIRCLE_SHAPE||T==B.CARD_SHAPE?(S&&(m.fillStyle="black",m.beginPath(),m.arc(.5*C,-.5*C,6,0,2*Math.PI),m.fill()),m.fillStyle=f.boxcolor||B.NODE_DEFAULT_BOXCOLOR,S?m.fillRect(.5*C-5,-.5*C-5,10,10):(m.beginPath(),m.arc(.5*C,-.5*C,5,0,2*Math.PI),m.fill())):(S&&(m.fillStyle="black",m.fillRect(.5*(C-10)-1,-.5*(C+10)-1,12,12)),m.fillStyle=f.boxcolor||B.NODE_DEFAULT_BOXCOLOR,m.fillRect(.5*
(C-10),-.5*(C+10),10,10));m.globalAlpha=N;if(f.onDrawTitleText)f.onDrawTitleText(m,C,v,this.ds.scale,this.title_text_font,J);!S&&(m.font=this.title_text_font,N=String(f.getTitle()))&&(m.fillStyle=J?"white":f.constructor.title_text_color||this.node_title_color,f.flags.collapsed?(m.textAlign="left",m.measureText(N),m.fillText(N.substr(0,20),C,B.NODE_TITLE_TEXT_Y-C),m.textAlign="left"):(m.textAlign="left",m.fillText(N,C,B.NODE_TITLE_TEXT_Y-C)));f.flags.collapsed||!f.subgraph||f.skip_subgraph_button||
(N=B.NODE_TITLE_HEIGHT,Y=f.size[0]-N,V=B.isInsideRectangle(this.graph_mouse[0]-f.pos[0],this.graph_mouse[1]-f.pos[1],Y+2,-N+2,N-4,N-4),m.fillStyle=V?"#888":"#555",T==B.BOX_SHAPE||S?m.fillRect(Y+2,-N+2,N-4,N-4):(m.beginPath(),m.roundRect(Y+2,-N+2,N-4,N-4,4),m.fill()),m.fillStyle="#333",m.beginPath(),m.moveTo(Y+.2*N,.6*-N),m.lineTo(Y+.8*N,.6*-N),m.lineTo(Y+.5*N,.3*-N),m.fill());if(f.onDrawTitle)f.onDrawTitle(m)}if(J){if(f.onBounding)f.onBounding(L);W==B.TRANSPARENT_TITLE&&(L[1]-=C,L[3]+=C);m.lineWidth=
1;m.globalAlpha=.8;m.beginPath();T==B.BOX_SHAPE?m.rect(-6+L[0],-6+L[1],12+L[2],12+L[3]):T==B.ROUND_SHAPE||T==B.CARD_SHAPE&&f.flags.collapsed?m.roundRect(-6+L[0],-6+L[1],12+L[2],12+L[3],2*this.round_radius):T==B.CARD_SHAPE?m.roundRect(-6+L[0],-6+L[1],12+L[2],12+L[3],2*this.round_radius,2):T==B.CIRCLE_SHAPE&&m.arc(.5*v[0],.5*v[1],.5*v[0]+6,0,2*Math.PI);m.strokeStyle="#FFF";m.stroke();m.strokeStyle=D;m.globalAlpha=1}};var U=new Float32Array(4),n=new Float32Array(4),w=new Float32Array(2),G=new Float32Array(2);
l.prototype.drawConnections=function(f){var m=B.getTime(),v=this.visible_area;U[0]=v[0]-20;U[1]=v[1]-20;U[2]=v[2]+40;U[3]=v[3]+40;f.lineWidth=this.connections_width;f.fillStyle="#AAA";f.strokeStyle="#AAA";f.globalAlpha=this.editor_alpha;v=this.graph._nodes;for(var D=0,C=v.length;D<C;++D){var J=v[D];if(J.inputs&&J.inputs.length)for(var N=0;N<J.inputs.length;++N){var S=J.inputs[N];if(S&&null!=S.link&&(S=this.graph.links[S.link])){var T=this.graph.getNodeById(S.origin_id);if(null!=T){var W=S.origin_slot;
var Y=-1==W?[T.pos[0]+10,T.pos[1]+10]:T.getConnectionPos(!1,W,w);var V=J.getConnectionPos(!0,N,G);n[0]=Y[0];n[1]=Y[1];n[2]=V[0]-Y[0];n[3]=V[1]-Y[1];0>n[2]&&(n[0]+=n[2],n[2]=Math.abs(n[2]));0>n[3]&&(n[1]+=n[3],n[3]=Math.abs(n[3]));if(y(n,U)){var ma=T.outputs[W];W=J.inputs[N];if(ma&&W&&(T=ma.dir||(T.horizontal?B.DOWN:B.RIGHT),W=W.dir||(J.horizontal?B.UP:B.LEFT),this.renderLink(f,Y,V,S,!1,0,null,T,W),S&&S._last_time&&1E3>m-S._last_time)){ma=2-.002*(m-S._last_time);var ha=f.globalAlpha;f.globalAlpha=
ha*ma;this.renderLink(f,Y,V,S,!0,ma,"white",T,W);f.globalAlpha=ha}}}}}}f.globalAlpha=1};l.prototype.renderLink=function(f,m,v,D,C,J,N,S,T,W){D&&this.visible_links.push(D);!N&&D&&(N=D.color||l.link_type_colors[D.type]);N||(N=this.default_link_color);null!=D&&this.highlighted_links[D.id]&&(N="#FFF");S=S||B.RIGHT;T=T||B.LEFT;var Y=t(m,v);this.render_connections_border&&.6<this.ds.scale&&(f.lineWidth=this.connections_width+4);f.lineJoin="round";W=W||1;1<W&&(f.lineWidth=.5);f.beginPath();for(var V=0;V<
W;V+=1){var ma=5*(V-.5*(W-1));if(this.links_render_mode==B.SPLINE_LINK){f.moveTo(m[0],m[1]+ma);var ha=0,ia=0,aa=0,ea=0;switch(S){case B.LEFT:ha=-.25*Y;break;case B.RIGHT:ha=.25*Y;break;case B.UP:ia=-.25*Y;break;case B.DOWN:ia=.25*Y}switch(T){case B.LEFT:aa=-.25*Y;break;case B.RIGHT:aa=.25*Y;break;case B.UP:ea=-.25*Y;break;case B.DOWN:ea=.25*Y}f.bezierCurveTo(m[0]+ha,m[1]+ia+ma,v[0]+aa,v[1]+ea+ma,v[0],v[1]+ma)}else if(this.links_render_mode==B.LINEAR_LINK){f.moveTo(m[0],m[1]+ma);ea=aa=ia=ha=0;switch(S){case B.LEFT:ha=
-1;break;case B.RIGHT:ha=1;break;case B.UP:ia=-1;break;case B.DOWN:ia=1}switch(T){case B.LEFT:aa=-1;break;case B.RIGHT:aa=1;break;case B.UP:ea=-1;break;case B.DOWN:ea=1}f.lineTo(m[0]+15*ha,m[1]+15*ia+ma);f.lineTo(v[0]+15*aa,v[1]+15*ea+ma);f.lineTo(v[0],v[1]+ma)}else if(this.links_render_mode==B.STRAIGHT_LINK)f.moveTo(m[0],m[1]),ma=m[0],ha=m[1],ia=v[0],aa=v[1],S==B.RIGHT?ma+=10:ha+=10,T==B.LEFT?ia-=10:aa-=10,f.lineTo(ma,ha),f.lineTo(.5*(ma+ia),ha),f.lineTo(.5*(ma+ia),aa),f.lineTo(ia,aa),f.lineTo(v[0],
v[1]);else return}this.render_connections_border&&.6<this.ds.scale&&!C&&(f.strokeStyle="rgba(0,0,0,0.5)",f.stroke());f.lineWidth=this.connections_width;f.fillStyle=f.strokeStyle=N;f.stroke();C=this.computeConnectionPoint(m,v,.5,S,T);D&&D._pos&&(D._pos[0]=C[0],D._pos[1]=C[1]);.6<=this.ds.scale&&this.highquality_render&&T!=B.CENTER&&(this.render_connection_arrows&&(V=this.computeConnectionPoint(m,v,.25,S,T),Y=this.computeConnectionPoint(m,v,.26,S,T),D=this.computeConnectionPoint(m,v,.75,S,T),W=this.computeConnectionPoint(m,
v,.76,S,T),this.render_curved_connections?(Y=-Math.atan2(Y[0]-V[0],Y[1]-V[1]),W=-Math.atan2(W[0]-D[0],W[1]-D[1])):W=Y=v[1]>m[1]?0:Math.PI,f.save(),f.translate(V[0],V[1]),f.rotate(Y),f.beginPath(),f.moveTo(-5,-3),f.lineTo(0,7),f.lineTo(5,-3),f.fill(),f.restore(),f.save(),f.translate(D[0],D[1]),f.rotate(W),f.beginPath(),f.moveTo(-5,-3),f.lineTo(0,7),f.lineTo(5,-3),f.fill(),f.restore()),f.beginPath(),f.arc(C[0],C[1],5,0,2*Math.PI),f.fill());if(J)for(f.fillStyle=N,V=0;5>V;++V)J=(.001*B.getTime()+.2*V)%
1,C=this.computeConnectionPoint(m,v,J,S,T),f.beginPath(),f.arc(C[0],C[1],5,0,2*Math.PI),f.fill()};l.prototype.computeConnectionPoint=function(f,m,v,D,C){D=D||B.RIGHT;C=C||B.LEFT;var J=t(f,m),N=[f[0],f[1]],S=[m[0],m[1]];switch(D){case B.LEFT:N[0]+=-.25*J;break;case B.RIGHT:N[0]+=.25*J;break;case B.UP:N[1]+=-.25*J;break;case B.DOWN:N[1]+=.25*J}switch(C){case B.LEFT:S[0]+=-.25*J;break;case B.RIGHT:S[0]+=.25*J;break;case B.UP:S[1]+=-.25*J;break;case B.DOWN:S[1]+=.25*J}D=(1-v)*(1-v)*(1-v);C=3*(1-v)*(1-
v)*v;J=3*(1-v)*v*v;v*=v*v;return[D*f[0]+C*N[0]+J*S[0]+v*m[0],D*f[1]+C*N[1]+J*S[1]+v*m[1]]};l.prototype.drawExecutionOrder=function(f){f.shadowColor="transparent";f.globalAlpha=.25;f.textAlign="center";f.strokeStyle="white";f.globalAlpha=.75;for(var m=this.visible_nodes,v=0;v<m.length;++v){var D=m[v];f.fillStyle="black";f.fillRect(D.pos[0]-B.NODE_TITLE_HEIGHT,D.pos[1]-B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT);0==D.order&&f.strokeRect(D.pos[0]-B.NODE_TITLE_HEIGHT+.5,D.pos[1]-B.NODE_TITLE_HEIGHT+
.5,B.NODE_TITLE_HEIGHT,B.NODE_TITLE_HEIGHT);f.fillStyle="#FFF";f.fillText(D.order,D.pos[0]+-.5*B.NODE_TITLE_HEIGHT,D.pos[1]-6)}f.globalAlpha=1};l.prototype.drawNodeWidgets=function(f,m,v,D){if(!f.widgets||!f.widgets.length)return 0;var C=f.size[0],J=f.widgets;m+=2;var N=B.NODE_WIDGET_HEIGHT,S=.5<this.ds.scale;v.save();v.globalAlpha=this.editor_alpha;for(var T=B.WIDGET_OUTLINE_COLOR,W=B.WIDGET_BGCOLOR,Y=B.WIDGET_TEXT_COLOR,V=B.WIDGET_SECONDARY_TEXT_COLOR,ma=0;ma<J.length;++ma){var ha=J[ma],ia=m;ha.y&&
(ia=ha.y);ha.last_y=ia;v.strokeStyle=T;v.fillStyle="#222";v.textAlign="left";ha.disabled&&(v.globalAlpha*=.5);var aa=ha.width||C;switch(ha.type){case "button":ha.clicked&&(v.fillStyle="#AAA",ha.clicked=!1,this.dirty_canvas=!0);v.fillRect(15,ia,aa-30,N);S&&!ha.disabled&&v.strokeRect(15,ia,aa-30,N);S&&(v.textAlign="center",v.fillStyle=Y,v.fillText(ha.name,.5*aa,ia+.7*N));break;case "toggle":v.textAlign="left";v.strokeStyle=T;v.fillStyle=W;v.beginPath();S?v.roundRect(15,m,aa-30,N,.5*N):v.rect(15,m,aa-
30,N);v.fill();S&&!ha.disabled&&v.stroke();v.fillStyle=ha.value?"#89A":"#333";v.beginPath();v.arc(aa-30,ia+.5*N,.36*N,0,2*Math.PI);v.fill();S&&(v.fillStyle=V,null!=ha.name&&v.fillText(ha.name,30,ia+.7*N),v.fillStyle=ha.value?Y:V,v.textAlign="right",v.fillText(ha.value?ha.options.on||"true":ha.options.off||"false",aa-40,ia+.7*N));break;case "slider":v.fillStyle=W;v.fillRect(15,ia,aa-30,N);var ea=ha.options.max-ha.options.min,ja=(ha.value-ha.options.min)/ea;v.fillStyle=D==ha?"#89A":"#678";v.fillRect(15,
ia,ja*(aa-30),N);S&&!ha.disabled&&v.strokeRect(15,ia,aa-30,N);ha.marker&&(ea=(ha.marker-ha.options.min)/ea,v.fillStyle="#AA9",v.fillRect(15+ea*(aa-30),ia,2,N));S&&(v.textAlign="center",v.fillStyle=Y,v.fillText(ha.name+"  "+Number(ha.value).toFixed(3),.5*aa,ia+.7*N));break;case "number":case "combo":v.textAlign="left";v.strokeStyle=T;v.fillStyle=W;v.beginPath();S?v.roundRect(15,m,aa-30,N,.5*N):v.rect(15,m,aa-30,N);v.fill();S&&(ha.disabled||v.stroke(),v.fillStyle=Y,ha.disabled||(v.beginPath(),v.moveTo(31,
m+5),v.lineTo(21,m+.5*N),v.lineTo(31,m+N-5),v.fill(),v.beginPath(),v.moveTo(aa-15-16,m+5),v.lineTo(aa-15-6,m+.5*N),v.lineTo(aa-15-16,m+N-5),v.fill()),v.fillStyle=V,v.fillText(ha.name,35,ia+.7*N),v.fillStyle=Y,v.textAlign="right","number"==ha.type?v.fillText(Number(ha.value).toFixed(void 0!==ha.options.precision?ha.options.precision:3),aa-30-20,ia+.7*N):(ea=ha.value,ha.options.values&&(ja=ha.options.values,ja.constructor===Function&&(ja=ja()),ja&&ja.constructor!==Array&&(ea=ja[ha.value])),v.fillText(ea,
aa-30-20,ia+.7*N)));break;case "string":case "text":v.textAlign="left";v.strokeStyle=T;v.fillStyle=W;v.beginPath();S?v.roundRect(15,m,aa-30,N,.5*N):v.rect(15,m,aa-30,N);v.fill();S&&(v.save(),v.beginPath(),v.rect(15,m,aa-30,N),v.clip(),v.stroke(),v.fillStyle=V,null!=ha.name&&v.fillText(ha.name,30,ia+.7*N),v.fillStyle=Y,v.textAlign="right",v.fillText(String(ha.value).substr(0,30),aa-30,ia+.7*N),v.restore());break;default:ha.draw&&ha.draw(v,f,aa,ia,N)}m+=(ha.computeSize?ha.computeSize(aa)[1]:N)+4;v.globalAlpha=
this.editor_alpha}v.restore();v.textAlign="left"};l.prototype.processNodeWidgets=function(f,m,v,D){function C(ja,Q){ja.value=Q;ja.options&&ja.options.property&&void 0!==f.properties[ja.options.property]&&f.setProperty(ja.options.property,Q);ja.callback&&ja.callback(ja.value,T,f,m,v)}if(!f.widgets||!f.widgets.length)return null;for(var J=m[0]-f.pos[0],N=m[1]-f.pos[1],S=f.size[0],T=this,W=this.getCanvasWindow(),Y=0;Y<f.widgets.length;++Y){var V=f.widgets[Y];if(V&&!V.disabled){var ma=V.computeSize?V.computeSize(S)[1]:
B.NODE_WIDGET_HEIGHT,ha=V.width||S;if(V==D||!(6>J||J>ha-12||N<V.last_y||N>V.last_y+ma)){D=V.value;switch(V.type){case "button":if("mousemove"===v.type)break;V.callback&&setTimeout(function(){V.callback(V,T,f,m,v)},20);this.dirty_canvas=V.clicked=!0;break;case "slider":W=Math.clamp((J-10)/(ha-20),0,1);V.value=V.options.min+(V.options.max-V.options.min)*W;V.callback&&setTimeout(function(){C(V,V.value)},20);this.dirty_canvas=!0;break;case "number":case "combo":D=V.value;if("mousemove"==v.type&&"number"==
V.type)V.value+=.1*v.deltaX*(V.options.step||1),null!=V.options.min&&V.value<V.options.min&&(V.value=V.options.min),null!=V.options.max&&V.value>V.options.max&&(V.value=V.options.max);else if("mousedown"==v.type){var ia=V.options.values;ia&&ia.constructor===Function&&(ia=V.options.values(V,f));var aa=null;"number"!=V.type&&(aa=ia.constructor===Array?ia:Object.keys(ia));J=40>J?-1:J>ha-40?1:0;if("number"==V.type)V.value+=.1*J*(V.options.step||1),null!=V.options.min&&V.value<V.options.min&&(V.value=
V.options.min),null!=V.options.max&&V.value>V.options.max&&(V.value=V.options.max);else if(J)W=-1,this.last_mouseclick=0,W=ia.constructor===Object?aa.indexOf(String(V.value))+J:aa.indexOf(V.value)+J,W>=aa.length&&(W=aa.length-1),0>W&&(W=0),V.value=ia.constructor===Array?ia[W]:W;else{var ea=ia!=aa?Object.values(ia):ia;new B.ContextMenu(ea,{scale:Math.max(1,this.ds.scale),event:v,className:"dark",callback:function(ja,Q,X){ia!=aa&&(ja=ea.indexOf(ja));this.value=ja;C(this,ja);T.dirty_canvas=!0;return!1}.bind(V)},
W)}}else"mouseup"==v.type&&"number"==V.type&&(J=40>J?-1:J>ha-40?1:0,200>v.click_time&&0==J&&this.prompt("Value",V.value,function(ja){this.value=Number(ja);C(this,this.value)}.bind(V),v));D!=V.value&&setTimeout(function(){C(this,this.value)}.bind(V),20);this.dirty_canvas=!0;break;case "toggle":"mousedown"==v.type&&(V.value=!V.value,setTimeout(function(){C(V,V.value)},20));break;case "string":case "text":"mousedown"==v.type&&this.prompt("Value",V.value,function(ja){this.value=ja;C(this,ja)}.bind(V),
v);break;default:V.mouse&&(this.dirty_canvas=V.mouse(v,[J,N],f))}if(D!=V.value){if(f.onWidgetChanged)f.onWidgetChanged(V.name,V.value,D,V);f.graph._version++}return V}}}return null};l.prototype.drawGroups=function(f,m){if(this.graph){f=this.graph._groups;m.save();m.globalAlpha=.5*this.editor_alpha;for(var v=0;v<f.length;++v){var D=f[v];if(y(this.visible_area,D._bounding)){m.fillStyle=D.color||"#335";m.strokeStyle=D.color||"#335";var C=D._pos,J=D._size;m.globalAlpha=.25*this.editor_alpha;m.beginPath();
m.rect(C[0]+.5,C[1]+.5,J[0],J[1]);m.fill();m.globalAlpha=this.editor_alpha;m.stroke();m.beginPath();m.moveTo(C[0]+J[0],C[1]+J[1]);m.lineTo(C[0]+J[0]-10,C[1]+J[1]);m.lineTo(C[0]+J[0],C[1]+J[1]-10);m.fill();J=D.font_size||B.DEFAULT_GROUP_FONT_SIZE;m.font=J+"px Arial";m.fillText(D.title,C[0]+4,C[1]+J)}}m.restore()}};l.prototype.adjustNodesSize=function(){for(var f=this.graph._nodes,m=0;m<f.length;++m)f[m].size=f[m].computeSize();this.setDirty(!0,!0)};l.prototype.resize=function(f,m){f||m||(m=this.canvas.parentNode,
f=m.offsetWidth,m=m.offsetHeight);if(this.canvas.width!=f||this.canvas.height!=m)this.canvas.width=f,this.canvas.height=m,this.bgcanvas.width=this.canvas.width,this.bgcanvas.height=this.canvas.height,this.setDirty(!0,!0)};l.prototype.switchLiveMode=function(f){if(f){var m=this,v=this.live_mode?1.1:.9;this.live_mode&&(this.live_mode=!1,this.editor_alpha=.1);var D=setInterval(function(){m.editor_alpha*=v;m.dirty_canvas=!0;m.dirty_bgcanvas=!0;1>v&&.01>m.editor_alpha&&(clearInterval(D),1>v&&(m.live_mode=
!0));1<v&&.99<m.editor_alpha&&(clearInterval(D),m.editor_alpha=1)},1)}else this.live_mode=!this.live_mode,this.dirty_bgcanvas=this.dirty_canvas=!0};l.prototype.onNodeSelectionChange=function(f){};l.prototype.touchHandler=function(f){var m=f.changedTouches[0];switch(f.type){case "touchstart":var v="mousedown";break;case "touchmove":v="mousemove";break;case "touchend":v="mouseup";break;default:return}var D=this.getCanvasWindow(),C=D.document.createEvent("MouseEvent");C.initMouseEvent(v,!0,!0,D,1,m.screenX,
m.screenY,m.clientX,m.clientY,!1,!1,!1,!1,0,null);m.target.dispatchEvent(C);f.preventDefault()};l.onGroupAdd=function(f,m,v){f=l.active_canvas;f.getCanvasWindow();m=new B.LGraphGroup;m.pos=f.convertEventToCanvasOffset(v);f.graph.add(m)};l.onMenuAdd=function(f,m,v,D,C){function J(ma,ha){ha=D.getFirstEvent();N.graph.beforeChange();if(ma=B.createNode(ma.value))ma.pos=N.convertEventToCanvasOffset(ha),N.graph.add(ma);C&&C(ma);N.graph.afterChange()}var N=l.active_canvas,S=N.getCanvasWindow(),T=N.graph;
if(T){f=B.getNodeTypesCategories(N.filter||T.filter);m=[];for(var W=0;W<f.length;W++)if(f[W]){var Y=f[W];-1!=Y.indexOf("::")&&(Y=Y.split("::")[1]);m.push({value:f[W],content:Y,has_submenu:!0})}var V=new B.ContextMenu(m,{event:v,callback:function(ma,ha,ia){ma=B.getNodeTypesInCategory(ma.value,N.filter||T.filter);ha=[];for(var aa=0;aa<ma.length;aa++)ma[aa].skip_list||ha.push({content:ma[aa].title,value:ma[aa].type});new B.ContextMenu(ha,{event:ia,callback:J,parentMenu:V},S);return!1},parentMenu:D},
S);return!1}};l.onMenuCollapseAll=function(){};l.onMenuNodeEdit=function(){};l.showMenuNodeOptionalInputs=function(f,m,v,D,C){if(C){var J=this;f=l.active_canvas.getCanvasWindow();m=C.optional_inputs;C.onGetInputs&&(m=C.onGetInputs());var N=[];if(m)for(var S=0;S<m.length;S++){var T=m[S];if(T){var W=T[0];T[2]&&T[2].label&&(W=T[2].label);W={content:W,value:T};T[1]==B.ACTION&&(W.className="event");N.push(W)}else N.push(null)}this.onMenuNodeInputs&&(N=this.onMenuNodeInputs(N));if(N.length)return new B.ContextMenu(N,
{event:v,callback:function(Y,V,ma){C&&(Y.callback&&Y.callback.call(J,C,Y,V,ma),Y.value&&(C.graph.beforeChange(),C.addInput(Y.value[0],Y.value[1],Y.value[2]),C.setDirtyCanvas(!0,!0),C.graph.afterChange()))},parentMenu:D,node:C},f),!1;console.log("no input entries")}};l.showMenuNodeOptionalOutputs=function(f,m,v,D,C){function J(V,ma,ha){if(C&&(V.callback&&V.callback.call(N,C,V,ma,ha),V.value))if(ha=V.value[1],!ha||ha.constructor!==Object&&ha.constructor!==Array)C.graph.beforeChange(),C.addOutput(V.value[0],
V.value[1],V.value[2]),C.setDirtyCanvas(!0,!0),C.graph.afterChange();else{V=[];for(var ia in ha)V.push({content:ia,value:ha[ia]});new B.ContextMenu(V,{event:ma,callback:J,parentMenu:D,node:C});return!1}}if(C){var N=this;f=l.active_canvas.getCanvasWindow();m=C.optional_outputs;C.onGetOutputs&&(m=C.onGetOutputs());var S=[];if(m)for(var T=0;T<m.length;T++){var W=m[T];if(!W)S.push(null);else if(!C.flags||!C.flags.skip_repeated_outputs||-1==C.findOutputSlot(W[0])){var Y=W[0];W[2]&&W[2].label&&(Y=W[2].label);
Y={content:Y,value:W};W[1]==B.EVENT&&(Y.className="event");S.push(Y)}}this.onMenuNodeOutputs&&(S=this.onMenuNodeOutputs(S));if(S.length)return new B.ContextMenu(S,{event:v,callback:J,parentMenu:D,node:C},f),!1}};l.onShowMenuNodeProperties=function(f,m,v,D,C){if(C&&C.properties){var J=l.active_canvas;m=J.getCanvasWindow();var N=[],S;for(S in C.properties){f=void 0!==C.properties[S]?C.properties[S]:" ";"object"==typeof f&&(f=JSON.stringify(f));var T=C.getPropertyInfo(S);if("enum"==T.type||"combo"==
T.type)f=l.getPropertyPrintableValue(f,T.values);f=l.decodeHTML(f);N.push({content:"<span class='property_name'>"+S+"</span><span class='property_value'>"+f+"</span>",value:S})}if(N.length)return new B.ContextMenu(N,{event:v,callback:function(W,Y,V,ma){C&&(Y=this.getBoundingClientRect(),J.showEditPropertyValue(C,W.value,{position:[Y.left,Y.top]}))},parentMenu:D,allow_html:!0,node:C},m),!1}};l.decodeHTML=function(f){var m=document.createElement("div");m.innerText=f;return m.innerHTML};l.onResizeNode=
function(f,m,v,D,C){if(C){C.size=C.computeSize();if(C.onResize)C.onResize(C.size);C.setDirtyCanvas(!0,!0)}};l.prototype.showLinkMenu=function(f,m){var v=this;console.log(f);var D=new B.ContextMenu(["Add Node",null,"Delete"],{event:m,title:null!=f.data?f.data.constructor.name:null,callback:function(C,J,N){switch(C){case "Add Node":l.onMenuAdd(null,null,N,D,function(S){console.log("node autoconnect");var T=v.graph.getNodeById(f.origin_id),W=v.graph.getNodeById(f.target_id);S.inputs&&S.inputs.length&&
S.outputs&&S.outputs.length&&T.outputs[f.origin_slot].type==S.inputs[0].type&&S.outputs[0].type==W.inputs[0].type&&(T.connect(f.origin_slot,S,0),S.connect(0,W,f.target_slot),S.pos[0]-=.5*S.size[0])});break;case "Delete":v.graph.removeLink(f.id)}}});return!1};l.onShowPropertyEditor=function(f,m,v,D,C){function J(){var Y=T.value;"Number"==f.type?Y=Number(Y):"Boolean"==f.type&&(Y=!!Y);C[N]=Y;S.parentNode&&S.parentNode.removeChild(S);C.setDirtyCanvas(!0,!0)}var N=f.property||"title";m=C[N];var S=document.createElement("div");
S.className="graphdialog";S.innerHTML="<span class='name'></span><input autofocus type='text' class='value'/><button>OK</button>";S.querySelector(".name").innerText=N;var T=S.querySelector("input");T&&(T.value=m,T.addEventListener("blur",function(Y){this.focus()}),T.addEventListener("keydown",function(Y){13==Y.keyCode&&(J(),Y.preventDefault(),Y.stopPropagation())}));m=l.active_canvas.canvas;v=m.getBoundingClientRect();var W=D=-20;v&&(D-=v.left,W-=v.top);event?(S.style.left=event.clientX+D+"px",S.style.top=
event.clientY+W+"px"):(S.style.left=.5*m.width+D+"px",S.style.top=.5*m.height+W+"px");S.querySelector("button").addEventListener("click",J);m.parentNode.appendChild(S)};l.prototype.prompt=function(f,m,v,D){var C=this;f=f||"";var J=!1,N=document.createElement("div");N.className="graphdialog rounded";N.innerHTML="<span class='name'></span> <input autofocus type='text' class='value'/><button class='rounded'>OK</button>";N.close=function(){C.prompt_box=null;N.parentNode&&N.parentNode.removeChild(N)};
1<this.ds.scale&&(N.style.transform="scale("+this.ds.scale+")");N.addEventListener("mouseleave",function(Y){J||N.close()});C.prompt_box&&C.prompt_box.close();C.prompt_box=N;N.querySelector(".name").innerText=f;N.querySelector(".value").value=m;var S=N.querySelector("input");S.addEventListener("keydown",function(Y){J=!0;if(27==Y.keyCode)N.close();else if(13==Y.keyCode)v&&v(this.value),N.close();else return;Y.preventDefault();Y.stopPropagation()});N.querySelector("button").addEventListener("click",
function(Y){v&&v(S.value);C.setDirty(!0);N.close()});f=l.active_canvas.canvas;m=f.getBoundingClientRect();var T=-20,W=-20;m&&(T-=m.left,W-=m.top);D?(N.style.left=D.clientX+T+"px",N.style.top=D.clientY+W+"px"):(N.style.left=.5*f.width+T+"px",N.style.top=.5*f.height+W+"px");f.parentNode.appendChild(N);setTimeout(function(){S.focus()},10);return N};l.search_limit=-1;l.prototype.showSearchBox=function(f){function m(ea){if(ea)if(C.onSearchBoxSelection)C.onSearchBoxSelection(ea,f,J);else{var ja=B.searchbox_extras[ea.toLowerCase()];
ja&&(ea=ja.type);J.graph.beforeChange();if(ea=B.createNode(ea))ea.pos=J.convertEventToCanvasOffset(f),J.graph.add(ea);if(ja&&ja.data){if(ja.data.properties)for(var Q in ja.data.properties)ea.addProperty(Q,ja.data.properties[Q]);if(ja.data.inputs)for(Q in ea.inputs=[],ja.data.inputs)ea.addOutput(ja.data.inputs[Q][0],ja.data.inputs[Q][1]);if(ja.data.outputs)for(Q in ea.outputs=[],ja.data.outputs)ea.addOutput(ja.data.outputs[Q][0],ja.data.outputs[Q][1]);ja.data.title&&(ea.title=ja.data.title);ja.data.json&&
ea.configure(ja.data.json);J.graph.afterChange()}}T.close()}function v(ea){var ja=ha;ha&&ha.classList.remove("selected");ha?(ha=ea?ha.nextSibling:ha.previousSibling)||(ha=ja):ha=ea?Y.childNodes[0]:Y.childNodes[Y.childNodes.length];ha&&(ha.classList.add("selected"),ha.scrollIntoView({block:"end",behavior:"smooth"}))}function D(){function ea(Aa,xa){var Ia=document.createElement("div");V||(V=Aa);Ia.innerText=Aa;Ia.dataset.type=escape(Aa);Ia.className="litegraph lite-search-item";xa&&(Ia.className+=" "+
xa);Ia.addEventListener("click",function(Za){m(unescape(this.dataset.type))});Y.appendChild(Ia)}ma=null;var ja=ia.value;V=null;Y.innerHTML="";if(ja)if(C.onSearchBox){var Q=C.onSearchBox(Y,ja,J);if(Q)for(var X=0;X<Q.length;++X)ea(Q[X])}else{Q=function(Aa){var xa=B.registered_node_types[Aa];return pa&&xa.filter!=pa?!1:-1!==Aa.toLowerCase().indexOf(ja)};var ca=0;ja=ja.toLowerCase();var pa=J.filter||J.graph.filter;for(X in B.searchbox_extras){var ka=B.searchbox_extras[X];if(-1!==ka.desc.toLowerCase().indexOf(ja)){var va=
B.registered_node_types[ka.type];if(!va||!va.filter||va.filter==pa)if(ea(ka.desc,"searchbox_extra"),-1!==l.search_limit&&ca++>l.search_limit)break}}ka=null;if(Array.prototype.filter)ka=Object.keys(B.registered_node_types).filter(Q);else for(X in ka=[],B.registered_node_types)Q(X)&&ka.push(X);for(X=0;X<ka.length&&!(ea(ka[X]),-1!==l.search_limit&&ca++>l.search_limit);X++);}}var C=this,J=l.active_canvas,N=J.canvas,S=N.ownerDocument||document,T=document.createElement("div");T.className="litegraph litesearchbox graphdialog rounded";
T.innerHTML="<span class='name'>Search</span> <input autofocus type='text' class='value rounded'/><div class='helper'></div>";T.close=function(){C.search_box=null;S.body.focus();S.body.style.overflow="";setTimeout(function(){C.canvas.focus()},20);T.parentNode&&T.parentNode.removeChild(T)};var W=null;1<this.ds.scale&&(T.style.transform="scale("+this.ds.scale+")");T.addEventListener("mouseenter",function(ea){W&&(clearTimeout(W),W=null)});T.addEventListener("mouseleave",function(ea){W=setTimeout(function(){T.close()},
500)});C.search_box&&C.search_box.close();C.search_box=T;var Y=T.querySelector(".helper"),V=null,ma=null,ha=null,ia=T.querySelector("input");ia&&(ia.addEventListener("blur",function(ea){this.focus()}),ia.addEventListener("keydown",function(ea){if(38==ea.keyCode)v(!1);else if(40==ea.keyCode)v(!0);else if(27==ea.keyCode)T.close();else if(13==ea.keyCode)ha?m(ha.innerHTML):V?m(V):T.close();else{ma&&clearInterval(ma);ma=setTimeout(D,10);return}ea.preventDefault();ea.stopPropagation();ea.stopImmediatePropagation();
return!0}));S.fullscreenElement?S.fullscreenElement.appendChild(T):(S.body.appendChild(T),S.body.style.overflow="hidden");N=N.getBoundingClientRect();var aa=(f?f.clientY:N.top+.5*N.height)-20;T.style.left=(f?f.clientX:N.left+.5*N.width)-80+"px";T.style.top=aa+"px";f.layerY>N.height-200&&(Y.style.maxHeight=N.height-f.layerY-20+"px");ia.focus();return T};l.prototype.showEditPropertyValue=function(f,m,v){function D(){C(V.value)}function C(ma){J&&J.values&&J.values.constructor===Object&&void 0!=J.values[ma]&&
(ma=J.values[ma]);"number"==typeof f.properties[m]&&(ma=Number(ma));if("array"==N||"object"==N)ma=JSON.parse(ma);f.properties[m]=ma;f.graph&&f.graph._version++;if(f.onPropertyChanged)f.onPropertyChanged(m,ma);if(v.onclose)v.onclose();Y.close();f.setDirtyCanvas(!0,!0)}if(f&&void 0!==f.properties[m]){v=v||{};var J=f.getPropertyInfo(m),N=J.type,S="";if("string"==N||"number"==N||"array"==N||"object"==N)S="<input autofocus type='text' class='value'/>";else if("enum"!=N&&"combo"!=N||!J.values)if("boolean"==
N)S="<input autofocus type='checkbox' class='value' "+(f.properties[m]?"checked":"")+"/>";else{console.warn("unknown type: "+N);return}else{S="<select autofocus type='text' class='value'>";for(var T in J.values){var W=T;J.values.constructor===Array&&(W=J.values[T]);S+="<option value='"+W+"' "+(W==f.properties[m]?"selected":"")+">"+J.values[T]+"</option>"}S+="</select>"}var Y=this.createDialog("<span class='name'>"+m+"</span>"+S+"<button>OK</button>",v);if("enum"!=N&&"combo"!=N||!J.values)if("boolean"==
N)(V=Y.querySelector("input"))&&V.addEventListener("click",function(ma){C(!!V.checked)});else{if(V=Y.querySelector("input"))V.addEventListener("blur",function(ma){this.focus()}),W=void 0!==f.properties[m]?f.properties[m]:"",W=JSON.stringify(W),V.value=W,V.addEventListener("keydown",function(ma){13==ma.keyCode&&(D(),ma.preventDefault(),ma.stopPropagation())})}else{var V=Y.querySelector("select");V.addEventListener("change",function(ma){C(ma.target.value)})}Y.querySelector("button").addEventListener("click",
D);return Y}};l.prototype.createDialog=function(f,m){m=m||{};var v=document.createElement("div");v.className="graphdialog";v.innerHTML=f;f=this.canvas.getBoundingClientRect();var D=-20,C=-20;f&&(D-=f.left,C-=f.top);m.position?(D+=m.position[0],C+=m.position[1]):m.event?(D+=m.event.clientX,C+=m.event.clientY):(D+=.5*this.canvas.width,C+=.5*this.canvas.height);v.style.left=D+"px";v.style.top=C+"px";this.canvas.parentNode.appendChild(v);v.close=function(){this.parentNode&&this.parentNode.removeChild(this)};
return v};l.prototype.createPanel=function(f,m){m=m||{};var v=m.window||window,D=document.createElement("div");D.className="litegraph dialog";D.innerHTML="<div class='dialog-header'><span class='dialog-title'></span></div><div class='dialog-content'></div><div class='dialog-footer'></div>";D.header=D.querySelector(".dialog-header");m.width&&(D.style.width=m.width+(m.width.constructor===Number?"px":""));m.height&&(D.style.height=m.height+(m.height.constructor===Number?"px":""));m.closable&&(m=document.createElement("span"),
m.innerHTML="&#10005;",m.classList.add("close"),m.addEventListener("click",function(){D.close()}),D.header.appendChild(m));D.title_element=D.querySelector(".dialog-title");D.title_element.innerText=f;D.content=D.querySelector(".dialog-content");D.footer=D.querySelector(".dialog-footer");D.close=function(){this.parentNode.removeChild(this)};D.clear=function(){this.content.innerHTML=""};D.addHTML=function(C,J,N){var S=document.createElement("div");J&&(S.className=J);S.innerHTML=C;N?D.footer.appendChild(S):
D.content.appendChild(S);return S};D.addButton=function(C,J,N){var S=document.createElement("button");S.innerText=C;S.options=N;S.classList.add("btn");S.addEventListener("click",J);D.footer.appendChild(S);return S};D.addSeparator=function(){var C=document.createElement("div");C.className="separator";D.content.appendChild(C)};D.addWidget=function(C,J,N,S,T){function W(ha,ia){console.log("change",ha,ia);S.callback&&S.callback(ha,ia);T&&T(ha,ia)}S=S||{};var Y=String(N);C=C.toLowerCase();"number"==C&&
(Y=N.toFixed(3));var V=document.createElement("div");V.className="property";V.innerHTML="<span class='property_name'></span><span class='property_value'></span>";V.querySelector(".property_name").innerText=J;var ma=V.querySelector(".property_value");ma.innerText=Y;V.dataset.property=J;V.dataset.type=S.type||C;V.options=S;V.value=N;if("boolean"==C)V.classList.add("boolean"),N&&V.classList.add("bool-on"),V.addEventListener("click",function(){var ha=this.dataset.property;this.value=!this.value;this.classList.toggle("bool-on");
this.querySelector(".property_value").innerText=this.value?"true":"false";W(ha,this.value)});else if("string"==C||"number"==C)ma.setAttribute("contenteditable",!0),ma.addEventListener("keydown",function(ha){"Enter"==ha.code&&(ha.preventDefault(),this.blur())}),ma.addEventListener("blur",function(){var ha=this.innerText,ia=this.parentNode.dataset.property;"number"==this.parentNode.dataset.type&&(ha=Number(ha));W(ia,ha)});else if("enum"==C||"combo"==C)Y=l.getPropertyPrintableValue(N,S.values);ma.innerText=
Y;ma.addEventListener("click",function(ha){var ia=this.parentNode.dataset.property,aa=this;new B.ContextMenu(S.values||[],{event:ha,className:"dark",callback:function(ea,ja,Q){aa.innerText=ea;W(ia,ea);return!1}},v)});D.content.appendChild(V);return V};return D};l.getPropertyPrintableValue=function(f,m){if(!m||m.constructor===Array)return String(f);if(m.constructor===Object){var v="",D;for(D in m)if(m[D]==f){v=D;break}return String(f)+" ("+v+")"}};l.prototype.showShowNodePanel=function(f){};l.prototype.showSubgraphPropertiesDialog=
function(f){function m(){D.clear();if(f.inputs)for(var C=0;C<f.inputs.length;++C){var J=f.inputs[C];if(!J.not_subgraph_input){var N=D.addHTML("<button>&#10005;</button> <span class='bullet_icon'></span><span class='name'></span><span class='type'></span>","subgraph_property");N.dataset.name=J.name;N.dataset.slot=C;N.querySelector(".name").innerText=J.name;N.querySelector(".type").innerText=J.type;N.querySelector("button").addEventListener("click",function(S){f.removeInput(Number(this.parentNode.dataset.slot));
m()})}}}console.log("showing subgraph properties dialog");var v=this.canvas.parentNode.querySelector(".subgraph_dialog");v&&v.close();var D=this.createPanel("Subgraph Inputs",{closable:!0,width:500});D.node=f;D.classList.add("subgraph_dialog");D.addHTML(" + <span class='label'>Name</span><input class='name'/><span class='label'>Type</span><input class='type'></input><button>+</button>","subgraph_property extra",!0).querySelector("button").addEventListener("click",function(C){C=this.parentNode;var J=
C.querySelector(".name").value,N=C.querySelector(".type").value;J&&-1==f.findInputSlot(J)&&(f.addInput(J,N),C.querySelector(".name").value="",C.querySelector(".type").value="",m())});m();this.canvas.parentNode.appendChild(D);return D};l.prototype.checkPanels=function(){if(this.canvas)for(var f=this.canvas.parentNode.querySelectorAll(".litegraph.dialog"),m=0;m<f.length;++m){var v=f[m];v.node&&(v.node.graph&&v.graph==this.graph||v.close())}};l.onMenuNodeCollapse=function(f,m,v,D,C){C.graph.beforeChange(C);
C.collapse();C.graph.afterChange(C)};l.onMenuNodePin=function(f,m,v,D,C){C.pin()};l.onMenuNodeMode=function(f,m,v,D,C){new B.ContextMenu(["Always","On Event","On Trigger","Never"],{event:v,callback:function(J){if(C)switch(J){case "On Event":C.mode=B.ON_EVENT;break;case "On Trigger":C.mode=B.ON_TRIGGER;break;case "Never":C.mode=B.NEVER;break;default:C.mode=B.ALWAYS}},parentMenu:D,node:C});return!1};l.onMenuNodeColors=function(f,m,v,D,C){if(!C)throw"no node for color";m=[];m.push({value:null,content:"<span style='display: block; padding-left: 4px;'>No color</span>"});
for(var J in l.node_colors)f=l.node_colors[J],f={value:J,content:"<span style='display: block; color: #999; padding-left: 4px; border-left: 8px solid "+f.color+"; background-color:"+f.bgcolor+"'>"+J+"</span>"},m.push(f);new B.ContextMenu(m,{event:v,callback:function(N){C&&((N=N.value?l.node_colors[N.value]:null)?C.constructor===B.LGraphGroup?C.color=N.groupcolor:(C.color=N.color,C.bgcolor=N.bgcolor):(delete C.color,delete C.bgcolor),C.setDirtyCanvas(!0,!0))},parentMenu:D,node:C});return!1};l.onMenuNodeShapes=
function(f,m,v,D,C){if(!C)throw"no node passed";new B.ContextMenu(B.VALID_SHAPES,{event:v,callback:function(J){C&&(C.graph.beforeChange(C),C.shape=J,C.graph.afterChange(C),C.setDirtyCanvas(!0))},parentMenu:D,node:C});return!1};l.onMenuNodeRemove=function(f,m,v,D,C){if(!C)throw"no node passed";!1!==C.removable&&(f=C.graph,f.beforeChange(),f.remove(C),f.afterChange(),C.setDirtyCanvas(!0,!0))};l.onMenuNodeToSubgraph=function(f,m,v,D,C){f=C.graph;if(m=l.active_canvas)v=Object.values(m.selected_nodes||
{}),v.length||(v=[C]),D=B.createNode("graph/subgraph"),D.pos=C.pos.concat(),f.add(D),D.buildFromNodes(v),m.deselectAllNodes(),C.setDirtyCanvas(!0,!0)};l.onMenuNodeClone=function(f,m,v,D,C){0!=C.clonable&&(f=C.clone())&&(f.pos=[C.pos[0]+5,C.pos[1]+5],C.graph.beforeChange(),C.graph.add(f),C.graph.afterChange(),C.setDirtyCanvas(!0,!0))};l.node_colors={red:{color:"#322",bgcolor:"#533",groupcolor:"#A88"},brown:{color:"#332922",bgcolor:"#593930",groupcolor:"#b06634"},green:{color:"#232",bgcolor:"#353",
groupcolor:"#8A8"},blue:{color:"#223",bgcolor:"#335",groupcolor:"#88A"},pale_blue:{color:"#2a363b",bgcolor:"#3f5159",groupcolor:"#3f789e"},cyan:{color:"#233",bgcolor:"#355",groupcolor:"#8AA"},purple:{color:"#323",bgcolor:"#535",groupcolor:"#a1309b"},yellow:{color:"#432",bgcolor:"#653",groupcolor:"#b58b2a"},black:{color:"#222",bgcolor:"#000",groupcolor:"#444"}};l.prototype.getCanvasMenuOptions=function(){if(this.getMenuOptions)var f=this.getMenuOptions();else f=[{content:"Add Node",has_submenu:!0,
callback:l.onMenuAdd},{content:"Add Group",callback:l.onGroupAdd}],this._graph_stack&&0<this._graph_stack.length&&f.push(null,{content:"Close subgraph",callback:this.closeSubgraph.bind(this)});if(this.getExtraMenuOptions){var m=this.getExtraMenuOptions(this,f);m&&(f=f.concat(m))}return f};l.prototype.getNodeMenuOptions=function(f){var m=f.getMenuOptions?f.getMenuOptions(this):[{content:"Inputs",has_submenu:!0,disabled:!0,callback:l.showMenuNodeOptionalInputs},{content:"Outputs",has_submenu:!0,disabled:!0,
callback:l.showMenuNodeOptionalOutputs},null,{content:"Properties",has_submenu:!0,callback:l.onShowMenuNodeProperties},null,{content:"Title",callback:l.onShowPropertyEditor},{content:"Mode",has_submenu:!0,callback:l.onMenuNodeMode},{content:"Resize",callback:l.onResizeNode},{content:"Collapse",callback:l.onMenuNodeCollapse},{content:"Pin",callback:l.onMenuNodePin},{content:"Colors",has_submenu:!0,callback:l.onMenuNodeColors},{content:"Shapes",has_submenu:!0,callback:l.onMenuNodeShapes},null];if(f.onGetInputs){var v=
f.onGetInputs();v&&v.length&&(m[0].disabled=!1)}f.onGetOutputs&&(v=f.onGetOutputs())&&v.length&&(m[1].disabled=!1);f.getExtraMenuOptions&&(v=f.getExtraMenuOptions(this,m))&&(v.push(null),m=v.concat(m));!1!==f.clonable&&m.push({content:"Clone",callback:l.onMenuNodeClone});m.push(null,{content:"Remove",disabled:!(!1!==f.removable&&!f.block_delete),callback:l.onMenuNodeRemove});if(f.graph&&f.graph.onGetNodeMenuOptions)f.graph.onGetNodeMenuOptions(m,f);return m};l.prototype.getGroupMenuOptions=function(f){return[{content:"Title",
callback:l.onShowPropertyEditor},{content:"Color",has_submenu:!0,callback:l.onMenuNodeColors},{content:"Font size",property:"font_size",type:"Number",callback:l.onShowPropertyEditor},null,{content:"Remove",callback:l.onMenuNodeRemove}]};l.prototype.processContextMenu=function(f,m){var v=this,D=l.active_canvas.getCanvasWindow(),C=null,J={event:m,callback:function(S,T,W){if(S)if("Remove Slot"==S.content)S=S.slot,S.input?f.removeInput(S.slot):S.output&&f.removeOutput(S.slot);else if("Disconnect Links"==
S.content)S=S.slot,S.output?f.disconnectOutput(S.slot):S.input&&f.disconnectInput(S.slot);else if("Rename Slot"==S.content){S=S.slot;var Y=S.input?f.getInputInfo(S.slot):f.getOutputInfo(S.slot),V=v.createDialog("<span class='name'>Name</span><input autofocus type='text'/><button>OK</button>",T),ma=V.querySelector("input");ma&&Y&&(ma.value=Y.label||"");V.querySelector("button").addEventListener("click",function(ha){ma.value&&(Y&&(Y.label=ma.value),v.setDirty(!0));V.close()})}},extra:f};f&&(J.title=
f.type);var N=null;f&&(N=f.getSlotInPosition(m.canvasX,m.canvasY),l.active_node=f);N?(C=[],f.getSlotMenuOptions?C=f.getSlotMenuOptions(N,f,m):(N&&N.output&&N.output.links&&N.output.links.length&&C.push({content:"Disconnect Links",slot:N}),m=N.input||N.output,C.push(m.locked?"Cannot remove":{content:"Remove Slot",slot:N}),C.push(m.nameLocked?"Cannot rename":{content:"Rename Slot",slot:N})),J.title=(N.input?N.input.type:N.output.type)||"*",N.input&&N.input.type==B.ACTION&&(J.title="Action"),N.output&&
N.output.type==B.EVENT&&(J.title="Event")):f?C=this.getNodeMenuOptions(f):(C=this.getCanvasMenuOptions(),(N=this.graph.getGroupOnPos(m.canvasX,m.canvasY))&&C.push(null,{content:"Edit Group",has_submenu:!0,submenu:{title:"Group",extra:N,options:this.getGroupMenuOptions(N)}}));C&&new B.ContextMenu(C,J,D)};"undefined"!=typeof window&&window.CanvasRenderingContext2D&&(window.CanvasRenderingContext2D.prototype.roundRect=function(f,m,v,D,C,J){void 0===C&&(C=5);void 0===J&&(J=C);this.moveTo(f+C,m);this.lineTo(f+
v-C,m);this.quadraticCurveTo(f+v,m,f+v,m+C);this.lineTo(f+v,m+D-J);this.quadraticCurveTo(f+v,m+D,f+v-J,m+D);this.lineTo(f+J,m+D);this.quadraticCurveTo(f,m+D,f,m+D-J);this.lineTo(f,m+C);this.quadraticCurveTo(f,m,f+C,m)});B.compareObjects=function(f,m){for(var v in f)if(f[v]!=m[v])return!1;return!0};B.distance=t;B.colorToString=function(f){return"rgba("+Math.round(255*f[0]).toFixed()+","+Math.round(255*f[1]).toFixed()+","+Math.round(255*f[2]).toFixed()+","+(4==f.length?f[3].toFixed(2):"1.0")+")"};B.isInsideRectangle=
r;B.growBounding=function(f,m,v){m<f[0]?f[0]=m:m>f[2]&&(f[2]=m);v<f[1]?f[1]=v:v>f[3]&&(f[3]=v)};B.isInsideBounding=function(f,m){return f[0]<m[0][0]||f[1]<m[0][1]||f[0]>m[1][0]||f[1]>m[1][1]?!1:!0};B.overlapBounding=y;B.hex2num=function(f){"#"==f.charAt(0)&&(f=f.slice(1));f=f.toUpperCase();for(var m=Array(3),v=0,D,C,J=0;6>J;J+=2)D="0123456789ABCDEF".indexOf(f.charAt(J)),C="0123456789ABCDEF".indexOf(f.charAt(J+1)),m[v]=16*D+C,v++;return m};B.num2hex=function(f){for(var m="#",v,D,C=0;3>C;C++)v=f[C]/
16,D=f[C]%16,m+="0123456789ABCDEF".charAt(v)+"0123456789ABCDEF".charAt(D);return m};z.prototype.addItem=function(f,m,v){function D(T){var W=this.value;W&&W.has_submenu&&C.call(this,T)}function C(T){var W=this.value,Y=!0;J.current_submenu&&J.current_submenu.close(T);if(v.callback){var V=v.callback.call(this,W,v,T,J,v.node);!0===V&&(Y=!1)}if(W&&(W.callback&&!v.ignore_item_callbacks&&!0!==W.disabled&&(V=W.callback.call(this,W,v,T,J,v.extra),!0===V&&(Y=!1)),W.submenu)){if(!W.submenu.options)throw"ContextMenu submenu needs options";
new J.constructor(W.submenu.options,{callback:W.submenu.callback,event:T,parentMenu:J,ignore_item_callbacks:W.submenu.ignore_item_callbacks,title:W.submenu.title,extra:W.submenu.extra,autoopen:v.autoopen});Y=!1}Y&&!J.lock&&J.close()}var J=this;v=v||{};var N=document.createElement("div");N.className="litemenu-entry submenu";var S=!1;if(null===m)N.classList.add("separator");else{N.innerHTML=m&&m.title?m.title:f;if(N.value=m)m.disabled&&(S=!0,N.classList.add("disabled")),(m.submenu||m.has_submenu)&&
N.classList.add("has_submenu");"function"==typeof m?(N.dataset.value=f,N.onclick_callback=m):N.dataset.value=m;m.className&&(N.className+=" "+m.className)}this.root.appendChild(N);S||N.addEventListener("click",C);v.autoopen&&N.addEventListener("mouseenter",D);return N};z.prototype.close=function(f,m){this.root.parentNode&&this.root.parentNode.removeChild(this.root);this.parentMenu&&!m&&(this.parentMenu.lock=!1,this.parentMenu.current_submenu=null,void 0===f?this.parentMenu.close():f&&!z.isCursorOverElement(f,
this.parentMenu.root)&&z.trigger(this.parentMenu.root,"mouseleave",f));this.current_submenu&&this.current_submenu.close(f,!0);this.root.closing_timer&&clearTimeout(this.root.closing_timer)};z.trigger=function(f,m,v,D){var C=document.createEvent("CustomEvent");C.initCustomEvent(m,!0,!0,v);C.srcElement=D;f.dispatchEvent?f.dispatchEvent(C):f.__events&&f.__events.dispatchEvent(C);return C};z.prototype.getTopMenu=function(){return this.options.parentMenu?this.options.parentMenu.getTopMenu():this};z.prototype.getFirstEvent=
function(){return this.options.parentMenu?this.options.parentMenu.getFirstEvent():this.options.event};z.isCursorOverElement=function(f,m){var v=f.clientX;f=f.clientY;return(m=m.getBoundingClientRect())?f>m.top&&f<m.top+m.height&&v>m.left&&v<m.left+m.width?!0:!1:!1};B.ContextMenu=z;B.closeAllContextMenus=function(f){f=f||window;f=f.document.querySelectorAll(".litecontextmenu");if(f.length){for(var m=[],v=0;v<f.length;v++)m.push(f[v]);for(v=0;v<m.length;v++)m[v].close?m[v].close():m[v].parentNode&&
m[v].parentNode.removeChild(m[v])}};B.extendClass=function(f,m){for(var v in m)f.hasOwnProperty(v)||(f[v]=m[v]);if(m.prototype)for(v in m.prototype)m.prototype.hasOwnProperty(v)&&!f.prototype.hasOwnProperty(v)&&(m.prototype.__lookupGetter__(v)?f.prototype.__defineGetter__(v,m.prototype.__lookupGetter__(v)):f.prototype[v]=m.prototype[v],m.prototype.__lookupSetter__(v)&&f.prototype.__defineSetter__(v,m.prototype.__lookupSetter__(v)))};E.sampleCurve=function(f,m){if(m){for(var v=0;v<m.length-1;++v){var D=
m[v],C=m[v+1];if(!(C[0]<f)){m=C[0]-D[0];if(1E-5>Math.abs(m))return D[1];f=(f-D[0])/m;return D[1]*(1-f)+C[1]*f}}return 0}};E.prototype.draw=function(f,m,v,D,C,J){if(v=this.points){this.size=m;var N=m[0]-2*this.margin;m=m[1]-2*this.margin;C=C||"#666";f.save();f.translate(this.margin,this.margin);D&&(f.fillStyle="#111",f.fillRect(0,0,N,m),f.fillStyle="#222",f.fillRect(.5*N,0,1,m),f.strokeStyle="#333",f.strokeRect(0,0,N,m));f.strokeStyle=C;J&&(f.globalAlpha=.5);f.beginPath();for(D=0;D<v.length;++D)C=
v[D],f.lineTo(C[0]*N,(1-C[1])*m);f.stroke();f.globalAlpha=1;if(!J)for(D=0;D<v.length;++D)C=v[D],f.fillStyle=this.selected==D?"#FFF":this.nearest==D?"#DDD":"#AAA",f.beginPath(),f.arc(C[0]*N,(1-C[1])*m,2,0,2*Math.PI),f.fill();f.restore()}};E.prototype.onMouseDown=function(f,m){var v=this.points;if(v&&!(0>f[1])){var D=this.size[0]-2*this.margin,C=this.size[1]-2*this.margin,J=f[0]-this.margin;f=f[1]-this.margin;this.selected=this.getCloserPoint([J,f],30/m.ds.scale);-1==this.selected&&(m=[J/D,1-f/C],v.push(m),
v.sort(function(N,S){return N[0]-S[0]}),this.selected=v.indexOf(m),this.must_update=!0);if(-1!=this.selected)return!0}};E.prototype.onMouseMove=function(f,m){var v=this.points;if(v){var D=this.selected;if(!(0>D)){var C=(f[0]-this.margin)/(this.size[0]-2*this.margin),J=(f[1]-this.margin)/(this.size[1]-2*this.margin);this._nearest=this.getCloserPoint([f[0]-this.margin,f[1]-this.margin],30/m.ds.scale);if(m=v[D]){var N=0==D||D==v.length-1;!N&&(-10>f[0]||f[0]>this.size[0]+10||-10>f[1]||f[1]>this.size[1]+
10)?(v.splice(D,1),this.selected=-1):(m[0]=N?0==D?0:1:Math.clamp(C,0,1),m[1]=1-Math.clamp(J,0,1),v.sort(function(S,T){return S[0]-T[0]}),this.selected=v.indexOf(m),this.must_update=!0)}}}};E.prototype.onMouseUp=function(f,m){this.selected=-1;return!1};E.prototype.getCloserPoint=function(f,m){var v=this.points;if(!v)return-1;m=m||30;for(var D=this.size[0]-2*this.margin,C=this.size[1]-2*this.margin,J=v.length,N=[0,0],S=1E6,T=-1,W=0;W<J;++W){var Y=v[W];N[0]=Y[0]*D;N[1]=(1-Y[1])*C;Y=vec2.distance(f,N);
Y>S||Y>m||(T=W,S=Y)}return T};B.CurveEditor=E;B.getParameterNames=function(f){return(f+"").replace(/[/][/].*$/gm,"").replace(/\s+/g,"").replace(/[/][*][^/*]*[*][/]/g,"").split("){",1)[0].replace(/^[^(]*[(]/,"").replace(/=[^,]+/g,"").split(",").filter(Boolean)};Math.clamp=function(f,m,v){return m>f?m:v<f?v:f};"undefined"==typeof window||window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(f){window.setTimeout(f,1E3/
60)})})(this);"undefined"!=typeof exports&&(exports.LiteGraph=this.LiteGraph);
var BufferAttribute=THREE.BufferAttribute,BufferGeometry=THREE.BufferGeometry,Clock=THREE.Clock,Face3=THREE.Face3,Geometry=THREE.Geometry,Object3D=THREE.Object3D,Raycaster=THREE.Raycaster,Material=THREE.Material,LineBasicMaterial=THREE.LineBasicMaterial,LineDashedMaterial=THREE.LineDashedMaterial,MeshPhysicalMaterial=THREE.MeshPhysicalMaterial,MultiMaterial=THREE.MultiMaterial,PointsMaterial=THREE.PointsMaterial,RawShaderMaterial=THREE.RawShaderMaterial,BoxBufferGeometry=THREE.BoxBufferGeometry,BoxGeometry=
THREE.BoxGeometry,CircleBufferGeometry=THREE.CircleBufferGeometry,CircleGeometry=THREE.CircleGeometry,ConeBufferGeometry=THREE.ConeBufferGeometry,ConeGeometry=THREE.ConeGeometry,CylinderBufferGeometry=THREE.CylinderBufferGeometry,CylinderGeometry=THREE.CylinderGeometry,DodecahedronBufferGeometry=THREE.DodecahedronBufferGeometry,DodecahedronGeometry=THREE.DodecahedronGeometry,ExtrudeGeometry=THREE.ExtrudeGeometry,IcosahedronBufferGeometry=THREE.IcosahedronBufferGeometry,IcosahedronGeometry=THREE.IcosahedronGeometry,
LatheBufferGeometry=THREE.LatheBufferGeometry,LatheGeometry=THREE.LatheGeometry,OctahedronBufferGeometry=THREE.OctahedronBufferGeometry,OctahedronGeometry=THREE.OctahedronGeometry,ParametricBufferGeometry=THREE.ParametricBufferGeometry,ParametricGeometry=THREE.ParametricGeometry,PlaneBufferGeometry=THREE.PlaneBufferGeometry,PlaneGeometry=THREE.PlaneGeometry,PolyhedronBufferGeometry=THREE.PolyhedronBufferGeometry,PolyhedronGeometry=THREE.PolyhedronGeometry,RingBufferGeometry=THREE.RingBufferGeometry,
RingGeometry=THREE.RingGeometry,ShapeGeometry=THREE.ShapeGeometry,SphereBufferGeometry=THREE.SphereBufferGeometry,SphereGeometry=THREE.SphereGeometry,TetrahedronBufferGeometry=THREE.TetrahedronBufferGeometry,TetrahedronGeometry=THREE.TetrahedronGeometry,TextGeometry=THREE.TextGeometry,TorusBufferGeometry=THREE.TorusBufferGeometry,TorusGeometry=THREE.TorusGeometry,TorusKnotBufferGeometry=THREE.TorusKnotBufferGeometry,TorusKnotGeometry=THREE.TorusKnotGeometry,TubeGeometry=THREE.TubeGeometry,WireframeGeometry=
THREE.WireframeGeometry,TubeBufferGeometry=THREE.TubeBufferGeometry,TrianglesDrawMode=THREE.TrianglesDrawMode,TriangleStripDrawMode=THREE.TriangleStripDrawMode,TriangleFanDrawMode=THREE.TriangleFanDrawMode,Box2=THREE.Box2,Box3=THREE.Box3,Color=THREE.Color,Euler=THREE.Euler,Line3=THREE.Line3,Frustum=THREE.Frustum,Matrix3=THREE.Matrix3,Matrix4=THREE.Matrix4,Plane=THREE.Plane,Quarternion=THREE.Quarternion,Ray=THREE.Ray,Sphere=THREE.Sphere,Spline=THREE.Spline,Triangle=THREE.Triangle,Vector2=THREE.Vector2,
Vector3=THREE.Vector3,Vector4=THREE.Vector4,LOD=THREE.LOD,LensFlare=THREE.LensFlare,Line=THREE.Line,LineSegments=THREE.LineSegments,AABB=CANNON.AABB,ArrayCollisionMatrix=CANNON.ArrayCollisionMatrix,Body=CANNON.Body,Box=CANNON.Box,Broadphase=CANNON.Broadphase,ConeEquation=CANNON.ConeEquation,ConeTwistConstraint=CANNON.ConeTwistConstraint,Constraint=CANNON.Constraint,ContactEquation=CANNON.ContactEquation,ContactMaterial=CANNON.ContactMaterial,ConvexPolyhedron=CANNON.ConvexPolyhedron,Cylinder=CANNON.Cylinder,
DistanceConstraint=CANNON.DistanceConstraint,Equation=CANNON.Equation,EventTarget=CANNON.EventTarget,FrictionEquation=CANNON.FrictionEquation,GridBroadphase=CANNON.GridBroadphase,GSSolver=CANNON.GSSolver,Heightfield=CANNON.Heightfield,HingeConstraint=CANNON.HingeConstraint,JacobianElement=CANNON.JacobianElement,LockConstraint=CANNON.LockConstraint,Mat3=CANNON.Mat3,PhysicsMaterial=CANNON.Material,NaiveBroadphase=CANNON.NaiveBroadphase,Narrowphase=CANNON.Narrowphase,ObjectCollisionMatrix=CANNON.ObjectCollisionMatrix,
Octree=CANNON.Octree,OctreeNode=CANNON.OctreeNode,Particle=CANNON.Particle,PointToPointConstraint=CANNON.PointToPointConstraint,Pool=CANNON.Pool,PhysicsRay=CANNON.Ray,RaycastResult=CANNON.RaycastResult,RaycastVehicle=CANNON.RaycastVehicle,RigidVehicle=CANNON.RigidVehicle,RotationalEquation=CANNON.RotationalEquation,RotationalMotorEquation=CANNON.RotationalMotorEquation,SAPBroadphase=CANNON.SAPBroadphase,Shape=CANNON.Shape,Solver=CANNON.Solver,SPHSystem=CANNON.SPHSystem,SplitSolver=CANNON.SplitSolver,
Spring=CANNON.Spring,Transform=CANNON.Transform,Trimesh=CANNON.Trimesh,TupleDictionary=CANNON.TupleDictionary,Vec3=CANNON.Vec3,Vec3Pool=CANNON.Vec3Pool,WheelInfo=CANNON.WheelInfo,World=CANNON.World;function FileSystem(){}try{FileSystem.fs=require("fs")}catch(b){}
FileSystem.readFile=function(b,h,k,e){void 0===h&&(h=!0);if(void 0!==FileSystem.fs){if(h)return b=FileSystem.fs.readFileSync(b,"utf8"),void 0!==k&&k(b),b;FileSystem.fs.readFile(b,"utf8",(q,l)=>{if(q)return console.error(q);void 0!==k&&k(l)})}else{var p=new XMLHttpRequest;p.overrideMimeType("text/plain");p.open("GET",b,!h);p.onload=function(){200!==p.status&&0!==p.status||void 0===k||k(p.responseText)};void 0!==e&&(p.onProgress=q=>{e(q)});p.send(null);return p.responseText}};
FileSystem.readFileArrayBuffer=function(b){if(void 0!==FileSystem.fs){b=FileSystem.fs.readFileSync(b);for(var h=b.length,k=new ArrayBuffer(h),e=new Uint8Array(k),p=0;p<h;p++)e[p]=b[p];return k}h=new XMLHttpRequest;h.open("GET",b,!1);h.overrideMimeType("text/plain; charset=x-user-defined");h.send(null);return ArraybufferUtils.fromBinaryString(h.response)};
FileSystem.readFileBase64=function(b){if(void 0!==FileSystem.fs)return b=FileSystem.fs.readFileSync(b),(new Buffer(b)).toString("base64");var h=new XMLHttpRequest;h.open("GET",b,!1);h.overrideMimeType("text/plain; charset=x-user-defined");h.send(null);return Base64Utils.fromBinaryString(h.response)};
FileSystem.writeFile=function(b,h){if(void 0!==FileSystem.fs)b=FileSystem.fs.createWriteStream(b,"utf8"),b.write(h),b.end();else{h=new Blob([h],{type:"text/plain"});var k=document.createElement("a");k.download=b;k.href=window.URL.createObjectURL(h);k.onclick=function(){document.body.removeChild(this)};k.style.display="none";document.body.appendChild(k);k.click()}};
FileSystem.writeFileBase64=function(b,h){void 0!==FileSystem.fs&&(h=Buffer.from(Base64Utils.removeHeader(h),"base64"),b=FileSystem.fs.createWriteStream(b),b.write(h),b.end())};FileSystem.copyFile=function(b,h){void 0!==FileSystem.fs&&FileSystem.fs.createReadStream(b).pipe(FileSystem.fs.createWriteStream(h))};FileSystem.makeDirectory=function(b){if(void 0!==FileSystem.fs)try{FileSystem.fs.mkdirSync(b)}catch(h){}};FileSystem.getFilesDirectory=function(b){if(void 0!==FileSystem.fs)try{return FileSystem.fs.readdirSync(b)}catch(h){}return[]};
FileSystem.copyFolder=function(b,h){if(void 0!==FileSystem.fs){FileSystem.makeDirectory(h);for(var k=FileSystem.fs.readdirSync(b),e=0;e<k.length;e++){var p=b+"/"+k[e],q=h+"/"+k[e],l=FileSystem.fs.statSync(p);l.isDirectory()?FileSystem.copyFolder(p,q):l.isSymbolicLink()?FileSystem.fs.symlinkSync(FileSystem.fs.readlinkSync(p),q):FileSystem.copyFile(p,q)}}};
FileSystem.chooseFile=function(b,h,k){var e=document.createElement("input");e.type="file";void 0!==h&&(e.accept=h);void 0!==k&&(e.nwsaveas=!0!==k?k:"file");e.onchange=function(p){void 0!==b&&b(e.files)};e.click()};FileSystem.fileExists=function(b){return void 0!==FileSystem.fs?FileSystem.fs.existsSync(b):!1};FileSystem.getFileName=function(b){return b.substring(b.lastIndexOf("/")+1,b.lastIndexOf(".")).toLowerCase()};FileSystem.getNameWithoutExtension=function(b){return b.substring(0,b.lastIndexOf("."))};
FileSystem.getFilePath=function(b){return b.substring(0,b.lastIndexOf("/")+1)};FileSystem.getFileExtension=function(b){return b.substring(b.lastIndexOf(".")+1,b.length)};function Key(){this.justReleased=this.justPressed=this.pressed=!1}Key.DOWN=-1;Key.UP=1;Key.RESET=0;
Key.prototype.update=function(b){this.justReleased=this.justPressed=!1;b===Key.DOWN?(!1===this.pressed&&(this.justPressed=!0),this.pressed=!0):b===Key.UP?(this.pressed&&(this.justReleased=!0),this.pressed=!1):b===Key.RESET&&(this.justPressed=this.justReleased=!1)};Key.prototype.set=function(b,h,k){this.justPressed=b;this.pressed=h;this.justReleased=k};Key.prototype.reset=function(){this.justReleased=this.pressed=this.justPressed=!1};
function Keyboard(){this.keys=[];this.actions=[];for(var b=0;256>b;b++)this.keys.push(new Key);this.events=[];var h=this.actions;this.events.push([window,"keydown",function(e){h.push(e.keyCode);h.push(Key.DOWN)}]);this.events.push([window,"keyup",function(e){h.push(e.keyCode);h.push(Key.UP)}]);for(b=0;b<this.events.length;b++){var k=this.events[b];k[0].addEventListener(k[1],k[2])}}Keyboard.prototype=Keyboard;
Keyboard.update=function(){for(var b=0;this.actions.length>b;){var h=this.actions.shift(),k=this.actions.shift();this.keys[h].update(k);if(this.keys[h].justReleased||this.keys[h].justPressed)this.actions.push(h),this.actions.push(Key.RESET),b+=2}};Keyboard.reset=function(){this.actions=[];for(var b=0;b<this.keys.length;b++)this.keys[b].reset()};Keyboard.keyPressed=function(b){return this.keys[b].pressed};Keyboard.keyJustPressed=function(b){return this.keys[b].justPressed};
Keyboard.keyJustReleased=function(b){return this.keys[b].justReleased};Keyboard.dispose=function(){for(var b=0;b<this.events.length;b++){var h=this.events[b];h[0].removeEventListener(h[1],h[2])}};Keyboard.TAB=9;Keyboard.ENTER=13;Keyboard.SHIFT=16;Keyboard.CTRL=17;Keyboard.ALT=18;Keyboard.CAPS_LOCK=20;Keyboard.ESC=27;Keyboard.SPACEBAR=32;Keyboard.PAGE_UP=33;Keyboard.PAGE_DOWN=34;Keyboard.END=35;Keyboard.HOME=36;Keyboard.INSERT=45;Keyboard.DEL=46;Keyboard.LEFT=37;Keyboard.RIGHT=39;Keyboard.UP=38;
Keyboard.DOWN=40;Keyboard.NUM0=48;Keyboard.NUM1=49;Keyboard.NUM2=50;Keyboard.NUM3=51;Keyboard.NUM4=52;Keyboard.NUM5=53;Keyboard.NUM6=54;Keyboard.NUM7=55;Keyboard.NUM8=56;Keyboard.NUM9=57;Keyboard.A=65;Keyboard.B=66;Keyboard.C=67;Keyboard.D=68;Keyboard.E=69;Keyboard.F=70;Keyboard.G=71;Keyboard.H=72;Keyboard.I=73;Keyboard.J=74;Keyboard.K=75;Keyboard.L=76;Keyboard.M=77;Keyboard.N=78;Keyboard.O=79;Keyboard.P=80;Keyboard.Q=81;Keyboard.R=82;Keyboard.S=83;Keyboard.T=84;Keyboard.U=85;Keyboard.V=86;
Keyboard.W=87;Keyboard.X=88;Keyboard.Y=89;Keyboard.Z=90;Keyboard.F1=112;Keyboard.F2=113;Keyboard.F3=114;Keyboard.F4=115;Keyboard.F5=116;Keyboard.F6=117;Keyboard.F7=118;Keyboard.F8=119;Keyboard.F9=120;Keyboard.F10=121;Keyboard.F11=122;Keyboard.F12=123;
function Mouse(){this._keys=[];this._position=new THREE.Vector2(0,0);this._positionUpdated=!1;this._delta=new THREE.Vector2(0,0);this._wheel=0;this._doubleClicked=this._wheelUpdated=!1;this.keys=[];this.position=new THREE.Vector2(0,0);this.delta=new THREE.Vector2(0,0);this.wheel=0;this.doubleClicked=!1;this.canvas=null;this.events=[];for(var b=0;3>b;b++)this._keys.push(new Key),this.keys.push(new Key);var h=this;void 0!==window.onmousewheel?this.events.push([window,"mousewheel",function(p){h._wheel=
p.deltaY;h._wheelUpdated=!0}]):void 0!==window.addEventListener?this.events.push([window,"DOMMouseScroll",function(p){h._wheel=30*p.detail;h._wheelUpdated=!0}]):this.events.push([window,"wheel",function(p){h._wheel=p.deltaY;h._wheelUpdated=!0}]);if("ontouchstart"in window||0<navigator.msMaxTouchPoints){var k=new Vector2(0,0);this.events.push([window,"touchstart",function(p){p=p.touches[0];k.set(p.clientX,p.clientY);h.updateKey(Mouse.LEFT,Key.DOWN)}]);this.events.push([window,"touchend",function(p){h.updateKey(Mouse.LEFT,
Key.UP)}]);this.events.push([window,"touchmove",function(p){p=p.touches[0];if(null!==h.canvas){var q=h.canvas.getBoundingClientRect();h.updatePosition(p.clientX-q.left,p.clientY-q.top,p.clientX-k.x,p.clientY-k.y)}else h.updatePosition(p.clientX,p.clientY,p.clientX-k.x,p.clientY-k.y);k.set(p.clientX,p.clientY)}])}else this.events.push([window,"mousemove",function(p){if(null!==h.canvas){var q=h.canvas.getBoundingClientRect();h.updatePosition(p.clientX-q.left,p.clientY-q.top,p.movementX,p.movementY)}else h.updatePosition(p.clientX,
p.clientY,p.movementX,p.movementY)}]),this.events.push([window,"mousedown",function(p){h.updateKey(p.which-1,Key.DOWN)}]),this.events.push([window,"mouseup",function(p){h.updateKey(p.which-1,Key.UP)}]);this.events.push([window,"dblclick",function(p){h._doubleClicked=!0}]);for(b=0;b<this.events.length;b++){var e=this.events[b];e[0].addEventListener(e[1],e[2])}}Mouse.prototype=Mouse;Mouse.LEFT=0;Mouse.MIDDLE=1;Mouse.RIGHT=2;
Mouse.setCanvas=function(b){this.canvas=b;b.mouseInside=!1;b.addEventListener("mouseenter",function(){this.mouseInside=!0});b.addEventListener("mouseleave",function(){this.mouseInside=!1})};Mouse.insideCanvas=function(){return null===this.canvas?!1:this.canvas.mouseInside};
Mouse.setLock=function(b){null!==this.canvas&&(b?this.canvas.requestPointerLock?this.canvas.requestPointerLock():this.canvas.mozRequestPointerLock?this.canvas.mozRequestPointerLock():this.canvas.webkitRequestPointerLock&&this.canvas.webkitRequestPointerLock():document.exitPointerLock?document.exitPointerLock():document.mozExitPointerLock?document.mozExitPointerLock():document.webkitExitPointerLock&&document.webkitExitPointerLock())};Mouse.buttonPressed=function(b){return this.keys[b].pressed};
Mouse.buttonDoubleClicked=function(){return this.doubleClicked};Mouse.buttonJustPressed=function(b){return this.keys[b].justPressed};Mouse.buttonJustReleased=function(b){return this.keys[b].justReleased};Mouse.updatePosition=function(b,h,k,e){this._position.set(b,h);this._delta.x+=k;this._delta.y+=e;this._positionUpdated=!0};Mouse.updateKey=function(b,h){-1<b&&this._keys[b].update(h)};
Mouse.update=function(){for(var b=0;b<this._keys.length;b++)this._keys[b].justPressed&&this.keys[b].justPressed&&(this._keys[b].justPressed=!1),this._keys[b].justReleased&&this.keys[b].justReleased&&(this._keys[b].justReleased=!1),this.keys[b].set(this._keys[b].justPressed,this._keys[b].pressed,this._keys[b].justReleased);this._wheelUpdated?(this.wheel=this._wheel,this._wheelUpdated=!1):this.wheel=0;this._doubleClicked?(this.doubleClicked=!0,this._doubleClicked=!1):this.doubleClicked=!1;this._positionUpdated?
(this.delta.x=this._delta.x,this.delta.y=this._delta.y,this._delta.set(0,0),this.position.x=this._position.x,this.position.y=this._position.y,this._positionUpdated=!1):(this.delta.x=0,this.delta.y=0)};Mouse.dispose=function(){for(var b=0;b<this.events.length;b++){var h=this.events[b];h[0].removeEventListener(h[1],h[2])}};
function VRControls(b,h){function k(p){for(var q=0;q<p.length;q++)if("VRDisplay"in window&&p[q]instanceof VRDisplay||"PositionSensorVRDevice"in window&&p[q]instanceof PositionSensorVRDevice){e.vrInput=p[q];break}e.vrInput||h&&h("VR input not available")}this.vrInput=null;this.scale=1;this.standing=!1;this.userHeight=1.6;this.object=null;void 0!==b&&(this.object=b);this.position=new THREE.Vector3;this.quaternion=new THREE.Quaternion;var e=this;void 0!==navigator.getVRDisplays&&navigator.getVRDisplays().then(k)}
VRControls.prototype.update=function(){if(null!==this.vrInput){var b=this.vrInput.getPose();null!==b.orientation&&this.quaternion.fromArray(b.orientation);null!==b.position?this.position.fromArray(b.position):this.position.set(0,0,0);this.standing&&(this.position.y+=this.userHeight);this.position.multiplyScalar(this.scale);null!==this.object&&(this.object.position.copy(this.position),this.object.quaternion.copy(this.quaternion))}};VRControls.prototype.dispose=function(){this.vrInput=null};
VRControls.prototype.resetPose=function(){null!==this.vrInput&&this.vrInput.resetPose()};VRControls.prototype.attachObject=function(b){this.object=b};function Resource(){this.name="file";this.uuid=THREE.Math.generateUUID();this.type="File";this.encoding=this.format="";this.data=null}Resource.prototype.toJSON=function(b){b={};b.name=this.name;b.uuid=this.uuid;b.type=this.type;b.encoding=this.encoding;return b};
function Font(b){this.name="font";this.uuid=THREE.Math.generateUUID();this.type="Font";this.path="/";this.encoding=this.format="";this.font=this.data=null;if(void 0!==b)if("object"===typeof b)this.font=this.data=b,this.name=b.original_font_information.fullName,this.encoding=this.format="json";else if(this.encoding=b.split(".").pop().toLowerCase(),"json"===this.encoding)this.font=this.data=JSON.parse(FileSystem.readFile(b)),this.name=this.data.original_font_information.fullName,this.format="json";
else if("ttf"===this.encoding||"otf"===this.encoding||"ttc"===this.encoding||"otc"===this.encoding)this.data=FileSystem.readFileArrayBuffer(b),this.font=(new TTFLoader).parse(this.data),this.name=FileSystem.getFileName(b),this.format="arraybuffer"}Font.prototype.isFont=!0;Font.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
Font.prototype.getOpentypeFont=function(){if("json"===this.encoding){var b=new opentype.Font({familyName:this.data.original_font_information.fontFamily||" ",styleName:this.data.original_font_information.fontSubfamily||this.data.styleName||" ",unitsPerEm:this.data.unitsPerEm||2048,ascender:this.data.ascender,descender:this.data.descender}),h=this.data.glyphs,k;for(k in h);return b}return null};
Font.prototype.generateShapes=function(b,h,k){void 0===h&&(h=100);void 0===k&&(k=10);var e=this.font;b=String(b).split("");var p=h/e.resolution,q=(e.boundingBox.yMax-e.boundingBox.yMin)*p,l=0,t=0;h=[];for(var r=0;r<b.length;r++){var y=b[r];if("\n"===y)t-=q,l=0;else{var z;var E=p;var B=l,F=t;if(y=e.glyphs[y]||e.glyphs["?"]){var I=new THREE.ShapePath,L=[],U=THREE.ShapeUtils.b2,n=THREE.ShapeUtils.b3;if(y.o)for(var w=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),G=0,f=w.length;G<f;){var m=w[G++];
if("m"===m){var v=w[G++]*E+B;var D=w[G++]*E+F;I.moveTo(v,D)}if("l"===m)v=w[G++]*E+B,D=w[G++]*E+F,I.lineTo(v,D);else if("q"===m){var C=w[G++]*E+B;var J=w[G++]*E+F;var N=w[G++]*E+B;m=w[G++]*E+F;I.quadraticCurveTo(N,m,C,J);if(z=L[L.length-1]){var S=z.x;z=z.y;for(var T=1;T<=k;T++){var W=T/k;U(W,S,N,C);U(W,z,m,J)}}}else if("b"===m&&(C=w[G++]*E+B,J=w[G++]*E+F,N=w[G++]*E+B,m=w[G++]*E+F,v=w[G++]*E+B,D=w[G++]*E+F,I.bezierCurveTo(N,m,v,D,C,J),z=L[L.length-1]))for(S=z.x,z=z.y,T=1;T<=k;T++)W=T/k,n(W,S,N,v,C),
n(W,z,m,D,J)}E={width:y.ha*E,path:I}}else E=void 0;l+=E.width;h.push(E.path)}}k=[];for(e=0;e<h.length;e++)Array.prototype.push.apply(k,h[e].toShapes());return k};Font.prototype.toJSON=function(b){if(void 0!==b.fonts[this.uuid])return b.fonts[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.encoding=this.encoding;h.type=this.type;h.format=this.format;h.data=this.data;h.path=this.path;return b.fonts[this.uuid]=h};
function Video(b){this.name="video";this.uuid=THREE.Math.generateUUID();this.type="Video";this.data=this.encoding=this.format="";this.path="/";void 0!==b&&(this.encoding=b.split(".").pop().toLowerCase(),this.data="data:video/"+this.encoding+";base64,"+FileSystem.readFileBase64(b),this.format="base64")}Video.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
Video.prototype.toJSON=function(b){if(void 0!==b.videos[this.uuid])return b.videos[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.format=this.format;h.data=this.data;h.path=this.path;return b.videos[this.uuid]=h};
function Audio(b){this.name="audio";this.uuid=THREE.Math.generateUUID();this.type="Audio";this.path="/";this.encoding=this.format="";this.data=null;void 0!==b&&(this.data=FileSystem.readFileArrayBuffer(b),this.encoding=b.split(".").pop().toLowerCase(),this.format="arraybuffer")}Audio.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
Audio.prototype.toJSON=function(b){if(void 0!==b.audio[this.uuid])return b.audio[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.data=Base64Utils.fromArrayBuffer(this.data);h.format="base64";h.path=this.path;return b.audio[this.uuid]=h};
GORLOT.Image=function(b){this.name="image";this.uuid=THREE.Math.generateUUID();this.type="Image";this.path="/";this.encoding=this.format="";this.data=null;void 0!==b&&(this.encoding=b.split(".").pop().toLowerCase(),"gif"===this.encoding?(this.data="data:image/"+this.encoding+";base64,"+FileSystem.readFileBase64(b),this.format="base64"):"tga"===this.encoding?(b=(new THREE.TGALoader).parse(FileSystem.readFileBase64(b)),this.encoding="jpeg",this.format="base64",this.data=b.toDataURL("image/jpeg",.9)):
(this.format="url",this.data=b))};GORLOT.Image.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
GORLOT.Image.prototype.encodeData=function(){if("url"===this.format){var b=document.createElement("img");b.src=this.data;var h=document.createElement("canvas");h.width=b.width;h.height=b.height;var k=h.getContext("2d");k.drawImage(b,0,0,b.width,b.height);var e=!1;b=k.getImageData(0,0,b.width,b.height).data;for(k=3;k<b.length;k+=4)if(255!==b[k]){e=!0;break}e?(this.format="base64",this.encoding="png",this.data=h.toDataURL("image/png")):(this.format="base64",this.encoding="jpeg",this.data=h.toDataURL("image/jpeg",
.9))}};GORLOT.Image.prototype.toJSON=function(b){if(void 0!==b.images[this.uuid])return b.images[this.uuid];var h={};h.name=this.name;h.uuid=this.uuid;h.type=this.type;h.encoding=this.encoding;h.format=this.format;h.data=this.data;h.path=this.path;return b.images[this.uuid]=h};function ResourceManager(){this.materials=[];this.textures=[];this.geometries=[];this.assetObjects=[];this.folders=[];this.images=[];this.videos=[];this.audio=[];this.fonts=[]}
ResourceManager.prototype.getMaterialByName=function(b){for(var h in this.materials.length)if(this.materials[h].name===b)return this.materials[h];return null};ResourceManager.prototype.addMaterial=function(b){b instanceof THREE.Material&&(this.materials[b.uuid]=b)};
ResourceManager.prototype.removeMaterial=function(b,h,k){void 0===h&&(h=new MeshBasicMaterial);void 0===k&&(k=new SpriteMaterial);b instanceof THREE.Material&&(delete this.materials[b.uuid],this.traverse(function(e){void 0!==e.material&&e.material.uuid===b.uuid&&(e.material=e instanceof THREE.Sprite?k:h)}))};ResourceManager.prototype.addTexture=function(b){this.textures[b.uuid]=b};
ResourceManager.prototype.getTextureByName=function(b){for(var h in this.textures.length)if(this.textures[h].name===b)return this.textures[h];return null};
ResourceManager.prototype.removeTexture=function(b,h){void 0===h&&(h=new THREE.Texture);b instanceof THREE.Texture&&(delete this.textures[b.uuid],this.traverse(k=>{void 0!==k.material?(k=k.material,null!=k.map&&k.map.uuid===b.uuid?(k.map=h,k.needsUpdate=!0):null!=k.bumpMap&&k.bumpMap.uuid===b.uuid?(k.bumpMap=h,k.needsUpdate=!0):null!=k.normalMap&&k.normalMap.uuid===b.uuid?(k.normalMap=h,k.needsUpdate=!0):null!=k.displacementMap&&k.displacementMap.uuid===b.uuid?(k.displacementMap=h,k.needsUpdate=!0):
null!=k.specularMap&&k.specularMap.uuid===b.uuid?(k.specularMap=h,k.needsUpdate=!0):null!=k.emissiveMap&&k.emissiveMap.uuid===b.uuid?(k.emissiveMap=h,k.needsUpdate=!0):null!=k.alphaMap&&k.alphaMap.uuid===b.uuid?(k.alphaMap=h,k.needsUpdate=!0):null!=k.roughnessMap&&k.roughnessMap===b.uuid?(k.roughnessMap=h,k.needsUpdate=!0):null!=k.metalnessMap&&k.metalnessMap&&(k.metalnessMap=h,k.needsUpdate=!0)):k instanceof ParticleEmitter&&k.group.texture.uuid===b.uuid&&(k.group.texture=h)}))};
ResourceManager.prototype.getFontByName=function(b){for(var h in this.fonts)if(this.fonts[h],b===b)return this.fonts[h];return null};ResourceManager.prototype.addFont=function(b){b instanceof Font&&(this.fonts[b.uuid]=b)};ResourceManager.prototype.removeFont=function(b,h){void 0===h&&(h=new Font);b instanceof Font&&(delete this.fonts[b.uuid],this.traverse(k=>{void 0!==k.font&&k.font.uuid===b.uuid&&k.setFont(h)}))};
ResourceManager.prototype.getAudioByName=function(b){for(var h in this.audio)if(this.audio[h].name===b)return this.audio[h];return null};ResourceManager.prototype.addAudio=function(b){b instanceof Audio&&(this.audio[b.uuid]=b)};ResourceManager.prototype.removeAudio=function(b,h){void 0===h&&(h=new Audio);b instanceof Audio&&(delete this.audio[b.uuid],this.traverse(k=>{}))};ResourceManager.prototype.addObject=function(b){this.assetObjects[b.uuid]=b};
ResourceManager.prototype.getAssetObjectByName=function(b){for(var h in this.assetObjects.length)if(this.assetObjects[h].name===b)return this.assetObjects[h];return null};ResourceManager.prototype.removeObject=function(b){b instanceof THREE.Object3D&&delete this.assetObjects[b.uuid]};ResourceManager.prototype.addFolder=function(b){b instanceof Folder&&(this.folders[b.uuid]=b)};
ResourceManager.prototype.removeFolder=function(b){if(b instanceof Folder){delete this.folders[b.uuid];b=b.path+b.name+"/";var h=b.split("/");h.splice(h.length-2,1);var k=h.toString();k=""===k?"/":h.toString().replace(/,/gi,"/");for(var e in this.materials)this.materials[e].path===b&&(this.materials[e].path=k);for(e in this.textures)this.textures[e].path===b&&(this.textures[e].path=k);for(e in this.fonts)this.fonts[e].path===b&&(this.fonts[e].path=k);for(e in this.assetOobjects)this.assetOobjects[e].path===
b&&(this.assetOobjects[e].path=k);for(e in this.audio)this.audio[e].path===b&&(this.audio[e].path=k)}};
function CanvasTexture(b,h,k,e,p,q,l,t,r,y,z){THREE.Texture.call(this,document.createElement("canvas"),k,e,p,q,l,t,r,y,z);this.name="canvas";this.category="Canvas";this.path="/";this.nodes={};this.width=void 0!==b?b:512;this.height=void 0!==h?h:512;this.image.width=b;this.image.height=h;this.context=this.image.getContext("2d");this.context.font="Normal 55px Arial";this.context.textAlign="center";this.context.fillStyle="#FFFF00";this.context.fillText("Canvas Texture",this.width/2,this.height/2);this.needsUpdate=
!0}CanvasTexture.prototype=Object.create(THREE.Texture.prototype);CanvasTexture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};CanvasTexture.prototype.updateNodes=function(b){this.nodes=b};CanvasTexture.prototype.toJSON=function(b){b=THREE.Texture.prototype.toJSON.call(this);b.width=this.width;b.height=this.height;b.path=this.path;b.nodes=this.nodes;return b};
function VideoTexture(b,h,k,e,p,q){function l(){b.readyState>=b.HAVE_CURRENT_DATA&&(t.needsUpdate=!0);t.disposed||requestAnimationFrame(l)}"string"===typeof b?this.video=new Video(b):b instanceof Video&&(this.video=b);THREE.Texture.call(this,document.createElement("video"),h,k,e,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,p,q);this.disposed=this.generateMipmaps=!1;this.name="video";this.category="Video";this.path="/";this.nodes={};this.loop=this.autoplay=!0;this.volume=this.playbackRate=
1;this.image.src=this.video.data;this.image.autoplay=this.autoplay;this.image.playbackRate=this.playbackRate;this.image.loop=this.loop;this.image.volume=this.volume;var t=this;b=this.image;l()}VideoTexture.prototype=Object.create(THREE.Texture.prototype);VideoTexture.prototype.setTime=function(b){this.image.currentImage=b};VideoTexture.prototype.setLoop=function(b){this.loop=b;this.image.loop=b};VideoTexture.prototype.setVolume=function(b){this.volume=0<=b&&1>=b?b:0<=b?1:0;this.image.volume=this.volume};
VideoTexture.prototype.setPlaybackRate=function(b){this.playbackRate=b;this.image.playbackRate=b};VideoTexture.prototype.pause=function(){this.image.paused||this.image.pause()};VideoTexture.prototype.play=function(){this.image.paused&&this.image.play()};VideoTexture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};VideoTexture.prototype.updateNodes=function(b){this.nodes=b};
VideoTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};VideoTexture.prototype.toJSON=function(b){var h=THREE.Texture.prototype.toJSON.call(this,b);b=this.video.toJSON(b);h.video=b.uuid;h.loop=this.loop;h.autoplay=this.autoplay;h.path=this.path;h.nodes=this.nodes;h.playbackRate=this.playbackRate;h.volume=this.volume;return h};
function WebcamTexture(b,h,k,e,p,q,l){function t(){r.readyState>=r.HAVE_CURRENT_DATA&&(y.needsUpdate=!0);y.disposed||requestAnimationFrame(t)}var r=document.createElement("video");r.autoplay=!0;r.loop=!0;navigator.webkitGetUserMedia?navigator.webkitGetUserMedia({video:!0},function(z){r.src=URL.createObjectURL(z)},function(z){console.warn("WebcamTexture: No webcam available")}):navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!0}).then(function(z){r.src=URL.createObjectURL(z)}).catch(function(z){console.warn("No webcam available")});
THREE.Texture.call(this,r,b,h,k,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBFormat,q,l);this.disposed=this.generateMipmaps=!1;this.name="webcam";this.category="Webcam";this.path="/";this.nodes={};var y=this;t()}WebcamTexture.prototype=Object.create(THREE.VideoTexture.prototype);WebcamTexture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};WebcamTexture.prototype.updateNodes=function(b){this.nodes=b};
WebcamTexture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0;this.image.paused||this.image.pause()};WebcamTexture.prototype.toJSON=function(b){b=THREE.VideoTexture.prototype.toJSON.call(this,b);b.path=this.path;b.nodes=this.nodes;return b};
function Texture(b,h,k,e,p,q,l,t,r,y){this.img="string"===typeof b?new GORLOT.Image(b):void 0===b?new GORLOT.Image:b;THREE.Texture.call(this,document.createElement("img"),h,k,e,p,q,l,t,r,y);b="png"===this.img.encoding||"gif"===this.img.encoding;var z=this;this.name="texture";this.category="Image";this.path="/";this.nodes={};this.disposed=!1;this.format=b?THREE.RGBAFormat:THREE.RGBFormat;this.image.src=this.img.data;this.image.onload=function(){z.needsUpdate=!0};if("gif"===this.img.encoding){var E=
function(){z.disposed||(z.needsUpdate=!0,requestAnimationFrame(E))};E()}}Texture.prototype=Object.create(THREE.Texture.prototype);Texture.prototype.setPath=function(b){void 0!==b&&(this.path=b)};Texture.prototype.updateNodes=function(b){this.nodes=b};Texture.prototype.dispose=function(){THREE.Texture.prototype.dispose.call(this);this.disposed=!0};
Texture.prototype.toJSON=function(b){var h=THREE.Texture.prototype.toJSON.call(this,b);b=this.img.toJSON(b);h.image=b.uuid;h.path=this.path;h.nodes=this.nodes;return h};function FontLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}FontLoader.fileIsFont=function(b){b=b.toLocaleLowerCase();return b.endsWith("ttf")||b.endsWith("otf")||b.endsWith("ttc")||b.endsWith("otc")};
FontLoader.prototype.load=function(b,h,k,e){(new THREE.FileLoader(this.manager)).load(b,function(p){h(new Font(JSON.parse(p)))},k,e)};FontLoader.prototype.parse=function(b){if(void 0!==b.data){var h=new Font;h.name=b.name;h.uuid=b.uuid;h.encoding=b.encoding;"base64"===b.format?(h.format="arraybuffer",h.data=ArraybufferUtils.fromBase64(b.data),h.font=(new TTFLoader).parse(h.data)):(h.format=b.format,h.data=b.data,h.font=b.data);void 0!==b.path&&(h.path=b.path);return h}return new Font(b)};
function ImageLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}ImageLoader.prototype.loadJSON=function(b,h,k,e){var p=this;(new THREE.FileLoader(this.manager)).load(b,function(q){p.parse(JSON.parse(q),h)},k,e)};ImageLoader.prototype.parse=function(b,h){h=new GORLOT.Image;h.name=b.name;h.uuid=b.uuid;h.format=b.forma;h.encoding=b.encoding;h.data=b.data;void 0!==b.path&&(h.path=b.path);return h};function VideoLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}
VideoLoader.prototype.load=function(b,h,k,e){var p=this;(new THREE.FileLoader(this.manager)).load(b,q=>{p.parse(JSON.parse(q),h)},k,e)};VideoLoader.prototype.parse=function(b,h){h=new Video;h.name=b.name;h.uuid=b.uuid;h.format=b.uuid;h.encoding=b.encoding;h.data=b.data;void 0!==b.path&&(h.path=b.path);return h};function AudioLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager}
AudioLoader.prototype.load=function(b,h,k,e){var p=this;(new THREE.FileLoader(this.manager)).load(b,q=>{p.parse(JSON.parse(q),h)},k,e)};AudioLoader.prototype.parse=function(b){var h=new Audio;h.name=b.name;h.uuid=b.uuid;h.encoding=b.encoding;h.format="arraybuffer";h.data=ArraybufferUtils.fromBase64(b.data);void 0!==b.path&&(h.path=b.path);return h};function TextureLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.images=[];this.videos=[];this.fonts=[]}THREE.TextureLoader=TextureLoader;
TextureLoader.prototype.load=function(b,h,k,e){b=new Texture(b);void 0!==h&&h(b);return b};TextureLoader.prototype.loadJSON=function(b,h,k,e){var p=this;(new THREE.FileLoader(this.manager)).load(b,q=>{p.parse(JSON.parse(q),h)},k,e)};
TextureLoader.prototype.parse=function(b,h){var k=b.category;"Video"===k?(void 0===b.video&&console.warn("TextureLoader: No video specified for",b.uuid),void 0===this.videos[b.video]&&console.warn("TextureLoader: Undefined video",b.video),k=new VideoTexture(this.videos[b.video]),k.loop=b.loop,k.autoplay=b.autoplay,k.playbackRate=b.playbackRate,k.volume=b.volume):"Webcam"===k?k=new WebcamTexture:"Canvas"===k?k=new CanvasTexture(b.width,b.height):(void 0===b.image&&console.warn("TextureLoader: No image specified for",
b.uuid),void 0===this.images[b.image]&&console.warn("TextureLoader: Undefined image",b.image),k=new Texture(this.images[b.image]));k.uuid=b.uuid;k.name=b.name;k.mapping=b.mapping;k.offset=new THREE.Vector2(b.offset[0],b.offset[1]);k.repeat=new THREE.Vector2(b.repeat[0],b.repeat[1]);k.wrapS=b.wrap[0];k.wrapT=b.wrap[1];k.minFilter=b.minFilter;k.magFilter=b.magFilter;k.anisotropy=b.anisotropy;k.flipY=b.flipY;void 0!==b.path&&(k.path=b.path);void 0!==h&&h(k);return k};
TextureLoader.prototype.setImages=function(b){this.images=b;return this};TextureLoader.prototype.setVideos=function(b){this.videos=b;return this};TextureLoader.prototype.setFonts=function(b){this.fonts=b;return this};function ObjectLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.texturePath=""}
ObjectLoader.prototype.load=function(b,h,k,e){""===this.texturePath&&(this.texturePath=b.substring(0,b.lastIndexOf("/")+1));var p=this;(new THREE.FileLoader(this.manager)).load(b,function(q){p.parse(JSON.parse(q),h)},k,e)};
ObjectLoader.prototype.parse=function(b,h){var k=this.parseGeometries(b.geometries),e=this.parseImages(b.images),p=this.parseVideos(b.videos),q=this.parseAudio(b.audio),l=this.parseFonts(b.fonts);e=this.parseTextures(b.textures,e,p);p=this.parseMaterials(b.materials,e);var t=this.parseAssetObjects(b.assetObjects);k=this.parseObject(b.object,k,p,e,q,l,t);b.animations&&(k.animations=this.parseAnimations(b.animations));void 0!==b.images&&0!==b.images.length||void 0===h||h(k);return k};
ObjectLoader.prototype.setTexturePath=function(b){this.texturePath=b};ObjectLoader.prototype.setCrossOrigin=function(b){this.crossOrigin=b};
ObjectLoader.prototype.parseGeometries=function(b){var h=[];if(void 0!==b)for(var k=new THREE.JSONLoader,e=new THREE.BufferGeometryLoader,p=0;p<b.length;p++){var q=b[p];switch(q.type){case "PlaneGeometry":case "PlaneBufferGeometry":var l=new THREE[q.type](q.width,q.height,q.widthSegments,q.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":l=new THREE[q.type](q.width,q.height,q.depth,q.widthSegments,q.heightSegments,q.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":l=
new THREE[q.type](q.radius,q.segments,q.thetaStart,q.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":l=new THREE[q.type](q.radiusTop,q.radiusBottom,q.height,q.radialSegments,q.heightSegments,q.openEnded,q.thetaStart,q.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":l=new THREE[q.type](q.radius,q.height,q.radialSegments,q.heightSegments,q.openEnded,q.thetaStart,q.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":l=new THREE[q.type](q.radius,
q.widthSegments,q.heightSegments,q.phiStart,q.phiLength,q.thetaStart,q.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":l=new THREE[q.type](q.radius,q.detail);break;case "RingGeometry":case "RingBufferGeometry":l=new THREE[q.type](q.innerRadius,q.outerRadius,q.thetaSegments,q.phiSegments,q.thetaStart,q.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":l=new THREE[q.type](q.radius,q.tube,q.radialSegments,
q.tubularSegments,q.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":l=new THREE[q.type](q.radius,q.tube,q.tubularSegments,q.radialSegments,q.p,q.q);break;case "LatheGeometry":case "LatheBufferGeometry":l=new THREE[q.type](q.points,q.segments,q.phiStart,q.phiLength);break;case "BufferGeometry":l=e.parse(q);break;case "Geometry":l=k.parse(q.data,this.texturePath).geometry;break;default:console.warn('ObjectLoader: Unsupported geometry type "'+q.type+'"');continue}l.uuid=q.uuid;l.name=
void 0!==q.name?q.name:"geometry";h[q.uuid]=l}return h};ObjectLoader.prototype.parseMaterials=function(b,h){var k=[],e=new MaterialLoader;e.setTextures(h);if(void 0!==b)for(h=0;h<b.length;h++){var p=e.parse(b[h]);k[p.uuid]=p}return k};ObjectLoader.prototype.parseAnimations=function(b){for(var h=[],k=0;k<b.length;k++){var e=THREE.AnimationClip.parse(b[k]);h.push(e)}return h};
ObjectLoader.prototype.parseImages=function(b){var h=new ImageLoader,k=[];if(void 0!==b)for(var e=0;e<b.length;e++)k[b[e].uuid]=h.parse(b[e]);return k};ObjectLoader.prototype.parseVideos=function(b){var h=new VideoLoader,k=[];if(void 0!==b)for(var e=0;e<b.length;e++)k[b[e].uuid]=h.parse(b[e]);return k};ObjectLoader.prototype.parseAudio=function(b){var h=new AudioLoader,k=[];if(void 0!==b)for(var e=0;e<b.length;e++)k[b[e].uuid]=h.parse(b[e]);return k};
ObjectLoader.prototype.parseFonts=function(b){var h=new FontLoader,k=[];if(void 0!==b)for(var e=0;e<b.length;e++)k[b[e].uuid]=h.parse(b[e]);return k};ObjectLoader.prototype.parseTextures=function(b,h,k){var e=new TextureLoader;e.setImages(h);e.setVideos(k);h=[];if(void 0!==b)for(k=0;k<b.length;k++){var p=e.parse(b[k]);h[p.uuid]=p}return h};ObjectLoader.prototype.parseAssetObjects=function(b){var h=new ObjectLoader,k=[];if(void 0!==b)for(var e=0;e<b.length;e++){var p=h.parse(b[e]);k[p.uuid]=p}return k};
ObjectLoader.prototype.parseObject=function(b,h,k,e,p,q,l){function t(n){void 0===e[n]&&console.warn("ObjectLoader: Undefined texture",n);return e[n]}function r(n){void 0===h[n]&&console.warn("ObjectLoader: Undefined geometry",n);return h[n]}function y(n){void 0===k[n]&&console.warn("ObjectLoader: Undefined material",n);return k[n]}function z(n){void 0===q[n]&&console.warn("ObjectLoader: Undefined font",n);return q[n]}var E=new THREE.Matrix4;switch(b.type){case "SpineAnimation":for(var B=0;B<b.textures.length;B++)b.textures[B].texture=
t(b.textures[B].texture);var F=new SpineAnimation(b.json,b.atlas,"",b.textures);break;case "Audio":void 0===p[b.audio]&&console.warn();F=new AudioEmitter(void 0);F.autoplay=b.autoplay;F.startTime=b.startTime;F.playbackRate=b.playbackRate;F.loop=void 0!==b.source?b.source.loop:b.loop;void 0!==b.volume&&(F.volume=b.volume);break;case "PositionalAudio":void 0===p[b.audio]&&console.warn();F=new PositionalAudio(void 0);F.autoplay=b.autoplay;F.startTime=b.startTime;F.playbackRate=b.playbackRate;F.loop=
void 0!==b.source?b.source.loop:b.loop;void 0!==b.volume&&(F.volume=b.volume);break;case "Physics":F=new PhysicsObject;F.body.type=b.body.type;F.body.mass=b.body.mass;F.body.linearDamping=b.body.linearDamping;F.body.angularDamping=b.body.angularDamping;F.body.allowSleep=b.body.allowSleep;F.body.sleepSpeedLimit=b.body.sleepSpeedLimit;F.body.sleepTimeLimit=b.body.sleepTimeLimit;F.body.collisionFilterGroup=b.body.collisionFilterGroup;F.body.collisionFilterMask=b.body.collisionFilterMask;F.body.fixedRotation=
b.body.fixedRotation;var I=b.body.shapes;for(B=0;B<I.length;B++){var L=I[B];L.type===CANNON.Shape.types.SPHERE?F.body.addShape(new CANNON.Sphere(L.radius)):L.type===CANNON.Shape.types.BOX?F.body.addShape(new CANNON.Box(new CANNON.Vec3(L.halfExtents.x,L.halfExtents.y,L.halfExtents.z))):L.type===CANNON.Shape.types.PARTICLE?F.body.addShape(new CANNON.Particle):L.type===CANNON.Shape.types.PLANE?F.body.addShape(new CANNON.Plane):L.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&F.body.addShape(new CANNON.ConvexPolyhedron(L.vertices,
L.faces))}break;case "ParticleEmiter":void 0!==b.group&&(F=b.group,F.texture.value=t(F.texture.value),F.textureFrames=THREE.Vector2(F.textureFrames));if(void 0!==b.emitter)for(F=b.emitter,F.position.value=THREE.Vector3.fromJSON(F.position.value),F.position.spread=THREE.Vector3.fromJSON(F.position.spread),F.velocity.value=THREE.Vector3.fromJSON(F.velocity.value),F.velocity.spread=THREE.Vector3.fromJSON(F.velocity.spread),F.acceleration.value=THREE.Vector3.fromJSON(F.acceleration.value),F.acceleration.spread=
THREE.Vector3.fromJSON(F.acceleration.spread),B=0;B<F.color.value.length;B++)F.color.value[B]=new THREE.Color(F.color.value[B]),F.color.spread[B]=THREE.Vector3.fromJSON(F.color.spread[B]);F=new ParticleEmitter(b.group,b.emitter);break;case "Text3D":F=new Text3D(b.text,y(b.material),z(b.font),b.height,b.bevel,b.bevelThickness,b.bevelSize,b.size,b.curveSegments);break;case "Program":F=new Program(b.name);F.description=b.description;F.author=b.author;F.version=b.version;F.vr=b.vr;F.vrScale=b.vrScale;
void 0!==b.antialiasing&&(F.antialiasing=b.antialiasing,F.shadows=b.shadows,F.shadowsType=b.shadowsType);void 0!==b.lockPointer&&(F.lockPointer=b.lockPointer);void 0!==b.defaultScene&&(F.defaultScene=b.defaultScene);break;case "LeapDevice":F=new LeapMotion;F.mode=b.mode;F.useArm=b.useArm;void 0!==b.debugModel&&(F.debugModel=b.debugModel);void 0!==b.gesturesEnabled&&(F.gesturesEnabled=b.gesturesEnabled);void 0!==b.posesEnabled&&(F.posesEnabled=b.posesEnabled);break;case "Kinect":F=new KinectDevice;
void 0!==b.debugModel&&(F.debugModel=b.debugModel);break;case "Sky":F=new Sky(b.autoUpdate,b.dayTime,b.sunDistance,b.time);void 0!==b.sun&&F.sun.shadow.fromJSON(b.sun.shadow);break;case "Scene":F=new Scene;void 0!==b.background&&Number.isInteger(b.background)&&(F.background=new THREE.Color(b.background));void 0!==b.fog&&("Fog"===b.fog.type?F.fog=new THREE.Fog(b.fog.color,b.fog.near,b.fog.far):"FogExp2"===b.fog.type&&(F.fog=new THREE.FogExp2(b.fog.color,b.fog.density)));void 0!==b.cameras&&(F.cameras=
b.cameras);void 0!==b.world&&F.world.gravity.set(b.world.gravity.x,b.world.gravity.y,b.world.gravity.z);break;case "PerspectiveCamera":F=new PerspectiveCamera(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(F.focus=b.focus);void 0!==b.zoom&&(F.zoom=b.zoom);void 0!==b.filmGauge&&(F.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(F.filmOffset=b.filmOffset);void 0!==b.view&&(F.view=Object.assign({},b.view));void 0!==b.viewport&&F.viewport.fromArray(b.viewport);void 0!==b.offset&&F.offset.fromArray(b.offset);
void 0!==b.clearColor&&(F.clearColor=b.clearColor);void 0!==b.clearDepth&&(F.clearDepth=b.clearDepth);void 0!==b.order&&(F.order=b.order);break;case "OrthographicCamera":F=new OrthographicCamera(b.size,b.aspect,b.mode,b.near,b.far);void 0!==b.viewport&&F.viewport.fromArray(b.viewport);void 0!==b.offset&&F.offset.fromArray(b.offset);void 0!==b.clearColor&&(F.clearColor=b.clearColor);void 0!==b.clearDepth&&(F.clearDepth=b.clearDolor);void 0!==b.order&&(F.order=b.order);break;case "RectAreaLight":F=
new RectAreaLight(b.color,b.intensity,b.width,b.height);break;case "AmbientLight":F=new AmbientLight(b.color,b.intensity);break;case "DirectionalLight":F=new DirectionalLight(b.color,b.intensity);break;case "PointLight":F=new PointLight(b.color,b.intensity,b.distance,b.decay);break;case "SpotLight":F=new SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":F=new HemisphereLight(b.color,b.groundColor,b.intensity);break;case "Mesh":F=new Mesh(r(b.geometry),
y(b.material));break;case "SkinnedMesh":F=new SkinnedMesh(r(b.geometry),y(b.material));break;case "LOD":F=new THREE.LOD;break;case "Line":F=new THREE.Line(r(b.geometry),y(b.material),b.mode);break;case "PointCloud":case "Points":F=new THREE.Points(r(b.geometry),y(b.material));break;case "Sprite":F=new Sprite(y(b.material));break;case "Group":F=new Empty;break;case "ObjectCaller":F=new ObjectCaller(b.objUuid,b.objType);break;case "Script":F=new Script(b.code);break;case "BlockScript":F=new BlockScript(b.nodes);
break;case "Bone":F=new Bone;break;default:F=new Empty}F.uuid=b.uuid;void 0!==b.name&&(F.name=b.name);void 0!==b.hidden&&(F.hidden=b.hidden);void 0!==b.folded&&(F.folded=b.folded);void 0!==b.path&&(F.path=b.path);void 0!==b.matrix?(E.fromArray(b.matrix),E.decompose(F.position,F.quaternion,F.scale)):(void 0!==b.position&&F.position.fromArray(b.position),void 0!==b.rotation&&F.rotation.fromArray(b.rotation),void 0!==b.scale&&F.scale.fromArray(b.scale));void 0!==b.castShadow&&(F.castShadow=b.castShadow);
void 0!==b.receiveShadow&&(F.receiveShadow=b.receiveShadow);void 0!==b.shadow&&F.shadow.fromJSON(b.shadow);void 0!==b.visible&&(F.visible=b.visible);void 0!==b.userData&&(F.userData=b.userData);if(void 0!==b.children)for(var U in b.children)F.add(this.parseObject(b.children[U],h,k,e,p,q));void 0!==b.nodes&&(F.nodes=b.nodes);void 0!==b.blocksType&&(F.blocksType=b.blocksType);if(void 0!==b.components)for(B in b.components)eval(`
				object.components.push(new ${b.components[B].className}())
				object.components[object.components.length - 1].values = compo.values
			`);void 0!==b.matrixAutoUpdate&&(F.matrixAutoUpdate=b.matrixAutoUpdate,F.matrixAutoUpdate||(F.updateMatrix(),F.updateMatrixWorld(!0)));if("Program"===b.type){F.materials=k;F.assetObjects=l;F.textures=e;U=[];for(B=0;B<b.folders.length;B++)l=new Folder(b.folders[B].name),l.uuid=b.folders[B].uuid,l.path=b.folders[B].path,U[l.uuid]=l;F.folders=U;F.fonts=q;F.audio=p}else if("Scene"===b.type)for(B=0;B<F.cameras.length;B++)U=F.getCamera(F.cameras[B]),null!==U?F.cameras[B]=U:F.cameras.splice(B,1);else if("LOD"===
b.type)for(B=b.levels,b=0;b<B.length;b++)p=B[b],U=F.getObjectByProperty("uuid",p.object),void 0!==U&&F.addLevel(U,p.distance);return F};var MaterialLoader=function(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.textures={}};
MaterialLoader.prototype={constructor:MaterialLoader,load:function(b,h,k,e){var p=this;(new THREE.XHRLoader(p.manager)).load(b,function(q){h(p.parse(JSON.parse(q)))},k,e)},setTextures:function(b){this.textures=b},getTexture:function(b){var h=this.textures;void 0===h[b]&&console.warn("THREE.MaterialLoader: Undefined texture",b);return h[b]},parse:function(b){var h=b.type;"MeshPhongMaterial"===h?h=new MeshPhongMaterial:"MeshStandardMaterial"===h?h=new MeshStandardMaterial:"MeshLambertMaterial"===h?
h=new MeshLambertMaterial:"SpriteMaterial"===h?h=new SpriteMaterial:"ShaderMaterial"===h?h=new MeshShaderMaterial:"MeshNormalMaterial"===h?h=new MeshNormalMaterial:"MeshDepthMaterial"===h?h=new MeshDepthMaterial:"MeshToonMaterial"===h?h=new MeshToonMaterial:(console.log('Unregistered material in "MaterialLoader": '+b.type),h=new THREE[b.type]);void 0!==b.path&&(h.path=b.path);void 0!==b.uuid&&(h.uuid=b.uuid);void 0!==b.name&&(h.name=b.name);void 0!==b.color&&h.color.setHex(b.color);void 0!==b.roughness&&
(h.roughness=b.roughness);void 0!==b.metalness&&(h.metalness=b.metalness);void 0!==b.emissive&&h.emissive.setHex(b.emissive);void 0!==b.nodes&&(h.nodes=b.nodes);void 0!==b.specular&&h.specular.setHex(b.specular);void 0!==b.shininess&&(h.shininess=b.shininess);void 0!==b.uniforms&&(h.uniforms=b.uniforms);void 0!==b.vertexShader&&(h.vertexShader=b.vertexShader);void 0!==b.fragmentShader&&(h.fragmentShader=b.fragmentShader);void 0!==b.vertexColors&&(h.vertexColors=b.vertexColors);void 0!==b.shading&&
(h.shading=b.shading);void 0!==b.blending&&(h.blending=b.blending);void 0!==b.side&&(h.side=b.side);void 0!==b.opacity&&(h.opacity=b.opacity);void 0!==b.transparent&&(h.transparent=b.transparent);void 0!==b.alphaTest&&(h.alphaTest=b.alphaTest);void 0!==b.depthTest&&(h.depthTest=b.depthTest);void 0!==b.depthWrite&&(h.depthWrite=b.depthWrite);void 0!==b.colorWrite&&(h.colorWrite=b.colorWrite);void 0!==b.wireframe&&(h.wireframe=b.wireframe);void 0!==b.wireframeLinewidth&&(h.wireframeLinewidth=b.wireframeLinewidth);
void 0!==b.size&&(h.size=b.size);void 0!==b.sizeAttenuation&&(h.sizeAttenuation=b.sizeAttenuation);void 0!==b.map&&(h.map=this.getTexture(b.map));void 0!==b.alphaMap&&(h.alphaMap=this.getTexture(b.alphaMap),h.transparent=!0);void 0!==b.bumpMap&&(h.bumpMap=this.getTexture(b.bumpMap));void 0!==b.bumpScale&&(h.bumpScale=b.bumpScale);void 0!==b.normalMap&&(h.normalMap=this.getTexture(b.normalMap));if(void 0!==b.normalScale){var k=b.normalScale;!1===Array.isArray(k)&&(k=[k,k]);h.normalScale=(new THREE.Vector2).fromArray(k)}void 0!==
b.displacementMap&&(h.displacementMap=this.getTexture(b.displacementMap));void 0!==b.displacementScale&&(h.displacementScale=b.displacementScale);void 0!==b.displacementBias&&(h.displacementBias=b.displacementBias);void 0!==b.roughnessMap&&(h.roughnessMap=this.getTexture(b.roughnessMap));void 0!==b.metalnessMap&&(h.metalnessMap=this.getTexture(b.metalnessMap));void 0!==b.emissiveMap&&(h.emissiveMap=this.getTexture(b.emissiveMap));void 0!==b.emissiveIntensity&&(h.emissiveIntensity=b.emissiveIntensity);
void 0!==b.specularMap&&(h.specularMap=this.getTexture(b.specularMap));void 0!==b.envMap&&(h.envMap=this.getTexture(b.envMap),h.combine=THREE.MultiplyOperation);b.reflectivity&&(h.reflectivity=b.reflectivity);void 0!==b.lightMap&&(h.lightMap=this.getTexture(b.lightMap));void 0!==b.lightMapIntensity&&(h.lightMapIntensity=b.lightMapIntensity);void 0!==b.aoMap&&(h.aoMap=this.getTexture(b.aoMap));void 0!==b.aoMapIntensity&&(h.aoMapIntensity=b.aoMapIntensity);if(void 0!==b.materials){k=0;for(var e=b.materials.length;k<
e;k++)h.materials.push(this.parse(b.materials[k]))}return h}};function TTFLoader(b){this.manager=void 0!==b?b:THREE.DefaultLoadingManager;this.reversed=!1}TTFLoader.prototype.load=function(b,h,k,e){var p=this,q=new THREE.FileLoader(this.manager);q.setResponseType("arraybuffer");q.load(b,function(l){l=p.parse(l);void 0!==h&&h(l)},k,e)};TTFLoader.prototype.parse=function(b){b=opentype.parse(b);return TTFLoader.convert(b,this.reversed)};
TTFLoader.convert=function(b,h){for(var k=1E5/(72*(b.unitsPerEm||2048)),e={glyphs:{}},p=0;p<b.glyphs.length;p++){var q=b.glyphs.glyphs[p];if(void 0!==q.unicode){var l={};l.ha=Math.round(q.advanceWidth*k);l.x_min=Math.round(q.xMin*k);l.x_max=Math.round(q.xMax*k);l.o="";h&&(q.path.commands=TTFLoader.reverseCommands(q.path.commands));q.path.commands.forEach(function(t,r){"c"===t.type.toLowerCase()&&(t.type="b");l.o+=t.type.toLowerCase();l.o+=" ";void 0!==t.x&&void 0!==t.y&&(l.o+=Math.round(t.x*k),l.o+=
" ",l.o+=Math.round(t.y*k),l.o+=" ");void 0!==t.x1&&void 0!==t.y1&&(l.o+=Math.round(t.x1*k),l.o+=" ",l.o+=Math.round(t.y1*k),l.o+=" ");void 0!==t.x2&&void 0!==t.y2&&(l.o+=Math.round(t.x2*k),l.o+=" ",l.o+=Math.round(t.y2*k),l.o+=" ")});e.glyphs[String.fromCharCode(q.unicode)]=l}}e.resolution=1E3;e.original_font_information=b.names;e.unitsPerEm=b.unitsPerEm;e.ascender=Math.round(b.ascender*k);e.descender=Math.round(b.descender*k);e.underlinePosition=b.tables.post.underlinePosition;e.underlineThickness=
b.tables.post.underlineThickness;e.boundingBox={yMin:b.tables.head.yMin,xMin:b.tables.head.xMin,yMax:b.tables.head.yMax,xMax:b.tables.head.xMax};return e};
TTFLoader.reverseCommands=function(b){var h=[],k;b.forEach(function(p){"m"===p.type.toLowerCase()?(k=[p],h.push(k)):"z"!==p.type.toLowerCase()&&k.push(p)});var e=[];h.forEach(function(p){var q={type:"m",x:p[p.length-1].x,y:p[p.length-1].y};e.push(q);for(var l=p.length-1;0<l;l--){var t=p[l];q={type:t.type};void 0!==t.x2&&void 0!==t.y2?(q.x1=t.x2,q.y1=t.y2,q.x2=t.x1,q.y2=t.y1):void 0!==t.x1&&void 0!==t.y1&&(q.x1=t.x1,q.y1=t.y1);q.x=p[l-1].x;q.y=p[l-1].y;e.push(q)}});return e};
function LeapMotion(){THREE.Object3D.call(this);this.type="LeapDevice";this.name="leap";this.posesEnabled=this.gesturesEnabled=this.debugModel=!0;this.mode=LeapMotion.DESK;this.useArm=!1;this.boneMeshes=[];this.armMeshes=[];this.material=new THREE.MeshPhongMaterial;this.geometry=new THREE.BoxBufferGeometry(1,1,1);this.physicsWorld=null;this.physicsBodys=[];this.gesture=[];for(var b=0;10>b;b++)this.gesture[b]=!1;this.pose=[];for(b=0;3>b;b++)this.pose[b]=!1;this.data=null;this.components=[];this.defaultComponents=
[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LeapComponent)}LeapMotion.prototype=Object.create(THREE.Object3D.prototype);LeapMotion.DESK=0;LeapMotion.HDM=1;LeapMotion.SWIPE=0;LeapMotion.SWIPE_LEFT=1;LeapMotion.SWIPE_RIGHT=2;LeapMotion.SWIPE_FRONT=3;LeapMotion.SWIPE_BACK=4;LeapMotion.SWIPE_UP=5;LeapMotion.SWIPE_DOWN=6;LeapMotion.CIRCLE=7;LeapMotion.SCREEN_TAP=8;LeapMotion.KEY_TAP=9;LeapMotion.CLOSED=0;
LeapMotion.OPEN=1;LeapMotion.POINTING=2;LeapMotion.prototype.initialize=function(){var b=this;Leap.loop({background:!0},function(k){b.data=k}).connect();for(var h=0;h<this.children.length;h++)this.children[h].initialize()};LeapMotion.prototype.update=function(){null!==this.data&&(this.gesturesEnabled&&this.updateGestures(),this.posesEnabled&&this.updatePoses(),this.debugModel&&this.updateDebugModel());for(var b=0;b<this.children.length;b++)this.children[b].update()};
LeapMotion.prototype.checkGesture=function(b){return void 0!==this.gesture[b]?this.gesture[b]:!1};LeapMotion.prototype.checkPose=function(b){return void 0!==this.pose[b]?this.pose[b]:!1};LeapMotion.prototype.setMode=function(b){this.mode=b};
LeapMotion.prototype.updatePoses=function(){for(var b=0;b<this.pose.length;b++)this.pose[b]=!0;for(var h=0;h<this.data.hands.length;h++){var k=this.data.hands[h],e=k.sphereCenter;e=new THREE.Vector3(e[0],e[1],e[2]);var p=[],q=0;for(b=0;b<this.pose.length;b++)this.pose[b]=!0;var l=[];for(b=0;b<k.fingers.length;b++){var t=k.fingers[b];l.push(t.direction);t=t.distal.nextJoint;t=new THREE.Vector3(t[0],t[1],t[2]);p.push(e.distanceTo(t)/k._scaleFactor);0!==b&&(.3>l[b][2]&&(this.pose[LeapMotion.CLOSED]=
!1),-.5<l[b][2]&&(this.pose[LeapMotion.OPEN]=!1),1===b?q=p[1]:q<2*p[b]-15&&(this.pose[LeapMotion.POINTING]=!1))}q<2*p[0]-15&&(this.pose[LeapMotion.POINTING]=!1)}};
LeapMotion.prototype.updateGestures=function(){for(var b=0;b<this.gesture.length;b++)this.gesture[b]=!1;var h=this;this.data.valid&&0<this.data.gestures.length&&this.data.gestures.forEach(function(k){"swipe"===k.type?(h.gesture[LeapMotion.SWIPE]=!0,0<k.direction[0]?h.gesture[LeapMotion.SWIPE_RIGHT]=!0:h.gesture[LeapMotion.SWIPE_LEFT]=!0,0<k.direction[1]?h.gesture[LeapMotion.SWIPE_UP]=!0:h.gesture[LeapMotion.SWIPE_DOWN]=!0,0<k.direction[2]?h.gesture[LeapMotion.SWIPE_FRONT]=!0:h.gesture[LeapMotion.SWIPE_BACK]=
!0):"circle"===k.type?h.gesture[LeapMotion.CIRCLE]=!0:"keyTap"===k.type?h.gesture[LeapMotion.KEY_TAP]=!0:"screenTap"===k.type&&(h.gesture[LeapMotion.SCREEN_TAP]=!0)})};
LeapMotion.prototype.updateDebugModel=function(){var b=this;this.arMeshes.forEach(function(z){b.remove(z)});this.boneMeshes.forEach(function(z){b.remove(z)});for(var h=0,k=0,e=0;e<this.data.hands.length;e++){for(var p=this.data.hands[e],q=0;q<p.fingers.length;q++)for(var l=p.fingers[e],t=0;t<l.bones.length;t++){var r=l.bones[t];if(0!==h){var y=this.boneMeshes[h]||this.addMesh(this.boneMeshes);this.updateMesh(r,y)}h++}this.showArm&&(p=p.arm,q=this.armMeshes[k++]||this.addMesh(this.armMeshes),this.updateMesh(p,
q),q.scale.set(p.width/1200,p.width/300,p.length/150))}null!==this.physicsWorld&&this.updatePhysics()};
LeapMotion.prototype.updatePhysics=function(){for(var b=0;b<this.physicsBodys.length;b++)this.physicsWorld.removeBody(this.physicsBodys[b].pop());this.children.forEach(function(h,k){h=new THREE.BoundingBoxHelper(h);h.update();k=new THREE.Vector3(h.box.max.x-h.box.min.x,h.box.max.y-h.box.min.y,h.box.max.z-h.box.min.z);k.x*=this.scale.x;k.y*=this.scale.y;k.z*=this.scale.z;k.divideScalar(2);h=h.box.center();h.x*=this.scale.x;h.y*=this.scale.y;h.z*=this.scale.z;h.add(this.position);k=new CANNON.Box(new CANNON.Vec3(k.x,
k.y,k.z));var e=new CANNON.Body({mass:0});e.addShape(k);e.position.set(h.x-this.position.x,h.y-this.position.y,h.z-this.position.z);e.updateMassProperties();this.physicsBodys.push(e);this.physicsWorld.addBody(e)})};LeapMotion.prototype.addMesh=function(b){var h=new Mesh(this.geometry,this.material);h.castShadow=this.castShadow;h.receiveShadow=this.receiveShadow;b.push(h);return h};
LeapMotion.prototype.updateMesh=function(b,h){h.position.fromArray(b.center());h.position.divideScalar(150);h.setRotationFromMatrix((new THREE.Matrix4).fromArray(b.matrix()));h.scale.set(b.width/150,b.width/150,b.length/150);this.add(h)};LeapMotion.prototype.getMovement=function(){var b=this.data.gestures[0].position,h=this.data.gestures[0].startPosition;b=new THREE.Vector3(b[0]-h[0],b[1]-h[1],b[2]-h[2]);b.divideScalar(this.data.currentFrameRate);return b};
LeapMotion.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.type=this.type;b.object.debugModel=this.debugModel;b.object.gesturesEnabled=this.gesturesEnabled;b.object.posesEnabled=this.posesEnabled;b.object.mode=this.mode;b.object.useArm=this.useArm;return b};
function KinectDevice(){THREE.Object3D.call(this);this.type="Kinect";this.name="kinect";this.socket=new WebSocket("ws://127.0.0.1:8181");this.connected=!1;this.debugModel=!0;this.dataTimeout=0;this.data=this.camera=null;this.dataReceived=!1;var b=this;this.socket.onopen=function(){b.connected=!0};this.socket.onclose=function(){b.connected=!1};this.socket.onmessage=function(h){"string"===typeof h.data?(b.data=JSON.parse(h.data),b.dataReceived=!0,b.dataTimeout=KinectDevice.DATA_TIMEOUT):h.data instanceof
Blob&&(b.camera=h.data)};this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new KinectComponent)}KinectDevice.DATA_TIMEOUT=20;KinectDevice.DEPTH=0;KinectDevice.COLOR=1;
KinectDevice.JOINTS_NAME=[["head","shouldercenter"],["shouldercenter","shoulderright"],["shouldercenter","shoulderleft"],["shoulderright","elbowright"],["shoulderleft","elbowleft"],["elbowright","wristright"],["elbowleft","wristleft"],["wristright","handright"],["wristleft","handleft"],["shouldercenter","spine"],["spine","hipcenter"],["hipcenter","hipright"],["hipcenter","hipleft"],["hipright","kneeright"],["hipleft","kneeleft"],["kneeright","ankleright"],["kneeleft","ankleleft"],["ankleright","footright"],
["ankleleft","footleft"]];KinectDevice.prototype=Object.create(THREE.Object3D.prototype);
KinectDevice.prototype.update=function(){if(null!==this.data)if(this.dataReceived){for(this.dataReceived=!1;0<this.children.length;)this.children.pop();if(this.debugModel)for(var b=new THREE.SphereGeometry(.04,6,6),h=new THREE.MeshPhongMaterial(16711680),k=0;k<this.data.skeletons.length;k++)for(var e=this.data.skeletons[k].joints,p=0;p<e.length;p++){var q=new Mesh(b,h);q.position.set(e[p].x,e[p].y,e[p].z);q.castShadow=!0;this.add(q)}}else if(0<this.dataTimeout&&(this.dataTimeout--,0===this.dataTimeout))for(;0<
this.children.length;)this.children.pop();for(p=0;p<this.children.length;p++)this.children[p].update()};KinectDevice.prototype.isConnected=function(){return this.connected};KinectDevice.prototype.setCameraMode=function(b){b===KinectDevice.COLOR?socket.send("Color"):b===KinectDevice.DEPTH&&socket.send("Depth")};KinectDevice.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.debugModel=this.debugModel;return b};
function Mesh(b,h){THREE.Mesh.call(this,b,h);this.name="model";this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Mesh.prototype=Object.create(THREE.Mesh.prototype);Mesh.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
function SkinnedMesh(b,h,k){THREE.SkinnedMesh.call(this,b,h,k);this.name="model";this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}SkinnedMesh.prototype=Object.create(THREE.SkinnedMesh.prototype);SkinnedMesh.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose();this.geometry.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
function Text3D(b,h,k,e,p,q,l,t,r){THREE.Mesh.call(this,void 0,h);this.name="text";this.type="Text3D";this.font=k;this.text=void 0!==b?b:"text";this.size=void 0!==t?t:1;this.height=void 0!==e?e:.5;this.curveSegments=void 0!==r?r:15;this.bevel=void 0!=p?p:!1;this.bevelThickness=void 0!==q?q:.1;this.bevelSize=void 0!==l?l:.05;this.setText(this.text);this.castShadow=this.receiveShadow=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);
this.defaultComponents.push(new Text3DComponent)}Text3D.prototype=Object.create(THREE.Mesh.prototype);Text3D.prototype.setFont=function(b){this.font=b;this.setText()};Text3D.prototype.setText=function(b){void 0!==b&&(this.text=b);void 0!==this.geometry&&this.geometry.dispose();this.updateText()};
Text3D.prototype.updateText=function(){null!==this.font&&(this.geometry=new THREE.TextGeometry(this.text,{size:this.size,curveSegments:this.curveSegments,font:this.font,height:this.height,bevelEnabled:this.bevel,bevelSize:this.bevelSize,bevelThickness:this.bevelThickness}))};Text3D.prototype.clone=function(){return new Text3D(this.text,this.material,this.font,this.height,this.bevel,this.bevelThickness,this.bevelSize,this.size,this.curveSegments)};
Text3D.prototype.dispose=function(){void 0!==this.material.dispose&&this.material.dispose();void 0!==this.geometry&&this.geometry.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
Text3D.prototype.toJSON=function(b){var h=this.geometry;this.geometry=void 0;var k=this.font;b=THREE.Object3D.prototype.toJSON.call(this,b,(e,p)=>{k=k.toJSON(e)});b.object.text=this.text;b.object.font=k.uuid;b.object.size=this.size;b.object.curveSegments=this.curveSegments;b.object.height=this.height;b.object.bevel=this.bevel;b.object.bevelThickness=this.bevelThickness;b.object.bevelSize=this.bevelSize;this.geometry=h;return b};
function Sprite(b){THREE.Sprite.call(this,b);this.name="sprite";this.type="Sprite";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Sprite.prototype=Object.create(THREE.Sprite.prototype);Sprite.prototype.dispose=function(){null!==this.material&&void 0!==this.material.dispose&&this.material.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
function PointLight(b,h,k,e){THREE.PointLight.call(this,b,h,k,e);this.name="point";this.castShadow=!0;this.shadow.camera.near=.05;this.shadow.camera.far=5E3;this.shadow.bias=.01;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}PointLight.prototype=Object.create(THREE.PointLight.prototype);
PointLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};
function SpotLight(b,h,k,e,p,q){THREE.SpotLight.call(this,b,h,k,e,p,q);this.name="spot light";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=5E3;this.shadow.mapSize.width=512;this.shadow.mapSize.height=512;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}SpotLight.prototype=Object.create(THREE.SpotLight.prototype);
SpotLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function AmbientLight(b){THREE.AmbientLight.call(this,b);this.name="ambient";this.matrixAutoUpdate=!1;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}AmbientLight.prototype=Object.create(THREE.AmbientLight.prototype);
function DirectionalLight(b,h){THREE.DirectionalLight.call(this,b,h);this.name="directional";this.castShadow=!0;this.shadow.camera.near=.5;this.shadow.camera.far=1E4;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}DirectionalLight.prototype=Object.create(THREE.DirectionalLight.prototype);
DirectionalLight.prototype.updateShadowMap=function(){this.shadow.map.dispose();this.shadow.map=null;this.shadow.camera.updateProjectionMatrix()};function HemisphereLight(b,h,k){THREE.HemisphereLight.call(this,b,h,k);this.name="hemisphere";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}HemisphereLight.prototype=Object.create(THREE.HemisphereLight.prototype);
function RectAreaLight(b,h,k,e){THREE.RectAreaLight.call(this,b,h,k,e);this.name="rectarea";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new LightComponent)}RectAreaLight.prototype=Object.create(THREE.RectAreaLight.prototype);RectAreaLight.prototype.toJSON=function(b){b=THREE.Light.prototype.toJSON.call(this,b);b.object.width=this.width;b.object.height=this.height;return b};
function Sky(b,h,k,e){THREE.Object3D.call(this);this.name="sky";this.type="Sky";this.clock=new THREE.Clock;this.colorTop=[new THREE.Color(7844859),new THREE.Color(30463),new THREE.Color(220086),new THREE.Color(9273)];this.colorBottom=[new THREE.Color(15461606),new THREE.Color(16777215),new THREE.Color(16705495),new THREE.Color(26023)];this.sunColor=16777130;this.moonColor=5592507;this.hemisphere=new THREE.HemisphereLight(0,0,.6);this.hemisphere.color.setHSL(.6,1,.6);this.hemisphere.groundColor.setHSL(.1,
1,.75);this.hemisphere.hidden=!0;this.hemisphere.rotationAutoUpdate=!1;this.hemisphere.matrixAutoUpdate=!1;this.add(this.hemisphere);this.sun=new THREE.DirectionalLight(this.sunColor,.5);this.sun.castShadow=!0;this.sun.hidden=!0;this.add(this.sun);var p={topColor:{type:"c",value:new THREE.Color(0,.46,1)},bottomColor:{type:"c",value:new THREE.Color(1,1,1)},offset:{type:"f",value:20},exponent:{type:"f",value:.4}};p.topColor.value.copy(this.hemisphere.color);var q=new THREE.SphereBufferGeometry(1E3,
16,16);p=new THREE.ShaderMaterial({vertexShader:"varying vec3 vWorldPosition; \tvoid main() \t{ \t\tvec4 worldPosition = modelMatrix * vec4(position, 1.0); \t\tvWorldPosition = worldPosition.xyz; \t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); \t}",fragmentShader:"uniform vec3 topColor; \tuniform vec3 bottomColor; \tuniform float offset; \tuniform float exponent; \tvarying vec3 vWorldPosition; \tvoid main() \t{ \t\tfloat h = normalize(vWorldPosition + offset).y; \t\tgl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h , 0.0), exponent), 0.0)), 1.0); \t}",
uniforms:p,side:THREE.BackSide});this.sky=new THREE.Mesh(q,p);this.sky.hidden=!0;this.sky.rotationAutoUpdate=!1;this.sky.matrixAutoUpdate=!1;this.add(this.sky);this.sky.raycast=function(){return null};this.autoUpdate=void 0!==b?b:!0;this.sunDistance=void 0!==k?k:100;this.dayTime=void 0!==h?h:120;this.time=void 0!==e?e:75;this.updateSky();this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new SkyComponent)}
Sky.prototype=Object.create(THREE.Object3D.prototype);Sky.prototype.initialize=function(){this.updateSky();for(var b=0;b<this.children.length;b++)this.children[b].initialize()};Sky.prototype.update=function(){this.autoUpdate&&(this.time+=this.clock.getDelta(),this.time>this.dayTime&&(this.time-=this.dayTime),this.updateSky());for(var b=0;b<this.children.length;b++)this.children[b].update()};
Sky.prototype.updateSky=function(){var b=this.time/this.dayTime;if(.25>b)this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r,this.colorTop[3].g,this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r,this.colorBottom[3].g,this.colorBottom[3].b);else if(.292>b){var h=23.81*(b-.25),k=1-h;this.sky.material.uniforms.topColor.value.setRGB(k*this.colorTop[3].r+h*this.colorTop[0].r,k*this.colorTop[3].g+h*this.colorTop[0].g,k*this.colorTop[3].b+h*this.colorTop[0].b);
this.sky.material.uniforms.bottomColor.value.setRGB(k*this.colorBottom[3].r+h*this.colorBottom[0].r,k*this.colorBottom[3].g+h*this.colorBottom[0].g,k*this.colorBottom[3].b+h*this.colorBottom[0].b)}else.4167>b?(this.sky.material.uniforms.topColor.value.setRGB(this.colorCop[0].r,this.colorCop[0].g,this.colorCop[0].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[0].r,this.colorBottom[0].g,this.colorBottom[0].b)):.5>b?(h=12*(b-.4167),k=1-h,this.sky.material.uniforms.topColor.value.setRGB(k*
this.colorTop[0].r+h*this.colorTop[1].r,k*this.colorTop[0].g+h*this.colorTop[1].g,k*this.colorTop[0].b+h*this.colorTop[1].b),this.sky.material.uniforms.bottomColor.value.setRGB(k*this.colorBottom[0].r+h*this.colorBottom[1].r,k*this.colorBottom[0].g+h*this.colorBottom[1].g,k*this.colorBottom[0].b+h*this.colorBottom[1].b)):.708>b?(this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[1].r,this.colorTop[1].g,this.colorTop[1].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[1].r,
this.colorBottom[1].g,this.colorBottom[1].b)):.75>b?(h=23.81*(b-.708),k=1-h,this.sky.material.uniforms.topColor.value.setRGB(k*this.colorTop[1].r+h*this.colorTop[2].r,k*this.colorTop[1].g+h*this.colorTop[2].g,k*this.colorTop[1].b+h*this.colorTop[2].b),this.sky.material.uniforms.bottomColor.value.setRGB(k*this.colorBottom[1].r+h*this.colorBottom[2].r,k*this.colorBottom[1].g+h*this.colorBottom[2].g,k*this.colorBottom[1].b+h*this.colorBottom[2].b)):.8333>b?(h=12.048*(b-.75),k=1-h,this.sky.material.uniforms.topColor.value.setRGB(k*
this.colorTop[2].r+h*this.colorTop[3].r,k*this.colorTop[2].g+h*this.colorTop[3].g,k*this.colorTop[2].b+h*this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(k*this.colorBottom[2].r+h*this.colorBottom[3].r,k*this.colorBottom[2].g+h*this.colorBottom[3].g,k*this.colorBottom[2].b+h*this.colorBottom[3].b)):(this.sky.material.uniforms.topColor.value.setRGB(this.colorTop[3].r,this.colorTop[3].g,this.colorTop[3].b),this.sky.material.uniforms.bottomColor.value.setRGB(this.colorBottom[3].r,
this.colorBottom[3].g,this.colorBottom[3].b));.2>b?this.sun.color.setHex(this.moonColor):.3>b?(h=10*(b-.2),.5>h?(this.sun.intensity=.3*(2-2*h),this.sun.color.setHex(this.moonColor)):(this.sun.intensity=.6*h,this.sun.color.setHex(Sky.sunColor))):.7>b?this.sun.color.setHex(Sky.sunColor):.8>b?(h=10*(b-.7),.5>h?(this.sun.intensity=.3*(2-2*h),this.sun.color.setHex(Sky.sunColor)):(this.sun.intensity=.6*h,this.sun.color.setHex(this.moonColor))):this.sun.color.setHex(this.moonColor);h=MathUtils.pi2*b-MathUtils.pid2;
.25<b&&.75>b?(this.sun.position.x=this.sunDistance*Math.cos(h),this.sun.position.y=this.sunDistance*Math.sin(h)):(this.sun.position.x=this.sunDistance*Math.cos(h+Math.PI),this.sun.position.y=this.sunDistance*Math.sin(h+Math.PI))};Sky.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.autoUpdate=this.autoUpdate;b.object.sunDistance=this.sunDistance;b.object.dayTime=this.dayTime;b.object.time=this.time;b.object.sun={};b.object.sun.shadow=this.sun.shadow.toJSON();return b};
function PerspectiveCamera(b,h,k,e){THREE.PerspectiveCamera.call(this,b,h,k,e);this.name="camera";this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clearDepth=this.clearColor=!1;this.order=0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new CameraComponent)}PerspectiveCamera.prototype=Object.create(THREE.PerspectiveCamera.prototype);
PerspectiveCamera.prototype.destroy=function(){var b=ObjectUtils.getScene(this);null!==b&&b.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};PerspectiveCamera.prototype.updateMatrixWorld=function(b){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===b)null!==this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld=this.matrix,this.matrixWorldNeedsUpdate=!1,b=!0;for(var h=this.children,k=0;k<this.children.length;k++)h[k].updateMatrixWorld(b)};
PerspectiveCamera.prototype.updateProjectionMatrix=function(){var b=this.near*Math.tan(.5*THREE.Math.DEG2RAD*this.fov)/this.zoom,h=2*b,k=this.aspect*h*(void 0!==this.viewport?this.viewport.x/this.viewport.y:1),e=-.5*k;0!==this.filmOffset&&(e+=this.near*this.filmOffset/this.getFilmWidth());this.projectionMatrix.makePerspective(e,e+k,b,b-h,this.near,this.far)};
PerspectiveCamera.prototype.toJSON=function(b){b=THREE.PerspectiveCamera.prototype.toJSON.call(this,b);b.object.clearColor=this.clearColor;b.object.clearDepth=this.clearDepth;b.object.viewport=this.viewport.toArray();b.object.offset=this.offset.toArray();b.object.order=this.order;return b};
function OrthographicCamera(b,h,k,e,p){THREE.OrthographicCamera.call(this,-1,1,1,-1,e,p);this.name="camera";this.size=void 0!==b?b:1;this.aspect=void 0!==h?h:1;this.mode=void 0!==k?k:OrthographicCamera.RESIZE_HORIZONTAL;this.offset=new THREE.Vector2(0,0);this.viewport=new THREE.Vector2(1,1);this.clearDepth=this.clearColor=!1;this.order=0;this.updateProjectionMatrix();this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);
this.defaultComponents.push(new CameraComponent)}OrthographicCamera.prototype=Object.create(THREE.OrthographicCamera.prototype);OrthographicCamera.RESIZE_HORIZONTAL=0;OrthographicCamera.RESIZE_VERTICAL=1;OrthographicCamera.prototype.destroy=function(){var b=ObjectUtils.getScene(this);null!==b&&b.removeCamera(this);THREE.Object3D.prototype.destroy.call(this)};
OrthographicCamera.prototype.updateProjectionMatrix=function(){this.mode===OrthographicCamera.RESIZE_HORIZONTAL?(this.top=this.size/2,this.bottom=-this.top,this.right=this.viewport.x/this.viewport.y*this.aspect*this.top,this.left=-this.right):this.mode===OrthographicCamera.RESIZE_VERTICAL&&(this.right=this.size/2,this.left=-this.right,this.top=this.right/this.aspect*(this.viewport.x/this.viewport.y),this.bottom=-this.top);THREE.OrthographicCamera.prototype.updateProjectionMatrix.call(this)};
OrthographicCamera.prototype.toJSON=function(b){b=THREE.OrthographicCamera.prototype.toJSON.call(this,b);b.object.size=this.size;b.object.aspect=this.aspect;b.object.mode=this.mode;b.object.clearColor=this.clearColor;b.object.clearDepth=this.clearDepth;b.object.viewport=this.viewport.toArray();b.object.offset=this.offset.toArray();b.object.order=this.order;return b};
function AudioEmitter(b){THREE.Audio.call(this,AudioEmitter.listener);this.name="audio";this.type="Audio";this.matrixAutoUpdate=!1;this.audio=void 0!==b?b:Editor.defaultAudio;this.volume=1;this.autoplay=!0;this.playbackRate=1;this.startTime=0;this.loop=!0;this.isPlaying=!1;this.hasPlaybackControl=!0;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new AudioComponent)}AudioEmitter.listener=new THREE.AudioListener;
AudioEmitter.prototype=Object.create(THREE.Audio.prototype);AudioEmitter.prototype.initialize=function(){var b=this;null!==this.audio&&THREE.AudioContext.getContext().decodeAudioData(this.audio.data,k=>{b.setBuffer(k)});this.setVolume(this.volume);this.setPlaybackRate(this.playbackRate);for(var h=0;h<this.children.length;h++)this.children[h].initialize()};AudioEmitter.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect());for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
AudioEmitter.prototype.setVolume=function(b){this.volume=b;this.gain.gain.value=b;return this};AudioEmitter.prototype.toJSON=function(b){var h=this.audio;b=THREE.Object3D.prototype.toJSON.call(this,b,(k,e)=>{h=h.toJSON(k)});b.object.audio=h.uuid;b.object.volume=this.volume;b.object.autoplay=this.autoplay;b.object.startTime=this.startTime;b.object.playbackRate=this.playbackRate;b.object.loop=this.loop;return b};
function PositionalAudio(b){THREE.PositionalAudio.call(this,AudioEmitter.listener);this.name="audio";this.type="PositionalAudio";this.audio=void 0!==b?b:null;this.volume=1;this.autoplay=!0;this.playbackRate=1;this.startTime=0;this.loop=!0;this.isPlaying=!1;this.hasPlaybackControl=!0;this.cameras=null;this.tempA=new THREE.Vector3;this.tempB=new THREE.Vector3;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new AudioComponent)}
PositionalAudio.prototype=Object.create(THREE.Audio.prototype);PositionalAudio.prototype.initialize=function(){var b=this;null!==this.audio&&(THREE,AudioContext.getContext().decodeAudioData(this.audio.data,k=>{b.setBuffer(k)}));this.setVolume(this.volume);this.setPlaybackRate(this.playbackRate);for(var h=this;null!==h.parent;)h=h.parent,h instanceof Scene&&(this.cameras=h.cameras);for(h=0;h<this.children.length;h++)this.children[h].initialize()};
PositionalAudio.prototype.update=function(){this.tempA.setFromMatrixPosition(this.matrixWorld);0<this.cameras.length&&(this.tempB.setFromMatrixPosition(this.cameras[0].matrixWorld),this.tempA.sub(this.tempB));this.panner.setPosition(this.tempA.x,this.tempA.y,this.tempA.z);for(var b=0;b<this.children.length;b++)this.children[b].update()};PositionalAudio.prototype.dispose=function(){this.isPlaying&&(this.stop(),this.disconnect());for(var b=0;b<this.children.length;b++)this.children[b].dispose()};
PositionalAudio.prototype.setVolume=function(b){this.volume=b;this.gain.gain.value=b;return this};PositionalAudio.prototype.toJSON=function(b){var h=this.audio;b=THREE.Object3D.prototype.toJSON.call(this,b,(k,e)=>{h=h.toJSON(k)});b.object.audio=h.uuid;b.object.volume=this.volume;b.object.autoplay=this.autoplay;b.object.startTime=this.startTime;b.object.playbackRate=this.playbackRate;b.object.loop=this.loop;return b};
function Script(b){THREE.Object3D.call(this);this.type="Script";this.name="script";this.path="/";this.func=this.scene=this.program=null;this.code=void 0!==b?b:Script.default;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ScriptComponent)}Script.prototype=Object.create(THREE.Object3D.prototype);Script.default="// This block of code is executed one\nthis.initialize = function() {\n\n}\n\n// This block of code is executed once per frame\nthis.update = function() {\n\n}\n\n// When mouse is over children\nthis.onMouseOver = function(object) {\n\n}\n\n// When the window is resized\nthis.onResize = function() {\n\n}\n\n// When the game is closed\nthis.onExit = function() {\n\n}\n";
Script.prototype.initialize=function(){for(var b=this;null!==b.parent;)b=b.parent,b instanceof Scene?this.scene=b:b instanceof Program&&(this.program=b);this.setCode(this.code);for(b=0;b<this.children.length;b++)this.children[b].initialize();void 0!==this.script.initialize&&this.script.initialize.call(this)};
Script.prototype.update=function(){if(void 0!==this.script.onMouseOver){var b=this.scene.raycaster.intersectObjects(this.children,!0);0<b.length&&this.script.onMouseOver.call(this,b)}void 0!==this.script.update&&this.script.update.call(this);for(b=0;b<this.children.length;b++)this.children[b].update()};Script.prototype.resize=function(){void 0!==this.script.onResize&&this.script.onResize.call(this)};Script.prototype.appData=function(b){void 0!==this.script.onAppData&&this.script.onAppData.call(this)};
Script.prototype.setCode=function(b){if(void 0!==b)try{var h=new Function("Keyboard, Mouse, self, program, scene",this.code);null!==this.program&&(this.script=new h(this.program.keyboard,this.program.mouse,this,this.program,this.scene))}catch(k){console.error("Script: Error compiling script",k),this.script=new function(){}}};Script.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.code=this.code;b.object.path=this.path;return b};
function BlockScript(b,h,k){THREE.Object3D.call(this);this.type="BlockScript";this.name="blocks";this.objUuid=void 0!==h?h:this.uuid;this.blocksType=void 0!==k?k:"scene";this.path="/";this.nodes={config:{blocks:"Blocks",type:this.blocksType,uuid:this.objUuid},extra:{},groups:{},last_link_id:0,last_node_id:0,links:[],nodes:[{flags:{},id:1,mode:0,order:0,outputs:[Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.passer),{name:"",type:-1,links:null}],pos:[100,100],properties:{},
size:[120,46],type:"Events/BeginPlay"},{flags:{},id:2,inputs:[],mode:0,order:1,outputs:[Object.assign({},{name:"",type:-1,links:null},NodesHelper.slots.output.passer)],pos:[100,200],properties:{},size:[120,46],type:"Events/EventTick"}],version:.4};void 0!==b&&(this.nodes=b);this.graph=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent)}BlockScript.prototype=Object.create(THREE.Object3D.prototype);
BlockScript.prototype.initialize=function(){var b=this;this.graph=new LGraph(this.nodes);if("scene"===this.graph.config.type)this.graph.config.scene=ObjectUtils.getScene(this),this.graph.config.self=this;else if("class"===this.graph.config.type){var h=void 0!==Editor.programRunning&&null!==Editor.programRunning?Editor.programRunning.scene:Main.program.scene;this.graph.config.scene=h;h.traverse(k=>{void 0!==k.objUuid&&k.objUuid===b.uuid&&(b.graph.config.self=k)})}void 0!==this.graph.config.scene&&
this.graph.config.scene.parent instanceof Program&&(this.graph.config.program=this.graph.config.scene.parent);this.graph.runStep(1);this.graph.start();for(h=0;h<this.children.length;h++)this.children[h].initialize()};BlockScript.prototype.dispose=function(){null!==this.graph&&(this.graph.sendEventToAllNodes("onDispose"),this.graph.stop(),this.nodes.extra={});for(var b=0;b<this.children.length;b++)this.children[b].dispose()};BlockScript.prototype.setPath=function(b){void 0!==b&&(this.path=b)};
BlockScript.prototype.updateNodes=function(b){this.nodes=b};BlockScript.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);delete this.nodes.config.self;delete this.nodes.config.scene;b.object.nodes=this.nodes;b.object.path=this.path;return b};
function PhysicsObject(){THREE.Object3D.call(this);this.name="physics";this.type="Physics";this.body=new CANNON.Body;this.body.type=CANNON.Body.DYNAMIC;this.body.mass=1;this.world=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent);this.defaultComponents.push(new PhysicsComponent)}PhysicsObject.prototype=Object.create(THREE.Object3D.prototype);
PhysicsObject.prototype.initialize=function(){this.body.position.copy(this.position);this.body.quaternion.copy(this.quaternion);for(var b=this;null!==b.parent;)b=b.parent,b instanceof Scene&&(this.world=b.world,this.world.addBody(this.body));for(b=0;b<this.children.length;b++)this.children[b].initialize()};PhysicsObject.prototype.update=function(){this.position.copy(this.body.position);this.body.fixedRotation||this.quaternion.copy(this.body.quaternion);for(var b=0;b<this.children.length;b++)this.children[b].update()};
PhysicsObject.prototype.addShape=function(b){b instanceof CANNON.Shape&&this.body.addShape(b)};
PhysicsObject.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.body={};b.object.body.type=this.body.type;b.object.body.mass=this.body.mass;b.object.body.linearDamping=this.body.linearDamping;b.object.body.angularDamping=this.body.angularDamping;b.object.body.allowSleep=this.body.allowSleep;b.object.body.sleepSpeedLimit=this.body.sleepSpeedLimit;b.object.body.sleepTimeLimit=this.body.sleepTimeLimit;b.object.body.collisionFilterGroup=this.body.collisionFilterGroup;
b.object.body.collisionFilterMask=this.body.collisionFilterMask;b.object.body.fixedRotation=this.body.fixedRotation;b.object.body.shapes=[];for(var h=this.body.shapes,k=0;k<h.length;k++){var e=h[k],p={};p.type=e.type;e.type===CANNON.Shape.types.SPHERE?p.radius=e.radius:e.type===CANNON.Shape.types.BOX?(p.halfExtents={},p.halfExtents.x=e.halfExtents.x,p.halfExtents.y=e.halfExtents.y,p.halfExtents.z=e.halfExtents.z):e.type===CANNON.Shape.types.CONVEXPOLYHEDRON&&(p.vertices=e.vertices,p.faces=e.faces);
b.object.body.shapes[k]=p}return b};
function SpineAnimation(b,h,k,e){if(void 0!==e)var p=new spine.TextureAtlas(h,q=>{for(var l=0;l<e.length;l++)if(e[l].name===q)return q=new SpineTexture(e[l].texture),l=q.texture.image,l.width=1024,l.height=1024,q});else e=[],p=new spine.TextureAtlas(h,q=>{var l=new SpineTexture(new Texture(new GORLOT.Image(k+"/"+q))),t=new l.texture.image;t.width=1024;t.height=1024;e.push({name:q,texture:l.texture});return l});p=new spine.AtlasAttachementLoader(p);p=(new spine.SkeletonJson(p)).readSkeletonData(b);THREE.Mesh.call(this);
this.zOffset=.1;this.skeleton=new spine.Skeleton(p);p=new spine.AnimationStateData(p);this.state=new spine.AnimationState(p);this.batcher=new spine.threejs.MeshBatcher(this);p=new THREE.MeshBasicMaterial;p.side=THREE.DoubleSide;p.transparent=!0;p.name="spine";p.alphaTest=.5;this.material=p;this.json=b;this.atlas=h;this.textures=e;this.name="spine";this.type="SpineAnimation";this.scale.set(.01,.01,.01);this.frustumCulled=!1;this.castShadow=this.receiveShadow=!0;this.clock=new THREE.Clock;this.components=
[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}SpineAnimation.prototype=Object.create(THREE.Mesh.prototype);SpineAnimation.QUAD_TRIANGLES=[0,1,2,2,3,0];SpineAnimation.prototype.update=function(){var b=this.state,h=this.skeleton;b.update(this.clock.getDelta());b.apply(h);h.updateWorldTransform();this.updateGeometry();for(b=0;b<this.children.length;b++)this.children[b].update()};SpineAnimation.prototype.getAnimations=function(){return this.state.data.skeletonData.animations};
SpineAnimation.prototype.setAnimation=function(b,h){try{this.state.setAnimation(b,h,!0)}catch(k){}};SpineAnimation.prototype.getSkins=function(){return this.state.data.skeletonData.skins};
SpineAnimation.prototype.updateGeometry=function(){var b=this.skeleton.drawOrder,h=0,k=this.batcher;k.begin();for(var e=0,p=b.length;e<p;e++){var q=b[e];var l=q.getAttachment();if(l instanceof spine.RegionAttachment){var t=l;q=t.updateWorldVertices(q,!1);l=SpineAnimation.QUAD_TRIANGLES;t=t.region.renderObject.texture}else if(l instanceof spine.MeshAttachment)t=l,q=t.updateWorldVertices(q,!1),l=t.triangles,t=t.region.renderObject.texture;else continue;if(null!==t){if(!this.material.map){var r=this.material;
r.map=t.texture;r.needsUpdate=!0}k.batch(q,l,h);h+=this.zOffset}}k.end()};SpineAnimation.prototype.toJSON=function(b){var h=this.geometry,k=this.material;this.material=this.geometry=void 0;var e=[],p=this;b=THREE.Object3D.prototype.toJSON.call(this,b,(q,l)=>{for(l=0;l<p.textures.length;l++){var t=p.textures[l].texture.toJSON(q);e.push({name:p.textures[l].name,texture:t.uuid})}});b.object.json=this.json;b.object.atlas=this.atlas;b.object.textures=e;this.geometry=h;this.material=k;return b};
function SpineTexture(b){spine.Texture.call(this,b.image);this.texture=b;this.texture.flipY=!1}SpineTexture.prototype=Object.create(spine.Texture.prototype);SpineTexture.prototype.setFilters=function(b,h){this.texture.minFilter=SpineTexture.getTextureFilter(b);this.texture.magFilter=SpineTexture.getTextureFilter(h)};SpineTexture.prototype.setWraps=function(b,h){this.texture.wrapS=SpineTexture.getTextureWrap(b);this.texture.wrapT=SpineTexture.getTextureWrap(h)};SpineTexture.prototype.dispose=function(){this.texture.dispose()};
SpineTexture.getTextureFilter=function(b){return b===spine.TextureFilter.Linear?THREE.LinearFilter:b===spine.TextureFilter.MipMap||b===spine.TextureFilter.MipMapLinearLinear?THREE.LinearMipMapLinearFilter:b===spine.TextureFilter.MipMapLinearNearest?THREE.LinearMipMapNearestFilter:b===spine.TextureFilter.MipMapNearestNearest?THREE.NearestMipMapNearestFilter:b===spine.TextureFilter.Nearest?THREE.NearestFilter:null};
SpineTexture.getTextureWrap=function(b){if(b===spine.TextureWrap.ClampToEdge)return THREE.ClampToEdgeWrapping;if(b===spine.TextureWrap.MirroredRepeat)return THREE.MirroredRepeatWrapping;if(b===spine.TextureWrap.Repeat)return THREE.RepeatWrapping};function Bone(){THREE.Bone.call(this);this.name="bone";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Bone.prototype=Object.create(THREE.Bone.prototype);
function Empty(){THREE.Object3D.call(this);this.name="empty";this.type="Group";this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}Empty.prototype=Object.create(THREE.Object3D.prototype);
function ParticleEmitter(b,h){this.nodes={};this.clock=new THREE.Clock;this.group=void 0!==b?new SPE.Group(b):new SPE.Group({texture:{value:new Texture(new GORLOT.Image("Source/Runtime/Data/particle.png"))},maxParticleCount:2E3,blending:THREE.AdditiveBlending,fog:!1,depthWrite:!1,depthTest:!0,transparent:!1,hasPerspective:!0});THREE.Points.call(this,this.group.geometry,this.group.material);this.type="ParticleEmitter";this.name="particles";this.frustumCulled=!1;b=this.group;Object.defineProperties(this,
{texture:{get:()=>b.texture,set:()=>{b.texture=texture}}});this.emitter=void 0!==h?new SPE.Emitter(h):new SPE.Emitter({particleCount:2E3,type:SPE.distributions.BOX,maxAge:{value:3,spread:0},velocity:{value:new THREE.Vector3(0,25,0),spread:new THREE.Vector3(10,10,10)},acceleration:{value:new THREE.Vector3(0,-10,0),spread:new THREE.Vector3(10,0,10)},color:{value:[new THREE.Color(1,1,1)],spread:[new THREE.Vector3(0,0,0)]}});this.group.addEmitter(this.emitter);this.components=[];this.defaultComponents=
[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}ParticleEmitter.prototype=Object.create(THREE.Points.prototype);ParticleEmitter.prototype.initialize=function(){for(var b=0;b<this.children.length;b++)this.children[b].initialize();this.clock.start()};ParticleEmitter.prototype.update=function(){this.group.tick(this.clock.getDelta());for(var b=0;b<this.children.length;b++)this.children[b].update()};
ParticleEmitter.prototype.updateNodes=function(b){this.nodes=b};ParticleEmitter.prototype.dispose=function(){this.group.texture.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()};ParticleEmitter.prototype.updateMatrix=function(){this.matrix.makeRotationFromQuaternion(this.quaternion);this.matrix.scale(this.scale);this.matrix.setPosition(this.position);this.matrixWorldNeedsUpdate=!0};
ParticleEmitter.prototype.toJSON=function(b){var h=this.material,k=this.geometry;this.geometry=this.material=void 0;var e=this.group.texture;b=THREE.Object3D.prototype.toJSON.call(this,b,function(p,q){e=e.toJSON(p)});this.material=h;this.geometry=k;b.object.group={};b.object.group.texture={};b.object.group.texture.value=e.uuid;b.object.group.textureFrames=this.group.textureFrames;b.object.group.textureFrameCount=this.group.textureFrameCount;b.object.group.textureLoop=this.group.textureLoop;b.object.group.hasPerspective=
this.group.hasPerspective;b.object.group.colorize=this.group.colorize;b.object.group.maxParticleCount=this.group.maxParticleCount;b.object.group.blending=this.group.blending;b.object.group.scale=this.group.scale;b.object.group.depthWrite=this.group.depthWrite;b.object.group.depthTest=this.group.depthTest;b.object.group.fog=this.group.fog;b.object.emitter={};b.object.emitter.uuid=this.emitter.uuid;b.object.emitter.direction=this.emitter.direction;b.object.emitter.particleCount=this.emitter.particleCount;
b.object.emitter.duration=this.emitter.duration;b.object.emitter.type=this.emitter.type;b.object.emitter.maxAge={};b.object.emitter.maxAge.value=this.emitter.maxAge.value;b.object.emitter.maxAge.spread=this.emitter.maxAge.spread;b.object.emitter.position={};b.object.emitter.position.value=this.emitter.position.value;b.object.emitter.position.spread=this.emitter.position.spread;b.object.emitter.velocity={};b.object.emitter.velocity.value=this.emitter.velocity.value;b.object.emitter.velocity.spread=
this.emitter.velocity.spread;b.object.emitter.acceleration={};b.object.emitter.acceleration.value=this.emitter.acceleration.value;b.object.emitter.acceleration.spread=this.emitter.acceleration.spread;b.object.emitter.wiggle={};b.object.emitter.wiggle.value=this.emitter.wiggle.value;b.object.emitter.wiggle.spread=this.emitter.wiggle.spread;b.object.emitter.opacity={};b.object.emitter.opacity.value=this.emitter.opacity.value;b.object.emitter.opacity.spread=this.emitter.opacity.spread;b.object.emitter.size=
{};b.object.emitter.size.value=this.emitter.size.value;b.object.emitter.size.spread=this.emitter.size.spread;b.object.emitter.angle={};b.object.emitter.angle.value=this.emitter.angle.value;b.object.emitter.angle.spread=this.emitter.angle.spread;b.object.emitter.color={};b.object.emitter.color.value=this.emitter.color.value;b.object.emitter.color.spread=this.emitter.color.spread;b.object.nodes=this.nodes;return b};
function Program(b){THREE.Object3D.call(this);ResourceManager.call(this);this.type="Program";this.matrixAutoUpdate=!1;this.app=null;this.name=void 0!==b?b:"program";this.author=this.description="";this.version="0";this.vr=this.lockPointer=!1;this.vrScale=1;this.antialiasing=!1;this.shadows=!0;this.shadowsType=THREE.PCFSoftShadowMap;this.scene=this.canvas=this.renderer=this.keyboard=this.defaultCamera=this.defaultScene=null;this.useVr=!1;this.vrControls=this.vrEffect=null;this.components=[];this.defaultComponents=
[];this.defaultComponents.push(new ProgramComponent)}Program.prototype=Object.create(THREE.Object3D.prototype);Program.prototype.getMaterialByName=ResourceManager.prototype.getMaterialByName;Program.prototype.addMaterial=ResourceManager.prototype.addMaterial;Program.prototype.removeMaterial=ResourceManager.prototype.removeMaterial;Program.prototype.getTextureByName=ResourceManager.prototype.getTextureByName;Program.prototype.addTexture=ResourceManager.prototype.addTexture;
Program.prototype.removeTexture=ResourceManager.prototype.removeTexture;Program.prototype.getFontByName=ResourceManager.prototype.getFontByName;Program.prototype.addFont=ResourceManager.prototype.addFont;Program.prototype.removeFont=ResourceManager.prototype.removeFont;Program.prototype.getAudioByName=ResourceManager.prototype.getAudioByName;Program.prototype.addAudio=ResourceManager.prototype.addAudio;Program.prototype.removeAudio=ResourceManager.prototype.removeAudio;
Program.prototype.addObject=ResourceManager.prototype.addObject;Program.prototype.getAssetObjectByName=ResourceManager.prototype.getAssetObjectByName;Program.prototype.removeObject=ResourceManager.prototype.removeObject;Program.prototype.addFolder=ResourceManager.prototype.addFolder;Program.prototype.removeFolder=ResourceManager.prototype.removeFolder;
Program.prototype.initialize=function(){null===this.mouse&&(this.mouse=new Mouse);null===this.keyboard&&(this.keyboard=new Keyboard);if(null!==this.defaultScene)for(var b=0;b<this.children.length;b++){if(this.children[b].uuid===this.defaultScene){this.setScene(this.children[b]);break}}else 0<this.children.length&&this.setScene(this.children[0])};Program.prototype.setMouseKeyboard=function(b,h){this.mouse=b;this.keyboard=h};Program.prototype.setRenderer=function(b){this.renderer=b;this.canvas=b.domElement};
Program.prototype.displayVR=function(){if(this.vr)try{this.useVr=!0,this.vrEffect=new THREE.VREffect(this.renderer),this.vrEffect.setFullScreen(!0)}catch(b){this.useVr=!1,this.vrEffect=null,console.warn("Program: Failed to enter in VR Mode",b)}};Program.prototype.exitVR=function(){this.vr&&(this.useVr=!1,null!==this.vrEffect&&(this.vrEffect.setFullScreen(!1),this.vrEffect.dispose(),this.vrEffect=null))};Program.prototype.update=function(){this.scene.update()};
Program.prototype.render=function(b){if(this.useVr)for(var h=0;h<this.scene.cameras.length;h++){var k=this.scene.cameras[h];this.vrEffect.render(this.scene,k)}else{var e=b.domElement.width,p=b.domElement.height;b.setScissorTest(!0);for(h=0;h<this.scene.cameras.length;h++)k=this.scene.cameras[h],k.clearColor&&b.clearColor(),k.clearDepth&&b.clearDepth(),b.setViewport(e*k.offset.x,p*k.offset.y,e*k.viewport.x,p*k.viewport.y),b.setScissor(e*k.offset.x,p*k.offset.y,e*k.viewport.x,p*k.viewport.y),b.render(this.scene,
k);b.setScissorTest(!1)}};Program.prototype.resize=function(b,h){for(var k=0;k<this.scene.cameras.length;k++)this.scene.cameras[k].aspect=b/h,this.scene.cameras[k].updateProjectionMatrix();this.traverse(e=>{e instanceof Script&&e.resize()})};Program.prototype.setScene=function(b){b instanceof Scene?this.scene=b:"string"===typeof b&&(this.scene=this.getObjectByName(b));null!==this.scene&&(this.scene.initialize(),0===this.scene.cameras.length&&this.scene.cameras.push(this.defaultCamera))};
Program.prototype.remove=function(b){var h=this.children.indexOf(b);-1<h&&(this.children.splice(h,1),b.parent=null);0===this.children.length&&(this.scene=null)};Program.prototype.add=function(b){b instanceof Scene&&(this.children.push(b),b.parent=this,1===this.children.length&&(this.scene=this.children[0]))};Program.prototype.clone=function(){return(new ObjectLoader).parse(this.toJSON())};Program.prototype.setInitialScene=function(b){this.defaultScene=b.uuid};
Program.prototype.addDefaultScene=function(b){void 0===b&&(b=new MeshStandardMaterial({roughness:.6,metalness:.2}),b.name="default");var h=new Scene,k=new Sky;k.autoUpdate=!1;h.add(k);k=new THREE.BoxBufferGeometry(1,1,1);var e=new Mesh(k,b);e.scale.set(4,4,4);e.position.set(0,1.5,0);e.receiveShadow=!0;e.castShadow=!0;e.name="box";h.add(e);e=new Mesh(k,b);e.scale.set(40,2,40);e.position.set(0,-1.5,0);e.receiveShadow=!0;e.castShadow=!0;e.name="ground";h.add(e);this.add(h)};
Program.prototype.dispose=function(){for(var b in this.geometries)this.geometries[b].dispose();for(b in this.textures)this.textures[b].dispose();for(b in this.materials)this.materials[b].dispose();for(b in this.assetObjects)this.assetObjects[b].dispose();for(b=0;b<this.children.length;b++)this.children[b].dispose()};
Program.prototype.receiveDataApp=function(b){var h=!1;this.traverse(k=>{k instanceof Script?null!==k.script&&void 0!==k.script.onAppData&&(k.appData(b),h=!0):k instanceof BlockScript&&null!==k.graph&&(k.graph.sendEventToAllNodes("onAppData",b),h=!0)});h||("object"===typeof b?console.warn("Program: No script or blocks with data receive event found",JSON.stringify(b)):console.warn("Program: No script or blocks with data receive event found",b))};
Program.prototype.sendDataApp=function(b){if(null!==this.app)if(void 0!==this.app.onDataReceived)this.gorlot.onDataReceived(b);else console.warn("Program: No app available",JSON.stringify(b));else"object"===typeof b?alert(JSON.stringify(b)):console.warn("Program: No app available",b)};
Program.prototype.toJSON=function(b,h){var k=this;b=THREE.Object3D.prototype.toJSON.call(this,b,function(p,q){if(!1!==h){q=k.textures;for(var l in q){var t=q[l];void 0===p.textures[t.uuid]&&(p.textures[t.uuid]=t.toJSON(p))}q=k.materials;for(l in q)t=q[l],void 0===p.materials[t.uuid]&&(p.materials[t.uuid]=t.toJSON(p));q=k.fonts;for(l in q)t=q[l],void 0===p.fonts[t.uuid]&&(p.fonts[t.uuid]=t.toJSON(p));t=k.assetObjects;for(l in t)q=t[l],void 0===p.assetObjects[q.uuid]&&(p.assetObjects[q.uuid]=q.toJSON(p));
q=k.audio;for(l in q)t=q[l],void 0===p.audio[t.uuid]&&(p.audio[t.uuid]=t.toJSON(p))}});null!==this.defaultScene&&(b.object.defaultScene=this.defaultScene);b.object.author=this.author;b.object.description=this.description;b.object.version=this.version;b.object.lockPointer=this.lockPointer;b.object.folders=[];for(var e in this.folders)b.object.folders.push(this.folders[e].toJSON());b.object.vr=this.vr;b.object.vrScale=this.vrScale;b.object.antialiasing=this.antialiasing;b.object.shadows=this.shadows;
b.object.shadowsType=this.shadowsType;return b};
function Scene(){THREE.Scene.call(this);this.name="scene";this.matrixAutoUpdate=!1;this.world=new CANNON.World;this.world.defaultContactMaterial.contactEquationStiffness=1E9;this.world.defaultContactMaterial.contactEquationRelaxation=4;this.world.quatNormalizeSkip=0;this.world.quatNormalizeFast=!1;this.world.gravity.set(0,-9.8,0);this.world.broadphase=new CANNON.NaiveBroadphase;this.world.solver=new CANNON.SplitSolver(new CANNON.GSSolver);this.world.solver.tolerance=.05;this.world.solver.iterations=
7;this.clock=new THREE.Clock;this.raycaster=new THREE.Raycaster;this.cameras=[];this.canvas=this.program=null;this.mouse=new THREE.Vector2(0,0);this.components=[];this.defaultComponents=[];this.defaultComponents.push(new SceneComponent)}Scene.prototype=Object.create(THREE.Scene.prototype);Scene.prototype.initialize=function(){this.program=this.parent;this.canvas=this.parent.canvas;this.clock.start();for(var b=0;b<this.children.length;b++)this.children[b].initialize()};
Scene.prototype.update=function(){this.mouse.set(this.program.mouse.position.x/this.canvas.width*2-1,-2*this.program.mouse.position.y/this.canvas.height+1);0<this.cameras.length&&this.raycaster.setFromCamera(this.mouse,this.cameras[0]);var b=this.clock.getDelta();this.world.step(.05>b?b:.05);for(b=0;b<this.children.length;b++)this.children[b].update()};
Scene.prototype.getCamera=function(b,h){void 0===h&&(h=this);if(b===h.uuid)return h;h=h.children;for(var k=0;k<h.length;k++){var e=this.getCamera(b,h[k]);if(null!==e)return e}return null};Scene.prototype.addCamera=function(b){this.cameras.push(b);this.updateCameraOrder()};Scene.prototype.updateCameraOrder=function(){this.cameras.sort((b,h)=>b.order<h.order)};Scene.prototype.removeCamera=function(b){b=this.cameras.indexOf(b);-1<b&&(this.cameras.splice(b,1),this.updateCameraOrder())};
Scene.prototype.setFogMode=function(b){var h=null!==this.fog?this.fog.color.getHex():"#FFFFFF";b===THREE.Fog.LINEAR?this.fog=new THREE.Fog(h,5,20):b===THREE.Fog.EXPONENTIAL?this.fog=new THREE.FogExp2(h,.01):b===THREE.Fog.NONE&&(this.fog=null)};
Scene.prototype.toJSON=function(b){b=THREE.Scene.prototype.toJSON.call(this,b);null!==this.background&&(b.object.background=this.background);b.object.cameras=[];for(var h=0;h<this.cameras.length;h++)b.object.cameras.push(this.cameras[h].uuid);b.object.world={};b.object.world.gravity=this.world.gravity;b.object.world.quatNormalizeSkip=this.world.quatNormalizeSkip;b.object.world.quatNormalizeFast=this.world.quatNormalizeFast;b.object.world.solver={};b.object.world.solver.tolerance=this.world.solver.tolerance;
b.object.world.solver.iterations=this.world.solver.iterations;return b};function ObjectCaller(b,h){THREE.Object3D.call(this);this.name="caller";this.type="ObjectCaller";this.obj=null;this.objUuid=void 0===b?null:b;this.objType=void 0===h?null:h;this.program=null;this.components=[];this.defaultComponents=[];this.defaultComponents.push(new ElementComponent);this.defaultComponents.push(new ObjectComponent)}ObjectCaller.prototype=Object.create(THREE.Object3D.prototype);
ObjectCaller.prototype.initialize=function(){this.program=void 0!==Editor.programRunning&&null!==Editor.programRunning?Editor.programRunning:Main.program;null!==this.objUuid&&void 0!==this.program.assetObjects[this.objUuid]&&(this.obj=this.program.assetObjects[this.objUuid],this.obj.initialize());for(var b=0;b<this.children.length;b++)this.children[b].initialize()};ObjectCaller.prototype.update=function(){if(null!==this.obj){this.obj.update();for(var b=0;b<this.children.length;b++)this.children[b].update()}};
ObjectCaller.prototype.dispose=function(){if(null!==this.obj){this.obj.dispose();for(var b=0;b<this.children.length;b++)this.children[b].dispose()}};ObjectCaller.prototype.setObject=function(b){this.objUuid=b.uuid;this.name=b.name;this.objType=b.type};ObjectCaller.prototype.toJSON=function(b){b=THREE.Object3D.prototype.toJSON.call(this,b);b.object.objUuid=this.objUuid;b.object.objType=this.objType;return b};function Base64Utils(){}
Base64Utils.removeHeader=function(b){return b.slice(b.search(";base64")+8)};
Base64Utils.fromArrayBuffer=function(b){var h="";b=new Uint8Array(b);for(var k=b.byteLength%3,e=b.byteLength-k,p,q,l,t,r=0;r<e;r+=3)t=b[r]<<16|b[r+1]<<8|b[r+2],p=(t&16515072)>>18,q=(t&258048)>>12,l=(t&4032)>>6,t&=63,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[p]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[l]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t];1===
k?(t=b[e],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&3)<<4]+"=="):2===k&&(t=b[e]<<8|b[e+1],h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t&15)<<2]+"=");return h};
Base64Utils.fromBinaryString=function(b){var h="",k=b.length%3,e=b.length-k,p;for(p=0;p<e;p+=3){var q=b.charCodeAt(p)&255;var l=b.charCodeAt(p+1);var t=b.charCodeAt(p+2);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>2);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((q&3)<<4|(l&240)>>4);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((l&15)<<2|(t&192)>>6);h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t&
63)}1===k?(q=b.charCodeAt(p)&255,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>2),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((q&3)<<4),h+="=="):2===k&&(q=b.charCodeAt(p)&255,l=b.charCodeAt(p+1),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>2),h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((q&3)<<4)|(l&&240)>>4,h+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((l&
15)<<2),h+="==");return h};function ArraybufferUtils(){}ArraybufferUtils.fromBinaryString=function(b){for(var h=b.length,k=new ArrayBuffer(h),e=new Uint8Array(k),p=0;p<h;p++)e[p]=b.charCodeAt(p);return k};
ArraybufferUtils.fromBase64=function(b){for(var h=b.length/4*3,k=new ArrayBuffer(h),e=new Uint8Array(k),p,q,l,t,r=0,y=0;r<h;r+=3)p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b.charAt(y++)),e[r]=
p<<2|q>>4,64!==l&&(e[r+1]=(q&15)<<4|l>>2),64!==t&&(e[r+2]=(l&3)<<6|t);return k};ArraybufferUtils.fromBuffer=function(b){for(var h=new ArrayBuffer(b.length),k=new Uint8Array(h),e=0;e<b.length;e++)k[e]=b[e];return h};function MathUtils(){}MathUtils.pi2=2*Math.PI;MathUtils.pid2=Math.PI/2;function ObjectUtils(){}ObjectUtils.getFonts=function(b,h){void 0===h&&(h=[]);b.traverse(k=>{k.font instanceof Font&&void 0===h[k.font.uuid]&&(h[k.font.uuid]=k.font)});return h};
ObjectUtils.getAudio=function(b,h){void 0===h&&(h=[]);b.traverse(k=>{k.audio instanceof Audio&&void 0===h[k.audio.uuid]&&(h[k.audio.uuid]=k.audio)});return h};
ObjectUtils.getMaterials=function(b,h){function k(e){void 0===h[e.uuid]&&(h[e.uuid]=e)}void 0===h&&(h=[]);b.traverse(e=>{if(!(void 0===e.material||e.hidden||e instanceof Sky||e instanceof ParticleEmitter||e instanceof SpineAnimation)){if(e.material instanceof THREE.Material)k(e.material);else if(e.material instanceof THREE.MultiMaterial)for(var p=e.material.materials,q=0;q<p.length;q++)k(p[q]);if(void 0!==e.materials)for(q=0;q<e.materials.length;i++)k(e.materials[q])}});return h};
ObjectUtils.getTextures=function(b,h){function k(p){e(p.map);e(p.bumpMap);e(p.normalMap);e(p.displacementMap);e(p.specularMap);e(p.emissiveMap);e(p.alphaMap);e(p.roughnessMap);e(p.metalnessMap)}function e(p){null!=p&&void 0===h[p.uuid]&&(h[p.uuid]=p)}void 0===h&&(h=[]);b.traverse(p=>{if(void 0!==p.material)if(p.material instanceof THREE.Material)k(p.material);else if(p.material instanceof THREE.MultiMaterial)for(var q=p.material.materials,l=0;l<q.length;l++)k(q[l]);void 0!==p.texture&&e(p.texture)});
return h};ObjectUtils.getScene=function(b){for(;null!==b.parent;)if(b=b.parent,b instanceof Scene)return b;return null};ObjectUtils.getRoot=function(b){for(;null!==b.parent;)b=b.parent;return b};ObjectUtils.setMatrixAutoUpdate=function(b,h){b.matrixAutoUpdate=h;b.traverse(k=>{k.matrixAutoUpdate=h})};ObjectUtils.setShadowReceiving=function(b,h){b.receiveShadow=h;b.traverse(k=>{k.receiveShadow=h})};ObjectUtils.setShadowCasting=function(b,h){b.castShadow=h;b.traverse(k=>{k.castShadow=h})};
ObjectUtils.isChildOf=function(b,h){for(var k=0;k<b.children.length;k++)if(b.children[k]===h||ObjectUtils.isChildOf(b.children[k],h))return!0;return!1};function BufferUtils(){}BufferUtils.fromArrayBuffer=function(b){var h=new Buffer(b.byteLength);b=new Uint8Array(b);for(var k=0;k<h.length;k++)h[k]=b[k];return h};function MeshBasicMaterial(b){THREE.MeshBasicMaterial.call(this,b);this.path="/"}MeshBasicMaterial.prototype=Object.create(THREE.MeshBasicMaterial.prototype);
MeshBasicMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshLambertMaterial(b){THREE.MeshLambertMaterial.call(this,b);this.path="/"}MeshLambertMaterial.prototype=Object.create(THREE.MeshLambertMaterial.prototype);MeshLambertMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};
function MeshNormalMaterial(b){THREE.MeshNormalMaterial.call(this,b);this.path="/"}MeshNormalMaterial.prototype=Object.create(THREE.MeshNormalMaterial.prototype);MeshNormalMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshPhongMaterial(b){THREE.MeshPhongMaterial.call(this,b);this.path="/"}MeshPhongMaterial.prototype=Object.create(THREE.MeshPhongMaterial.prototype);
MeshPhongMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshShaderMaterial(b){THREE.ShaderMaterial.call(this,b);this.path="/"}MeshShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);MeshShaderMaterial.prototype.toJSON=function(b){b=THREE.ShaderMaterial.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};
function MeshStandardMaterial(b){THREE.MeshStandardMaterial.call(this,b);this.path="/"}MeshStandardMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype);MeshStandardMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function MeshToonMaterial(b){THREE.MeshToonMaterial.call(this,b);this.path="/"}MeshToonMaterial.prototype=Object.create(THREE.MeshToonMaterial.prototype);
MeshToonMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};function SpriteMaterial(b){THREE.SpriteMaterial.call(this,b);this.path="/"}SpriteMaterial.prototype=Object.create(THREE.SpriteMaterial.prototype);SpriteMaterial.prototype.toJSON=function(b){b=THREE.Material.prototype.toJSON.call(this,b);b.nodes=this.nodes;b.path=this.path;return b};
function Panel(b){this.parent=void 0!==b?b:document.body;this.element=document.createElement("div");this.element.style.position="absolute";this.element.style.overflow="auto";this.element.style.cursor="default";this.element.style.backgroundColor=Editor.theme.panelColor;this.element.ondrop=function(h){h.preventDefault()};this.element.ondragover=function(h){h.preventDefault()};this.components=[];this.childrenPos=new THREE.Vector2(5,10);this.fitParent=!0;this.size=new THREE.Vector2(0,0);this.position=
new THREE.Vector2(0,0);this.visible=!0;this.focused=!1;this.element.onmouseenter=function(){self.focused=!0};this.element.onmouseout=function(){self.focused=!1};this.obj=null;this.parent.appendChild(this.element)}Panel.prototype.updatePanel=function(){if(null!==this.obj)for(var b=0;b<this.components.length;b++)this.components[b].updateData&&this.components[b].updateData(this.obj)};
Panel.prototype.attachObject=function(b){if(b instanceof THREE.Object3D){this.obj=b;this.updateComponents();var h=this;this.add=new Button(this.element);this.add.setText("Add Component");this.add.setCallback(k=>{var e=new ContextMenu;e.size.set(130,20);e.position.set(k.clientX-5,event.clientY+20*length);for(k=0;k<Editor.componentManager.length;k++)h.addAddComponent(Editor.componentManager[k],e)});this.add.updateInterface();this.updateInterface();this.updatePanel()}};
Panel.prototype.addAddComponent=function(b,h){if(void 0!==b&&void 0!==h){var k=this;h.addOption(b.componentName,()=>{var e=!1;k.obj.components.includes(b)&&(e=!0);e||(k.obj.components.push(b),k.obj.components[k.obj.components.length-1].onCreate(k.obj),k.updateComponents())})}};
Panel.prototype.updateComponents=function(){if(void 0!==this.obj.components&&void 0!==this.obj.defaultComponents){this.components=this.obj.defaultComponents.concat(this.obj.components);this.childrenPos.equals(new THREE.Vector2(5,10))||this.childrenPos.set(5,10);for(var b=0;b<this.components.length;b++)this.element.appendChild(this.components[b].initUI(this.childrenPos,this.obj)),this.childrenPos.y+=10;this.updatePanel();this.updateInterface()}};Panel.prototype.destroy=function(){try{this.parent.removeChild(this.element)}catch(b){}};
Panel.prototype.update=function(){};
Panel.prototype.updateInterface=function(){this.fitParent&&(this.size.x=this.parent.offsetWidth,this.size.y=this.parent.offsetHeight);for(var b=0;b<this.components.length;b++)this.components[b].updateInterface();this.element.style.visiblility=this.visible?"visible":"hidden";void 0!==this.add&&(this.add.size.set(this.size.x-30,20),this.add.position.copy(this.childrenPos),this.add.updateInterface());this.element.style.top=this.position.y+"px";this.element.style.left=this.position.x+"px";this.element.style.width=
this.size.x+"px";this.element.style.height=this.size.y-20+"px"};function Component(){this.values={};this.obj=null;this.element=document.createElement("div");this.className=this.componentName="";this.widgetsPos=new THREE.Vector2}Component.prototype.clearElement=function(){if(0<this.element.children.length){var b=new Range;b.selectNodeContents(this.element);b.deleteContents()}};
Component.prototype.addDeleteButton=function(){var b=this;this.delete=new Button(this.element);this.delete.setText("Delete Component");this.delete.size.set(120,20);this.delete.position.copy(this.widgetsPos);this.delete.updateInterface();this.delete.setCallback(()=>{b.onDelete()});this.widgetsPos.y+=this.delete.size.y};
Component.prototype.addResetButton=function(){var b=this;this.reset=new Button(this.element);this.reset.setText("Reset Defaults");this.reset.size.set(100,20);this.reset.position.copy(this.widgetsPos);this.reset.updateInterface();this.reset.setCallback(()=>{b.onReset()});this.widgetsPos.y+=this.reset.size.y};Component.prototype.onDelete=function(){if(null!==this.obj){for(var b=0;b<this.obj.components.length;b++)this.obj.components[b]===this&&this.obj.components.splice(b,1);this.clearElement();Interface.panel.updateComponents()}};
Component.prototype.onReset=function(){};Component.prototype.onCreate=function(){};Component.prototype.initialize=function(){};Component.prototype.update=function(){};Component.prototype.dispose=function(){};Component.prototype.updateInterface=function(){this.element.style.width=this.form.size.x+"px";this.form.updateInterface()};Component.prototype.toJSON=function(){var b={};b.name=this.componentName;b.className=this.className;b.values=this.values;return b};
function AudioComponent(){Component.call(this);this.componentName="Audio";this.className="AudioComponent";this.values={volume:1,static:!1,autoplay:!0,loop:!0,playbackRate:1}}AudioComponent.prototype=Object.create(Component.prototype);
AudioComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Audio");this.player=new AudioPlayer(this.form.element);this.player.size.set(190,20);this.form.add(this.player);this.form.nextRow();this.form.addText("Volume");this.volume=new Slider(this.form.element);this.volume.size.set(80,18);this.volume.setRange(0,1);this.volume.setStep(.01);
this.volume.setOnChange(()=>{null!==k.obj&&(k.obj.volume=k.volume.getValue())});this.form.add(this.volume);this.form.nextRow();this.form.addText("Speed");this.playbackRate=new NumberBox(this.form.element);this.playbackRate.size.set(60,18);this.playbackRate.setStep(.01);this.playbackRate.setRange(0,Number.MAX_SAFE_INTEGER);this.playbackRate.setOnChange(()=>{null!==k.obj&&(k.obj.playbackRate=k.playbackRate.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.playbackRate);this.form.nextRow();
this.autoplay=new CheckBox(this.form.element);this.form.addText("Autoplay");this.autoplay.size.set(150,15);this.autoplay.setOnChange(()=>{null!==k.obj&&(k.obj.autoplay=k.autoplay.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.autoplay);this.form.nextRow();this.loop=new CheckBox(this.form.element);this.form.addText("Loop");this.loop.size.set(150,15);this.loop.setOnChange(()=>{null!==k.obj&&(k.obj.loop=k.loop.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.loop);
this.form.nextRow();this.form.addText("Static Object");this.static=new CheckBox(this.form.element);this.static.size.set(20,15);this.static.setOnChange(()=>{null!==this.obj&&(k.obj.matrixAutoUpdate=!k.static.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.static);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton(this.onReset);return this.element};
AudioComponent.prototype.updateData=function(){this.player.setAudioBuffer(this.obj.audio.data);this.volume.setValue(this.obj.volume);this.static.setValue(this.obj.matrixAutoUpdate);this.autoplay.setValue(this.obj.autoplay);this.loop.setValue(this.obj.loop);this.playbackRate.setValue(this.obj.playbackRate)};
AudioComponent.prototype.onReset=function(){this.obj.volume=this.values.volume;this.obj.matrixAutoUpdate=this.values.static;this.obj.autoplay=this.values.autoplay;this.obj.loop=this.values.loop;this.obj.playbackRate=this.values.playbackRate;Editor.updateObjectViews();this.updateData()};
function PhysicsComponent(){Component.call(this);this.componentName="Physics";this.className="PhysicsComponent";this.values={type:1,mass:1,linearDamping:.01,angularDamping:.01,allowSleep:!0,sleepSpeedLimit:.1,sleepTimeLimit:1,fixedRotation:!1,collisionFilterGroup:1}}PhysicsComponent.prototype=Object.create(Component.prototype);
PhysicsComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Type");this.type=new DropdownList(this.form.element);this.type.size.set(100,20);this.type.addValue("Static",CANNON.Body.STATIC);this.type.addValue("Dynamic",CANNON.Body.DYNAMIC);this.type.addValue("Kinematic",CANNON.Body.KINEMATIC);this.type.setOnChange(()=>
{null!==k.obj&&(k.obj.body.type=k.type.getValue())});this.form.add(this.type);this.form.nextRow();this.form.addText("Mass");this.mass=new NumberBox(this.form.element);this.mass.size.set(50,18);this.mass.setStep(.1);this.mass.setOnChange(()=>{null!==k.obj&&(k.obj.body.mass=k.mass.getValue())});this.form.add(this.mass);this.form.nextRow();this.form.addText("Linear Damp.");this.linearDamping=new NumberBox(this.form.element);this.linearDamping.size.set(50,18);this.linearDamping.setStep(.01);this.linearDamping.setRange(0,
1);this.linearDamping.setOnChange(()=>{null!==k.obj&&(k.obj.body.linearDamping=k.linearDamping.getValue())});this.form.add(this.linearDamping);this.form.nextRow();this.form.addText("Angular Damping");this.angularDamping=new NumberBox(this.form.element);this.angularDamping.size.set(80,18);this.angularDamping.setStep(.01);this.angularDamping.setRange(0,1);this.angularDamping.setOnChange(()=>{null!==k.obj&&(k.obj.body.angularDamping=k.angularDamping.getValue())});this.form.add(this.angularDamping);this.form.nextRow();
this.allowSleep=new CheckBox(this.form.element);this.form.addText("Allow Sleep.");this.allowSleep.size.set(150,15);this.allowSleep.setOnChange(()=>{null!==k.obj&&(k.obj.body.allowSleep=k.allowSleep.getValue())});this.form.add(this.allowSleep);this.form.nextRow();this.form.addText("Sleep Time");this.sleepSpeedLimit=new NumberBox(this.form.element);this.sleepSpeedLimit.size.set(50,18);this.sleepSpeedLimit.setStep(.01);this.sleepSpeedLimit.setOnChange(()=>{null!==k.obj&&(k.obj.body.sleepSpeedLimit=k.sleepSpeedLimit.getValue())});
this.form.add(this.sleepSpeedLimit);this.form.nextRow();this.form.addText("Sleep Time Limit");this.sleepTimeLimit=new NumberBox(this.form.element);this.sleepTimeLimit.size.set(80,18);this.sleepTimeLimit.setStep(.01);this.sleepTimeLimit.setOnChange(()=>{null!==k.obj&&(k.obj.body.sleepTimeLimit=k.sleepTimeLimit.getValue())});this.form.add(this.sleepTimeLimit);this.form.nextRow();this.fixedRotation=new CheckBox(this.form.element);this.form.addText("Lock Rotation");this.fixedRotation.size.set(150,15);
this.fixedRotation.setOnChange(()=>{null!==k.obj&&(k.obj.body.fixedRotation=k.fixedRotation.getValue())});this.form.add(this.fixedRotation);this.form.nextRow();this.form.addText("Physics Group");this.collisionFilterGroup=new NumberBox(this.form.element);this.collisionFilterGroup.size.set(80,18);this.collisionFilterGroup.setStep(1);this.collisionFilterGroup.setOnChange(()=>{null!==k.obj&&(k.obj.body.collisionFilterGroup=k.collisionFilterGroup.getValue())});this.form.add(this.collisionFilterGroup);
this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
PhysicsComponent.prototype.updateData=function(){this.type.setValue(this.obj.body.type);this.mass.setValue(this.obj.body.mass);this.linearDamping.setValue(this.obj.body.linearDamping);this.angularDamping.setValue(this.obj.body.angularDamping);this.allowSleep.setValue(this.obj.body.allowSleep);this.sleepTimeLimit.setValue(this.obj.body.sleepTimeLimit);this.sleepSpeedLimit.setValue(this.obj.body.sleepSpeedLimit);this.fixedRotation.setValue(this.obj.body.fixedRotation);this.collisionFilterGroup.setValue(this.obj.body.collisionFilterGroup)};
PhysicsComponent.prototype.onReset=function(){this.obj.body.type=this.values.type;this.obj.body.mass=this.values.mass;this.obj.body.linearDamping=this.values.linearDamping;this.obj.body.angularDamping=this.values.angularDamping;this.obj.body.allowSleep=this.values.allowSleep;this.obj.body.sleepTimeLimit=this.values.sleepTimeLimit;this.obj.body.sleepSpeedLimit=this.values.sleepSpeedLimit;this.obj.body.fixedRotation=this.values.fixedRotation;this.obj.body.collisionFilterGroup=this.values.collisionFilterGroup;
Editor.updateObjectViews();this.updateData()};function ScriptComponent(){Component.call(this);this.componentName="Script";this.className="ScriptComponent"}ScriptComponent.prototype=Object.create(Component.prototype);
ScriptComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};ScriptComponent.prototype.onReset=function(){this.updateData();Editor.updateObjectViews()};
function ElementComponent(){Component.call(this);this.componentName="Element";this.className="ElementComponent";this.values={name:"object",position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0),scale:new THREE.Vector3(1,1,1)}}ElementComponent.prototype=Object.create(Component.prototype);
ElementComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(190,18);this.name.setOnChange(()=>{null!==k.obj&&(k.obj.name=k.name.getText(),Editor.history.push(k.obj,Action.CHANGED),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();
Settings.general.showUuid&&(this.form.addText("UUID"),this.uuid=new TextBox(this.form.element),this.uuid.size.set(190,18),this.uuid.setDisabled(!0),this.form.add(this.uuid),this.form.nextRow());this.form.addText("Type");this.type=this.form.addText("null");this.form.nextRow();this.form.addText("Position");this.position=new CoordinatesBox(this.form.element);this.position.size.set(190,18);this.position.setStep(.01);this.position.setOnChange(()=>{if(null!==k.obj){var e=k.position.getValue();k.obj.position.set(e.x,
e.y,e.z);Editor.history.push(this.obj,Action.CHANGED)}});this.form.add(this.position);this.form.nextRow();this.form.addText("Rotation");this.rotation=new CoordinatesBox(this.form.element);this.rotation.size.set(190,18);this.rotation.setStep(.01);this.rotation.setOnChange(()=>{if(null!==k.obj){var e=k.rotation.getValue();k.obj.rotation.set(e.x,e.y,e.z);Editor.history.push(k.obj,Action.CHANGED)}});this.form.add(this.rotation);this.form.nextRow();this.form.addText("Scale");this.scale=new CoordinatesBox(this.form.element);
this.scale.size.set(190,18);this.scale.setStep(.01);this.scale.setOnChange(()=>{if(null!==k.obj){var e=k.scale.getValue();k.obj.scale.set(e.x,e.y,e.z);Editor.history.push(k.obj,Action.CHANGED);if(k.obj instanceof PhysicsObject)for(var p=k.obj.body.shapes,q=0;q<p.length;q++){var l=p[q];l.type===CANNON.Shape.types.BOX?(l.halfExtents.x=e.x/2,l.halfExtents.y=e.y/2,l.halfExtents.z=e.z/2):l.type===CANNON.Shape.types.SPHERE&&(l.radius=e.x)}}});this.form.add(this.scale);this.form.nextRow();this.form.position.copy(this.widgetsPos);
this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};ElementComponent.prototype.updateData=function(){this.name.setText(this.obj.name);void 0!==this.uuid&&this.uuid.setText(this.obj.uuid);this.position.setValue(this.obj.position.x,this.obj.position.y,this.obj.position.z);this.rotation.setValue(this.obj.rotation.x,this.obj.rotation.y,this.obj.rotation.z);this.scale.setValue(this.obj.scale.x,this.obj.scale.y,this.obj.scale.z);this.type.setText(this.obj.type)};
ElementComponent.prototype.onReset=function(){this.obj.position.set(this.values.position.x,this.values.position.y,this.values.position.z);this.obj.rotation.set(this.values.rotation.x,this.values.rotation.y,this.values.rotation.z);this.obj.scale.set(this.values.scale.x,this.values.scale.y,this.values.scale.z);Editor.updateObjectViews();this.updateData()};
function ObjectComponent(){Component.call(this);this.componentName="Object 3D";this.className="ObjectComponent";this.values={visible:!0,static:!1,castShadow:!0,receiveShadow:!0}}ObjectComponent.prototype=Object.create(Component.prototype);
ObjectComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.visible=new CheckBox(this.form.element);this.form.addText("Visible");this.visible.size.set(20,15);this.visible.setOnChange(()=>{null!==k.obj&&(k.obj.visible=k.visible.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.visible);this.form.nextRow();
this.static=new CheckBox(this.form.element);this.form.addText("Static Object");this.static.size.set(20,15);this.static.setOnChange(()=>{null!==k.obj&&(k.obj.matrixAutoUpdate=!k.static.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.static);this.form.nextRow();this.form.addText("Cast Shadow");this.castShadow=new CheckBox(this.form.element);this.castShadow.size.set(20,15);this.castShadow.setOnChange(()=>{null!==k.obj&&(k.obj.castShadow=k.castShadow.getValue(),Editor.history.push(k.obj,
Action.CHANGED))});this.form.add(this.castShadow);this.form.nextRow();this.form.addText("React Shadow");this.receiveShadow=new CheckBox(this.form.element);this.receiveShadow.size.set(20,15);this.receiveShadow.setOnChange(()=>{null!==k.obj&&(k.obj.receiveShadow=k.receiveShadow.getValue(),Editor.history.push(k.obj,Action.CHANGED))});this.form.add(this.receiveShadow);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();
return this.element};ObjectComponent.prototype.updateData=function(){this.visible.setValue(this.obj.visible);this.static.setValue(!this.obj.matrixAutoUpdate);this.castShadow.setValue(this.obj.castShadow);this.receiveShadow.setValue(this.obj.receiveShadow)};ObjectComponent.prototype.onReset=function(){this.obj.visible=this.values.visible;this.obj.matrixAutoUpdate=!this.values.static;this.obj.castShadow=this.values.castShadow;this.obj.receiveShadow=this.values.receiveShadow;this.updateData()};
function ProgramComponent(){Component.call(this);this.componentName="Program";this.className="ProgramComponent";this.values={name:"program",author:"",version:"0",lockPointer:!1,vr:!1,vrScale:1,antialiasing:!1,shadows:!0,shadowsType:THREE.PCFSoftShadowMap}}ProgramComponent.prototype=Object.create(Component.prototype);
ProgramComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==k.obj&&(k.obj.name=k.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();this.form.addText("Information");this.form.nextRow();
this.form.addText("Author");this.author=new TextBox(this.form.element);this.author.position.set(50,35);this.author.size.set(190,18);this.author.updateInterface();this.author.setOnChange(()=>{null!==k.obj&&(k.obj.author=k.author.getText())});this.form.add(this.author);this.form.nextRow();this.form.addText("Version");this.version=new TextBox(this.form.element);this.version.size.set(100,18);this.version.setOnChange(()=>{null!==k.obj&&(k.obj.version=k.version.getText())});this.form.add(this.version);
this.form.nextRow();this.form.addText("Lock Pointer");this.lockPointer=new CheckBox(this.form.element);this.lockPointer.size.set(50,15);this.lockPointer.setOnChange(()=>{null!==k.obj&&(k.obj.lockPointer=k.lockPointer.getValue())});this.form.add(this.lockPointer);this.form.nextRow();this.form.addText("Virtual Reality");this.form.nextRow();this.vr=new CheckBox(this.form.element);this.form.addText("VR Enabled");this.vr.size.set(50,15);this.vr.setOnChange(()=>{null!==k.obj&&(k.obj.vr=k.vr.getValue())});
this.form.add(this.vr);this.form.nextRow();this.form.addText("Room Scale");this.vrScale=new NumberBox(this.form.element);this.vrScale.size.set(50,18);this.vrScale.setRange(0,1E3);this.vrScale.setStep(.05);this.vrScale.setOnChange(()=>{null!==k.obj&&(k.obj.vrScale=k.vrScale.getValue())});this.form.add(this.vrScale);this.form.nextRow();this.form.addText("Rendering");this.form.nextRow();this.antialiasing=new CheckBox(this.form.element);this.form.addText("Antialiasing");this.antialiasing.size.set(50,
15);this.antialiasing.setOnChange(()=>{null!==k.obj&&(k.obj.antialiasing=k.antialiasing.getValue())});this.form.add(this.antialiasing);this.form.nextRow();this.shadows=new CheckBox(this.form.element);this.form.addText("Shadows");this.shadows.size.set(50,15);this.shadows.setOnChange(()=>{null!==k.obj&&(k.obj.shadows=k.shadows.getValue())});this.form.add(this.shadows);this.form.nextRow();this.form.addText("Shadows type");this.shadowsType=new DropdownList(this.form.element);this.shadowsType.size.set(120,
20);this.shadowsType.addValue("Basic",THREE.BasicShadowMap);this.shadowsType.addValue("PCF",THREE.PCFShadowMap);this.shadowsType.addValue("PCF Soft",THREE.PCFSoftShadowMap);this.shadowsType.addValue("PCSS Soft",THREE.PCSSoftShadowMap);this.shadowsType.setOnChange(()=>{k.obj.shadowsType=k.shadowsType.getValue()});this.form.add(this.shadowsType);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
ProgramComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.author.setText(this.obj.author);this.version.setText(this.obj.version);this.lockPointer.setValue(this.obj.lockPointer);this.vr.setValue(this.obj.vr);this.vrScale.setValue(this.obj.vrScale);this.antialiasing.setValue(this.obj.antialiasing);this.shadows.setValue(this.obj.shadows);this.shadowsType.setValue(this.obj.shadowsType)};
ProgramComponent.prototype.onReset=function(){this.obj.name=this.values.name;this.obj.author=this.values.author;this.obj.version=this.values.version;this.obj.lockPointer=this.values.lockPointer;this.obj.vr=this.values.vr;this.obj.vrScale=this.values.vrScale;this.obj.antialiasing=this.values.antialiasing;this.obj.shadows=this.values.shadows;this.obj.shadowsType=this.values.shadowsType;Editor.updateObjectViews();this.updateData()};
function SceneComponent(){Component.call(this);this.componentName="Scene";this.className="SceneComponent";this.values={name:"scene",default:!1,background:[0,0,0],fog:THREE.Fog.NONE}}SceneComponent.prototype=Object.create(Component.prototype);
SceneComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Name");this.name=new TextBox(this.form.element);this.name.size.set(200,18);this.name.setOnChange(()=>{null!==k.obj&&(k.obj.name=k.name.getText(),Editor.updateObjectViews())});this.form.add(this.name);this.form.nextRow();this.default=new CheckBox(this.form.element);
this.form.addText("Default Scene");this.default.size.set(20,15);this.default.setOnChange(()=>{if(null!==k.obj){var e=k.obj.parent;k.default.getValue()?e.defaultScene=k.obj.uuid:e.defaultScene=null}});this.form.add(this.default);this.form.nextRow();this.form.addText("Background");this.background=new ColorChooser(this.form.element);this.background.size.set(80,18);this.background.setValue(0,0,0);this.background.setOnChange(()=>{null!==k.obj&&(null===k.obj.background&&(k.obj.background=new THREE.Color),
k.obj.background.setHex(k.background.getValueHex()))});this.form.add(this.background);this.form.nextRow();this.form.addText("Fog");this.fog=new DropdownList(this.form.element);this.fog.size.set(100,20);this.fog.addValue("None",THREE.Fog.NONE);this.fog.addValue("Linear",THREE.Fog.LINEAR);this.fog.addValue("Exponential",THREE.Fog.EXPONENTIAL);this.fog.setOnChange(()=>{null!==k.obj&&(k.obj.setFogMode(k.fog.getSelectedIndex()),k.updateData())});this.form.add(this.fog);this.form.nextRow();this.form.addText("Fog Settings");
this.form.nextRow();this.fogLinearForm=new Form(this.form.element);this.fogLinearForm.spacing.set(5,5);this.fogLinearForm.addText("Linear Fog");this.fogLinearForm.nextRow();this.fogLinearForm.addText("Colour");this.fogLinearColour=new ColorChooser(this.fogLinearForm.element);this.fogLinearColour.size.set(80,18);this.fogLinearColour.setOnChange(()=>{if(null!==k.obj){var e=k.fogLinearColour.getValueHex();k.obj.fog.color.setHex(e)}});this.fogLinearForm.add(this.fogLinearColour);this.fogLinearForm.nextRow();
this.fogLinearForm.addText("Near");this.fogNear=new NumberBox(this.fogLinearForm.element);this.fogNear.size.set(60,18);this.fogNear.setOnChange(()=>{null!==k.obj&&(k.obj.fog.near=k.fogNear.getValue())});this.fogLinearForm.add(this.fogNear);this.fogLinearForm.nextRow();this.fogLinearForm.addText("Far");this.fogFar=new NumberBox(this.fogLinearForm.element);this.fogFar.size.set(60,18);this.fogFar.setOnChange(()=>{null!==k.obj&&(k.obj.fog.far=k.fogFar.getValue())});this.fogLinearForm.add(this.fogFar);
this.fogLinearForm.nextRow();this.fogLinearForm.updateInterface();this.form.add(this.fogLinearForm);this.form.nextRow();this.fogExponentialForm=new Form(this.form.element);this.fogExponentialForm.spacing.set(5,5);this.fogExponentialForm.addText("Exponential Fog");this.fogExponentialForm.nextRow();this.fogExponentialForm.addText("Density");this.fogDensity=new NumberBox(this.fogExponentialForm.element);this.fogDensity.size.set(100,18);this.fogDensity.setStep(1E-4);this.fogDensity.setOnChange(()=>{null!==
k.obj&&(k.obj.fog.density=k.fogDensity.getValue())});this.fogExponentialForm.add(this.fogDensity);this.fogExponentialForm.nextRow();this.fogExponentialForm.updateInterface();this.form.add(this.fogExponentialForm);this.form.nextRow();this.form.addSeparator();this.form.nextRow();this.form.addText("Physics World");this.form.nextRow();this.form.addText("Gravity");this.gravity=new CoordinatesBox(this.form.element);this.gravity.setOnChange(()=>{if(null!==k.obj){var e=k.gravity.getValue();k.obj.world.gravity.set(e.x,
e.y,e.z)}});this.form.add(this.gravity);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
SceneComponent.prototype.updateData=function(){this.name.setText(this.obj.name);this.default.setValue(this.obj.uuid===this.obj.parent.defaultScene);this.obj.fog instanceof THREE.Fog?this.fog.setValue(THREE.Fog.LINEAR):this.obj.fog instanceof THREE.FogExp2?this.fog.setValue(THREE.Fog.EXPONENTIAL):this.fog.setValue(THREE.Fog.NONE);null!==this.obj.fog?(this.fogLinearColour.setValueHex(this.obj.fog.color.getHex()),this.fogNear.setValue(void 0!==this.obj.fog.near?this.obj.fog.near:0),this.fogFar.setValue(void 0!==
this.obj.fog.far?this.obj.fog.far:0),this.fogDensity.setValue(void 0!==this.obj.fog.density?this.obj.fog.density:0)):(this.fogLinearColour.setValueHex(0),this.fogNear.setValue(0),this.fogFar.setValue(0),this.fogDensity.setValue(0));null!==this.obj.background&&this.background.setValue(this.obj.background.r,this.obj.background.g,this.obj.background.b);this.gravity.setValue(this.obj.world.gravity.x,this.obj.world.gravity.y,this.obj.world.gravity.z)};
SceneComponent.prototype.onReset=function(){this.obj.name=this.values.name;this.obj.default=this.values.default;this.obj.parent.defaultScene=null;this.obj.setFogMode(this.values.fog);this.updateData();Editor.updateObjectViews()};function Text3DComponent(){Component.call(this);this.componentName="Text";this.className="Text3DComponent";this.values={text:"text",size:1,curveSegments:15,thickness:.5,bevel:!1,bevelThickness:10,bevelSize:8}}Text3DComponent.prototype=Object.create(Component.prototype);
Text3DComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Text");this.text=new TextArea(this.form.element);this.text.size.set(190,60);this.text.setOnChange(()=>{null!==k.obj&&k.obj.setText(k.text.getText())});this.form.add(this.text);this.form.nextRow();this.form.addText("Size");this.size=new NumberBox(this.form.element);
this.size.size.set(60,18);this.size.setRange(0,Number.MAX_SAFE_INTEGER);this.size.setStep(.1);this.size.setOnChange(()=>{null!==k.obj&&(k.obj.size=k.size.getValue(),k.obj.setText())});this.form.add(this.size);this.form.nextRow();this.form.addText("Thickness");this.height=new NumberBox(this.form.element);this.height.size.set(60,18);this.height.setRange(0,Number.MAX_SAFE_INTEGER);this.height.setStep(.1);this.height.setOnChange(()=>{null!==k.obj&&(k.obj.height=k.height.getValue(),k.obj.setText())});
this.form.add(this.height);this.form.nextRow();this.form.addText("Curve Detail");this.curveSegments=new NumberBox(this.form.element);this.curveSegments.size.set(60,18);this.curveSegments.setRange(0,Number.MAX_SAFE_INTEGER);this.curveSegments.setStep(1);this.curveSegments.setOnChange(()=>{null!==k.obj&&(k.obj.curveSegments=k.curveSegments,k.obj.setText())});this.form.add(this.curveSegments);this.form.nextRow();this.form.addText("Bevel");this.form.nextRow();this.bevel=new CheckBox(this.form.element);
this.form.addText("Enabled");this.bevel.size.set(20,15);this.bevel.setOnChange(()=>{null!==k.obj&&(k.obj.bevel=k.bevel.getValue(),k.obj.setText())});this.form.add(this.bevel);this.form.nextRow();this.form.addText("Thickness");this.bevelThickness=new NumberBox(this.form.element);this.bevelThickness.size.set(60,18);this.bevelThickness.setRange(0,Number.MAX_SAFE_INTEGER);this.bevelThickness.setStep(.1);this.bevelThickness.setOnChange(()=>{null!==k.obj&&(k.obj.bevelThickness=k.bevelThickness.getValue(),
k.obj.setText())});this.form.add(this.bevelThickness);this.form.nextRow();this.form.addText("Size");this.bevelSize=new NumberBox(this.form.element);this.bevelSize.size.set(60,18);this.bevelSize.setRange(0,Number.MAX_SAFE_INTEGER);this.bevelSize.setStep(.1);this.bevelSize.setOnChange(()=>{null!==k.obj&&(k.obj.bevelSize=k.bevelSize.getValue(),k.obj.setText())});this.form.add(this.bevelSize);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;
this.addResetButton();return this.element};Text3DComponent.prototype.updateData=function(){this.text.setText(this.obj.text);this.size.setValue(this.obj.size);this.height.setValue(this.obj.height);this.curveSegments.setValue(this.obj.curveSegments);this.bevel.setValue(this.obj.bevel);this.bevelThickness.setValue(this.obj.bevelThickness);this.bevelSize.setValue(this.obj.bevelSize)};
Text3DComponent.prototype.onReset=function(){this.obj.height=this.values.thickness;this.obj.size=this.values.size;this.obj.curveSegments=this.values.curveSegments;this.obj.bevel=this.values.bevel;this.obj.bevelThickness=this.values.bevelThickness;this.obj.bevelSize=this.values.bevelSize;this.obj.setText(this.values.text);this.updateData();Editor.updateObjectViews()};
function KinectComponent(){Component.call(this);this.componentName="Kinect";this.className="KinectComponent";this.values={debugModel:!0}}KinectComponent.prototype=Object.create(Component.prototype);
KinectComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Debug model");this.debugModel=new CheckBox(this.form.element);this.debugModel.size.set(20,15);this.debugModel.setOnChange(()=>{null!==k.obj&&(k.obj.debugModel=k.debugModel.getValue())});this.form.add(this.debugModel);this.form.position.copy(this.widgetsPos);
this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};KinectComponent.prototype.updateData=function(){this.debugModel.setValue(this.obj.debugModel)};KinectComponent.prototype.onReset=function(){this.obj.debugModel=this.values.debugModel;Editor.updateObjectViews();this.updateData()};
function LeapComponent(){Component.call(this);this.componentName="Leap";this.className="LeapComponent";this.values={mode:0,debugModel:!0,gesturesEnabled:!0,posesEnabled:!0}}LeapComponent.prototype=Object.create(Component.prototype);
LeapComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Mode");this.mode=new DropdownList(this.form.element);this.mode.size.set(80,18);this.mode.addValue("Desk",Script.INIT);this.mode.addValue("HMD",Script.LOOP);this.mode.setOnChange(()=>{null!==k.obj&&(k.obj.mode=k.mode.getSelectedIndex())});this.form.add(this.mode);
this.form.nextRow();this.form.addText("Debug Model");this.debugModel=new CheckBox(this.form.element);this.debugModel.size.set(20,15);this.debugModel.setOnChange(()=>{null!==k.obj&&(k.obj.debugModel=k.debugModel.getValue())});this.form.add(this.debugModel);this.form.nextRow();this.form.addText("Gestures Enabled");this.gesturesEnabled=new CheckBox(this.form.element);this.gesturesEnabled.size.set(20,15);this.gesturesEnabled.setOnChange(()=>{null!==k.obj&&(k.obj.gesturesEnabled=k.gesturesEnabled.getValue())});
this.form.add(this.gesturesEnabled);this.form.nextRow();this.form.addText("Poses Enabled");this.posesEnabled=new CheckBox(this.form.element);this.posesEnabled.size.set(20,15);this.posesEnabled.setOnChange(()=>{null!==k.obj&&(k.obj.posesEnabled=k.posesEnabled.getValue())});this.form.add(this.posesEnabled);this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
LeapComponent.prototype.updateData=function(){this.mode.setSelectedIndex(this.obj.mode);this.debugModel.setValue(this.obj.debugModel);this.gesturesEnabled.setValue(this.obj.gesturesEnabled);this.posesEnabled.setValue(this.obj.posesEnabled)};LeapComponent.prototype.onReset=function(){this.obj.mode=this.values.mode;this.obj.debugModel=this.values.debugModel;this.obj.gesturesEnabled=this.values.gesturesEnabled;this.obj.posesEnabled=this.values.posesEnabled;Editor.updateObjectViews();this.updateData()};
function CameraComponent(){Component.call(this);this.componentName="Camera";this.className="CameraComponent";this.scene=null;this.values={fov:60,use:!1,near:.1,offset:[0,0],far:1E5,size:3,mode:0,start:[0,0],camSize:[1,1],clearColor:!1,clearDepth:!1}}CameraComponent.prototype=Object.create(Component.prototype);
CameraComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.scene=ObjectUtils.getScene(this.obj);this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.obj instanceof PerspectiveCamera?(this.form.addText("FOV"),this.fov=new Slider(this.form.element),this.fov.size.set(160,18),this.fov.setRange(30,160),this.fov.setOnChange(()=>{null!==k.obj&&(k.obj.fov=k.fov.getValue(),k.obj.updateProjectionMatrix())}),
this.form.add(this.fov),this.form.nextRow()):this.obj instanceof OrthographicCamera&&(this.form.addText("Size"),this.size=new NumberBox(this.form.element),this.size.size.set(80,18),this.size.setOnChange(()=>{null!==k.obj&&(k.obj.size=k.size.getValue(),k.obj.updateProjectionMatrix())}),this.form.add(this.size),this.form.nextRow(),this.form.addText("Resize Mode"),this.mode=new DropdownList(this.form.element),this.mode.size.set(130,18),this.mode.addValue("Horizontal",OrthographicCamera.RESIZE_HORIZONTAL),
this.mode.addValue("Vertical",OrthographicCamera.RESIZE_VERTICAL),this.mode.setOnChange(()=>{null!==k.obj&&(k.obj.mode=k.mode.getSelectedIndex())}),this.form.add(this.mode),this.form.nextRow());this.form.addText("Clipping Planes");this.form.nextRow();this.form.addText("Near");this.near=new NumberBox(this.form.element);this.near.size.set(60,18);this.near.setStep(.1);this.near.setRange(0,Number.MAX_SAFE_INTEGER);this.near.setOnChange(()=>{null!==k.obj&&(k.obj.near=k.near.getValue())});this.form.add(this.near);
this.form.nextRow();this.form.addText("Far");this.far=new NumberBox(this.form.element);this.far.size.set(80,18);this.far.setRange(0,Number.MAX_SAFE_INTEGER);this.far.setOnChange(()=>{null!==k.obj&&(k.obj.far=k.far.getValue())});this.form.add(this.far);this.form.nextRow();this.form.addText("Viewport");this.form.nextRow();this.form.addText("Position");this.offset=new CoordinatesBox(this.form.element);this.offset.setMode(CoordinatesBox.VECTOR2);this.offset.setStep(.05);this.offset.size.set(160,20);this.offset.setOnChange(()=>
{null!==k.obj&&k.obj.offset.copy(k.offset.getValue())});this.form.add(this.offset);this.form.nextRow();this.form.addText("Size");this.viewport=new CoordinatesBox(this.form.element);this.viewport.setMode(CoordinatesBox.VECTOR2);this.viewport.setRange(.05);this.viewport.size.set(160,20);this.viewport.setOnChange(()=>{null!==k.obj&&k.obj.viewport.copy(k.viewport.getValue())});this.form.add(this.viewport);this.form.nextRow();this.form.addText("Clear colour");this.clearColor=new CheckBox(this.form.element);
this.clearColor.size.set(20,15);this.clearColor.setOnChange(()=>{null!==k.obj&&(k.obj.clearColor=k.clearColor.getValue())});this.form.add(this.clearColor);this.form.nextRow();this.form.addText("Clear depth");this.clearDepth=new CheckBox(this.form.element);this.clearDepth.size.set(20,15);this.clearDepth.setOnChange(()=>{null!==k.obj&&(k.obj.clearDepth=k.clearDepth.getValue())});this.form.add(this.clearDepth);this.form.nextRow();this.use=new CheckBox(this.form.element);this.form.addText("Use camera");
this.use.size.set(20,15);this.use.setOnChange(()=>{null!==k.obj&&null!==k.scene&&(k.use.getValue()?k.scene.addCamera(k.obj):k.scene.removeCamera(k.obj))});this.form.add(this.use);this.form.nextRow();this.form.addText("Draw Order");this.order=new NumberBox(this.form.element);this.order.size.set(80,18);this.order.setRange(0,Number.MAX_SAFE_INTEGER);this.order.setStep(1);this.order.setOnChange(()=>{null!==k.obj&&null!==k.scene&&(k.obj.order=k.order.getValue(),k.scene.updateCameraOrder())});this.form.add(this.order);
this.form.nextRow();this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
CameraComponent.prototype.updateData=function(){this.obj instanceof PerspectiveCamera?this.fov.setValue(this.obj.fov):this.obj instanceof OrthographicCamera&&(this.size.setValue(this.obj.size),this.mode.setSelectedIndex(this.obj.mode));this.near.setValue(this.obj.near);this.far.setValue(this.obj.far);this.offset.setValue(this.obj.offset);this.viewport.setValue(this.obj.viewport);this.clearColor.setValue(this.obj.clearColor);this.clearDepth.setValue(this.obj.clearDepth);this.order.setValue(this.obj.order);
this.use.setValue(-1!==this.scene.cameras.indexOf(this.obj))};
CameraComponent.prototype.onReset=function(){this.obj instanceof PerspectiveCamera?this.obj.fov=this.values.fov:this.obj instanceof OrthographicCamera&&(this.obj.size=this.values.camSize,this.obj.mode=this.values.mode);this.obj.near=this.values.near;this.obj.far=this.values.far;this.obj.offset=new THREE.Vector2(this.values.offset[0],this.values.offset[1]);this.obj.viewport=new THREE.Vector2(this.values.viewport[0],this.values.viewport[1]);this.obj.clearColor=this.values.clearColor;this.obj.clearDepth=
this.values.clearDepth;null!==this.scene&&-1!==this.scene.cameras.indexOf(this.obj)&&this.scene.removeCamera(this.obj);Editor.updateObjectViews();this.updateData()};function LightComponent(){Component.call(this);this.componentName="Light";this.className="LightComponent";this.values={colour:[.265,.265,.265],castShadow:!0,groundCol:[1,1,1],distance:0,intensity:1,shadowWidth:512,shadowHeight:512,shadowNear:.01,shadowFar:1E6,angle:1,penumbra:0,rectWidth:20,rectHeight:20}}LightComponent.prototype=Object.create(Component.prototype);
LightComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Colour");this.colour=new ColorChooser(this.form.element);this.colour.size.set(80,18);this.colour.setOnChange(()=>{if(null!==k.obj){var e=k.colour.getValue();k.obj.color.setRGB(e.r,e.g,e.b)}});this.form.add(this.colour);this.form.nextRow();this.obj instanceof
HemisphereLight&&(this.form.addText("Ground Colour"),this.groundCol=new ColorChooser(this.form.element),this.groundCol.size.set(80,18),this.groundCol.setOnChange(()=>{if(null!==k.obj){var e=k.groundCol.getValue();k.obj.groundColor.setRGB(e.r,e.g,e.b)}}),this.form.add(this.groundCol),this.form.nextRow());this.obj instanceof PointLight&&(this.form.addText("Distance"),this.distance=new NumberBox(this.form.element),this.distance.size.set(60,18),this.distance.setStep(.1),this.distance.setOnChange(()=>
{null!==k.obj&&(k.obj.distance=k.distance.getValue())}),this.form.add(this.distance),this.form.nextRow(),this.form.addText("Intensity"),this.intensity=new Slider(this.form.element),this.intensity.size.set(160,18),this.intensity.setStep(.1),this.intensity.setRange(0,10),this.intensity.setOnChange(()=>{null!==k.obj&&(k.obj.intensity=k.intensity.getValue())}),this.form.add(this.intensity),this.form.nextRow());this.obj instanceof SpotLight&&(this.form.addText("Penumbra"),this.penumbra=new Slider(this.form.element),
this.penumbra.size.set(160,18),this.penumbra.position.set(65,110),this.penumbra.setRange(0,1),this.penumbra.setStep(.01),this.penumbra.updateInterface(),this.penumbra.setOnChange(()=>{null!==k.obj&&(k.obj.penumbra=k.penumbra.getValue())}),this.form.add(this.penumbra),this.form.nextRow(),this.form.addText("Angle"),this.angle=new Slider(this.form.element),this.angle.size.set(160,18),this.angle.setRange(0,1.57),this.angle.setStep(.01),this.angle.setOnChange(()=>{null!==k.obj&&(k.obj.angle=k.angle.getValue())}),
this.form.add(this.angle),this.form.nextRow());if(this.obj instanceof DirectionalLight||this.obj instanceof PointLight||this.obj instanceof SpotLight){this.form.addText("Shadows");this.form.nextRow();this.form.addText("Cast Shadow");this.castShadow=new CheckBox(this.form.element);this.castShadow.size.set(20,15);this.castShadow.position.set(5,85);this.castShadow.updateInterface();this.castShadow.setOnChange(()=>{null!==k.obj&&(k.obj.castShadow=k.castShadow.getValue())});this.form.add(this.castShadow);
this.form.nextRow();this.form.addText("Map");this.form.nextRow();this.form.addText("Resolution");this.shadowWidth=new DropdownList(this.form.element);this.shadowWidth.size.set(60,18);this.shadowWidth.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.mapSize.width=k.shadowWidth.getValue(),k.obj.updateShadowMap())});this.form.add(this.shadowWidth);this.form.addText("x",!0);this.shadowHeight=new DropdownList(this.form.element);this.shadowHeight.size.set(60,18);this.shadowHeight.setOnChange(()=>{null!==k.obj&&
(k.obj.shadow.mapSize.height=k.shadowHeight.getValue(),k.obj.updateShadowMap())});this.form.add(this.shadowHeight);this.form.nextRow();for(b=0;13>b;b++)h=Math.pow(2,b),this.shadowWidth.addValue(h.toString(),h),this.shadowHeight.addValue(h.toString(),h);this.form.addText("Near");this.shadowNear=new NumberBox(this.form.element);this.shadowNear.size.set(60,18);this.shadowNear.setStep(.1);this.shadowNear.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.camera.near=k.shadowNear.getValue(),k.obj.updateShadowMap())});
this.form.add(this.shadowNear);this.form.nextRow();this.form.addText("Far");this.shadowFar=new NumberBox(this.form.element);this.shadowFar.size.set(60,18);this.shadowFar.setStep(.1);this.shadowFar.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.camera.far=k.shadowFar.getValue(),k.obj.updateShadowMap())});this.form.add(this.shadowFar);this.form.nextRow();this.obj instanceof DirectionalLight&&(this.form.addText("Left"),this.shadowLeft=new NumberBox(this.form.element),this.shadowLeft.size.set(60,18),this.shadowLeft.setStep(.1),
this.shadowLeft.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.camera.left=k.shadowLeft.getValue(),k.obj.updateShadowMap())}),this.form.add(this.shadowLeft),this.form.nextRow(),this.form.addText("Right"),this.shadowRight=new NumberBox(this.form.element),this.shadowRight.size.set(60,18),this.shadowRight.setStep(.1),this.shadowRight.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.camera.right=k.shadowRight.getValue(),k.obj.updateShadowMap())}),this.form.add(this.shadowRight),this.form.nextRow(),this.form.addText("Top"),
this.shadowTop=new NumberBox(this.form.element),this.shadowTop.size.set(60,18),this.shadowTop.setStep(.1),this.shadowTop.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.camera.top=k.shadowTop.getValue(),k.obj.updateShadowMap())}),this.form.add(this.shadowTop),this.form.nextRow(),this.form.addText("Bottom"),this.shadowBottom=new NumberBox(this.form.element),this.shadowBottom.size.set(60,18),this.shadowBottom.setStep(.1),this.shadowBottom.setOnChange(()=>{null!==k.obj&&(k.obj.shadow.camera.bottom=k.shadowBottom.getValue(),
k.obj.updateShadowMap())}),this.form.add(this.shadowBottom),this.form.nextRow())}else this.obj instanceof RectAreaLight&&(this.form.addText("Intensity"),this.intensity=new Slider(this.form.element),this.intensity.size.set(160,18),this.intensity.setStep(.1),this.intensity.setRange(0,500),this.intensity.setOnChange(()=>{null!==k.obj&&(k.obj.intensity=k.intensity.getValue())}),this.form.add(this.intensity),this.form.nextRow(),this.form.addText("Width"),this.width=new NumberBox(this.form.element),this.width.size.set(60,
18),this.width.setStep(.1),this.width.setOnChange(()=>{null!==k.obj&&(k.obj.width=k.width.getValue())}),this.form.add(this.width),this.form.addText("Height"),this.height=new NumberBox(this.form.element),this.height.size.set(60,18),this.height.setStep(.1),this.height.setOnChange(()=>{null!==k.obj&&(k.obj.height=k.height.getValue())}),this.form.add(this.height),this.form.nextRow());this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();
return this.element};
LightComponent.prototype.updateData=function(){this.colour.setValue(this.obj.color.r,this.obj.color.g,this.obj.color.b);this.obj instanceof HemisphereLight&&this.groundCol.setValue(this.obj.groundColor.r,this.obj.groundColor.g,this.obj.groundColor.b);this.obj instanceof PointLight&&(this.distance.setValue(this.obj.distance),this.intensity.setValue(this.obj.intensity));this.obj instanceof SpotLight&&(this.angle.setValue(this.obj.angle),this.penumbra.setValue(this.obj.penumbra));if(this.obj instanceof
DirectionalLight||this.obj instanceof PointLight||this.obj instanceof SpotLight)this.castShadow.setValue(this.obj.castShadow),this.shadowWidth.setValue(this.obj.shadow.mapSize.width),this.shadowHeight.setValue(this.obj.shadow.mapSize.height),this.shadowNear.setValue(this.obj.shadow.camera.near),this.shadowFar.setValue(this.obj.shadow.camera.far);this.obj instanceof DirectionalLight&&(this.shadowLeft.setValue(this.obj.shadow.camera.left),this.shadowRight.setValue(this.obj.shadow.camera.right),this.shadowTop.setValue(this.obj.shadow.camera.top),
this.shadowBottom.setValue(this.obj.shadow.camera.bottom));this.obj instanceof RectAreaLight&&(this.width.setValue(this.obj.width),this.height.setValue(this.obj.height),this.intensity.setValue(this.obj.intensity))};
LightComponent.prototype.onReset=function(){this.obj.color.setRGB(this.values.colour[0],this.values.colour[1],this.values.colour[2]);if(this.obj instanceof DirectionalLight||this.obj instanceof PointLight)this.obj.castShadow=this.values.castShadow,this.obj.intensity=this.values.intensity;this.obj instanceof HemisphereLight&&this.obj.groundColor.setRGB(this.values.groundCol[0],this.values.groundCol[1],this.values.groundCol[2]);this.obj instanceof PointLight&&(this.obj.distance=this.values.distance,
this.obj.shadow.mapSize.width=this.values.shadowWidth,this.obj.shadow.mapSize.height=this.values.shadowHeight,this.obj.shadow.camera.near=this.values.shadowNear,this.obj.shadow.camera.far=this.values.shadowFar,this.obj.updateShadowMap());this.obj instanceof SpotLight&&(this.obj.penumbra=this.values.penumbra,this.obj.angle=this.values.angle);this.obj instanceof RectAreaLight&&(this.obj.width=this.values.rectWidth,this.obj.height=this.values.rectHeight,this.obj.intensity=this.values.intensity);Editor.updateObjectViews();
this.updateData()};function SkyComponent(){Component.call(this);this.componentName="Sky";this.className="SkyComponent";this.values={autoUpdate:!1,duration:240,time:150,distance:500,shadows:!0,width:512,height:512,near:.5,far:1E4,left:-10,right:10,top:10,bottom:-10}}SkyComponent.prototype=Object.create(Component.prototype);
SkyComponent.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;var k=this;this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();this.form.addText("Auto Update");this.autoUpdate=new CheckBox(this.form.element);this.autoUpdate.size.set(20,15);this.autoUpdate.setOnChange(()=>{null!==k.obj&&(k.obj.autoUpdate=k.autoUpdate.getValue())});this.form.add(this.autoUpdate);this.form.nextRow();this.form.addText("Day duration");
this.dayTime=new NumberBox(this.form.element);this.dayTime.size.set(60,18);this.dayTime.setStep(.1);this.dayTime.setOnChange(()=>{if(null!==k.obj){var e=k.dayTime.getValue();0>e&&(e=0,k.dayTime.setValue(e));k.obj.dayTime=e;k.obj.dayTime>e&&(k.obj.time=e,k.time.setValue(e));k.time.setRange(0,e);k.obj.updateSky()}});this.form.add(this.dayTime);this.form.addText("s");this.form.nextRow();this.form.addText("Time");this.time=new NumberBox(this.form.element);this.time.size.set(100,18);this.time.setStep(.1);
this.time.setOnChange(()=>{if(null!==k.obj){var e=k.time.getValue();0>e?(e=0,k.time.setValue(e)):e>k.obj.dayTime&&(e=k.obj.dayTime,k.time.setValue(e));k.obj.time=e;k.obj.updateSky()}});this.form.add(this.time);this.form.addText("s");this.form.nextRow();this.form.addText("Sun distance");this.sunDistance=new NumberBox(this.form.element);this.sunDistance.size.set(80,18);this.sunDistance.setStep(10);this.sunDistance.setOnChange(()=>{null!==k.obj&&(k.obj.sunDistance=k.sunDistance.getValue(),k.obj.updateSky())});
this.form.add(this.sunDistance);this.form.nextRow();this.form.addText("Shadows");this.form.nextRow();this.form.addText("Cast shadows");this.castShadow=new CheckBox(this.form.element);this.castShadow.size.set(20,15);this.castShadow.position.set(5,85);this.castShadow.updateInterface();this.castShadow.setOnChange(()=>{null!==k.obj&&(k.obj.sun.castShadow=k.castShadow.getValue())});this.form.add(this.castShadow);this.form.nextRow();this.form.addText("Resolution");this.shadowWidth=new DropdownList(this.form.element);
this.shadowWidth.size.set(60,18);this.shadowWidth.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.mapSize.width=k.shadowWidth.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowWidth);this.form.addText("x",!0);this.shadowHeight=new DropdownList(this.form.element);this.shadowHeight.size.set(60,18);this.shadowHeight.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.mapSize.height=k.shadowHeight.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowHeight);this.form.nextRow();
for(b=0;13>b;b++)h=Math.pow(2,b),this.shadowWidth.addValue(h.toString(),h),this.shadowHeight.addValue(h.toString(),h);this.form.addText("Near");this.shadowNear=new NumberBox(this.form.element);this.shadowNear.size.set(60,18);this.shadowNear.setStep(.1);this.shadowNear.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.camera.near=k.shadowNear.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowNear);this.form.nextRow();this.form.addText("Far");this.shadowFar=new NumberBox(this.form.element);
this.shadowFar.size.set(60,18);this.shadowFar.setStep(.1);this.shadowFar.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.camera.far=k.shadowFar.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowFar);this.form.nextRow();this.form.addText("Left");this.shadowLeft=new NumberBox(this.form.element);this.shadowLeft.size.set(60,18);this.shadowLeft.setStep(.1);this.shadowLeft.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.camera.left=k.shadowLeft.getValue(),k.obj.sun.updateShadowMap())});
this.form.add(this.shadowLeft);this.form.nextRow();this.form.addText("Right");this.shadowRight=new NumberBox(this.form.element);this.shadowRight.size.set(60,18);this.shadowRight.setStep(.1);this.shadowRight.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.camera.right=k.shadowRight.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowRight);this.form.nextRow();this.form.addText("Top");this.shadowTop=new NumberBox(this.form.element);this.shadowTop.size.set(60,18);this.shadowTop.setStep(.1);
this.shadowTop.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.camera.top=k.shadowTop.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowTop);this.form.nextRow();this.form.addText("Bottom");this.shadowBottom=new NumberBox(this.form.element);this.shadowBottom.size.set(60,18);this.shadowBottom.setStep(.1);this.shadowBottom.setOnChange(()=>{null!==k.obj&&(k.obj.sun.shadow.camera.bottom=k.shadowBottom.getValue(),k.obj.sun.updateShadowMap())});this.form.add(this.shadowBottom);this.form.nextRow();
this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addResetButton();return this.element};
SkyComponent.prototype.updateData=function(){this.autoUpdate.setValue(this.obj.autoUpdate);this.dayTime.setValue(this.obj.dayTime);this.time.setValue(this.obj.time);this.sunDistance.setValue(this.obj.sunDistance);this.castShadow.setValue(this.obj.sun.castShadow);this.shadowWidth.setValue(this.obj.sun.shadow.mapSize.width);this.shadowHeight.setValue(this.obj.sun.shadow.mapSize.height);this.shadowNear.setValue(this.obj.sun.shadow.camera.near);this.shadowFar.setValue(this.obj.sun.shadow.camera.far);
this.shadowLeft.setValue(this.obj.sun.shadow.camera.left);this.shadowRight.setValue(this.obj.sun.shadow.camera.right);this.shadowTop.setValue(this.obj.sun.shadow.camera.top);this.shadowBottom.setValue(this.obj.sun.shadow.camera.bottom)};
SkyComponent.prototype.onReset=function(){this.obj.autoUpdate=this.values.autoUpdate;this.obj.dayTime=this.values.duration;this.obj.time=this.values.time;this.obj.sunDistance=this.values.distance;this.obj.sun.castShadow=this.values.shadows;this.obj.sun.shadow.mapSize.width=this.values.width;this.obj.sun.shadow.mapSize.height=this.values.height;this.obj.sun.shadow.camera.near=this.values.near;this.obj.sun.shadow.camera.far=this.values.far;this.obj.sun.shadow.camera.left=this.values.left;this.obj.sun.shadow.camera.right=
this.values.right;this.obj.sun.shadow.camera.top=this.values.top;this.obj.sun.shadow.camera.bottom=this.values.bottom;this.updateData();this.obj.updateSky();Editor.updateObjectViews()};function GeometryForm(){Component.call(this);this.componentName="Geometry Form";this.className="GeometryForm"}GeometryForm.prototype=Object.create(Component.prototype);
GeometryForm.prototype.initUI=function(b,h){this.clearElement();this.widgetsPos=b;h=this.obj=h;this.form=new Form(this.element);this.form.spacing.set(5,5);this.form.addText(this.componentName);this.form.nextRow();h instanceof THREE.Mesh?(b=h.geometry,b instanceof THREE.BoxGeometry||b instanceof THREE.BoxBufferGeometry?new BoxGeometryComponent(this.form,this.obj):b instanceof THREE.ConeGeometry||b instanceof THREE.ConeBufferGeometry?new ConeGeometryComponent(this.form,this.obj):b instanceof THREE.PlaneGeometry||
b instanceof THREE.PlaneBufferGeometry?new PlaneGeometryComponent(this.form,this.obj):b instanceof THREE.SphereGeometry||b instanceof THREE.SphereBufferGeometry?new SphereGeometryComponent(this.form,this.obj):b instanceof THREE.TorusGeometry||b instanceof THREE.TorusBufferGeometry?new TorusGeometryComponent(this.form,this.obj):b instanceof THREE.CylinderGeometry||b instanceof THREE.CylinderBufferGeometry?new CylinderGeometryComponent(this.form,this.obj):(b instanceof THREE.TetrahedronGeometry||b instanceof
THREE.TetrahedronBufferGeometry)&&new TetrahedronGeometryComponent(this.form,this.obj)):(this.form.addText("This component can only be added in Meshes"),this.form.nextRow());this.form.position.copy(this.widgetsPos);this.form.updateInterface();this.widgetsPos.y+=this.form.size.y;this.addDeleteButton();return this.element};GeometryForm.prototype.updateData=function(){};GeometryForm.prototype.onReset=function(){};
function BoxGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Box Geometry");this.form.nextRow();this.form.addText("Size");this.form.addText("X",!0);this.width=new NumberBox(this.form.element);this.width.size.set(40,18);this.width.setStep(.1);this.width.setOnChange(b);this.form.add(this.width);this.form.addText("Y",!0);this.height=new NumberBox(this.form.element);this.height.size.set(40,18);this.height.setStep(.1);this.height.setOnChange(b);
this.form.add(this.height);this.form.addText("Z",!0);this.depth=new NumberBox(this.form.element);this.depth.size.set(40,18);this.depth.setStep(.1);this.depth.setOnChange(b);this.form.add(this.depth);this.form.nextRow();this.form.addText("Segments");this.form.addText("X",!0);this.widthSegments=new NumberBox(this.form.element);this.widthSegments.size.set(40,18);this.widthSegments.setStep(1);this.widthSegments.setOnChange(b);this.form.add(this.widthSegments);this.form.addText("Y",!0);this.heightSegments=
new NumberBox(this.form.element);this.heightSegments.size.set(40,18);this.heightSegments.setStep(1);this.heightSegments.setOnChange(b);this.form.add(this.heightSegments);this.form.addText("Z",!0);this.depthSegments=new NumberBox(this.form.element);this.depthSegments.size.set(40,18);this.depthSegments.setStep(1);this.depthSegments.setOnChange(b);this.form.add(this.depthSegments);this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);
this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();this.updateValues()}
BoxGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new BoxBufferGeometry(this.width.getValue(),this.height.getValue(),this.depth.getValue(),this.widthSegments.getValue(),this.heightSegments.getValue(),this.depthSegments.getValue()):this.obj.geometry=new BoxGeometry(this.width.getValue(),this.height.getValue(),this.depth.getValue(),this.widthSegments.getValue(),this.heightSegments.getValue(),this.depthSegments.getValue())};
BoxGeometryComponent.prototype.updateValues=function(){this.width.setValue(this.obj.geometry.parameters.width||1);this.height.setValue(this.obj.geometry.parameters.height||1);this.depth.setValue(this.obj.geometry.parameters.depth||1);this.widthSegments.setValue(this.obj.geometry.parameters.widthSegments||1);this.heightSegments.setValue(this.obj.geometry.parameters.heightSegments||1);this.depthSegments.setValue(this.obj.geometry.parameters.depthSegments||1);this.buffer.setValue(this.obj.geometry instanceof
THREE.BufferGeometry)};
function ConeGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Cone Geometry");this.form.nextRow();this.form.addText("Radius");this.radius=new NumberBox(this.form.element);this.radius.size.set(40,18);this.radius.setStep(.1);this.radius.setOnChange(b);this.form.add(this.radius);this.form.nextRow();this.form.addText("Height");this.height=new NumberBox(this.form.element);this.height.size.set(40,18);this.height.setStep(.1);this.height.setOnChange(b);
this.form.add(this.height);this.form.nextRow();this.form.addText("Segments");this.form.addText("Radial",!0);this.radialSegments=new NumberBox(this.form.element);this.radialSegments.size.set(40,18);this.radialSegments.setStep(1);this.radialSegments.setOnChange(b);this.form.add(this.radialSegments);this.form.addText("Height",!0);this.heightSegments=new NumberBox(this.form.element);this.heightSegments.size.set(40,18);this.heightSegments.setStep(1);this.heightSegments.setOnChange(b);this.form.add(this.heightSegments);
this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();this.updateValues()}
ConeGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new ConeBufferGeometry(this.radius.getValue(),this.height.getValue(),this.radialSegments.getValue(),this.heightSegments.getValue()):this.obj.geometry=new ConeGeometry(this.radius.getValue(),this.height.getValue(),this.radialSegments.getValue(),this.heightSegments.getValue())};
ConeGeometryComponent.prototype.updateValues=function(){this.radius.setValue(this.obj.geometry.parameters.radius||20);this.height.setValue(this.obj.geometry.parameters.height||100);this.radialSegments.setValue(this.obj.geometry.parameters.radialSegments||8);this.heightSegments.setValue(this.obj.geometry.parameters.heightSegments||1);this.buffer.setValue(this.obj.geometry instanceof THREE.BufferGeometry)};
function PlaneGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Plane Geometry");this.form.nextRow();this.form.addText("Size");this.form.addText("W",!0);this.width=new NumberBox(this.form.element);this.width.size.set(40,18);this.width.setStep(.1);this.width.setOnChange(b);this.form.add(this.width);this.form.addText("H",!0);this.height=new NumberBox(this.form.element);this.height.size.set(40,18);this.height.setStep(.1);this.height.setOnChange(b);
this.form.add(this.height);this.form.nextRow();this.form.addText("Segments");this.form.addText("W",!0);this.widthSegments=new NumberBox(this.form.element);this.widthSegments.size.set(40,18);this.widthSegments.setStep(1);this.widthSegments.setOnChange(b);this.form.add(this.widthSegments);this.form.addText("H",!0);this.heightSegments=new NumberBox(this.form.element);this.heightSegments.size.set(40,18);this.heightSegments.setStep(1);this.heightSegments.setOnChange(b);this.form.add(this.heightSegments);
this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();this.updateValues()}
PlaneGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new PlaneBufferGeometry(this.width.getValue(),this.height.getValue(),this.widthSegments.getValue(),this.heightSegments.getValue()):this.obj.geometry=new PlaneGeometry(this.width.getValue(),this.height.getValue(),this.widthSegments.getValue(),this.heightSegments.getValue())};
PlaneGeometryComponent.prototype.updateValues=function(){this.width.setValue(this.obj.geometry.parameters.width||1);this.height.setValue(this.obj.geometry.parameters.height||1);this.widthSegments.setValue(this.obj.geometry.parameters.widthSegments||1);this.heightSegments.setValue(this.obj.geometry.parameters.heightSegments||1);this.buffer.setValue(this.obj.geometry instanceof THREE.BufferGeometry)};
function SphereGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Sphere Geometry");this.form.nextRow();this.form.addText("Radius");this.radius=new NumberBox(this.form.element);this.radius.size.set(40,18);this.radius.setStep(.1);this.radius.setOnChange(b);this.form.add(this.radius);this.form.nextRow();this.form.addText("Segments");this.form.addText("Width",!0);this.widthSegments=new NumberBox(this.form.element);this.widthSegments.size.set(40,
18);this.widthSegments.setStep(1);this.widthSegments.setOnChange(b);this.form.add(this.widthSegments);this.form.addText("Height",!0);this.heightSegments=new NumberBox(this.form.element);this.heightSegments.size.set(40,18);this.heightSegments.setStep(1);this.heightSegments.setOnChange(b);this.form.add(this.heightSegments);this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();
this.updateValues()}SphereGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new SphereBufferGeometry(this.radius.getValue(),this.widthSegments.getValue(),this.heightSegments.getValue()):this.obj.geometry=new SphereGeometry(this.radius.getValue(),this.widthSegments.getValue(),this.heightSegments.getValue())};
SphereGeometryComponent.prototype.updateValues=function(){this.radius.setValue(this.obj.geometry.parameters.radius||50);this.widthSegments.setValue(this.obj.geometry.parameters.widthSegments||8);this.heightSegments.setValue(this.obj.geometry.parameters.heightSegments||6);this.buffer.setValue(this.obj.geometry instanceof THREE.BufferGeometry)};
function TorusGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Torus Geometry");this.form.nextRow();this.form.addText("Radius");this.radius=new NumberBox(this.form.element);this.radius.size.set(40,18);this.radius.setStep(.1);this.radius.setOnChange(b);this.form.add(this.radius);this.form.nextRow();this.form.addText("Tube");this.tube=new NumberBox(this.form.element);this.tube.size.set(40,18);this.tube.setStep(.1);this.tube.setOnChange(b);
this.form.add(this.tube);this.form.nextRow();this.form.addText("Segments");this.form.nextRow();this.form.addText("Radial");this.radialSegments=new NumberBox(this.form.element);this.radialSegments.size.set(60,18);this.radialSegments.setStep(1);this.radialSegments.setOnChange(b);this.form.add(this.radialSegments);this.form.nextRow();this.form.addText("Tubular");this.tubularSegments=new NumberBox(this.form.element);this.tubularSegments.size.set(60,18);this.tubularSegments.setStep(1);this.tubularSegments.setOnChange(b);
this.form.add(this.tubularSegments);this.form.nextRow();this.form.addText("Arc");this.arc=new NumberBox(this.form.element);this.arc.size.set(60,18);this.arc.setStep(.1);this.arc.setRange(0,2*Math.PI);this.arc.setOnChange(b);this.form.add(this.arc);this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();this.updateValues()}
TorusGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new TorusBufferGeometry(this.radius.getValue(),this.tube.getValue(),this.radialSegments.getValue(),this.tubularSegments.getValue(),this.arc.getValue()):this.obj.geometry=new TorusGeometry(this.radius.getValue(),this.tube.getValue(),this.radialSegments.getValue(),this.tubularSegments.getValue(),this.arc.getValue())};
TorusGeometryComponent.prototype.updateValues=function(){this.radius.setValue(this.obj.geometry.parameters.radius||100);this.tube.setValue(this.obj.geometry.parameters.tube||40);this.radialSegments.setValue(this.obj.geometry.parameters.radialSegments||8);this.tubularSegments.setValue(this.obj.geometry.parameters.tubularSegments||6);this.arc.setValue(this.obj.geometry.parameters.arc||2*Math.PI);this.buffer.setValue(this.obj.geometry instanceof THREE.BufferGeometry)};
function CylinderGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Cylinder Geometry");this.form.nextRow();this.form.addText("Radius");this.form.addText("Top",!0);this.radiusTop=new NumberBox(this.form.element);this.radiusTop.size.set(40,18);this.radiusTop.setStep(.1);this.radiusTop.setOnChange(b);this.form.add(this.radiusTop);this.form.addText("Bottom",!0);this.radiusBottom=new NumberBox(this.form.element);this.radiusBottom.size.set(40,18);
this.radiusBottom.setStep(.1);this.radiusBottom.setOnChange(b);this.form.add(this.radiusBottom);this.form.nextRow();this.form.addText("Height");this.height=new NumberBox(this.form.element);this.height.size.set(40,18);this.height.setStep(.1);this.height.setOnChange(b);this.form.add(this.height);this.form.nextRow();this.form.addText("Segments");this.form.addText("Radial",!0);this.radialSegments=new NumberBox(this.form.element);this.radialSegments.size.set(40,18);this.radialSegments.setStep(1);this.radialSegments.setOnChange(b);
this.form.add(this.radialSegments);this.form.addText("Height",!0);this.heightSegments=new NumberBox(this.form.element);this.heightSegments.size.set(40,18);this.heightSegments.setStep(1);this.heightSegments.setOnChange(b);this.form.add(this.heightSegments);this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();this.updateValues()}
CylinderGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new CylinderBufferGeometry(this.radiusTop.getValue(),this.radiusBottom.getValue(),this.height.getValue(),this.radialSegments.getValue(),this.heightSegments.getValue()):this.obj.geometry=new CylinderGeometry(this.radiusTop.getValue(),this.radiusBottom.getValue(),this.height.getValue(),this.radialSegments.getValue(),this.heightSegments.getValue())};
CylinderGeometryComponent.prototype.updateValues=function(){this.radiusTop.setValue(this.obj.geometry.parameters.radiusTop||20);this.radiusBottom.setValue(this.obj.geometry.parameters.radiusBottom||20);this.height.setValue(this.obj.geometry.parameters.height||100);this.radialSegments.setValue(this.obj.geometry.parameters.radialSegments||8);this.heightSegments.setValue(this.obj.geometry.parameters.heightSegments||1);this.buffer.setValue(this.obj.geometry instanceof THREE.BufferGeometry)};
function TetrahedronGeometryComponent(b,h){this.form=b;this.obj=h;var k=this;b=function(){k.updateGeometry()};this.form.addText("Tetrahedron Geometry");this.form.nextRow();this.form.addText("Radius");this.radius=new NumberBox(this.form.element);this.radius.size.set(40,18);this.radius.setStep(.1);this.radius.setRange(0,Number.MAX_SAFE_INTEGER);this.radius.setOnChange(b);this.form.add(this.radius);this.form.nextRow();this.form.addText("Detail");this.detail=new Slider(this.form.element);this.detail.size.set(90,
18);this.detail.setRange(1,7);this.detail.setStep(1);this.detail.setOnChange(b);this.form.add(this.detail);this.form.nextRow();this.buffer=new CheckBox(this.form.element);this.form.addText("Buffered");this.buffer.size.set(20,15);this.buffer.setOnChange(b);this.form.add(this.buffer);this.form.nextRow();this.updateValues()}
TetrahedronGeometryComponent.prototype.updateGeometry=function(){this.obj.geometry.dispose();this.buffer.getValue()?this.obj.geometry=new TetrahedronBufferGeometry(this.radius.getValue(),this.detail.getValue()):this.obj.geometry=new TetrahedronGeometry(this.radius.getValue(),this.detail.getValue())};
TetrahedronGeometryComponent.prototype.updateValues=function(){this.radius.setValue(this.obj.geometry.parameters.radius||2);this.detail.setValue(this.obj.geometry.parameters.detail||1);this.buffer.setValue(this.obj.geometry instanceof THREE.BufferGeometry)};THREE.Object3D.prototype.folded=!1;THREE.Object3D.prototype.components=[];THREE.Object3D.prototype.defaultComponents=[];
0===THREE.Object3D.prototype.defaultComponents.length&&(THREE.Object3D.prototype.defaultComponents.push(new ElementComponent),THREE.Object3D.prototype.defaultComponents.push(new ObjectComponent));THREE.Object3D.prototype.hidden=!1;THREE.Object3D.prototype.initialize=function(){for(var b=0;b<this.children.length;b++)this.children[b].initialize()};THREE.Object3D.prototype.update=function(){for(var b=0;b<this.children.length;b++)this.children[b].update()};
THREE.Object3D.prototype.dispose=function(){for(var b=0;b<this.children.length;b++)this.children[b].dispose()};THREE.Object3D.prototype.removeAll=function(){for(var b=this.children.length-1;-1<b;b--)this.remove(this.children[b])};THREE.Object3D.prototype.destroy=function(){for(;0<this.children.length;)this.children[0].destroy();null!==this.parent&&(this.dispose&&this.dispose(),this.parent.remove(this))};
THREE.Object3D.prototype.toJSON=function(b,h,k){function e(t){var r=[],y;for(y in t){var z=t[y];delete z.metadata;r.push(z)}return r}var p=void 0===b,q={};p&&(b={fonts:{},videos:{},images:{},audio:{},geometries:{},materials:{},textures:{},assetObjects:{}},q.metadata={version:GORLOT.VERSION,type:"GorlotProgram"});var l={};l.uuid=this.uuid;l.type=this.type;l.name=this.name;l.folded=this.folded;l.hidden=this.hidden;l.castShadow=this.castShadow;l.receiveShadow=this.receiveShadow;l.visible=this.visible;
l.matrixAutoUpdate=this.matrixAutoUpdate;l.matrix=this.matrix.toArray();void 0!==this.components&&(l.components=this.components);"{}"!==JSON.stringify(this.userData)&&(l.userData=this.userData);void 0!==this.geometry&&(void 0===b.geometries[this.geometry.uuid]&&(b.geometries[this.geometry.uuid]=this.geometry.toJSON(b)),l.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===b.materials[this.material.uuid]&&(b.materials[this.material.uuid]=this.material.toJSON(b)),l.material=this.material.uuid);
void 0!==h&&h(b,l);if(!1!==k&&0<this.children.length)for(l.children=[],h=0;h<this.children.length;h++)(this.children[h]instanceof BlockScript||!this.children[h].hidden)&&l.children.push(this.children[h].toJSON(b).object);p&&(q.geometries=e(b.geometries),q.materials=e(b.materials),q.textures=e(b.textures),q.images=e(b.images),q.videos=e(b.videos),q.audio=e(b.audio),q.fonts=e(b.fonts),q.assetObjects=e(b.assetObjects));q.object=l;return q};
THREE.Vector3.fromJSON=function(b){return new THREE.Vector3(b.x,b.y,b.z)};THREE.Vector3.prototype.toJSON=function(){return{x:this.x,y:this.y,z:this.z}};THREE.Vector2.fromJSON=function(b){return new THREE.Vector2(b.x,b.y)};THREE.Vector2.prototype.toJSON=function(){return{x:this.x,y:this.y}};
THREE.Texture.prototype.toJSON=function(b){if(void 0!==b.textures[this.uuid])return b.textures[this.uuid];var h={metadata:{version:GORLOT.VERSION,type:"Texture"},uuid:this.uuid,name:this.name,category:this.category,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};return b.textures[this.uuid]=h};
THREE.LightShadow.prototype.toJSON=function(){var b={};b.bias=this.bias;b.radius=this.radius;b.mapSize={};b.mapSize.x=this.mapSize.x;b.mapSize.y=this.mapSize.y;b.camera={};b.camera.top=this.camera.top;b.camera.bottom=this.camera.bottom;b.camera.far=this.camera.far;b.camera.near=this.camera.near;b.camera.left=this.camera.left;b.camera.right=this.camera.right;return b};
THREE.LightShadow.prototype.fromJSON=function(b){void 0!==b.bias&&(this.bias=b.bias);void 0!==b.radius&&(this.radius=b.radius);if(void 0!==b.mapSize){var h=b.mapSize;this.mapSize.set(h.x,h.y)}void 0!==b.camera&&(b=b.camera,this.camera.top=b.top,this.camera.bottom=b.bottom,this.camera.left=b.left,this.camera.right=b.right,this.camera.near=b.near,this.camera.far=b.far)};THREE.Fog.NONE=0;THREE.Fog.LINEAR=1;THREE.Fog.EXPONENTIAL=2;THREE.Material.prototype.nodes={};THREE.Material.prototype.path="/";
THREE.Material.prototype.dispose=function(){function b(h){void 0!==h&&null!==h&&h.dispose()}this.dispatchEvent({type:"dispose"});b(this.map);b(this.bumpMap);b(this.normalMap);b(this.displacementMap);b(this.specularMap);b(this.emissiveMap);b(this.alphaMap);b(this.roughnessMap);b(this.metalnessMap)};THREE.Material.prototype.updateNodes=function(b){void 0!==this.nodes&&(this.nodes=b)};THREE.Material.prototype.setPath=function(b){void 0!==b&&(this.path=b)};THREE.MultiMaterial.prototype.name="material";
THREE.MultiMaterial.prototype.dispose=function(){for(var b in this.materials)this.materials[b].dispose()};function Register(){}Register.registerBlocksNodes=function(){registerBase();registerEvents();registerArray();registerWidgets();registerColour();registerVectorNode();registerObjects();registerHierarchy();registerKeyboardNodes()};Register.registerMaterialNodes=function(){registerMaterialNodes();registerArray();registerWidgets();registerColour();registerUtilsNodes()};
Register.registerParticlesNodes=function(){registerParticlesNodes();registerArray();registerWidgets();registerColour();registerUtilsNodes()};Register.registerTextureNodes=function(){registerTextureNodes();registerVideoTextureNodes();registerVectorNode();registerUtilsNodes()};Register.unregisterAll=function(){LiteGraph.registered_node_types={};LiteGraph.Nodes={}};Register.registerAll=function(){Register.registerBlocksNodes();Register.registerMaterialNodes();Register.registerParticlesNodes();Register.registerTextureNodes()};
function NodesHelper(){}NodesHelper.slots={};NodesHelper.slots.output={};NodesHelper.slots.output.passer={color_on:"#FFC0CB",color_off:"#FFC0CB",shape:LiteGraph.BOX_SHAPE};NodesHelper.getSlotMenuOptions=function(b,h,k){void 0!==b.output&&new LiteGraph.ContextMenu([{title:"Convert to Variable",callback:()=>{var e=LGraphCanvas.active_canvas.graph,p=LiteGraph.createNode("Base/Variable");p.pos=[h.pos[0]+150,h.pos[1]];e.add(p);h.connect(0,p,0);h.connect(b.slot,p,1)}}],{title:b.output.name,event:k})};
function VariableNode(){this.properties={name:"myname",container:VariableNode.LITEGRAPH};this.addInput("",LiteGraph.EVENT);this.addInput("In","");this.name_widget=this.addWidget("string","",this.properties.name,"name");this.name_widget.width=100;this.addOutput("Value","");this.size[0]=130}VariableNode.title="Variable";VariableNode.collapsable=!0;VariableNode.LITEGRAPH=0;VariableNode.GRAPH=1;VariableNode.GLOBALSCOPE=2;
VariableNode["@container"]={type:"enum",values:{litegraph:VariableNode.LITEGRAPH,graph:VariableNode.GRAPH,global:VariableNode.GLOBALSCOPE}};VariableNode.prototype.getContainer=function(){switch(this.properties.container){case VariableNode.GRAPH:return this.graph?this.graph.vars:{};case VariableNode.GLOBALSCOPE:return global;default:return LiteGraph.Globals}};
VariableNode.prototype.onAction=function(b,h){b=this.getContainer();this.isInputConnected(1)?(this.value=this.getInputData(1),b[this.properties.name]=this.value,this.setOutputData(0,this.value)):this.setOutputData(0,b[this.properties.name])};VariableNode.prototype.getTitle=function(){return this.properties.name};function registerBase(){LiteGraph.registerNodeType("Base/Variable",VariableNode)}
function BeginPlayNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT)}BeginPlayNode.title="Begin Play";BeginPlayNode.skip_list=!0;BeginPlayNode.prototype.ignore_remove=!0;BeginPlayNode.prototype.clonable=!1;BeginPlayNode.prototype.getMenuOptions=()=>[];BeginPlayNode.prototype.onStart=function(){this.triggerSlot(0,"BeginPlay");this.triggerSlot(1)};
function EventTickNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.passer);this.addOutput("",LiteGraph.EVENT)}EventTickNode.title="Event Tick";EventTickNode.skip_list=!0;EventTickNode.prototype.ignore_remove=!0;EventTickNode.prototype.clonable=!1;EventTickNode.prototype.getMenuOptions=()=>[];EventTickNode.prototype.onStart=function(){this.triggerSlot(1,"EventTickStarted")};EventTickNode.prototype.onExecute=function(){this.triggerSlot(0,"Tick")};
function OnGameStartNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT)}OnGameStartNode.title="On Game Start";OnGameStartNode.prototype.onStart=function(){this.triggerSlot(0,"GameStart");this.triggerSlot(1)};function OnAppDataNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Data")}OnAppDataNode.title="On Data Received";
OnAppDataNode.prototype.onAppData=function(b){this.setOutputData(2,b);this.triggerSlot(0,b);this.triggerSlot(1)};function EventDestroyedNode(){this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT)}EventDestroyedNode.title="On Destroyed";EventDestroyedNode.prototype.onStart=function(){var b=this.getInputData(0);void 0===b&&(b=this.graph.config.self);var h=this;b.addEventListener("removed",k=>{h.triggerSlot(0,b.uuid);h.triggerSlot(1)})};
function EventDisposeNode(){this.addOutput("",LiteGraph.EVENT)}EventDisposeNode.title="On Dispose";EventDisposeNode.prototype.onDispose=function(){this.triggerSlot(0)};
function EventListenerNode(){this.addProperty("event","event");this.addInput("",LiteGraph.ACTION);this.addInput("Object","object");this.addInput("Data","");this.addInput("Event","string");this.event_widget=this.addWidget("text","",this.properties.event,"event");this.event_widget.width=110;this.addOutput("On Fired",LiteGraph.EVENT)}EventListenerNode.title="Event Listener";EventListenerNode.prototype.onStart=function(){null===this.inputs[0].link&&this.addListener()};
EventListenerNode.prototype.onAction=function(b,h){this.addListener()};EventListenerNode.prototype.addListener=function(){this.object=this.getInputData(1);this.data=this.getInputData(2);this.event=this.getInputData(3);void 0===this.object&&(this.object=this.graph.config.self);void 0===this.data&&(this.data={});void 0===this.event&&(this.event=this.properties.event);if(""!==this.event){var b=this;this.object.addEventListener(this.event,()=>{b.listen()})}};
EventListenerNode.prototype.listen=function(){this.triggerSlot(0,this.data)};EventListenerNode.prototype.onDispose=function(){void 0!==this.object&&this.object.removeEventListener(this.event,this.listen)};function FireEventNode(){this.addProperty("event","event");this.addInput("",LiteGraph.ACTION);this.addInput("Object","object");this.addInput("Event","string");this.event_widget=this.addWidget("text","",this.properties.event,"event");this.event_widget.width=110}FireEventNode.title="Fire Event";
FireEventNode.prototype.onAction=function(b,h){this.object=this.getInputData(1);this.event=this.getInputData(2);void 0===this.object&&(this.object=this.graph.config.self);void 0===this.event&&(this.event=this.properties.event);""!==this.event&&this.object.dispatchEvent({type:this.event})};
function TimeOutEventNode(){this.addProperty("time","100");this.addInput("",LiteGraph.ACTION);this.addInput("Time","number");this.addWidget("text","Time",this.properties.time,"time").width=140;this.addOutput("On TimeOut",LiteGraph.EVENT)}TimeOutEventNode.title="Time Out";TimeOutEventNode.prototype.onStart=function(){null===this.inputs[0].link&&this.addTimeout()};TimeOutEventNode.prototype.onAction=function(b,h){this.addTimeout()};
TimeOutEventNode.prototype.addTimeout=function(){var b=this.getInputData(1);void 0===b&&(b=this.properties.time);var h=this;setTimeout(()=>{h.triggerSlot(0)},parseInt(b))};function PasserEventNode(){this.addOutput("",LiteGraph.EVENT)}PasserEventNode.title="Passer";PasserEventNode.prototype.onGetInputs=function(){return[["Action",LiteGraph.ACTION]]};PasserEventNode.prototype.onAction=function(b,h){this.triggerSlot(0,void 0!==h?h:null)};
function BranchEventNode(){this.addInput("In",LiteGraph.ACTION);this.addInput("Condition","boolean");this.addOutput("True",LiteGraph.EVENT);this.addOutput("False",LiteGraph.EVENT)}BranchEventNode.title="Branch";BranchEventNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0!==b&&this.triggerSlot(!0===b?0:1,void 0!==h?h:null)};function TestEvent(){this.addInput("Event",LiteGraph.ACTION);this.addInput("Input")}TestEvent.title="Test";
TestEvent.prototype.onAction=function(b,h){console.log(b,h);console.log(this.getInputData(1))};
function registerEvents(){LiteGraph.registerNodeType("Events/BeginPlay",BeginPlayNode);LiteGraph.registerNodeType("Events/EventTick",EventTickNode);LiteGraph.registerNodeType("Events/OnGameStart",OnGameStartNode);LiteGraph.registerNodeType("Events/OnAppData",OnAppDataNode);LiteGraph.registerNodeType("Events/EventDestroyed",EventDestroyedNode);LiteGraph.registerNodeType("Events/EventDispose",EventDisposeNode);LiteGraph.registerNodeType("Events/EventListener",EventListenerNode);LiteGraph.registerNodeType("Events/FireEvent",
FireEventNode);LiteGraph.registerNodeType("Events/TimeOut",TimeOutEventNode);LiteGraph.registerNodeType("Events/Passer",PasserEventNode);LiteGraph.registerNodeType("Events/Branch",BranchEventNode);LiteGraph.registerNodeType("Events/TestEvent",TestEvent)}function ArrayNode(){this.addInput("",LiteGraph.EVENT);this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Array","array")}ArrayNode.title="Array";
ArrayNode.prototype.onGetInputs=function(){return[["Item",null]]};ArrayNode.prototype.onExecute=function(){this.isInputConnected(0)||this.setOutputData(2,this.createArray())};ArrayNode.prototype.onAction=function(){var b=this.createArray();this.setOutputData(2,b);this.triggerSlot(0,b);this.triggerSlot(1)};ArrayNode.prototype.createArray=function(){var b=[];if(this.inputs)for(var h=0;h<this.inputs.length;h++){var k=this.getInputData(h);void 0!==k&&b.push(k)}return b};
function ArrayPushNode(){this.addInput("",LiteGraph.EVENT);this.addInput("Array","array");this.addInput("Element","");this.addOutput("",LiteGraph.EVENT)}ArrayPushNode.title="Push";ArrayPushNode.prototype.onAction=function(){void 0!==this.getInputData(2)&&(this.getInputData(1).push(this.getInputData(2)),this.triggerSlot(0))};function registerArray(){LiteGraph.registerNodeType("Lists/Arrays/Array",ArrayNode);LiteGraph.registerNodeType("Lists/Arrays/Push",ArrayPushNode)}
function WidgetFloatNode(){this.properties={value:1};this.addOutput("Value","number");this.addWidget("number","Value",this.properties.value,"value");this.serialize_widgets=!0}WidgetFloatNode.title="Float";WidgetFloatNode.prototype.onStart=function(){void 0!==this.properties.value&&this.setOutputData(0,this.properties.value)};WidgetFloatNode.prototype.onPropertyChanged=function(){this.setOutputData(0,this.properties.value);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function WidgetBoolean(){this.properties={value:!0};this.addOutput("","boolean");this.widget=this.addWidget("toggle","Value",this.properties.value,"value")}WidgetBoolean.title="Boolean";WidgetBoolean.prototype.onStart=function(){void 0!==this.properties.value&&this.setOutputData(0,this.properties.value)};WidgetBoolean.onPropertyChanged=function(){this.setOutputData(0,this.properties.value);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function WidgetString(){this.properties={value:"Hello world!"};this.addOutput("","string");this.widget=this.addWidget("text","Value",this.properties.value,"value")}WidgetString.title="String";WidgetString.prototype.onStart=function(){void 0!==this.properties.value&&this.setOutputData(0,this.properties.value)};WidgetString.prototype.onPropertyChanged=function(){this.setOutputData(0,this.properties.value);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerWidgets(){LiteGraph.registerNodeType("Base/Widgets/Float",WidgetFloatNode);LiteGraph.registerNodeType("Base/Widgets/Boolean",WidgetBoolean);LiteGraph.registerNodeType("Base/Widgets/String",WidgetString)}function ThisNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("This","object")}ThisNode.title="This";ThisNode.collapsable=!0;ThisNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
ThisNode.prototype.onStart=function(){this.setOutputData(2,this.graph.config.self);this.triggerSlot(0,this.graph.config.self);this.triggerSlot(1)};function SceneNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Scene","object")}SceneNode.title="Scene";SceneNode.collapsable=!0;SceneNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SceneNode.prototype.onStart=function(){void 0!==this.graph.config.scene&&(this.setOutputData(2,this.graph.config.scene),this.triggerSlot(0,this.graph.config.scene),this.triggerSlot(1))};function ProgramNode(){this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Program","object")}ProgramNode.title="Program";ProgramNode.collapsable=!0;ProgramNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
ProgramNode.prototype.onStart=function(){void 0!==this.graph.config.program&&(this.setOutputData(2,this.graph.config.program),this.triggerSlot(0,this.graph.config.program),this.triggerSlot(1))};function GetPositionNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Position","vector")}GetPositionNode.title="Get Position";GetPositionNode.collapsable=!0;
GetPositionNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GetPositionNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.position;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetRotationNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Rotation","euler")}GetRotationNode.title="Get Rotation";GetRotationNode.collapsable=!0;GetRotationNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetRotationNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.rotation;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};function GetScaleNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Scale","vector")}GetScaleNode.title="Get Scale";
GetScaleNode.collapsable=!0;GetScaleNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GetScaleNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.scale;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function SetPositionNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addInput("Position","vector");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("New Position","vector")}SetPositionNode.title="Set Position";SetPositionNode.collapsable=!0;SetPositionNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetPositionNode.prototype.onAction=function(b,h){b=this.getInputData(1);var k=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);void 0===k&&void 0!==h&&h instanceof THREE.Vector3&&(k=h);void 0===k&&(k=new THREE.Vector3(0,0,0));b.position.copy(k);this.setOutputData(2,k);this.triggerSlot(0,k);this.triggerSlot(1)};
function SetRotationNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addInput("Rotation","euler");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("New Rotation","euler")}SetRotationNode.title="Set Rotation";SetRotationNode.collapsable=!0;SetRotationNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetRotationNode.prototype.onAction=function(b,h){b=this.getInputData(1);var k=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);void 0===k&&void 0!==h&&h instanceof THREE.Euler&&(k=h);void 0===k&&(k=new THREE.Euler(0,0,0,"XYZ"));b.rotation.copy(k);this.setOutputData(2,k);this.triggerSlot(0,k);this.triggerSlot(1)};
function SetScaleNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addInput("Scale","vector");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("New Scale","vector")}SetScaleNode.title="Set Scale";SetScaleNode.collapsable=!0;SetScaleNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
SetScaleNode.prototype.onAction=function(b,h){b=this.getInputData(1);var k=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);void 0===k&&void 0!==h&&h instanceof THREE.Vector3&&(k=h);void 0===k&&(k=new THREE.Vector3(1,1,1));b.scale.copy(k);this.setOutputData(2,k);this.triggerSlot(0,k);this.triggerSlot(1)};
function registerObjects(){LiteGraph.registerNodeType("Elements/This",ThisNode);LiteGraph.registerNodeType("Elements/Scene",SceneNode);LiteGraph.registerNodeType("Elements/Program",ProgramNode);LiteGraph.registerNodeType("Elements/Objects/GetPosition",GetPositionNode);LiteGraph.registerNodeType("Elements/Objects/GetRotation",GetRotationNode);LiteGraph.registerNodeType("Elements/Objects/GetScale",GetScaleNode);LiteGraph.registerNodeType("Elements/Objects/SetPosition",SetPositionNode);LiteGraph.registerNodeType("Elements/Objects/SetRotation",
SetRotationNode);LiteGraph.registerNodeType("Elements/Objects/SetScale",SetScaleNode)}function GetAllChildrenNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Children","array")}GetAllChildrenNode.title="Get All Children";GetAllChildrenNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetAllChildrenNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.children;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetChildByNameNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addInput("Name","string");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Child","object");this.addProperty("name","");this.name_widget=this.addWidget("text","","","name");this.name_widget.width=120}GetChildByNameNode.title="Get Child By Name";GetChildByNameNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetChildByNameNode.prototype.onAction=function(b,h){b=this.getInputData(1);var k=this.getInputData(2);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===k&&void 0!==h&&h instanceof String&&(k=h);void 0===b&&(b=this.graph.config.self);void 0===k&&(k=this.properties.name);h=b.getObjectByName(k);this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function GetParentNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Parent","object")}GetParentNode.title="Get Parent";GetParentNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
GetParentNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.parent;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};function IsChildNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Target","object");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Is Child?","bool")}IsChildNode.title="Is Child";
IsChildNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;IsChildNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Object3D&&(b=h);void 0===b&&(b=this.graph.config.self);h=b.parent instanceof THREE.Scene?!1:!0;this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};
function registerHierarchy(){LiteGraph.registerNodeType("Hierarchy/GetAllChildNode",GetAllChildrenNode);LiteGraph.registerNodeType("Hierarchy/GetChildByName",GetChildByNameNode);LiteGraph.registerNodeType("Hierarchy/GetParent",GetParentNode);LiteGraph.registerNodeType("Hierarchy/IsChild",IsChildNode)}function ButtonNode(){this.addOutput("",LiteGraph.EVENT);this.clicked=!1;this.size=[164,84]}ButtonNode.title="Button";ButtonNode.font="Arial";
ButtonNode.prototype.onDrawForeground=function(b){this.flags.collapsed||(b.fillStyle="black",b.fillRect(11,11,this.size[0]-20,this.size[1]-20),b.fillStyle="#AAF",b.fillRect(9,9,this.size[0]-20,this.size[1]-20),b.fillStyle=this.clicked?"white":this.mouseOver?"#668":"#334",b.fillRect(10,10,this.size[0]-20,this.size[1]-20),b.textAlign="center",b.fillStyle=this.clicked?"black":"white",b.font="30px Arial",b.fillText("Button",.5*this.size[0],.5*this.size[1]+9),b.textAlign="left")};
ButtonNode.prototype.onMouseDown=function(b,h){if(1<h[0]&&1<h[1]&&h[0]<this.size[0]-2&&h[1]<this.size[1]-2)return this.clicked=!0,this.triggerSlot(0),!0};ButtonNode.prototype.onMouseUp=function(){this.clicked=!1};function registerUtilsNodes(){LiteGraph.registerNodeType("Utils/Button",ButtonNode)}
function ColourNode(){this.properties={r:0,g:0,b:0};this.addWidget("number","R",this.properties.r,"r");this.addWidget("number","G",this.properties.g,"g");this.addWidget("number","B",this.properties.b,"b");this.addOutput("Colour","color")}ColourNode.title="Colour";ColourNode.prototype.onStart=function(){this.setOutputData(0,new THREE.Color(this.properties.r,this.properties.g,this.properties.b))};
ColourNode.prototype.onPropertyChanged=function(){this.setOutputData(0,new THREE.Color(this.properties.r,this.properties.g,this.properties.b));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function registerColour(){LiteGraph.registerNodeType("Math/Colour/Colour",ColourNode)}
function VectorNode(){this.addInput("",LiteGraph.ACTION);this.addInput("X","number");this.addInput("Y","number");this.addInput("Z","number");this.properties={x:0,y:0,z:0};this.addWidget("number","X",this.properties.x,"x");this.addWidget("number","Y",this.properties.y,"y");this.addWidget("number","Z",this.properties.z,"z");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Vector","vector")}VectorNode.title="Vector";
VectorNode.collapsable=!0;VectorNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VectorNode.prototype.onAction=function(){this.createVector()};VectorNode.prototype.onStart=function(){this.isInputConnected(0)||this.createVector()};VectorNode.prototype.onPropertyChanged=function(){this.isInputConnected(0)||this.createVector()};
VectorNode.prototype.createVector=function(){var b=this.getInputData(1),h=this.getInputData(2),k=this.getInputData(3);void 0===b&&(b=this.properties.x);void 0===h&&(h=this.properties.y);void 0===k&&(k=this.properties.z);b=new THREE.Vector3(b,h,k);this.setOutputData(2,b);this.triggerSlot(0,b);this.triggerSlot(1)};
function VectorThreeToTwoNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Vector","vector");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Vector","vector")}VectorThreeToTwoNode.title="Vector3 To Vector2";VectorThreeToTwoNode.collapsable=!0;VectorThreeToTwoNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;
VectorThreeToTwoNode.prototype.onAction=function(b,h){b=this.getInputData(1);void 0===b&&void 0!==h&&h instanceof THREE.Vector3&&(b=h);h=new THREE.Vector2(b.x,b.y);this.setOutputData(2,h);this.triggerSlot(0,h);this.triggerSlot(1)};function VectorAddNode(){this.addInput("",LiteGraph.ACTION);this.addInput("Vector 1","vector");this.addInput("Vector 2","vector");this.addOutput("",LiteGraph.EVENT,NodesHelper.slots.output.passer);this.addOutput("",LiteGraph.EVENT);this.addOutput("Out","vector")}
VectorAddNode.title="Add";VectorAddNode.collapsable=!0;VectorAddNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VectorAddNode.prototype.onAction=function(b,h){b=this.getInputData(1);h=this.getInputData(2);void 0===b||void 0===h?console.log("An undefined parameter: ",b,h):(b=b.add(h),this.setOutputData(2,b),this.triggerSlot(0,b),this.triggerSlot(1))};
function registerVectorNode(){LiteGraph.registerNodeType("Math/Vector/Vector",VectorNode);LiteGraph.registerNodeType("Math/Vector/VectorThreeToTwo",VectorThreeToTwoNode);LiteGraph.registerNodeType("Math/Vector/VectorAdd",VectorAddNode)}function registerEulerNodes(){}function ANode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}ANode.title="A";ANode.collapsable=!0;
ANode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ANode.prototype.onStart=function(){this.setOutputData(3,Keyboard.A)};ANode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.A)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.A)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.A)&&this.triggerSlot(2,"Released")};
function AltNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}AltNode.title="Alt";AltNode.collapsable=!0;AltNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;AltNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ALT)};
AltNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.ALT)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.ALT)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.ALT)&&this.triggerSlot(2,"Released")};
function BNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}BNode.title="B";BNode.collapsable=!0;BNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;BNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.B)};
BNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.B)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.B)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.B)&&this.triggerSlot(2,"Released")};
function BackspaceNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}BackspaceNode.title="Backspace";BackspaceNode.collapsable=!0;BackspaceNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;BackspaceNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.BACKSPACE)};
BackspaceNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.BACKSPACE)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.BACKSPACE)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.BACKSPACE)&&this.triggerSlot(2,"Released")};
function CNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}CNode.title="C";CNode.collapsable=!0;CNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.C)};
CNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.C)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.C)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.C)&&this.triggerSlot(2,"Released")};
function CapsLockNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}CapsLockNode.title="CapsLock";CapsLockNode.collapsable=!0;CapsLockNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CapsLockNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.CAPS_LOCK)};
CapsLockNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.CAPS_LOCK)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.CAPS_LOCK)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.CAPS_LOCK)&&this.triggerSlot(2,"Released")};
function CtrlNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}CtrlNode.title="Ctrl";CtrlNode.collapsable=!0;CtrlNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;CtrlNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.CTRL)};
CtrlNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.CTRL)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.CTRL)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.CTRL)&&this.triggerSlot(2,"Released")};
function DNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}DNode.title="D";DNode.collapsable=!0;DNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.D)};
DNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.D)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.D)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.D)&&this.triggerSlot(2,"Released")};function DelNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
DelNode.title="Del";DelNode.collapsable=!0;DelNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DelNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.DEL)};DelNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.DEL)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.DEL)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.DEL)&&this.triggerSlot(2,"Released")};
function DownNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}DownNode.title="Down";DownNode.collapsable=!0;DownNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;DownNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.DOWN)};
DownNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.DOWN)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.DOWN)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.DOWN)&&this.triggerSlot(2,"Released")};
function ENode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}ENode.title="E";ENode.collapsable=!0;ENode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ENode.prototype.onStart=function(){this.setOutputData(3,Keyboard.E)};
ENode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.E)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.E)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.E)&&this.triggerSlot(2,"Released")};function EndNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
EndNode.title="End";EndNode.collapsable=!0;EndNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EndNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.END)};EndNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.END)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.END)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.END)&&this.triggerSlot(2,"Released")};
function EnterNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}EnterNode.title="Enter";EnterNode.collapsable=!0;EnterNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EnterNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ENTER)};
EnterNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.ENTER)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.ENTER)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.ENTER)&&this.triggerSlot(2,"Released")};
function EscNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}EscNode.title="Esc";EscNode.collapsable=!0;EscNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;EscNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.ESC)};
EscNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.ESC)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.ESC)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.ESC)&&this.triggerSlot(2,"Released")};
function FNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}FNode.title="F";FNode.collapsable=!0;FNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;FNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.F)};
FNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F)&&this.triggerSlot(2,"Released")};function F1Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
F1Node.title="F1";F1Node.collapsable=!0;F1Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F1Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F1)};F1Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F1)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F1)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F1)&&this.triggerSlot(2,"Released")};
function F2Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F2Node.title="F2";F2Node.collapsable=!0;F2Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F2Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F2)};
F2Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F2)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F2)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F2)&&this.triggerSlot(2,"Released")};
function F3Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F3Node.title="F3";F3Node.collapsable=!0;F3Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F3Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F3)};
F3Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F3)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F3)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F3)&&this.triggerSlot(2,"Released")};
function F4Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F4Node.title="F4";F4Node.collapsable=!0;F4Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F4Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F4)};
F4Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F4)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F4)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F4)&&this.triggerSlot(2,"Released")};
function F5Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F5Node.title="F5";F5Node.collapsable=!0;F5Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F5Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F5)};
F5Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F5)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F5)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F5)&&this.triggerSlot(2,"Released")};
function F6Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F6Node.title="F6";F6Node.collapsable=!0;F6Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F6Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F6)};
F6Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F6)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F6)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F6)&&this.triggerSlot(2,"Released")};
function F7Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F7Node.title="F7";F7Node.collapsable=!0;F7Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F7Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F7)};
F7Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F7)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F7)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F7)&&this.triggerSlot(2,"Released")};
function F8Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F8Node.title="F8";F8Node.collapsable=!0;F8Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F8Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F8)};
F8Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F8)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F8)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F8)&&this.triggerSlot(2,"Released")};
function F9Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F9Node.title="F9";F9Node.collapsable=!0;F9Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F9Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F9)};
F9Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F9)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F9)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F9)&&this.triggerSlot(2,"Released")};
function F10Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F10Node.title="F10";F10Node.collapsable=!0;F10Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F10Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F10)};
F10Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F10)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F10)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F10)&&this.triggerSlot(2,"Released")};
function F11Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F11Node.title="F11";F11Node.collapsable=!0;F11Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F11Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F11)};
F11Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F11)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F11)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F11)&&this.triggerSlot(2,"Released")};
function F12Node(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}F12Node.title="F12";F12Node.collapsable=!0;F12Node.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;F12Node.prototype.onStart=function(){this.setOutputData(3,Keyboard.F12)};
F12Node.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.F12)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.F12)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.F12)&&this.triggerSlot(2,"Released")};
function GNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}GNode.title="G";GNode.collapsable=!0;GNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;GNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.G)};
GNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.G)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.G)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.G)&&this.triggerSlot(2,"Released")};function HNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
HNode.title="H";HNode.collapsable=!0;HNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;HNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.H)};HNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.H)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.H)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.H)&&this.triggerSlot(2,"Released")};
function HomeNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}HomeNode.title="Home";HomeNode.collapsable=!0;HomeNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;HomeNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.HOME)};
HomeNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.HOME)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.HOME)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.HOME)&&this.triggerSlot(2,"Released")};
function INode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}INode.title="I";INode.collapsable=!0;INode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;INode.prototype.onStart=function(){this.setOutputData(3,Keyboard.I)};
INode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.I)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.I)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.I)&&this.triggerSlot(2,"Released")};
function InsertNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}InsertNode.title="Insert";InsertNode.collapsable=!0;InsertNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;InsertNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.INSERT)};
InsertNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.INSERT)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.INSERT)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.INSERT)&&this.triggerSlot(2,"Released")};
function JNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}JNode.title="J";JNode.collapsable=!0;JNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;JNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.J)};
JNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.J)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.J)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.J)&&this.triggerSlot(2,"Released")};function KNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
KNode.title="K";KNode.collapsable=!0;KNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;KNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.K)};KNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.K)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.K)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.K)&&this.triggerSlot(2,"Released")};
function LNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}LNode.title="L";LNode.collapsable=!0;LNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;LNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.L)};
LNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.L)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.L)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.L)&&this.triggerSlot(2,"Released")};function LeftNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
LeftNode.title="Left";LeftNode.collapsable=!0;LeftNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;LeftNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.LEFT)};
LeftNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.LEFT)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.LEFT)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.LEFT)&&this.triggerSlot(2,"Released")};
function MNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}MNode.title="M";MNode.collapsable=!0;MNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;MNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.M)};
MNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.M)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.M)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.M)&&this.triggerSlot(2,"Released")};function NNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
NNode.title="N";NNode.collapsable=!0;NNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;NNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.N)};NNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.N)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.N)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.N)&&this.triggerSlot(2,"Released")};
function ONode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}ONode.title="O";ONode.collapsable=!0;ONode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ONode.prototype.onStart=function(){this.setOutputData(3,Keyboard.O)};
ONode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.O)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.O)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.O)&&this.triggerSlot(2,"Released")};function PNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
PNode.title="P";PNode.collapsable=!0;PNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.P)};PNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.P)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.P)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.P)&&this.triggerSlot(2,"Released")};
function PageUpNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}PageUpNode.title="PageUp";PageUpNode.collapsable=!0;PageUpNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PageUpNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.PAGE_UP)};
PageUpNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.PAGE_UP)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.PAGE_UP)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.PAGE_UP)&&this.triggerSlot(2,"Released")};
function PageDownNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}PageDownNode.title="PageDown";PageDownNode.collapsable=!0;PageDownNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;PageDownNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.PAGE_DOWN)};
PageDownNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.PAGE_DOWN)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.PAGE_DOWN)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.PAGE_DOWN)&&this.triggerSlot(2,"Released")};
function QNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}QNode.title="Q";QNode.collapsable=!0;QNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;QNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Q)};
QNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.Q)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.Q)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.Q)&&this.triggerSlot(2,"Released")};function RNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
RNode.title="R";RNode.collapsable=!0;RNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;RNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.R)};RNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.R)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.R)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.R)&&this.triggerSlot(2,"Released")};
function RightNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}RightNode.title="Right";RightNode.collapsable=!0;RightNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;RightNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.RIGHT)};
RightNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.RIGHT)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.RIGHT)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.RIGHT)&&this.triggerSlot(2,"Released")};
function SNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}SNode.title="S";SNode.collapsable=!0;SNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;SNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.S)};
SNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.S)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.S)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.S)&&this.triggerSlot(2,"Released")};function ShiftNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
ShiftNode.title="Shift";ShiftNode.collapsable=!0;ShiftNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ShiftNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.SHIFT)};
ShiftNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.SHIFT)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.SHIFT)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.SHIFT)&&this.triggerSlot(2,"Released")};
function SpacebarNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}SpacebarNode.title="Spacebar";SpacebarNode.collapsable=!0;SpacebarNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;SpacebarNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.SPACEBAR)};
SpacebarNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.SPACEBAR)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.SPACEBAR)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.SPACEBAR)&&this.triggerSlot(2,"Released")};
function TNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}TNode.title="T";TNode.collapsable=!0;TNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;TNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.T)};
TNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.T)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.T)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.T)&&this.triggerSlot(2,"Released")};function TabNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
TabNode.title="Tab";TabNode.collapsable=!0;TabNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;TabNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.TAB)};TabNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.TAB)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.TAB)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.TAB)&&this.triggerSlot(2,"Released")};
function UNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}UNode.title="U";UNode.collapsable=!0;UNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;UNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.U)};
UNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.U)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.U)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.U)&&this.triggerSlot(2,"Released")};function UpNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
UpNode.title="Up";UpNode.collapsable=!0;UpNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;UpNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.UP)};UpNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.UP)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.UP)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.UP)&&this.triggerSlot(2,"Released")};
function VNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}VNode.title="V";VNode.collapsable=!0;VNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;VNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.V)};
VNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.V)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.V)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.V)&&this.triggerSlot(2,"Released")};function WNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
WNode.title="W";WNode.collapsable=!0;WNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;WNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.W)};WNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.W)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.W)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.W)&&this.triggerSlot(2,"Released")};
function XNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}XNode.title="X";XNode.collapsable=!0;XNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;XNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.X)};
XNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.X)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.X)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.X)&&this.triggerSlot(2,"Released")};function YNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}
YNode.title="Y";YNode.collapsable=!0;YNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;YNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Y)};YNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.Y)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.Y)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.Y)&&this.triggerSlot(2,"Released")};
function ZNode(){this.addOutput("Pressed",LiteGraph.EVENT);this.addOutput("Just Pressed",LiteGraph.EVENT);this.addOutput("Released",LiteGraph.EVENT);this.addOutput("Key","key")}ZNode.title="Z";ZNode.collapsable=!0;ZNode.prototype.getSlotMenuOptions=NodesHelper.getSlotMenuOptions;ZNode.prototype.onStart=function(){this.setOutputData(3,Keyboard.Z)};
ZNode.prototype.onExecute=function(){this.graph.config.program.keyboard.keyPressed(Keyboard.Z)&&this.triggerSlot(0,"Pressed");this.graph.config.program.keyboard.keyJustPressed(Keyboard.Z)&&this.triggerSlot(1,"JustPressed");this.graph.config.program.keyboard.keyJustReleased(Keyboard.Z)&&this.triggerSlot(2,"Released")};
function registerKeyboardNodes(){LiteGraph.registerNodeType("Input/Keyboard/A",ANode);LiteGraph.registerNodeType("Input/Keyboard/Alt",AltNode);LiteGraph.registerNodeType("Input/Keyboard/B",BNode);LiteGraph.registerNodeType("Input/Keyboard/Backspace",BackspaceNode);LiteGraph.registerNodeType("Input/Keyboard/C",CNode);LiteGraph.registerNodeType("Input/Keyboard/CapsLock",CapsLockNode);LiteGraph.registerNodeType("Input/Keyboard/Ctrl",CtrlNode);LiteGraph.registerNodeType("Input/Keyboard/D",DNode);LiteGraph.registerNodeType("Input/Keyboard/Del",
DelNode);LiteGraph.registerNodeType("Input/Keyboard/Down",DownNode);LiteGraph.registerNodeType("Input/Keyboard/E",ENode);LiteGraph.registerNodeType("Input/Keyboard/End",EndNode);LiteGraph.registerNodeType("Input/Keyboard/Enter",EnterNode);LiteGraph.registerNodeType("Input/Keyboard/Esc",EscNode);LiteGraph.registerNodeType("Input/Keyboard/F",FNode);LiteGraph.registerNodeType("Input/Keyboard/F1",F1Node);LiteGraph.registerNodeType("Input/Keyboard/F2",F2Node);LiteGraph.registerNodeType("Input/Keyboard/F3",
F3Node);LiteGraph.registerNodeType("Input/Keyboard/F4",F4Node);LiteGraph.registerNodeType("Input/Keyboard/F5",F5Node);LiteGraph.registerNodeType("Input/Keyboard/F6",F6Node);LiteGraph.registerNodeType("Input/Keyboard/F7",F7Node);LiteGraph.registerNodeType("Input/Keyboard/F8",F8Node);LiteGraph.registerNodeType("Input/Keyboard/F9",F9Node);LiteGraph.registerNodeType("Input/Keyboard/F10",F10Node);LiteGraph.registerNodeType("Input/Keyboard/F11",F11Node);LiteGraph.registerNodeType("Input/Keyboard/F12",F12Node);
LiteGraph.registerNodeType("Input/Keyboard/G",GNode);LiteGraph.registerNodeType("Input/Keyboard/H",HNode);LiteGraph.registerNodeType("Input/Keyboard/Home",HomeNode);LiteGraph.registerNodeType("Input/Keyboard/I",INode);LiteGraph.registerNodeType("Input/Keyboard/Insert",InsertNode);LiteGraph.registerNodeType("Input/Keyboard/J",JNode);LiteGraph.registerNodeType("Input/Keyboard/K",KNode);LiteGraph.registerNodeType("Input/Keyboard/L",LNode);LiteGraph.registerNodeType("Input/Keyboard/Left",LeftNode);LiteGraph.registerNodeType("Input/Keyboard/M",
MNode);LiteGraph.registerNodeType("Input/Keyboard/N",NNode);LiteGraph.registerNodeType("Input/Keyboard/O",ONode);LiteGraph.registerNodeType("Input/Keyboard/P",PNode);LiteGraph.registerNodeType("Input/Keyboard/PageUp",PageUpNode);LiteGraph.registerNodeType("Input/Keyboard/PageDown",PageDownNode);LiteGraph.registerNodeType("Input/Keyboard/Q",QNode);LiteGraph.registerNodeType("Input/Keyboard/R",RNode);LiteGraph.registerNodeType("Input/Keyboard/Right",RightNode);LiteGraph.registerNodeType("Input/Keyboard/S",
SNode);LiteGraph.registerNodeType("Input/Keyboard/Shift",ShiftNode);LiteGraph.registerNodeType("Input/Keyboard/Spacebar",SpacebarNode);LiteGraph.registerNodeType("Input/Keyboard/T",TNode);LiteGraph.registerNodeType("Input/Keyboard/Tab",TabNode);LiteGraph.registerNodeType("Input/Keyboard/U",UNode);LiteGraph.registerNodeType("Input/Keyboard/Up",UpNode);LiteGraph.registerNodeType("Input/Keyboard/V",VNode);LiteGraph.registerNodeType("Input/Keyboard/W",WNode);LiteGraph.registerNodeType("Input/Keyboard/X",
XNode);LiteGraph.registerNodeType("Input/Keyboard/Y",YNode);LiteGraph.registerNodeType("Input/Keyboard/Z",ZNode)}
function MaterialNode(){this.addInput("Colour","color");this.addInput("Emissive","color");this.addInput("Reflectivity","number");this.addInput("Shininess","number");this.addInput("Specular","color");this.addInput("Wireframe","bool");this.addInput("Transparent","bool");this.addInput("Opacity","number");this.addInput("Affected By Fog","bool");this.serialize_widgets=!0;this.properties={reflectivity:1,shininess:30,wireframe:!1,depthwrite:!1,transparent:!1,opacity:1,abf:!0};var b=this;this.widget1=this.addWidget("slider",
"Reflectivity",this.properties.reflectivity,h=>{b.properties.reflectivity=h},{value:this.properties.reflectivity,min:0,max:1,text:"R"});this.widget2=this.addWidget("slider","Shininess",this.properties.shininess,h=>{b.properties.shininess=h},{value:this.properties.shininess,min:0,max:100,text:"S"});this.addWidget("toggle","Wireframe",this.properties.wireframe,"wireframe");this.addWidget("toggle","Depth Write",this.properties.depthwrite,"depthwrite");this.addWidget("toggle","Transparent",this.properties.transparent,
"transparent");this.widget3=this.addWidget("slider","Opacity",this.properties.opacity,h=>{b.properties.opacity=h},{value:this.properties.opacity,min:0,max:1});this.addWidget("toggle","Affected By Fog",this.properties.abf,"abf")}MaterialNode.title="Material";MaterialNode.skip_list=!0;
MaterialNode.prototype.onPropertyChanged=function(b,h){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange();"reflectivity"===b?void 0!==this.widget1&&(this.widget1.value=h):"shininess"===b?void 0!==this.widget2&&(this.widget2.value=h):"opacity"===b&&void 0!==this.widget3&&(this.widget3.value=h)};
MaterialNode.prototype.onExecute=function(){if(void 0!==this.graph.extra){var b=this.graph.extra.material;b.nodes}if(void 0!==b){var h=this.getInputData(0),k=this.getInputData(1),e=this.getInputData(2),p=this.getInputData(3),q=this.getInputData(4),l=this.getInputData(5),t=this.getInputData(6),r=this.getInputData(7),y=this.getInputData(8),z=this.getInputData(9);void 0!==h&&(b.color=h);void 0!==k&&(b.emissive=k);b.reflectivity=void 0!==e?e:this.properties.reflectivity;b.shininess=void 0!==p?p:this.properties.shininess;
void 0!==q&&(b.specular=q);b.wireframe=void 0!==l?l:this.properties.wireframe;b.depthWrite=void 0!==t?t:this.properties.depthwrite;b.transparent=void 0!==r?r:this.properties.transparent;b.opacity=void 0!==y?y:this.properties.opacity;b.fog=void 0!==z?z:this.properties.abf}};function MaterialSideNode(){this.serialize_widgets=!0;this.properties={side:THREE.FontSide,sides:"Front;Back;Double",sideStr:""};this.side="";this.sides=this.properties.sides.split(";")}MaterialSideNode.title="Side";
MaterialSideNode.prototype.onAdded=function(){var b=this;this.properties.side=this.graph.extra.material.side;this.properties.side===THREE.FrontSide?this.side="Front":this.properties.side===THREE.BackSide?this.side="Back":this.properties.side===THREE.DoubleSide&&(this.side="Double");this.combo=this.addWidget("combo","Side",this.side,h=>{b.properties.sideStr=h},{values:this.sides,property:"sideStr"});this.combo.width=160;this.size=[160,30]};
MaterialSideNode.prototype.onPropertyChanged=function(b,h){var k=this.graph.extra.material;"sideStr"===b&&("Front"===h?k.side=THREE.FrontSide:"Back"===h?k.side=THREE.BackSide:"Double"===h&&(k.side=THREE.DoubleSide));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialDepthTestNode(){this.serialize_widgets=!0;this.properties={test:!1}}MaterialDepthTestNode.title="Depth Test";
MaterialDepthTestNode.prototype.onAdded=function(){this.properties.test=this.graph.extra.material.depthTest;this.addWidget("toggle","Depth Test",this.properties.test,"test").width=160;this.size=[160,30]};MaterialDepthTestNode.prototype.onPropertyChanged=function(b,h){this.graph.extra.material.depthTest=h;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialAlphaTestNode(){this.serialize_widgets=!0;this.properties={test:!1}}
MaterialAlphaTestNode.title="Alpha Test";MaterialAlphaTestNode.prototype.onAdded=function(){this.properties.test=this.graph.extra.material.alphaTest;this.addWidget("toggle","Alpha Test",this.properties.test,"test").width=160;this.size=[160,30]};MaterialAlphaTestNode.prototype.onPropertyChanged=function(b,h){this.graph.extra.material.alphaTest=h;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialBlendingModeNode(){this.serialize_widgets=!0;this.properties={blending:THREE.NoBlending,modes:"None;Normal;Additive;Subtractive;Multiply",blendingStr:""};this.blending="";this.modes=this.properties.modes.split(";")}MaterialBlendingModeNode.title="Blending Mode";
MaterialBlendingModeNode.prototype.onAdded=function(){var b=this;this.properties.blending=this.graph.extra.material.blending;this.properties.blending===THREE.NoBlending?this.blending="None":this.properties.blending===THREE.NormalBlending?this.blending="Normal":this.properties.blending===THREE.AdditiveBlending?this.blending="Additive":this.properties.blending===THREE.SubtractiveBlending?this.blending="Subtractive":this.properties.blending===THREE.MultiplyBlending&&(this.blending="Multiply");this.combo=
this.addWidget("combo","Blending",this.blending,h=>{b.properties.blendingStr=h},{values:this.modes,property:"blendingStr"});this.combo.width=200;this.size=[200,30]};
MaterialBlendingModeNode.prototype.onPropertyChanged=function(b,h){var k=this.graph.extra.material;"blendingStr"===b&&("None"===h?k.blending=THREE.NoBlending:"Normal"===h?k.blending=THREE.NormalBlending:"Additive"===h?k.blending=THREE.AdditiveBlending:"Subtractive"===h?k.blending=THREE.SubtractiveBlending:"Multiply"===h&&(k.blending=THREE.MultiplyBlending));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialSkinningNode(){this.serialize_widgets=!0;this.properties={skinning:!1}}MaterialSkinningNode.title="Skinning";MaterialSkinningNode.prototype.onAdded=function(){this.properties.skinning=this.graph.extra.material.skinning;this.addWidget("toggle","Skinning",this.properties.skinning,"skinning").width=160;this.size=[160,30]};MaterialSkinningNode.prototype.onPropertyChanged=function(){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialMorphTargetsNode(){this.serialize_widgets=!0;this.properties={morphTargets:!1}}MaterialMorphTargetsNode.title="Morph Targets";MaterialMorphTargetsNode.prototype.onAdded=function(){this.properties.morphTargets=this.graph.extra.material.morphTargets;this.addWidget("toggle","Morph Targets",this.properties.morphTargets,"morphTargets").width=180;this.size=[180,30]};MaterialMorphTargetsNode.prototype.onPropertyChanged=function(){if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function MaterialColourNode(){this.addInput("Colour","color");this.size=[120,26]}MaterialColourNode.title="Colour";MaterialColourNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};MaterialColourNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.mat.color=b)};function MaterialMapNode(){this.addInput("Map","texture");this.size=[120,26]}MaterialMapNode.title="Map";MaterialMapNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};
MaterialMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.mat.map=b)};function MaterialAlphaMapNode(){this.addInput("Alpha","texture");this.size=[120,26]}MaterialAlphaMapNode.title="Alpha Map";MaterialAlphaMapNode.prototype.onAdded=function(){this.mat=this.graph.extra.material};MaterialAlphaMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.mat.alphaMap=b)};
function MaterialShadingNode(){this.serialize_widgets=!0;this.properties={shading:THREE.SmoothShading,shadings:"Smooth;Flat",shadingStr:""};this.shading="";this.shadings=this.properties.shadings.split(";");this.serialize_widgets=!0}MaterialShadingNode.title="Shading";
MaterialShadingNode.prototype.onAdded=function(){var b=this;this.properties.shading=this.graph.extra.material.shading;this.properties.shading===THREE.SmoothShading?this.shading="Smooth":this.properties.shading===THREE.FlatShading&&(this.shading="Flat");this.combo=this.addWidget("combo","Shading",this.shading,h=>{b.properties.shadingStr=h},{values:this.shadings,property:"shadingStr"});this.combo.width=180;this.size=[180,30]};
MaterialShadingNode.prototype.onPropertyChanged=function(b,h){var k=this.graph.extra.material;"shadingStr"===b&&("Smooth"===h?k.shading=THREE.SmoothShading:"Flat"===h&&(k.shading=THREE.FlatShading));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialBumpMapNode(){this.properties={scale:0};this.addInput("Map","texture");this.serialize_widgets=!0}MaterialBumpMapNode.title="Bump";
MaterialBumpMapNode.prototype.onAdded=function(){var b=this;this.material=this.graph.extra.material;this.properties.scale=void 0!==this.material.bumpScale?this.material.bumpScale:0;this.addWidget("slider","Scale",this.properties.scale,h=>{b.properties.scale=h},{min:0,max:1,property:"scale"})};MaterialBumpMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.bumpMap=b)};
MaterialBumpMapNode.prototype.onPropertyChanged=function(){this.material.bumpScale=this.properties.scale;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialNormalNode(){this.properties={scalex:1,scaley:1};this.addInput("Map","texture");this.serialize_widgets=!0}MaterialNormalNode.title="Normal";
MaterialNormalNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.scalex=this.material.normalScale.x;this.properties.scaley=this.material.normalScale.y;this.addWidget("number","Scale X",this.properties.scalex,"scalex");this.addWidget("number","Scale Y",this.properties.scaley,"scaley")};MaterialNormalNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.normalMap=b)};
MaterialNormalNode.prototype.onPropertyChanged=function(){this.material.normalScale=new THREE.Vector2(this.properties.scalex,this.properties.scaley);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialDisplacementMapNode(){this.properties={scalex:0,bias:0};this.addInput("Map","texture");this.serialize_widgets=!0}MaterialDisplacementMapNode.title="Displacement";
MaterialDisplacementMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.scale=void 0!==this.material.displacementScale?this.material.displacementScale:0;this.properties.bias=void 0!==this.material.displacementBias?this.material.displacementBias:0;this.addWidget("number","Scale",this.properties.scale,"scale");this.addWidget("number","Bias",this.properties.bias,"bias")};
MaterialDisplacementMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.displacementMap=b)};MaterialDisplacementMapNode.prototype.onPropertyChanged=function(b,h){"scale"===b?this.material.displacementScale=new this.properties.scale:"bias"===b&&(this.material.displacementBias=this.properties.bias)};function MaterialSpecularMapNode(){this.addInput("Map","texture")}MaterialSpecularMapNode.title="Specular";
MaterialSpecularMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material};MaterialSpecularMapNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.material.specularMap=b)};function MaterialEmissiveMapNode(){this.properties={intensity:0};this.addInput("Map","texture");this.addInput("Colour","color");this.serialize_widgets=!0}MaterialEmissiveMapNode.title="Emissive";
MaterialEmissiveMapNode.prototype.onAdded=function(){this.material=this.graph.extra.material;this.properties.intensity=void 0!==this.material.emissiveIntensity?this.material.emissiveIntensity:0;this.addWidget("number","Intensity",this.properties.intensity,"intensity")};MaterialEmissiveMapNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0!==b&&(this.material.emissiveMap=b);void 0!==h&&this.material.emissive.copy(h)};
MaterialEmissiveMapNode.prototype.onPropertyChanged=function(b,h){"intensity"===b&&(this.material.emissiveIntensity=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function MaterialShaderNode(){this.properties={mat:null};this.addInput("Uniforms","json")}MaterialShaderNode.title="Shader";MaterialShaderNode.skip_list=!0;
MaterialShaderNode.prototype.onDblClick=function(){var b=this.graph.extra.material,h=this.graph.extra.file,k=Interface.tab.getTab(ShaderMaterialEditor,self.mat);null===k&&(k=Interface.tab.addTab(ShaderMaterialEditor,!0),k.attach(b,h));k.select()};
function registerMaterialNodes(){LiteGraph.registerNodeType("Material/Material",MaterialNode);LiteGraph.registerNodeType("Material/Shader",MaterialShaderNode);LiteGraph.registerNodeType("Material/Side",MaterialSideNode);LiteGraph.registerNodeType("Material/DepthTest",MaterialDepthTestNode);LiteGraph.registerNodeType("Material/AlphaTest",MaterialAlphaTestNode);LiteGraph.registerNodeType("Material/BlendingMode",MaterialBlendingModeNode);LiteGraph.registerNodeType("Material/Skinning",MaterialSkinningNode);
LiteGraph.registerNodeType("Material/MorphTargets",MaterialMorphTargetsNode);LiteGraph.registerNodeType("Material/Colour",MaterialColourNode);LiteGraph.registerNodeType("Material/Map",MaterialMapNode);LiteGraph.registerNodeType("Material/AlphaMap",MaterialAlphaMapNode);LiteGraph.registerNodeType("Material/Shading",MaterialShadingNode);LiteGraph.registerNodeType("Material/BumpMap",MaterialBumpMapNode);LiteGraph.registerNodeType("Material/NormalMap",MaterialNormalNode);LiteGraph.registerNodeType("Material/DisplacementMap",
MaterialDisplacementMapNode);LiteGraph.registerNodeType("Material/SpecularMap",MaterialSpecularMapNode);LiteGraph.registerNodeType("Material/EmissiveMap",MaterialEmissiveMapNode)}
function ParticlesNode(){this.addInput("Direction","string");this.addInput("Count","number");this.addInput("Rate","number");this.addInput("Duration","number");this.addInput("Wiggle","number");this.serialize_widgets=!0;this.properties={direction:"Forward",directions:"Forward;Backward",count:2E3,rate:2E3,duration:0,wiggle:0}}ParticlesNode.title="Particles";ParticlesNode.skip_list=!0;
ParticlesNode.prototype.onAdded=function(){var b=this,h=this.graph.extra.particles.emitter,k=this.graph.extra.particles.group;this.emitter=h;this.group=k;this.properties.direction=1===h.direction?"Forward":"Backward";this.properties.count=k.maxParticleCount;this.properties.rate=h.particleCount;this.properties.duration=h.duration;this.properties.wiggle=h.wiggle.value;this.dir=this.addWidget("combo","Direction",this.properties.direction,e=>{b.properties.direction=e},{property:"direction",values:this.properties.directions.split(";")});
this.count=this.addWidget("number","Max Count",this.properties.count,"count");this.rate=this.addWidget("slider","Rate",this.properties.rate,e=>{b.properties.rate=e},{value:this.properties.rate,min:0,max:this.properties.count,property:"rate"});this.duration=this.addWidget("number","Duration",this.properties.duration,"duration");this.wiggle=this.addWidget("number","Wiggle",this.properties.wiggle,"wiggle")};
ParticlesNode.prototype.onPropertyChanged=function(b,h){"direction"===b&&("Forward"===h?this.emitter.direction=1:"Backward"===h&&(this.emitter.direction=-1));"count"===b&&(this.group.maxParticleCount=parseInt(h),this.rate.options.max=parseInt(h),this.rate.value>parseInt(h)&&(this.emitter.particleCount=parseInt(h),this.rate.value=parseInt(h)));"rate"===b&&(this.emitter.particleCount=parseInt(h));"duration"===b&&(this.emitter.duration=.01>h?null:h);"wiggle"===b&&(this.emitter.wiggle.value=parseInt(h));
if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesTextureNode(){this.serialize_widgets=!0;this.addInput("Texture","texture");this.size=[120,26]}ParticlesTextureNode.title="Texture";ParticlesTextureNode.prototype.onAdded=function(){this.group=this.graph.extra.particles.group};ParticlesTextureNode.prototype.onExecute=function(){var b=this.getInputData(0);void 0!==b&&(this.group.texture=b)};
function ParticlesBlendingModeNode(){this.serialize_widgets=!0;this.properties={blending:"NaN",modes:"None;Normal;Additive;Subtractive;Multiply"}}ParticlesBlendingModeNode.title="Blending";
ParticlesBlendingModeNode.prototype.onAdded=function(){this.group=this.graph.extra.particles.group;this.blending=this.group.blending;var b="",h=this;this.blending===THREE.NoBlending?b="None":this.blending===THREE.NormalBlending?b="Normal":this.blending===THREE.AdditiveBlending?b="Additive":this.blending===THREE.SubtractiveBlending?b="Subtractive":this.blending===THREE.MultiplyBlending&&(b="Multiply");this.properties.blending=b;this.addWidget("combo","Blending",b,k=>{h.properties.blending=k},{property:"blending",
values:this.properties.modes.split(";"),width:200});this.size=[200,26]};ParticlesBlendingModeNode.prototype.onPropertyChanged=function(b,h){"blending"===b&&("None"===h?this.group.blending=THREE.NoBlending:"Normal"===h?this.group.blending=THREE.NormalBlending:"Additive"===h?this.group.blending=THREE.AdditiveBlending:"Subtractive"===h?this.group.blending=THREE.SubtractiveBlending:"Multiply"===h&&(this.group.blending=THREE.MultiplyBlending));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesEmitterTypeNode(){this.serialize_widgets=!0;this.properties={type:"NaN",types:"Box;Sphere;Disc"}}ParticlesEmitterTypeNode.title="Emitter Type";
ParticlesEmitterTypeNode.prototype.onAdded=function(){this.emitter=this.graph.extra.particles.emitter;var b="",h=this;this.emitter.type===SPE.distributions.BOX?b="Box":this.emitter.type===SPE.distributions.SPHERE?b="Sphere":this.emitter.type===SPE.distributions.DISC&&(b="Disc");this.properties.type=b;this.addWidget("combo","Type",b,k=>{h.properties.type=k},{property:"type",values:this.properties.types.split(";"),width:180});this.size=[180,26]};
ParticlesEmitterTypeNode.prototype.onPropertyChanged=function(b,h){"type"===b&&("Box"===h?this.emitter.type=SPE.distributions.BOX:"Sphere"===h?this.emitter.type=SPE.distributions.SPHERE:"Disc"===h&&(this.emitter.type=SPE.distributions.DISC));if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesMaxAgeNode(){this.serialize_widgets=!0;this.properties={value:0,spread:0}}ParticlesMaxAgeNode.title="Max Age";
ParticlesMaxAgeNode.prototype.onAdded=function(){this.maxAge=this.graph.extra.particles.emitter.maxAge;this.value=this.maxAge.value;this.spread=this.maxAge.spread;this.properties.value=this.value;this.properties.spread=this.spread;this.addWidget("number","Value",this.properties.value,"value");this.addWidget("number","Spread",this.properties.spread,"spread");this.size=[160,52]};
ParticlesMaxAgeNode.prototype.onPropertyChanged=function(b,h){"value"===b?this.value=h:"spread"===b&&(this.spread=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesPositionNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesPositionNode.title="Position";
ParticlesPositionNode.prototype.onAdded=function(){this.position=this.graph.extra.particles.emitter.position;this.value=this.position.value;this.spread=this.position.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,"spreadz");
this.size=[180,150]};ParticlesPositionNode.prototype.onPropertyChanged=function(b,h){if("x"===b||"y"===b||"z"===b)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===b||"spready"===b||"spreadz"===b)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesVelocityNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesVelocityNode.title="Velocity";
ParticlesVelocityNode.prototype.onAdded=function(){this.velocity=this.graph.extra.particles.emitter.velocity;this.value=this.velocity.value;this.spread=this.velocity.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,"spreadz");
this.size=[180,150]};ParticlesVelocityNode.prototype.onPropertyChanged=function(b,h){if("x"===b||"y"===b||"z"===b)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===b||"spready"===b||"spreadz"===b)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesAccelerationNode(){this.serialize_widgets=!0;this.properties={x:0,y:0,z:0,spreadx:0,spready:0,spreadz:0}}ParticlesAccelerationNode.title="Acceleration";
ParticlesAccelerationNode.prototype.onAdded=function(){this.acceleration=this.graph.extra.particles.emitter.velocity;this.value=this.acceleration.value;this.spread=this.acceleration.spread;this.addWidget("number","Value X",this.value.x,"x");this.addWidget("number","Value Y",this.value.y,"y");this.addWidget("number","Value Z",this.value.z,"z");this.addWidget("number","Spread X",this.spread.x,"spreadx");this.addWidget("number","Spread Y",this.spread.y,"spready");this.addWidget("number","Spread Z",this.spread.z,
"spreadz");this.size=[180,150]};ParticlesAccelerationNode.prototype.onPropertyChanged=function(b,h){if("x"===b||"y"===b||"z"===b)this.value.x=this.properties.x,this.value.y=this.properties.y,this.value.z=this.properties.z;else if("spreadx"===b||"spready"===b||"spreadz"===b)this.spread.x=this.properties.spreadx,this.spread.y=this.properties.spready,this.spread.z=this.properties.spreadz;if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function ParticlesWiggleNode(){this.serialize_widgets=!0;this.properties={wiggle:0,spread:0}}ParticlesWiggleNode.title="Wiggle";ParticlesWiggleNode.prototype.onAdded=function(){this.wiggle=this.graph.extra.particles.emitter.wiggle;this.value=this.wiggle.value;this.spread=this.wiggle.spread;this.addWidget("number","Value",this.value,"wiggle");this.addWidget("number","Spread",this.spread,"spread")};
ParticlesWiggleNode.prototype.onPropertyChanged=function(b,h){"wiggle"===b?this.value=h:"spread"===b&&(this.spread=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};function ParticlesOpacityNode(){this.addInput("Value","array");this.addInput("Spread","array")}ParticlesOpacityNode.title="Opacity";ParticlesOpacityNode.prototype.onAdded=function(){this.opacity=this.graph.extra.particles.emitter.opacity};
ParticlesOpacityNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.opacity.spread=h),this.opacity.value=b)};function ParticlesScaleNode(){this.addInput("Value","array");this.addInput("Spread","array")}ParticlesScaleNode.title="Scale";ParticlesScaleNode.prototype.onAdded=function(){this.scale=this.graph.extra.particles.emitter.size};
ParticlesScaleNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.scale.spread=h),this.scale.value=b)};function ParticlesRotationNode(){this.addInput("Value","array");this.addInput("Spread","array")}ParticlesRotationNode.title="Rotation";ParticlesRotationNode.prototype.onAdded=function(){this.rotation=this.graph.extra.particles.emitter.angle};
ParticlesRotationNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.rotation.spread=h),this.rotation.value=b)};function ParticlesColourNode(){this.addInput("Value","array");this.addInput("Spread","array")}ParticlesColourNode.title="Colour";ParticlesColourNode.prototype.onAdded=function(){this.colour=this.graph.extra.particles.emitter.color};
ParticlesColourNode.prototype.onExecute=function(){var b=this.getInputData(0),h=this.getInputData(1);void 0===b||4>b.length||(void 0!==h&&4<h.length&&(this.colour.spread=h),this.colour.value=b)};
function registerParticlesNodes(){LiteGraph.registerNodeType("Particles/Particles",ParticlesNode);LiteGraph.registerNodeType("Particles/ParticlesTexture",ParticlesTextureNode);LiteGraph.registerNodeType("Particles/ParticlesBlending",ParticlesBlendingModeNode);LiteGraph.registerNodeType("Particles/ParticlesEmitterType",ParticlesEmitterTypeNode);LiteGraph.registerNodeType("Particles/ParticlesMaxAge",ParticlesMaxAgeNode);LiteGraph.registerNodeType("Particles/ParticlesPosition",ParticlesPositionNode);
LiteGraph.registerNodeType("Particles/ParticlesVelocity",ParticlesVelocityNode);LiteGraph.registerNodeType("Particles/ParticlesAcceleration",ParticlesAccelerationNode);LiteGraph.registerNodeType("Particles/ParticlesWiggle",ParticlesWiggleNode);LiteGraph.registerNodeType("Particles/ParticlesOpacity",ParticlesOpacityNode);LiteGraph.registerNodeType("Particles/ParticlesScale",ParticlesScaleNode);LiteGraph.registerNodeType("Particles/ParticlesRotation",ParticlesRotationNode);LiteGraph.registerNodeType("Particles/ParticlesColour",
ParticlesColourNode)}function TextureNode(){this.addOutput("","texture");this.resizable=!1}TextureNode.title="Texture";TextureNode.collapsable=!0;TextureNode.skip_list=!0;TextureNode.prototype.onStart=function(){this.texture=this.graph.extra.texture;this.alpha=this.graph.extra.alpha;this.setOutputData(0,this.graph.extra.texture)};function TexturePreviewNode(){this.addInput("","texture");this.resizable=!1}TexturePreviewNode.title="Preview";
TexturePreviewNode.prototype.onDrawBackground=function(b){this.isInputConnected(0)?(void 0!==this.getInputData(0)?this.texture=this.getInputData(0):this.texture=this.graph.extra.texture,this.alpha=this.graph.extra.alpha,b.drawImage(this.alpha.image,15,30,100,100),b.drawImage(this.texture.image,25,40,80,80),this.size=[130,140]):26<this.size[1]&&(this.size=[140,26])};
function WrapHorNode(){this.addInput("","texture");this.resizable=!1;this.serialize_widgets=!0;this.properties={wrap:THREE.RepeatWrapping,wraps:"Clamp To Edge;Repeat;Repeat Mirrored",wrapString:"",added:!1};this.wrap="";this.wraps=this.properties.wraps.split(";")}WrapHorNode.title="Wrap Hor";WrapHorNode.prototype.onAdded=function(){var b=this;setTimeout(()=>{!0===b.properties.added&&void 0===b.combo&&b.checkConnection()},100)};
WrapHorNode.prototype.checkConnection=function(){this.isInputConnected(0)?(void 0!==this.getInputData(0)?this.texture=this.getInputData(0):this.texture=this.graph.extra.texture,this.properties.added=!0,this.addCombo()):26<this.size[1]&&(this.size=[140,26],this.combo=void 0,this.widgets=[],this.removeOutput(0),this.properties.added=!1);if(0<this.outputs.length)for(var b=1;b<this.outputs.length;b++)this.removeOutput(b)};WrapHorNode.prototype.connectionChange=function(){this.checkConnection()};
WrapHorNode.prototype.addCombo=function(){if(void 0===this.combo&&this.properties.added){var b=this;this.properties.wrap=this.texture.wrapS;this.properties.wrap===THREE.ClampToEdgeWrapping?this.wrap="Clamp to Edge":this.properties.wrap===THREE.RepeatWrapping?this.wrap="Repeat":this.properties.wrap===THREE.MirroredRepeatWrapping&&(this.wrap="Repeat Mirrored");this.combo=this.addWidget("combo","Wrap",this.wrap,h=>{b.properties.wrapString=h},{values:this.wraps,property:"wrapString"});this.combo.width=
200;this.addOutput("","texture");this.setOutputData(0,this.texture);this.size=[200,50]}};WrapHorNode.prototype.onPropertyChanged=function(b,h){if(void 0!==this.texture&&("wrapString"===b&&("Clamp To Edge"===h?this.texture.wrapS=THREE.ClampToEdgeWrapping:"Repeat"===h?this.texture.wrapS=THREE.RepeatWrapping:"Repeat Mirrored"===h&&(this.texture.wrapS=THREE.MirroredRepeatWrapping)),void 0!==this.graph.onNodeConnectionChange))this.graph.onNodeConnectionChange()};
function WrapVertNode(){this.addInput("","texture");this.resizable=!1;this.serialize_widgets=!0;this.properties={wrap:THREE.RepeatWrapping,wraps:"Clamp To Edge;Repeat;Repeat Mirrored",wrapString:"",added:!1};this.wrap="";this.wraps=this.properties.wraps.split(";")}WrapVertNode.title="Wrap Vert";WrapVertNode.prototype.onAdded=function(){var b=this;setTimeout(()=>{!0===b.properties.added&&void 0===b.combo&&b.checkConnection()},100)};
WrapVertNode.prototype.checkConnection=function(){this.isInputConnected(0)?(void 0!==this.getInputData(0)?this.texture=this.getInputData(0):this.texture=this.graph.extra.texture,this.properties.added=!0,this.addCombo()):26<this.size[1]&&(this.size=[140,26],this.combo=void 0,this.widgets=[],this.removeOutput(0),this.properties.added=!1);if(0<this.outputs.length)for(var b=1;b<this.outputs.length;b++)this.removeOutput(b)};WrapVertNode.prototype.connectionChange=function(){this.checkConnection()};
WrapVertNode.prototype.addCombo=function(){if(void 0===this.combo&&this.properties.added){var b=this;this.properties.wrap=this.texture.wrapT;this.properties.wrap===THREE.ClampToEdgeWrapping?this.wrap="Clamp to Edge":this.properties.wrap===THREE.RepeatWrapping?this.wrap="Repeat":this.properties.wrap===THREE.MirroredRepeatWrapping&&(this.wrap="Repeat Mirrored");this.combo=this.addWidget("combo","Wrap",this.wrap,h=>{b.properties.wrapString=h},{values:this.wraps,property:"wrapString"});this.combo.width=
200;this.addOutput("","texture");this.setOutputData(0,this.texture);this.size=[200,50]}};WrapVertNode.prototype.onPropertyChanged=function(b,h){if(void 0!==this.texture&&("wrapString"===b&&("Clamp To Edge"===h?this.texture.wrapT=THREE.ClampToEdgeWrapping:"Repeat"===h?this.texture.wrapT=THREE.RepeatWrapping:"Repeat Mirrored"===h&&(this.texture.wrapT=THREE.MirroredRepeatWrapping)),void 0!==this.graph.onNodeConnectionChange))this.graph.onNodeConnectionChange()};
function RepeatNode(){this.addInput("","texture");this.addInput("Value","vector");this.addOutput("","texture");this.resizable=!1}RepeatNode.title="Repeat";RepeatNode.prototype.onExecute=function(){this.texture=void 0!==this.getInputData(0)?this.getInputData(0):this.graph.extra.texture;this.repeat=void 0!==this.getInputData(1)?this.getInputData(1):new THREE.Vector2(1,1);this.texture.repeat.set(this.repeat.x,this.repeat.y);this.setOutputData(0,this.texture)};
function MinFilterNode(){this.addInput("","texture");this.resizable=!1;this.serialize_widgets=!0;this.properties={filter:THREE.NearestFilter,filters:"Nearest;Linear;Nearest Nearest;Nearest Linear;Linear Nearest;Linear Linear",filterString:"",added:!1};this.filter="";this.filters=this.properties.filters.split(";")}MinFilterNode.title="Min. Filter";MinFilterNode.prototype.onAdded=function(){var b=this;setTimeout(()=>{!0===b.properties.added&&void 0===b.combo&&b.checkConnection()},100)};
MinFilterNode.prototype.checkConnection=function(){this.isInputConnected(0)?(void 0!==this.getInputData(0)?this.texture=this.getInputData(0):this.texture=this.graph.extra.texture,this.properties.added=!0,this.addCombo()):26<this.size[1]&&(this.size=[140,26],this.combo=void 0,this.widgets=[],this.removeOutput(0),this.properties.added=!1);if(0<this.outputs.length)for(var b=1;b<this.outputs.length;b++)this.removeOutput(b)};MinFilterNode.prototype.connectionChange=function(){this.checkConnection()};
MinFilterNode.prototype.addCombo=function(){if(void 0===this.combo&&this.properties.added){var b=this;this.properties.filter=this.texture.minFilter;this.properties.filter===THREE.NearestFilter?this.filter="Nearest":this.properties.filter===THREE.LinearFilter?this.filter="Linear":this.properties.filter===THREE.NearestMipMapNearestFilter?this.filter="Nearest Nearest":this.properties.filter===THREE.NearestMipMapLinearFilter?this.filter="Nearest Linear":this.properties.filter===THREE.LinearMipMapNearestFilter?
this.filter="Linear Nearest":this.properties.filter===THREE.LinearMipMapLinearFilter&&(this.filter="Linear Linear");this.combo=this.addWidget("combo","Filter",this.filter,h=>{b.properties.filterString=h},{values:this.filters,property:"filterString"});this.combo.width=220;this.addOutput("","texture");this.setOutputData(0,this.texture);this.size=[240,50]}};
MinFilterNode.prototype.onPropertyChanged=function(b,h){if(void 0!==this.texture&&("filterString"===b&&("Nearest"===h?this.texture.minFilter=THREE.NearestFilter:"Linear"===h?this.texture.minFilter=THREE.LinearFilter:"Nearest Nearest"===h?this.texture.minFilter=THREE.NearestMipMapNearestFilter:"Nearest Linear"===h?this.texture.minFilter=THREE.NearestMipMapLinearFilter:"Linear Nearest"===h?this.texture.minFilter=THREE.LinearMipMapNearestFilter:"Linear Linear"===h&&(this.texture.minFilter=THREE.LinearMipMapLinearFilter)),
void 0!==this.graph.onNodeConnectionChange))this.graph.onNodeConnectionChange()};function MagFilterNode(){this.addInput("","texture");this.resizable=!1;this.serialize_widgets=!0;this.properties={filter:THREE.NearestFilter,filters:"Nearest;Linear",filterString:"",added:!1};this.filter="";this.filters=this.properties.filters.split(";")}MagFilterNode.title="Mag. Filter";
MagFilterNode.prototype.onAdded=function(){var b=this;setTimeout(()=>{!0===b.properties.added&&void 0===b.combo&&b.checkConnection()},100)};
MagFilterNode.prototype.checkConnection=function(){this.isInputConnected(0)?(void 0!==this.getInputData(0)?this.texture=this.getInputData(0):this.texture=this.graph.extra.texture,this.properties.added=!0,this.addCombo()):26<this.size[1]&&(this.size=[140,26],this.combo=void 0,this.widgets=[],this.removeOutput(0),this.properties.added=!1);if(0<this.outputs.length)for(var b=0;b<this.outputs.length;b++)this.removeOutput(b)};MagFilterNode.prototype.connectionChange=function(){this.checkConnection()};
MagFilterNode.prototype.addCombo=function(){if(void 0===this.combo&&this.properties.added){var b=this;this.properties.filter=this.texture.magFilter;this.properties.filter===THREE.NearestFilter?this.filter="Nearest":this.properties.filter===THREE.LinearFilter&&(this.filter="Linear");this.combo=this.addWidget("combo","Filter",this.filter,h=>{b.properties.filterString=h},{values:this.filters,property:"filterString"});this.combo.width=220;this.addOutput("","texture");this.setOutputData(0,this.texture);
this.size=[240,50]}};MagFilterNode.prototype.onPropertyChanged=function(b,h){if(void 0!==this.texture&&("filterString"===b&&("Nearest"===h?this.texture.magFilter=THREE.NearestFilter:"Linear"===h&&(this.texture.magFilter=THREE.LinearFilter)),void 0!==this.graph.onNodeConnectionChange))this.graph.onNodeConnectionChange()};
function FlipYNode(){this.addInput("","texture");this.serialize_widgets=!0;this.properties={flip:!0};this.flip=this.addWidget("toggle","Flip?",this.properties.flip,{property:"flip"})}FlipYNode.title="Flip Y";FlipYNode.prototype.onPropertyChanged=function(b,h){this.isInputConnected(0)&&void 0!==this.getInputData(0)?this.texture=this.getInputData(0):this.texture=this.graph.extra.texture;"flip"===b&&(this.properties.flip=h);this.texture.flipY=this.properties.flip;if(void 0!==this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerTextureNodes(){LiteGraph.registerNodeType("Texture/Texture",TextureNode);LiteGraph.registerNodeType("Texture/Preview",TexturePreviewNode);LiteGraph.registerNodeType("Texture/WrapHor",WrapHorNode);LiteGraph.registerNodeType("Texture/WrapVert",WrapVertNode);LiteGraph.registerNodeType("Texture/Repeat",RepeatNode);LiteGraph.registerNodeType("Texture/MinFilter",MinFilterNode);LiteGraph.registerNodeType("Texture/MagFilter",MagFilterNode);LiteGraph.registerNodeType("Texture/FlipY",FlipYNode)}
function VolumeNode(){this.addInput("","texture");this.addOutput("","texture");this.properties={value:1};this.serialize_widgets=!0}VolumeNode.title="Volume";VolumeNode.prototype.onAdded=function(){var b=this;this.widget=this.addWidget("slider","Volume",this.graph.extra.texture.volume,h=>{b.properties.value=h},{property:"value",min:0,max:1,text:"Volume"})};VolumeNode.prototype.onPropertyChanged=function(b,h){"value"===b&&this.graph.extra.texture.setVolume(h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function PlaybackRateNode(){this.addInput("","texture");this.addOutput("","texture");this.properties={value:1};this.serialize_widgets=!0}PlaybackRateNode.title="Playback Rate";PlaybackRateNode.prototype.onAdded=function(){this.widget=this.addWidget("number","Rate",this.graph.extra.texture.playbackRate,"value")};PlaybackRateNode.prototype.onPropertyChanged=function(b,h){"value"===b&&this.graph.extra.texture.setPlaybackRate(h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function AutoplayNode(){this.addInput("","texture");this.addOutput("","texture");this.addProperty("value",!0)}AutoplayNode.title="Autoplay";AutoplayNode.prototype.onAdded=function(){this.widget=this.addWidget("toggle","Autoplay?",this.graph.extra.texture.autoplay,"value")};AutoplayNode.prototype.onPropertyChanged=function(b,h){"value"===b&&(this.graph.extra.texture.autoplay=h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function LoopNode(){this.addInput("","texture");this.addOutput("","texture");this.addProperty("value",!0)}LoopNode.title="Loop";LoopNode.prototype.onAdded=function(){this.widget=this.addWidget("toggle","Loop?",this.graph.extra.texture.loop,"value")};LoopNode.prototype.onPropertyChanged=function(b,h){"value"===b&&this.graph.extra.texture.setLoop(h);if(this.graph&&this.graph.onNodeConnectionChange)this.graph.onNodeConnectionChange()};
function registerVideoTextureNodes(){LiteGraph.registerNodeType("Video/Volume",VolumeNode);LiteGraph.registerNodeType("Video/Rate",PlaybackRateNode);LiteGraph.registerNodeType("Video/Autoplay",AutoplayNode);LiteGraph.registerNodeType("Video/Loop",LoopNode)}
function GorlotApp(b){this.renderer=this.program=null;this.vr=this.fullscreen=!1;void 0===b?(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0px",this.canvas.style.top="0px",this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,document.body.appendChild(this.canvas),this.canvas_resize=!0):(this.canvas=b,this.canvas_resize=!1);
b=this.canvas;this.lock_mouse=function(){b.requestPointerLock?b.requestPointerLock():b.mozPointerRequest?b.mozPointerRequest():b.webkitRequestPointLock&&b.webkitRequestPointLock()}}GorlotApp.prototype.loadRunProgram=function(b,h,k){var e=new ObjectLoader,p=this;FileSystem.readFile(b,!1,q=>{p.program=e.parse(JSON.parse(q));p.run();void 0!==h&&h()},k)};GorlotApp.prototype.loadProgram=function(b){var h=new ObjectLoader;b=FileSystem.readFile(b);this.program=h.parse(JSON.parse(b))};
GorlotApp.prototype.run=function(){if(null===this.program)console.warn("GorlotApp: No program is loaded");else{this.renderer=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0});this.renderer.autoClear=!1;this.renderer.shadowMap.enabled=!0;this.renderer.shadowMap.type=THREE.PCFShadowMap;this.renderer.setSize(this.canvas.width,this.canvas.height);this.keyboard=new Keyboard;this.mouse=new Mouse;this.mouse.setCanvas(this.canvas);this.program.app=this;this.program.default_camera=new PerspectiveCamera(60,
this.canvas.width/this.canvas.height,.1,1E6);this.program.default_camera.position.set(0,10,30);this.program.setRenderer(this.renderer);this.program.setMouseKeyboard(this.mouse,this.keyboard);this.program.initialize();this.program.resize(this.canvas.width,this.canvas.height);this.program.lock_pointer&&this.canvas.addEventListener("click",this.lock_mouse,!1);var b=this,h=function(){null!==b.program&&(requestAnimationFrame(h),b.update())};h()}};
GorlotApp.prototype.update=function(){this.mouse.update();this.keyboard.update();this.program.update();this.program.render(this.renderer)};GorlotApp.prototype.exit=function(){this.program.lock_pointer&&this.canvas.removeEventListener("click",this.lock_mouse,!1);null!==this.program&&(this.program.dispose(),this.program=null);this.mouse.dispose();this.keyboard.dispose();if(void 0!==this.onExit)this.onExit()};
GorlotApp.prototype.resize=function(){null!==this.canvas&&this.canvas_resize&&(this.canvas.style.width=window.innerWidth+"px",this.canvas.style.height=window.innerHeight+"px",this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight);null!==this.program&&null!==this.renderer&&(this.renderer.setSize(this.canvas.width,this.canvas.height),this.program.resize(this.canvas.width,this.canvas.height))};GorlotApp.prototype.sendData=function(b){null!==this.program&&this.program.receiveDataApp()};
GorlotApp.prototype.setOnDataReceived=function(b){this.onDataReceived=b};GorlotApp.prototype.setOnExit=function(b){this.onExit=b};GorlotApp.prototype.vrAvailable=function(){return this.program.vr&&GORLOT.WebVRAvailable()};GorlotApp.prototype.toggleVR=function(){this.program.vr?this.vr?(this.program.exitVR(),this.vr=!1):(this.program.displayVR(),this.vr=!0):console.warn("GorlotApp: Loaded program is not VR enabled")};
GorlotApp.prototype.setFullscreen=function(b,h){(this.fullscreen=void 0!==b?b:!this.fullscreen)?(void 0===h&&(h=document.body),h.requestFullscreen=h.requestFullscreen||h.mozRequestFullScreen||h.webkitRequestFullscreen||h.msRequestFullscreen,h.requestFullscreen&&h.requestFullscreen()):(document.exitFullscreen=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen,document.exitFullscreen&&document.exitFullscreen())};
